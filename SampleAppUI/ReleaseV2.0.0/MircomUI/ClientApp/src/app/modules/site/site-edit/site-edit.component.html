<div class="headerMenuIcons">
  <input #file id="file" type="file" (change)="onImportSiteClick($event)" style="display:none;"/>
  <a mat-raised-button class="btn btn-raised btn-info" (click)="onTriggerImportSiteClick($event)" title="{{ 'site.importSite' | translate }}"> <i class="material-icons icon-white">exit_to_app</i></a>
  <a mat-raised-button class="btn btn-raised btn-info" data-toggle="modal" data-target="#siteModal" (click)="onAddSiteClick($event)" title="{{ 'site.addSite' | translate }}"> <i class="material-icons icon-white">add</i></a>
  <a mat-raised-button class="btn btn-raised btn-info" title="{{ 'site.done' | translate }}" (click)='onAddUpdateSiteDetails($event)'> <i class="material-icons icon-white">done</i></a>
</div>
<div class="site-container">
  <div class="row" *ngIf="errorMessageFromApi">
    <div class="alert alert-danger">
      {{errorMessageFromApi}}
    </div>
  </div>
  <div class="mat-elevation-z8">
    <table mat-table #table [dataSource]="dataSource"
           cdkDropList
           [cdkDropListData]="dataSource"
           (cdkDropListDropped)="dropTable($event)">

      <!--- Note that these columns can be defined in any order.
      The actual rendered columns are set as a property on the row definition" -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>Id</th>
        <td class="pointer-events-none" mat-cell *matCellDef="let element"> {{element.id}} </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> {{ 'site.name' | translate }} </th>
        <td class="pointer-events-none" mat-cell *matCellDef="let element">
          <button class="pointer-events-visible" mat-icon-button (click)="onSiteRemove($event, element)">
            <mat-icon aria-label="Remove">remove</mat-icon>
          </button>
          <span class="siteImage"> <img src={{element.images}}> </span>
          <span>{{element.name}}</span>
        </td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef> {{ 'site.description' | translate }} </th>
        <td class="pointer-events-none" mat-cell *matCellDef="let element"> {{element.description}}</td>
      </ng-container>

      <!-- Edit Action Column -->
      <ng-container matColumnDef="editAction">
        <th mat-header-cell *matHeaderCellDef> </th>
        <td class="pointer-events-none" mat-cell *matCellDef="let element">
          <button class="pointer-events-visible" data-toggle="modal" data-target="#siteModal" mat-icon-button (click)="onSiteEdit($event, element.id, element.name)">
            <mat-icon aria-label="Edit">edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Reorder Action Column -->
      <ng-container matColumnDef="reorderAction">
        <th mat-header-cell *matHeaderCellDef> </th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button>
            <mat-icon cdkDragHandle aria-label="Reorder">reorder</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" [hidden]="row.action == actionType.Delete" cdkDrag [cdkDragData]="row" [ngClass]="{ 'lastSiteHighlight': row.id == selectedSiteId }"> </tr>
    </table>
  </div>
</div>
<!-- site properties modal -->
<div class="modal" id="siteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-notice">
    <div class="modal-content">
      <form class="form-horizontal" name="form">
        <div class="modal-header">
          <h5 class="modal-title" id="myModalLabel"><strong>{{ 'site.title' | translate }}</strong></h5>

          <button mat-button type="button" class="close" data-dismiss="modal" aria-hidden="true" (click)="closeSitePopUp($event)">
            <i class="material-icons">close</i>
          </button>
        </div>
        <div class="modal-body">
          <div class="instruction">
            <div class="row" *ngIf="errorMessageOnSitePopUp">
              <div class="alert alert-danger">
                {{errorMessageOnSitePopUp}}
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.siteName' | translate }} *</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" [(ngModel)]="siteData.siteName" id="siteName" name="siteName" required />
              </div>
            </div>
            <div class="row" *ngIf="!hideExportFrom">
              <div class="col-md-4">
                <label>{{ 'siteEdit.createFrom' | translate }}</label>
              </div>
              <div class="col-md-8">
                <div class="form-check">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="exportFrom" [(ngModel)]="siteData.siteExportFrom" value="{{siteExportFrom[siteExportFrom.Template]}}" (change)="onExportFromChange($event)" checked> {{ 'siteEdit.templateList' | translate }}
                    <span class="circle">
                      <span class="check"></span>
                    </span>
                  </label>
                </div>
                <div class="form-check" *ngIf="siteData.siteExportFrom == siteExportFrom[siteExportFrom.Template]">
                  <mat-form-field>
                    <mat-select placeholder="{{ 'siteEdit.selectTemplate' | translate }}" [(ngModel)]="siteData.templateId" name="templateId" (selectionChange)="onTemplateChange($event.value)">
                      <mat-option *ngFor="let template of templates" [value]="template.id">
                        {{template.name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="form-check">
                  <label class="form-check-label">
                    <input class="form-check-input" type="radio" name="exportFrom" [(ngModel)]="siteData.siteExportFrom" value="{{siteExportFrom[siteExportFrom.Copy]}}" (change)="onExportFromChange($event)"> {{ 'siteEdit.copyFrom' | translate }}
                    <span class="circle">
                      <span class="check"></span>
                    </span>
                  </label>
                </div>
                <div class="form-check" *ngIf="siteData.siteExportFrom == siteExportFrom[siteExportFrom.Copy]">
                  <mat-form-field>
                    <mat-select placeholder="Select Sites" [(ngModel)]="siteData.siteCopyFrom" name="siteCopyFrom" (selectionChange)="onCopyFromChange($event.value)">
                      <mat-option *ngFor="let site of dataSource.data" [value]="site.id">
                        {{ site.name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.description' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteDescription" [(ngModel)]="siteData.siteDescription" name="siteDescription" />
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.address' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteAddress" [(ngModel)]="siteData.siteAddress" name="siteAddress" />
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.city' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteCity" [(ngModel)]="siteData.siteCity" name="siteCity" />
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.stateProvince' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteState" [(ngModel)]="siteData.siteState" name="siteState" />
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.country' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteCountry" [(ngModel)]="siteData.siteCountry" name="siteCountry" />
              </div>
            </div>
            <div class="row" style="display:none;">
              <div class="col-md-4">
                <label>{{ 'siteEdit.zipPostalCode' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteZipCode" [(ngModel)]="siteData.siteZipCode" name="siteZipCode" />
              </div>
            </div>
            <div class="row">
              <div class="col-md-4">
                <label>{{ 'siteEdit.createdBy' | translate }}</label>
              </div>
              <div class="col-md-8">
                <input matInput class="form-control" id="siteCreatedBy" [(ngModel)]="siteData.siteCreatedBy" [disabled]="true" name="siteCreatedBy" />
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button mat-raised-button type="button" class="btn btn-info" (click)='onSiteSubmitted($event)'>{{ 'siteEdit.submit' | translate }}</button>
          <button mat-raised-button type="button" class="btn btn-grey" data-dismiss="modal" (click)="closeSitePopUp($event)">{{ 'siteEdit.cancel' | translate }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- site properties modal -->
