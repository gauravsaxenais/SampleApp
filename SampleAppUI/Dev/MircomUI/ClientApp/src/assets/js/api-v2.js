/*!
 * 
 */
/*globals s2:false,ev_URL:false,wireUpS2Customizations:false*/
(function() {
    // Load S2 Customizations
    if (window.loadCamera && typeof s2 === 'undefined') {
        var script = document.createElement("script");
        script.setAttribute("src", ev_URL + "s2.js");
        script.setAttribute("type", "text/javascript");

        var callbackPerformed = false;

        var onLoadFunction = function() {
            var state = script.readyState;

            if (!callbackPerformed && (!state || /loaded|complete/.test(state))) {
                callbackPerformed = true;
                wireUpS2Customizations();
            }
        };

        //Once the script has loaded, call the wire up function
        script.onreadystatechange = onLoadFunction;
        script.onload = onLoadFunction;

        document.body.appendChild(script);
    }
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The root global object for this API.
     * @type Object
     */
    window.EVWEB2 = {};

    /**
     * Advanced configuration options.  These should not be modified.
     * @type {Object}
     */
    EVWEB2.config = {
        /**
         * The default stream ID to be used when requesting video.
         * @type String
         */
        defaultStreamId: null,
        /**
         * Interval for polling a trigger on, in milliseconds.
         * @type Number
         */
        triggerPollingRate: 1000,
        /**
         * Timeout specified for JSONP requests before issuing an error response.
         * @type Number
         */
        jsonpRequestTimeout: 5000
    };

    /**
     * Internal Use Only. The base error strings returned from the web service.
     * @ignore
     * @type Object
     */
    EVWEB2.errors = {
        config: "invalid session",
        servers: "{\n\tERROR\n}",
        login: '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01//EN\">' +
            '\n<html>\n<head>\n<title>Config</title>\n</head>\n<body>\n<h1>Error</h1>\n</body>\n</html>',
        triggers: "{\n\tERROR\n}",
        ptz: "{\n\tERROR\n}",
        search: "{\n\tERROR\n}",
        jsonLoginFailed: 'Login failed'
    };

    /**
     * Forward declaration of EVWEB2.ajax alias of {@link EVWEB2.util.internal.ajax}, defined for
     * convenience.  The actual assignment of this alias is performed with the definition of the
     * actual implementation.
     * @ignore
     * @type Function
     */
    EVWEB2.ajax = undefined;


    /**
     * Internal Use Only. The URL endpoints for the various web service calls.
     * @ignore
     * @type Object
     */
    EVWEB2.urls = {
        getServerList: 'login.web?output=json',
        getCameraList: 'config.web',
        getViewList: 'view.web',
        login: 'login.web',
        logout: 'logout.web',
        legacyGetFrame: 'pull.web',
        video: 'video.web',
        search: 'search.web',
        searchStatus: 'search.web/status',
        speed: 'playspeed.web',
        step: 'step.web',
        time: 'timestamp.web',
        ptz: 'ptz.web',
        trigger: 'trigger.web',
        metadata: 'metadata.web',
        resourceKey: 'key.web',
        version: 'version.web',
        digitalPtz: 'digitalptz.web',
        service: 'service.web',
        serviceDiscovery: 'service.web/discovery',
        audio: 'audio.web',
        videoexport: 'export.web',
        map: 'map.web',
        status: 'status.web',
        groups: 'groups.web',
        thumbnail: 'thumbnail.web',
        tours: 'tour.web',
        serverUsers: 'server.web/users',
        serverPlugins: 'server.web/plugins',
        health: 'health.web',
        systemInfo: 'server.web',
        videopush: 'videopush.web',
        videopushMessage: 'videopush.web/message',
        devices: 'server.web/devices',
        deviceTypes: 'server.web/devices/types',
        cachedThumbnail: 'video.web/thumbnail',
        camera: 'camera.web',
        configUpdateStatus: 'server.web/events/status',
        users: 'users.web',
        userGroups: 'users.web/groups',
        eventMonitoring: 'eventmonitoring.web',
        eventMonitoringPush: 'eventmonitoring.web/push',
        pushNotification: 'pushnotification.web',
        brokerConfig: 'broker.web/config',
        legacyWebsocketStatus: 'status.web/legacywebsocket',
        legacyWebsocketCamerasOsd: 'camera.web/legacywebsocket',
        auth: 'auth.web',
        authLogout: 'auth.web/logout',
        bookmark: 'bookmark.web',
        bookmarkItems: 'bookmark.web/items',
        bookmarkCases: 'bookmark.web/cases',
        associations: 'associations.web',
        associationsCamera: 'associations.web/camera',
        associationsCameraItem: 'associations.web/camera/item',
        securityIntegrationDevices: 'securityintegrations.web',
        securityIntegrationsDeviceLogin: 'securityintegrations.web/login',
        securityIntegrationsDeviceSensors: 'securityintegrations.web/sensors',
        serverSerialInfo: 'server.web/serial',
        serialDevices: 'serial.web',
        serialData: 'serial.web/data',
        serialStoredData: 'serial.web/data/stored',
        serialProfiles: 'serial.web/profile',
        serialProfileKeywords: 'serial.web/profile/keywords',
        serialProfileLineMasks: 'serial.web/profile/masks',
        serialProfileReplacements: 'serial.web/profile/replacements',
        serialProfileRules: 'serial.web/profile/rules',
        serviceInfo: 'service.web/info',
        serviceConfigToken: 'service.web/token',
        serviceConfigServers: 'service.web/servers',
        serviceConfigServersXdv: 'service.web/servers/xdv',
        serviceConfigRemoteServers: 'service.web/remoteservers',
        serviceConfigRemoteServersListener: 'service.web/remoteservers/listener',
        serviceConfigLogging: 'service.web/logging',
        serviceConfigLoggingFile: 'service.web/logging/file',
        serviceConfigBasic: 'service.web/config',
        serviceConfigUpdates: 'service.web/updates',
        serviceConfigExternalAuth: 'service.web/externalauth',
        serviceConfigAdmin: 'service.web/admin',
        serviceConfigStatus: 'service.web/status',
        serviceConnectivityStatus: 'service.web/status/connectivity',
        serviceServerStatus: 'service.web/status/server',
        serviceSSLConfigType: 'service.web/config/ssl',
        serviceSSLExternalConfig: 'service.web/config/ssl/external',
        serviceSSLAcmeConfig: 'service.web/config/ssl/acme',
        serviceSSLAcmeStatus: 'service.web/config/ssl/acme/status',
        serviceRestoreDefaults: 'service.web/reset',
        events: 'events.web',
        archiveTargets: 'server.web/archive',
        searchVideo: 'video.web/search',
        addresses: 'service.web/addresses',
        analyticRules: 'analytics.web/rules',
        analyticRulePush: 'analytics.web/rules/push',
        searchSnapshot: 'video.web/search/snapshot'
    };


    /**
     * The font styles available.
     * @enum {Number}
     * @readonly
     * @category Util
     */
    EVWEB2.fontStyle = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Normal
         */
        normal: 90,
        /**
         * Italic
         */
        italic: 93,
        /**
         * Slant
         */
        slant: 94
    };

    /**
     * The font colors available.
     * @enum {Number}
     * @readonly
     * @category Util
     */
    EVWEB2.fontColor = {
        /**
         * Unknown
         */
        unknown: -1,
        /**
         * White
         */
        white: 0XFFFFFF,
        /**
         * Aqua
         */
        aqua: 0X00FFFF,
        /**
         * Fushia
         */
        fushia: 0XFF00FF,
        /**
         * Yellow
         */
        yellow: 0XFFFF00,
        /**
         * Silver
         */
        silver: 0XC0C0C0,
        /**
         * Red
         */
        red: 0XFF0000,
        /**
         * Lime
         */
        lime: 0X00FF00,
        /**
         * Blue
         */
        blue: 0X0000FF,
        /**
         * Gray
         */
        gray: 0X808080,
        /**
         * Teal
         */
        teal: 0X008080,
        /**
         * Purple
         */
        purple: 0X800080,
        /**
         * Olive
         */
        olive: 0X808000,
        /**
         * Black
         */
        black: 0X000000,
        /**
         * Maroon
         */
        maroon: 0X800000,
        /**
         * Green
         */
        green: 0X008000,
        /**
         * Navy
         */
        navy: 0X000080
    };

    /**
     * The font weights available.
     * @enum {Number}
     * @readonly
     * @category Util
     */
    EVWEB2.fontWeight = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Light
         */
        light: 90,
        /**
         * Bold
         */
        bold: 92
    };

    /**
     * The font families available.
     * @enum {Number}
     * @readonly
     * @category Util
     */
    EVWEB2.fontFamily = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Default Font
         */
        defaultFont: 70,
        /**
         * Decorative
         */
        decorative: 71,
        /**
         * Roman
         */
        roman: 72,
        /**
         * Script
         */
        script: 73,
        /**
         * Swiss
         */
        swiss: 74,
        /**
         * Modern
         */
        modern: 75,
        /**
         * Teletype
         */
        teletype: 76
    };

    /**
     * Container for font information.  Used primarily by {@link EVWEB2.Association}.
     * @param {String} [font='Sans'] The name of the font.
     * @param {Number} [size=10] The font size.
     * @param {EVWEB2.fontStyle} [style=EVWEB2.fontStyle.normal] The font style used for displaying text.
     * @param {EVWEB2.fontColor} [color=EVWEB2.fontColor.white] The font color used for displaying text.
     * @param {EVWEB2.fontFamily} [family=EVWEB2.fontFamily.defaultFont] The font family used for displaying text.
     * @param {EVWEB2.fontWeight} [weight=EVWEB2.fontWeight.light] The font weight used for displaying text.
     * @param {Boolean} [underline=false] Whether the font should be underlined.
     * @constructor
     * @category Util
     */
    EVWEB2.FontInfo = function(font, size, style, color, family, weight, underline){

        /**
         * The name of the font.
         * @type {String}
         */
        this.font = 'Sans';

        /**
         * The font size.
         * @type {number}
         */
        this.size = 10;

        /**
         * The font style used for displaying text.
         * @type {EVWEB2.fontStyle}
         */
        this.style = EVWEB2.fontStyle.normal;

        /**
         * The font color used for displaying text.
         * @type {EVWEB2.fontColor}
         */
        this.color = EVWEB2.fontColor.white;

        /**
         * The font family used for displaying text.
         * @type {EVWEB2.fontFamily}
         */
        this.family = EVWEB2.fontFamily.defaultFont;

        /**
         * The font weight used for displaying text.
         * @type {EVWEB2.fontWeight}
         */
        this.weight = EVWEB2.fontWeight.light;

        /**
         * Whether the font should be underlined.
         * @type {boolean}
         */
        this.underline = false;

        if(font !== undefined) {
            this.font = font;
        }
        if(size !== undefined) {
            this.size = size;
        }
        if(style !== undefined) {
            this.style = style;
        }
        if(color !== undefined) {
            this.color = color;
        }
        if(family !== undefined) {
            this.family = family;
        }
        if(weight !== undefined) {
            this.weight = weight;
        }
        if(underline !== undefined) {
            this.underline = underline;
        }
    };

}());

/*globals EVWEB2:true*/
(function() {
    /**
     * Passed for all {@link EVWEB2} calls that return a result as the first parameter of every response callback to
     * provide information on the success/failure of a request.
     * @param {Boolean} success Whether the request succeeded
     * @param {String} [errorText] Error text of the response
     * @param {Number} [errorCode] Error code of the response.  (Reserved for future use.)
     * @class
     * @constructor
     * @category Util
     */
    EVWEB2.ResponseStatus = function(success, errorText, errorCode) {
        /**
         * Whether the request succeeded
         * @type Boolean
         */
        this.success = false;

        /**
         * The error text of the response.
         * @type String
         */
        this.errorText = '';

        /**
         * The error code of the response.  (Not currently used)
         * @type Number
         */
        this.errorCode = 0;

        if(typeof success !== 'undefined') {
            this.success = success;
        }
        if(typeof errorText !== 'undefined') {
            this.errorText = errorText;
        }
        if(typeof errorCode !== 'undefined') {
            this.errorCode = errorCode;
        }
    };
}());
/*globals EVWEB2:true*/

(function() {
    "use strict";

    /**
     * Basic container for log items.
     * @param {Date} time The time at which the log item was recorded.
     * @param {Array} args The array of arguments passed to the function.
     * @constructor
     * @category Util
     */
    EVWEB2.LogItem = function(time, args) {
        this.time = time;
        this.args = args;
    };


    /**
     * Logging system.  Wraps console.log, debug, and error, filtering out messages if it is not
     * enabled.
     * @class
     * @category Util
     */
    EVWEB2.Logging = function() {

        /**
         * Whether logging is enabled or not.  If not enabled, the past
         * {@link EVWEB2.Logging.recordsToStore} will be stored, but none will be written out to the
         * console.
         * @type {boolean}
         */
        this.enabled = false;

        /**
         * The maximum number of records to store for each log type.
         * @type {number}
         */
        this.recordsToStore = 50;

        /**
         * Stores the past {@link EVWEB2.Logging.recordsToStore} logs of each type passed into console.
         * @private
         * @type {Object}
         */
        var logs = {};

        /**
         * A list of the supported console methods that are wrapped.  These can be extended to
         * include others, if necessary.
         * @private
         * @type {string[]}
         */
        var consoleMessages = ['log', 'debug', 'error'];


        /**
         * Override callback to be used in place of the default console logging.
         * @private
         * @type {function|undefined}
         */
        var overrideCallback;

        /**
         * Reference to this object for dynamically extending the object.
         * @private
         * @type {EVWEB2.Logging}
         */
        var instance = this;

        /**
         * Primary action of each console wrapper method.  Stores the message in {@logs} and, if
         * enabled, passes the content to the console native method.
         * @private
         * @param {String} method The method called on console. (e.g. 'log', 'debug', etc.)
         * @param {Array} args The arguments passed to the original call.
         */
        var consoleAction = function(method, args) {
            if(logs[method] === undefined) {
                logs[method] = [];
            }
            var logItem = new EVWEB2.LogItem(new Date(), args);
            logs[method].push(logItem);

            var logLength = logs[method].length;
            if(logLength > instance.recordsToStore) {
                logs[method] = logs[method].slice(logLength - instance.recordsToStore);
            }

            if(instance.enabled) {
                if(overrideCallback !== undefined) {
                    overrideCallback(logItem);
                }
                /* eslint-disable no-console */
                else if (console !== undefined && console[method] !== undefined) {
                    console[method].apply(console, args);
                }
                /* eslint-enable no-console */
            }
        };

        /**
         * Generates the anonymous function for binding the console wrapper methods.
         * @private
         * @param {string} method The method called on console. (e.g. 'log', 'debug', etc.)
         * @returns {Function} The anonymous function calling {@link consoleAction}.
         */
        var generateConsoleAction = function(method) {
            return function() {
                consoleAction(method, arguments);
            };
        };

        // Wire up each of the console messages with their wrapper method.
        var i;
        for(i=0; i<consoleMessages.length; i++) {
            var method = consoleMessages[i];
            instance[method] = generateConsoleAction(method);
        }

        /**
         * Applies an override callback to be called in place of the default console methods.  This
         * can be used to integrate the internal API logging into other logging structures.
         * @param {Function} override A function used to override the default logging methods.  This
         * callback is called with an {@link EVWEB2.LogItem} for each enabled logging statement.
         */
        this.applyOverride = function(override) {
            if(overrideCallback !== undefined) {
                EVWEB2.logger.main.debug('Overriding existing logging callback.', overrideCallback, override);
            }
            overrideCallback = override;
        };

        /**
         * Removes an existing override callback, returning the logger to using the default console
         * methods.
         */
        this.removeOverride = function() {
            if(overrideCallback === undefined) {
                EVWEB2.logger.main.debug('Removing logging callback with none applied.');
            }
            overrideCallback = undefined;
        };

        /**
         * Retrieves the stored logs for the provided method.
         * @param {String} method The method called on console. (e.g. 'log', 'debug', etc.)
         * @param {Number} [numRecords=EVWEB2.logger.recordsToStore] The maximum number of records
         * to return.
         * @returns {Array} Array of log items sorted by the time each was applied.
         */
        this.storedLogs = function(method, numRecords) {
            if(logs[method] === undefined) {
                return [];
            }
            if(numRecords === undefined) {
                numRecords = instance.recordsToStore;
            }
            if(numRecords > instance.recordsToStore) {
                EVWEB2.logger.main.debug('More records requested than max stored.', numRecords, instance.recordsToStore);
                numRecords = instance.recordsToStore;
            }
            var sliceIndex = logs[method].length - numRecords;
            if(sliceIndex < 0) {
                sliceIndex = 0;
            }
            return logs[method].slice(sliceIndex);
        };

    };

    /**
     * The primary logger instance for EVWEB2.
     * @type {EVWEB2.Logging}
     * @category Util
     */
    EVWEB2.logger = {
        main: new EVWEB2.Logging()
    };

    /**
     * Helper reference for associating with the primary logging instance.  This is a mapping of
     * {@link EVWEB2.logger.main.log}.
     * @type {function}
     * @category Util
     */
    EVWEB2.log = EVWEB2.logger.main.log;
}());

/*globals EVWEB2:true*/
(function() {
    /**
     * A collection of utility functions used by the API.
     * @type {Object}
     * @category Util
     */
    EVWEB2.util = {};

    /**
     * The Date2IETF function is a helper function for communicating with the search system.  The search system
     * uses all times in IETF RFC 3339 format, so to aid in communicating with the search API, this function will
     * take the native JavaScript Date object and convert it into an IETF RFC 3339 compliant string format.  If the
     * passed in parameter is not a valid Date Object, an empty string will be returned.
     * @param {Date} dateObj Date object that is the source for the converted IETF compliant string.
     * @param {Boolean} useMs Whether or not to include milliseconds in the IETF format.
     * @return {String} The date in the IETF format, or an empty string if the object is not the valid Date
     * @category Util
     */
    EVWEB2.util.Date2IETF = function (dateObj, useMs) {
        useMs = useMs || false;

        if(typeof dateObj === 'undefined' || dateObj === null || typeof dateObj.getHours === 'undefined') {
            return "";
        }

        var ietf = dateObj.getUTCFullYear() + '-';
        var month = dateObj.getUTCMonth() + 1;
        if(month < 10) {
            ietf += '0';
        }
        ietf += month + '-';

        var date = dateObj.getUTCDate();
        if(date < 10) {
            ietf += '0';
        }
        ietf += date + 'T';

        var hours = dateObj.getUTCHours();
        if(hours < 10) {
            ietf += '0';
        }
        ietf += hours + ':';

        var minutes = dateObj.getUTCMinutes();
        if(minutes < 10) {
            ietf += '0';
        }
        ietf += minutes + ':';

        var seconds = dateObj.getUTCSeconds();
        if (seconds < 10) {
            ietf += '0';
        }
        ietf += seconds;

        if(useMs) {
            var ms = dateObj.getUTCMilliseconds();
            if (ms > 0) {
                ietf += '.';
                if (ms < 100) {
                    ietf += '0';
                }

                if (ms < 10) {
                    ietf += '0';
                }

                ietf += ms;
            }
        }

        ietf += 'Z';
        return ietf;
    };

    /**
     * The IETF2Date function is a reverse of the {@link EVWEB2.util.Date2IETF} function that translates the IETF
     * formatted string into a native JavaScript Date object.  With a passed in IETF RFC 3339 date-time string, this
     * will split and parse the string into a proper Date object that can be used with time tracking of the search
     * feed.
     * @param {String} ietf String in IETF format to be converted to a Date object
     * @return {Date} A date object with the date-time from the given IETF date-time string or null if the string is
     * invalid
     * @category Util
     */
    EVWEB2.util.IETF2Date = function (ietf) {
        var date = new Date(0);

        if(typeof ietf !== 'string') {
            return null;
        }

        var ietfSplit = ietf.split('T');
        if(ietfSplit.length !== 2) {
            return null;
        }
        var dateData = ietfSplit[0].split('-');
        if (dateData.length !== 3) {
            return null;
        }

        date.setUTCFullYear(dateData[0]);
        date.setUTCMonth(parseInt(dateData[1],10) - 1);
        date.setUTCDate(dateData[2]);

        var timeData = ietfSplit[1].split(':');
        if (timeData.length !== 3) {
            return null;
        }

        date.setUTCHours(timeData[0]);
        date.setUTCMinutes(timeData[1]);

        var secData = timeData[2].split(/[.Z]/);
        date.setUTCSeconds(secData[0]);

        if (secData[1].length > 1) {
            date.setUTCMilliseconds(secData[1]);
        }

        return date;
    };

    /**
     * @typedef {Number[]} RGBA
     * An RGBA color stored as
     * <pre>[red, green, blue, alpha]</pre>
     * The rgb components as represented as 8-bit unsigned integers, the alpha component is stored as a floating-point
     * number in the range [0,1].
     */
    /**
     * Arranges separate RGB and alpha components of a color into a composite {@link RGBA} declaration.
     * @param {Number} rgb The RGB component of the color.
     * @param {Number} alpha The alpha component of the color.
     * @return {RGBA} The color declaration.
     * @category Util
     */
    EVWEB2.util.RGBA = function(rgb, alpha) {
    /*eslint-disable no-bitwise*/
        return [
            rgb & 0xff0000 >> 16,
            rgb & 0xff00 >> 8,
            rgb & 0xff,
            alpha / 100
        ];
    };
    /*eslint-enable no-bitwise*/

    /**
     * Event handler for the load event for the image used by {@link EVWEB2.util.attachCamera}.  Continues to update
     * the image with the next frame after each successive load.
     * @private
     * @param {Event} e jQuery event object
     * @category Util
     */
    var onCameraImgLoad = function(e) {
        var target = $(e.target);

        var params = target.attr('title');
        params = params.split(';');
        if (target.attr('alt') === '-1') {
            target.src = e.data.camera.getFrame(parseInt(params[0],10), parseInt(params[1],10), parseInt(params[2],10));
        }
        else {
            target.src = e.data.camera.getFrame(parseInt(params[0],10), parseInt(params[1],10), parseInt(params[2],10),
                target.attr('alt'));
        }
    };

    /**
     *	The attachCamera function is designed to give a simple way of turning a document element into a feed
     *	display.  It will start a looping request-display system on the object, replacing it with the image for
     *	the desired Camera feed.  Once the image has been received and loaded, another image is requested,
     *	and this continues looping until stopped.  The speed of the display for the feed "video" is dependent on
     *	a number of factors, including the connection speed between the user and the web service, the connection
     *	between the web service web server and the exacqVision server, or the JPEG decompression speed of the
     *	user's computer.  To provide a simple and varying update speed, the onLoad system is used on the image,
     *	rather than a Timer linked event.
     *	@param {String|Object} element Either a jQuery selector or nodeset of the element to attach the camera to.
     *	@param {EVWEB2.Camera} camera Camera instance to from which to retrieve the feed.
     *  @param {Number} height The height of the image
     *  @param {Number} width The width of the image
     *  @param {Number} quality The quality of the image (between 1 and 10)
     *  @category Util
     */
    EVWEB2.util.attachCamera = function (element, camera, height, width, quality) {
        element = $(element);
        var target = $(element);
        if(!target.is('img')) {
            var img = $('<img/>');
            img.attr('id', 'C' + camera.id);
            target.append(img);
            target = img;
        }
        target.attr('title', width.toString() + ';' + height.toString() + ';' + quality.toString());
        target.on('load', {camera: camera}, onCameraImgLoad);
        target.attr('src', camera.getFrame(width, height, quality));
        target.attr('alt', '-1');
    };

    /**
     * Generates a unique stream ID.
     * @return {String} The generated stream ID.
     * @category Util
     */
    EVWEB2.util.generateStreamId = function() {
        var r = Math.floor(Math.random()*0xffffffff);
        return r.toString(16);
    };

    /**
     * Converts legacy plugin, device, interface and context IDs into a camera ID.
     * @param {Number} pluginId The plugin ID for the camera.
     * @param {Number} interfaceId The interface ID for the camera
     * @param {Number} deviceId The device ID for the camera.
     * @param {Number} [contextId=0] The context ID for the camera.
     * @return {String} The camera ID.
     * @category Util
     */
    EVWEB2.util.pidToCameraId = function(pluginId, interfaceId, deviceId, contextId) {
        if(typeof contextId === 'undefined') {
            contextId = 0;
        }
        /* eslint-disable no-bitwise */
        var cameraId = contextId << 28 | pluginId | (deviceId << 8) | interfaceId;
        /* eslint-enable no-bitwise */
        return cameraId;
    };

    /**
     * Utility for performing an XSS POST request by creating and submitting an &lt;iframe&gt; on the page.  Note:
     * when using this method, there is no way to retrieve the response.
     * @param {String} url The URL for the POST request.
     * @param {Object} parameters An object of name value pairs to be passed as parameters to the web service.
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.XSSPost}.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.XSSPost = function(url, parameters) {
        EVWEB2.util.internal.XSSPost(url, parameters);
    };

    /**
     * Updates a jQuery AJAX request settings object with XSS-specific options.
     * @param {Object} request jQuery AJAX request settings object
     * @param {EVWEB2.Service} [service] The service of the resource key to add.  When set, the resource key property
     * will be applied to the request.
     * @returns {Object} The updated request
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.updateRequestForXss}.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.updateRequestForXss = function(request, service) {
        return EVWEB2.util.internal.updateRequestForXss(request, service);
    };

    /**
     * Polls the service by sending version.web requests to determine when the service has restarted.
     * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     * {@link EVWEB2.ResponseStatus} instance and a copy of the {@link EVWEB2.Service} instance.
     * @param {EVWEB2.Service} [service=null] The service instance.
     * @param {Number} pollingInterval The interval duration for polling attempts for determining when the service has
     * restarted.
     * @param {Number} pollingMaxRetries The number of poll attempts before returning an error on service restart.
     * @param {Number} pollingConfirmationsRequired The number of successful subsequent polls before returning a
     * success on service restart.
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.notifyOnServiceRestart}.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.notifyOnServiceRestart = function(callback, service, pollingInterval, pollingMaxRetries,
                                          pollingConfirmationsRequired) {

        return EVWEB2.util.internal.notifyOnServiceRestart(callback, service, pollingInterval, pollingMaxRetries,
                                                        pollingConfirmationsRequired);
    };

    /**
     * Internal helper utility for processing a server response to generate a user permissions object.
     * This is a legacy method that processes permissions at the user level.
     * @param {Object} serverData The server response data
     * @returns {EVWEB2.UserPermissions} The user permissions
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.processServerPermissions}.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.processServerPermissions = function(serverData) {
        return EVWEB2.util.internal.processServerPermissions(serverData);
    };

    /**
     * Parse the IP address from an RTSP host URL.
     * NOTE: Can only parse IPv4 addresses.
     * @param {String} host the RTSP URL
     * @returns {String} The IP address or null if a valid IP address was not found.
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.parseRtspIpAddress}.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.parseRtspIpAddress = function(host) {
        return EVWEB2.util.internal.parseRtspIpAddress(host);
    };

    /**
     * Retrieves the error text from a failed XHR response object, if possible.
     * @param {Object} xhr The failed request.
     * @returns {String} The error text.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.getErrorText = function(xhr) {
        var errorText = 'An error occurred.';
        try {
            if(xhr.responseText === undefined) {
                return errorText;
            }
            var response = JSON.parse(xhr.responseText);
            if(response.errorText.length === 0) {
                return errorText;
            }
            return response.errorText;
        }
        catch(e) {
            return errorText;
        }
    };

    /**
     * Retrieves the error code from a failed XHR response object, if possible.
     * @param {Object} xhr The failed request.
     * @returns {Number|undefined} The error code if present.
     * @internal
     * @ignore
     * @category Util
     */
    EVWEB2.util.getErrorCode = function(xhr) {
        try {
            if(xhr.responseText === undefined) {
                return;
            }
            var response = JSON.parse(xhr.responseText);
            if(response.errorCode !== undefined) {
                return response.errorCode;
            }
        }
        catch(e) {
            return undefined;
        }
    };
}());

/*globals EVWEB2:true*/
(function() {

    "use strict";

    /**
     * @class
     * A collection of utility functions used by the API.
     * @type {Object}
     * @internal
     * @ignore
     */
    EVWEB2.util.internal = {};

    /**
     * Utility for performing an XSS POST request by creating and submitting an &lt;iframe&gt; on the page.  Note:
     * when using this method, there is no way to retrieve the response.
     * @param {String} url The URL for the POST request.
     * @param {Object} parameters An object of name value pairs to be passed as parameters to the web service.
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.XSSPost = function(url, parameters) {
        var iframe = $('<iframe style="display: none;"><html><body></body></html></iframe>');
        $('body').append(iframe);
        var form = $('<form></form>');
        form.attr('action', url);
        form.attr('method', 'post');
        var key;
        var formHasFileInput = false;
        var inputsToRevert = [];
        for(key in parameters) {
            if(parameters.hasOwnProperty(key)) {
                var input;
                if(parameters[key] instanceof $ ) {
                    formHasFileInput = parameters[key].attr('type') === 'file';
                    input = parameters[key];
                    inputsToRevert.push({
                        input: input,
                        parent: input.parent()
                    });
                }
                else {
                    input = $('<input type="hidden"/>');
                    input.attr('value', parameters[key]);
                }
                input.attr('name', key);
                form.append(input);
            }
        }
        if(formHasFileInput) {
            form.attr('enctype', 'multipart/form-data');
        }

        var revertMovedInputs = function(movedInputs) {
            $.each(movedInputs, function(index, element) {
                element.parent.append(element.input);
            });
        };

        if(iframe.contents().find('body').length !== 0) {
            iframe.contents().find('body').append(form);
            form.submit();
            iframe.on('load readystatechange', function() {
                form.on('submit', function() {
                    revertMovedInputs(inputsToRevert);
                    iframe.remove();
                });
            });
        }
        else {
            // IE doesn't make the iframe's body available until after the iframe is loaded.
            var onIeIframeLoad = function() {
                iframe.off('load readystatechange', onIeIframeLoad);
                iframe.contents().find('body').append(form);
                form.submit();
                revertMovedInputs(inputsToRevert);
                iframe.remove();
            };

            iframe.on('load readystatechange', onIeIframeLoad);
        }
    };

    /**
     * Updates a jQuery AJAX request settings object with XSS-specific options.
     * @param {Object} request jQuery AJAX request settings object
     * @param {EVWEB2.Service} [service] The service of the resource key to add.  When set, the resource key property
     * will be applied to the request.
     * @return {Object} The updated request
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.updateRequestForXss = function(request, service) {
        request.dataType = 'jsonp';
        request.timeout = EVWEB2.config.jsonpRequestTimeout;
        if(request.type !== undefined && request.type !== 'GET') {
            if(request.data === undefined) {
                request.data = {};
            }
            request.data.verb = request.type;
        }

        if(service !== undefined) {
            if(request.data === undefined) {
                request.data = {};
            }
            request.data.key = service.resourceKey;
        }
        return request;
    };

    /**
     * Cached value of whether CORS is supported for this instance.  This value is set and
     * referenced by {@link EVWEB2.util.internal.corsSupported}.
     * @type {undefined|Boolean}
     * @internal
     * @ignore
     */
    var corsSupported;

    /**
     * Utility method to determine whether CORS support is enabled for this browser.
     * @returns {Boolean} Whether CORS is supported
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.corsSupported = function() {
        if(corsSupported === undefined) {
            corsSupported = 'withCredentials' in new XMLHttpRequest();
        }
        return corsSupported;
    };

    /**
     * Wrapper method for $.ajax, which applies any existing authorization token to the request,
     * as well as call {@link EVWEB2.util.internal.updateRequestForXss} to apply any necessary
     * XSS transformations.  As a convenience, this function is aliased as {@link EVWEB2.ajax}
     * @param {Object} settings The settings object for $.ajax.
     * @param {EVWEB2.Service} service The service instance associated with this request.
     * @param {Boolean} [nonCorsForcePost=false] Whether to force a POST for non-CORS XSS POST
     * requests using {@link EVWEB2.util.internal.XSSPost}
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.ajax = function(settings, service, nonCorsForcePost) {
        if(EVWEB2.util.internal.corsSupported() && service.supportsCors()) {
            if (service.auth.token !== '' &&
                (service.auth.type !== EVWEB2.serviceAuthTypes.unknown
                || service.auth.type !== EVWEB2.serviceAuthTypes.none)) {

                // Add in the HTTP Auth Bearer headers
                if (settings.headers === undefined) {
                    settings.headers = {};
                }
                settings.headers['Authorization'] = 'Bearer ' + service.auth.token;

                // Add in the withCredentials property to xhrFields
                if(settings.xhrFields === undefined) {
                    settings.xhrFields = {};
                }
                settings.xhrFields["withCredentials"] = true;
            }
        }
        else {
            if(nonCorsForcePost === undefined) {
                nonCorsForcePost = false;
            }
            // Update the request for XSS requests
            if (service.isXss()) {
                if(settings.type === 'POST' && nonCorsForcePost) {
                    // Force a XSS Post and call the success callback
                    EVWEB2.util.internal.XSSPost(settings.url, settings.data);
                    var response = {
                        success: true,
                        xssPost: true
                    };
                    if(settings.success !== undefined) {
                        settings.success(response);
                    }
                    return;
                }

                // Update the request to use JSONP
                EVWEB2.util.internal.updateRequestForXss(settings, service);
            }
        }
        $.ajax(settings);
    };

    /**
     * Alias for EVWEB2.util.internal.ajax
     * @type {EVWEB2.util.internal.ajax|*}
     * @internal
     * @ignore
     */
    EVWEB2.ajax = EVWEB2.util.internal.ajax;

    /**
     * Polls the service by sending version.web requests to determine when the service has restarted.
     * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     * {@link EVWEB2.ResponseStatus} instance, a copy of the {@link EVWEB2.Service} instance, and a Boolean.
     * flag indicating if the service restart was confirmed.
     * @param {EVWEB2.Service} [service=null] The service instance.
     * @param {Number} pollingInterval The interval duration for polling attempts for determining when the service has
     * restarted.
     * @param {Number} pollingMaxRetries The number of poll attempts before returning an error on service restart.
     * @param {Number} pollingConfirmationsRequired The number of successful subsequent polls before returning a
     * success on service restart.
     * @internal
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.notifyOnServiceRestart = function(callback, service, pollingInterval, pollingMaxRetries,
                                          pollingConfirmationsRequired) {

        var confirmedRetries = 0;
        var retries = 0;

        var pollVersion;

        var onVersionSuccess = function() {
            confirmedRetries++;
            if(confirmedRetries >= pollingConfirmationsRequired) {
                // Send a successful response.
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, service, true);
            }
            else {
                // Poll the version again.
                pollVersion();
            }
        };

        var onVersionError = function() {
            confirmedRetries = 0;
            if(retries >= pollingMaxRetries) {
                // Send an error response
                var errorText = 'An error occurred when restarting the web service.';
                var errorResponse = new EVWEB2.ResponseStatus(false, errorText);
                callback(errorResponse, undefined, false);
                return;
            }
            retries++;

            // Poll the version again
            pollVersion();
        };

        pollVersion = function() {
            setTimeout(function() {
                var settings = {
                    success: onVersionSuccess,
                    error: onVersionError,
                    url: service.url() + EVWEB2.urls.version
                };

                if(service.isXss()) {
                    settings.data = {
                        output: 'json'
                    };
                }
                EVWEB2.ajax(settings, service);

            }, pollingInterval);
        };

        // Start polling the version.
        pollVersion();
    };

    /**
     * Internal helper utility for processing a group's permissions bitmask values to generate a user group permissions object.
     * @param {Object} bitmaskValues The permissions bitmask values received from the web service.
     * @returns {EVWEB2.UserGroupPermissions} The user group permissions object.
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.processUserGroupPermissions = function(bitmaskValues) {
        /* eslint-disable no-bitwise */
        var permissions = [];
        var userPermissionsArr = [
            EVWEB2.userPermissions.livePermissions,
            EVWEB2.userPermissions.searchPermissions
        ];

        var userPermissionsBitmask = [
            EVWEB2.permissionsBitmask.livePermissions,
            EVWEB2.permissionsBitmask.searchPermissions
        ];

        var userMask = bitmaskValues.user;
        $.each(userPermissionsBitmask, function(index, element) {
            $.each(element, function(key, value) {
                if(((value | userMask) === userMask) && userPermissionsArr[index].hasOwnProperty(key)) {
                    permissions.push(userPermissionsArr[index][key]);
                }
            });
        });

        var adminPermissionsArr = [EVWEB2.userPermissions.configPermissions];
        var adminPermissionsBitmask = [EVWEB2.permissionsBitmask.configPermissions];
        var adminMask = bitmaskValues.admin;
        $.each(adminPermissionsBitmask, function(index, element) {
            $.each(element, function(key, value) {
                if(((value | adminMask) === adminMask) && adminPermissionsArr[index].hasOwnProperty(key)) {
                    permissions.push(adminPermissionsArr[index][key]);
                }
            });
        });
        var groupPermissionsArr = [EVWEB2.userPermissions.groupPermissions];
        var groupPermissionsBitmask = [EVWEB2.permissionsBitmask.groupPermissions];
        var groupMask = bitmaskValues.group;
        $.each(groupPermissionsBitmask, function(index, element) {
            $.each(element, function(key, value) {
                if(((value | groupMask) === groupMask) && groupPermissionsArr[index].hasOwnProperty(key)) {
                    permissions.push(groupPermissionsArr[index][key]);
                }
            });
        });
        /* eslint-enable no-bitwise */

        return new EVWEB2.UserGroupPermissions(permissions);
    };

    /**
     * Internal helper utility for processing a server response to generate a user permissions object.
     * This is a legacy method that processes permissions at the user level.
     * @param {Object} serverData The server response data
     * @returns {EVWEB2.UserPermissions} The user permissions
     * @deprecated This method is deprecated in favor of {@link EVWEB2.util.internal.processUserGroupPermissions} which generates
     * a user group permissions object.
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.processServerPermissions = function(serverData) {
        var userPermissionsInfo = serverData.user_permissions;
        var livePermissions;
        var searchPermissions;
        var accessLevel = EVWEB2.accessLevelType.unknown;

        if(userPermissionsInfo !== undefined) {
            // Update the user permissions for Live
            livePermissions = new EVWEB2.LiveUserPermissions(userPermissionsInfo.live,
                userPermissionsInfo.live_groups, userPermissionsInfo.live_maps, userPermissionsInfo.live_views,
                userPermissionsInfo.quick_replay, userPermissionsInfo.ptz, userPermissionsInfo.two_way_audio,
                userPermissionsInfo.event_monitor, userPermissionsInfo.live_save_image,
                userPermissionsInfo.live_print_image, userPermissionsInfo.live_cameras, userPermissionsInfo.video_push);

            // Update the user permissions for Search
            searchPermissions = new EVWEB2.SearchUserPermissions(userPermissionsInfo.search,
                userPermissionsInfo.search_groups, userPermissionsInfo.search_maps, userPermissionsInfo.search_views,
                userPermissionsInfo.search_events, userPermissionsInfo.save_image, userPermissionsInfo.print_image,
                userPermissionsInfo.burn_disc, userPermissionsInfo.export_video, userPermissionsInfo.smart_search,
                userPermissionsInfo.search_cases, userPermissionsInfo.search_cameras);

            accessLevel = userPermissionsInfo.accessLevel;
        }
        // Update the config permissions for the user
        var adminAccessInfo = serverData.admin_access_permissions;
        var configPermissions;
        if(adminAccessInfo !== undefined) {
            configPermissions = new EVWEB2.ConfigUserPermissions(adminAccessInfo.users, adminAccessInfo.views);
        }
        return new EVWEB2.UserPermissions(livePermissions, searchPermissions, configPermissions, accessLevel);
    };

    /**
     * Parse the IP address from an RTSP host URL.
     * NOTE: Can only parse IPv4 addresses.
     * @param {String} host the RTSP URL
     * @returns {String} The IP address or null if a valid IP address was not found.
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.parseRtspIpAddress = function(host) {
        if(typeof host !== 'string') {
            return null;
        }
        // rtsp://<ip-address>:port/path#<key>=<value>&<key>=<value>
        // http://<ip-address>:port/path#<key>=<value>&<key>=<value>

        // from regex cookbook
        var ipv4Re = /(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/;
        var matches = host.match(ipv4Re);
        if (matches !== null && matches.length){
            return matches[0];
        }

        var simpleHostRe = /(?:rtsp|http|https):\/\/([0-9a-zA-Z\.]+)(:[0-9]+)?/;
        matches = host.match(simpleHostRe);
        if (matches !== null && matches.length > 1){
            return matches[1];
        }


        return null;
    };

    /**
     * Utility function to generate the group permissions object.
     * @param {EVWEB2.UserPermissions} [permissions=null] The user permissions object
     * @return {EVWEB2.UserGroupPermissions} The group permissions
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.generateGroupPermissions = function(permissions) {
        var permissionsArr = [
            permissions.livePermissions,
            permissions.searchPermissions,
            permissions.configPermissions
        ];
        var userPermissionsArr = [
            EVWEB2.userPermissions.livePermissions,
            EVWEB2.userPermissions.searchPermissions,
            EVWEB2.userPermissions.configPermissions
        ];
        var groupPermissions = [];

        $.each(permissionsArr, function(index, element) {
            if(element === null) {
                return;
            }
            $.each(element, function(key, value) {
                if(value && userPermissionsArr[index].hasOwnProperty(key)) {
                    groupPermissions.push(userPermissionsArr[index][key]);
                }
            });
        });
        return new EVWEB2.UserGroupPermissions(groupPermissions);
    };

    /**
     * Utility function to generate the user permissions object.
     * @param {EVWEB2.UserGroupPermissions} groupPermissions The group permissions object
     * @param {EVWEB2.accessLevelType} [accessLevel=EVWEB2.accessLevelType.unknown] The access level of the group
     * @return {EVWEB2.UserPermissions} The user permissions
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.generateUserPermissions = function(groupPermissions, accessLevel) {
        var permissions = groupPermissions.permissions;
        var userPermissionsArr = [
            EVWEB2.userPermissions.livePermissions,
            EVWEB2.userPermissions.searchPermissions,
            EVWEB2.userPermissions.configPermissions
        ];

        var i;
        var livePermissions = new EVWEB2.LiveUserPermissions();
        var searchPermissions = new EVWEB2.SearchUserPermissions();
        var configPermissions = new EVWEB2.ConfigUserPermissions();

        var keys = [livePermissions, searchPermissions, configPermissions, undefined];

        for(i=0; i < permissions.length; i++) {
            var enumVal = permissions[i];
            $.each(userPermissionsArr, function(index, element) {
                $.each(element, function(key, value) {
                    if(enumVal === value) {
                        keys[index][key] = true;
                    }
                });
            });
        }

        return new EVWEB2.UserPermissions(livePermissions, searchPermissions, configPermissions, accessLevel);
    };

    /**
     * Internal helper utility for generating a user group's permissions bitmask values.
     * @param {EVWEB2.UserGroupPermissions} groupPermissions The user group permissions.
     * @returns {Object} The bitmask values.
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.generatePermissionsBitmask = function(groupPermissions) {
        var permissions = groupPermissions.permissions;
        /* eslint-disable no-bitwise */
        var bitmask = {
            user: 0,
            admin: 0,
            group: 0
        };

        var userPermissionsArr = [
            EVWEB2.userPermissions.livePermissions,
            EVWEB2.userPermissions.searchPermissions
        ];

        var userPermissionsBitmask = [
            EVWEB2.permissionsBitmask.livePermissions,
            EVWEB2.permissionsBitmask.searchPermissions
        ];

        var adminPermissionsArr = [EVWEB2.userPermissions.configPermissions];
        var adminPermissionsBitmask = [EVWEB2.permissionsBitmask.configPermissions];

        var groupPermissionsArr = [EVWEB2.userPermissions.groupPermissions];
        var groupPermissionsBitmask = [EVWEB2.permissionsBitmask.groupPermissions];

        var i;
        for(i=0; i < permissions.length; i++) {
            $.each(userPermissionsArr, function (index, element) {
                $.each(element, function (key, value) {
                    if (value === permissions[i] && userPermissionsBitmask[index].hasOwnProperty(key)) {
                        bitmask.user = bitmask.user | userPermissionsBitmask[index][key];
                    }
                });
            });

            $.each(adminPermissionsArr, function (index, element) {
                $.each(element, function (key, value) {
                    if (value === permissions[i] && adminPermissionsBitmask[index].hasOwnProperty(key)) {
                        bitmask.admin = bitmask.admin | adminPermissionsBitmask[index][key];
                    }
                });
            });

            $.each(groupPermissionsArr, function (index, element) {
                $.each(element, function (key, value) {
                    if (value === permissions[i] && groupPermissionsBitmask[index].hasOwnProperty(key)) {
                        bitmask.group = bitmask.group | groupPermissionsBitmask[index][key];
                    }
                });
            });
        }
        /* eslint-enable no-bitwise */
        return bitmask;
    };

    /**
     * Processes a response server item from a login.web call and generates an EVWEB2.ServerDetailInfo instance.
     * @param {Object} serverResponse A server entry from a login.web call.
     * @return {EVWEB2.ServerDetailInfo} The server details
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.processServerDetails = function(serverResponse) {
        var serverInfo;
        if(typeof serverResponse.address !== 'undefined') {
            // Additional server information is available
            serverInfo = new EVWEB2.ServerDetailInfo(serverResponse.address, serverResponse.port,
                serverResponse.model, serverResponse.serial, serverResponse.version,
                serverResponse.daysRecordedVideo);
        }
        return serverInfo;
    };

    /**
     * Processes a response server item from a login.web call and generates an EVWEB2.ServerLicenseInfo instance.
     * @param {Object} serverResponse A server entry from a login.web call.
     * @return {EVWEB2.ServerLicenseInfo} The server license info
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.processServerLicense = function(serverResponse) {
        var licenseInfo;
        var license = serverResponse.licenseInfo;
        if(typeof license !== 'undefined') {
            // Additional server information is available
            var expirationDate = EVWEB2.util.IETF2Date(license.expirationDate);
            licenseInfo = new EVWEB2.ServerLicenseInfo(license.macAddress, expirationDate, license.expired,
                license.restricted, license.enterprise, license.maxAnalogCameras, license.maxIpCameras,
                license.maxBoards, license.licenseType, license.licenseKey);
        }
        return licenseInfo;
    };

    /**
     * Utility method that processes a camera osd information and generates an EVWEB2.CameraOsdInfo instance.
     * @param {Object} osd The osd info for a camera.
     * @return {EVWEB2.CameraOsdInfo} The camera OSD info
     * @internal
     * @ignore
     */
    EVWEB2.util.internal.formatOsdInfo = function(osd) {
        var osdInfo = new EVWEB2.CameraOsdInfo();

        osdInfo.position = osd.position;
        /* eslint-disable no-bitwise */
        osdInfo.name = Boolean(osd.display & EVWEB2.osdDisplay.name);
        osdInfo.time = Boolean(osd.display & EVWEB2.osdDisplay.time);
        osdInfo.date = Boolean(osd.display & EVWEB2.osdDisplay.date);
        osdInfo.timezone = Boolean(osd.display & EVWEB2.osdDisplay.timezone);
        /* eslint-enable no-bitwise */
        osdInfo.font = osd.fontName;
        osdInfo.fontSize = osd.fontSize;
        osdInfo.fontColor = osd.evFontColor;
        osdInfo.fontStyle = osd.evFontStyle;
        osdInfo.fontFamily = osd.evFontFamily;
        osdInfo.fontWeight = osd.evFontWeight;

        return osdInfo;
    };

}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * @class
     * Container object for a service version.
     * @param {Number} [major=0] The major component of a version.
     * @param {Number} [minor=0] The minor component of a version.
     * @param {Number} [build=0] The build component of a version.
     * @param {Number} [qfe=0] The QFE component of a version.
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceVersion = function(major, minor, build, qfe) {
        /**
         * The major component of a version
         * @type {number}
         */
        this.major = 0;

        /**
         * The minor component of a version
         * @type {number}
         */
        this.minor = 0;

        /**
         * The build component of a version
         * @type {number}
         */
        this.build = 0;

        /**
         * The QFE component of a version
         * @type {number}
         */
        this.qfe = 0;

        if(major !== undefined) {
            this.major = major;
        }
        if(minor !== undefined) {
            this.minor = minor;
        }
        if(build !== undefined) {
            this.build = build;
        }
        if(qfe !== undefined) {
            this.qfe = qfe;
        }

        /**
         * Converts the version to a string of the format MAJOR.MINOR.BUILD.QFE.
         * @returns {string} The version.
         */
        this.toString = function() {
            return this.major.toString() + '.' +
                (this.major >= 19 && this.minor < 10 ?
                    '0' + this.minor.toString() + '.'  :  + this.minor.toString() + '.') +
                this.build.toString() + '.' +
                this.qfe.toString();
        };

        /**
         * Compares whether the provided version is the same as this version
         * @param {EVWEB2.ServiceVersion} version The version to compare against.
         * @returns {boolean} Whether the versions are the same.
         */
        this.equals = function(version) {
            return this.major === version.major
                && this.minor === version.minor
                && this.build === version.build
                && this.qfe === version.qfe;
        };

        /**
         * Compares whether this version is less than the provided version.  Note: this does not
         * take into account equality.  If the versions are equal, the source version is not
         * less than the provided version and will return false.
         * @param {EVWEB2.ServiceVersion} version The version to compare against.
         * @returns {boolean} Whether this version is less than the provided version.
         */
        this.lessThan = function(version) {
            if(this.major < version.major) {
                return true;
            }
            if(this.major !== version.major) {
                return false;
            }

            if(this.minor < version.minor) {
                return true;
            }
            if(this.minor !== version.minor) {
                return false;
            }

            if(this.build < version.build) {
                return true;
            }
            if(this.build !== version.build) {
                return false;
            }

            return this.qfe < version.qfe;
        };

        /**
         * Compares whether this version is greater than the provided version.  Note: this does not
         * take into account equality.  If the versions are equal, the source version is not
         * greater than the provided version and will return false.
         * @param {EVWEB2.ServiceVersion} version The version to compare against.
         * @returns {boolean} Whether this version is greater than the provided version.
         */
        this.greaterThan = function(version) {
            if(this.major > version.major) {
                return true;
            }
            if(this.major !== version.major) {
                return false;
            }

            if(this.minor > version.minor) {
                return true;
            }
            if(this.minor !== version.minor) {
                return false;
            }

            if(this.build > version.build) {
                return true;
            }
            if(this.build !== version.build) {
                return false;
            }

            return this.qfe > version.qfe;
        };

        /**
         * Parses a string of the format MAJOR.MINOR.BUILD.QFE and populates the object with those values.
         * @param {String} versionString The version string to parse.
         * @return {boolean} Whether the parsing was successful.
         */
        this.populateFromString = function(versionString) {
            var stringValues = versionString.split('.');
            var values = $.map(stringValues, function(value) {
                var parsedValue = parseInt(value, 10);

                if(!isNaN(parsedValue)) {
                    return parsedValue;
                }
            });
            if(values.length !== 4) {
                return false;
            }
            this.major = values[0];
            this.minor = values[1];
            this.build = values[2];
            this.qfe = values[3];

            return true;
        };

    };

    /**
     * The service JPEG forwarding settings acts as a container for all JPEG forwarding-related information associated
     * with a service.
     *
     * JPEG forwarding is the process of requesting a native JPEG frame, if available, instead of a resized JPEG frame.
     * Using the native frame results in a larger file size, but reduces server load and decreases request processing
     * time.
     *
     * @param {Boolean} [enabled=false] Whether to enable JPEG forwarding
     * @param {Number} [sizeThreshold=100] The threshold percentage of the requested size before a camera should use
     * the native JPEG frame.
     * @param {Number} [qualityThreshold=100] The threshold percentage of the requested quality before the camera
     * should use the native JPEG frame.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceJpegForwardingSettings = function(enabled, sizeThreshold, qualityThreshold) {
        /**
         * Whether to enable JPEG forwarding (use of the native JPEG frame, if available, instead of a resized JPEG
         * frame) for all cameras on this service connection.  If enabled,
         * {@link EVWEB2.ServiceJpegForwardingSettings.sizeThreshold} and
         * {@link EVWEB2.ServiceJpegForwardingSettings.qualityThreshold} will be used to calculate whether a requested
         * frame should be the native JPEG frame.
         *
         * Note: This setting will apply even if requested aspect ratio is different than the native aspect ratio.  In
         * these situations, the black banding will not be applied.
         *
         * @type Boolean
         */
        this.enabled = false;

        /**
         * The threshold percentage of the requested size before a camera should use the native JPEG frame, if
         * available, instead of a scaled value.  This setting is used in tandem with
         * {@link EVWEB2.ServiceJpegForwardingSettings.qualityThreshold}, such that both must be applied before a
         * native JPEG frame is retrieved.
         *
         * For example, if a camera's native resolution is 640x480 with a forwarding threshold of 70, any requests that
         * are larger than 448x336 (640 * (70/100))x(480 * (70/100)) will be returned as the native frame.
         *
         * Note: This property is not used if {@link EVWEB2.ServiceJpegForwardingSettings.enabled} is set to false.
         *
         * @type Number
         */
        this.sizeThreshold = 100;

        /**
         * The threshold percentage of the requested quality before the camera should use the native JPEG frame, if
         * available, instead of a scaled value.  This setting is used in tandem with
         * {@link EVWEB2.ServiceJpegForwardingSettings.sizeThreshold}, such that both must be applied before a native
         * JPEG frame is retrieved.
         *
         * For example, if a camera's native quality is 5 with a forwarding quality threshold of 70, any requests that
         * have a quality above 3 (Math.floor(5 * (70/100))) will be returned as the native frame.
         *
         * Note: This property is not used if {@link EVWEB2.ServiceJpegForwardingSettings.enabled} is set to false.
         *
         * @type Number
         */
        this.qualityThreshold = 100;

        //Assign the constructor values
        if(typeof enabled !== 'undefined') {
            this.enabled = enabled;
        }
        if(typeof sizeThreshold !== 'undefined') {
            this.sizeThreshold = sizeThreshold;
        }
        if(typeof qualityThreshold !== 'undefined') {
            this.qualityThreshold = qualityThreshold;
        }

        /**
         * Determines whether a set of transcoding parameters are within the threshold to apply jpeg forwarding for a
         * particular camera.
         * @param {EVWEB2.Camera} camera The camera.
         * @param {Number} width The target transcode width.
         * @param {Number} height The target transcode height.
         * @param {Number} quality The target transcode quality (1-10).
         * @return {Boolean} Whether jpeg forwarding should be applied if these parameters are used to request a frame.
         */
        this.shouldForward = function(camera, width, height, quality) {
            if (camera.formats.indexOf(EVWEB2.cameraFormats.jpeg) === -1) {
                return false;
            }

            var sizeRatio = this.sizeThreshold / 100;
            return camera.quality * (this.qualityThreshold / 100) < quality &&
                (camera.resolution.width * sizeRatio < width || camera.resolution.height * sizeRatio < height);
        }
    };

    /**
     * The ConfigUpdateStatus object is a container for config update status information received from the web service.
     * @param {String} [sessionId=''] The session Id of the server.
     * @param {Date} [lastUpdated=new Date()] The timestamp of the last config update on the server.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ConfigUpdateStatus = function (sessionId, lastUpdated) {
        /**
         * The session Id of the server.
         * @type {String}
         */
        this.sessionId = '';

        /**
         * The timestamp of the last config update on the server.
         * @type {String}
         */
        this.lastUpdated = new Date();

        //Assign the constructor values
        if(sessionId !== undefined) {
            this.sessionId = sessionId;
        }

        if(lastUpdated !== undefined) {
            this.lastUpdated = lastUpdated;
        }
    };

    /**
     * Listing of web service versions associated with specific features.  This is
     * used primarily for feature checking when a fallback is available.
     * @type {{cors: EVWEB2.ServiceVersion}}
     * @private
     * @ignore
     */
    var serviceFeatureVersions = {
        cors: new EVWEB2.ServiceVersion(7, 6, 0)
    };

    /**
     * The service object is a container for a web service backend.
     * @param {String} [hostUrl=''] Web service base URL used if different than current URL.
     * @param {String} [subdirectory=''] Web service subdirectory on the current URL.
     * @param {String} [name='Unset'] Name of the server.
     * @param {String} [videoPushClientGuid] The VideoPush client GUID generated for this client.  This value is
     * created by the first call to {@link EVWEB2.VideoPush.updateClient} and should be saved and re-used for all
     * later instantiations of this client.  Note: The method {@link EVWEB2.VideoPush.setVideoPushClientGuid} is
     * provided to provide the same functionality after service construction.  This method does not need to be called
     * if specifying the GUID in this constructor or if the GUID is created in this session.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.Service = function (hostUrl, subdirectory, name, videoPushClientGuid) {
        /**
         * Name of the service
         * @type String
         */
        this.name = 'Unset';

        /**
         * Host base URL
         * @type String
         */
        this.hostUrl = '';

        /**
         * Effective host URL. Set by {@link EVWEB2.Service.setUrl}.
         * @type String
         */
        this.effectiveUrl = '';

        /**
         * Host base subdirectory
         * @type String
         */
        this.subdirectory = '';

        /**
         * Internal Use Only. Ignores XSS settings and makes standard AJAX requests instead of JSONP.
         * @ignore
         * @type Boolean
         */
        this.ignoreXss = false;

        /**
         * Internal Use Only. The resource key for passthrough communication to prevent CSRF request.
         * @ignore
         * @type String
         */
        this.resourceKey = '';

        /**
         * Whether CSRF protection is enabled for the service.
         * @ignore
         * @type Boolean
         */
        this.csrf = true;

        /**
         * The JPEG forwarding settings for this service.  JPEG forwarding is disabled by default.
         * @type {EVWEB2.ServiceJpegForwardingSettings}
         */
        this.jpegForwarding = new EVWEB2.ServiceJpegForwardingSettings(false, 100, 100);

        /**
         * A reference to the service's {@link EVWEB2.VideoPush} instance.
         * @type {EVWEB2.VideoPush}
         */
        this.videoPush = new EVWEB2.VideoPush(videoPushClientGuid);

        /**
         * The push notification instance associated with this service.  This is used to register and
         * unregister clients for receiving push notifications.
         * @type {EVWEB2.PushNotification}
         */
        this.pushNotification = new EVWEB2.PushNotification(this);

        /**
         * The websocket connection associated with this service.
         * @type {EVWEB2.WebSocketHandler}
         * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.  The default value for this
         * will be updated to EVWEB2.LegacyWebSocketHandler, which implements polling to retrieve any status
         * information.
         */
        this.websocket = new EVWEB2.WebSocketHandler(this);

        /**
         * The authorization instance associated with this service.  This is used to determine the
         * type of authentication used, as well as to authenticate for all requests to this service.
         * @type {EVWEB2.ServiceAuth}
         */
        this.auth = new EVWEB2.ServiceAuth(this);

        /**
         * Flag indicating whether the version number has been requested.
         * @private
         * @type {boolean}
         */
        var versionNumberRequested = false;

        /**
         * A reference to the service's configuration options.
         * @type {EVWEB2.ServiceConfig}
         */
        this.config = new EVWEB2.ServiceConfig(this);

        /**
         * Version number
         * @private
         * @type EVWEB2.ServiceVersion
         */
        var versionNumber = null;

        /**
         * Available version number
         * @private
         * @type EVWEB2.ServiceVersion
         */
        var availableVersionNumber = null;

        /**
         * Internal cached list of available input stream format types.  Used exclusively by
         * {@link EVWEB2.Service.audioInputFormatTypes}.
         * @private
         * @type {EVWEB2.audioInputStreamFormatTypes[]}
         */
        var availableAudioInputFormats = [];

        /**
         * The friendly name of the web service.  This is a cached value of the result of
         * a call to {@link EVWEB2.Service.friendlyName}.
         * @private
         * @type {String}
         */
        var friendlyName = '';

        //Assign the constructor values
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof hostUrl !== 'undefined' && hostUrl !== '') {
            // Verify and correct that the hostname ends in a slash
            if (hostUrl.substr(hostUrl.length-1) !== "/") {
                hostUrl += "/";
            }
            // Verify and correct that the hostname begins with a http declaration
            if (hostUrl.match(/^http[s]{0,1}:\/\//) === null) {
                hostUrl = "http://" + hostUrl;
            }

            this.hostUrl = hostUrl;
        }

        if(typeof subdirectory !== 'undefined' && subdirectory !== '') {
            if(this.hostUrl === '' && subdirectory.substr(0,1) !== '/') {
                subdirectory = '/' + subdirectory;
            }
            else if(this.hostUrl !== '' && subdirectory.substr(0,1) === '/') {
                subdirectory = subdirectory.substr(1);
            }
            // Verify and correct that the subdirectory ends in a slash
            if(subdirectory.length > 0 && subdirectory.substr(subdirectory.length -1) !== '/') {
                subdirectory += '/';
            }

            this.subdirectory = subdirectory;
        }

        /**
         * Sets the VideoPush client GUID for this service instance.  This value is created by the first call to
         * {@link EVWEB2.VideoPush.updateClient} and should be saved and re-used for all later instantiations of this
         * client.  Note: This value can also be set via the {@link EVWEB2.Service} constructor and this function is
         * provided to provide the same functionality after service construction.  This method does not need to be
         * called if specifying the GUID in this constructor or if the GUID is created in this session.
         * @param {String} guid The generated VideoPush client GUID
         */
        this.setVideoPushClientGuid = function(guid) {
            this.videoPush = new EVWEB2.VideoPush(guid);
        };

        /**
         * Returns whether contacting the server is done via XSS or not.
         * @return Boolean
         */
        this.isXss = function() {
            return !this.ignoreXss && this.hostUrl !== '';
        };

        /**
         * Generates the full URL to be used when contacting the server.
         * @return String The full URL for the server.
         */
        this.url = function() {
            if (this.effectiveUrl !== '') {
                return this.effectiveUrl + this.subdirectory;
            }
            return this.hostUrl + this.subdirectory;
        };

        /**
         * EVWEB2.Service.setUrl allows a caller to override the network address originally provided in the
         * constructor. Future calls to EVWEB2.Service.url() will return the value set by this function. Outside
         * of object ref comparison, the service can still be uniquely identified by its original {@link this.hostUrl}
         * once an effective address has been set.
         * @param {String} url The effective url.
         */
        this.setUrl = function(url) {
            this.effectiveUrl = url;
        };

        /**
         * EVWEB2.Service.resetUrl allows a caller to reset any previous network address override. Future
         * calls to EVWEB2.Service.url() will return the original host URL provided in the constructor.
         */
        this.resetUrl = function() {
            this.effectiveUrl = '';
        };

        /**
         * Retrieves the version number from the web service.  This can be used to determine supported features.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response, the resulting version
         * number string, a {@link EVWEB2.ServiceVersion} instance of the version, and a {@link EVWEB2.ServiceVersion}
         * instance indicating the most recent available update version.
         * Note: If the most recent available update version can't be determined, this value will be "0.0.0.0".
         */
        this.version = function(callback) {

            var onVersionSuccess = function(data/*, textStatus, xhr*/) {
                versionNumber = new EVWEB2.ServiceVersion();
                availableVersionNumber = new EVWEB2.ServiceVersion();
                
                var dataVersionNumber = data;
                var dataAvailableVersionNumber;
                if(typeof data !== 'string') {
                    dataVersionNumber = data.version;
                    dataAvailableVersionNumber = data.availableVersion;
                }

                if(!versionNumber.populateFromString(dataVersionNumber)) {
                    versionNumber = null;
                    availableVersionNumber = null;
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred processing the version.');
                    callback(errorResponse);
                    return;
                }

                if(dataAvailableVersionNumber === undefined || !availableVersionNumber.populateFromString(dataAvailableVersionNumber)) {
                    availableVersionNumber = new EVWEB2.ServiceVersion();
                }
                
                //Return the version number
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, versionNumber.toString(), versionNumber, availableVersionNumber);
            };

            var onVersionError = function(xhr/*, textStatus, errorThrown*/) {
                if(xhr.status === 404 || (xhr.status === 0 && xhr.statusText === 'timeout')) {
                    // Web service v2 does not expose version.web.  Assume all 404 version calls
                    // are a 2.0 service.
                    var versionResponse = {
                        version: '2.0.0.0'
                    };
                    onVersionSuccess(versionResponse);
                    return;
                }

                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };


            //If the version number has already been retrieved, return the cached version.
            if((versionNumber !== null) && (availableVersionNumber !== null)) {
                onVersionSuccess({
                    version: versionNumber.toString(),
                    success: true,
                    availableVersion: availableVersionNumber.toString()
                });
                return;
            }

            var settings = {
                success: onVersionSuccess,
                error: onVersionError,
                url: this.url() + EVWEB2.urls.version,
                data: {
                    output: 'json'
                }
            };

            versionNumberRequested = true;
            EVWEB2.ajax(settings, this);
        };

        /**
         * Determines whether or not the service supports CORS requests, which were added in 7.6.
         * Since we have no way to know until we have the version (which, in itself requires a request
         * that may not be CORS), we must return false initially and then request the version.  Afterwards,
         * we can definitively respond.
         * @return {Boolean} Whether CORS support is currently available for communication with the web service.
         */
        this.supportsCors = function() {
            if(versionNumber !== null) {
                return !versionNumber.lessThan(serviceFeatureVersions.cors);
            }
            if(!versionNumberRequested) {
                // Request the version to populate it for future requests.
                this.version($.noop);
            }
            return false;
        };

        /**
         * Internal Use Only. Sets the resource key for passthrough communication to prevent CSRF requests.
         * @ignore
         * @type String
         */
        this.setResourceKey = function (key) {
            this.resourceKey = key;
        };

        /**
         * Internal Use Only. Retrieves a resource key for passthrough communication to prevent CSRF requests.  Upon
         * retrieving the key, sets the {@link EVWEB2.Service.resourceKey} to the new value.
         * @ignore
         * @deprecated This endpoint has been deprecated and will always return a dummy key value.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response and the resulting resource
         * key.
         */
        this.getResourceKey = function(callback) {
            var service = this;

            /**
             * Callback function for resource key request error
             * @ignore
             */
            var onGetResourceKeyError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            /**
             * Callback function for resource key request success
             * @ignore
             * @param data
             */
            var onGetResourceKeySuccess = function(data/*, textStatus, xhr*/) {
                var key = '';
                if(typeof data === 'string') {
                    key = data.replace(/^key=/,'');
                }
                else {
                    key = data.key;
                }
                if(typeof key === 'undefined' || key === '-1') {
                    onGetResourceKeyError();
                    return;
                }
                service.resourceKey = key;
                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, service.resourceKey);
            };

            var settings = {
                success: onGetResourceKeySuccess,
                error: onGetResourceKeyError,
                url: this.url() + EVWEB2.urls.resourceKey
            };

            if(this.isXss()) {
                settings.data = {
                    output: 'json'
                };
            }
            EVWEB2.ajax(settings, this);
        };

        /**
         * The getServers function is the initial function for interaction with the exacqVision web service.  It
         * is used to request for the available servers on the backend web server for the web service.  This
         * list is based on the servers provided upon installation of the web service.
         *
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.Server} instances attached to the web service.
         */
        this.getServers = function (callback) {
            var service = this;
            var onGetServersError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                if(typeof xhr !== 'undefined' && xhr.status === 0 && xhr.statusText === 'timeout') {
                    errorResponse.errorText = "XSS request timeout.";
                }
                callback(errorResponse);
            };

            var onGetServersSuccess = function(data/*, textStatus, xhr*/) {
                if(data === EVWEB2.errors.servers) {
                    //Call the error callback
                    onGetServersError();
                    return;
                }

                // v2.0 web services don't return a proper JSON object, as no callback wraps the response.  For these
                // responses, attempt to manually parse the JSON.
                if(typeof data === 'string') {
                    try {
                        data = JSON.parse(data);
                    }
                    catch(err) {
                        onGetServersError();
                        return;
                    }
                }

                var resultList = data.list;

                var serverList = $.map(resultList, function(element) {
                    var serverId = element.id;

                    if(typeof serverId !== 'undefined') {
                        serverId = serverId.toString();
                    }

                    var serverInfo = EVWEB2.util.internal.processServerDetails(element);
                    var licenseInfo = EVWEB2.util.internal.processServerLicense(element);

                    var customGroupPermissions;
                    var passthroughGroup;

                    if (element.group !== undefined && element.group !== null) {
                        var group = element.group;

                        var passthroughPermissions = EVWEB2.util.internal.processUserGroupPermissions(group.permissions);

                        customGroupPermissions = new EVWEB2.CustomGroupPermissions(group.cameras, group.audios, group.serials, group.softTriggers);
                        passthroughGroup = new EVWEB2.UserGroup(group.name, group.role, passthroughPermissions, group.priorities, group.guid, customGroupPermissions);

                    }
                    else {
                        passthroughGroup = EVWEB2.util.processServerPermissions(element);
                    }

                    return new EVWEB2.Server(service, element.name, serverId, element.login, element.restricted,
                                             undefined, undefined, undefined, serverInfo, licenseInfo, undefined, passthroughGroup,
                                             element.managedFeatures, element.canAutoLogin);

                });

                if(typeof data.CSRF !== 'undefined') {
                    service.csrf = data.CSRF;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, serverList);
            };

            var settings = {
                success: onGetServersSuccess,
                error: onGetServersError,
                url: this.url() + EVWEB2.urls.getServerList,
                data: {
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Recursively parses the folder object returned from the web service into an array of {@link EVWEB2.ViewFolder}
         * instances.
         * @private
         * @param {Object} folderObj The folder object returned from the web service.
         * @param {String} folderName The name of the folder.
         * @param {String} parentId The parent folder's ID.
         * @return {EVWEB2.ViewFolder[]} The view folders
         */
        var parseFolders = function (folderObj, folderName, parentId) {
            var folders = [];
            if(typeof parentId === 'undefined') {
                parentId = folderObj.id;
            }
            folders.push(new EVWEB2.ViewFolder(folderObj.id, folderName, parentId));
            if (folderObj.folders !== null) {
                var name;
                for (name in folderObj.folders) {
                    if(folderObj.folders.hasOwnProperty(name)) {
                        var subFolders = parseFolders(folderObj.folders[name], name, folderObj.id);
                        folders = folders.concat(subFolders);
                    }
                }
            }
            return folders;
        };

        /**
         * Parses a view layout info response into a {@link EVWEB2.Layout} instance.
         * @private
         * @param {Object} layoutInfoResponse The response object to process.
         * @return {EVWEB2.Layout} The layout
         */
        var processViewLayoutResponse = function(layoutInfoResponse) {
            var layout;
            if(typeof layoutInfoResponse !== 'undefined') {
                var slots = $.map(layoutInfoResponse.slots, function(element) {
                    return new EVWEB2.LayoutSlot(element.y, element.x, element.width, element.height);
                });
                layout = new EVWEB2.Layout(layoutInfoResponse.name, layoutInfoResponse.width,
                    layoutInfoResponse.height, layoutInfoResponse.length, slots, undefined,
                    layoutInfoResponse.widescreen);
            }
            return layout;
        };

        /**
         * Generates a grep function for finding a server associated with a view response.
         * @private
         * @param {String} serverId The server ID associated.
         * @return {Function} The grep function
         */
        var generateServerGrep = function(serverId) {
            return function(viewResponse) {
                return viewResponse.id === serverId;
            };
        };

        /**
         * Parses a view audio input response into a {@link EVWEB2.ViewAudioInputInfo} instance.
         * @private
         * @param {Object} viewResponse The response object to process.
         * @param {EVWEB2.Server[]} servers The servers associated with the views.
         * @return {EVWEB2.ViewAudioInputInfo} The audio input
         */
        var processViewAudioInputResponse = function(viewResponse, servers) {
            var audioInput;
            if(typeof viewResponse.audioInput !== 'undefined' && viewResponse.audioInput !== null) {
                var audioInputServer = $.grep(servers, function(server) {
                    // Note: This check for session ID is due to an implementation issue
                    // in legacy services (pre-8.2) where the server property of the deprecated
                    // audioInput flag was incorrectly set to the session ID.  Additionally, the
                    // session ID was not set to the proper hex representation.
                    var sessionId = viewResponse.audioInput.server;
                    if(sessionId.substr(0,2) !== '0x') {
                        sessionId = '0x' + parseInt(sessionId, 10).toString(16);
                    }

                    return viewResponse.audioInput.server === server.id ||
                        sessionId === server.sessionId;
                })[0];
                audioInput = new EVWEB2.ViewAudioInputInfo(viewResponse.audioInput.id, audioInputServer);
            }
            return audioInput;
        };

        /**
         * Parses a view response into a {@link EVWEB2.View} instance.
         * @private
         * @param {Object} viewResponse The response object to process.
         * @param {EVWEB2.Server[]} servers The servers associated with the views.
         * @param {EVWEB2.ViewFolder[]} folders The folders associated with the views.
         * @return {EVWEB2.View} The view
         */
        var processViewResponse = function(viewResponse, servers, folders) {
            // Generate View objects
            var layout = processViewLayoutResponse(viewResponse.layout_info);

            // Create the list of ViewSlotItem objects
            var viewItemList = $.map(viewResponse.items, function(element/*, index*/) {
                var server = $.grep(servers, generateServerGrep(element.server))[0];

                var type = null;
                if(element.type === EVWEB2.ViewSlotItemTypes.camera) {
                    type = EVWEB2.Camera;
                }
                else if(element.type === EVWEB2.ViewSlotItemTypes.group) {
                    type = EVWEB2.Map;
                }
                else if(element.type === EVWEB2.ViewSlotItemTypes.audio) {
                    type = EVWEB2.AudioDevice;
                }

                return new EVWEB2.ViewSlotItem(element.id, server, type, element.slot, element.digitalPtzType);
            });

            // Find the view folder for the view
            var viewFolder = $.grep(folders, function(vf) {
                return vf.id === viewResponse.folder;
            })[0];

            var audioInput = processViewAudioInputResponse(viewResponse, servers);

            return new EVWEB2.View(viewResponse.name, viewFolder, viewItemList, viewResponse.layout, layout,
                                    viewResponse.order, audioInput, viewResponse.description);
        };

        /**
         * Parses a legacy view response into a {@link EVWEB2.View} instance.  Legacy responses are those that only
         * expose the deprecated "camera" property, not the current "items" property.
         * @private
         * @param {Object} viewResponse The response object to process.
         * @param {EVWEB2.Server[]} servers The servers associated with the views.
         * @param {EVWEB2.ViewFolder[]} folders The folders associated with the views.
         * @return {EVWEB2.View} The view
         */
        var processLegacyViewResponse = function(viewResponse, servers, folders) {
            // Generate View objects
            var layout = processViewLayoutResponse(viewResponse.layout_info);

            // Create the list of ViewCameraInfo objects
            var viewCameraInfoList = [];
            var i;
            for(i=0; i<viewResponse.cameras.length; i++) {
                var viewCameraInfo = null;
                var serverData = viewResponse.cameras[i];
                if(serverData !== null) {
                    var server = $.grep(servers, generateServerGrep(serverData.server))[0];
                    viewCameraInfo = new EVWEB2.ViewCameraInfo(serverData.camera, server, serverData.digitalPtzType);
                }
                viewCameraInfoList.push(viewCameraInfo);
            }

            // Find the view folder for the view
            var viewFolder = $.grep(folders, function(vf) {
                return vf.id === viewResponse.folder;
            })[0];

            var audioInput = processViewAudioInputResponse(viewResponse, servers);

            return new EVWEB2.View(viewResponse.name, viewFolder, viewCameraInfoList, viewResponse.layout, layout,
                                    viewResponse.order, audioInput, viewResponse.description);
        };

        /**
         *  The getViews function retrieves the server side views from the exacqVision servers.
         *  @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *   {@link EVWEB2.ResponseStatus} instance with the details of the response, an array of {@link EVWEB2.View}
         *   instances, and an array of {@link EVWEB2.ViewFolder} instances.
         *  @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server} instance or an array of
         *  {@link EVWEB2.Server} instances
         */
        this.getViews = function(callback, servers) {
            if(!$.isArray(servers)) {
                servers = [servers];
            }

            var onGetViewsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetViewsSuccess = function(data/*, textStatus, xhr*/) {
                var folders = parseFolders(data.Folders, "");

                // Generate View objects
                var viewsList = $.map(data.Views, function(element) {
                    if(typeof element.items !== 'undefined') {
                        return processViewResponse(element, servers, folders);
                    }
                    else {
                        return processLegacyViewResponse(element, servers, folders);
                    }
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, viewsList, folders);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var serversRequiringKey = $.grep(servers, function(element) {
                return element.isPassthroughServer() && element.service.isXss();
            });

            var settings = {
                success: onGetViewsSuccess,
                error: onGetViewsError,
                url: servers[0].service.url() + EVWEB2.urls.getViewList,
                data: data,
                traditional: true
            };

            if(serversRequiringKey.length > 0) {
                if(this.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                settings.data.key = this.resourceKey;
            }

            EVWEB2.ajax(settings, this);
        };

        /**
         * Parses a map response into a {@link EVWEB2.Map} instance.
         * @private
         * @param {Object} mapResponse The response object to process.
         * @param {EVWEB2.Server[]} servers The servers associated with the views.
         * @return {EVWEB2.Map} The map
         */
        var processMapResponse = function(mapResponse, servers) {
            var itemList = $.map(mapResponse.items, function(element) {
                var captionInfo = new EVWEB2.MapItemCaptionInfo(element.caption, element.color);

                return new EVWEB2.MapItemInfo(element.id, element.server, element.type, element.shape, element.x,
                    element.y, captionInfo, element.rotation, element.flags);
            });
            var server = $.grep(servers, function(element) {
                return element.sessionId.toString() === mapResponse.rootServer.toString();
            })[0];

            return new EVWEB2.Map(server.service, mapResponse.id, server, mapResponse.parent, mapResponse.name,
                mapResponse.description, itemList);
        };

        /**
         *  The getMaps function retrieves and combines the server side maps from the exacqVision servers.
         *  @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, an array of {@link EVWEB2.Map}
         *  instances.
         *  @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server} instance or an array of
         *  {@link EVWEB2.Server} instances
         */
        this.getMaps = function(callback, servers) {
            if(!$.isArray(servers)) {
                servers = [servers];
            }
            var onGetMapsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetMapsSuccess = function(data/*, textStatus, xhr*/) {
                // Generate Maps objects
                var mapsList = $.map(data.maps, function(element) {
                    if(typeof element.items !== 'undefined') {
                        return processMapResponse(element, servers);
                    }
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the maps list
                callback(successResponse, mapsList);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                }),
                output: 'json'
            };

            var settings = {
                success: onGetMapsSuccess,
                error: onGetMapsError,
                url: this.url() + EVWEB2.urls.map,
                data: data,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Parses a group response into a {@link EVWEB2.Group} instance.
         * @private
         * @param {Object} groupResponse The response object to process.
         * @return {EVWEB2.Group} The group
         */
        var processGroupResponse = function(groupResponse/*, servers*/) {
            var itemList = $.map(groupResponse.items, function(element) {
                return new EVWEB2.GroupItemInfo(element.id, element.server, element.type);
            });
            return new EVWEB2.Group(groupResponse.id, groupResponse.name,
                groupResponse.description, groupResponse.icon, itemList);
        };

        /**
        * Retrieves and combines the server side groups from the specified servers.
        *
        * @param {Function} callback Callback function to be executed when the call
        * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance with
        * the details of the response and an array of {@link EVWEB2.Group} instances.
        * @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server}
        * instance or an array of {@link EVWEB2.Server} instances.
        */
        this.getGroups = function (callback, servers) {
            if(!$.isArray(servers)) {
                servers = [servers];
            }
            var onGetGroupsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetGroupsSuccess = function(data/*, textStatus, xhr*/) {
                // Generate Groups objects
                var groupsList = $.map(data.groups, function(element) {
                    if(typeof element.items !== 'undefined') {
                        return processGroupResponse(element);
                    }
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the groups list
                callback(successResponse, groupsList);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                }),
                output: 'json'
            };

            var settings = {
                success: onGetGroupsSuccess,
                error: onGetGroupsError,
                url: this.url() + EVWEB2.urls.groups,
                data: data,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Recursively parses the folder object returned from the web service into an array of
         * {@link EVWEB2.TourFolder} instances.
         * @private
         * @param {Object} folderObj The folder object returned from the web service.
         * @param {String} folderName The name of the folder.
         * @param {String} parentId The parent folder's ID.
         * @return {EVWEB2.TourFolder[]} The tour folders
         */
        var parseTourFolders = function (folderObj, folderName, parentId) {
            var folders = [];
            if(typeof parentId === 'undefined') {
                parentId = folderObj.id;
            }
            folders.push(new EVWEB2.TourFolder(folderObj.id, folderName, parentId));
            var i;
            for(i=0; i<folderObj.folders.length; i++) {
                var subFolders = parseTourFolders(folderObj.folders[i], folderObj.folders[i].name, folderObj.id);
                folders = folders.concat(subFolders);
            }
            return folders;
        };

        /**
         *  The getTours function retrieves the server side tours from the exacqVision servers.
         *  @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *   {@link EVWEB2.ResponseStatus} instance with the details of the response, an array of {@link EVWEB2.Tour}
         *   instances, and an array of {@link EVWEB2.TourFolder} instances.
         *  @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server} instance or an array of
         *  {@link EVWEB2.Server} instances.
         */
        this.getTours = function(callback, servers) {
            if(!$.isArray(servers)) {
                servers = [servers];
            }

            var instance = this;

            var onGetToursError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetToursSuccess = function(data/*, textStatus, xhr*/) {
                var folders = parseTourFolders(data.folders, "");

                // Generate tour objects
                var tours = $.map(data.tours, function(element) {

                    // Create the list of TourItem objects
                    var tourItems = $.map(element.views, function(el/*, index*/) {
                        return new EVWEB2.TourItem(el.index, el.dwell, el.view);
                    });

                    // Find the folder for the tour
                    var folder = $.grep(folders, function(vf) {
                        return vf.id === element.folder_id;
                    })[0];

                    return new EVWEB2.Tour(element.name, folder, tourItems, element.description, instance);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, tours, folders);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var settings = {
                success: onGetToursSuccess,
                error: onGetToursError,
                url: servers[0].service.url() + EVWEB2.urls.tours,
                data: data,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Get the types of audio formats supported for the service
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.audioInputStreamFormatTypes}.
         */
        this.audioInputFormatTypes = function (callback) {
            if(availableAudioInputFormats.length > 0) {
                callback(new EVWEB2.ResponseStatus(true), availableAudioInputFormats);
                return;
            }

            var onAudioInputFormatTypesError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onAudioInputFormatTypesSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                availableAudioInputFormats = data.formats;
                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, availableAudioInputFormats);
            };

            var settings = {
                success: onAudioInputFormatTypesSuccess,
                error: onAudioInputFormatTypesError,
                url: this.url() + EVWEB2.urls.audio
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Get the types of video export formats available for the service
         * @param {Function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance and
         * an array of {@link EVWEB2.videoExportFormatTypes} detailing the available
         * video export formats.
         */
        this.videoExportFormatTypes = function (callback) {
            var onVideoExportFormatTypesErrors = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onVideoExportFormatTypesSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.formatTypes);
            };

            var settings = {
                success: onVideoExportFormatTypesSuccess,
                error: onVideoExportFormatTypesErrors,
                url: this.url() + EVWEB2.urls.videoexport,
                data: {
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Retrieves the overall status for the provided server.
         * @param {function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ServerStatus} instances,
         *  which detail the overall status of each server.
         * @param {EVWEB2.Server[]} servers The target servers
         */
        this.getServersStatus = function (callback, servers) {
            var onGetServerStatusError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetServerStatusSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var statuses = $.map(data.statuses, function(element) {
                    var server = $.grep(servers, function(serv) {
                        return serv.sessionId.toString() === element.sessionId.toString();
                    })[0];
                    return new EVWEB2.ServerStatus(server, element.loss, element.motion, element.alarm, element.serverStatus);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, statuses);
            };

            var params = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var settings = {
                success: onGetServerStatusSuccess,
                error: onGetServerStatusError,
                url: this.url() + EVWEB2.urls.status,
                data: params,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };


        /**
         * Get the health of the web service including uptime and basic information about current server connections
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance with the details of the response and a {@link EVWEB2.ServiceHealth}
         * instance.
         */
        this.getHealth = function(callback){
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data /*, textStatus, xhr*/){
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(data.success, data.errorText);
                var servers = [];
                // response signature including servers was deprecated, should always be empty 9.2.0+
                servers = $.map(data.servers, function (elem) {
                    var server =  new EVWEB2.ServerHealth(elem.serverID, elem.serverAddress,
                        elem.liveConnections, elem.searchConnections, elem.passthroughError,
                        elem.users);

                    // Stream info was added in 7.7.5700
                    if(elem.streams !== undefined) {
                        server.streams = new EVWEB2.ServerHealthStreamInfo(server.serverID,
                            elem.streams.compressed, elem.streams.uncompressed);
                    }
                    return server;
                });

                var streamInfo;
                if (data.streams !== undefined) {
                    streamInfo = new EVWEB2.ServiceHealthStreamInfo(data.streams.compressed, data.streams.uncompressed);
                }

                // Version and OS info were added in 7.1.8, so check to ensure they are present when
                // processing the request.
                var versionInfo;
                if(data.version !== undefined) {
                    versionInfo = new EVWEB2.ServiceHealthVersionInfo(data.version.service, data.version.evapi,
                        data.version.webServer);
                }

                var osInfo;
                if(data.os !== undefined) {
                    osInfo = new EVWEB2.ServiceHealthOsInfo(data.os.system, data.os.release, data.os.version,
                        data.os.machine, data.os.processor, data.os.node);
                }

                // Process and System info were added in 7.7.5700, so check to ensure they are present when
                // processing the request
                var processInfo;
                if(data.processes !== undefined) {
                    processInfo = $.map(data.processes, function(element) {
                        return new EVWEB2.ServiceHealthProcessInfo(element.name, element.cpu, element.ram, 
                            element.serverId);
                    });
                }

                var systemInfo;
                if(data.system !== undefined) {
                    systemInfo = new EVWEB2.ServiceHealthSystemInfo(data.system.cores, data.system.memory.total,
                        data.system.memory.available, data.system.cpu);
                }

                // Prepare the full health object
                var serviceHealth = new EVWEB2.ServiceHealth(data.uptime, servers, versionInfo, osInfo,
                    processInfo, systemInfo, streamInfo);
                callback(successResponse, serviceHealth);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.url() + EVWEB2.urls.health,
                data: {}
            };

            EVWEB2.ajax(settings, this);

        };

        /**
         * Get the timestamp of the last config update on each connected server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ConfigUpdateStatus} instances.
         * @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server} instance or an array of
         * {@link EVWEB2.Server} instances
         */

        this.getConfigUpdateStatus = function(callback, servers) {
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetConfigUpdateError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetConfigUpdateSuccess = function(data/*, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(true);
                var configStatuses = $.map(data.statuses, function(element) {
                    var lastUpdated = EVWEB2.util.IETF2Date(element.config.lastUpdated);

                    return new EVWEB2.ConfigUpdateStatus(element.sessionId, lastUpdated);
                });
                callback(successResponse, configStatuses);
            };

            var ids = $.map(servers, function(elem) {
                return elem.sessionId.toString();
            });
            var params = {
                's': ids
            };

            var settings = {
                success: onGetConfigUpdateSuccess,
                error: onGetConfigUpdateError,
                url: this.url() + EVWEB2.urls.configUpdateStatus,
                data: params,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };


        /**
         * Retrieves the event monitoring profiles for the provided servers.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.Server.ResponseStatus} instance and an array of {@link EVWEB2.EventMonitorProfile} instances.
         * @param {EVWEB2.Server[]} servers The servers to to retrieve associated event monitoring profiles.
         */
        this.getEventMonitorProfiles = function(callback, servers) {
            if(!$.isArray(servers)) {
                servers = [servers];
            }

            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Generate event monitoring profiles
                var profiles = $.map(data.profiles, function(element) {
                    var profile = new EVWEB2.EventMonitorProfile(instance, element.name, element.type, element.description,
                        element.showEventsList, element.showNewestEvent);

                    profile.events = $.map(element.events, function(event) {
                        var source = event.source;
                        var linkSource = new EVWEB2.EventMonitorLinkSource();
                        if(source !== null) {
                            linkSource = new EVWEB2.EventMonitorLinkSource(source.server, source.id, source.type,
                                source.extra, source.any);
                        }

                        var target = event.target;
                        var linkTarget = new EVWEB2.EventMonitorLinkTarget();
                        if(target !== null) {
                            linkTarget = new EVWEB2.EventMonitorLinkTarget(target.server, target.value, target.type,
                                target.extra, target.folders);
                        }

                        return new EVWEB2.EventMonitorLink(instance, profile, event.guid, linkSource, linkTarget,
                            event.priority, event.confirm, event.timeout, event.message);
                    });
                    return profile;
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, profiles);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.eventMonitoring,
                data: data,
                traditional: true
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Creates an event monitoring profile.  Note: a profile must have one (and only one)
         * {@link EVWEB2.EventMonitorLink} assigned since profiles without at least one event link are considered marked
         * for deletion.  If multiple event links are provided in the profile, only the first will be submitted.  All
         * others must be added through {@link EVWEB2.EventMonitorProfile.addLink}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.Server.ResponseStatus} instance and a modified instance of the provided
         * {@link EVWEB2.EventMonitorProfile}.
         * @param {EVWEB2.EventMonitorProfile} profile The event monitor profile to add.
         */
        this.createEventMonitorProfile = function(callback, profile) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Update the event monitoring profile
                var serverProfile = data.profile;
                profile.name = serverProfile.name;
                profile.type = serverProfile.type;
                profile.description = serverProfile.description;
                profile.showEventsList = serverProfile.showEventsList;
                profile.showNewest = serverProfile.showNewestEvent;

                // Update the events
                profile.events = $.map(serverProfile.events, function(event) {
                    var source = event.source;
                    var linkSource = new EVWEB2.EventMonitorLinkSource();
                    if(source !== null) {
                        linkSource = new EVWEB2.EventMonitorLinkSource(source.server, source.id, source.type,
                            source.extra, source.any);
                    }

                    var target = event.target;
                    var linkTarget = new EVWEB2.EventMonitorLinkTarget();
                    if(target !== null) {
                        linkTarget = new EVWEB2.EventMonitorLinkTarget(target.server, target.value, target.type,
                            target.extra, target.folders);
                    }

                    return new EVWEB2.EventMonitorLink(instance, profile, event.guid, linkSource, linkTarget,
                        event.priority, event.confirm, event.timeout, event.message);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, profile);
            };

            var link = profile.events[0];
            if(link === undefined) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No event link specified for profile.');
                callback(errorResponse);
            }

            var params = {
                name: profile.name,
                description: profile.description,
                type: profile.type,
                showEventsList: profile.showEventsList,
                showNewestEvent: profile.showNewest,
                eventConfirm: link.confirm,
                eventMessage: link.message,
                eventTimeout: link.timeout,
                eventPriority: link.priority
            };

            if(link.source !== null) {
                params.eventSourceId = link.source.id;
                params.eventSourceServer = link.source.server;
                params.eventSourceType = link.source.type;
                params.eventSourceAny = link.source.any;
                if (link.source.extraId.length > 0) {
                    params.eventSourceExtra = link.source.extraId;
                }

            }
            else {
                params.eventSourceServer = link.target.server;
                params.eventSourceType = EVWEB2.EventMonitorLinkSourceTypes.None;
            }
            if(link.target !== null) {
                params.eventTargetValue = link.target.value;
                params.eventTargetServer = link.target.server;
                params.eventTargetType = link.target.type;
                params.eventTargetFolders = link.target.folders;
                if (link.target.extraId.length > 0) {
                    params.eventTargetExtra = link.target.extraId;
                }
            }
            else {
                params.eventTargetServer = link.source.server;
                params.eventTargetType = EVWEB2.EventMonitorLinkTargetTypes.None;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.eventMonitoring,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, this);
        };

        /**
         * Retreive the list of cases from a list of servers
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.Case} instances.
         * @param {EVWEB2.Server[]} servers Array of servers to retrieve cases for.
         */
        this.getCases = function(callback, servers) {
            var instance = this;
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var cases = $.map(data.cases, function(element) {
                    var caseServers = $.grep(servers, function(el) {
                        return $.inArray(el.sessionId.toString(), element.servers) !== -1;
                    });
                    return new EVWEB2.Case(caseServers, element.guid, element.name, element.description,
                        element.bookmarks);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, cases);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.bookmarkCases,
                type: 'GET',
                data: data,
                traditional: true
            };

            if(this.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, this);
            }
            $.ajax(settings);
        };


        /**
         * Create a new case.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and an {@link EVWEB2.Case} instance.
         * @param {EVWEB2.Case} newCase The new case to create.  Note: {@link EVWEB2.Case.guid} is ignored by this
         * method and can be left blank.  The generated case will have a new guid applied.
         */
        this.createCase = function(callback, newCase) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var caseInfo = data['case'];
                var caseServers = $.grep(newCase.servers, function(el) {
                    return $.inArray(el.sessionId.toString(), caseInfo.servers) !== -1;
                });
                var bookmarkCase = new EVWEB2.Case(caseServers, caseInfo.guid, caseInfo.name, caseInfo.description,
                    caseInfo.bookmarks);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, bookmarkCase);
            };

            var data = {
                s: $.map(newCase.servers, function(element) {
                    return element.sessionId;
                }),
                name: newCase.name
            };

            if(newCase.description !== undefined) {
                data.description = newCase.description;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.bookmarkCases,
                type: 'POST',
                data: data,
                traditional: true
            };

            if(this.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, this);
            }
            $.ajax(settings);
        };

        /**
         * Retreive the list of bookmarks from a list of servers
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.Bookmark} instances.
         * @param {EVWEB2.Server[]} servers Array of servers to retrieve cases for.
         */
        this.getBookmarks = function(callback, servers) {
            var instance = this;
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var serverMap = {};
                $.each(servers, function(index, element) {
                    serverMap[element.sessionId] = element;
                });

                var bookmarks = $.map(data.bookmarks, function(element) {
                    var items = $.map(element.items, function(el) {
                        return new EVWEB2.BookmarkItem(serverMap[el.server], el.id, el.type);
                    });
                    var start = EVWEB2.util.IETF2Date(element.start);
                    var end = EVWEB2.util.IETF2Date(element.end);

                    return new EVWEB2.Bookmark(element.name, element.guid, start, end, items, element.description,
                        element.size, element['case']);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, bookmarks);
            };

            var data = {
                s: $.map(servers, function(element) {
                    return element.sessionId;
                })
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.bookmark,
                type: 'GET',
                data: data,
                traditional: true
            };

            if(this.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, this);
            }
            $.ajax(settings);
        };

        /**
         * Create a new bookmark.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and an {@link EVWEB2.Bookmark} instance.
         * @param {EVWEB2.Bookmark} bookmark The bookmark to create.  Note: {@link EVWEB2.bookmark.guid} is ignored by
         * this method and can be left blank.  The generated bookmark will have a new guid applied.  Note: If this
         * bookmark is assigned to a case, that case must be present on all of the servers referenced by the bookmark
         * items.
         */
        this.createBookmark = function(callback, bookmark) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var serverMap = {};
                $.each(bookmark.items, function(index, element) {
                    serverMap[element.server.sessionId] = element.server;
                });

                var items = $.map(data.bookmark.items, function(el) {
                    return new EVWEB2.BookmarkItem(serverMap[el.server], el.id, el.type);
                });
                var start = EVWEB2.util.IETF2Date(data.bookmark.start);
                var end = EVWEB2.util.IETF2Date(data.bookmark.end);

                var newBookmark = new EVWEB2.Bookmark(data.bookmark.name, data.bookmark.guid, start, end, items,
                    data.bookmark.description, data.bookmark.size, data.bookmark['case']);


                var remainingBookmarks = bookmark.items.length - 1;
                var addItemFailed = false;
                var onBookmarkItemAdded = function(response) {
                    remainingBookmarks--;
                    if(!response.success) {
                        addItemFailed = true;
                    }
                    if(remainingBookmarks <= 0) {
                        var errorText;
                        if(addItemFailed) {
                            errorText = 'Not all items were added to the bookmark.';
                        }
                        var successResponse = new EVWEB2.ResponseStatus(true, errorText);
                        callback(successResponse, newBookmark);
                    }
                };

                if(remainingBookmarks > 0) {
                    // Add the items.
                    var i;
                    for(i=1; i<bookmark.items.length; i++) {
                        newBookmark.addItem(onBookmarkItemAdded, bookmark.items[i]);
                    }
                }
                else {
                    var successResponse = new EVWEB2.ResponseStatus(true);
                    callback(successResponse, newBookmark);

                }
            };

            if(bookmark.items.length === 0) {
                var errorResponse = new EVWEB2.ResponseStatus(false, "A bookmark must have at least one item.");
                callback(errorResponse);
                return;
            }

            // Make the initial create request with the first item.
            var data = {
                s: bookmark.items[0].server.sessionId,
                name: bookmark.name,
                description: bookmark.description,
                start: EVWEB2.util.Date2IETF(bookmark.start),
                end: EVWEB2.util.Date2IETF(bookmark.end),
                itemId: bookmark.items[0].id,
                itemType: bookmark.items[0].type
            };
            if(bookmark.caseId !== null) {
                data["case"] = bookmark.caseId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.url() + EVWEB2.urls.bookmark,
                type: 'POST',
                data: data
            };

            if(instance.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves the configured friendly name from the web service.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response and the friendly name
         * of the web service.
         */
        this.friendlyName = function(callback) {

            var onSuccess = function(data/*, textStatus, xhr*/) {
                friendlyName = data.name;

                //Return the version number
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, friendlyName);
            };

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            //If the name has already been retrieved, return the cached name.
            if(friendlyName !== '') {
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, friendlyName);
                return;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.url() + EVWEB2.urls.serviceInfo
            };

            if(this.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, this);
            }
            $.ajax(settings);
        };

        /**
         * @callback onGetAddresses
         * @param {EVWEB2.ResponseStatus} response Success state of the response.
         * @param {EVWEB2.ServiceAddresses} addresses The service address configuration.
         * @param {String[]} throttledRelayMACs A list of mac addresses, corresponding to servers that would have
         * video connections throttled if the HTTP interface were to be used over the relay.
         * @ignore
         */
        /**
         * EVWEB2.Service.getAddresses retrieves the set of all network addresses for a web service.
         * Note that while all addresses are returned, a client may not be able to connect through all of
         * them depending on its own network situation.
         * @param {onGetAddresses} cb Function to be executed when the call completes.
         */
        this.getAddresses = function(cb) {
            var onSuccess = function(data/*, textStatus, xhr*/) {
                var internal;
                if (data.addresses.internal) {
                    internal = data.addresses.internal.map(function(addr) {
                        return new EVWEB2.NetworkAddress(addr.protocol, addr.host, addr.port);
                    });
                }

                var detected;
                if (data.addresses.detected) {
                    detected = data.addresses.detected.map(function(addr) {
                        return new EVWEB2.NetworkAddress(addr.protocol, addr.host, addr.port);
                    });
                }

                var external;
                if (data.addresses.external) {
                    external = new EVWEB2.NetworkAddress(
                        data.addresses.external.protocol,
                        data.addresses.external.host,
                        data.addresses.external.port
                    );
                }

                var relay;
                var throttled = [];
                if (data.addresses.relay) {
                    relay = new EVWEB2.NetworkAddress(
                        data.addresses.relay.address.protocol,
                        data.addresses.relay.address.host,
                        data.addresses.relay.address.port
                    );
                    throttled = data.addresses.relay.throttled;
                }

                var addresses = new EVWEB2.ServiceAddresses(
                    internal,
                    detected,
                    external,
                    relay
                );
                cb(new EVWEB2.ResponseStatus(true), addresses, throttled);
            };

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                cb(new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr)));
            };

            EVWEB2.ajax({
                url: this.url() + EVWEB2.urls.addresses,
                success: onSuccess,
                error: onError
            }, this);
        };
    };

    /**
     * EVWEB2.NetworkAddress points to a network endpoint.
     * @param {String} protocol The protocol.
     * @param {String} hostname The hostname.
     * @param {Number} port The port.
     * @class
     * @category Service
     */
    EVWEB2.NetworkAddress = function(protocol, hostname, port) {
        /**
         * The protocol.
         * @type {String}
         */
        this.protocol = protocol || 'http';

        /**
         * The protocol.
         * @type {String}
         */
        this.hostname = hostname || '';

        /**
         * The protocol.
         * @type {String}
         */
        this.port = port || (this.protocol === 'https' ? 443 : 80);
    };

    /**
     * EVWEB2.ServiceAddresses describes the network addresses on which a service can be reached.
     * @param {EVWEB2.NetworkAddress[]} internal The set of configured internal addresses.
     * @param {EVWEB2.NetworkAddress[]} detected The set of detected external addresses.
     * @param {EVWEB2.NetworkAddress} external The configured external address, if set.
     * @param {EVWEB2.NetworkAddress} relay The network relay address, if configured.
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceAddresses = function(internal, detected, external, relay) {
        /**
         * The set of configured internal network addresses.
         * @type {EVWEB2.NetworkAddress[]}
         */
        this.internal = internal || [];

        /**
         * The set of detected external addresses.
         * @type {EVWEB2.NetworkAddress[]}
         */
        this.detected = detected || [];

        /**
         * The externally accessible address, if configured.
         * @type {EVWEB2.NetworkAddress}
         */
        this.external = external || null;

        /**
         * The network relay address, if configured.
         * @type {EVWEB2.NetworkAddress}
         */
        this.relay = relay || null;
    };
}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Enumeration of HTTP policies enforced while HTTPS is configured.
     * @enum {Number}
     * @readonly
     * @category Service
     */
    EVWEB2.httpPolicy = {
        /**
         * Conduct HTTP traffic as usual.
         */
        none: 0,
        /**
         * Redirect all HTTP traffic to HTTPS.
         */
        redirect: 1,
        /**
         * Do not accept incoming connections on the HTTP port.
         */
        disable: 2
    };

    /**
     * Container for basic SSl/TLS configuration information.
     * @class
     * @param {String} [commonName=''] The common name (CN) the certificate is configured for (if any)
     * @param {String[]} [domains=[]] The list of all domains the certificate is configured for (if any) (CN + SANs)
     * @param {Boolean} [valid=false] Flag indicating if the configuration is valid
     * @param {Date|null} [expiration=null] The date the certificate expires
     * @category Service
     */
    EVWEB2.BasicSSLConfig = function(commonName, domains, valid, expiration) {

        /**
         * The common name configured
         * @type {String}
         */
        this.commonName = '';

        /**
         * The domain names configured (CN + SANs)
         * @type {String[]}
         */
        this.domains = [];

        /**
         * Flag indicating if the SSL configuration/certificate is valid
         * @type {Boolean}
         */
        this.valid = false;

        /**
         * The expiration date of the certificate
         * @type {Date}
         */
        this.expiration = null;

        if(commonName !== undefined) {
            this.commonName = commonName;
        }
        if(domains !== undefined) {
            this.domains = domains;
        }
        if(valid !== undefined) {
            this.valid = valid;
        }
        if(expiration !== undefined) {
            this.expiration = expiration;
        }
    };

    /**
     * The external SSL config object is a container for information related to SSL configurations
     * that use an externally provided private key and certificate (e.g. DigiCert)
     * @class
     * @param {Boolean} enabled Flag indicating whether SSL support is configured and enabled
     * @param {EVWEB2.BasicSSLConfig|null} basicConfig Common SSL configuration. If disabled this may be null.
     * @category Service
     */
    EVWEB2.ExternalSSLConfig = function(enabled, basicConfig) {
        /**
         * Whether SSL/TLS is enabled. If this is false none of the other parameters have
         * any meaning.
         * @type {Boolean}
         */
        this.enabled = enabled;

        /**
         * Common SSL configuration information
         * @type {EVWEB2.BasicSSLConfig|null}
         */
        this.basic = basicConfig;
    };

    /**
     * Definition of the possible SSL config types
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.sslConfigType = {
        /**
         * SSL/TLS is not configured by the service
         */
        none: 0,
        /**
         * An externally-provided configuration is enabled
         */
        external: 1,
        /**
         * An ACME server configuration is enabled
         */
        acme: 2
    };

    /**
     * Definition of ACME request status codes
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.acmeSSLRequestStatus = {
        /**
         * Request is in-flight and still pending
         */
        pending: 1,
        /**
         * Certificate was issued and configured
         */
        success: 2,
        /**
         * The HTTP challenge submitted to the ACME server failed
         */
        httpChallengeFailed: -1,
        /**
         * Failed to verify the requested domain maps to the service IP
         */
        localDomainVerifyFailed: -2,
        /**
         * Network problem (e.g. unreachable ACME server)
         */
        networkError: -3,
        /**
         * Too many requests made in a row, temporarily rate-limited by ACME server. Try again later
         */
        rateLimited: -4,
        /**
         * ACME account data is corrupted
         */
        accountDataCorrupt: -5,
        /**
         * ACME server has rejected the domain as invalid
         */
        invalidDomain: -6,
        /**
         * An ACME protocol error occurred
         */
        protocolError: -7,
        /**
         * Unknown error. Consult the service logs
         */
        unknownError: -8
    };

    /**
     * The ACME SSL config object is a container for information related to SSL configurations that
     * use an ACME server to automatically manage SSL certificates and private keys (e.g. Let's Encrypt
     * is an ACME server).
     * @class
     * @param {Boolean} enabled Flag indicating whether SSL support is configured and enabled
     * @param {EVWEB2.BasicSSLConfig|null} basicConfig Common SSL configuration. If disabled this may be null.
     * @param {Boolean} [autoRenew=false] Flag indicating whether auto-renewal is enabled, if true the
     * service will attempt to renew the certificate before it expires.
     * @param {String} [acmeServer=null] The ACME server used to provision the certificate. If not provided
     * this defaults to the Let's Encrypt production server's.
     * @category Service
     */
    EVWEB2.AcmeSSLConfig = function(enabled, basicConfig, autoRenew, acmeServer) {
        /**
         * Whether SSL/TLS is enabled. If this is false none of the other parameters have
         * any meaning.
         * @type {Boolean}
         */
        this.enabled = enabled;

        /**
         * Common SSL configuration information
         * @type {EVWEB2.BasicSSLConfig|null}
         */
        this.basic = basicConfig;

        /**
         * Flag indicating whether auto-renewal is enabled
         * @type {Boolean}
         */
        this.autoRenew = false;

        /**
         * The ACME server (url) used to provision the certificate
         * @type {String}
         */
        this.acmeServer = null;

        if (autoRenew !== undefined) {
            this.autoRenew = autoRenew;
        }
        if (acmeServer !== undefined) {
            this.acmeServer = acmeServer;
        }
    };

    /**
     * The service server configuration object acts as a container for all configuration information associated with a
     * server on a service.
     * @param {Number} [id=0] The server ID for the server.
     * @param {String} [address=''] The address for the server.
     * @param {Number} [port=0] The port for the server.
     * @param {Number} [timeout=0] The timeout duration for server requests.
     * @param {Boolean} [passthrough=false] Whether the server is configured as a passthrough server.
     * @param {String} [username=''] The username for passthrough connections to the server.
     * @param {String} [password=''] The password for passthrough connections to the server.
     * @param {Boolean} [autopopulate=false] Whether the server is configured to autopopulate on load.
     * @param {Boolean} [powerUser=false] Whether the server has a power user process configured.  Power user processes
     *   are used to enable functionality outside of the current session, for example, push notifications.
     * @param {String} [powerUserUsername=''] The username for the power user process connection to the server.
     * @param {String} [powerUserPassword=''] The password for the power user process connection to the server.
     * @param {String} [name=''] The name of the server if known.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceServerConfiguration = function(id, address, port, timeout, passthrough, username, password,
                                                 autopopulate, powerUser, powerUserUsername, powerUserPassword, name) {
        /**
         * The server ID for the server.
         * @type {Number}
         */
        this.id = 0;

        /**
         * The address for the server.
         * @type {String}
         */
        this.address = '';

        /**
         * The port for the server.
         * @type {Number}
         */
        this.port = 0;

        /**
         * The timeout duration for server requests.
         * @type {Number}
         */
        this.timeout = 0;

        /**
         * Whether the server is configured as a passthrough server.
         * @type {Boolean}
         */
        this.passthrough = false;

        /**
         * The username for passthrough connections to the server.
         * @type {String}
         */
        this.username = '';

        /**
         * The password for passthrough connections to the server.
         * @type {String}
         */
        this.password = '';

        /**
         * Whether the server is configured to autopopulate on load.
         * @type {Boolean}
         * @deprecated This value is no longer processed and can be ignored.
         */
        this.autopopulate = false;

        /**
         * Whether the server has a power user process configured.  Power user processes are used
         * to enable functionality outside of the current session, for example, push notifications.
         * @type {Boolean}
         */
        this.powerUser = false;

        /**
         * The username for the power user process connection to the server.
         * @type {String}
         */
        this.powerUserUsername = '';

        /**
         * The password for the power user process connection to the server.
         * @type {String}
         */
        this.powerUserPassword = '';

        /**
         * The (friendly) name of the server.
         * @type {string}
         */
        this.name = '';

        //Assign the constructor values
        if(id !== undefined) {
            this.id = id;
        }
        if(address !== undefined) {
            this.address = address;
        }
        if(port !== undefined) {
            this.port = port;
        }
        if(timeout !== undefined) {
            this.timeout = timeout;
        }
        if(passthrough !== undefined) {
            this.passthrough = passthrough;
        }
        if(username !== undefined) {
            this.username = username;
        }
        if(password !== undefined) {
            this.password = password;
        }
        if(autopopulate !== undefined) {
            this.autopopulate = autopopulate;
        }
        if(powerUser !== undefined) {
            this.powerUser = powerUser;
        }
        if(powerUserUsername !== undefined) {
            this.powerUserUsername = powerUserUsername;
        }
        if(powerUserPassword !== undefined) {
            this.powerUserPassword = powerUserPassword;
        }
        if(name !== undefined) {
            this.name = name;
        }
    };

    /**
     * The service remote server configuration object acts as a container for all configuration information associated
     * with a remote server on a service.
     * @param {Number} [id=0] The server ID for the server.
     * @param {String} [identifier=''] The identifier for the server.
     * @param {Number} [timeout=0] The timeout duration for server requests.
     * @param {Boolean} [passthrough=false] Whether the server is configured as a passthrough server.
     * @param {String} [username=''] The username for passthrough connections to the server.
     * @param {String} [password=''] The password for passthrough connections to the server.
     * @param {Boolean} [autopopulate=false] Whether the server is configured to autopopulate on load.
     * @param {Boolean} [powerUser=false] Whether the server has a power user process configured.  Power user processes
     * are used to enable functionality outside of the current session, for example, push notifications.
     * @param {String} [powerUserUsername=''] The username for the power user process connection to the server.
     * @param {String} [powerUserPassword=''] The password for the power user process connection to the server.
     * @param {String} [name=''] The name of the server if known.
     * @class
     * @constructor
     * @internal
     * @category Service
     */
    EVWEB2.ServiceRemoteServerConfiguration = function(id, identifier, timeout, passthrough, username, password,
                                                 autopopulate, powerUser, powerUserUsername, powerUserPassword, name) {
        /**
         * The server ID for the server.
         * @type {Number}
         */
        this.id = 0;

        /**
         * The identifier for the server.
         * @type {String}
         */
        this.identifier = '';

        /**
         * The timeout duration for server requests.
         * @type {Number}
         */
        this.timeout = 0;

        /**
         * Whether the server is configured as a passthrough server.
         * @type {Boolean}
         */
        this.passthrough = false;

        /**
         * The username for passthrough connections to the server.
         * @type {String}
         */
        this.username = '';

        /**
         * The password for passthrough connections to the server.
         * @type {String}
         */
        this.password = '';

        /**
         * Whether the server is configured to autopopulate on load.
         * @type {Boolean}
         */
        this.autopopulate = false;

        /**
         * Whether the server has a power user process configured.  Power user processes are used
         * to enable functionality outside of the current session, for example, push notifications.
         * These processes are never accessed by a client of the web service.
         * @type {Boolean}
         */
        this.powerUser = false;

        /**
         * The username for the power user process connection to the server.
         * @type {String}
         */
        this.powerUserUsername = '';

        /**
         * The password for the power user process connection to the server.
         * @type {String}
         */
        this.powerUserPassword = '';
        
        /**
         * The (friendly) name of the server.
         * @type {string}
         */
        this.name = '';

        //Assign the constructor values
        if(id !== undefined) {
            this.id = id;
        }
        if(identifier !== undefined) {
            this.identifier = identifier;
        }
        if(timeout !== undefined) {
            this.timeout = timeout;
        }
        if(passthrough !== undefined) {
            this.passthrough = passthrough;
        }
        if(username !== undefined) {
            this.username = username;
        }
        if(password !== undefined) {
            this.password = password;
        }
        if(autopopulate !== undefined) {
            this.autopopulate = autopopulate;
        }
        if(powerUser !== undefined) {
            this.powerUser = powerUser;
        }
        if(powerUserUsername !== undefined) {
            this.powerUserUsername = powerUserUsername;
        }
        if(powerUserPassword !== undefined) {
            this.powerUserPassword = powerUserPassword;
        }
        if(name !== undefined) {
            this.name = name;
        }
    };

    /**
     * The service remote server settings configuration object acts as a container for all
     * configuration information associated with handling remote servers on the web service.
     * @param {Boolean} [enabled=false] Whether remote servers support is enabled.
     * @param {Number} [port=35111] The listening port for incoming remote server connections.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceRemoteServerSettingsConfiguration = function(enabled, port) {
        /**
         * Whether remote servers support is enabled.
         * @type {boolean}
         */
        this.enabled = false;

        /**
         * The listening port for incoming remote server connections.
         * @type {number}
         */
        this.port = 35111;
        
        if(enabled !== undefined) {
            this.enabled = enabled;
        }
        if(port !== undefined) {
            this.port = port;
        }
    };    

    /**
     * Definitions for the logging levels for a service configuration
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.serviceLoggingLevels = {
        /**
         * Not set
         */
        NOTSET: -1,
        /**
         * Error
         */
        ERROR: 0,
        /**
         * Warning
         */
        WARNING: 1,
        /**
         * Info
         */
        INFO: 2,
        /**
         * Debug
         */
        DEBUG: 3
    };

    /**
     * Definitions for the log file interval types
     * @enum {String}
     * @readonly
     * @category Service
     */
    EVWEB2.serviceLogFileIntervalTypes = {
        /**
         * None
         */
        none : '',
        /**
         * Minute
         */
        minute : 'M',
        /**
         * Hour
         */
        hour : 'H',
        /**
         * Day
         */
        day : 'D',
        /**
         * Week
         */
        week : 'W'
    };

    /**
     * The service log file configuration object acts as a container for all configuration information associated
     * with the log file for the service.
     * @param {Number} [interval=0] The interval age of the log file.
     * @param {EVWEB2.serviceLogFileIntervalTypes} [type=EVWEB2.serviceLogFileIntervalTypes.none] The interval type of
     * the log file age.
     * @param {Number} [count=0] The number of backups to be used for this log file.
     * @param {EVWEB2.serviceLoggingLevels} [level=EVWEB2.serviceLoggingLevels.NOTSET] The logging level of the web
     * service.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceLogFileConfiguration = function(interval, type, count, level) {
        /**
         * The interval age of the log file
         * @type {Number}
         */
        this.interval = 0;

        /**
         * The interval type of the log file age.
         * @type EVWEB2.serviceLogFileIntervalTypes
         */
        this.type = EVWEB2.serviceLogFileIntervalTypes.none;

        /**
         * The number of backups to be used for this log file.
         * @type {Number}
         */
        this.count = 0;

        /**
         * The logging level of the web service.
         * @type {EVWEB2.serviceLoggingLevels|number}
         */
        this.level = EVWEB2.serviceLoggingLevels.NOTSET;

        //Assign the constructor values
        if(interval !== undefined) {
            this.interval = interval;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(count !== undefined) {
            this.count = count;
        }
        if(level !== undefined) {
            this.level = level;
        }
    };

    /**
     * The port configuration object acts as a container for all port configuration
     * information associated with the web service.
     * @param {Number} [http=80] The listening port for HTTP traffic.
     * @param {Number} [https=443] The listening port for HTTPS traffic.
     * @param {Number} [ws=8082] The listening port for Web Socket traffic.
     * @param {Number} [wss=8083] The listening port for Secure Web Socket traffic.
     * @param {EVWEB2.httpPolicy} [httpPolicy=EVWEB2.httpPolicy.none] The policy to enforce for HTTP traffic when HTTPS
     * is configured.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServicePortsConfiguration = function(http, https, ws, wss, httpPolicy) {
        /**
         * The listening port for HTTP traffic.
         * @type {number}
         */
        this.http = http || 80;

        /**
         * The listening port for HTTPS traffic.
         * @type {number}
         */
        this.https = https || 443;

        /**
         * The listening port for Web Socket traffic.
         * @type {number}
         */
        this.ws = ws || 8082;

        /**
         * The listening port for Secure Web Socket traffic.
         * @type {number}
         */
        this.wss = wss || 8083;

        /**
         * The policy to enforce for HTTP traffic when HTTPS is configured.
         * @type {EVWEB2.httpPolicy}
         */
        this.httpPolicy = httpPolicy || EVWEB2.httpPolicy.none;
    };

    /**
     * The update settings configuration object acts as a container for all
     * update configuration information associated with the web service.
     * @param {String} [url=''] The URL location of the downloads info file.
     * @param {Number} [timeout=0] The timeout duration for requesting the downloads info file.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceUpdateConfiguration = function(url, timeout) {
        /**
         * The URL location of the downloads info file.
         * @type {string}
         */
        this.url = '';

        /**
         * The timeout duration for requesting the downloads info file.
         * @type {number}
         */
        this.timeout = 0;

        if(url !== undefined) {
            this.url = url;
        }
        if(timeout !== undefined) {
            this.timeout = timeout;
        }
    };

    /**
     * The basic service settings configuration object acts as a container for all
     * basic configuration information associated with the web service.
     * @param {String} [name=""] The friendly name of the service.
     * @param {String} [url=""] The external URL for the service.
     * @param {EVWEB2.ServicePortsConfiguration} [ports=null] The ports configuration for the service.
     * @param {Boolean} [csrf=true] Whether to enable CSRF protection for state-changing calls.
     * @param {Number} [loginExpiration=30] The number of days before a saved login expires.
     * @param {Number} [inactivityTimeout=0] The default inactivity timeout to use if not set (disabled=0).
     * @param {Boolean} [autocomplete=false] Whether to allow input elements in web service HTML to autocomplete.
     * @param {Boolean} [relay=false] Whether to enable external relay URL.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceBasicConfiguration = function(name, url, ports, csrf, loginExpiration, inactivityTimeout,
                                                autocomplete, relay) {
        /**
         * The friendly name of the service.
         * @type {string}
         */
        this.name = '';

        /**
         * The external URL for the service.
         * @type {string}
         */
        this.url = '';

        /**
         * The ports configuration for the service.
         * @type {EVWEB2.ServicePortsConfiguration}
         */
        this.ports = null;

        /**
         * Whether to enable CSRF protection for state-changing calls.
         * @type {boolean}
         */
        this.csrf = true;

        /**
         * The number of days before a saved login expires.
         * @type {number}
         */
        this.loginExpiration = 30;

        /**
         * The number of days before a saved login expires.
         * @type {number}
         */
        this.inactivityTimeout = 0;

        /**
         * Whether to allow input elements in web service HTML to autocomplete.
         * @type {Boolean}
         */
        this.autocomplete = autocomplete || false;

        /**
         * Whether to enable external relay URL.
         * @type {Boolean}
         */
        this.relay = relay || false;

        if(name !== undefined) {
            this.name = name;
        }
        if(url !== undefined) {
            this.url = url;
        }
        if(ports !== undefined) {
            this.ports = ports;
        }
        if(csrf !== undefined) {
            this.csrf = csrf;
        }
        if(loginExpiration !== undefined) {
            this.loginExpiration = loginExpiration;
        }
        if(inactivityTimeout !== undefined) {
            this.inactivityTimeout = inactivityTimeout;
        }

    };

    /**
     * An enum defining the types of external authentication available.
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.serviceExternalAuthTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Enterprise Manager
         */
        esm: 1
    };

    /**
     * The service external auth configuration object acts as a container for all configuration information associated
     * with external authentication.
     * @param {EVWEB2.serviceExternalAuthTypes} [type=EVWEB2.ServiceExternalAuthTypes.none] The type of external
     * authentication enabled.
     * @param {Object} [options={}] An object containing the authentication-specific information.
     *    EVWEB2.ServiceExternalAuthTypes.none: No options are required
     *    EVWEB2.ServiceExternalAuthTypes.esm: Requires the following options
     *      * options.url
     *      * options.user
     *      * options.password
     * @param {String} [options.url=''] The URL to the ESM instance providing authentication.
     * @param {String} [options.user=''] The admin username to the ESM instance, providing a master server list and
     *      power user process credentials.
     * @param {String} [options.password=''] The admin password to the ESM instance, providing a master server list
     *      and power user process credentials.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceExternalAuthConfiguration = function(type, options) {
        /**
         * The type of external authentication enabled.
         * @type EVWEB2.serviceExternalAuthTypes
         */
        this.type = EVWEB2.serviceExternalAuthTypes.none;

        /**
         * The url to the ESM instance when using ESM authentication ({@link EVWEB2.serviceExternalAuthTypes.esm}).
         * @type String
         */
        this.url = '';


        /**
         * The admin username to the ESM instance when using ESM authentication
         * ({@link EVWEB2.serviceExternalAuthTypes.esm}), providing a master server list and power user process
         * credentials.
         * @type String
         */
        this.user = '';

        /**
         * The admin password to the ESM instance when using ESM authentication
         * ({@link EVWEB2.serviceExternalAuthTypes.esm}), providing a master server list and power user process
         * credentials.
         * @type String
         */
        this.password = '';

        //Assign the constructor values
        if(type !== undefined) {
            this.type = type;
        }
        if(options !== undefined) {
            // Process the type-specific properties
            if(this.type === EVWEB2.serviceExternalAuthTypes.esm) {
                if(options.url !== undefined) {
                    this.url = options.url;
                }
                if(options.user !== undefined) {
                    this.user = options.user;
                }
                if(options.password !== undefined) {
                    this.password = options.password;
                }
            }
        }
    };

    /**
     * Definition of the config access restriction levels that may be enforced.
     * @enum {Number}
     * @readonly
     * @category Service
     */
    EVWEB2.configAccessLevel = {
        /**
         * Clients from any point in the network may access the config.
         */
        all: 0,
        /**
         * Disallow config access to requests coming over the relay.
         */
        noRelay: 1,
        /**
         * Disallow config access to requests not over the loopback device.
         */
        localhostOnly: 2
    };

    /**
     * The admin configuration object acts as a container for all admin configuration
     * information associated with the web service.
     * @param {String} username The username of the configuration administration account.
     * @param {String} [password=""] The password of the configuration administration account.
     * @param {EVWEB2.configAccessLevel} [accessLevel=EVWEB2.configAccessLevel.noRelay] The level of
     * config access restriction to be applied.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceAdminConfiguration = function(username, password, accessLevel) {
        /**
         * The username of the configuration administration account.
         * @type {String}
         */
        this.username = username;

        /**
         * The password of the configuration administration account.
         * @type {String}
         */
        this.password = '';

        /**
         * The level of config access restriction being enforced.
         *
         * @type {EVWEB2.configAccessLevel}
         */
        this.accessLevel = EVWEB2.configAccessLevel.noRelay;

        /**
         * DEPRECATED. Control access restriction via {@link this.accessLevel} instead.
         * Whether to restrict access to the service configuration to requests originating from localhost.
         * @type {Boolean}
         * @deprecated
         */
        this.localhostRestriction = false;

        if(password !== undefined) {
            this.password = password;
        }
        if (accessLevel !== undefined) {
            if (typeof accessLevel !== 'boolean') {
                this.accessLevel = accessLevel;
                this.localhostRestriction = accessLevel === EVWEB2.configAccessLevel.localhostOnly;
            } else {
                // account for legacy uses of constructor where 3rd param was bool localhostRestriction
                this.localhostRestriction = accessLevel;
                this.accessLevel = accessLevel ?
                    EVWEB2.configAccessLevel.localhostOnly :
                    EVWEB2.configAccessLevel.noRelay;
            }
        }
    };

    /**
     * The service configuration object acts as a wrapper for all service configuration methods.
     * @param {EVWEB2.Service} service The containing service for this configuration.
     * @class
     * @category Service
     */
    EVWEB2.ServiceConfig = function(service) {

        /**
         * The containing service for this configuration.
         * @type {EVWEB2.Service}
         */ 
        this.service = service;

        /**
         * Reference to the service configuration auth token.  If not specified, all configuration
         * methods will fail. This value is modified by {@link EVWEB2.ServiceConfig#getAuthorization|getAuthorization()}
         * and {@link EVWEB2.ServiceConfig#destroyAuthorization|destroyAuthorization()}.
         * @type {String|null}
         */
        this.authToken = null;

        /**
         * Configuration status information
         * @type {EVWEB2.ServiceStatus}
         */
        this.status = new EVWEB2.ServiceStatus(this);

        /**
         * The interval duration for polling attempts for determining when the service has restarted.
         * @private
         * @type {Number}
         */
        var restartPollingInterval = 3000;

        /**
         * The number of poll attempts before returning an error on service restart.
         * @private
         * @type {Number}
         */
        var restartPollingMaxRetries = 10;

        /**
         * The number of successful subsequent polls before returning a success on service restart.
         * @private
         * @type {Number}
         */
        var restartPollingConfirmationsRequired = 5;

        /**
         * The updated ports values.  This is used to indicate that the web service's listening ports
         * have changed and used by {@link EVWEB2.ServiceConfig.restart} to properly redirect to the new
         * location.
         * @private
         * @type {EVWEB2.ServicePortsConfiguration}
         */
        var updatedPorts = null;


        /**
         * Used to indicate that the web service's SSL configuration has changed and is used by
         * {@link EVWEB2.ServiceConfig.restart} to properly redirect to the new location (particularly
         * when deleting the SSL configuration and switching from https to http}.
         * @private
         * @type {string|undefined}
         */
        var updatedProtocol;

        /**
         * Get authorization code for configuration information.  The result of this call is used by all methods
         * in {@link EVWEB2.ServiceConfig} and must be provided before any other requests are made.  Note: the default
         * request method for this function is POST, which will not work in XSS situations.  While its use is not
         * recommended, the useGetRequest parameter switches the use to a GET request.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and the {@link EVWEB2.ServiceConfig}
         * instance.
         * @param {String} username The administration username for the service
         * @param {String} password The administration password for the service
         */
        this.getAuthorization = function (callback, username, password) {
            var config = this;
    
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };
    
            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                config.authToken = data.auth;
    
                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the authorization token
                callback(successResponse, config);
            };
    
            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigToken,
                type: 'POST',
                dataType: 'json',
                data: {
                    u: username,
                    p: password
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Destroys the stored authorization code previously retrieved by {@link EVWEB2.ServiceConfig.getAuthorization}.
         * While authorization codes will expire after a set duration, it is recommended that all authorization codes
         * are manually destroyed.  Note: the default request method for this function is POST, which will not work in
         * XSS situations.  While its use is not recommended, the useGetRequest parameter switches the use to a GET
         * request.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and the {@link EVWEB2.ServiceConfig} instance.
         */
        this.destroyAuthorization = function (callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'No authorization to destroy.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                config.authToken = null;

                var successResponse = new EVWEB2.ResponseStatus(true);

                callback(successResponse, config);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigToken,
                type: 'DELETE',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Retrieves the configuration of all servers configured on the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ServiceServerConfiguration} instances.
         */
        this.getServers = function(callback) {
            var config = this;
    
            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };
    
            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var servers = $.map(data.servers, function(element) {
                    return new EVWEB2.ServiceServerConfiguration(element.id, element.address, element.port,
                        element.timeout, element.passthrough, element.user, element.password,
                        false, element.powerUser, element.powerUserUsername, element.powerUserPassword,
                        element.friendlyName);
                });
    
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, servers);
            };
    
            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigServers,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);            
        };        

        /**
         * Adds a server configuration to the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the added {@link EVWEB2.ServiceServerConfiguration} instance.
         * @param {EVWEB2.ServiceServerConfiguration} server The server configuration to add.
         */
        this.addServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                server.id = data.id;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigServers,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    address: server.address,
                    port: server.port,
                    passthrough: server.passthrough,
                    user: server.username,
                    password: server.password,
                    timeout: server.timeout,
                    powerUser: server.powerUser,
                    powerUserUsername: server.powerUserUsername,
                    powerUserPassword: server.powerUserPassword
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Updates a server configuration on the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the updated {@link EVWEB2.ServiceServerConfiguration} instance.
         * @param {EVWEB2.ServiceServerConfiguration} server The server configuration to update.
         */
        this.updateServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigServers,
                type: 'PUT',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    id: server.id,
                    address: server.address,
                    port: server.port,
                    passthrough: server.passthrough,
                    user: server.username,
                    password: server.password,
                    timeout: server.timeout,
                    powerUser: server.powerUser,
                    powerUserUsername: server.powerUserUsername,
                    powerUserPassword: server.powerUserPassword
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Removes a server configuration from the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the deleted {@link EVWEB2.ServiceServerConfiguration} instance.
         * @param {EVWEB2.ServiceServerConfiguration} server The server configuration to delete.
         */
        this.deleteServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigServers,
                type: 'DELETE',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    id: server.id
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Import a client's XDV configuration.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to
         * be applied, and a list of {@link EVWEB2.ServiceServerConfiguration} instances detailing the new server
         * configuration.
         * @param {String|Node} xdvData Either the XDV data to import in a base-64 encoded string form or a
         * jQuery nodeset of an file input populated with the selected XDV file.
         * @param {Boolean} [dataIsUrl=false] Whether the xdvData parameter is a URL to the XDV data.
         */
        this.importXdv = function(callback, xdvData, dataIsUrl) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var servers = $.map(data.servers, function(element) {
                    return new EVWEB2.ServiceServerConfiguration(element.id, element.address, element.port,
                        element.timeout, element.passthrough, element.user, element.password,
                        false, element.powerUser, element.powerUserUsername, element.powerUserPassword);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, servers);
            };

            if(dataIsUrl === undefined) {
                dataIsUrl = false;
            }

            var data = {
                auth: config.authToken
            };
            if(dataIsUrl) {
                data.url = xdvData;
            }
            else {
                data.ini = xdvData;
            }

            if(data.ini instanceof $) {
                EVWEB2.util.internal.XSSPost(service.url() + EVWEB2.urls.serviceConfigServersXdv, data);
                if(typeof callback !== 'undefined') {
                    var onGetServersResponse = function(response, servers) {
                        callback(response, true, servers);
                    };

                    service.config.getServers(onGetServersResponse);
                }
            }
            else {
                var settings = {
                    success: onSuccess,
                    error: onError,
                    url: config.service.url() + EVWEB2.urls.serviceConfigServersXdv,
                    type: 'POST',
                    dataType: 'json',
                    data: data
                };
                EVWEB2.ajax(settings, config.service);
            }
        };

        /**
         * Export the XDV file for the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and the text content of
         * the INI file.  Note: the text content of the INI file will only be returned if
         * downloadName is undefined.
         * @param {String} [downloadName] The file name to specify for the raw binary content.  If
         * this value is set, the XDV content will be returned as a binary file with the
         * Content-Disposition header set to attachment, prompting a file download.
         */
        this.exportXdv = function (callback, downloadName) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.ini);
            };

            var data = {
                auth: config.authToken
            };
            var url = config.service.url() + EVWEB2.urls.serviceConfigServersXdv;

            if(downloadName !== undefined) {
                // Update window.location to prompt the download.
                data.filename = downloadName;
                var query = $.map(data, function(value, key) {
                    return key + '=' + value;
                });
                window.location = url + '?' + query.join('&');
                onSuccess(new EVWEB2.ResponseStatus(true));
            }
            else {
                // Send the normal request
                var settings = {
                    success: onSuccess,
                    error: onError,
                    url: url,
                    type: 'GET',
                    dataType: 'json',
                    data: data
                };
                EVWEB2.ajax(settings, config.service);
            }
        };

        /**
         * Retrieves the configuration of all remote servers configured on the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ServiceRemoteServerConfiguration}
         * instances.
         */
        this.getRemoteServers = function(callback) {
            var config = this;
    
            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };
    
            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var servers = $.map(data.remoteServers, function(element) {
                    return new EVWEB2.ServiceRemoteServerConfiguration(element.id, element.identifier,
                        element.timeout, element.passthrough, element.user, element.password,
                        false, element.powerUser, element.powerUserUsername, element.powerUserPassword,
                        element.friendlyName);
                });
    
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, servers);
            };
    
            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServers,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);   
        };

        /**
         * Adds a remote server configuration to the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the added {@link EVWEB2.ServiceRemoteServerConfiguration} instance.
         * @param {EVWEB2.ServiceRemoteServerConfiguration} server The server configuration to add.
         */
        this.addRemoteServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                server.id = data.id;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServers,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    identifier: server.identifier,
                    passthrough: server.passthrough,
                    user: server.username,
                    password: server.password,
                    timeout: server.timeout,
                    powerUser: server.powerUser,
                    powerUserUsername: server.powerUserUsername,
                    powerUserPassword: server.powerUserPassword
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Updates a remote server configuration on the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the updated {@link EVWEB2.ServiceRemoteServerConfiguration} instance.
         * @param {EVWEB2.ServiceRemoteServerConfiguration} server The server configuration to update.
         */
        this.updateRemoteServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServers,
                type: 'PUT',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    id: server.id,
                    identifier: server.identifier,
                    passthrough: server.passthrough,
                    user: server.username,
                    password: server.password,
                    timeout: server.timeout,
                    powerUser: server.powerUser,
                    powerUserUsername: server.powerUserUsername,
                    powerUserPassword: server.powerUserPassword
                }
            };
            EVWEB2.ajax(settings, config.service);            
        };

        /**
         * Removes a remote server configuration from the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the deleted {@link EVWEB2.ServiceRemoteServerConfiguration} instance.
         * @param {EVWEB2.ServiceRemoteServerConfiguration} server The server configuration to delete.
         */
        this.deleteRemoteServer = function(callback, server) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, server);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServers,
                type: 'DELETE',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    id: server.id
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Retrieves the settings for handling remote servers in the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an {@link EVWEB2.ServiceRemoteServerSettingsConfiguration}
         * instance.
         */
        this.getRemoteServersSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var settings = new EVWEB2.ServiceRemoteServerSettingsConfiguration(data.enabled, data.port);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServersListener,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Applies the settings for handling remote servers in the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the applied {@link EVWEB2.ServiceRemoteServerSettingsConfiguration} instance.
         * @param {EVWEB2.ServiceRemoteServerSettingsConfiguration} settings The remote server settings to apply.
         */
        this.setRemoteServersSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigRemoteServersListener,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    enabled: settings.enabled,
                    port: settings.port
                }
            };
            EVWEB2.ajax(request, config.service);
        };

        /**
         * Retrieves the logging configuration of the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ServiceLogFileConfiguration} instances.
         */
        this.getLoggingSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var settings = new EVWEB2.ServiceLogFileConfiguration(data.interval, data.type, data.count, data.level);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigLogging,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Applies the logging configuration for the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be
         * applied, and the applied {@link EVWEB2.ServiceLogFileConfiguration} instance.
         * @param {EVWEB2.ServiceLogFileConfiguration} settings The logging settings to apply.
         */
        this.setLoggingSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigLogging,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    level: settings.level,
                    type: settings.type,
                    interval: settings.interval,
                    count: settings.count
                }
            };
            EVWEB2.ajax(request, config.service);
        };

        /**
         * Get the log file for the service
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of lines composing the log file
         * @param {Number} [numberLines] The number of lines to request.  The lines returned will be the most recent
         * lines.
         */
        this.getLog = function (callback, numberLines) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.log);
            };

            var data = {
                auth: config.authToken
            };
            if(numberLines !== undefined) {
                data.lines = numberLines;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigLoggingFile,
                type: 'GET',
                dataType: 'json',
                data: data
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Generate a URL for downloading the log file in text format.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @return {String} The URL for the log file.
         */
        this.getLogDownloadUrl = function () {
            if(this.authToken === null) {
                return null;
            }

            var url = this.service.url() + EVWEB2.urls.serviceConfigLoggingFile;
            var params = {
                format: 'text',
                download: true,
                auth: this.authToken
            };
            var getStringParams = $.map(params, function(value, key) {
                return key + '=' + value;
            });
            url += '?' + getStringParams.join('&');
            return url;
        };

        /**
         * Callback invoked by
         * {@link EVWEB2.ServiceConfig#getBasicSettings|getBasicSettings()}.
         * @callback EVWEB2.ServiceConfig~onGetBasicSettings
         * @param {EVWEB2.ResponseStatus} status Success state of the response.
         * @param {EVWEB2.ServiceBasicConfiguration} [settings] The retrieved basic settings.
         */
        /**
         * Retrieves the basic configuration settings of the web service.
         *
         * Note: This request requires that the service {@link EVWEB2.ServiceConfig#authToken|auth token} is set by a
         * call to {@link EVWEB2.ServiceConfig#getAuthorization|getAuthorization()}.
         * @param {EVWEB2.ServiceConfig~onGetBasicSettings} callback Callback to be invoked on completion.
         */
        this.getBasicSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var ports = new EVWEB2.ServicePortsConfiguration(data.ports.http, data.ports.https, data.ports.ws,
                    data.ports.wss, data.ports.httpPolicy);

                // Mark the HTTP port as being updated.
                config.markPortsUpdated(ports);

                var settings = new EVWEB2.ServiceBasicConfiguration(data.name, data.url, ports, data.csrf,
                    data.loginExpiration, data.inactivityTimeout, data.autocomplete, data.relay);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigBasic,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Callback invoked by
         * {@link EVWEB2.ServiceConfig#setBasicSettings|setBasicSettings()}.
         * @callback EVWEB2.ServiceConfig~onSetBasicSettings
         * @param {EVWEB2.ResponseStatus} status Success state of the response.
         * @param {Boolean} [restart] Whether a restart is required.
         * @param {EVWEB2.ServiceBasicConfiguration} [settings] The applied settings.
         * @param {Object} [portConflicts] Any port conflicts. Present only when the submitted config contained a
         * configuration with ports that were detected as in-use by other applications on the system.
         * @param {Boolean} portConflicts.http Whether the provided HTTP port could not be set due to conflict.
         * @param {Boolean} portConflicts.https Whether the provided HTTPS port could not be set due to conflict.
         */
        /**
         * Applies the basic configuration settings for the web service.
         *
         * Note: This request requires that the service {@link EVWEB2.ServiceConfig#authToken|auth token} is set by a
         * call to {@link EVWEB2.ServiceConfig#getAuthorization|getAuthorization()}.
         * @param {EVWEB2.ServiceConfig~onSetBasicSettings} callback Callback to be invoked on completion.
         * @param {EVWEB2.ServiceBasicConfiguration} settings The basic settings to apply.
         */
        this.setBasicSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var data = JSON.parse(xhr.responseText);
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse, data.restart, settings, data.conflicts);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Mark the HTTP port as being updated.
                config.markPortsUpdated(settings.ports);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigBasic,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    name: settings.name,
                    url: settings.url,
                    http: settings.ports.http,
                    https: settings.ports.https,
                    ws: settings.ports.ws,
                    wss: settings.ports.wss,
                    csrf: settings.csrf,
                    loginExpiration: settings.loginExpiration,
                    inactivityTimeout: settings.inactivityTimeout,
                    autocomplete: settings.autocomplete,
                    relay: settings.relay,
                    httpPolicy: settings.ports.httpPolicy
                }
            };
            EVWEB2.ajax(request, config.service);
        };

        /**
         * Retrieves the update configuration settings of the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed an
         * {@link EVWEB2.ResponseStatus} instance and an {@link EVWEB2.ServiceUpdateConfiguration} instance.
         */
        this.getUpdateSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var settings = new EVWEB2.ServiceUpdateConfiguration(data.url, data.timeout);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigUpdates,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);            
        };
        
        /**
         * Applies the update configuration settings for the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be 
         * applied, and the applied {@link EVWEB2.ServiceUpdateConfiguration} instance.
         * @param {EVWEB2.ServiceUpdateConfiguration} settings The update settings to apply.
         */
        this.setUpdateSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigUpdates,
                type: 'POST',
                dataType: 'json',
                data: {
                    auth: config.authToken,
                    url: settings.url,
                    timeout: settings.timeout
                }
            };
            EVWEB2.ajax(request, config.service);                 
        };

        /**
         * Retrieves the external authentication configuration settings of the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ServiceExternalAuthConfiguration}
         * instances.
         */
        this.getExternalAuthSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var options = {};
                if(data.type === EVWEB2.serviceExternalAuthTypes.esm) {
                    options.url = data.url;
                    options.user = data.username;
                    options.password = data.password;
                }

                var settings = new EVWEB2.ServiceExternalAuthConfiguration(data.type, options);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigExternalAuth,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(settings, config.service);                
        };
        
        /**
         * Applies the external authentication configuration settings for the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be 
         * applied, and the applied {@link EVWEB2.ServiceExternalAuthConfiguration} instance.
         * @param {EVWEB2.ServiceExternalAuthConfiguration} settings The external authentication settings to apply.
         */
        this.setExternalAuthSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var options = {};
                if(data.type === EVWEB2.serviceExternalAuthTypes.esm) {
                    options.url = data.url;
                    options.username = data.username;
                }

                // Erase the password so that it is no longer stored.
                settings.password = '';

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var data = {
                auth: config.authToken,
                type: settings.type
            };
            if(settings.type === EVWEB2.serviceExternalAuthTypes.esm) {
                data.url = settings.url;
                data.username = settings.user;
                if(data.password !== '') {
                    data.password = settings.password;
                }
            }

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigExternalAuth,
                type: 'POST',
                dataType: 'json',
                data: data
            };
            EVWEB2.ajax(request, config.service);
        };
      
        /**
         * Retrieves the admin configuration settings of the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * Note: This request will not populate {@link EVWEB2.ServiceAdminConfiguration.password}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an {@link EVWEB2.ServiceAdminConfiguration} instance.
         */
        this.getAdminSettings = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var accessLevel = data.accessLevel;
                if (accessLevel === undefined) {
                    // older services will present localhostRestriction, the constructor will handle either
                    accessLevel = data.localhostRestriction;
                }
                var settings = new EVWEB2.ServiceAdminConfiguration(data.username, undefined, accessLevel);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, settings);
            };

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigAdmin,
                type: 'GET',
                dataType: 'json',
                data: {
                    auth: config.authToken
                }
            };
            EVWEB2.ajax(request, config.service);                
        };
        
        /**
         * Applies the external authentication configuration settings for the web service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * Note: If {@link EVWEB2.ServiceAdminConfiguration.password} is an empty string (the default value), 
         * the password will not be changed.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether this action requires a restart to be 
         * applied, and the applied {@link EVWEB2.ServiceAdminConfiguration} instance.
         * @param {EVWEB2.ServiceAdminConfiguration} settings The admin settings to apply.
         */
        this.setAdminSettings = function(callback, settings) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                // Erase the password so that it is no longer stored.
                settings.password = '';

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart, settings);
            };

            var data = {
                auth: config.authToken,
                username: settings.username,
                // deprecated, but older services will still be looking for it
                localhostRestriction: settings.localhostRestriction,
                accessLevel: settings.accessLevel
            };
            if(settings.password !== '') {
                data.password = settings.password;
            }

            var request = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceConfigAdmin,
                type: 'POST',
                dataType: 'json',
                data: data
            };
            EVWEB2.ajax(request, config.service);
        };

        /**
         * Marks the HTTP port as being updated externally to allow for {@link EVWEB2.Service.restart}
         * to properly redirect.  This method is provided exclusively for deprecated methods, in particular,
         * {@link EVWEB2.Service.setConfiguration}.
         * @param {EVWEB2.ServicePortsConfiguration} ports The updated ports configuration.
         * @private
         */
        this.markPortsUpdated = function(ports) {
            updatedPorts = ports;
        };

        /**
         * Restart the web service.  This is generally performed after updating the configuration, as the changes will
         * not be applied until the web service is restarted.  Note: Restarting the web service is not an instantaneous
         * process--after calling this method, the web service will be unreachable for a small amount of time.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, a copy of the {@link EVWEB2.Service} instance, and a Boolean
         * flag indicating if the service restart was confirmed.
         * @param {Boolean} [confirm=True] Flag to confirm the restart was successful. If set to false this
         * function will not attempt to verify the service is back up and running.
         */
        this.restart = function(callback, confirm) {
            var config = this;

            if (confirm === undefined) {
                confirm = true;
            }

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                if(data.xssPost) {
                    if(typeof callback !== 'undefined') {
                        // TODO: This should poll, like the default behavior, after a short timeout instead of
                        // immediately returning.
                        // Send a successful response.
                        var successResponse = new EVWEB2.ResponseStatus(true);
                        callback(successResponse, service, false);
                    }
                    return;
                }

                // If the port has changed, update the URL as necessary.
                var location = window.location;
                if(updatedPorts !== null) {
                    var protocolHttp = location.protocol === 'http:' || updatedProtocol === 'http';
                    var defaultPort = protocolHttp ? 80 : 443;
                    var newPort = protocolHttp ? updatedPorts.http : updatedPorts.https;

                    var newUrl = service.hostUrl;
                    if(newUrl === '') {
                        newUrl = location.protocol + '//' + location.hostname;
                        if(location.port !== '' && location.port !== defaultPort.toString()) {
                            newUrl += ':' + location.port;
                        }
                        newUrl += '/';
                    }

                    newUrl = newUrl.replace(/(:\d+)?[\/]?$/, '');
                    if(newPort !== defaultPort) {
                        newUrl += ':' + newPort;
                    }
                    // Add back the trailing slash
                    newUrl += '/';

                    config.service.hostUrl = newUrl;
                }

                if (location.protocol === 'https:' && updatedProtocol !== undefined && updatedProtocol !== 'https') {
                    // if user is already using https and never calls get/set/delete ssl then updatedProtocol is
                    // undefined and we keep the current protocol
                    // otherwise if the user has made a change to the SSL configuration it is tracked in get/set/delete
                    // and if we have fallen into here then they are currently using https and after a restart
                    // https will no longer be valid
                    config.service.hostUrl = config.service.hostUrl.replace('https', 'http');

                    // immediately return. We cannot confirm in this instance, it will be blocked
                    // in browsers with a Mixed-Content error.
                    confirm = false;
                }

                if (confirm) {
                    // Start polling to see when the service is back up
                    EVWEB2.util.notifyOnServiceRestart(callback, config.service, restartPollingInterval,
                        restartPollingMaxRetries, restartPollingConfirmationsRequired);

                } else {
                    var response = new EVWEB2.ResponseStatus(true);
                    callback(response, config.service, false);
                }
            };

            var params = {
                auth: config.authToken,
                action: 'restart'
            };

            var settings = {
                url: config.service.url() + EVWEB2.urls.service,
                success: onSuccess,
                error: onError,
                type: 'POST',
                data: params
            };
            EVWEB2.ajax(settings, config.service, true);
        };
        
        /**
         * Checks if updates are available for the service.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to 
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and an array of
         * {@link EVWEB2.ServiceUpdate} instances.
         * @param {String} updatesFileUrl The URL of the updates file
         */
        this.checkForUpdates = function (callback, updatesFileUrl) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }    
            
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };
    
            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
    
                var updatesList = $.map(data.update_info, function(element) {
                    var isRecommended = element.update_type === "Recommended";
                    return new EVWEB2.ServiceUpdate(service, element.version, element.link, isRecommended,
                                                            element.total_file_size);
                });
    
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, updatesList);
            };
    
            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.service,
                data: {
                    auth: config.authToken,
                    action: 'updatecheck',
                    updates_file: updatesFileUrl
                }
            };
    
            EVWEB2.ajax(settings, config.service);            
        };


        /**
         * Retrieves the list of discovered servers.
         * Note: This request requires that {@link EVWEB2.ServiceConfig.auth} is set by a call to
         * {@link EVWEB2.ServiceConfig.getAuthorization}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.DiscoveryServer} instances.
         */
        this.getDiscoveredServers = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Generate the discovery server instances
                var servers = $.map(data.servers, function(element) {
                    return new EVWEB2.DiscoveryServer(element.address, element.port, element.name, element.macAddress,
                        element.model, element.serial);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, servers);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceDiscovery,
                data: {
                    auth: config.authToken
                }
            };

            EVWEB2.ajax(settings, config.service);
        };


        /**
         * Retrieve the type of SSL configuration (if any) currently configured.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, and an {@link EVWEB2.sslConfigType}
         * instance.
         */
        this.getSSLConfigType = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.type);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLConfigType,
                data: {
                    auth: config.authToken
                }
            };

            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Retrieve the active External SSL configuration (if currently configured).
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, and an {EVWEB2.ExternalSSLConfig}
         * instance.
         */
        this.getExternalSSLConfig = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var expiration = EVWEB2.util.IETF2Date(data.sslConfig.expires);

                var enabled = data.sslConfig.enabled;
                var basicConfig = null;
                if (enabled) {
                    basicConfig = new EVWEB2.BasicSSLConfig(data.sslConfig.commonName,
                        data.sslConfig.domains, data.sslConfig.valid, expiration);

                    // mark ssl as a valid protocol
                    updatedProtocol = 'https';
                }
                var externalConfig = new EVWEB2.ExternalSSLConfig(enabled, basicConfig);
                callback(successResponse, externalConfig);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLExternalConfig,
                data: {
                    auth: config.authToken
                }
            };

            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Retrieve the active ACME SSL configuration (if currently configured).
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, and an {EVWEB2.AcmeSSLConfig}
         * instance.
         */
        this.getAcmeSSLConfig = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var expiration = EVWEB2.util.IETF2Date(data.sslConfig.expires);
                var enabled = data.sslConfig.enabled;
                var basicConfig = null;
                if (enabled) {
                    basicConfig = new EVWEB2.BasicSSLConfig(data.sslConfig.commonName,
                        data.sslConfig.domains, data.sslConfig.valid, expiration);

                    // mark ssl as a valid protocol
                    updatedProtocol = 'https';
                }

                var acmeConfig = new EVWEB2.AcmeSSLConfig(enabled, basicConfig, data.autoRenew, data.acmeServer);
                callback(successResponse, acmeConfig);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLAcmeConfig,
                data: {
                    auth: config.authToken
                }
            };

            EVWEB2.ajax(settings, config.service);

        };

        /**
         * Import a private key and certificate obtained from an external CA and configure the service's
         * web server to use them.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is
         * passed a {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether a restart is required
         * for the change to be applied
         * @param {String} privateKey The private key to import as a base-64 encoded string
         * @param {String} certificate key The certificate to import as a base-64 encoded string
         * @param {String} [certificateChain=undefined] Any additional intermediate certificate authorities encoded
         * as a base-64 string. Separate chain files are obsolete and any intermediate CA is
         * usually part of the certificate itself.
         */
        this.configureExtSSL = function(callback, privateKey, certificate, certificateChain) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                // mark ssl as a valid protocol
                updatedProtocol = 'https';
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.restart);
            };

            var data = {
                auth: config.authToken,
                privateKey: privateKey,
                certificate: certificate
            };

            if (certificateChain !== undefined) {
                data.chain = certificateChain;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLExternalConfig,
                type: 'POST',
                data: data
            };

            EVWEB2.ajax(settings, config.service);
        };

        /**
         * Configure the service's web server to obtain a certificate automatically from an ACME server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is
         * passed a {@link EVWEB2.ResponseStatus} instance, and a {String} token to check the status of the
         * request.
         * @param {String} [domain=undefined] The domain name to request a certificate for. This will be
         * the Common Name (CN) of the certificate. If left undefined the service will attempt to use the
         * service external URL.
         * @param {Boolean} [autoRenew=true] Flag indicating if the certificate should be automatically renewed.
         * @param {String[]} [sans=[]] A list of X.509 Subject Alternative Names (SANS) to request in addition
         * to the CN (Common Name).
         * @param {String} [acmeServer=undefined] The ACME server to request a certificate from, this defaults
         * to the production Let's Encrypt Server.
         * @param {String} [privateKey=undefined] The private key to use with the certificate (one will be
         * generated if not provided) as a base-64 encoded string containing the key data.
         */
        this.configureAcmeSSL = function(callback, domain, autoRenew, sans, acmeServer, privateKey) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.token);
            };

            var data = {
                auth: config.authToken,
                autoRenew: autoRenew !== undefined ? autoRenew : true
            };

            if (domain !== undefined) {
                data.domain = domain;
            }
            if (acmeServer !== undefined) {
                data.acmeServer = acmeServer;
            }

            if (privateKey !== undefined) {
                data.privateKey = privateKey;
            }

            if (sans !== undefined) {
                data.sans = sans;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLAcmeConfig,
                type: 'POST',
                data: data,
                traditional: true
            };

            EVWEB2.ajax(settings, config.service);

        };

        /**
         * Poll the status of an ongoing request to issue a certificate from an ACME server. This may need
         * to be called multiple times until the status is no longer pending.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, a boolean indicating whether a
         * restart is required for the change to be applied, and a {EVWEB2.acmeSSLRequestStatus} instance.
         * @param {String} token The token provided by the configure call to check the status of requesting
         * a certificate from the ACME server.
         */
        this.checkAcmeSSLStatus = function(callback, token) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var restart = data.restart !== undefined ? data.restart : false;
                if (data.status === EVWEB2.acmeSSLRequestStatus.success) {
                    // mark ssl as a valid protocol
                    updatedProtocol = 'https';
                }
                callback(successResponse, restart, data.status);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLAcmeStatus,
                data: {
                    auth: config.authToken,
                    token: token
                }
            };

            EVWEB2.ajax(settings, config.service);

        };


        /**
         * Delete the currently configured SSL configuration including any certificates and private keys.
         * This will also disable SSL if it is currently enabled and configured setting the configuration
         * to {@link sslConfigType.none}
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and a boolean indicating whether a
         * restart is required for the change to be applied.
         */
        this.deleteSSLConfig = function(callback) {
            var config = this;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,
                    EVWEB2.util.getErrorText(xhr), EVWEB2.util.getErrorCode(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText, data.errorCode);
                    callback(errorResponse);
                    return;
                }

                // mark ssl as no longer valid
                updatedProtocol = 'http';

                var successResponse = new EVWEB2.ResponseStatus(true);
                var restart = data.restart !== undefined ? data.restart : false;
                callback(successResponse, restart);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: config.service.url() + EVWEB2.urls.serviceSSLConfigType,
                type: 'DELETE',
                data: {
                    auth: config.authToken
                }
            };

            EVWEB2.ajax(settings, config.service);

        };

        /**
         * Restore the web service to the factory default settings.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and a boolean indicating whether a restart is
         * required.
         * @param {Boolean} [excludePorts=false] Whether or not the configured ports should be kept.
         */
        this.restoreDefaults = function(callback, excludePorts) {
            excludePorts = excludePorts || false;

            if (!this.authToken) {
                callback(new EVWEB2.ResponseStatus(false, 'No authorization.'));
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var data = JSON.parse(xhr.responseText);
                var status = new EVWEB2.ResponseStatus(false, 'An error occured.');
                callback(status, data.restart, data.conflicts);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var status = new EVWEB2.ResponseStatus(true);
                updatedProtocol = 'http';
                callback(status, data.restart);
            };

            var settings = {
                url: this.service.url() + EVWEB2.urls.serviceRestoreDefaults,
                type: 'POST',
                error: onError,
                success: onSuccess,
                data: {
                    auth: this.authToken,
                    excludePorts: excludePorts
                }
            };

            EVWEB2.ajax(settings, this.service);
        };
    };
}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the type of passthrough errors
     * @enum {number}
     * @readonly
     * @deprecated This enum is deprecated and will be removed in future versions.
     * @category Service
     */
    EVWEB2.serverPassthroughErrors = {
        /**
         * None
         */
        none: 0,
        /**
         * Login error
         */
        loginError: 1,
        /**
         * Connection Error
         */
        connectError: 2
    };

    /**
     * Container object with health information for individual servers.
     * @param {Number} [serverID=-1] The server id of the server.
     * @param {Number} [numCompressed=0] The total number of compressed streams being processed.
     * @param {Number} [numUncompressed=0] The total number of uncompressed (transcoded) streams being processed.
     * @class
     * @constructor
     * @deprecated This object is deprecated and will be removed in future versions.
     * @category Service
     */
    EVWEB2.ServerHealthStreamInfo = function(serverID, numCompressed, numUncompressed) {
        /**
         * The server id of the server.
         * @type {number}
         */
        this.serverID = -1;

        /**
         * The total number of compressed streams being processed.
         * @type {number}
         */
        this.numCompressed = 0;

        /**
         * The total number of uncompressed (transcoded) streams being processed.
         * @type {number}
         */
        this.numUncompressed = 0;
        
        if(serverID !== undefined) {
            this.serverID = serverID;
        }
        if(numCompressed !== undefined) {
            this.numCompressed = numCompressed;
        }
        if(numUncompressed !== undefined) {
            this.numUncompressed = numUncompressed;
        }
    };    

    /**
     * Container object for streams being processed by the web service.
     * @param {Number} [numCompressed=0] The total number of compressed streams being processed.
     * @param {Number} [numUncompressed=0] The total number of uncompressed (transcoded) streams being processed.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceHealthStreamInfo = function(numCompressed, numUncompressed) {

        /**
         * The total number of compressed streams being processed.
         * @type {number}
         */
        this.numCompressed = 0;

        /**
         * The total number of uncompressed (transcoded) streams being processed.
         * @type {number}
         */
        this.numUncompressed = 0;
        
        if(numCompressed !== undefined) {
            this.numCompressed = numCompressed;
        }
        if(numUncompressed !== undefined) {
            this.numUncompressed = numUncompressed;
        }
    };    
    
    /**
     * Container object with health information for individual servers.
     * @param {Number} [serverID=-1] The server id of the server.
     * @param {String} [serverAddress=''] The address/hostname of the server.
     * @param {Number} [liveConnections=0] The current number of server connections related to live video.
     * @param {Number} [searchConnections=0] The current number of server connections related to video search.
     * @param {EVWEB2.serverPassthroughErrors} [passthroughError=EVWEB2.serverPassthroughErrors.none] The error code 
     * set if any passthrough errors are present, 0 if there are no passthrough errors or the server is not setup to 
     * use passthrough credentials.
     * @param {String[]} [users=[]] The list of users currently accessing this server.
     * @param {EVWEB2.ServerHealthStreamInfo} [streams=null] The active video stream information for the server.
     * @class
     * @constructor
     * @deprecated This object is deprecated and will be removed in future versions.
     * @category Service
     */
    EVWEB2.ServerHealth = function(serverID, serverAddress, liveConnections, searchConnections, passthroughError, 
                                   users, streams){
        /**
         * The unique server ID used by the web service.
         * @type {number}
         */
        this.serverID = -1;

        /**
         * The IP address or hostname (if available) of the server.
         * @type {string}
         */
        this.serverAddress = '';

        /**
         * The current number of server connections open by the web service related to live video.
         * @type {number}
         */
        this.liveConnections = 0;

        /**
         * The current number of server connections open by the web service related to video search.
         * @type {number}
         */
        this.searchConnections = 0;

        /**
         * One of the enum values defined by {@link EVWEB2.serverPassthroughErrors} indicating
         * the status of any errors related to passthrough connections.
         * @type {EVWEB2.serverPassthroughErrors}
         */
        this.passthroughError = EVWEB2.serverPassthroughErrors.none;

        /**
         * The list of users currently accessing this server.
         * @type {String[]}
         */
        this.users = [];

        /**
         * The active video stream information for the server.
         * @type {EVWEB2.ServerHealthStreamInfo}
         */
        this.streams = null;
        
        //Assign the constructor values
        if(serverID !== undefined) {
            this.serverID = serverID;
        }
        if(serverAddress !== undefined) {
            this.serverAddress = serverAddress;
        }
        if(liveConnections !== undefined) {
            this.liveConnections = liveConnections;
        }
        if(searchConnections !== undefined) {
            this.searchConnections = searchConnections;
        }
        if(passthroughError !== undefined) {
            this.passthroughError = passthroughError;
        }
        if(users !== undefined) {
            this.users = users;
        }
        if(streams !== undefined) {
            this.streams = streams;
        }
    };

    /**
     * A container object for service version information, including more info than the basic
     * {@link EVWEB2.Service.version} call.
     * @param {String} [version=''] The version number of the service.  This value is identical to
     * that returned by {@link EVWEB2.Service.version}.
     * @param {String} [evapiVersion=''] The version of evAPI used by the web service.
     * @param {String} [webServerVersion=''] The version of the web server used by the web service.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceHealthVersionInfo = function (version, evapiVersion, webServerVersion) {
        /**
         * The version number of the service.  This value is identical to that returned by
         * {@link EVWEB2.Service.version}.
         * @type {String}
         */
        this.version = '';

        /**
         * The version of evAPI used by the web service.
         * @type {String}
         */
        this.evapiVersion = '';

        /**
         * The version of the web server used by the web service.
         * @type {String}
         */
        this.webServerVersion = '';

        //Assign the constructor values
        if(version !== undefined) {
            this.version = version;
        }

        if(evapiVersion !== undefined) {
            this.evapiVersion = evapiVersion;
        }

        if(webServerVersion !== undefined) {
            this.webServerVersion = webServerVersion;
        }
    };

   /**
    * A container object for service OS information, including more info than the basic
    * {@link EVWEB2.Service.version} call.
    * @param {String} [system=''] The name of the host OS.
    * @param {String} [release=''] The release number of the host OS.
    * @param {String} [version=''] The version number of the host OS.
    * @param {String} [machine=''] The machine type of the host machine.
    * @param {String} [processor=''] The processor type of the host machine.
    * @param {String} [node=''] The host machine's network name.
    * @class
    * @constructor
    * @category Service
    */
    EVWEB2.ServiceHealthOsInfo = function (system, release, version, machine, processor, node) {
        /**
         * The name of the host OS.
         * @type {String}
         */
        this.system = '';

        /**
         * The release number of the host OS.
         * @type {String}
         */
        this.release = '';

        /**
         * The version number of the host OS.
         * @type {String}
         */
        this.version = '';

        /**
         * The machine type of the host machine.
         * @type {String}
         */
        this.machine = '';

        /**
         * The processor type of the host machine.
         * @type {String}
         */
        this.processor = '';

        /**
         * The host machine's network name.
         * @type {String}
         */
        this.node = '';


        //Assign the constructor values
        if(system !== undefined) {
            this.system = system;
        }
        if(release !== undefined) {
            this.release = release;
        }
        if(version !== undefined) {
            this.version = version;
        }
        if(machine !== undefined) {
            this.machine = machine;
        }
        if(processor !== undefined) {
            this.processor = processor;
        }
        if(node !== undefined) {
            this.node = node;
        }
    };

    /**
     * A container object for service process information.
     * @param {String} [name=''] The name of the process.
     * @param {number} [cpu=0] The percentage of CPU consumed by the process.
     * @param {number} [ram=0] The amount of RAM consumed by the process, in bytes.
     * @param {number} [serverId=null] The associated server ID, if any.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceHealthProcessInfo = function (name, cpu, ram, serverId) {
        /**
         * The name of the process.
         * @type {string}
         */
        this.name = '';

        /**
         * The percentage of CPU consumed by the process.
         * @type {number}
         */
        this.cpu = 0;

        /**
         * The amount of RAM consumed by the process, in bytes.
         * @type {number}
         */
        this.ram = 0;

        /**
         * The associated server ID, if any.
         * @type {number}
         * @deprecated This value is deprecated and will no longer be supported in future versions.
         */
        this.serverId = null;
        
        if(name !== undefined) {
            this.name = name;
        }
        if(cpu !== undefined) {
            this.cpu = cpu;
        }
        if(ram !== undefined) {
            this.ram = ram;
        }
        if(serverId !== undefined) {
            this.serverId = serverId;
        }
    };

    /**
     * A container object for service system information.
     * @param {number} [cores=0] The total number of CPU cores in the system.
     * @param {number} [totalMemory=0] The total physical service memory in bytes
     * @param {number} [availableMemory=0] The available service memory in bytes
     * @param {number} [cpu=0] The total CPU usage of the system as a percentage.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceHealthSystemInfo = function (cores, totalMemory, availableMemory, cpu) {
        /**
         * The total number of CPU cores in the system.
         * @type {number}
         */
        this.cores = 0;

        /**
         * The total amount of memory in the system, in bytes.
         * @type {number}
         */
        this.totalMemory = 0;
        
        /**
         * The available memory in the system, in bytes.
         * @type {number}
         */
        this.availableMemory = 0;
        
        /**
         * The total CPU usage of the system as a percentage.
         * @type {number}
         */
        this.cpu = 0;
        
        if(cores !== undefined) {
            this.cores = cores;
        }
        if(totalMemory !== undefined) {
            this.totalMemory = totalMemory;
        }
        if(availableMemory !== undefined) {
            this.availableMemory = availableMemory;
        }
        if(cpu !== undefined) {
            this.cpu = cpu;
        }
    };    
    
    /**
     * The Service Health object is a container for basic health information about the web service.
     * @param {Number} [uptime=0] How long the web service has been running in seconds
     * @param {EVWEB2.ServerHealth[]} [servers=[]] Array of {@link EVWEB2.ServerHealth} instances
     * @param {EVWEB2.ServiceHealthVersionInfo} [versionInfo=null] Version information associated
     * with the web service.
     * @param {EVWEB2.ServiceHealthOsInfo} [osInfo=null] OS information associated with the web
     * service.
     * @param {EVWEB2.ServiceHealthProcessInfo[]} [processInfo=[]] Process-specific information
     * associated with the web service.
     * @param {EVWEB2.ServiceHealthSystemInfo} [systemInfo=null] System information associated
     * with the web service.
     * @param {EVWEB2.ServiceHealthStreamInfo} [streamInfo=null] Currently processed video stream information
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceHealth = function (uptime, servers, versionInfo, osInfo, processInfo, systemInfo, streamInfo) {
        /**
         * The web service uptime in seconds.
         * @type {number}
         */
        this.uptime = 0;

        /**
         * Array of {@link EVWEB2.ServerHealth} instances for each server the web service is
         * connected to.
         * @type {EVWEB2.ServerHealth[]}
         * @deprecated This value is deprecated and will be removed in future versions. Part of this information will
         * be exposed in a new streams property when it is introduced.
         */
        this.servers = [];

        /**
         * Version information associated with the web service.
         * @type {EVWEB2.ServiceHealthVersionInfo}
         */
        this.versionInfo = null;

        /**
         * OS information associated with the web service.
         * @type {EVWEB2.ServiceHealthOsInfo}
         */
        this.osInfo = null;

        /**
         * Process-specific information associated with the web service.
         * @type {EVWEB2.ServiceHealthProcessInfo[]}
         */
        this.processInfo = [];

        /**
         * System information associated with the web service.
         * @type {EVWEB2.ServiceHealthSystemInfo}
         */
        this.systemInfo = null;

        /**
         * Stream information associated with the web service.
         * @type {EVWEB2.ServiceHealthStreamInfo}
         */
        this.streamInfo = null;

        //Assign the constructor values
        if(uptime !== undefined) {
            this.uptime = uptime;
        }
        if(servers !== undefined) {
            this.servers = servers;
        }
        if(versionInfo !== undefined) {
            this.versionInfo = versionInfo;
        }
        if(osInfo !== undefined) {
            this.osInfo = osInfo;
        }
        if(processInfo !== undefined) {
            this.processInfo = processInfo;
        }
        if(systemInfo !== undefined) {
            this.systemInfo = systemInfo;
        }
        if(streamInfo !== undefined) {
            this.streamInfo = streamInfo;
        }
    };
  
    
}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the type of relay errors
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.relayErrors = {
        /**
         * None
         */
        none: 0,
        /**
         * Internal
         */
        internal: 1,
        /**
         * Connection
         */
        connect: 2,
        /**
         * Get Address
         */
        getAddr: 3,
        /**
         * Request
         */
        request: 4,
        /**
         * License
         */
        license: 5,
        /**
         * Login
         */
        login: 6,
        /**
         * Proxy
         */
        proxy: 7
    };


    /**
     * Container class for IP addresses
     * @param {String} address The INET/INET6 address
     * @param {String} [macAddress=''] The hardware/MAC address of the IP (if known)
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceIPAddress = function(address, macAddress) {
        /**
         * The INET/INET6 IP Address
         * @type {string}
         */
        this.address = address;

        /**
         * The hardware/MAC address of the IP
         * @type {string}
         */
        this.mac = '';
        
        // assign the constructor values
        if(macAddress !== undefined) {
            this.mac = macAddress;
        }
    };


    /**
     * Container for information related to the current network configuration of the service.
     * @param {EVWEB2.ServiceIPAddress[]} [internalIp=[]] The IP addresses detected by the service.
     * @param {EVWEB2.ServiceIPAddress} [externalIp=null] The external IP address reported by the service.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceNetworkConfig = function(internalIp, externalIp) {

        /**
         * The IP addresses detected by the service
         * @type {EVWEB2.ServiceIPAddress[]}
         */
        this.internalIp = [];

        /**
         * The IP address reported by the service
         * @type {EVWEB2.ServiceIPAddress}
         */
        this.externalIp = null;
        
        // assign the constructor values
        if(internalIp !== undefined) {
            this.internalIp = internalIp;
        }
        if(externalIp !== undefined) {
            this.externalIp = externalIp;
        }
        
    };


    /**
     * Container object for relay connection status.
     * @param {EVWEB2.relayErrors} [error=EVWEB2.relayErrors.none] A (non-none) error value iff relay is enabled but failed to start.
     * @param {String} [address=''] The public relay address (FQDN) iff relay is enabled and started successfully.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceRelayInfo = function(error, address) {
        /**
         * A (non-none) error value iff relay is enabled but failed to start.
         * @type {EVWEB2.relayErrors}
         */
        this.error = EVWEB2.relayErrors.none;

        /**
         * The public relay address (FQDN) iff relay is enabled and started successfully.
         * @type {String}
         */
        this.address = '';

        if(error !== undefined) {
            this.error = error;
        }
        if(address !== undefined) {
            this.address = address;
        }
    };    


    /**
     * Container for service connectivity status.
     * @param {EVWEB2.ServiceNetworkConfig} networkConfig The network configuration as reported by the service
     * @param {Boolean} [outbound=false] Flag set if outbound connections to the internet can be made by the
     * service. This effects the service's ability to use push notifications, download updates, etc.
     * @param {Boolean} [http=false] Flag set if the configured HTTP port can be reached externally.
     * @param {Boolean} [https=false] Flag set if the configured SSL (HTTPS) port can be reached externally.
     * NOTE: This will always be false if SSL/HTTPS is not configured.
     * @param {Boolean} [ws=false] Flag set if the configured websocket port can be reached externally.
     * @param {Boolean} [wss=false] Flag set if the configured secure websocket (SSL/WSS) port can be reached
     *     externally. NOTE: This will always be false if secure websockets are not configured.
     * @param {EVWEB2.ServiceRelayInfo} [relayInfo=null] Current status of relay connection
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceConnectivity = function(networkConfig, outbound, http, https, ws, wss, relayInfo) {
        /**
         * The network config of the service
         * @type {EVWEB2.ServiceNetworkConfig}
         */
        this.networkConfig = networkConfig;

        /**
         * Whether the service can make outbound connections.
         * @type {boolean}
         */
        this.outbound = false;

        /**
         * Whether the configured HTTP port can be reached externally.
         * @type {boolean}
         */
        this.http = false;

        /**
         * Whether the configured HTTPS port can be reached externally.
         * @type {boolean}
         */
        this.https = false;

        /**
         * Whether the configured websocket port can be reached externally.
         * @type {boolean}
         */
        this.ws = false;

        /**
         * Whether the configured secure websocket port can be reached externally.
         * @type {boolean}
         */
        this.wss = false;

        /**
         * Relay information associated with the web service.
         * @type {EVWEB2.ServiceRelayInfo}
         */
        this.relayInfo = null;

        
        // assign the constructor values
        if(outbound !== undefined) {
            this.outbound = outbound;
        }
        if(http !== undefined) {
            this.http = http;
        }
        if(https !== undefined) {
            this.https = https;
        }
        if(https !== undefined) {
            this.https = https;
        }
        if(ws !== undefined) {
            this.ws = ws;
        }
        if(wss !== undefined) {
            this.wss = wss;
        }
        if(relayInfo !== undefined) {
            this.relayInfo = relayInfo;
        }
    };
    

    /**
     * Container for information related to the SSL configuration status of the service.
     * @param {Boolean} [https=false] Flag set if SSL is configured and working locally for HTTP
     * @param {Boolean} [wss=false] Flag set if SSL is configured and working locally for websockets
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceSSLStatus = function(https, wss) {
        
        /**
         * Whether the service detects HTTPS is configured and working correctly
         * @type {boolean}
         */
        this.https = false;

        /**
         * Whether the service detects secure websockets are configured and working correctly
         * @type {boolean}
         */
        this.wss = false;

        // assign the constructor values
        if(https !== undefined) {
            this.https = https;
        }
        if(wss !== undefined) {
            this.wss = wss;
        }
    };


    /**
     * Container for push notification related status of the service.
     * @param {Boolean} [certificates=false] Flag whether push notification credentials are properly loaded.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServicePushNotificationStatus = function(certificates) {

        /**
         * Whether push notification credentials are properly loaded
         * @type {boolean}
         */
        this.certificates = false;
        
        // assign the constructor values
        if(certificates !== undefined) {
            this.certificates = certificates;
        }
    };


    /**
     * Container for status related to service updates.
     * @param {Boolean} [reachable=false] Flag set if the configured updates URL is reachable by the service.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceUpdatesStatus = function(reachable) {
        
        /**
         * Whether the updates url is reachable by the service 
         * @type {boolean}
         */
        this.reachable = false;

        // assign the constructor values
        if(reachable !== undefined) {
            this.reachable = reachable;
        }
        
    };

    /**
     * Container for service status information.
     * @param {EVWEB2.ServiceSSLStatus} ssl Status information related to SSL.
     * @param {EVWEB2.ServicePushNotificationStatus} pushNotifications Status information related to push notifications.
     * @param {EVWEB2.ServiceUpdatesStatus} updates Status information related to service updates.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceConfigStatus = function(ssl, pushNotifications, updates) {

        /**
         * Status information related to SSL
         * @type {EVWEB2.ServiceSSLStatus}
         */
        this.ssl = ssl;

        /**
         * Status information related to push notifications
         * @type {EVWEB2.ServicePushNotificationStatus}
         */
        this.pushNotifications = pushNotifications;

        /**
         * Status information related to service updates
         * @type {EVWEB2.ServiceUpdatesStatus}
         */
        this.updates = updates;
    };
    
    
    /**
     * Container class for status related to one of the configured servers.
     * @param {Number} serverId The server ID
     * @param {Boolean} [reachable=false] Flag set if the server is reachable by the web service (or in the case of
     * remote servers if that server is able to connect/reach the service)
     * @param {Boolean} [passthrough=false] Whether the passthrough user account is valid. NOTE: If the server does not
     * have a passthrough user configured this value will always be false.
     * @param {Boolean} [powerUser=false] Whether the power user account is valid. NOTE: If the server does not have a
     * power user configured this value will always be false.
     * @param {Boolean} [remote=false] Flag set if this is a remote server.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServerConfigStatus = function(serverId, reachable, passthrough, powerUser, remote) {
        
        /**
         * The server ID status information is for
         * @type {Number}
         */
        this.id = serverId;

        /**
         * Whether the server is reachable by the web service. If this is a remote server this flag 
         * is set if the remote server can connect to the service.
         * @type {boolean}
         */
        this.reachable = false;

        /**
         * Whether the passthrough user account is valid. NOTE: If the server does not have a
         * passthrough user configured this value will always be false.
         * @type {boolean}
         */
        this.passthrough = false;
        
        /**
         * Whether the power user account is valid. NOTE: If the server does not have a
         * power user configured this value will always be false.
         * @type {boolean}
         */
        this.powerUser = false;

        /**
         * Whether this is a remote server or not
         * @type {boolean}
         */
        this.remote = false;
        
        
        // assign the constructor values
        if(reachable !== undefined) {
            this.reachable = reachable;
        }
        if(passthrough !== undefined) {
            this.passthrough = passthrough;
        }
        if(powerUser !== undefined) {
            this.powerUser = powerUser;
        }
        if(remote !== undefined) {
            this.remote = remote;
        }
    };
    
    
    /**
     * The ServiceStatus acts as a container for information related to the current status of the service.
     * @param {EVWEB2.ServiceConfig} config The service configuration instance
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.ServiceStatus = function(config) {

        /**
         * The containing service configuration for this status.
         * @type {EVWEB2.ServiceConfig}
         */
        this.config = config;
        
        
        /**
         * Check the connectivity of the service including outbound connections and the ability
         * to reach the various configured service ports.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, an {@link EVWEB2.ServiceConnectivity} instance, and a Date object
         * corresponding to the last time the connectivity test was run by the service.
         * @param {Boolean} [force=false]  Force the connectivity test to run preventing the use of any cached
         * results (if any).
         */
        this.checkConnectivity = function(callback, force) {
            var config = this.config;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var internalIps = $.map(data.internalIp, function(value) {
                    return new EVWEB2.ServiceIPAddress(value.address, value.mac);
                });
                var externalIp = new EVWEB2.ServiceIPAddress(data.externalIp);
                var networkConfig = new EVWEB2.ServiceNetworkConfig(internalIps, externalIp);
                var relayInfo = new EVWEB2.ServiceRelayInfo(data.relay.error, data.relay.address);
                
                var connectivity = new EVWEB2.ServiceConnectivity(networkConfig,
                    data.connectivity.outbound,
                    data.connectivity.http,
                    data.connectivity.https,
                    data.connectivity.ws,
                    data.connectivity.wss,
                    relayInfo);

                var timestamp = EVWEB2.util.IETF2Date(data.lastUpdated);
                    
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, connectivity, timestamp);
            };

            var url = config.service.url() + EVWEB2.urls.serviceConnectivityStatus;
            
            var data = {
                auth: config.authToken
            };
            
            if (force === true) {
                data.force = true;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: url,
                type: 'GET',
                dataType: 'json',
                data: data
            };
            
            EVWEB2.ajax(settings, config.service);
        };


        /**
         * Request the status of the service configuration.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, and an {@link EVWEB2.ServiceConfigStatus} instance.
         */
        this.getConfigStatus = function(callback) {
            var config = this.config;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var sslStatus = new EVWEB2.ServiceSSLStatus(data.ssl.http, data.ssl.ws);
                var pushStatus = new EVWEB2.ServicePushNotificationStatus(data.pushNotifications.certificates);
                var updatesStatus = new EVWEB2.ServiceUpdatesStatus(data.updates);
                var configStatus = new EVWEB2.ServiceConfigStatus(sslStatus, pushStatus, updatesStatus);
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, configStatus);
            };

            var url = config.service.url() + EVWEB2.urls.serviceConfigStatus;

            var data = {
                auth: config.authToken
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: url,
                type: 'GET',
                dataType: 'json',
                data: data
            };

            EVWEB2.ajax(settings, config.service);
        };


        /**
         * Request the status of the service configuration.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance, and {@link EVWEB2.ServerConfigStatus[]} instances.
         */
        this.getServerStatus = function(callback) {
            var config = this.config;

            if(config.authToken === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No authorization.');
                callback(errorResponse);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var statuses = $.map(data.servers, function(value) {
                    return new EVWEB2.ServerConfigStatus(value.id, value.reachable, value.passthrough, value.poweruser);
                });

                var remoteStatuses = $.map(data.remoteServers, function(value){
                    return new EVWEB2.ServerConfigStatus(value.id, value.connected,
                        value.passthrough, value.poweruser, true);
                });
                
                var all = $.merge(statuses, remoteStatuses);
                callback(successResponse, all);
            };

            var url = config.service.url() + EVWEB2.urls.serviceServerStatus;

            var data = {
                auth: config.authToken
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: url,
                type: 'GET',
                dataType: 'json',
                data: data
            };

            EVWEB2.ajax(settings, config.service);
        };

    };
    
}());

/*globals EVWEB2:true*/
(function() {
    /**
     * Definitions for the possible download update status types available.
     * @enum {Number}
     * @readonly
     * @category Service
     */
    EVWEB2.downloadUpdateStatusTypes = {
        /**
         * Not started
         */
        notStarted: 0,
        /**
         * Downloading
         */
        downloading: 1,
        /**
         * Completed
         */
        completed: 2,
        /**
         * Error
         */
        error: 3
    };

    /**
     * The ServiceUpdateDownloadStatus object represents information about the status of an update download.
     * This is generated as a response to {@link EVWEB2.ServiceUpdate.downloadUpdateStatus}.
     * @param {EVWEB2.downloadUpdateStatusTypes} [status=EVWEB2.downloadUpdateStatusTypes.notStarted]
     * The status of the update download.
     * @param {Number} [currentFileSize=0] The file size of the update currently being downloaded, in bytes.
     * @param {Number} [totalFileSize=0] The total file size of the update, in bytes.
     * @param {EVWEB2.ServiceUpdate} [update=null] The update instance this status is associated with
     * @class
     * @category Service
     */
    EVWEB2.ServiceUpdateDownloadStatus = function(status, currentFileSize, totalFileSize, update) {
        /**
         * The status of the update download.
         * @type EVWEB2.downloadUpdateStatusTypes
         */
        this.status = EVWEB2.downloadUpdateStatusTypes.notStarted;

        /**
         * The current file size of the update, in bytes.
         * @type Number
         */
        this.currentFileSize = 0;

        /**
         * The total file size of the download, in bytes.
         * @type Number
         */
        this.totalFileSize = 0;

        /**
         * The update instance this status is associated with
         * @type EVWEB2.ServiceUpdate
         */
        this.update = null;

        //Assign the constructor values
        if(typeof status !== 'undefined') {
                this.status = status;
        }
        if(typeof currentFileSize !== 'undefined') {
            this.currentFileSize = currentFileSize;
        }
        if(typeof totalFileSize !== 'undefined') {
            this.totalFileSize = totalFileSize;
        }
        if(typeof update !== 'undefined') {
            this.update = update;
        }
    };

    /**
     * The ServiceUpdate object represents information about an available service update.  This
     * is generated as a response to {@link EVWEB2.Service.checkForUpdates}.
     * @param {EVWEB2.Service} [service=null] The service associated with this update
     * check.
     * @param {String} [version=''] The version of this update.
     * @param {String} [updateUrl=''] The URL to the update installer.
     * @param {Boolean} [recommended=false] Boolean flag for whether the type of update is recommended or not.
     * @param {Number} [totalFileSize=0] The total file size of the download, in bytes.
     * @class
     * @category Service
     */
    EVWEB2.ServiceUpdate = function(service, version, updateUrl, recommended, totalFileSize) {
        /**
         * The service associated with the update instance.
         * @type EVWEB2.Service
         */
        this.service = null;

        /**
         * The version of the update.
         * @type String
         */
        this.version = '';

        /**
         * The URL of the update.
         * @type String
         */
        this.updateUrl = '';

        /**
         * Boolean flag for whether the type of update is recommended or not.
         * @type Boolean
         */
        this.recommended = false;

        /**
         * The total file size of the download, in bytes.
         * @type Number
         */
        this.totalFileSize = 0;

        //Assign the constructor values
        if(typeof service !== 'undefined') {
            this.service = service;
        }
        if(typeof version !== 'undefined') {
            this.version = version;
        }
        if(typeof updateUrl !== 'undefined') {
            this.updateUrl = updateUrl;
        }
        if(typeof recommended !== 'undefined') {
            this.recommended = recommended;
        }
        if(typeof totalFileSize !== 'undefined') {
            this.totalFileSize = totalFileSize;
        }

        /**
         * Instructs the service to start downloading the specified update.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance.
         * @param {String} authToken The authorization token retrieved using
         * {@link EVWEB2.Service.config.getAuthorization}
         * @param {Boolean} [useGetRequest=false] Boolean as to whether to force the use of a GET request instead of
         * the default POST request (not recommended).
         */
        this.downloadUpdate = function(callback, authToken, useGetRequest) {
            if(typeof useGetRequest === 'undefined') {
                useGetRequest = false;
            }
            var onDownloadUpdateError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onDownloadUpdateSuccess = function (data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            if(!useGetRequest && this.service.isXss()) {
                var errorText = 'This call can not be performed via POST in XSS situations.';
                var errorResponse = new EVWEB2.ResponseStatus(false, errorText);
                callback(errorResponse);
                return;
            }

            var settings = {
                success: onDownloadUpdateSuccess,
                error: onDownloadUpdateError,
                url: this.service.url() + EVWEB2.urls.service,
                type: useGetRequest ? 'GET' : 'POST',
                data: {
                    auth: authToken,
                    action: 'downloadupdate',
                    version: this.version
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Queries for the current status of downloading the update.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and a
         * {@link EVWEB2.ServiceUpdateDownloadStatus} instance.
         * @param {String} authToken The authorization token retrieved using
         * {@link EVWEB2.Service.config.getAuthorization}
         */
        this.downloadUpdateStatus = function(callback, authToken) {

            var serviceUpdate = this;

            var onDownloadUpdateStatusSuccess = function (data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var downloadUpdateStatus = new EVWEB2.ServiceUpdateDownloadStatus(data.status, data.current_file_size,
                                                        data.total_file_size, serviceUpdate);

                callback(successResponse, downloadUpdateStatus);
            };

            var onDownloadUpdateStatusError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var settings = {
                success: onDownloadUpdateStatusSuccess,
                error: onDownloadUpdateStatusError,
                url: this.service.url() + EVWEB2.urls.service,
                data: {
                    auth: authToken,
                    action: 'downloadupdatestatus',
                    version: this.version
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
        * Applies the update to the service.  If the update installer has been downloaded
        * (i.e. {@link EVWEB2.ServiceUpdate.downloadUpdate} has been called and has finished)
        * the web service will immediately stop and begin to install the update.
        * @param {Function} callback Callback function to be executed when the call completes.
        * Callback is passed a {@link EVWEB2.ResponseStatus} instance.
        * @param {String} authToken The authorization token retrieved using
        * {@link EVWEB2.Service.config.getAuthorization}
        * @param {Boolean} [useGetRequest=false] Boolean as to whether to force the use of a GET request instead of
        * the default POST request (not recommended).
        */
        this.applyUpdate = function(callback, authToken, useGetRequest) {
            if(typeof useGetRequest === 'undefined') {
                useGetRequest = false;
            }

            var onApplyUpdateError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onApplyUpdateSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var restartPollingConfirmationsRequired = 10;
                var restartPollingMaxRetries = 120;
                var restartPollingInterval = 3000;

                // Start polling to see when the service is back up
                EVWEB2.util.notifyOnServiceRestart(callback, service, restartPollingInterval, restartPollingMaxRetries,
                                                                restartPollingConfirmationsRequired);
            };

            if(!useGetRequest && this.service.isXss()) {
                var errorText = 'This call can not be performed via POST in XSS situations.';
                var errorResponse = new EVWEB2.ResponseStatus(false, errorText);
                callback(errorResponse);
                return;
            }

            var settings = {
                success: onApplyUpdateSuccess,
                error: onApplyUpdateError,
                url: this.service.url() + EVWEB2.urls.service,
                type: useGetRequest ? 'GET' : 'POST',
                data: {
                    auth: authToken,
                    action: 'update',
                    version: this.version
                }
            };

            EVWEB2.ajax(settings, this.service);
        };
    };
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the possible download update status types available.
     * @enum {string}
     * @readonly
     * @category Service
     */
    EVWEB2.serviceAuthTypes = {
        /**
         * Unknown
         */
        unknown: '',
        /**
         * None
         */
        none: 'none',
        /**
         * Enterprise Manager
         */
        esm: 'esm'
    };

    /**
     * The ServiceAuth object contains information and methods around authentication in the web service.
     * If enabled, an authentication token must be retrieved before any calls to the service can be
     * made.
     * @param {EVWEB2.Service} [service=null] The service associated with this auth instance.
     * @param {EVWEB2.serviceAuthTypes} [type=EVWEB2.serviceAuthTypes.unknown] The type of the authentication used
     * by the web service.
     * @param {Object} [info={}] Additional info associated with this authentication type.  Generally, this
     * provides a URL for the endpoint of authentication.
     * @param {String} [token=''] The authorization token for use in all requests.
     * @param {Date} [expirationDate=null] The date at which the token expires.
     * @class
     * @category Service
     */
    EVWEB2.ServiceAuth = function(service, type, info, token, expirationDate) {
        /**
         * The service associated with the update instance.
         * @type EVWEB2.Service
         */
        this.service = null;

        /**
         * The type of the authentication used by the web service.
         * @type EVWEB2.serviceAuthTypes
         */
        this.type = EVWEB2.serviceAuthTypes.unknown;

        /**
         * Additional info associated with this authentication type.  Generally, this provides
         * a URL for the endpoint of authentication.
         * @type {Object}
         */
        this.info = {};

        /**
         * The authorization token for use in all requests.
         * @type String
         */
        this.token = '';

        /**
         * The date at which the token expires.
         * @type Date
         */
        this.expirationDate = null;

        //Assign the constructor values
        if(service !== undefined) {
            this.service = service;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(info !== undefined) {
            this.info = info;
        }
        if(token !== undefined) {
            this.token = token;
        }
        if(expirationDate !== undefined) {
            this.expirationDate = expirationDate;
        }

        var instance = this;
        // Load the auth data from the cookie (if the token is not already set)
        if(document !== undefined && document.cookie !== undefined) {
            var cookies = document.cookie.split(';');
            $.each(cookies, function(index, element) {
                var cookiePair = $.trim(element).split('=');
                if(cookiePair[0] === 'token') {
                    instance.token = cookiePair[1];
                }
            });
        }

        /**
         * Retrieves the type of authentication used by this service.  The result of this call
         * is stored on the object, so the network request is only made at types when
         * {@link EVWEB2.ServiceAuth.type} is equal to {@link EVWEB2.serviceAuthTypes.unknown}.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, the authorization type, and
         * an object of additional auth-type specific info.
         * Note: This value is stored in the object and is only passed to the callback for
         * convenience.
         */
        this.getType = function(callback) {
            var instance = this;

            if(instance.type !== EVWEB2.serviceAuthTypes.unknown) {
                var response = new EVWEB2.ResponseStatus(true);
                callback(response, instance.type, instance.info);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                instance.type = data.type;
                instance.info = data.info;

                var response = new EVWEB2.ResponseStatus(true);
                callback(response, instance.type, instance.info);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.service.url() + EVWEB2.urls.auth,
                type: 'GET',
                data: {
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, instance.service);
        };

        /**
         * Authenticates with the web service and stores the requested token for use in all
         * future calls.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance, the retrieved token, and
         * the expiration date.  Note: These values are stored in the object and are only passed
         * to the callback for convenience.
         * @param {String} username The username for authentication.
         * @param {String} password The password for authentication.
         */
        this.authenticate = function(callback, username, password) {
            var instance = this;

            var now = new Date();
            if(instance.token !== '' && instance.expirationDate !== null && instance.expirationDate > now) {
                var response = new EVWEB2.ResponseStatus(true);
                callback(response, instance.token, instance.expirationDate);
                return;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                instance.token = data.token;
                instance.expirationDate = EVWEB2.util.IETF2Date(data.expiration);

                var response = new EVWEB2.ResponseStatus(true);
                callback(response, instance.token, instance.expirationDate);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.service.url() + EVWEB2.urls.auth,
                type: 'POST',
                data: {
                    username: username,
                    password: password
                }
            };

            EVWEB2.ajax(settings, instance.service);
        };

        /**
         * Logs out of the current authentication and invalidates the token.
         * @param {Function} [callback] Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance.
         */
        this.logout = function(callback) {
            var instance = this;
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                if(callback !== undefined) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                    callback(errorResponse);
                }
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    if(callback !== undefined) {
                        callback(errorResponse);
                    }
                    return;
                }

                instance.token = '';
                instance.expirationDate = null;
                instance.info = {};

                if(callback !== undefined) {
                    var response = new EVWEB2.ResponseStatus(true);
                    callback(response);
                }
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.service.url() + EVWEB2.urls.authLogout,
                type: 'POST'
            };

            EVWEB2.ajax(settings, instance.service);
        };

        /**
         * Helper method to determine if the authentication is currently valid (i.e.
         * the authentication is present and has not expired).
         * @returns {boolean} Whether the authentication is valid.
         */
        this.isAuthenticated = function() {
            if(this.token === '') {
                return false;
            }
            // There is no way to get the expiration date from a token that's
            // retrieved via a cookie, so expiration will be null with a set
            // token.  In this scenario, assume it's valid.
            return this.expirationDate === null || this.expirationDate > new Date();
        };
    };
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * A container for a discovered server.  This is a server that has been detected on the local network
     * of the web service.
     * @param {String} address The address of the discovered server.
     * @param {Number} port The port number of the discovered server.
     * @param {String} [name=""] The name of the discovered server.
     * @param {String} [macAddress=""] The MAC address of the discovered server.
     * @param {String} [model=""] The model of the discovered server.
     * @param {String} [serial=""] The serial of the discovered server.
     * @class
     * @category Service
     */
    EVWEB2.DiscoveryServer = function(address, port, name, macAddress, model, serial) {

        /**
         * The address of the discovered server.
         * @type {String}
         */
        this.address = address;

        /**
         * The port number of the discovered server.
         * @type {Number}
         */
        this.port = port;

        /**
         * The name of the discovered server.
         * @type {String}
         */
        this.name = '';

        /**
         * The MAC address of the discovered server.
         * @type {String}
         */
        this.macAddress = '';

        /**
         * The model of the discovered server.
         * @type {String}
         */
        this.model = '';

        /**
         * The serial of the discovered server.
         * @type {String}
         */
        this.serial = '';

        if(name !== undefined) {
            this.name = name;
        }
        if(macAddress !== undefined) {
            this.macAddress = macAddress;
        }
        if(model !== undefined) {
            this.model = model;
        }
        if(serial !== undefined) {
            this.serial = serial;
        }
    };
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the types of licenses available to servers
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.serverLicenseTypes = {
        /**
         * Unknown
         */
        unknown: -3,
        /**
         * Bad
         */
        bad: -2,
        /**
         * Unlicensed
         */
        unlicensed: -1,
        /**
         * Evaluation
         */
        evaluation: 0,
        /**
         * Licensed
         */
        licensed: 1,
        /**
         * Trial
         */
        trial: 2,
        /**
         * Restricted
         */
        restricted: 3,
        /**
         * Enterprise
         */
        enterprise: 4,
        /**
         * Enterprise-extended
         */
        enterpriseEx: 5
    };

    /**
     * The types of user access levels.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.accessLevelType = {
        /**
         * Unknown
         */
        unknown: -2,
        /**
         * Delete
         */
        deleteType: -1,  //'delete' is a reserved keyword
        /**
         * None (User belongs to a group)
         */
        none: 3,
        /**
         * Power User
         */
        powerUser: 4,
        /**
         * Full Admin
         */
        fullAdmin: 5,
        /**
         * User Admin
         */
        userAdmin: 6,
        /**
         * Live-only
         */
        liveOnly: 10,
        /**
         * Search-only
         */
        searchOnly: 11,
        /**
         * Live and Search
         */
        liveAndSearch: 12
    };

    /**
     * Definitions for the types of features that can be managed externally on a server.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.serverManagementFeatures = {
        /**
         * Users
         */
        users: 1,
        /**
         * Failover
         */
        failover: 2
    };

    /**
     * The live permissions for a group.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.userPermissionsLive = {
        /**
         * Base
         */
        base: 0,
        /**
         * Groups
         */
        groups: 1,
        /**
         * Maps
         */
        maps: 2,
        /**
         * Views
         */
        views: 3,
        /**
         * Quick Replay
         */
        quickReplay: 4,
        /**
         * PTZ
         */
        ptz: 5,
        /**
         * Two-way Audio
         */
        twoWayAudio: 6,
        /**
         * Event Monitoring
         */
        eventMonitor: 7,
        /**
         * Save Image
         */
        saveImage: 8,
        /**
         * Print Image
         */
        printImage: 9,
        /**
         * Cameras
         */
        cameras: 10,
        /**
         * Video Push
         */
        videoPush: 11
    };

    /**
     * The search permissions for a group.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.userPermissionsSearch = {
        /**
         * Base
         */
        base: 12,
        /**
         * Groups
         */
        groups: 13,
        /**
         * Maps
         */
        maps: 14,
        /**
         * Views
         */
        views: 15,
        /**
         * Events
         */
        events: 16,
        /**
         * Save Image
         */
        saveImage: 17,
        /**
         * Print Image
         */
        printImage: 18,
        /**
         * Burn Disc
         */
        burnDisc: 19,
        /**
         * Export Video
         */
        exportVideo: 20,
        /**
         * Smart Search
         */
        smartSearch: 21,
        /**
         * Cases
         */
        cases: 22,
        /**
         * Cameras
         */
        cameras: 23
    };

    /**
     * The config permissions for a group.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.userPermissionsConfig = {
        /**
         * User Admin (User can edit other users names, passwords, etc.)
         */
        userAdmin: 24,
        /**
         * View Admin (User can create and see views.)
         */
        viewAdmin: 25,
        /**
         * Case Admin (User can create and see cases.)
         */
        caseAdmin: 26,
        /**
         * User View Admin
         */
        userViewAdmin: 27
    };

    /**
     * The group permissions for a group.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.userPermissionsGroup = {
        /**
         * Group Video (User is able to see all video.)
         */
        groupVideo: 28,
        /**
         * Group Audio (User can access all audio.)
         */
        groupAudio: 29,
        /**
         * Group Serial (User can access all serial profiles.)
         */
        groupSerial: 30,
        /**
         * Group Soft Trigger (User can control soft triggers.)
         */
        groupSoftTrigger: 31
    };

    /**
     * The available permissions for a group.
     * @type {object}
     * @readonly
     * @category Server
     */
    EVWEB2.userPermissions = {
        /**
         * The live permissions for a group.
         * @type {EVWEB2.userPermissionsLive}
         */
        livePermissions: EVWEB2.userPermissionsLive,

        /**
         * The search permissions for a group.
         * @type {EVWEB2.userPermissionsSearch}
         */
        searchPermissions: EVWEB2.userPermissionsSearch,

        /**
         * The configuration permissions for a group.
         * @type {EVWEB2.userPermissionsConfig}
         */
        configPermissions: EVWEB2.userPermissionsConfig,
        /**
         * The group permissions for a group.
         * @enum {number}
         */
        groupPermissions: EVWEB2.userPermissionsGroup
    };

    /**
     * Bit mask values for user group permissions
     * @type {Object.<string, enum>}
     * @readonly
     * @category Server
     */
    EVWEB2.permissionsBitmask = {
        livePermissions: {
            base: 0x00001,
            groups: 0x00002,
            maps: 0x00004,
            views: 0x00008,
            quickReplay: 0x00010,
            ptz: 0x00020,
            twoWayAudio: 0x00040,
            eventMonitor: 0x00080,
            saveImage: 0x80000,
            printImage: 0x100000,
            cameras: 0x200000,
            videoPush: 0x800000
        },
        searchPermissions: {
            base: 0x00100,
            groups: 0x00200,
            maps: 0x00400,
            views: 0x00800,
            events: 0x01000,
            saveImage: 0x02000,
            printImage: 0x04000,
            burnDisc: 0x08000,
            exportVideo: 0x10000,
            smartSearch: 0x20000,
            cases: 0x40000,
            cameras: 0x400000
        },
        configPermissions: {
            userAdmin: 0x1,              // User can edit other users names, passwords, etc.
            viewAdmin: 0x2,              // User can create and see views.
            caseAdmin: 0x4,              // User can create and see cases.
            userViewAdmin: 0x8
        },
        groupPermissions: {
            groupVideo: 0x1,              // User is able to see all video.
            groupAudio: 0x2,              // User can access all audio.
            groupSerial: 0x4,             // User can access all serial profiles.
            groupSoftTrigger: 0x8         // User can control soft triggers.
        }
    };

    /**
     * The ServerLicenseInfo object represents the license information on the specified server.
     * @param {String} [macAddress=''] The MAC address of the server assigned to this license.
     * @param {Date} [expiration=null] The expiration date for the license.
     * @param {Boolean} [isExpired=true] Whether the server license is expired.
     * @param {Boolean} [isRestricted=false] Whether the server license is restricted.
     * @param {Boolean} [isEnterprise=false] Whether the server license is enterprise.
     * @param {Number} [maxAnalogCameras=0] Number of analog cameras connected to the server.
     * @param {Number} [maxIpCameras=0] Number of ip cameras connected to the server.
     * @param {Number} [maxBoards=0] Number of boards associated with the server.
     * @param {EVWEB2.serverLicenseTypes} [licenseType=EVWEB2.serverLicenseTypes.unknown] The type of license
     * associated with the server.
     * @param {String} [licenseKey=""] The license key associated with the server.
     * @class
     * @category Server
     */
    EVWEB2.ServerLicenseInfo = function(macAddress, expiration, isExpired, isRestricted, isEnterprise, maxAnalogCameras,
                                        maxIpCameras, maxBoards, licenseType, licenseKey) {
        /**
         * Whether the server license is expired.
         * @type Boolean
         */
        this.isExpired = true;

        /**
         * Whether the server license is restricted.
         * @type Boolean
         */
        this.isRestricted = false;

        /**
         * Whether the server license is enterprise.
         * @type Boolean
         */
        this.isEnterprise = false;

        /**
         * The expiration date for the license
         * @type Date
         */
        this.expiration = null;

        /**
         * The MAC address of the server assigned to this license.
         * @type String
         */
        this.macAddress = '';

        /**
         * The number of analog cameras connected to the server.
         * @type Number
         */
        this.maxAnalogCameras = 0;

        /**
         * The number of ip cameras connected to the server.
         * @type Number
         */
        this.maxIpCameras = 0;

        /**
         * The number of boards associated with the server.
         * @type Number
         */
        this.maxBoards = 0;

        /**
         * The type of license associated with the server.
         * @type EVWEB2.serverLicenseTypes
         */
        this.licenseType = EVWEB2.serverLicenseTypes.unknown;

        /**
         * The license key associated with the server.
         * @type String
         */
        this.licenseKey = '';

        //Assign the constructor values
        if(macAddress !== undefined) {
            this.macAddress = macAddress;
        }
        if(expiration !== undefined) {
            this.expiration = expiration;
        }
        if(isExpired !== undefined) {
            this.isExpired = isExpired;
        }
        if(isRestricted !== undefined) {
            this.isRestricted = isRestricted;
        }
        if(isEnterprise !== undefined) {
            this.isEnterprise = isEnterprise;
        }
        if(maxAnalogCameras !== undefined) {
            this.maxAnalogCameras = maxAnalogCameras;
        }
        if(maxIpCameras !== undefined) {
            this.maxIpCameras = maxIpCameras;
        }
        if(maxBoards !== undefined) {
            this.maxBoards = maxBoards;
        }
        if(licenseType !== undefined) {
            this.licenseType = licenseType;
        }
        if(licenseKey !== undefined) {
            this.licenseKey = licenseKey;
        }
    };

    /**
     * The ServerDetailInfo object represents detailed information about the specified server.
     * @param {String} [address=''] The web address for this server.
     * @param {Number} [port=0] The port number for this server.
     * @param {String} [modelNo=''] The model number for this server.
     * @param {String} [serialNo=''] The serial number for this server.
     * @param {String} [version=''] The server software version.
     * @param {Number} [daysRecordedVideo=0] The days of recorded video stored on the server.
     * @class
     * @category Server
     */
    EVWEB2.ServerDetailInfo = function(address, port, modelNo, serialNo, version, daysRecordedVideo) {
        /**
         * The web address for this server.
         * @type String
         */
        this.address = '';

        /**
         * The port number for this server.
         * @type Number
         */
        this.port = 0;

        /**
         * The model number for this server.
         * @type String
         */
        this.modelNo = '';

        /**
         * The serial number for this server.
         * @type String
         */
        this.serialNo = '';

        /**
         * The server software version.
         * @type String
         */
        this.version = '';

        /**
         * The days of recorded video stored on the server.
         * @type Number
         */
        this.daysRecordedVideo = 0;

        //Assign the constructor values
        if(address !== undefined) {
            this.address = address;
        }
        if(port !== undefined) {
            this.port = port;
        }
        if(modelNo !== undefined) {
            this.modelNo = modelNo;
        }
        if(serialNo !== undefined) {
            this.serialNo = serialNo;
        }
        if(version !== undefined) {
            this.version = version;
        }
        if(daysRecordedVideo !== undefined) {
            this.daysRecordedVideo = daysRecordedVideo;
        }
    };

    /**
     * The SystemUsageInfo object represents information about each user on the specified system.
     * @param {String} [username=''] The username of the user.
     * @param {EVWEB2.accessLevelType} [level=EVWEB2.accessLevelType.unknown] The access level of the user.
     * @param {String} [address=''] The IP address of the user.
     * @param {Number} [streams=0] The number of active streams viewed by the user.
     * @param {Boolean} [audit=false] Whether the users' client is audited.
     * @param {String} [instanceName=''] The name of the instance.
     * @class
     * @category Server
     */
    EVWEB2.SystemUsageInfo = function(username, level, address, streams, audit, instanceName) {
        /**
         * The username of the user.
         * @type String
         */
        this.username = '';

        /**
         * The access level of the user.
         * @type EVWEB2.accessLevelType
         */
        this.level = EVWEB2.accessLevelType.unknown;

        /**
         * The IP address of the user.
         * @type String
         */
        this.address = '';

        /**
         * The number of active streams viewed by the user.
         * @type Number
         */
        this.streams = 0;

        /**
         * Whether the users' client is audited.
         * @type Boolean
         */
        this.audit = false;

        /**
         * The instance name.
         * @type Boolean
         */
        this.instanceName = '';

        //Assign the constructor values
        if(username !== undefined) {
            this.username = username;
        }
        if(level !== undefined) {
            this.level = level;
        }
        if(address !== undefined) {
            this.address = address;
        }
        if(streams !== undefined) {
            this.streams = streams;
        }
        if(audit !== undefined) {
            this.audit = audit;
        }
        if(instanceName !== undefined) {
            this.instanceName = instanceName;
        }
    };

    /**
     * The SystemPluginInfo object represents information of each plugin/library on the specified system.
     * @param {String} [name=''] The name of the plugin.
     * @param {String} [filename=''] The file name of the plugin.
     * @param {String} [version=''] The version number of the plugin.
     * @param {Boolean} [status=false] Whether there was an error in accessing the plugin.
     * @param {Number} [errorCode=-1] Error code of the response. Set to 0 if status is true.
     * @class
     * @category Server
     */
    EVWEB2.SystemPluginInfo = function(name, filename, version, status, errorCode) {
        /**
         * The plugin name.
         * @type String
         */
        this.name = '';

        /**
         * The plugin file name.
         * @type String
         */
        this.filename = '';

        /**
         * The plugin version number.
         * @type String
         */
        this.version = '';

        /**
         * The plugin status.
         * @type Boolean
         */
        this.status = false;

        /**
         * The error response.
         * @type Number
         */
        this.errorCode = -1;

        //Assign the constructor values
        if(name !== undefined) {
            this.name = name;
        }
        if(filename !== undefined) {
            this.filename = filename;
        }
        if(version !== undefined) {
            this.version = version;
        }
        if(errorCode !== undefined) {
            this.errorCode = errorCode;
        }
        if(status !== undefined) {
            this.status = status;
            if(this.status) {
                this.errorCode = 0;
            }
        }
    };



    /**
     * The server object is a container for each server attached to the web service backend.
     * It is initially populated from the information retrieved in the {@link EVWEB2.Service.getServers} function
     * and can be used for finding the desired server and further requesting for a login through
     * {@link EVWEB2.Server.login} or requesting the camera feed list through {@link EVWEB2.Server.getCameras}.
     *
     * @param {EVWEB2.Service} [service=null] The service instance for this server.
     * @param {String} [name='Unset'] Name of the server.
     * @param {String} [id=''] ID of the server according to the web service.
     * @param {Boolean} [loginRequired=false] Whether login is required (true = requires login) or passthrough.
     * @param {Boolean} [isRestricted=false] Whether this server is a restricted server or not.
     * @param {String} [sessionId=''] Session Id to be used with this server, used primarily for searches.
     * @param {Number} [gmtOffset=0] Server's GMT offset (timezone).
     * @param {Boolean} [osd=false] Whether the server has OSD enabled for its cameras.
     * @param {EVWEB2.ServerDetailInfo} [detailInfo=null] Additional details about the server configuration.
     * Note: Some of these values are only populated after logging in to the server.
     * @param {EVWEB2.ServerLicenseInfo} [licenseInfo=null] The licensing information about the server. Note: These
     * values are only populated after logging in to the server.
     * @param {EVWEB2.UserGroup|EVWEB2.UserPermissions} [userGroup=null] The group information of the currently logged
     * in user. This parameter is overloaded and also supports the deprecated behavior of passing the permissions object
     * {@link EVWEB2.UserPermissions} of the currently logged in user.
     * @param {EVWEB2.UserGroup|EVWEB2.UserPermissions} [passthroughGroup=null] The group information of the
     * passthrough user. This parameter is overloaded and also supports the deprecated behavior of passing the
     * permissions object {@link EVWEB2.UserPermissions} of the passthrough user.
     * @param {EVWEB2.serverManagementFeatures[]} [managedFeatures=[]] The list of features that are managed by an
     * external service.  Any managed features are not able to be modified by the web service.  For example,
     * if EVWEB2.serverManagedFeatures.user is set, creating, modifying, and deleting users will fail.
     * @param {Boolean} [canAutoLogin=false] Flag determining if the server has stored credentials for this server.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.Server = function (service, name, id, loginRequired, isRestricted, sessionId, gmtOffset, osd, detailInfo,
                              licenseInfo, userGroup, passthroughGroup, managedFeatures, canAutoLogin) {
        /**
         * The service instance for this server
         * @type EVWEB2.Service
         */
        this.service = null;

        /**
         * Name of the server
         * @type String
         */
        this.name = 'Unset';

        /**
         * Server ID according to the web service
         * @type String
         */
        this.id = '';

        /**
         * Session ID according to the web service
         * @type String
         */
        this.sessionId = '';

        /**
         * Whether login is required (true = requires login) or passthrough
         * @type Boolean
         */
        this.loginRequired = false;

        /**
         * Whether this server is a restricted server or not
         * @type Boolean
         */
        this.restricted = false;

        /**
         * GMT offset (timezone)
         * @type Number
         */
        this.gmtOffset = 0;

        /**
         * Whether this server has OSD enabled
         * @type Boolean
         */
        this.osd = false;

        /**
         * Username used to log in to the server
         * @type String
         */
        this.username = '';

        /**
         * Additional details about the server configuration. Note: Some of these values are only populated after
         * logging in to the server.
         * @type EVWEB2.ServerDetailInfo
         */
        this.detailInfo = null;

        /**
         * The licensing information about the server. Note: These values are only populated after logging in to the
         * server.
         * @type EVWEB2.ServerLicenseInfo
         */
        this.licenseInfo = null;

        /**
         * The group information of the currently logged in user.
         * @type EVWEB2.UserGroup
         */
        this.userGroup = null;

        /**
         * The group information of the passthrough user.
         * @type EVWEB2.UserGroup
         */
        this.passthroughGroup = null;

        /**
         * The permissions of the currently logged in user.
         * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
         * about a group and all its permissions.
         * @type EVWEB2.UserPermissions
         */
        this.userPermissions = null;

        /**
         * The permissions of the passthrough user.
         * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
         * about a group and all its permissions.
         * @type EVWEB2.UserPermissions
         */
        this.passthroughPermissions = null;

        /**
         * Wrapping object for all devices configuration information on the server.
         * @type {EVWEB2.ServerConfig}
         */
        this.configuration = new EVWEB2.ServerConfig(this);


        /**
         * Whether or not the server has stored credentials that can be used to login to this server.
         * Effectively passthrough credentials but servers are spawned on demand instead of persistent.
         * @type {boolean}
         */
        this.canAutoLogin = false;

        /**
         * The list of features that are managed by an external service.  Any managed features are
         * not able to be modified by the web service.  For example, if
         * EVWEB2.serverManagedFeatures.user is set, creating, modifying, and deleting users will
         * fail.
         * @type {EVWEB2.serverManagementFeatures[]}
         */
        this.managedFeatures = [];

        /**
         * A reference to this instance, used by closure-contained utility functions.
         * @type {EVWEB2.Server}
         * @internal
         */
        var instance = this;

        //Assign the constructor values
        if(service !== undefined) {
            this.service = service;
        }
        if(name !== undefined) {
            this.name = name;
        }
        if(id !== undefined) {
            this.id = id;
        }
        if(loginRequired !== undefined) {
            this.loginRequired = loginRequired;
        }
        if(isRestricted !== undefined) {
            this.restricted = isRestricted;
        }
        if(sessionId !== undefined) {
            this.sessionId = sessionId;
        }
        else if(!this.loginRequired) {
            //Session ID defaults to the server ID for passthrough servers.
            this.sessionId = this.id;
        }
        if(gmtOffset !== undefined) {
            this.gmtOffset = gmtOffset;
        }
        if(osd !== undefined) {
            this.osd = osd;
        }
        if(detailInfo !== undefined) {
            this.detailInfo = detailInfo;
        }
        if(licenseInfo !== undefined) {
            this.licenseInfo = licenseInfo;
        }

        if(userGroup !== undefined) {
            if(userGroup instanceof EVWEB2.UserPermissions) {
                this.userPermissions = userGroup;

                var userGroupPermissions = EVWEB2.util.internal.generateGroupPermissions(this.userPermissions);
                this.userGroup = new EVWEB2.UserGroup('', undefined, userGroupPermissions, undefined, '', undefined);
            }
            else if(userGroup instanceof EVWEB2.UserGroup) {
                this.userGroup = userGroup;
                this.userPermissions = EVWEB2.util.internal
                    .generateUserPermissions(this.userGroup.permissions, this.userGroup.accessLevel);
            }
        }
        if(passthroughGroup !== undefined) {
            if(passthroughGroup instanceof EVWEB2.UserPermissions) {
                this.passthroughPermissions = passthroughGroup;

                var passthroughGroupPermissions = EVWEB2.util.internal
                    .generateGroupPermissions(this.passthroughPermissions);
                this.passthroughGroup = new EVWEB2.UserGroup('', undefined, passthroughGroupPermissions,
                                                    undefined, '', undefined);
            }
            else if(passthroughGroup instanceof EVWEB2.UserGroup) {
                this.passthroughGroup = passthroughGroup;
                this.passthroughPermissions = EVWEB2.util.internal
                    .generateUserPermissions(this.passthroughGroup.permissions,
                                                    this.passthroughGroup.accessLevel);
            }
        }
        if(managedFeatures !== undefined) {
            this.managedFeatures = managedFeatures;
        }

        if (canAutoLogin !== undefined) {
            this.canAutoLogin = canAutoLogin;
        }


        /**
         * Returns whether the server connection is connected as a passthrough server or through login and password.
         * @return {Boolean} Whether the server connection is a passthrough
         */
        this.isPassthroughServer = function() {
            return !this.loginRequired && this.id === this.sessionId;
        };

        /**
         * Returns whether the server connection is logged in, regardless of the passthrough setting.
         * @return {Boolean} Whether the server connection is logged in
         */
        this.isLoggedIn = function() {
            return this.id !== this.sessionId && this.sessionId !== '';
        };

        /**
         * @deprecated This method is deprecated in favor of {@link EVWEB2.getCurrentGroupPermissions} which returns the
         * permissions associated with a group.
         * Retrieves the current permissions for the server, whether logged in or passthrough.
         * @return {EVWEB2.UserPermissions} The current permissions
         */
        this.getCurrentPermissions = function() {
            if(this.isLoggedIn()) {
                return this.userPermissions;
            }
            return this.passthroughPermissions;
        };

        /**
         * Retrieves the current permissions associated with a group, whether logged in or passthrough.
         * @return {EVWEB2.UserGroupPermissions} The current group permissions
         */
        this.getCurrentGroupPermissions = function() {
            if(this.isLoggedIn()) {
                return this.userGroup.permissions;
            }
            return this.passthroughGroup.permissions;
        };

        /**
         * Retrieves the current group object, whether logged in or passthrough.
         * @return {EVWEB2.UserGroup} The current group
         */
        this.getCurrentGroup = function() {
            if(this.isLoggedIn()) {
                return this.userGroup;
            }
            return this.passthroughGroup;
        };

        /**
         * Processes the JSON output from a login response, updating the current server instance.
         * @param {Object} data The login response data
         * @param {String} username The username
         */
        var processLoginResponse = function(data, username) {
            // Update the session ID and username
            instance.sessionId = data.sessionId;
            instance.username = username;
            if(data.name !== undefined) {
                instance.name = data.name;
            }

            // Update the detailsInfo
            instance.detailInfo =  new EVWEB2.ServerDetailInfo(data.address, data.port, data.model, data.serial,
                data.version, data.daysRecordedVideo);

            var license = data.licenseInfo;
            if(license !== undefined) {
                // Additional server information is available
                var expirationDate = EVWEB2.util.IETF2Date(license.expirationDate);
                instance.licenseInfo = new EVWEB2.ServerLicenseInfo(license.macAddress, expirationDate, license.expired,
                    license.restricted, license.enterprise, license.maxAnalogCameras, license.maxIpCameras,
                    license.maxBoards, license.licenseType, license.licenseKey);
            }

            var userPermissions;
            var customGroupPermissions;

            if(data.group !== undefined && data.group !== null) {
                var group = data.group;

                userPermissions = EVWEB2.util.internal.processUserGroupPermissions(group.permissions);
                customGroupPermissions = new EVWEB2.CustomGroupPermissions(group.cameras, group.audios, group.serials,
                                            group.softTriggers);
                instance.userGroup = new EVWEB2.UserGroup(group.name, group.role, userPermissions, group.priorities,
                                                    group.guid, customGroupPermissions);

                instance.userPermissions = EVWEB2.util.internal.generateUserPermissions(instance.userGroup.permissions,
                                            instance.userGroup.accessLevel);
            }
            else {
                userPermissions = EVWEB2.util.processServerPermissions(data);
                instance.userPermissions = userPermissions;

                var userGroupPermissions = EVWEB2.util.internal.generateGroupPermissions(instance.userPermissions);
                instance.userGroup = new EVWEB2.UserGroup('', undefined, userGroupPermissions,
                    undefined, '', undefined);
            }
        };

        /**
         * The login function is a handler and parser for the authenticated server session functionality
         * of the exacqVision web service.  This function is to be utilized as a method for accessing the targeted
         * server using credentials-based access (instead of a pre-configured passthrough).  It takes the desired
         * username/password combination and requests the server for an authenticated session.  If the request is
         * granted, a unique session ID is applied to the server instance to allow for further communication
         * with the server
         *
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response, the instance of the
         * {@link EVWEB2.Server}, and, if requested, the login session token.
         * @param {String} username The username credential for logging into the server
         * @param {String} password The password credential for logging into the server
         * @param {Boolean} [saveCredentials=false] Whether to save the credentials and generate a login token.
         */
        this.login = function (callback, username, password, saveCredentials) {

            var server = this;

            if(saveCredentials === undefined) {
                saveCredentials = false;
            }

            // Forward-declaring due to circular dependencies
            var processLegacyResponse30;

            var onLoginServerError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                var responseIsJson = false;
                try {
                    JSON.parse(xhr.responseText);
                    responseIsJson = true;
                }
                catch (e) {
                    responseIsJson = false;
                }

                if(xhr.status === 200 && !responseIsJson) {
                    if(xhr.responseText !== EVWEB2.errors.login && xhr.responseText.search('<body>') === -1) {
                        processLegacyResponse30(xhr.responseText, xhr);
                        return;
                    }
                }
                if(xhr.status === 200 || xhr.status === 403) {
                    errorResponse.errorText = 'Incorrect Username/Password.';
                }
                else if(xhr.status === 409) {
                    errorResponse.errorText = 'Restricted server limit reached.';
                }
                callback(errorResponse, server);
            };

            /**
             * Processes legacy responses from 3.0 and prior web services.  The response
             * is in the form of a string of the session ID data, a HTTP error response
             * on the XHR object, or the login page template HTML.
             * @param {String} sessionId The session ID of the response.
             * @param {Object} xhr The XHR object of the request.
             */
            processLegacyResponse30 = function(sessionId, xhr) {
                if(sessionId === EVWEB2.errors.login || sessionId.search('<body>') !== -1) {
                    onLoginServerError(xhr);
                    return;
                }
                server.sessionId = sessionId;
                server.username = username;
                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, server);
            };

            /**
             * Processes legacy responses from 3.2-3.8 web services. The response is an object
             * containing the session ID, but no other information, such as detailInfo is
             * provided.
             * @param {Object} data The response data
             * @param {String} username The username used to login
             */
            var processLegacyResponse32_38 = function(data, username) {
                server.sessionId = data.sessionId;
                server.username = username;
            };

            var onLoginServerSuccess = function(data, textStatus, xhr) {
                if(typeof data === 'string') {
                    processLegacyResponse30(data, xhr);
                    return;
                }
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    if(errorResponse.errorText === EVWEB2.errors.jsonLoginFailed) {
                        errorResponse.errorText = 'Incorrect Username/Password.';
                    }
                    callback(errorResponse, server);
                    return;
                }
                if(data.address === undefined && data.name === undefined) {
                    processLegacyResponse32_38(data, username);
                }
                else {
                    processLoginResponse(data, username);
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, server, data.token);
            };

            var settings = {
                success: onLoginServerSuccess,
                error: onLoginServerError,
                url: this.service.url() + EVWEB2.urls.login,
                type: 'POST',
                dataType: 'json',
                data: {
                    u: username,
                    p: password,
                    l: 1,
                    s: this.id,
                    output: 'json',
                    responseVersion: 2
                }
            };

            if(saveCredentials) {
                settings.data.save = '1';
            }

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * The loginToken function is a convenience method for saving login credentials with a valid token
         * takes the place of a password.
         * Note: Tokens expire after one use, be sure to always store the most recently generated token.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, the instance of the
         *  {@link EVWEB2.Server}, and the generated stored login credentials token.
         * @param {String} username The username credential for logging into the server
         * @param {String} token The stored login credentials token for logging into the server
         */
        this.loginToken = function(callback, username, token) {
            var server = this;

            var onLoginTokenError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse, server);
            };

            var onLoginTokenSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse, server);
                    return;
                }

                processLoginResponse(data, username);

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, server, data.token);
            };

            var settings = {
                success: onLoginTokenSuccess,
                error: onLoginTokenError,
                url: this.service.url() + EVWEB2.urls.login,
                type: 'POST',
                dataType: 'json',
                data: {
                    u: username,
                    token: token,
                    s: this.id
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Login with stored credentials (this can only be used if the 'canAutoLogin' property is true).
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, and the {@link EVWEB2.Server}
         *  instance.
         */
        this.loginStoredCredentials = function(callback) {
            var server = this;

            if (!server.canAutoLogin) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No stored credentials available.');
                callback(errorResponse, server);
                return;
            }

            var onLoginStoredCredentialsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse, server);
            };

            var onLoginStoredCredentialsSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse, server);
                    return;
                }

                processLoginResponse(data, '');

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, server);
            };

            var settings = {
                success: onLoginStoredCredentialsSuccess,
                error: onLoginStoredCredentialsError,
                url: this.service.url() + EVWEB2.urls.login,
                type: 'POST',
                dataType: 'json',
                data: {
                    s: this.id,
                    auto_login: true,
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * The logout function is a simple calling function the performs a call to the exacqVision
         * web service to logout of the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.logout = function (callback) {
            var server = this;

            var resetServerItems = function() {
                server.username = '';
                server.sessionId = server.id;
                if(server.userPermissions !== null) {
                    server.userPermissions = null;
                }

                if (server.loginRequired) {
                    if(server.detailInfo !== null) {
                        server.detailInfo.version = '';
                        server.detailInfo.daysRecordedVideo = 0;
                    }
                    if(server.licenseInfo !== null) {
                        server.licenseInfo = null;
                    }
                }
            };

            var onLogoutServerError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                resetServerItems();
                if(typeof callback === 'function') {
                    callback(errorResponse);
                }
            };

            var onLogoutServerSuccess = function(/*data, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(true);
                resetServerItems();
                if(typeof callback === 'function') {
                    callback(successResponse);
                }
            };

            var settings = {
                success: onLogoutServerSuccess,
                error: onLogoutServerError,
                url: this.service.url() + EVWEB2.urls.logout,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        var responseToCameraInstance = function(response, server) {
            var disabled = response.disabled !== 0;
            var video = response.state === 0;
            // The state property is not provided in 2.0 services, so manually add it.
            if(response.state === undefined && response.disabled === 0) {
                video = true;
            }

            var ptz = response.ptz === 1;
            var ptzType = EVWEB2.ptzTypes.none;
            if(ptz) {
                ptzType = EVWEB2.ptzTypes.standard;
            }

            if(response.id === undefined) {
                // Generate the ID from the plugin, interface, device, and context IDs.
                response.id = EVWEB2.util.pidToCameraId(response.p, response.i, response.d, response.ctx);
            }

            var resolution;
            if(response.resolution !== undefined) {
                resolution = new EVWEB2.CameraResolution(response.resolution.width, response.resolution.height);
            }

            return new EVWEB2.Camera(server, response.id, response.ctx, response.name, ptz, disabled, video,
                response.OSD, ptzType, response.digitalPtz, response.formats, resolution, response.quality,
                response.frameRate, response.parentId, response.rotation);
        };

        /**
         *	The getCameras function is meant to act as a handler and parser for list retrieval from the exacqVision
         *	web service back-end.  It uses asynchronous javascript requests to the server for information on
         *	the available camera feeds available from the requested server.  The information received from this call
         *	is then parsed and properly formatted into {@link EVWEB2.Camera} objects that then provide the proper
         *	methods for viewing the camera feeds.
         *
         *  @param {Function} callback Callback function to be executed when the call completes. The function gets
         *  passed three arguments: {@link EVWEB2.ResponseStatus} instance with the details of the response, an array
         *  of {@link EVWEB2.Camera} instances, and a modified instance of {@link EVWEB2.Server}. (Note: The instance
         *  used for the call is modified as well.)
         *  @param {Boolean} [showAll=false] Disable legacy filtering that removes camera sub-contexts that are
         *  quality streams. Sub-contexts saved in views are still returned.
         */
        this.getCameras = function (callback, showAll) {

            if (typeof showAll === 'undefined') {
                showAll = false;
            }

            var onGetCamerasError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };
            var server = this;
            var onGetCamerasSuccess = function(data/*, textStatus, xhr*/) {
                if(data === EVWEB2.errors.config) {
                    //Call the error callback
                    onGetCamerasError();
                    return;
                }

                // v2.0 web services don't return a proper JSON object, as no callback wraps the response.  For these
                // responses, attempt to manually parse the JSON.
                if(typeof data === 'string') {
                    try {
                        data = JSON.parse(data);
                    }
                    catch(err) {
                        onGetCamerasError();
                        return;
                    }
                }

                var resultList = data.Cameras;

                var cameraList = $.map(resultList, function(element) {
                    return responseToCameraInstance(element, server);
                });

                //Update the server with additional information
                if(data.timezone !== undefined) {
                    server.gmtOffset = data.timezone;
                    //TODO: Find out why server.osd is set this way and remove, if possible.
                    server.osd = true;
                }
                if(data.restricted !== undefined) {
                    server.restricted = data.restricted;
                }

                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, cameraList, server);
            };

            var params = {
                s: this.sessionId,
                output: 'json',
                showAll: showAll ? 1 : 0
            };

            var settings = {
                success: onGetCamerasSuccess,
                error: onGetCamerasError,
                url: this.service.url() + EVWEB2.urls.getCameraList,
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         *	The getAudioDevices function is meant to act as a handler and parser for list retrieval from the
         *	exacqVision web service back-end.  It uses asynchronous javascript requests to the server for information
         *	on the available audio inputs available from the requested server.  The information received from this
         *	call is then parsed and properly formatted into {@link EVWEB2.AudioDevice} objects that then provide the
         *	proper methods for using the audio input streams.
         *
         *  @param {Function} callback Callback function to be executed when the call completes. The function gets
         *  passed three arguments: {@link EVWEB2.ResponseStatus} instance with the details of the response and an
         *  array of {@link EVWEB2.AudioDevice} instances.
         */
        this.getAudioDevices = function (callback) {

            var onGetAudioInputsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };
            var server = this;
            var onGetAudioInputsSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success || data === EVWEB2.errors.config) {
                    //Call the error callback
                    onGetAudioInputsError();
                    return;
                }

                var resultList = data.audio;

                var audioInputList = $.map(resultList, function(element) {
                    return new EVWEB2.AudioDevice(server, element.id, element.name, element.enabled, element.input,
                        element.output, element.format, element.frequency);
                });

                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, audioInputList);
            };

            var params = {
                s: this.sessionId,
                output: 'json'
            };

            var settings = {
                success: onGetAudioInputsSuccess,
                error: onGetAudioInputsError,
                url: this.service.url() + EVWEB2.urls.audio,
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Starts an export on the selected inputs for the set duration.
         * @param {Function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance and
         * an {@link EVWEB2.VideoExport} instance, which is used to monitor and retrieve
         * the export.
         * @param {EVWEB2.Camera[]|EVWEB2.AudioDevice[]|EVWEB2.SerialDevice} inputs The inputs to export.  Can be a
         * mixed list of {@link EVWEB2.Camera}, {@link EVWEB2.AudioDevice}, and {@link EVWEB2.SerialDevice} instances.
         * @param {EVWEB2.videoExportFormatTypes} format The export format type requested.
         * @param {Date} start Date object representing the beginning of the requested period.
         * @param {Date} end Date object representing the end of the requested period.
         * @param {String} [name="Export"] The file name (without extension) to be given to
         * the download.
         */
        this.videoExport = function (callback, inputs, format, start, end, name) {
            var server = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            /**
             * Handles the success response from starting an export.
             * @param {object} data The response data
             * @param {String} data.export_id The generated export ID
             * @param {Boolean} data.success Whether the request was successful
             * @param {String} data.errorText Any error text associated with a failed request.
             * @param {String[]} data.filenames The filenames for the export.
             */
            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var videoExport = new EVWEB2.VideoExport(server, data.export_id, inputs, format,
                    start, end, data.filenames);
                if(typeof callback === 'function') {
                    callback(successResponse, videoExport);
                }
            };

            var inputQuery = '';
            var i;
            for(i=0; i<inputs.length; i++) {
                if(inputs[i].id !== undefined) {
                    if(inputQuery.length === 0) {
                        inputQuery += '?';
                    }
                    else {
                        inputQuery += '&';
                    }
                    var queryVal;
                    if(inputs[i] instanceof EVWEB2.Camera) {
                        queryVal = 'camera';
                    }
                    else if(inputs[i] instanceof EVWEB2.AudioDevice ) {
                        queryVal = 'audio';
                    }
                    else if(inputs[i] instanceof EVWEB2.SerialDevice ) {
                        queryVal = 'serial';
                    }
                    inputQuery += queryVal + '='+ inputs[i].id;
                }
            }

            if(name === undefined) {
                name = 'Export';
            }

            var params = {
                s: server.sessionId,
                start: EVWEB2.util.Date2IETF(start),
                end: EVWEB2.util.Date2IETF(end),
                name: name,
                format: format
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.videoexport + inputQuery,
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Whether calls to this server require resource keys applied to state-changing operations.
         * @return {Boolean} Whether this server requires resource keys
         */
        this.requiresResourceKey = function() {
            return this.isPassthroughServer() && this.service.csrf;
        };

        /**
         * Retrieves the status for the requested items.
         * @param {Function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance and
         * a {@link EVWEB2.Status} instance, which details the status of each requested item.
         * @param {EVWEB2.Camera[]|EVWEB2.Trigger[]|EVWEB2.Map[]} items An array of items to retrieve status.
         * This can be a mixed array of the specified instances.
         */
        this.getStatus = function (callback, items) {
            var server = this;

            var onGetStatusError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetStatusSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var cameraStatuses = $.map(data.camera, function(element) {
                    var instance = $.grep(items, function(item) {
                        return item instanceof EVWEB2.Camera && element.id.toString() === item.id.toString();
                    })[0];
                    return new EVWEB2.StatusCameraItem(instance, element.status.motion, element.status.loss);
                });
                var triggerStatuses = $.map(data.trigger, function(element) {
                    var instance = $.grep(items, function(item) {
                        return item instanceof EVWEB2.Trigger && element.id.toString() === item.id.toString();
                    })[0];
                    return new EVWEB2.StatusTriggerItem(instance, element.status.state);
                });
                var mapStatuses = $.map(data.map, function(element) {
                    var instance = $.grep(items, function(item) {
                        return item instanceof EVWEB2.Map && element.id.toString() === item.id.toString();
                    })[0];
                    return new EVWEB2.StatusMapItem(instance, element.status.motion, element.status.loss);
                });

                var status = new EVWEB2.Status(server, cameraStatuses, triggerStatuses, mapStatuses);
                callback(successResponse, status);
            };

            if(items.length === 0) {
                // If there are no items, just immediately send an empty response.
                var response = {
                    success: true,
                    camera: [],
                    trigger: [],
                    map: []
                };
                onGetStatusSuccess(response);
                return;
            }


            var queryString = $.map(items, function(element) {
                if(element instanceof EVWEB2.Camera) {
                    return 'camera=' + element.id.toString();
                }
                if(element instanceof EVWEB2.Trigger) {
                    return 'trigger=' + element.id.toString();
                }
                if(element instanceof EVWEB2.Map) {
                    return 'map=' + element.id.toString();
                }
            }).join('&');

            var params = {
                s: this.sessionId
            };

            var settings = {
                success: onGetStatusSuccess,
                error: onGetStatusError,
                url: this.service.url() + EVWEB2.urls.status + '?' + queryString,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Retrieves the overall status for the server.
         * @param {function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance and
         * a {@link EVWEB2.ServerStatus} instance, which details the overall status of the server.
         */
        this.getServerStatus = function (callback) {
            var onServiceGetServersStatus = function(response, statuses) {
                var serverItem;
                if(response.success) {
                    serverItem = statuses[0];
                }
                callback(response, serverItem);
            };

            this.service.getServersStatus(onServiceGetServersStatus, [this]);
        };

        /**
         * Notifies the server that a process is still in use.  This prevents an inactive server from being closed.
         * Note: This does not need to be called on passthrough servers, as they will never be closed.
         * @param {function} [callback] Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.notifyUse = function (callback) {
            var executeCallback = function(params) {
                if(callback !== undefined) {
                    callback(params);
                }
            };

            var onNotifyUseError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                executeCallback(errorResponse);
            };

            var onNotifyUseSuccess = function(data/*, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(data.success, data.errorText);
                executeCallback(successResponse);
            };

            if(!this.isLoggedIn() && !this.isPassthroughServer()) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'Non-logged in servers do not need notification.');
                executeCallback(errorResponse);
                return;
            }

            var settings = {
                success: onNotifyUseSuccess,
                error: onNotifyUseError,
                url: this.service.url() + EVWEB2.urls.login,
                data: {
                    s: this.sessionId,
                    action: 'notify'
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Checks with the server to verify that a process is still available. This prevents making accidental
         * requests to servers that have timed out due to inactivity and are no longer present.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance with the details of the response and a Boolean
         * indicating the validity of the session ID.
         */
        this.checkSession = function (callback) {
            var server = this;
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onCheckSessionError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onCheckSessionSuccess = function(data /*, textStatus, xhr*/){
                var successResponse = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(successResponse, data.isValid);
            };

            var settings = {
                success: onCheckSessionSuccess,
                error: onCheckSessionError,
                url: this.service.url() + EVWEB2.urls.login,
                data: {
                    s: this.sessionId,
                    action: 'verify'
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Retrieves the users information for the specified server.
         * @param {function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.SystemUsageInfo} instances,
         * which represent the usage information for each user on the server.
         */
        this.getSystemUsageInfo = function(callback) {
            var server = this;
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetSystemUsageInfoError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetSystemUsageInfoSuccess = function(data/*, textStatus, xhr*/) {
               var users = data.users;

               var usersList = $.map(users, function(element) {
                    return new EVWEB2.SystemUsageInfo(element.username, element.level, element.address,
                                                        element.streams, element.audit, element.instanceName);
               });
               var successResponse = new EVWEB2.ResponseStatus(true);
               callback(successResponse, usersList);
            };

            var settings = {
                success: onGetSystemUsageInfoSuccess,
                error: onGetSystemUsageInfoError,
                url: this.service.url() + EVWEB2.urls.serverUsers,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Retrieves the plugin information from the specified server.
         * @param {function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.SystemPluginInfo} instances,
         * which represent the version information and status for each plugin/library on the server.
         */
        this.getSystemPluginInfo = function(callback) {
            var server = this;
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetSystemPluginInfoError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetSystemPluginInfoSuccess = function(data/*, textStatus, xhr*/) {
                var plugins = data.plugins;

                var pluginsList = $.map(plugins, function(element) {
                    return new EVWEB2.SystemPluginInfo(element.name, element.filename, element.version, element.isOpen,
                                                            element.openCode);
                });
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, pluginsList);
            };

            var settings = {
                success: onGetSystemPluginInfoSuccess,
                error: onGetSystemPluginInfoError,
                url: this.service.url() + EVWEB2.urls.serverPlugins,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Get the current configuration information from the system.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and a {@link EVWEB2.SystemConfig} instance.
         */
        this.getSystemInformation = function(callback) {
            var server = this;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetSystemInfoError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetSystemInfoSuccess = function(data/*, textStatus, xhr*/) {
                var isUtf8Enabled = data.utf8Enabled;
                var systemName = data.systemName;
                var systemHardwareInfo = new EVWEB2.SystemHardwareInfo(data.serialNumber, data.modelNumber,
                    data.motherboard, data.bios, data.processor, data.totalMemory, data.os, data.runningSince);

                var systemConfigInfo = new EVWEB2.SystemConfig(server, systemName, systemHardwareInfo, isUtf8Enabled);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, systemConfigInfo);
            };

            var settings = {
                success: onGetSystemInfoSuccess,
                error: onGetSystemInfoError,
                url: this.service.url() + EVWEB2.urls.systemInfo,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Retrieve a list of the custom groups available on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance, an array of {@link EVWEB2.UserGroup} instances and the associated
         * {@link EVWEB2.Server} instance.
         */
        this.getUserGroups = function(callback) {
            var server = this;
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetUserGroupsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetUserGroupsSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var customGroupsList = data.groups;

                var customUserGroups = $.map(customGroupsList, function(element) {
                    var accessLevel = element.role;

                    var permissions = EVWEB2.util.internal.processUserGroupPermissions(element.permissions);

                    var priorities = $.map(element.priorities, function(elem) {
                        return new EVWEB2.UserGroupPriority(elem.priority, elem.value);
                    });

                    var customGroupPermissions = new EVWEB2.CustomGroupPermissions(element.cameras, element.audios,
                                                        element.serials, element.softTriggers);

                    return new EVWEB2.UserGroup(element.name, accessLevel, permissions, priorities, element.guid,
                                                    customGroupPermissions, element.managed);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, customUserGroups, server);
            };

            var settings = {
                success: onGetUserGroupsSuccess,
                error: onGetUserGroupsError,
                url: this.service.url() + EVWEB2.urls.userGroups,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Retrieve a list of users that exist on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance, an array of {@link EVWEB2.User} instances and the associated
         * {@link EVWEB2.Server} instance.
         */
        this.getUsers = function(callback) {
            var server = this;
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetUsersError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetUsersSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var usersList = data.users;
                var users = $.map(usersList, function(element) {
                    return new EVWEB2.User(server, element.name, element.groupName, element.accountType,
                        element.isOrphaned, element.managed);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, users, server);
            };

            var settings = {
                success: onGetUsersSuccess,
                error: onGetUsersError,
                url: this.service.url() + EVWEB2.urls.users,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Add a new user to the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance.
         * @param {EVWEB2.UserGroup} userGroup The user group information.
         * @param {EVWEB2.User} user The user to create.
         * @param {String} password The password for the new user account.
         */
        this.addUser = function(callback, userGroup, user, password) {
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onAddUserError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onAddUserSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, user, userGroup, password);
            };

            var bitmask = EVWEB2.util.internal.generatePermissionsBitmask(userGroup.permissions);

            var params = {
                s: this.sessionId,
                name: user.username,
                password: password,
                role: userGroup.accessLevel,
                accountType: user.accountType,
                guid: userGroup.guid,
                grpName: userGroup.name,
                grpGroupPermission: bitmask.group,
                grpUserPermission: bitmask.user,
                grpAdminPermission: bitmask.admin,
                grpCameras: userGroup.customGroupPermissions.cameras.join(","),
                grpAudios: userGroup.customGroupPermissions.audios.join(","),
                grpSerials: userGroup.customGroupPermissions.serials.join(","),
                grpSoftTriggers: userGroup.customGroupPermissions.softTriggers.join(",")
            };

            var priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.ptz);
            if (priority !== undefined){
                params['grpPtzPriority'] = priority.value;
            }

            priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.twoWayAudio);
            if (priority !== undefined){
                params['grpAudioPriority'] = priority.value;
            }

            priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.client);
            if (priority !== undefined){
                params['grpRemotePriority'] = priority.value;
            }

            var settings = {
                success: onAddUserSuccess,
                error: onAddUserError,
                url: this.service.url() + EVWEB2.urls.users,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Retrieves the security integrations devices for this server.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SecurityIntegrationsDevice} objects detailing all of the security integrations devices
         *   associated with the
         *  server.
         */
        this.getSecurityIntegrationsDevices = function(callback) {
            var server = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                // Process the devices
                var devices = $.map(data.devices, function(element) {
                    return new EVWEB2.SecurityIntegrationsDevice(server, element.id, element.name, element.host,
                        element.port, element.type, element.enabled, element.connectionStatus, element.firmware,
                        element.serial, element.user, element.auth);
                });

                callback(successResponse, devices);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.securityIntegrationDevices,
                data: {
                    s: server.sessionId
                }
            };

            if(server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves the basic serial configuration information.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an
         *  {@link EVWEB2.ServerSerialSupport} instance.
         */
        this.getSerialInfo = function(callback) {
            var server = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var dataSupports = data.serial.supports;
                var serialSupports = new EVWEB2.ServerSerialFunctionality(dataSupports.advancedLineEnding,
                    dataSupports.sotMarkers, dataSupports.xmlFormatting, dataSupports.replace, dataSupports.rules);
                var serialInfo = new EVWEB2.ServerSerialSupport(server, serialSupports, data.serial.uart,
                    data.serial.ip, data.serial.uses, data.serial.ipTypes);

                callback(successResponse, serialInfo);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.serverSerialInfo,
                data: {
                    s: server.sessionId
                }
            };

            if(server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);

        };

        /**
         * Retrieves a list of serial devices on this server.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialDevice} objects.
         */
        this.getSerialDevices  = function(callback) {
            var server = this;

            /**
             * Maps serial device data received from the web service to a {@link EVWEB2.SerialDevice} instance.
             * @private
             * @param {Array} data Array of data objects to convert
             * @param {EVWEB2.SerialDeviceTypes} type The type of data represented.
             * @return {EVWEB2.SerialDevice} The serial device
             */
            var dataToSerialDevice = function(data, type) {
                return $.map(data, function(element) {
                    var connectionInfo;
                    if(type === EVWEB2.SerialDeviceTypes.Uart) {
                        connectionInfo = new EVWEB2.UartSerialDeviceConnectionInfo(element.port, element.baudRate,
                            element.dataBits, element.stopBits, element.parity, element.flowControl);
                    }
                    else if(type === EVWEB2.SerialDeviceTypes.Ip) {
                        connectionInfo = new EVWEB2.IpSerialDeviceConnectionInfo(element.address, element.type,
                            element.ipPort, element.remotePort);
                    }

                    var lineInfo = new EVWEB2.SerialDeviceLineInfo(element.maxLineLength, element.lineEnding,
                        element.timeout);

                    return new EVWEB2.SerialDevice(server, element.id, element.name, connectionInfo, lineInfo,
                        element.use, type, element.profile);

                });
            };

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var devices = dataToSerialDevice(data.uart, EVWEB2.SerialDeviceTypes.Uart);

                devices = devices.concat(dataToSerialDevice(data.ip, EVWEB2.SerialDeviceTypes.Ip));

                callback(successResponse, devices);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.serialDevices,
                data: {
                    s: server.sessionId
                }
            };

            if(server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);

        };

        /**
         * Retrieves a list of serial profiles on this server.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialProfile} objects.
         */
        this.getSerialProfiles  = function(callback) {
            var server = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var devices = $.map(data.profiles, function(element) {
                    var display = element.display;
                    var fontInfo = new EVWEB2.FontInfo(display.fontName, display.fontSize, display.fontStyle,
                        display.fontColor, display.fontFamily, display.fontWeight, display.underline);
                    var caseSens = element.caseSensitivity;
                    var caseSensitivity = new EVWEB2.SerialCaseSensitivity(caseSens.transmissionMarkers,
                        caseSens.keywords, caseSens.masks, caseSens.replacements, caseSens.rules);
                    var mark = element.markers;
                    var markers = new EVWEB2.SerialProfileMarkers(mark.type, mark.start, mark.end);
                    return new EVWEB2.SerialProfile(server, element.id, element.name, fontInfo, caseSensitivity,
                        markers, element.retention);
                });

                callback(successResponse, devices);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.serialProfiles,
                data: {
                    s: server.sessionId
                }
            };

            if(server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves a list of active events on this server.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.Event} objects.
         * @param {EVWEB2.EventType[]} [filter=[]] An array of event types to filter with.  If none are specified,
         *  all events are returned.
         */
        this.getEvents = function(callback, filter) {
            var server = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var events = $.map(data.events, function(element) {
                    var extraInfo;
                    if(element.extra !== undefined) {
                        extraInfo = new EVWEB2.EventExtraInfo(server, element.extra.item, element.extra.type);
                    }
                    return new EVWEB2.Event(server, element.event, EVWEB2.util.IETF2Date(element.time),
                        element.device, extraInfo);
                });

                callback(successResponse, events);
            };

            var data = {
                s: server.sessionId
            };
            if(filter !== undefined) {
                data.filter = filter;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: server.service.url() + EVWEB2.urls.events,
                data: data,
                traditional: true
            };

            if(server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Callback invoked by
         * {@link EVWEB2.Server#getAnalyticRules|getAnalyticRules()}.
         * @callback EVWEB2.Server~onGetAnalyticRules
         * @param {EVWEB2.ResponseStatus} response Success state of the response.
         * @param {EVWEB2.AnalyticRule[]} rules The analytic rules configured on this server.
         */
        /**
         * List analytic rules on this server.
         * @param {EVWEB2.Server~onGetAnalyticRules} callback Callback to be invoked on completion.
         */
        this.getAnalyticRules = function(callback) {
            var server = this;

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if (!data.success) {
                    callback(new EVWEB2.ResponseStatus(false, data.errorText));
                    return;
                }

                var rules = data.rules.map(function(rule) {
                    var osdConfig = new EVWEB2.AnalyticRuleOSDConfig(
                        EVWEB2.util.RGBA(rule.osdInfo.backgroundColor, rule.osdInfo.backgroundOpacity),
                        EVWEB2.util.RGBA(rule.osdInfo.borderColor, rule.osdInfo.borderOpacity)
                    );

                    // this endpoint existed for one quarter (19.06 release) without the templates list,
                    // don't choke on mapping if it isn't present
                    var metadataTemplates;
                    if (rule.metadataTemplates) {
                        metadataTemplates = rule.metadataTemplates.map(function(template) {
                            return new EVWEB2.EventMetadataTemplate(template.key, template.valueType);
                        });
                    }

                    var source;
                    if (rule.sourceType === EVWEB2.analyticRuleSourceType.camera) {
                        source = new EVWEB2.AssociatedCameraSource(rule.sourceId.id);
                    } else if (rule.sourceType === EVWEB2.analyticRuleSourceType.audio) {
                        source = new EVWEB2.AssociatedAudioSource(rule.sourceId.id);
                    }
                    return new EVWEB2.AnalyticRule(server, rule.ruleId, rule.deviceId, source, rule.name, osdConfig,
                        rule.metadataEnabled, metadataTemplates);
                });
                callback(new EVWEB2.ResponseStatus(true), rules);
            };
            var onError = function(xhr/*,textStatus, errorThrown*/) {
                callback(new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr)));
            };
            
            EVWEB2.ajax({
                method: 'GET',
                url: this.service.url() + EVWEB2.urls.analyticRules,
                data: {
                    s: this.sessionId
                },
                success: onSuccess,
                error: onError
            }, this.service);
        };
    };
}());

/*globals EVWEB2:true*/
(function() {
    /**
     * Definitions for the trigger states (On/Off) used by {@link EVWEB2.Trigger.toggle}
     * @enum {number}
     * @readonly
     * @category Soft Triggers
     */
    EVWEB2.triggerState = {
        /**
         * Off
         */
        off: 0,
        /**
         * On
         */
        on: 1,
        /**
         * Unknown
         */
        unknown: -1
    };

    /**
     * The Trigger object is a wrapped object that handles the control of a soft trigger on a server. The objects are
     * generated in an array from {@link EVWEB2.getTriggers} that will retrieve the soft triggers available on a
     * server.  The object holds the polling timer for keeping a trigger held to "on" (as triggers automatically
     * turn off after 5 seconds).
     * @param {EVWEB2.Server} [server=null] The server instance of the trigger.
     * @param {String} [id=''] The ID of the trigger.
     * @param {String} [name='Unnamed Trigger'] The name of the trigger.
     * @param {EVWEB2.triggerState} [state=EVWEB2.triggerState.unknown] The state of the soft trigger.
     * @class
     * @category Soft Triggers
     */
    EVWEB2.Trigger = function (server, id, name, state) {
        /**
         * Server the soft trigger belongs to
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * ID of the soft trigger on the server
         * @type String
         */
        this.id = '';

        /**
         * Name of the soft trigger
         * @type String
         */
        this.name = 'Unnamed Trigger';

        /**
         * State of the soft trigger
         * @type EVWEB2.triggerState
         */
        this.state = EVWEB2.triggerState.unknown;

        /**
         * The interval key for polling a trigger.
         * @private
         * @type Number
         */
        var triggerCheckInterval = -1;

        /**
         * An internally-scoped reference to this.
         * @private
         * @type Object
         */
        var self = this;

        //Assign the constructor values
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof state !== 'undefined') {
            this.state = state;
        }

        /**
         * @ignore
         */
        var triggerCheck = function() {
            self.toggle(EVWEB2.triggerState.on);
        };

        /**
         *  The toggle method is used to toggle the trigger on or off.  If it is being turned on,
         *  a timer will be set to continue polling the server that the trigger is on to preserve the state
         *  until the switch is set to off.  If no state parameter is given, the state will toggle.
         *  @param {EVWEB2.triggerState} [state] The new state of the trigger
         *  @return {EVWEB2.triggerState} The updated state
         */
        this.toggle = function (state) {
            //Update the state
            if (typeof state === "undefined") {
                //Toggle the state
                if (this.state === EVWEB2.triggerState.off) {
                    this.state = EVWEB2.triggerState.on;
                }
                else {
                    this.state = EVWEB2.triggerState.off;
                }
            } else {
                this.state = state;
            }
            if(this.state === EVWEB2.triggerState.off) {
                // turn off timer
                clearInterval(triggerCheckInterval);
                triggerCheckInterval = -1;
            }
            else {
                // establish timer
                if(triggerCheckInterval === -1) {
                    triggerCheckInterval = setInterval(triggerCheck, EVWEB2.config.triggerPollingRate);
                }
            }

            var params = {
                s: this.server.sessionId,
                tid: this.id,
                state: this.state === EVWEB2.triggerState.off ? 'off' : 'on'
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    clearInterval(triggerCheckInterval);
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var settings = {
                url: this.server.service.url() + EVWEB2.urls.trigger,
                type: 'POST',
                dataType: 'text',
                data: params
            };
            EVWEB2.ajax(settings, this.server.service, true);
            return this.state;
        };
    };

    /**
     * The getTriggers function is a retrieval function that will make a call for data from the exacqVision web
     * service back-end for a list of the soft triggers available on the designated server.  The function will
     * make the request from the server and parse the data returned to generate an array of the {@link EVWEB2.Trigger}
     * instances that will handle the calls to set the triggers as needed.
     *
     * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
     *  {@link EVWEB2.Trigger} instances.
     * @param {EVWEB2.Server} server The target server.
     * @category Soft Triggers
     */
    EVWEB2.getTriggers = function (callback, server) {
        var onGetTriggersError = function(/*xhr, textStatus, errorThrown*/) {
            var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
            callback(errorResponse);
        };

        var onGetTriggersSuccess = function(data/*, textStatus, xhr*/) {
            if(data === EVWEB2.errors.triggers) {
                //Call the error callback
                onGetTriggersError();
                return;
            }
            var resultList = data.Triggers;

            var triggerList = $.map(resultList, function(element) {
                return new EVWEB2.Trigger(server, element.id, element.name, element.state);
            });
            var successResponse = new EVWEB2.ResponseStatus(true);
            //Return the server list
            callback(successResponse, triggerList, server);
        };

        var settings = {
            success: onGetTriggersSuccess,
            error: onGetTriggersError,
            url: server.service.url() + EVWEB2.urls.trigger,
            data: {
                s: server.sessionId
            }
        };

        EVWEB2.ajax(settings, server.service);
    };

}());
/*globals EVWEB2:true*/
(function() {

    "use strict";

    /**
     * Definitions for types of View slot items returned from the server.
     * @enum {number}
     * @readonly
     * @category Views
     */
    EVWEB2.ViewSlotItemTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Camera
         */
        camera: 1,
        /**
         * Audio
         */
        audio: 2,
        /**
         * Serial
         */
        serial: 3,
        /**
         * Group
         */
        group: 4,
        /**
         * Soft Trigger
         */
        softTrigger: 5,
        /**
         * I/O Trigger
         */
        ioTrigger: 6,
        /**
         * Time Trigger
         */
        timeTrigger: 7
    };

    /**
     * The ViewFolder object is a wrapped object that represents a folder containing one or more views or folders.
     * The objects are generated in an array from {@link EVWEB2.getViews}.
     * @param {String} [id=''] The ID of the View Folder.
     * @param {String} [name=''] The name of the View Folder.
     * @param {String} [parentId=''] The parent ID of the View Folder.
     * @class
     * @category Views
     */
    EVWEB2.ViewFolder = function(id, name, parentId) {
        /**
         * The ID of the view folder
         * @type String
         */
        this.id = '';

        /**
         * Name of the view folder
         * @type String
         */
        this.name = '';

        /**
         * The ID of the view folder's parent folder
         * @type String
         */
        this.parentId = '';

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof parentId !== 'undefined') {
            this.parentId = parentId;
        }
    };

    /**
     * The ViewSlotItem object is a wrapped object that represents an item associated with a view. The objects are
     * generated in an array from {@link EVWEB2.Service.getViews}.
     * @param {String} [id=''] The ID of the associated item.
     * @param {EVWEB2.Server} [server=null] The server instance of the associated camera.
     * @param {Function} [type=null] The type reference of the item.
     * @param {Number} [slotIndex=0] The layout slot index that this view item corresponds to.
     * @param {EVWEB2.digitalPtzTypes} [digitalPtzType=null] The digital PTZ ID of the associated camera, if present.
     * @class
     * @constructor
     * @category Views
     */
    EVWEB2.ViewSlotItem = function(id, server, type, slotIndex, digitalPtzType) {
        /**
         * The ID of the item
         * @type String
         */
        this.id = '';

        /**
         * The ID of the server
         * @type String
         */
        this.server = '';

        /**
         * The server instance of the associated camera
         * @type EVWEB2.Server
         */
        this.serverInstance = null;

        /**
         * The type of the item (a reference to an EVWEB2 class)
         * @type Object
         */
        this.type = null;

        /**
         * The slot index for this item.
         * @type Number
         */
        this.slotIndex = 0;

        /**
         * The ID of the digital PTZ camera
         * @type EVWEB2.digitalPtzTypes
         */
        this.digitalPtzType = null;

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof server !== 'undefined') {
            this.server = server.id;
            this.serverInstance = server;
        }
        if(typeof type !== 'undefined') {
            this.type = type;
        }
        if(typeof slotIndex !== 'undefined') {
            this.slotIndex = slotIndex;
        }
        if(typeof digitalPtzType !== 'undefined') {
            this.digitalPtzType = digitalPtzType;
        }
    };


    /**
     * The ViewCameraInfo object is a wrapped object that represents a camera associated with a view. The objects are
     * generated in an array from {@link EVWEB2.getViews}.
     * Note: This class is only used in association with {@link EVWEB2.View.cameras} and has been deprecated in favor
     * of {@link EVWEB2.ViewSlotItem}.
     * @deprecated See {@link EVWEB2.ViewSlotItem} for non-deprecated usage.
     * @param {String} [camera=''] The camera ID of the associated camera.
     * @param {EVWEB2.Server} [server=null] The server instance of the associated camera.
     * @param {EVWEB2.digitalPtzTypes} [digitalPtzType=null] The digital PTZ ID of the associated camera, if present.
     * @class
     * @constructor
     * @category Views
     */
    EVWEB2.ViewCameraInfo = function(camera, server, digitalPtzType) {
        /**
         * The ID of the camera
         * @type String
         */
        this.camera = '';

        /**
         * The ID of the server
         * @type String
         */
        this.server = '';

        /**
         * The server instance of the associated camera
         * @type EVWEB2.Server
         */
        this.serverInstance = null;

        /**
         * The ID of the digital PTZ camera
         * @type EVWEB2.digitalPtzTypes
         */
        this.digitalPtzType = null;

        //Assign the constructor values
        if(typeof camera !== 'undefined') {
            this.camera = camera;
        }
        if(typeof server !== 'undefined') {
            this.server = server.id;
            this.serverInstance = server;
        }
        if(typeof digitalPtzType !== 'undefined') {
            this.digitalPtzType = digitalPtzType;
        }
    };

    /**
     * The ViewCameraInfo object is a wrapped object that represents a camera associated with a view. The objects are
     * generated in an array from {@link EVWEB2.getViews}.
     * @param {String} [id=''] The ID of the associated audio input.
     * @param {EVWEB2.Server} [server=null] The server instance of the associated camera.
     * @deprecated See {@link EVWEB2.ViewSlotItem} for non-deprecated usage.
     * @class
     * @constructor
     * @category Views
     */
    EVWEB2.ViewAudioInputInfo = function(id, server) {
        /**
         * The ID of the associated audio input.
         * @type String
         */
        this.id = '';

        /**
         * The ID of the server
         * @type String
         */
        this.server = '';

        /**
         * The server instance of the associated camera
         * @type EVWEB2.Server
         */
        this.serverInstance = null;

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof server !== 'undefined') {
            this.server = server.id;
            this.serverInstance = server;
        }
    };

    /**
     * The View object is a wrapped set of information for a server side view.  It just holds the properties of an
     * individual view.
     * @param {String} [name='Unnamed'] Name of the view.
     * @param {EVWEB2.ViewFolder} [folder=null] The view's container folder.
     * @param {EVWEB2.ViewSlotItem[]} [items=[]] Array of the items in the view.  Note: This class also supports an
     * array of {@link EVWEB2.ViewCameraInfo} for this property to retain legacy support.
     * @param {Number} [layout=-1] Number of video panels in this view.
     * @param {EVWEB2.Layout} [layoutInfo=null] Custom layout information for the view.
     * @param {Number} [order=-1] Order value for the view, used in sorting the view list.
     * @param {EVWEB2.ViewAudioInputInfo} [audioInput=null] The audio input in the view.
     * @param {String} [description=''] Description of the view.
     * @class
     * @category Views
     */
    EVWEB2.View = function (name, folder, items, layout, layoutInfo, order, audioInput, description) {
        /**
         * Name of the view
         * @type String
         */
        this.name = "Unnamed";

        /**
         * The ID of the View's container folder
         * @type EVWEB2.ViewFolder
         */
        this.folder = null;

        /**
         * Array of the objects in the view
         * @type EVWEB2.ViewSlotItem[]
         */
        this.items = [];

        /**
         * Array of the cameras in the view
         * @deprecated See {@link EVWEB2.View.items}
         * @type EVWEB2.ViewCameraInfo[]
         */
        this.cameras = [];

        /**
         * Number of video panels in this view
         * @type Number
         */
        this.layout = -1;

        /**
         * Layout information for the view
         * @type EVWEB2.Layout
         */
        this.layoutInfo = null;

        /**
         * Order value for the view, used in sorting the view list
         * @type Number
         */
        this.order = -1;

        /**
         * Audio input applied to this view
         * @deprecated See {@link EVWEB2.View.items}
         * @type EVWEB2.ViewAudioInputInfo
         */
        this.audioInput = null;

        /**
         * Description of the view
         * @type String
         */
        this.description = "";

        //Assign the constructor values
        if(name !== undefined) {
            this.name = name;
        }
        if(folder !== undefined) {
            this.folder = folder;
        }
        if( layout !== undefined) {
            this.layout = layout;
        }
        if(layoutInfo !== undefined) {
            this.layoutInfo = layoutInfo;
        }
        if(items !== undefined) {
            var itemsAreCameraInfo = $.grep(items, function(element) {
                return element instanceof EVWEB2.ViewCameraInfo;
            }).length > 0;

            if(itemsAreCameraInfo) {
                // Process the legacy formats
                this.items = $.map(items, function(element, index) {
                    if(element !== null) {
                        return new EVWEB2.ViewSlotItem(element.camera, element.serverInstance, EVWEB2.Camera, index,
                            element.digitalPtzType);
                    }
                });
                this.cameras = items;
            }
            else {
                this.items = items;
                this.cameras = [];

                var cameraItems = $.grep(this.items, function(element) {
                    return element.type === EVWEB2.Camera;
                });

                // Create an array of null items that is the size of the layout
                var camerasSize = cameraItems.length;
                if(this.layout !== -1) {
                    camerasSize = this.layout;
                }
                var i;
                for(i=0; i<camerasSize; i++) {
                    this.cameras[i] = null;
                }
                // Add in the view camera infos
                var instance = this;
                $.each(cameraItems, function(index, element) {
                    instance.cameras[element.slotIndex] = new EVWEB2.ViewCameraInfo(parseInt(element.id, 10),
                        element.serverInstance, element.digitalPtzType);
                });
                // Set the audio input value
                var audioItem = $.grep(this.items, function(element) {
                    return element.type === EVWEB2.AudioDevice;
                })[0];
                if(audioItem !== undefined) {
                    this.audioInput = new EVWEB2.ViewAudioInputInfo(audioItem.id, audioItem.serverInstance);
                }
            }
        }
        if(order !== undefined) {
            this.order = order;
        }
        if(audioInput !== undefined) {
            // Set the deprecated value
            this.audioInput = audioInput;

            // Add it to the items list.
            var audio = $.grep(this.items, function(element) {
                return element.type === EVWEB2.AudioDevice;
            })[0];
            if(audio === undefined) {
                this.items.push(
                    new EVWEB2.ViewSlotItem(audioInput.id, audioInput.serverInstance, EVWEB2.AudioDevice, 0));
            }
        }
        if(description !== undefined) {
            this.description = description;
        }

        /**
         * Applies the current digital PTZ settings for the selected slot in the view.  The provided camera must be a
         * created digital PTZ camera from the camera for the slot identified in {@link EVWEB2.View#cameras}.
         * This method is deprecated in favor of {@link EVWEB2.Camera.createDigitalPtzCamera}, which will also apply
         * any view-specific digital PTZ settings.  Additionally, this method does not support applying digital PTZ
         * settings for views received as a {@link EVWEB2.VideoPushMessage}.
         * @deprecated
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and the passed digital PTZ camera
         *  instance.
         * @param {Number} slot The slot in the view.
         * @param {EVWEB2.Camera} camera The digital PTZ camera to apply the settings.
         */
        this.applyDigitalPtzSettingsForSlot = function(callback, slot, camera) {
            var slotInfo = this.cameras[slot];

            var errorText;
            if(
                typeof slotInfo === 'undefined' ||
                slotInfo === null ||
                slotInfo.digitalPtzType === null
               ) {
                errorText = 'This view slot does not support digital PTZ.';
            }
            else if(camera.ptzType !== EVWEB2.ptzTypes.digital) {
                errorText = 'The provided camera is not a digital PTZ camera.';
            }
            else if(camera.sourceCamera.id !== slotInfo.camera) {
                errorText = 'The provided digital PTZ camera is not derived from the camera for this slot.';
            }
            else if(camera.digitalPtzType !== slotInfo.digitalPtzType) {
                errorText = 'The provided digital PTZ camera is not the correct type for this slot.';
            }
            if(typeof errorText !== 'undefined') {
                var errorResponse = new EVWEB2.ResponseStatus(false,errorText);
                callback(errorResponse);
                return;
            }

            var onApplyDigitalPtzSettingsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onApplyDigitalPtzSettingsSuccess = function(data/*, textStatus, xhr*/) {
                //Return the digital PTZ camera
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response, camera);
            };

            var settings = {
                success: onApplyDigitalPtzSettingsSuccess,
                error: onApplyDigitalPtzSettingsError,
                url: slotInfo.serverInstance.service.url() + EVWEB2.urls.digitalPtz,
                data: {
                    s: slotInfo.serverInstance.sessionId,
                    ptz: camera.id,
                    view: this.name,
                    folder: this.folder.name,
                    slot: slot
                }
            };

            EVWEB2.ajax(settings, slotInfo.serverInstance.service);
        };
    };

    /**
     *  The getViews function retrieves the server side views from the exacqVision servers.
     *  @deprecated This method is superceded by {@link EVWEB2.Service.getViews}.
     *  @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     *   {@link EVWEB2.ResponseStatus} instance with the details of the response, an array of {@link EVWEB2.View}
     *   instances, and an array of {@link EVWEB2.ViewFolder} instances.
     *  @param {EVWEB2.Server|EVWEB2.Server[]} servers A single {@link EVWEB2.Server} instance or an array of
     *  {@link EVWEB2.Server} instances
     *  @category Views
     */
    EVWEB2.getViews = function (callback, servers) {
        if(!$.isArray(servers)) {
            servers = [servers];
        }

        if(servers.length === 0) {
            var errorResponse = new EVWEB2.ResponseStatus(false,'No servers defined');
            callback(errorResponse);
        }

        servers[0].service.getViews(callback, servers);
   };

}());
/*globals EVWEB2:true*/
(function() {
    /**
     * Definitions for the metadata flags returned for a given metadata item.
     * @enum {string}
     * @readonly
     * @category Search
     */
    EVWEB2.metadataFlags = {
        /**
         * Free run
         */
        freeRun: 'freeRun',
        /**
         * Alarm
         */
        alarm: 'alarm',
        /**
         * Motion
         */
        motion: 'motion'
    };

    /**
     * Bit field values for flags.
     * @internal
     * @type {Number}
     * @category Search
     */
    var FLAG_FREE_RUN = 0x00;
    var FLAG_ALARM = 0x40;
    var FLAG_MOTION = 0x80;

    /**
     * A metadata item, representing a duration of a given metadata event.
     * @param {Date} [start=new Date()] The start date time of the metadata item.
     * @param {Date} [end=new Date()] The end date time of the metadata item.
     * @param {Number|EVWEB2.metadataFlags[]} flags The flags associated with the metadata event. If the value is a
     * number, it is treated as a bit field returned from the server
     * @class
     * @constructor
     * @category Search
     */
    EVWEB2.MetadataItem = function(start, end, flags) {

        /**
         * Start date of the metadata item
         * @type Date
         */
        this.start = new Date();

        /**
         * End date of the metadata item
         * @type Date
         */
        this.end = new Date();

        /**
         * The flags associated with this metadata item
         * @type Array
         */
        this.flags = [];

        /**
         * The active flag associated with the group of flags
         * @type {String}
         */
        this.activeFlag = '';

        if(typeof start !== 'undefined') {
            this.start = start;
        }
        if(typeof end !== 'undefined') {
            this.end = end;
        }
        /* eslint-disable no-bitwise */
        if(typeof flags !== 'undefined') {
            if(typeof flags === 'number') {
                if(flags === FLAG_FREE_RUN) {
                    //for Free Run
                    this.flags.push(EVWEB2.metadataFlags.freeRun);
                }
                if((flags&(FLAG_ALARM)) === FLAG_ALARM) {
                    //for Alarm
                    this.flags.push(EVWEB2.metadataFlags.alarm);
                }
                if((flags&(FLAG_MOTION)) === FLAG_MOTION) {
                    //for Motion
                    this.flags.push(EVWEB2.metadataFlags.motion);
                }
            }
            else {
                this.flags = flags;
            }

            // Set the active flag
            if($.inArray(EVWEB2.metadataFlags.alarm, this.flags) !== -1) {
                this.activeFlag = EVWEB2.metadataFlags.alarm;
            }

            else if($.inArray(EVWEB2.metadataFlags.motion, this.flags) !== -1) {
                this.activeFlag = EVWEB2.metadataFlags.motion;
            }

            else if($.inArray(EVWEB2.metadataFlags.freeRun, this.flags) !== -1) {
                this.activeFlag = EVWEB2.metadataFlags.freeRun;
            }
        }
        /* eslint-enable no-bitwise */
    };

    /**
     * A container for all metadata information associated with an input.
     * @param {EVWEB2.Camera|EVWEB2.AudioDevice} [instance=null] The input instance associated wtih the metadata.
     * @param {EVWEB2.MetadataItem[]} [metadata=[]] An array of all metadata items associated with the input for the
     * given time range
     * @param {Date} [start=new Date()] The start date time of the metadata information.
     * @param {Date} [end=new Date()] The end date time of the metadata information.
     * @class
     * @constructor
     * @category Search
     */
    EVWEB2.MetadataInformation = function(instance, metadata, start, end) {
        /**
         * The instance associated with this metadata
         * @type EVWEB2.Camera|EVWEB2.AudioDevice
         */
        this.instance = null;

        /**
         * The metadata items for this time range
         * @type EVWEB2.MetadataItem[]
         */
        this.metadata = [];

        /**
         * Start date of the search
         * @type Date
         */
        this.start = new Date();

        /**
         * End date of the search
         * @type Date
         */
        this.end = new Date();

        if(typeof instance !== 'undefined') {
            this.instance = instance;
        }
        if(typeof metadata !== 'undefined') {
            this.metadata = metadata;
        }
        if(typeof start !== 'undefined') {
            this.start = start;
        }
        if(typeof end !== 'undefined') {
            this.end = end;
        }
    };

    /**
     * A container for all metadata information requested by a call to {@link EVWEB2.getMetadata}.
     * @param {EVWEB2.MetadataInformation[]} [cameraMetadata=[]] The metadata information associated with the requested
     * {@link EVWEB2.Camera} instances.
     * @param {EVWEB2.MetadataInformation[]} [audioMetadata=[]] The metadata information associated with the requested
     * {@link EVWEB2.AudioDevice} instances.
     * @param {Date} [start=new Date()] The start date time of the requested metadata information.
     * @param {Date} [end=new Date()] The end date time of the requested metadata information.
     * @param {String} [sessionId=''] The generated session ID for the metadata instance.
     * @class
     * @constructor
     * @category Search
     */
    EVWEB2.Metadata = function(cameraMetadata, audioMetadata, start, end, sessionId) {
        /**
         * Server this Search is attached to
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * The session ID for the metadata instance.
         * @type String
         */
        this.sessionId = '';

        /**
         * Metadata information for the associated cameras
         * @type EVWEB2.MetadataInformation[]
         */
        this.cameras = [];

        /**
         * Metadata information for the associated audio input streams
         * @type EVWEB2.MetadataInformation[]
         */
        this.audioInputs = [];

        /**
         * Start date of the search
         * @type Date
         */
        this.start = new Date();

        /**
         * End date of the search
         * @type Date
         */
        this.end = new Date();

        if(typeof cameraMetadata !== 'undefined') {
            this.cameras = cameraMetadata;
            if(cameraMetadata.length > 0) {
                this.server = cameraMetadata[0].instance.server;
            }
        }
        if(typeof audioMetadata !== 'undefined') {
            this.audioInputs = audioMetadata;
            if(audioMetadata.length > 0) {
                this.server = audioMetadata[0].instance.server;
            }
        }
        if(typeof start !== 'undefined') {
            this.start = start;
        }
        if(typeof end !== 'undefined') {
            this.end = end;
        }
        if(typeof sessionId !== 'undefined') {
            this.sessionId = sessionId;
        }

        /**
         * Generates a URL for retrieving a frame from the specified camera at a given time.
         * NOTE: This method should not be used for normal video playback, as performance will be very poor in that
         * application.
         *
         * @param {EVWEB2.Camera} camera Target camera for the search
         * @param {Date} timestamp The timestamp of the required frame
         * @param {Number} width The width of the image in pixels
         * @param {Number} height The height of the image in pixels
         * @param {Number} quality Quality of the requested image between 1 and 10 (1 lowest, 10 highest)
         * @return {String} The url to access the frame
         */
        this.getFrameAtTime = function (camera, timestamp, width, height, quality) {
            if(this.sessionId === '' || !camera.supportsGetFrame()) {
                return '';
            }
            var url = this.server.service.url() + EVWEB2.urls.metadata;
            var params = [
                's=' + this.sessionId,
                'action=frame',
                'time=' + EVWEB2.util.Date2IETF(timestamp)
            ];

            var useNativeJpeg = false;
            if(camera.ptzType === EVWEB2.ptzTypes.digital) {
                params.push('camera=' + camera.sourceCamera.id);
                params.push('session=' + camera.server.sessionId);
                params.push('digitalptz=' + camera.id);
            }
            else {
                params.push('camera=' + camera.id);
                var forwardingSettings = this.server.service.jpegForwarding;
                if(forwardingSettings.enabled && $.inArray(EVWEB2.cameraFormats.jpeg, camera.formats) !== -1) {
                    useNativeJpeg = camera.quality * (forwardingSettings.qualityThreshold/100) < quality &&
                        (camera.resolution.width * (forwardingSettings.sizeThreshold/100) < width ||
                            camera.resolution.height * (forwardingSettings.sizeThreshold/100) < height);
                }
            }
            var format = EVWEB2.cameraFormats.transcodedJpeg;
            if(useNativeJpeg || $.inArray(EVWEB2.cameraFormats.transcodedJpeg, camera.formats) === -1) {
                format = EVWEB2.cameraFormats.jpeg;
            }
            if(format !== EVWEB2.cameraFormats.jpeg) {
                params.push('w='+width);
                params.push('h='+height);
                params.push('q='+quality);
            }
            params.push('format='+format);
            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * Notifies the service that a process is still in use.  This prevents an active instance from being closed.
         * @param {function} [callback] Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.notifyUse = function (callback) {
            if(this.sessionId === '') {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'Metadata instance is not avaialble.');
                    callback(errorResponse);
                }
                return;
            }
            var metadataServer = new EVWEB2.Server(this.server.service, '', this.server.id, true, false,
                this.sessionId);
            metadataServer.notifyUse(callback);
        };

        /**
         * Logs out the current metadata instance.  This destroys all resources associated with the metadata and should
         * be called for each metadata instance as it is no longer needed.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.logout = function (callback) {
            if(this.sessionId === '') {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'Metadata instance is not avaialble.');
                    callback(errorResponse);
                }
                return;
            }

            var onLogoutServerError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                if(typeof callback === 'function') {
                    callback(errorResponse);
                }
            };

            var onLogoutServerSuccess = function(/*data, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(true);
                if(typeof callback === 'function') {
                    callback(successResponse);
                }
            };

            var settings = {
                success: onLogoutServerSuccess,
                error: onLogoutServerError,
                url: this.server.service.url() + EVWEB2.urls.logout,
                data: {
                    s: this.sessionId
                }
            };

            EVWEB2.ajax(settings, this.server.service);
        };

    };

    /**
     * The metadata function handles retrieving metadata information for a set of cameras over a duration.  It
     * queries the server for the metadata information on the set of cameras.
     *
     * For backwards compatability, when communicating with services running version 2.10.1 or earlier, audio inputs
     * are not supported.  Requesting audio input metadata information will not cause a failure, but no results will be
     * returned for the audio inputs.
     *
     * @param {Function} callback Callback function to be executed when the call completes. The function gets passed
     *  two arguments: {@link EVWEB2.ResponseStatus} instance with the details of the response and a
     *  {@link EVWEB2.Metadata} instance describing all of the metadata information for the associated inputs.
     * @param {EVWEB2.Camera[]|EVWEB2.AudioDevice[]} inputs Array of {@link EVWEB2.Camera} and
     * {@link EVWEB2.AudioDevice} objects that are the targets for the metadata search.
     * @param {Date} start The start time of the metadata search
     * @param {Date} end The end time of the metadata search
     * @category Search
     */
    EVWEB2.getMetadata = function (callback, inputs, start, end) {
        // Generate the different input lists
        var cameras = $.grep(inputs, function(element) {
            return element instanceof EVWEB2.Camera;
        });
        var audioInputs = $.grep(inputs, function(element) {
            return element instanceof EVWEB2.AudioDevice;
        });

        var onGetMetadataError = function(xhr/*, textStatus, errorThrown*/) {
            var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
            if(xhr.status === 408 || xhr.status === 504) {
                errorResponse.errorText = 'A timeout has occurred requesting metadata.';
            }
            if(xhr.status === 403) {
                errorResponse.errorText = "No permission to search.";
            }
            callback(errorResponse);
        };

        var metadataItemFromResponse = function(responseItem) {
            var itemStart = EVWEB2.util.IETF2Date(responseItem.start);
            var itemEnd = EVWEB2.util.IETF2Date(responseItem.end);
            return new EVWEB2.MetadataItem(itemStart, itemEnd, responseItem.flags);
        };

        var processCameraMetadataResponses = function(responseCameras) {
            return $.map(responseCameras, function(element, key) {
                var metadataItems = $.map(element.metadata, metadataItemFromResponse);

                var camera = $.grep(cameras, function(element) {
                    return element.id.toString() === key;
                })[0];

                return new EVWEB2.MetadataInformation(camera, metadataItems, element.start, element.end);
            });
        };

        var processAudioInputsMetadataResponses = function(responseAudioInputs) {
            return $.map(responseAudioInputs, function(element, key) {
                var metadataItems = $.map(element.metadata, metadataItemFromResponse);

                var audioInput = $.grep(audioInputs, function(element) {
                    return element.id.toString() === key;
                })[0];

                return new EVWEB2.MetadataInformation(audioInput, metadataItems, element.start, element.end);
            });
        };

        var onOldGetMetadataSuccess = function(data/*, textStatus, xhr*/) {
            if(data === EVWEB2.errors.servers) {
                //Call the error callback
                onGetMetadataError();
            }

            var cameraMetadata = processCameraMetadataResponses(data);
            var metadataResponse = new EVWEB2.Metadata(cameraMetadata, undefined, start, end);

            var successResponse = new EVWEB2.ResponseStatus(true);
            //Return the server list
            callback(successResponse, metadataResponse);
        };

        var onGetMetadataSuccess = function(data/*, textStatus, xhr*/) {
            if(data === EVWEB2.errors.servers) {
                //Call the error callback
                onGetMetadataError();
            }

            var cameraMetadata = processCameraMetadataResponses(data.cameras);
            var audioInputsMetadata = processAudioInputsMetadataResponses(data.audio);
            var metadataResponse = new EVWEB2.Metadata(cameraMetadata, audioInputsMetadata, start, end, data.sessionId);

            var successResponse = new EVWEB2.ResponseStatus(true);
            //Return the server list
            callback(successResponse, metadataResponse);
        };

        var server;
        if(cameras.length > 0) {
            server = cameras[0].server;
        }
        else if (audioInputs.length > 0) {
            server = audioInputs[0].server;
        }
        else {
            var errorResponse = new EVWEB2.ResponseStatus(false, 'No items to search.');
            callback(errorResponse);
            return;
        }

        var onVersionNumberResponse = function(response, versionNumber) {
            var useNewRequest = false;
            if(response.success) {
                if (versionNumber === '0.0.0.0') {
                    // Always use the new method internally
                    useNewRequest = true;
                }
                else {
                    var versionValues = versionNumber.split('.');
                    // Use the new request if it's a version greater than 2.10
                    var majorVersion = 0;
                    var minorVersion = 0;
                    if(versionValues.length > 2) {
                        majorVersion = parseInt(versionValues[0], 10);
                        minorVersion = parseInt(versionValues[1], 10);
                    }

                    useNewRequest = majorVersion > 2 || (majorVersion === 2 && minorVersion > 10);
                }
            }

            var url = server.service.url() + EVWEB2.urls.metadata + '?s=' + server.sessionId;
            if(useNewRequest) {
                url += ';responseVersion=2';
            }
            var i;
            for(i=0; i<cameras.length; i++) {
                if(typeof cameras[i].id !== 'undefined') {
                    url += ';camera='+ cameras[i].id;
                }
            }
            for(i=0; i<audioInputs.length; i++) {
                if(typeof audioInputs[i].id !== 'undefined') {
                    url += ';audio='+ audioInputs[i].id;
                }
            }
            url += ';start='+EVWEB2.util.Date2IETF(start) + ";end=" + EVWEB2.util.Date2IETF(end);

            var settings = {
                success: onOldGetMetadataSuccess,
                error: onGetMetadataError,
                url: url,
                dataType: 'json'
            };

            if(useNewRequest) {
                settings.success = onGetMetadataSuccess;
            }

            EVWEB2.ajax(settings, server.service);
        };

        // Get the version number of the service to determine which HTTP request to make
        server.service.version(onVersionNumberResponse);
    };

    /**
     * The metadata function handles retrieving metadata information for a set of cameras over a duration.  It
     * queries the server for the metadata information on the set of cameras.
     * @param {Function} callback Callback function to be executed when the call completes. The function gets passed
     *  two arguments: {@link EVWEB2.ResponseStatus} instance with the details of the response and an object of the
     *  metadata for each camera.
     * @param {EVWEB2.Camera[]} cameras Array of {@link EVWEB2.Camera} instances for retrieving metadata.
     * @param {Date} start The start time of the metadata search
     * @param {Date} end The end time of the metadata search
     * @deprecated This function has been deprecated in place of EVWEB2.getMetadata to support a more consistent naming structure,
     * a defined result object, as well as to provide searching on audio inputs.
     * @category Search
     */
    EVWEB2.metadata = function (callback, cameras, start, end) {
        var onGetMetadata = function(response, metadata) {
            // Convert the EVWEB2.Metadata objects back to the original format, ignoring audio inputs.
            var camerasMetadata = {};

            $.each(metadata.cameras, function(index, element) {
                var cameraMetadata = {
                    start: element.start,
                    end: element.end,
                    metadata: {}
                };

                $.each(element.metadata, function(index, element) {
                    // Map the flags back to the bitfield
                    var flags = 0x0;
                    var i;
                    /* eslint-disable no-bitwise */
                    for(i=0; i<element.flags.length; i++) {
                        if(element.flags[i] === EVWEB2.metadataFlags.freeRun) {
                            flags = flags | FLAG_FREE_RUN;
                        }
                        else if(element.flags[i] === EVWEB2.metadataFlags.motion) {
                            flags = flags | FLAG_MOTION;
                        }
                        else if(element.flags[i] === EVWEB2.metadataFlags.alarm) {
                            flags = flags | FLAG_ALARM;
                        }
                    }
                    /* eslint-enable no-bitwise */
                    cameraMetadata.metadata[index] = {
                        start: EVWEB2.util.Date2IETF(element.start),
                        end: EVWEB2.util.Date2IETF(element.end),
                        flags: flags
                    };
                });
                camerasMetadata[element.instance.id] = cameraMetadata;
            });
            callback(response, camerasMetadata);
        };

        EVWEB2.getMetadata(onGetMetadata, cameras, start, end);
    };

}());
/*globals EVWEB2:true, $:false*/
(function() {
    /**
     * The Search Audio Clip Info object is a container representing the information surrounding
     * a single audio clip in a search.  This object is generally not used, as it is
     * only relevant in situations where the sample rate or format of a given audio stream changed
     * over time.
     * @class
     * @param {Date} [start=new Date()] Start date of the clip
     * @param {Date} [end=new Date()] End date of the clip
     * @param {EVWEB2.audioDeviceNativeFormatTypes} [nativeFormat=EVWEB2.audioDeviceNativeFormatTypes.none] The native
     * format for the audio device for the duration of the clip.
     * @param {Number} [frequency=0] The samples per second of the returned audio for the duration
     * of the clip.
     * @param {Number} [frames=0] The number of frames associated with this clip.
     * @param {Number} [samplesPerFrame=0] The number of samples in a given frame for this clip.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchAudioClipInfo = function (start, end, nativeFormat, frequency, frames, samplesPerFrame) {
        /**
         * Start date of the clip
         * @type Date
         */
        this.start = new Date();

        /**
         * End date of the clip
         * @type Date
         */
        this.end = new Date();

        /**
         * The native format for the audio device for the duration of the clip.
         * @type EVWEB2.audioDeviceNativeFormatTypes
         */
        this.nativeFormat = EVWEB2.audioDeviceNativeFormatTypes.none;

        /**
         * The samples per second of the returned audio for the duration of the clip.
         * @type Number
         */
        this.frequency = 0;

        /**
         * The number of frames associated with this clip.
         * @type {number}
         */
        this.frames = 0;

        /**
         * The number of samples in a given frame for this clip.
         * @type {number}
         */
        this.samplesPerFrame = 0;

        if(start !== undefined) {
            this.start = start;
        }
        if(end !== undefined) {
            this.end = end;
        }
        if(nativeFormat !== undefined) {
            this.nativeFormat = nativeFormat;
        }
        if(frequency !== undefined) {
            this.frequency = frequency;
        }
        if(frames !== undefined) {
            this.frames = frames;
        }
        if(samplesPerFrame !== undefined) {
            this.samplesPerFrame = samplesPerFrame;
        }

    };

    /**
     * The Search Audio Info object is a container representing the audio clip information
     * for a given audio device in a search.  This object is generally not used, as it is
     * only relevant in situations where the sample rate or format of a given audio stream
     * changed over time.
     * @class
     * @param {EVWEB2.AudioDevice} [audioInput] The audio device instance associated with this
     * clip information
     * @param {EVWEB2.SearchAudioClipInfo[]} [audioClipsInformation] The individual audio clip
     * information for all clips in the searched stream.
     * @param {Number} [frames] The total number of frames associated with all of the clips for
     * this device.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchAudioInfo = function (audioInput, audioClipsInformation, frames) {

        /**
         * The audio device instance associated with this clip information
         * @type EVWEB2.AudioDevice
         */
        this.audioInput = null;

        /**
         * The individual audio clip information for all clips in the searched stream.
         * @type EVWEB2.SearchAudioClipInfo[]
         */
        this.audioClipsInformation = [];

        /**
         * The total number of frames associated with all of the clips for this device.
         * @type {number}
         */
        this.frames = 0;

        if(audioInput !== undefined) {
            this.audioInput = audioInput;
        }
        if(audioClipsInformation !== undefined) {
            this.audioClipsInformation = audioClipsInformation;
        }
        if(frames !== undefined) {
            this.frames = frames;
        }
    };

    /**
     * SearchVideoClipInfo represents a single time range in a search where stored video exists.
     * @class
     * @param {Date} start The start of the clip.
     * @param {Date} end The end of the clip.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchVideoClipInfo = function(start, end) {
        /**
         * The start of the clip.
         * @type {Date}
         */
        this.start = start || null;

        /**
         * The end of the clip.
         * @type {Date}
         */
        this.end = end || null;
    };

    /**
     * SearchVideoInfo represents the video clip information for a given searched camera.
     * @class
     * @param {EVWEB2.Camera} camera The associated camera instance.
     * @param {EVWEB2.SearchVideoClipInfo[]} clips The individual clip ranges present in the search for the camera.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchVideoInfo = function(camera, clips) {
        /**
         * The associated camera instance.
         * @type EVWEB2.Camera
         */
        this.camera = camera || null;

        /**
         * The individual clip ranges present in the search for the camera.
         * @type EVWEB2.SearchVideoClipInfo[]
         */
        this.clips = clips || [];
    };

    /**
     * Enum of search statuses
     * @enum {Number}
     * @readonly
     * @category Search
     */
    EVWEB2.SearchStatusType = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Not started
         */
        notStarted: 1,
        /**
         * Started
         */
        started: 2,
        /**
         * Completed
         */
        complete: 3,
        /**
         * Error due to disk space restrictions
         */
        errorSpace: 4,
        /**
         * Unknown error
         */
        errorUnknown: 5
    };


    /**
     * Container object for overall search status information.  This information represents
     * the status of the search process itself, in terms of retrieving and processing
     * frames for playback
     * @class
     * @param {EVWEB2.SearchStatusType} status The status of the search.
     * @param {Number} frames The number of frames retrieved by the search process.  Note: This
     *   value represents the total number of "playable" frames available.  Playback of frames
     *   past this value is not possible.
     * @param {Number} totalFrames The total number of frames for the search.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchStatus = function(status, frames, totalFrames) {
        /**
         * The status of the search.
         * @type {EVWEB2.SearchStatusType}
         */
        this.status = status;

        /**
         * The number of frames retrieved by the search process.  Note: This value represents
         * the total number of "playable" frames available.  Playback of frames past this
         * value is not possible.
         * @type {Number}
         */
        this.frames = frames;

        /**
         * The total number of frames for the search.
         * @type {Number}
         */
        this.totalFrames = totalFrames;
    };

    /**
     * Container for the overall search frame count information.  This information represents the breakdown
     * of frames by video and audio.
     * @param {Number} video The number of video frames in the search.
     * @param {Number} audio The number of audio frames in the search.
     * @constructor
     * @category Search
     */
    EVWEB2.SearchFrameCounts = function(video, audio) {
        /**
         * The number of video frames in the search.
         * @type {Number}
         */
        this.video = video;

        /**
         * The number of audio frames in the search.
         * @type {Number}
         */
        this.audio = audio;
    };

    /**
     * The Search object is a container representing a requested search.
     * @class
     * @param {String} searchId Search ID used to identify the search on the web service.
     * @param {Array.<(EVWEB2.Camera|EVWEB2.AudioDevice)>} inputs The inputs associated with the search.  Can be a mixed
     * list of {@link EVWEB2.Camera} and {@link EVWEB2.AudioDevice} instances.
     * @param {Date} start Start date of the search
     * @param {Date} end End date of the search
     * @param {Number|EVWEB2.SearchFrameCounts} frames The frame information for the search, broken down by video and
     * audio or (legacy) the total number of frames in the search.
     * @param {EVWEB2.SearchAudioInfo[]} [audioInformation] Information about each audio clip for each audio input.
     * @param {EVWEB2.SearchVideoInfo[]} [videoInformation] Information about each clip range for the searched cameras.
     * @constructor
     * @category Search
     */
    EVWEB2.Search = function (searchId, inputs, start, end, frames, audioInformation, videoInformation) {
        /**
         * Search ID used to identify the search
         * @type String
         */
        this.searchId = '';

        /**
         * The cameras associated with the search
         * @type EVWEB2.Camera[]
         */
        this.cameras = [];

        /**
         * The audio inputs associated with the search
         * @type EVWEB2.AudioDevice[]
         */
        this.audioInputs = [];

        /**
         * The serial devices associated with the search
         * @type {EVWEB2.SerialDevice[]}
         */
        this.serialDevices = [];

        /**
         * Server this Search is attached to
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * Start date of the search
         * @type Date
         */
        this.start = new Date();

        /**
         * End date of the search
         * @type Date
         */
        this.end = new Date();

        /**
         * Number of frames in the search
         * @deprecated This has been deprecated in favor of {@link EVWEB2.Search.frameInfo}, which provides
         * more granularity in the breakdown of video and audio frames.
         * @type Number
         */
        this.frames = 0;

        /**
         * The frame counts associated with the search.  Note: When performing frame-related actions
         * (e.g. {@link EVWEB2.Search.step}}, video and audio frames are indexed separately.
         * @type {EVWEB2.SearchFrameCounts}
         */
        this.frameInfo = null;

        /**
         * Information about each audio clip for each audio input.
         * Note: This property is generally unused, as it is only relevant in situations where the sample rate or
         * format of a given audio stream changed over time.
         * @type {EVWEB2.SearchAudioInfo[]}
         */
        this.audioInformation = [];

        /**
         * Information about each clip range for the searched cameras.
         * Note: This property is not needed for basic search playback. The web service will jump frame gaps for you
         * if you allow it to advance its own playhead. You will only need this information if you intend
         * to request frames from a search at specific times (ie. keep track of your own playhead).
         * @type {EVWEB2.SearchVideoInfo[]}
         */
        this.videoInformation = [];

        //Assign the constructor values
        if(searchId !== undefined) {
            this.searchId = searchId;
        }
        if(inputs !== undefined) {
            // Generate the different input lists
            this.cameras = $.grep(inputs, function(element) {
                return element instanceof EVWEB2.Camera;
            });
            this.audioInputs = $.grep(inputs, function(element) {
                return element instanceof EVWEB2.AudioDevice;
            });
            this.serialDevices = $.grep(inputs, function(element) {
                return element instanceof EVWEB2.SerialDevice;
            });
            if(inputs.length > 0) {
                this.server = inputs[0].server;
            }
        }
        if(start !== undefined) {
            this.start = start;
        }
        if(end !== undefined) {
            this.end = end;
        }
        if(frames !== undefined) {
            if(frames instanceof EVWEB2.SearchFrameCounts) {
                this.frames = frames.video + frames.audio;
                this.frameInfo = frames;
            }
            else {
                // Legacy mode, treat all frames as video
                this.frames = frames;
                this.frameInfo = new EVWEB2.SearchFrameCounts(frames, 0);
            }

        }
        if(audioInformation !== undefined) {
            this.audioInformation = audioInformation;
        }
        if(videoInformation !== undefined) {
            this.videoInformation = videoInformation;
        }

        /**
         * The setSpeed function handles modifying the playback speed for searches initiated with the
         * {@link EVWEB2.getSearch} function.  Each search feed can be sped up, slowed down, or rewound.  To control
         * this, the setSpeed takes the new speed (100 being real time, 0 being paused, and negatives being rewinding)
         * and sets the rate at which images are retrieved to be on that playspeed for the timeline.
         *
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and the updated speed.
         * @param {Number} speed The new speed desired for this search
         */
        this.setSpeed = function (callback, speed) {
            var onSearchPlaySpeedError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSearchPlaySpeedSuccess = function(data/*, textStatus, xhr*/) {
                var playSpeed = parseInt(data, 10);
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, playSpeed);
            };

            var settings = {
                success: onSearchPlaySpeedSuccess,
                error: onSearchPlaySpeedError,
                url: this.server.service.url() + EVWEB2.urls.speed + '/' + speed,
                dataType: 'text',
                data: {
                    search_id: this.searchId
                }
            };

            EVWEB2.ajax(settings, this.server.service);
        };

        /**
         * The playing function is an AJAX call to check the status of a search feed.  It is used to validate
         * whether a search is still continuing or whether it has expired and no new images are available.  This
         * function calls to the web service web server to check whether the feed is still being played or whether
         * it is stopped.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a Boolean indicating whether
         *  the search is currently playing.
         */
        this.playing = function (callback) {
            var onSearchPlayingError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSearchPlayingSuccess = function(data/*, textStatus, xhr*/) {
                var playSpeed = parseInt(data, 10);
                var successResponse = new EVWEB2.ResponseStatus(true);
                var isPlaying = true;
                if (playSpeed === -1 || playSpeed === 0) {
                    isPlaying = false;
                }
                callback(successResponse, isPlaying);
            };

            var settings = {
                success: onSearchPlayingSuccess,
                error: onSearchPlayingError,
                url: this.server.service.url() + EVWEB2.urls.speed,
                dataType: 'text',
                data: {
                    search_id: this.searchId
                }
            };

            EVWEB2.ajax(settings, this.server.service);
        };

        /**
         * The step function handles small jumps in the playback of a search.  It can be used for walking through a
         * feed to look for something specific and detailed.  The intended use of this is to be coupled with a
         * playspeed of 0 (i.e. the feed is paused).  With the step function, no image will be grabbed, but the
         * next time you pull an image from this search, it will be at the new location in the timeline.  The step
         * size can be positive or negative and refers to the number of frames either forward or backward from the
         * current frame. If no step size is provided, the current frame of the search will be returned.
         *
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response and a Number indicating the current
         * playback frame.
         * @param {Number|String} [stepSize] The frame to step to or the offset amount to step (e.g. '+5' is step 5
         * frames forward).
         */
        this.step = function (callback, stepSize) {
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var newFrame;
                if(typeof data === 'string') {
                    // Handle legacy responses
                    newFrame = parseInt(data, 10);
                }
                else {
                    newFrame = parseInt(data.frame, 10);
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, newFrame);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.server.service.url() + EVWEB2.urls.step + '/',
                data: {
                    search_id: this.searchId,
                    output: 'json'
                }
            };
            if(typeof stepSize !== 'undefined') {
                settings.url += stepSize.toString();
            }

            EVWEB2.ajax(settings, this.server.service);
        };

        /**
         * The getTime function handles retrieving the current date/time from a camera feed attached to a search.
         * It queries the server and parses the returned string to a proper javascript date/time object.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a Date object of the current
         *  time of the search.
         */
        this.getTime = function (callback) {
            var onSearchTimeError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSearchTimeSuccess = function(data, textStatus, xhr) {
                var searchTime;
                try{
                    data = JSON.parse(data);
                    searchTime = data.timeWithMs || data.time;
                }
                catch(e){
                    searchTime = data;
                }

                var xDurationText = xhr.getResponseHeader('X-Duration');
                var xServerText = xhr.getResponseHeader('X-Server-Time');
                var xDuration = xDurationText !== null ? parseInt(xDurationText, 10) : 0;
                var serverTimeDifference = xServerText !== null ? Math.abs(Date.now() - Date.parse(xServerText)) : 0;
                var currentTime = EVWEB2.util.IETF2Date(searchTime);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, currentTime, xDuration, serverTimeDifference);
            };

            var settings = {
                success: onSearchTimeSuccess,
                error: onSearchTimeError,
                url: this.server.service.url() + EVWEB2.urls.time,
                dataType: 'text',
                data: {
                    search_id: this.searchId,
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, this.server.service);
        };

        /**
         * Logs out the current search.  This destroys all resources associated with the search and should be called
         * for each search as the search is finished.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.logout = function (callback) {
            var server = this.server;
            var onLogoutServerError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                if(typeof callback === 'function') {
                    callback(errorResponse);
                }
            };

            var onLogoutServerSuccess = function(/*data, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(true);
                if(typeof callback === 'function') {
                    callback(successResponse);
                }
            };

            var settings = {
                success: onLogoutServerSuccess,
                error: onLogoutServerError,
                url: server.service.url() + EVWEB2.urls.logout,
                data: {
                    s: this.searchId
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Notifies the service that a process is still in use.  This prevents an inactive search from being closed.
         * @param {Function} [callback] Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.notifyUse = function (callback) {
            var searchServer = new EVWEB2.Server(this.server.service, '', this.server.id, true, false, this.searchId);
            searchServer.notifyUse(callback);
        };

        /**
         * Retrieves the status of the search.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a {@link EVWEB2.SearchStatus}
         *  object detailing the status of the search.
         */
        this.getStatus = function(callback) {
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var status = new EVWEB2.SearchStatus(data.status.status,
                    data.status.frames.retrieved, data.status.frames.total);
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, status);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.server.service.url() + EVWEB2.urls.searchStatus,
                data: {
                    s: this.searchId
                }
            };

            EVWEB2.ajax(settings, this.server.service);
        };

        /**
         * Generates a stream ID for a video.web or pull.web request based off of the provided ID.
         * @param {String} streamId The stream ID to process.
         * @return {String} A stream ID
         */
        var generateStreamId = function(streamId) {
            if (typeof streamId === "undefined") {
                if (EVWEB2.config.defaultStreamId === null) {
                    EVWEB2.config.defaultStreamId = EVWEB2.util.generateStreamId();
                }
                streamId = EVWEB2.config.defaultStreamId;
            }
            return streamId;
        };

        /**
         * Gets a frame from the searched camera at the specified time.
         * @param {EVWEB2.Camera} camera The camera for the frame.
         * @param {Date} time The time of the frame.
         * @param {Number} width The width of the image in pixels
         * @param {Number} height The height of the image in pixels
         * @param {Number} quality Quality between 1 and 10 with the level of quality of the image (1 lowest, 10
         * highest)
         * @param {String} [streamId] The unique stream ID for the feed
         * @return {String} The URL to request the desired frame from this search.
         */
        this.getFrame = function(camera, time, width, height, quality, streamId) {
            if(!camera.supportsGetFrame()) {
                return '';
            }

            var url = this.server.service.url() + EVWEB2.urls.searchVideo;
            var params = [
                's=' + this.server.sessionId,
                'search_id=' + this.searchId,
                'camera=' + camera.id,
                'time=' + EVWEB2.util.Date2IETF(time, true),
                'stream=' + generateStreamId(streamId)
            ];

            var useNativeJpeg = false;
            var forwardingSettings = this.server.service.jpegForwarding;
            if(forwardingSettings.enabled && $.inArray(EVWEB2.cameraFormats.jpeg, camera.formats) !== -1) {
                useNativeJpeg = camera.quality * (forwardingSettings.qualityThreshold/100) < quality &&
                                (camera.resolution.width * (forwardingSettings.sizeThreshold/100) < width ||
                                camera.resolution.height * (forwardingSettings.sizeThreshold/100) < height);
            }

            var format = EVWEB2.cameraFormats.transcodedJpeg;
            if(useNativeJpeg || $.inArray(EVWEB2.cameraFormats.transcodedJpeg, camera.formats) === -1) {
                format = EVWEB2.cameraFormats.jpeg;
            }
            if(format !== EVWEB2.cameraFormats.jpeg) {
                params.push('w='+width);
                params.push('h='+height);
                params.push('q='+quality);
            }
            params.push('format='+format);

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

    };

    /**
     * The getSearch function makes the initializing call for a search on a series of {@link EVWEB2.Camera} instances
     * on a given period.  It requests the period feed for the given {@link EVWEB2.Camera} instances and
     * retrieves the information to later manipulate the search.  The image feed values are timed on the web server
     * and will pass in real time without requiring any time detection on the front-end.
     * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a {@link EVWEB2.Search} instance.
     * @param {EVWEB2.Camera[]|EVWEB2.AudioDevice[]|EVWEB2.SerialDevice} inputs Array of {@link EVWEB2.Camera},
     * {@link EVWEB2.AudioDevice}, and {@link EVWEB2.SerialDevice} objects that are the targets for the search
     *  requested.
     * @param {Date|Number|String} start Date object or integer/string representing the number of milliseconds since
     * epoch, this is to be the beginning of the requested period.
     * @param {Date|Number|String} end Date object or integer/string representing the number of milliseconds since
     * epoch, this is to be the end of the requested period.
     * @param {Boolean} [startPaused=false] Whether the search should start paused or not.
     * @category Search
     */
    EVWEB2.getSearch = function (callback, inputs, start, end, startPaused) {
        //Forward-declaring onSearchSuccess due to circular references.
        var onSearchSuccess;

        var onSearchError = function(xhr, textStatus/*, errorThrown*/) {
            if((xhr.status === 200) && (textStatus === 'parsererror')){
                onSearchSuccess(xhr.responseText);
                return;
            }
            var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
            if(xhr.status === 408) {
                errorResponse.errorText = 'A timeout has occurred requesting the search.';
            }
            callback(errorResponse);
        };

        onSearchSuccess = function(data, textStatus, xhr) {
            if(data === EVWEB2.errors.search) {
                onSearchError(xhr);
            }

            if(typeof data === 'string') {
                // we received a string rather than json
                // build a json object
                var dataString = data;
                data = {};

                var dataStringArray = dataString.split('&');
                var i;
                for(i=0; i<dataStringArray.length; i++) {
                    var thisKeyValueArray = dataStringArray[i].split('=');

                    if(thisKeyValueArray.length === 2) {
                        if(thisKeyValueArray[0] === 'frames') {
                            data.frames = parseInt(thisKeyValueArray[1], 10);
                        } else if(thisKeyValueArray[0] === 'start') {
                            data.start_time = decodeURIComponent(thisKeyValueArray[1]);
                        } else if(thisKeyValueArray[0] === 'end') {
                            data.end_time = decodeURIComponent(thisKeyValueArray[1]);
                        } else if(thisKeyValueArray[0] === 'search_id') {
                            data.search_id = thisKeyValueArray[1];
                        }
                    }
                }
            }
            var startDate;
            if(typeof data.start_time !== 'undefined') {
                startDate = EVWEB2.util.IETF2Date(data.start_time);
            }
            var endDate;
            if(typeof data.end_time !== 'undefined') {
                endDate = EVWEB2.util.IETF2Date(data.end_time);
            }

            // Process the audio clip information (if present)
            var audioInfoList;
            if(typeof data.audioInfo !== 'undefined') {
                audioInfoList = $.map(data.audioInfo, function(element) {
                    // Process each of the clips
                    var audioClips = $.map(element.audioClips, function(clip) {
                        var clipStart = EVWEB2.util.IETF2Date(clip.startTime);
                        var clipEnd = EVWEB2.util.IETF2Date(clip.endTime);
                        return new EVWEB2.SearchAudioClipInfo(clipStart, clipEnd, clip.format,
                            clip.frequency, clip.frames, clip.samplesPerFrame);
                    });
                    // Find the associated input.
                    var audioInput = $.grep(inputs, function(device) {
                        return device.id === element.deviceId;
                    })[0];

                    return new EVWEB2.SearchAudioInfo(audioInput, audioClips, element.frames);
                });
            }

            var frameInfo = data.frames;
            if(data.frameCounts !== undefined) {
                frameInfo = new EVWEB2.SearchFrameCounts(data.frameCounts.video, data.frameCounts.audio);
            }

            var videoInfo;
            if (data.videoInfo) {
                videoInfo = $.map(data.videoInfo, function(info) {
                    var ranges = $.map(info.clips, function(clip) {
                        return new EVWEB2.SearchVideoClipInfo(EVWEB2.util.IETF2Date(clip.startTime),
                            EVWEB2.util.IETF2Date(clip.endTime));
                    });
                    var camera = $.grep(inputs, function(input) {
                        return input.id.toString() === info.deviceId;
                    })[0];
                    return new EVWEB2.SearchVideoInfo(camera, ranges);
                });
            }

            var search = new EVWEB2.Search(data.search_id, inputs, startDate, endDate, frameInfo, audioInfoList,
                videoInfo);

            var successResponse = new EVWEB2.ResponseStatus(true);
            callback(successResponse, search);
        };

        if(typeof startPaused === 'undefined') {
            startPaused = false;
        }

        if(inputs.length === 0) {
            var errorResponse = new EVWEB2.ResponseStatus(false, 'No search inputs provided.');
            callback(errorResponse);
            return;
        }

        // Generate the different input lists
        var cameras = $.grep(inputs, function(element) {
            return element instanceof EVWEB2.Camera;
        });
        var audioInputs = $.grep(inputs, function(element) {
            return element instanceof EVWEB2.AudioDevice;
        });
        var serialInputs = $.grep(inputs, function(element) {
            return element instanceof EVWEB2.SerialDevice;
        });

        var server = inputs[0].server;
        var url = server.service.url() + EVWEB2.urls.search + '?s=' + server.sessionId;
        var i;
        for(i=0; i<cameras.length; i++) {
            if(typeof cameras[i].id !== 'undefined') {
                url += '&camera='+ cameras[i].id;
            }
        }
        for(i=0; i<audioInputs.length; i++) {
            if(typeof audioInputs[i].id !== 'undefined') {
                url += '&audio='+ audioInputs[i].id;
            }
        }
        for(i=0; i<serialInputs.length; i++) {
            if(typeof serialInputs[i].id !== 'undefined') {
                url += '&serial='+ serialInputs[i].id;
            }
        }

        url += '&start='+EVWEB2.util.Date2IETF(start) + "&end=" + EVWEB2.util.Date2IETF(end) + '&output=json';

        if(startPaused) {
            url += '&start_paused=1';
        }

        if (server.requiresResourceKey()) {
            if (server.service.resourceKey === '') {
                throw new Error("CSRF enforced, passthrough will not work.");
            }
            url += '&key='+server.service.resourceKey;
        }

        var settings = {
            success: onSearchSuccess,
            error: onSearchError,
            url: url,
            dataType: 'json'
        };

        EVWEB2.ajax(settings, server.service);
    };
}());

/*globals EVWEB2:true*/
(function() {
    /**
     * Layout slots represent the positioning and sizing of a given camera panel in a layout.
     * @param {Number} [top=0] The top position of the layout slot, in terms of the {@link EVWEB2.Layout} instance.
     * @param {Number} [left=0] The left position of the layout slot, in terms of the {@link EVWEB2.Layout} instance.
     * @param {Number} [width=0] The width of the layout slot, in terms of the {@link EVWEB2.Layout} instance.
     * @param {Number} [height=0] The height of the layout slot, in terms of the {@link EVWEB2.Layout} instance.
     * @class
     * @category Util
     */
    EVWEB2.LayoutSlot = function(top, left, width, height) {
        /**
         * Top location of the layout slot
         * @type Number
         */
        this.top = 0;

        /**
         * Left location of the layout slot
         * @type Number
         */
        this.left = 0;

        /**
         * Width of the layout slot
         * @type Number
         */
        this.width = 0;

        /**
         * Height of the layout slot
         * @type Number
         */
        this.height = 0;

        if(typeof top !== 'undefined') {
            this.top = top;
        }
        if(typeof left !== 'undefined') {
            this.left = left;
        }
        if(typeof width !== 'undefined') {
            this.width = width;
        }
        if(typeof height !== 'undefined') {
            this.height = height;
        }
    };

    /**
     * A layout is the definition of a layout--the visual layout of a series of cameras.
     * @param {String|undefined} [name="Unnamed"] The name of the layout.
     * @param {Number} [width=0] The width of the layout.  i.e. the number of columns that compose the layout.
     * @param {Number} [height=0] The height of the layout.  i.e. the number of rows that compose the layout.
     * @param {Number} [length=0] The number of cameras this layout supports.
     * @param {EVWEB2.LayoutSlot[]} [slots=[]] The slot definitions for each camera slot in the layout.
     * @param {Number} [aspectRatio=4/3] The aspect ratio of the layout.
     * @param {Boolean} [ws=false] Boolean flag as to whether the layout is widescreen.
     * @class
     * @category Util
     */
    EVWEB2.Layout = function(name, width, height, length, slots, aspectRatio, ws) {
        /**
         * Name of the layout
         * @type String
         */
        this.name = "Unnamed";

        /**
         * Width of the layout
         * @type Number
         */
        this.width = 0;

        /**
         * Height of the layout
         * @type Number
         */
        this.height = 0;

        /**
         * Number of panels in the layout
         * @type Number
         */
        this.length = 0;

        /**
         * Array of slots in the layout
         * @type Array
         */
        this.slots = [];

        /**
        * Aspect ratio of the layout
        * @type Number
        */
        this.aspectRatio = 4/3;

        /**
         * Whether layout is widescreen or not
         * @type Boolean
         */
        this.ws = false;

        //Assign the constructor values
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof width !== 'undefined') {
            this.width = width;
        }
        if(typeof height !== 'undefined') {
            this.height = height;
        }
        if(typeof length !== 'undefined') {
            this.length = length;
        }
        if(typeof slots !== 'undefined') {
            this.slots = slots;
        }
        if(typeof aspectRatio !== 'undefined') {
            this.aspectRatio = aspectRatio;
        }
        if(typeof ws !== 'undefined') {
            this.ws = ws;
        }
    };

}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the formats supported for receiving audio input.
     * @enum {string}
     * @readonly
     * @category Audio
     */
    EVWEB2.audioInputStreamFormatTypes = {
//        mp3: 'mp3',
//        ogg: 'ogg',
//        opus: 'opus',
        /**
         * Uncompressed 16-bit PCM at the frame rate of the device
         */
        raw: 'raw',
        /**
         * The native format of the audio input
         */
        'native': 'native'  //native is a reserved keyword in JavaScript: it must be quoted as a property name.
    };

    /**
     * Definitions for the formats supported for sending audio output.  Note: RAW is defined as uncompressed 16bit at
     * the frame rate of the device.
     * @enum {string}
     * @readonly
     * @category Audio
     */
    EVWEB2.audioOutputStreamFormatTypes = {
        /**
         * Uncompressed 16-bit PCM at the frame rate of the device
         */
        raw: 'raw',
        /**
         * The native format of the audio output
         */
        'native': 'native'  //native is a reserved keyword in JavaScript: it must be quoted as a property name.
    };

    /**
     * Definitions for the native formats available to audio devices.
     * @enum {Number}
     * @readonly
     * @category Audio
     */
    EVWEB2.audioDeviceNativeFormatTypes = {
        /**
         * None
         */
        none: -1,
        /**
         * PCM (g.711 mu-law encoded at the frame rate of the device)
         */
        pcm: 0,
        /**
         * ADPCM
         */
        adpcm: 1,
        /**
         * MP2
         */
        mp2: 2,
        /**
         * MP3
         */
        mp3: 3,
        /**
         * AAC
         */
        aac: 4,
        /**
         * g726
         */
        g726: 5
    };

    /**
     * The AudioDevice object acts as a large container for all the audio device operations and information.
     * It is initially populated from the information retrieved in the {@link EVWEB2.Server.getAudioDevices}
     * function and holds the unique information for an individual audio stream on an exacqVision server.  The
     * information can be used to then playback audio on the stream.
     * @param {EVWEB2.Server} [server=null] Server instance this audio stream is associated with.
     * @param {String} [id=''] ID of the audio stream according to the web service.
     * @param {String} [name='Undefined'] Name of this audio stream.
     * @param {Boolean} [enabled=false] Boolean flag for whether the audio device is enabled
     * @param {Boolean} [supportsInput=false] Boolean flag for whether the audio device supports input.
     * @param {Boolean} [supportsOutput=false] Boolean flag for whether the audio device supports output.
     * @param {EVWEB2.audioDeviceNativeFormatTypes} [nativeFormat=EVWEB2.audioDeviceNativeFormatTypes.none] The native
     *   format for the audio device.
     * @param {Number} [frequency=0] The samples per second of the returned audio.
     * @class
     * @constructor
     * @category Audio
     */
    EVWEB2.AudioDevice = function (server, id, name, enabled, supportsInput, supportsOutput, nativeFormat, frequency) {
        /**
         * Unique ID for this audio stream
         * @type string
         */
        this.id = '';

        /**
         * Name of this audio stream
         * @type String
         */
        this.name = 'Undefined';

        /**
         * Server instance this audio stream is attached to
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * Boolean flag for whether the audio device is enabled
         * @type Boolean
         */
        this.enabled = false;

        /**
         * Boolean flag for whether the audio device supports input.
         * @type Boolean
         */
        this.supportsInput = false;

        /**
         * Boolean flag for whether the audio device supports output.
         * @type Boolean
         */
        this.supportsOutput = false;

        /**
         * The native format for the audio device.
         * @type EVWEB2.audioDeviceNativeFormatTypes
         */
        this.nativeFormat = EVWEB2.audioDeviceNativeFormatTypes.none;

        /**
         * The samples per second of the returned audio.
         * @type Number
         */
        this.frequency = 0;

        //Assign the constructor values
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof enabled !== 'undefined') {
            this.enabled = enabled;
        }
        if(typeof supportsInput !== 'undefined') {
            this.supportsInput = supportsInput;
        }
        if(typeof supportsOutput !== 'undefined') {
            this.supportsOutput = supportsOutput;
        }
        if(typeof nativeFormat !== 'undefined') {
            this.nativeFormat = nativeFormat;
        }
        if(typeof frequency !== 'undefined') {
            this.frequency = frequency;
        }

        /**
         * The audio input object, once set, has all the information needed to retrieve audio data from the web
         * service for it. Since streaming audio data requires a specific URL, each AudioInput instance contains a
         * method to generate the URL for retrieving the audio stream. If the search ID parameter is set, the returned
         * URL will be pulling from an already initialized search session. This ID will point to the requested history
         * audio stream for the audio input.
         * @param {EVWEB2.audioInputStreamFormatTypes} type The type of audio stream to request.
         * @param {String} [searchId] The unique search ID for the feed.
         * @param {Number} [start] (Search Only) The starting frame to retrieve. If not specified, all frames for the
         * search will be streamed. Note: Video and audio frames are indexed separately. Be sure to reference
         * {@link EVWEB2.Search.frameInfo.audio} for the proper frame counts.
         * @param {Number} [end] (Search Only) The ending frame to retrieve. If not specified, all frames from the start
         * frame onward will be streamed. Note: Video and audio frames are indexed separately. Be sure to reference
         * {@link EVWEB2.Search.frameInfo.audio} for the proper frame counts.
         * @return {string} The URL to request the desired audio stream for this audio input
         */
        this.getAudio = function (type, searchId, start, end) {
            if(!this.enabled || !this.supportsInput) {
                throw new Error("Audio device is not enabled or does not support audio input.");
            }

            var url = this.server.service.url() + EVWEB2.urls.audio;
            var params = [];

            if (searchId  !== undefined) {
                params.push('s=' + searchId);
                if(start !== undefined) {
                    params.push('startFrame=' + start);
                }
                if(end !== undefined) {
                    params.push('endFrame=' + end);
                }
            }
            else {
                params.push('s=' + this.server.sessionId);
            }
            params.push('a=' + this.id);
            params.push('type='+type);

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * The getAudioOutput method returns a URL to use to send audio data to a device. You will need to use this method
         * as opposed to EVWEB2.AudioDevice.sendAudio if you wish to have control over any audio POST requests.
         * @param {EVWEB2.audioOutputStreamFormatTypes} [type=EVWEB2.audioOutputStreamFormatTypes.native] The type of
         * audio stream to send, if EVWEB2.audioOutputStreamFormatTypes.raw is used, the data must be given in the
         * form of single-channel, uncompressed 16-bit PCM.
         * @returns {String} The URL to use to send audio of the given type to the device.
         */
        this.getAudioOutput = function(type) {
            if (type === undefined) {
                type = EVWEB2.audioOutputStreamFormatTypes.native;
            }

            var params = [
                's=' + this.server.sessionId,
                'a=' + this.id,
                'type=' + type
            ];
            return this.server.service.url() + EVWEB2.urls.audio + '?' + params.join('&');
        };

        /**
         * The sendAudio method sends audio data to the audio device as it is received.
         * @param {Function} callback Callback function to be executed when the call completes. The function is
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response and the audio device
         * {@link EVWEB2.AudioDevice} instance it belongs to.
         * @param {Int16Array|Blob} data The audio data to send.
         * @param {EVWEB2.audioOutputStreamFormatTypes} [type=EVWEB2.audioOutputStreamFormatTypes.native] The type of
         * audio stream to send, if EVWEB2.audioOutputStreamFormatTypes.raw is used the data must contain
         * Raw-uncompressed 16 bit rate PCM data with 1 channel of audio.
         */
        this.sendAudio = function(callback, data, type) {
            if(!this.enabled || !this.supportsOutput) {
                throw new Error("Audio device is not enabled or does not support audio output.");
            }

            var url = this.server.service.url() + EVWEB2.urls.audio;
            var params = [
                's=' + this.server.sessionId,
                'a=' + this.id
            ];

            if(type !== undefined) {
                params.push('type=' + type);
            }

            url += '?' + params.join(';') + ';';

            var audioDevice = this;

            var onSendAudioSuccess = function(response) {
                callback(response, audioDevice);
            };

            var onSendAudioError = function() {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse, audioDevice);
            };

            var settings = {
                success: onSendAudioSuccess,
                error: onSendAudioError,
                url: url,
                data: data,
                type: 'POST',
                contentType: 'application/octet-stream',
                processData: false,
            };

            EVWEB2.ajax(settings, this.server.service);
        };
    };
}());

/*globals EVWEB2:true*/
(function() {
    /**
     * Definitions for the possible video export formats available.
     * @enum {string}
     * @readonly
     * @category Search
     */
    EVWEB2.videoExportFormatTypes = {
        /**
         * PS
         */
        ps: 'ps',
        /**
         * AVI
         */
        avi: 'avi',
        /**
         * Embedded ePlayer
         */
        eplayer: 'eplayer',
        /**
         * Zipped PS
         */
        psZip: 'ps_zip',
        /**
         * MP4
         */
        mp4: 'mp4',
        /**
         * PSX
         */
        psx: 'psx',
        /**
         * MOV
         */
        mov: 'mov'
    };

    /**
     * Definitions for the possible video export formats available.
     * @enum {number}
     * @readonly
     * @category Search
     */
    EVWEB2.videoExportStatusTypes= {
        /**
         * Not started
         */
        notStarted: 0,
        /**
         * Pending
         */
        pending: 1,
        /**
         * Exporting
         */
        exporting: 2,
        /**
         * Completed
         */
        completed: 3
    };

    /**
     * The VideoExportStatus object acts as a container for the current status of a
     * video export.  It is initially populated from the information retrieved by
     * {@link EVWEB2.VideoExport} and holds the current status and, if
     * applicable, the download link for the export.
     * @param {EVWEB2.VideoExport} [videoExport=null] The video export instance this
     * status is associated with
     * @param {EVWEB2.videoExportStatusTypes} [status=EVWEB2.videoExportStatusTypes.notStarted]
     * The status of the video export.
     * @param {Number} [percentComplete=0] The percent of export completed.
     * @param {Number} [totalSize=0] The current total file size of the export, in bytes.
     * @class
     * @constructor
     * @category Search
     */
    EVWEB2.VideoExportStatus = function (videoExport, status, percentComplete, totalSize) {
        /**
         * The video export instance this status is associated with
         * @type EVWEB2.VideoExport
         */
        this.videoExport = null;

        /**
         * Status of the video export
         * @type EVWEB2.videoExportStatusTypes
         */
        this.status = EVWEB2.videoExportStatusTypes.notStarted;

        /**
         * The percent of export completed.
         * @type Number
         */
        this.percentComplete = 0;

        /**
         * The current total file size of the export, in bytes.
         * @type Number
         */
        this.totalSize = 0;

        //Assign the constructor values
        if(typeof videoExport !== 'undefined') {
            this.videoExport = videoExport;
        }
        if(typeof status !== 'undefined') {
            this.status = status;
        }
        if(typeof percentComplete !== 'undefined') {
            this.percentComplete = percentComplete;
        }
        if(typeof totalSize !== 'undefined') {
            this.totalSize = totalSize;
        }
    };

    /**
     * The VideoExport object acts as a container for a video export.  It is initially
     * populated from the information retrieved by {@link EVWEB2.Server.videoExport} and
     * holds the information related to the export, as well as methods for retrieving
     * the export.
     * @param {Object} [server=null] {@link EVWEB2.Server} instance this video export
     * is associated with.
     * @param {String} [id=''] ID of the export, returned by {@link EVWEB2.Server.videoExport}.
     * @param {EVWEB2.Camera[]|EVWEB2.AudioDevice[]|EVWEB2.SerialDevice} inputs The inputs associated
     *  with the export.  Can be a mixed list of {@link EVWEB2.Camera}, {@link EVWEB2.AudioDevice}, and
     *  {@link EVWEB2.SerialDevice} instances.
     * @param {EVWEB2.videoExportFormatTypes} [format=EVWEB2.videoExportFormatTypes.ps]
     * The format type of the export.
     * @param {Date} [start=null] Date object representing the beginning of the export
     * period.
     * @param {Date} [end=null] Date object representing the end of the export period.
     * @constructor
     * @param {String[]} [filenames=[]] The file names of the files generated by the export.
     * @class
     * @category Search
     */
    EVWEB2.VideoExport = function (server, id, inputs, format, start, end, filenames) {
        /**
         * Server instance this export status is associated with
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * Unique ID for the export
         * @type string
         */
        this.id = '';

        /**
         * The camera feeds associated with the export.  The property is deprecated, use the
         * updated {@link EVWEB2.VideoExport.inputs} property instead.
         * @type EVWEB2.Camera[]
         * @deprecated
         */
        this.cameras = [];

        /**
         * The inputs associated with the export.
         * @type EVWEB2.Camera[]|EVWEB2.AudioDevice[]|EVWEB2.SerialDevice
         */
        this.inputs = [];

        /**
         * The format type of the export.
         * @type EVWEB2.videoExportFormatTypes
         */
        this.format = EVWEB2.videoExportFormatTypes.ps;

        /**
         * Date object representing the beginning of the export period.
         * @type Date
         */
        this.start = null;

        /**
         * Date object representing the end of the export period.
         * @type Date
         */
        this.end = null;

        /**
         * The file names of the files generated by the export.
         * @type String[]
         */
        this.filenames = [];

        //Assign the constructor values
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof inputs !== 'undefined') {
            this.inputs = inputs;

            this.cameras = $.grep(inputs, function(element) {
                return element instanceof EVWEB2.Camera;
            });
        }
        if(typeof format !== 'undefined') {
            this.format = format;
        }
        if(typeof start !== 'undefined') {
            this.start = start;
        }
        if(typeof end !== 'undefined') {
            this.end = end;
        }
        if(typeof filenames !== 'undefined') {
            this.filenames = filenames;
        }

        /**
         * Retrieves the status of the export.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance and a
         * {@link EVWEB2.VideoExportStatus} instance.
         */
        this.getStatus = function (callback) {
            var videoExport = this;
            var onGetStatusError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetStatusSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Call the error callback
                    onGetStatusError();
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                var status = new EVWEB2.VideoExportStatus(videoExport, data.status, data.progress, data.size);
                callback(successResponse, status);
            };

            var settings = {
                success: onGetStatusSuccess,
                error: onGetStatusError,
                url: this.server.service.url() + EVWEB2.urls.videoexport,
                data: {
                    'export': this.id.toString()
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Generates a URI for downloading a file generated by the export.
         * @param {Number} fileIndex The index of the generated file name in {@link EVWEB2.VideoExport.filenames}.
         * @returns {String} URI for downloading the specified file.
         */
        this.getDownloadUri = function(fileIndex) {
            if(typeof this.filenames[fileIndex] === 'undefined') {
                throw new Error("File index is not generated for this export.");
            }
            var url = this.server.service.url() + EVWEB2.urls.videoexport;
            url += '?export=' + this.id.toString() + '&action=download&file=' + fileIndex;
            return url;
        };

        /**
         * Ends an export, stopping all export processing and removing the download link.
         * Note: Exports will timeout automatically after 15 minutes, however, it is
         * highly recommended that you manually end an export when finished to reduce
         * load on the server.
         * @param {Function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance.
         */
        this.endExport = function (callback) {
            var onVideoExportEndError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onVideoExportEndSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Call the error callback
                    onVideoExportEndError();
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var settings = {
                success: onVideoExportEndSuccess,
                error: onVideoExportEndError,
                url: this.server.service.url() + EVWEB2.urls.videoexport,
                data: {
                    'export': this.id.toString(),
                    action: 'finish'
                }
            };

            EVWEB2.ajax(settings, server.service);
        };
    };


}());
/*globals EVWEB2:true*/

(function() {

    /**
     * The types of supported map item shapes.
     * @enum {number}
     * @readonly
     * @category Maps
     */
    EVWEB2.mapItemShapeTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Unknown
         */
        unknown: 1,
        /**
         * Balloon
         */
        balloon: 2,
        /**
         * Square
         */
        square: 3,
        /**
         * Pin
         */
        pin: 4
    };

    /**
     * The types of supported map items.
     * @enum {number}
     * @readonly
     * @category Maps
     */
    EVWEB2.mapItemCaptionPositionTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Right
         */
        right: 1,
        /**
         * Left
         */
        left: 2,
        /**
         * Top
         */
        top: 3,
        /**
         * Bottom
         */
        bottom: 4
    };

    /**
     * The types of supported map items.
     * @enum {number}
     * @readonly
     * @category Maps
     */
    EVWEB2.mapItemTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Camera
         */
        camera: 1,
        /**
         * Audio
         */
        audio: 2,
        /**
         * Serial
         */
        serial: 3,
        /**
         * Group
         */
        group: 4,
        /**
         * Soft Trigger
         */
        softTrigger: 5,
        /**
         * Input Trigger
         */
        inputTrigger: 6
    };

    /**
     * The types of supported map item shapes.
     * @enum {number}
     * @readonly
     * @category Maps
     */
    EVWEB2.mapItemFlagTypes = {
        /**
         * Auto-context
         */
        autocontext: 0x1,
        /**
         * Mirror
         */
        mirror: 0x2,
        /**
         * Output Hint
         */
        outputHint: 0x4
    };


    /**
     * The MapItemCaptionInfo object represents caption information associated with a map
     * item. The objects are generated in {@link EVWEB2.getMaps}.
     * @param {EVWEB2.mapItemCaptionPositionTypes} [position=EVWEB2.mapItemCaptionPositionTypes.none] The type of item.
     * @param {String} [color='#FFFFFF'] The hex value of the color for the caption.
     * @class
     * @constructor
     * @category Maps
     */
    EVWEB2.MapItemCaptionInfo = function(position, color) {
        /**
         * Position of the map
         * @type EVWEB2.mapItemCaptionPositionTypes
         */
        this.position = EVWEB2.mapItemCaptionPositionTypes.none;

        /**
         * Hex value of the color for the caption
         * @type String
         */
        this.color = '#FFFFFF';

        //Assign the constructor values
        if(typeof position !== 'undefined') {
            this.position = position;
        }
        if(typeof color !== 'undefined') {
            this.color = color;
        }
    };

    /**
     * The MapItemInfo object represents an item associated with a map. The
     * objects are generated in an array from {@link EVWEB2.getMaps}.
     * @param {String} [id=''] The id of the map item.
     * @param {String} [serverId=''] The server id of the server associated with the map item.
     * @param {EVWEB2.mapItemTypes} [type=EVWEB2.mapItemTypes.none] The type of the map item.
     * @param {EVWEB2.mapItemShapeTypes} [shape=EVWEB2.mapItemShapeTypes.none] The shape
     * of the map item.
     * @param {Number} [x=0] The x coordinate of the item (relative to the containing
     * {@link EVWEB2.Map}'s width property).
     * @param {Number} [y=0] The y coordinate of the item (relative to the containing
     * {@link EVWEB2.Map}'s height property).
     * @param {EVWEB2.MapItemCaptionInfo} [caption=null] The caption info for the
     * map item.
     * @param {Number} [rotation=0] The rotation of the item.
     * @param {Number} [flags=0] An OR'd list of flags associated with this map item.
     * @class
     * @constructor
     * @category Maps
     */
    EVWEB2.MapItemInfo = function(id, serverId, type, shape, x, y, caption, rotation, flags) {
        /**
        * The id of the map item.
        * @type String
        */
        this.id = '';

        /**
         * The server id of the server associated with the map item.
         * @type String
         */
        this.serverId = '';

        /**
         * The type of the map item.
         * @type EVWEB2.mapItemTypes
         */
        this.type = EVWEB2.mapItemTypes.none;

        /**
         * Hex value of the color for the caption
         * @type EVWEB2.mapItemShapeTypes
         */
        this.shape = EVWEB2.mapItemShapeTypes.none;

        /**
         * The x coordinate of the item
         * @type Number
         */
        this.x = 0;

        /**
         * The y coordinate of the item
         * @type Number
         */
        this.y = 0;

        /**
         * Caption info for map item
         * @type EVWEB2.MapItemCaptionInfo
         */
        this.caption = null;

        /**
         * The rotation of the map item
         * @type Number
         */
        this.rotation = 0;

        /**
         * An array of all flags associated with the map item.
         * @type EVWEB2.mapItemFlagTypes[]
         */
        this.flags = [];

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof serverId !== 'undefined') {
            this.serverId = serverId;
        }
        if(typeof type !== 'undefined') {
            this.type = type;
        }
        if(typeof shape !== 'undefined') {
            this.shape = shape;
        }
        if(typeof x !== 'undefined') {
            this.x = x;
        }
        if(typeof y !== 'undefined') {
            this.y = y;
        }
        if(typeof caption !== 'undefined') {
            this.caption = caption;
        }
        if(typeof rotation !== 'undefined') {
            this.rotation = rotation;
        }
        if(typeof flags !== 'undefined') {
            /* eslint-disable no-bitwise */
            if((flags&EVWEB2.mapItemFlagTypes.autocontext) === EVWEB2.mapItemFlagTypes.autocontext) {
                this.flags.push(EVWEB2.mapItemFlagTypes.autocontext);
            }
            if((flags&EVWEB2.mapItemFlagTypes.mirror) === EVWEB2.mapItemFlagTypes.mirror) {
                this.flags.push(EVWEB2.mapItemFlagTypes.mirror);
            }
            if((flags&EVWEB2.mapItemFlagTypes.outputHint) === EVWEB2.mapItemFlagTypes.outputHint) {
                this.flags.push(EVWEB2.mapItemFlagTypes.outputHint);
            }
            /* eslint-enable no-bitwise */
        }
    };

    /**
     * The Map object is a wrapped set of information for a server side map.  It
     * acts as a container for the properties of an individual map.
     * @param {EVWEB2.Service} [service=null] The service instance for this map.
     * @param {String} [id=''] ID of the map.
     * @param {EVWEB2.Server} [server=null] The root server instance associated with this map. Items may be from
     * multiple servers, but all map-level requests are targeted to this server.
     * @param {String} [parentId='0'] ID of the parent map.
     * @param {String} [name='Unnamed'] Name of the map.
     * @param {String} [description=''] Description of the map.
     * @param {EVWEB2.MapItemInfo[]} [items=[]] Array of the map items
     * associated with the map.
     * @class
     * @category Maps
     */
    EVWEB2.Map = function (service, id, server, parentId, name, description, items) {
        /**
         * The service instance for this server
         * @type EVWEB2.Service
         */
        this.service = null;

        /**
         * ID of the map
         * @type String
         */
        this.id = '';

        /**
         * The root server instance associated with this map. Items may be from multiple servers, but all map-level
         * requests are targeted to this server.
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * ID of the parent map.
         * @type String
         */
        this.parentId = '0';

        /**
         * Name of the map
         * @type String
         */
        this.name = 'Unnamed';

        /**
         * Description of the map
         * @type String
         */
        this.description = '';

        /**
         * Array of map items associated with the map
         * @type Array
         */
        this.items = [];

        //Assign the constructor values
        if(typeof service !== 'undefined') {
            this.service = service;
        }
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof parentId !== 'undefined') {
            this.parentId = parentId;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof description !== 'undefined') {
            this.description = description;
        }
        if(typeof items !== 'undefined') {
            this.items = items;
        }

        /**
         * Retrieves the URL for the map's background image.
         * @return {string} The URL for the map's background image
         */
        this.getImageUrl = function() {
            if(typeof this.id !== 'undefined') {
                var url = this.service.url() + EVWEB2.urls.map;
                url += '?map=' + this.id;
                return url;
            }
        };
    };

}());

/*globals EVWEB2:true*/
(function() {

    "use strict";

    EVWEB2.serverStatus = {
        normal: 0,
        alarm: 1,
        motion: 2
    };

    /**
     * A status instance for an individual camera.
     * @param {EVWEB2.Camera} [instance=null] The camera instance associated with this status.
     * @param {Boolean} [motion=false] Whether motion is detected on the camera.
     * @param {Boolean} [loss=false] Whether video loss is detected on the camera.
     * @class
     * @category Server
     */
    EVWEB2.StatusCameraItem = function(instance, motion, loss) {
        /**
         *  The camera instance associated with this status
         * @type EVWEB2.Camera
         */
        this.instance = null;

        /**
         * Whether motion is detected on the camera
         * @type Boolean
         */
        this.motion = false;

        /**
         * Whether video loss is detected on the camera
         * @type Boolean
         */
        this.loss = false;

        //Assign the constructor values
        if(typeof instance !== 'undefined') {
            this.instance = instance;
        }
        if(typeof motion !== 'undefined') {
            this.motion = motion;
        }
        if(typeof loss !== 'undefined') {
            this.loss = loss;
        }
    };

    /**
     * A status instance for an individual trigger.
     * @param {EVWEB2.Trigger} [instance=null] The trigger instance associated with this status.
     * @param {EVWEB2.triggerState} [triggerState=EVWEB2.triggerState.unknown] The state of the trigger.
     * @class
     * @category Server
     */
    EVWEB2.StatusTriggerItem = function(instance, triggerState) {
        /**
         *  The trigger instance associated with this status
         * @type EVWEB2.Trigger
         */
        this.instance = null;

        /**
         * The state of the trigger
         * @type EVWEB2.triggerState
         */
        this.triggerState = EVWEB2.triggerState.unknown;

        //Assign the constructor values
        if(typeof instance !== 'undefined') {
            this.instance = instance;
        }
        if(typeof triggerState !== 'undefined') {
            this.triggerState = triggerState;
        }
    };

    /**
     * A status instance for an individual map.
     * @param {EVWEB2.Map} [instance=null] The map instance associated with this status.
     * @param {Boolean} [motion=false] Whether motion is detected on any of cameras included in
     * the map.
     * @param {Boolean} [loss=false] Whether video loss is detected on on any of cameras included
     * in the map.
     * @class
     * @category Server
     */
    EVWEB2.StatusMapItem = function(instance, motion, loss) {
        /**
         *  The map instance associated with this status
         * @type EVWEB2.Map
         */
        this.instance = null;

        /**
         * Whether motion is detected on any of cameras included in the map
         * @type Boolean
         */
        this.motion = false;

        /**
         * Whether video loss is detected on any of cameras included in the map
         * @type Boolean
         */
        this.loss = false;

        //Assign the constructor values
        if(typeof instance !== 'undefined') {
            this.instance = instance;
        }
        if(typeof motion !== 'undefined') {
            this.motion = motion;
        }
        if(typeof loss !== 'undefined') {
            this.loss = loss;
        }
    };

    /**
     * A collection of status information returned by {@link EVWEB2.Server.getStatus}.
     * @param {EVWEB2.Server} [server=null] The server associated with the statuses.
     * @param {EVWEB2.StatusCameraItem[]} [cameras=[]] An array of all requested camera statuses.
     * @param {EVWEB2.StatusTriggerItem[]} [triggers=[]] An array of all requested trigger statuses.
     * @param {EVWEB2.StatusMapItem[]} [maps=[]] An array of all requested map statuses.
     * @class
     * @category Server
     */
    EVWEB2.Status = function(server, cameras, triggers, maps) {
        /**
         * The server associated with the statuses
         * @type EVWEB2.Server
         */
        this.server = null;


        /**
         * The camera statuses
         * @type EVWEB2.StatusCameraItem[]
         */
        this.cameras = [];

        /**
         * The trigger statuses
         * @type EVWEB2.StatusTriggerItem[]
         */
        this.triggers = [];

        /**
         * The map statuses
         * @type EVWEB2.StatusMapItem[]
         */
        this.maps = [];

        //Assign the constructor values
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof cameras !== 'undefined') {
            this.cameras = cameras;
        }
        if(typeof triggers !== 'undefined') {
            this.triggers = triggers;
        }
        if(typeof maps !== 'undefined') {
            this.maps = maps;
        }
    };

    /**
     * A collection of status information returned by {@link EVWEB2.Server.getStatus}.
     * @param {EVWEB2.Server} [server=null] The server associated with the statuses.
     * @param {String[]} [lossCameras=[]] An array of camera IDs for all cameras in a loss state.
     * @param {String[]} [motionCameras=[]] An array of camera IDs for all cameras in a loss state.
     * @param {String[]} [alarmTriggers=[]] An array of trigger IDs for all soft triggers in an alarm state.
     * @param {EVWEB2.serverStatus} [serverStatus=EVWEB2.serverStatus.normal] The server status enum value;
     * @class
     * @category Server
     */
    EVWEB2.ServerStatus = function(server, lossCameras, motionCameras, alarmTriggers, serverStatus) {
        /**
         * The server associated with the statuses
         * @type EVWEB2.Server
         */
        this.server = null;


        /**
         * The camera IDs for all cameras in a loss state.
         * @type String[]
         */
        this.lossCameras = [];

        /**
         * The camera IDs for all cameras in a motion state.
         * @type String[]
         */
        this.motionCameras = [];

        /**
         * The trigger IDs for all soft triggers in an alarm state.
         * @type String[]
         */
        this.alarmTriggers = [];

        /**
         * The server status enum value.
         * @type EVWEB2.serverStatus
         */
        this.serverStatus = EVWEB2.serverStatus.normal;


        //Assign the constructor values
        if(server !== undefined) {
            this.server = server;
        }
        if(lossCameras !== undefined) {
            this.lossCameras = lossCameras;
        }
        if(motionCameras !== undefined) {
            this.motionCameras = motionCameras;
        }
        if(alarmTriggers !== undefined) {
            this.alarmTriggers = alarmTriggers;
        }
        if(serverStatus !== undefined) {
            this.serverStatus = serverStatus;
        }
    };

}());
/*globals EVWEB2:true*/

(function() {

    /**
     * The types of supported group icons.
     * @enum {number}
     * @readonly
     * @category Groups
     */
    EVWEB2.groupIconTypes = {
        /**
         * None
         */
        none: 0,
        /**
         * Factory
         */
        factory: 1,
        /**
         * Court
         */
        court: 2,
        /**
         * House
         */
        house: 3,
        /**
         * Skyscraper
         */
        skyscraper: 4,
        /**
         * Station
         */
        station: 5,
        /**
         * Office
         */
        office: 6
    };


    /**
     * The types of supported group items. This is a placeholder copy of {@link EVWEB2.mapItemTypes}
     * @enum {number}
     * @readonly
     * @category Groups
     */
    EVWEB2.groupItemTypes = EVWEB2.mapItemTypes;

    /**
     * The GroupItemInfo object represents an item associated with a group. The
     * objects are generated in an array from {@link EVWEB2.getGroups}.
     * @param {String} [id=''] The id of the group item.
     * @param {String} [serverId=''] The server id of the server associated with the group item.
     * @param {EVWEB2.groupItemTypes} [type=EVWEB2.groupItemTypes.none] The type of the group item.
     * @class
     * @category Groups
     */
    EVWEB2.GroupItemInfo = function(id, serverId, type) {
        /**
         * The id of the group item.
         * @type String
         */
        this.id = '';

        /**
         * The server id of the server associated with the group item.
         * @type String
         */
        this.serverId = '';

        /**
         * The type of the group item.
         * @type EVWEB2.groupItemTypes
         */
        this.type = EVWEB2.groupItemTypes.none;

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof serverId !== 'undefined') {
            this.serverId = serverId;
        }
        if(typeof type !== 'undefined') {
            this.type = type;
        }
    };

    /**
     * The Group object is a wrapped set of information for a server side group.  It
     * acts as a container for the properties of an individual group.
     * @param {String} [id=''] ID of the group.
     * @param {String} [name='Unnamed'] Name of the group.
     * @param {String} [description=''] Description of the group.
     * @param {EVWEB2.groupIconTypes} [icon=EVWEB2.groupIconTypes.none] The icon associated
     * with the group.
     * @param {EVWEB2.GroupItemInfo[]} [items=[]] Array of the items
     * associated with the group.
     * @class
     * @category Groups
     */
    EVWEB2.Group = function (id, name, description, icon, items) {
        /**
         * ID of the group
         * @type String
         */
        this.id = '';

        /**
         * Name of the group
         * @type String
         */
        this.name = 'Unnamed';

        /**
         * Description of the group
         * @type String
         */
        this.description = '';

        /**
         * Type of group icon
         * @type EVWEB2.groupIconTypes
         */
        this.icon = EVWEB2.groupIconTypes.none;

        /**
         * Array of items associated with the group
         * @type Array
         */
        this.items = [];

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof description !== 'undefined') {
            this.description = description;
        }
        if(typeof icon !== 'undefined') {
            this.icon = icon;
        }
        if(typeof items !== 'undefined') {
            this.items = items;
        }
    };

}());
/*globals EVWEB2:true*/

/**
 * The ThumbnailSearchInfo object represents information for a frame.
 * @param {String} [sessionId=''] Session ID associated with the search.
 * @param {EVWEB2.Camera} [camera=null] Camera associated with the thumbnail search.
 * @param {Date} [frameTimestamp=new Date()] Timestamp associated with the frame.
 * @param {Number} [frameIndex=-1] Index of the frame to retrieve.
 * @class
 * @category Search
 */

EVWEB2.ThumbnailSearchInfo = function (sessionId, camera, frameTimestamp, frameIndex) {
    /**
     * Session ID associated with the thumbnail search
     * @type String
     */
    this.sessionId = '';

    /**
     * Camera associated with the thumbnail search
     * @type EVWEB2.Camera
     */
    this.camera = null;

    /**
     * Timestamp of the required frame
     * @type Date
     */
    this.frameTimestamp = new Date();

    /**
     * Index of the required frame
     * @type Number
     */
    this.frameIndex = -1;

    //Assign the constructor values
    if(typeof sessionId !== 'undefined') {
        this.sessionId = sessionId;
    }
    if(typeof camera !== 'undefined') {
        this.camera = camera;
    }
    if(typeof frameTimestamp !== 'undefined') {
        this.frameTimestamp = frameTimestamp;
    }
    if(typeof frameIndex !== 'undefined') {
        this.frameIndex = frameIndex;
    }

    /**
     * The getThumbnailImageUrl object is used to retrieve the thumbnail image.
     * @param {Number} width The width of the thumbnail image in pixels.
     * @param {Number} height The height of the thumbnail image in pixels.
     * @param {Number} quality The quality of the thumbnail image ranging from 1 -10.
     * @return {String} The URL to request the required thumbnail image.
     */
    this.getThumbnailImageUrl = function(width, height, quality) {
        if(!this.camera.supportsGetFrame()) {
            return '';
        }
        var camera = this.camera;
        var server = camera.server;
        var url = server.service.url() + EVWEB2.urls.thumbnail;

        var params = [
            's=' + sessionId,
            'frame=' + this.frameIndex
        ];

        var useNativeJpeg = false;
        var forwardingSettings = server.service.jpegForwarding;
        if(forwardingSettings.enabled && $.inArray(EVWEB2.cameraFormats.jpeg, camera.formats) !== -1) {
            useNativeJpeg = camera.quality * (forwardingSettings.qualityThreshold/100) < quality &&
                (camera.resolution.width * (forwardingSettings.sizeThreshold/100) < width ||
                    camera.resolution.height * (forwardingSettings.sizeThreshold/100) < height);
        }

        var format = EVWEB2.cameraFormats.transcodedJpeg;
        if(useNativeJpeg || $.inArray(EVWEB2.cameraFormats.transcodedJpeg, camera.formats) === -1) {
            format = EVWEB2.cameraFormats.jpeg;
        }
        if(format !== EVWEB2.cameraFormats.jpeg) {
            params.push('w='+width);
            params.push('h='+height);
            params.push('q='+quality);
        }
        params.push('format='+format);

        url += '?' + params.join(';');

        return url;
    };
};

/**
 * The ThumbnailSearch object represents a thumbnail search. The
 * objects are generated from {@link EVWEB2.Camera.getThumbnailSearch}.
 * @param {String} [sessionId=''] The session id associated with the search.
 * @param {EVWEB2.Camera} [camera=null] The camera associated with the thumbnail search.
 * @param {Date} [start=new Date()] Start time of the search.
 * @param {Date} [end=new Date()] End time of the search.
 * @param {EVWEB2.ThumbnailSearchInfo[]} [framesInfo=[]] An array of ThumbnailSearchInfo objects.
 * @class
 * @category Search
 */
EVWEB2.ThumbnailSearch = function(sessionId, camera, start, end, framesInfo) {
    /**
     * Session ID according to the webservice
     * @type String
     */
    this.sessionId = '';

    /**
    * Camera associated with the thumbnail search
    * @type EVWEB2.Camera
    */
    this.camera = null;

    /**
     * Start time of the search
     * @type Date
     */
    this.start = new Date();

    /**
     * End time of the search
     * @type Date
     */
    this.end = new Date();

    /**
    * Array of frame information associated with the search
    * @type EVWEB2.ThumbnailSearchInfo[]
    */
    this.framesInfo = [];

    //Assign the constructor values
    if(typeof sessionId !== 'undefined') {
        this.sessionId = sessionId;
    }
    if(typeof camera !== 'undefined') {
        this.camera = camera;
    }
    if(typeof start !== 'undefined') {
        this.start = start;
    }
    if(typeof end !== 'undefined') {
        this.end = end;
    }
    if(typeof framesInfo !== 'undefined') {
        this.framesInfo = framesInfo;
    }

    /**
     * Logs out the current thumbnail search.  This destroys all resources associated with the search and should be
     * called for each thumbnail search as the search is finished.
     * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
     *  {@link EVWEB2.ResponseStatus} instance with the details of the response.
     */
    this.logout = function (callback) {
        var server = this.camera.server;
        var onLogoutServerError = function(/*xhr, textStatus, errorThrown*/) {
            var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
            if(typeof callback === 'function') {
                callback(errorResponse);
            }
        };

        var onLogoutServerSuccess = function(/*data, textStatus, xhr*/) {
            var successResponse = new EVWEB2.ResponseStatus(true);
            if(typeof callback === 'function') {
                callback(successResponse);
            }
        };

        var settings = {
            success: onLogoutServerSuccess,
            error: onLogoutServerError,
            url: server.service.url() + EVWEB2.urls.logout,
            data: {
                s: this.sessionId
            }
        };

        EVWEB2.ajax(settings, server.service);
    };

    /**
     * Notifies the service that a process is still in use.  This prevents an inactive thumbnail search from being
     * closed.
     * @param {function} [callback] Callback function to be executed when the call completes. Callback is passed a
     * {@link EVWEB2.ResponseStatus} instance.
     */
    this.notifyUse = function (callback) {
        var searchServer = new EVWEB2.Server(this.camera.server.service, '', this.camera.server.id, true, false, this.sessionId);
        searchServer.notifyUse(callback);
    };

};
/*globals EVWEB2:true*/
(function() {

    /**
     * The TourFolder object is a wrapped object that represents a folder containing one or more tours or folders.
     * The objects are generated in an array from {@link EVWEB2.Service.getTours}.
     * @param {String} [id=''] The ID of the tour folder.
     * @param {String} [name=''] The name of the tour folder.
     * @param {String} [parentId=''] The parent ID of the tour folder.
     * @class
     * @category Tours
     */
    EVWEB2.TourFolder = function(id, name, parentId) {
        /**
         * The ID of the tour folder
         * @type String
         */
        this.id = '';

        /**
         * Name of the tour folder
         * @type String
         */
        this.name = '';

        /**
         * The ID of the tour folder's parent folder
         * @type String
         */
        this.parentId = '';

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof parentId !== 'undefined') {
            this.parentId = parentId;
        }
    };

    /**
     * The TourItem object is a wrapped object that represents a section of the tour. The objects are generated in
     * an array from {@link EVWEB2.Service.getTours}.
     * @param {Number} [index=0] The index in the tour.
     * @param {Number} [dwell=0] The dwell time, in seconds, for the tour item.
     * @param {String} [view=''] The name of the view to be displayed for this tour item.
     * @class
     * @constructor
     * @category Tours
     */
    EVWEB2.TourItem = function(index, dwell, view) {
        /**
         * The index in the tour.
         * Note: Not all indexes are contiguous.
         * @type Number
         */
        this.index = 0;

        /**
         * The dwell time, in seconds for the tour item.
         * @type Number
         */
        this.dwell = 0;

        /**
         * The name of the view to be displayed for this tour item.
         * @type String
         */
        this.view = '';

        //Assign the constructor values
        if(typeof index !== 'undefined') {
            this.index = index;
        }
        if(typeof dwell !== 'undefined') {
            this.dwell = dwell;
        }
        if(typeof view !== 'undefined') {
            this.view = view;
        }
    };

    /**
     * The Tour object is a wrapped set of information for a view tour.
     * @param {String} [name=''] Name of the tour.
     * @param {EVWEB2.TourFolder} [folder=null] The tour's container folder.
     * @param {EVWEB2.TourItem[]} [items=[]] Array of the items in the tour.
     * @param {String} [description=''] Description of the tour.
     * @param {EVWEB2.Service} [service=null] Service the tour belongs to.
     * @class
     * @category Tours
     */
    EVWEB2.Tour = function (name, folder, items, description, service) {
        /**
         * Name of the tour
         * @type String
         */
        this.name = '';

        /**
         * The ID of the tour's container folder
         * @type EVWEB2.TourFolder
         */
        this.folder = null;

        /**
         * Array of the items in the tour.
         * @type EVWEB2.TourItem[]
         */
        this.items = [];

        /**
         * Description of the tour
         * @type String
         */
        this.description = '';

        /**
         * Service the tour belongs to.
         * @type EVWEB2.Service
         */
        this.service = null;

        //Assign the constructor values
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof folder !== 'undefined') {
            this.folder = folder;
        }
        if(typeof items !== 'undefined') {
            this.items = items;
        }
        if(typeof description !== 'undefined') {
            this.description = description;
        }
        if(typeof service !== 'undefined') {
            this.service = service;
        }
    };
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The type of label to display for associations.
     * @enum {number}
     * @readonly
     * @category Associations
     */
    EVWEB2.associationLabel = {
        /**
         * Unknown
         */
        unknown: -1,
        /**
         * None
         */
        none: 0,
        /**
         * Custom Font
         */
        customFont: 1
    };

    /**
     * The type of overlay style for associations.
     * @enum {number}
     * @readonly
     * @category Associations
     */
    EVWEB2.overlayStyle = {
        /**
         * Unknown
         */
        unknown: -1,
        /**
         * Persistent
         */
        persistent: 0,
        /**
         * Hover
         */
        hover: 1
    };

    /**
     * The available display positions for associations.
     * @enum {number}
     * @readonly
     * @category Associations
     */
    EVWEB2.overlayPosition = {
        /**
         * Unknown
         */
        unknown: -1,
        /**
         * None
         */
        none: 0,
        /**
         * Right
         */
        right: 1,
        /**
         * Left
         */
        left: 2,
        /**
         * Top
         */
        top: 3,
        /**
         * Bottom
         */
        bottom: 4
    };

    /**
     * The types of association items available.
     * @enum {number}
     * @readonly
     * @category Associations
     */
    EVWEB2.associationType = {
        /**
         * None
         */
        none: 0,
        /**
         * Record video
         */
        recordVideo: 1,
        /**
         * Video output
         */
        videoOutput: 2,
        /**
         * Audio input
         */
        audioInput: 3,
        /**
         * Audio output
         */
        audioOutput: 4,
        /**
         * Serial port
         */
        serialPort: 5,
        /**
         * Input trigger
         */
        inputTrigger: 6,
        /**
         * Output trigger
         */
        outputTrigger: 7,
        /**
         * Soft trigger
         */
        softTrigger: 8,
        /**
         * Analytics
         */
        analytics: 9,
        /**
         * Security Integrations
         */
        securityIntegrations: 10,
        /**
         * Digital PTZ
         */
        digitalPtz: 11,
        /**
         * Replay
         */
        replay: 12,
        /**
         * Auto-export
         */
        autoExport: 13,
        /**
         * Auto-focus
         */
        autoFocus: 14,
        /**
         * Suspect tracking
         */
        suspectTracking: 15
    };

    /**
     * The different types of PTZ associations. Returned as {@link EVWEB2.AssociationItem.extra} when
     * the type of the association item is {@link EVWEB2.associationType.digitalPtz}.
     * @enum {number}
     * @readonly
     * @category Associations
     */
    EVWEB2.associationPtzType = {
        /**
         * Mechanical PTZ preset
         */
        mechanicalPreset: 0,
        /**
         * Digital PTZ preset
         */
        digitalPreset: 1,
        /**
         * List mechanical PTZ presets
         */
        listMechanicalPresets: 2,
        /**
         * List digital PTZ presets
         */
        listDigitalPresets: 3,
        /**
         * Toggle digital PTZ
         */
        toggleDigitalPtz: 4
    };

    /**
     * Container for an association item.
     * @param {Number} id The id of the item (e.g. camera id, audio id, soft-trigger id, etc).
     * @param {EVWEB2.associationType} [type=EVWEB2.associationType.none] The type of the item in the association.
     * @param {Number} [position=0] Zero-based index to explicitly specify the item in an association
     * relative to other items.
     * @param {Boolean} [statusOnly=true] Whether the association item is for reporting status only or
     * whether it represents a toggle item.
     * @param {Number} [extra=null] If the id is not enough to specify the specific association item.
     * @constructor
     * @category Associations
     */
    EVWEB2.AssociationItem = function(id, type, position, statusOnly, extra) {

        /**
         * The id of the item (e.g. camera id, audio id, soft-trigger id, etc).
         * @type {number}
         */
        this.id = id;

        /**
         * The type of the item in the association.
         * @type {EVWEB2.associationType}
         */
        this.type = EVWEB2.associationType.none;

        /**
         * Zero-based index to explicitly specify the item in an association relative to other items.
         * @type {number}
         */
        this.position = 0;

        /**
         * Whether the association item is for reporting status only or whether it represents a toggle item.
         * @type {boolean}
         */
        this.statusOnly = false;

        /**
         * If the id is not enough to specify the specific association item.
         * @type {number|null}
         */
        this.extra = null;

        if(type !== undefined) {
            this.type = type;
        }
        if(position !== undefined) {
            this.position = position;
        }
        if(statusOnly !== undefined) {
            this.statusOnly = statusOnly;
        }
        if(extra !== undefined) {
            this.extra = extra;
        }
    };

    /**
     * Container for camera association information.
     * @param {EVWEB2.Server} server The server instance the association belongs to.
     * @param {EVWEB2.Camera} camera The camera to which the association belongs to.
     * @param {String} [guid=''] The unique association ID.
     * @param {EVWEB2.AssociationItem[]} [items=[]] The list of items in this association.
     * @param {EVWEB2.associationLabel} [label=EVWEB2.associationLabel.unknown] The association label type.
     * @param {EVWEB2.overlayStyle} [style=EVWEB2.overlayStyle.unknown] The overlay style.
     * @param {EVWEB2.overlayPosition} [position=EVWEB2.overlayPosition.unknown] The position of the overlay.
     * @param {EVWEB2.fontColor} [bgColor=EVWEB2.fontColor.unknown] The overlay background color.
     * @param {Number} [opacity=50] The opacity of the overlay, from 0 - 100 with 0 being transparent.
     * @param {EVWEB2.FontInfo} [fontInfo=new EVWEB2.FontInfo()] The font information for the overlay.
     * @constructor
     * @category Associations
     */
    EVWEB2.Association = function(server, camera, guid, items, label, style, position, bgColor, opacity, fontInfo) {

        /**
         * The server instance the association belongs to.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The camera to which the association belongs to.
         * @type {EVWEB2.Camera}
         */
        this.camera = camera;

        /**
         * The unique association ID.
         * @type {String}
         */
        this.guid = '';

        /**
         * The list of items in this association.
         * @type {EVWEB2.AssociationItem[]}
         */
        this.items = [];

        /**
         * The association label type.
         * @type {EVWEB2.associationLabel}
         */
        this.label = EVWEB2.associationLabel.unknown;

        /**
         * The overlay style.
         * @type {EVWEB2.overlayStyle}
         */
        this.style = EVWEB2.overlayStyle.unknown;

        /**
         * The position of the overlay.
         * @type {EVWEB2.overlayPosition}
         */
        this.position = EVWEB2.overlayPosition.unknown;

        /**
         * The overlay background color.
         * @type {EVWEB2.fontColor}
         */
        this.bgColor = EVWEB2.fontColor.unknown;

        /**
         * The opacity of the overlay, from 0 - 100 with 0 being transparent.
         * @type {Number}
         */
        this.opacity = 50;

        /**
         * The font information for the overlay.
         * @type {EVWEB2.FontInfo}
         */
        this.fontInfo = new EVWEB2.FontInfo();

        if(guid !== undefined) {
            this.guid = guid;
        }
        if(items !== undefined) {
            this.items = items;
        }
        if(label !== undefined) {
            this.label = label;
        }
        if(style !== undefined) {
            this.style = style;
        }
        if(position !== undefined) {
            this.position = position;
        }
        if(bgColor !== undefined) {
            this.bgColor = bgColor;
        }
        if(opacity !== undefined) {
            this.opacity = opacity;
        }
        if(fontInfo !== undefined) {
            this.fontInfo = fontInfo;
        }
    };

}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The connection status of an security integrations device
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsDeviceConnectionStatus = {
        /**
         * Bad message format
         */
        badMessageFormat: -13,
        /**
         * Command not supported
         */
        commandNotSupported: -12,
        /**
         * Internal error
         */
        internalError: -11,
        /**
         * Operator error
         */
        operatorError: -6,
        /**
         * Command failed
         */
        commandFailed: -5,
        /**
         * Authentication error
         */
        authenticationError: -4,
        /**
         * Connection error
         */
        connectionError: -3,
        /**
         * Uninitialized
         */
        uninitialized: 0,
        /**
         * Not connected
         */
        notConnected: 1,
        /**
         * Connecting
         */
        connecting: 2,
        /**
         * Connection successful
         */
        connectionSuccessful: 3,
        /**
         * Authenticating
         */
        authenticating: 4,
        /**
         * Command request
         */
        commandRequest: 5
    };


    /**
     * The actions that can be applied to an security integrations device sensor.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorAction = {
        /**
         * None
         */
        none: 0,
        /**
         * Lock
         */
        lock: 1,
        /**
         * Unlock
         */
        unlock: 2,
        /**
         * Arm
         */
        arm: 3,
        /**
         * Disarm
         */
        disarm: 4,
        /**
         * Activate
         */
        activate: 5,
        /**
         * Deactivate
         */
        deactivate: 6,
        /**
         * Enable reader
         */
        enableReader: 7,
        /**
         * Disable reader
         */
        disableReader: 8,
        /**
         * Card presented
         */
        cardPresented: 9,
        /**
         * Input supervised
         */
        inputSupervised: 10,
        /**
         * Input unsupervised
         */
        inputUnsupervised: 11,
        /**
         * Input normal
         */
        inputNormal: 12,
        /**
         * Arm Away
         */
        armAway: 13,
        /**
         * Arm Stay
         */
        armStay: 14,
        /**
         * Arm No entry delay
         */
        armNoEntryDelay: 15
    };

    /**
     * The types of security integrations device sensors.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorType = {
        /**
         * None
         */
        none: -1,
        /**
         * Relay
         */
        relay: 0,
        /**
         * Input
         */
        input: 1,
        /**
         * Lock
         */
        lock: 2,
        /**
         * Rex
         */
        rex: 3,
        /**
         * Reader
         */
        reader: 4,
        /**
         * Door
         */
        door: 5,
        /**
         * Partition
         */
        partition: 6,
        /**
         * Zone
         */
        zone: 7
    };

    /**
     * The available directions of security integrations device sensors.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorDirection = {
        /**
         * None
         */
        none: -1,
        /**
         * In
         */
        directionIn: 0,
        /**
         * Out
         */
        directionOut: 1,
        /**
         * In-Out
         */
        directionInOut: 2
    };

    /**
     * The available states of an security integrations device sensor.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorState = {
        /**
         * Invalid
         */
        invalid: 0,
        /**
         * Input normal
         */
        inputNormal: 1,
        /**
         * Input Alarmed
         */
        inputAlarmed: 2,
        /**
         * Locked
         */
        locked: 3,
        /**
         * Unlocked
         */
        unlocked: 4,
        /**
         * Armed
         */
        armed: 5,
        /**
         * Disarmed
         */
        disarmed: 6,
        /**
         * Activated
         */
        activated: 7,
        /**
         * Deactivated
         */
        deactivated: 8,
        /**
         * Reader enabled
         */
        readerEnabled: 9,
        /**
         * Reader disabled
         */
        readerDisabled: 10,
        /**
         * Open
         */
        open: 11,
        /**
         * Open too long
         */
        openTooLong: 12,
        /**
         * Closed
         */
        closed: 13,
        /**
         * Door forced open
         */
        doorForcedOpen: 14,
        /**
         * Access Granted
         */
        accessGranted: 15,
        /**
         * Access Denied
         */
        accessDenied: 16,
        /**
         * Rex Granted
         */
        rexGranted: 17,
        /**
         * Rex Denied
         */
        rexDenied: 18,
        /**
         * Lock failure
         */
        lockFailure: 19,
        /**
         * Input supervised
         */
        inputSupervised: 20,
        /**
         * Input not supervised
         */
        inputNotSupervised: 21,
        /**
         * Partition pre-alarm
         */
        partitionPreAlarm: 22,
        /**
         * Partition pre-disarm
         */
        partitionPreDisarm: 23,
        /**
         * Partition alarm
         */
        partitionAlarm: 24,
        /**
         * Partition armed stay
         */
        partitionArmedStay: 25,
        /**
         * Partition armed away
         */
        partitionArmedAway: 26,
        /**
         * Partition armed no entry delay
         */
        partitionArmedNoEntryDelay: 27,
        /**
         * Partition not ready
         */
        partitionNotReady: 28,
        /**
         * Zone open
         */
        zoneOpen: 29,
        /**
         * Zone alarm
         */
        zoneAlarm: 30,
        /**
         * Not monitoring
         */
        notMonitoring: 998,
        /**
         * Error
         */
        error: 999
    };

    /**
     * The available alarm states for an security integrations device sensor.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorAlarm = {
        /**
         * Alert
         */
        alert: 1,
        /**
         * Alarm
         */
        alarm: 2
    };

    /**
     * The available authentication types for a security integration device.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsAuthType = {
        /**
         * None
         */
        none: 0,
        /**
         * Username and password
         */
        userPass: 1,
        /**
         * Access code
         */
        accessCode: 2
    };

    /**
     * The error codes for failing sensor actions.
     * @enum {number}
     * @readonly
     * @category Security Integrations
     */
    EVWEB2.securityIntegrationsSensorErrorType = {
        /**
         * Permission error
         */
        permissionError: -10,
        /**
         * Invalid command
         */
        invalidCommand: -9,
        /**
         * Command timeout
         */
        commandTimeout: -8,
        /**
         * Invalid session
         */
        invalidSession: -7,
        /**
         * Other
         */
        other: -6,
        /**
         * Command OK
         */
        commandOk: 0
    };

    /**
     * Container for traditional type credentials for security integrations devices.  See
     * {@link EVWEB2.SecurityIntegrationsDevice.login} for more details.
     * @param {String} username The username for the device.
     * @param {String} [password=null] The password for the device.
     * @constructor
     * @category Security Integrations
     */
    EVWEB2.SecurityIntegrationsDeviceCredsTraditional = function(username, password) {
        /**
         * The auth type implemented by this credentials.
         * @type {EVWEB2.securityIntegrationsAuthType}
         */
        this.authType = EVWEB2.securityIntegrationsAuthType.userPass;

        /**
         * The username for the device.
         * @type {String}
         */
        this.username = username;

        /**
         * The password for the device.
         * @type {String|null}
         */
        this.password = null;

        if(password !== undefined) {
            this.password = password;
        }
    };

    /**
     * Container for access code type credentials for security integrations devices.  See
     * {@link EVWEB2.SecurityIntegrationsDevice.login} for more details.
     * @param {String} accessCode The access code for the device.
     * @constructor
     * @category Security Integrations
     */
    EVWEB2.SecurityIntegrationsDeviceCredsAccessCode = function(accessCode) {
        /**
         * The auth type implemented by this credentials.
         * @type {EVWEB2.securityIntegrationsAuthType}
         */
        this.authType = EVWEB2.securityIntegrationsAuthType.accessCode;

        /**
         * The access code for the device.
         * @type {String}
         */
        this.accessCode = accessCode;
    };

    /**
     * Container for an security integrations device
     * @param {EVWEB2.Server} server The server associated with the security integrations device.
     * @param {Number} id The ID of the security integrations device.
     * @param {String} [name=""] The name of the device.
     * @param {String} [host=""] The host of the device.
     * @param {Number} [port=0] The port of the device.
     * @param {String} [type=""] The manufacturer of the device.
     * @param {boolean} [enabled=false] Whether the device is enabled.
     * @param {EVWEB2.securityIntegrationsDeviceConnectionStatus} [connectionStatus=EVWEB2.securityIntegrationsDeviceConnectionStatus.uninitialized]
     * The connection status of the device.
     * @param {String} [firmware=""] The firmware version of the device.
     * @param {String} [serial=""] The serial of the device.
     * @param {String} [user=""] The username used to configure the device.
     * @param {EVWEB2.securityIntegrationsAuthType} [authType=EVWEB2.securityIntegrationsAuthType.userPass] The
     * authentication type used by the device.
     * @constructor
     * @category Security Integrations
     */
    EVWEB2.SecurityIntegrationsDevice = function(server, id, name, host, port, type, enabled, connectionStatus,
                                                 firmware, serial, user, authType) {

        /**
         * The server associated with the security integrations device.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The ID of the security integrations device.
         * @type {number}
         */
        this.id = id;

        /**
         * The host of the device.
         * @type {String}
         */
        this.name = "";

        /**
         * The host of the device.
         * @type {String}
         */
        this.host = "";

        /**
         * The port of the device.
         * @type {Number}
         */
        this.port = 0;

        /**
         * The manufacturer of the device.
         * @type {string}
         */
        this.type = "";

        /**
         * Whether the device is enabled.
         * @type {boolean}
         */
        this.enabled = false;

        /**
         * The connection status of the device.
         * @type {EVWEB2.securityIntegrationsDeviceConnectionStatus}
         */
        this.connectionStatus = EVWEB2.securityIntegrationsDeviceConnectionStatus.uninitialized;

        /**
         * The firmware version of the device.
         * @type {string}
         */
        this.firmware = "";

        /**
         * The serial of the device.
         * @type {string}
         */
        this.serial = "";

        /**
         * The username used to configure the device.
         * @type {string}
         */
        this.user = "";

        /**
         * The token used to perform sensor actions, used internally by {@link EVWEB2.SecurityIntegrationsDeviceSensor.performAction}.
         * This token is generated by {@link EVWEB2.SecurityIntegrationsDevice.login} and should not be set manually.
         * @type {String|null}
         */
        this.token = null;

        /**
         * The expiration date of the token.
         * @type {Date|null}
         */
        this.tokenExpiration = null;

        /**
         * The authentication type used by this device.
         * @type {EVWEB2.securityIntegrationsAuthType}
         */
        this.authType = EVWEB2.securityIntegrationsAuthType.userPass;

        if(name !== undefined) {
            this.name = name;
        }
        if(host !== undefined) {
            this.host = host;
        }
        if(port !== undefined) {
            this.port = port;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(enabled !== undefined) {
            this.enabled = enabled;
        }
        if(connectionStatus !== undefined) {
            this.connectionStatus = connectionStatus;
        }
        if(firmware !== undefined) {
            this.firmware = firmware;
        }
        if(serial !== undefined) {
            this.serial = serial;
        }
        if(user !== undefined) {
            this.user = user;
        }
        if(authType !== undefined) {
            this.authType = authType;
        }

        /**
         * Retrieves the list of sensors for this device.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SecurityIntegrationsDeviceSensor} objects detailing all of the sensors associated with the
         *  device.
         */
        this.getSensors = function(callback) {
            var device = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                // Process the devices
                var sensors = $.map(data.sensors, function(element) {
                    var timestamp = element.statusTimestamp ?
                        EVWEB2.util.IETF2Date(element.statusTimestamp) : undefined;

                    var persistedStatuses = element.persistedStatus ? element.persistedStatus.map(function(obj){
                        obj.statusTimestamp = EVWEB2.util.IETF2Date(obj.statusTimestamp);
                        return obj;
                    }) : undefined;

                    return new EVWEB2.SecurityIntegrationsDeviceSensor(device, element.sensorId, element.name,
                        element.type, element.direction, element.availableActions, element.inputs,
                        element.defaultActionTimeout, element.maxActionTimeout, element.status, element.alarm,
                        timestamp, element.statusMessage, persistedStatuses);
                });

                callback(successResponse, sensors);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: device.server.service.url() + EVWEB2.urls.securityIntegrationsDeviceSensors,
                data: {
                    s: device.server.sessionId,
                    device: device.id
                }
            };

            if(device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Logs into the device, retrieving a token for use in
         * {@link EVWEB2.SecurityIntegrationsDeviceSensor.performAction}. Note: The web service will store the
         * provided username and password and associate those with the returned token for the duration of the
         * expiration period provided or until a {@link EVWEB2.SecurityIntegrationsDevice} is performed.  As such,
         * this token should be protected from unauthorized use.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, the generated token for use
         *  with {@link EVWEB2.SecurityIntegrationsDeviceSensor.performAction}, the expiration date of the token, and
         *  an array of {@link EVWEB2.SecurityIntegrationsDeviceSensor} IDs that the logged in user can access.
         * @param {EVWEB2.SecurityIntegrationsDeviceCredsTraditional|EVWEB2.SecurityIntegrationsDeviceCredsAccessCode} credentials The credentials to log into the device.
         * @param {Date} expiration The date at which the generated token should expire.  Note: values more
         * than 30 days in the future will be normalized to 30 days.  Be sure to check the response value
         * for the actual expiration date.
         */
        this.login = function(callback, credentials, expiration) {
            var device = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                device.token = data.token;
                device.tokenExpiration = EVWEB2.util.IETF2Date(data.expiration);

                callback(successResponse, device.token, device.tokenExpiration, data.sensors);
            };

            var data = {
                s: device.server.sessionId,
                device: device.id,
                username: credentials.username,
                password: credentials.password,
                expiration: EVWEB2.util.Date2IETF(expiration)
            };

            if(credentials.authType === EVWEB2.securityIntegrationsAuthType.userPass) {
                data.username = credentials.username;
                data.password = credentials.password;
            }
            else if(credentials.authType === EVWEB2.securityIntegrationsAuthType.accessCode) {
                data.accessCode = credentials.accessCode;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: device.server.service.url() + EVWEB2.urls.securityIntegrationsDeviceLogin,
                type: 'POST',
                data: data
            };

            if(device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Checks whether the device is currently logged in.
         * @return {boolean} Whether the device is currently logged in.
         */
        this.isLoggedIn = function() {
            if(this.authType === EVWEB2.securityIntegrationsAuthType.none) {
                return true;
            }
            if(this.token === null) {
                return false;
            }
            return this.tokenExpiration > new Date();
        };

        /**
         * Logs out of the device.  Note: after performing this action, the token is destroyed and cannot be used
         * again.  Additionally, any calls to {@link EVWEB2.SecurityIntegrationsDeviceSensor.performAction} for sensors
         * associated with this device will fail until another login call is made.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.logout = function(callback) {
            var device = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                device.token = null;
                device.tokenExpiration = null;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            if(device.token === null) {
                var errorResponse = new EVWEB2.ResponseStatus(false, "Not logged in.");
                callback(errorResponse);
                return;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: device.server.service.url() + EVWEB2.urls.securityIntegrationsDeviceLogin,
                type: 'DELETE',
                data: {
                    s: device.server.sessionId,
                    device: device.id,
                    token: device.token
                }
            };

            if(device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

    };

    /**
     * Container for an security integrations device sensor.
     * @param {EVWEB2.SecurityIntegrationsDevice} device The security integrations device associated with this sensor.
     * @param {Number} id The ID of the sensor.
     * @param {String} [name=""] The name of the sensor.
     * @param {EVWEB2.securityIntegrationsSensorType} [type=EVWEB2.securityIntegrationsSensorType.none] The type of sensor.
     * @param {EVWEB2.securityIntegrationsSensorDirection} [direction=EVWEB2.securityIntegrationsSensorDirection.none] The direction
     * of the sensor.
     * @param {EVWEB2.securityIntegrationsSensorAction[]} [availableActions=[]] The actions available to perform by the sensor.
     * @param {Number[]} [inputs=[]] Associated {@link EVWEB2.SecurityIntegrationsDeviceSensor} IDs contained by this sensor.
     * @param {Number} [defaultActionTimeout=0] The default timeout, in seconds, of performing an action.
     * @param {Number} [maxActionTimeout=0] The maximum timeout, in seconds, of performing an action.
     * @param {EVWEB2.securityIntegrationsSensorState[]} [status=[]] The current states of the sensor.
     * @param {EVWEB2.securityIntegrationsSensorAlarm[]} [alarm=[]] The current alarms of the sensor.
     * @param {Date} [statusTimestamp=null] The timestamp of the last status event
     * @param {String} [statusMessage=''] The status message if available (specific to the sensor type)
     * @param {Object[]} [persistedStatus=[]] The persisted status of the sensor.
     * @constructor
     * @category Security Integrations
     */
    EVWEB2.SecurityIntegrationsDeviceSensor = function(device, id, name, type, direction, availableActions,
                                                       inputs, defaultActionTimeout, maxActionTimeout, status, alarm,
                                                       statusTimestamp, statusMessage, persistedStatus) {

        /**
         * The security integrations device associated with this sensor.
         * @type {EVWEB2.SecurityIntegrationsDevice}
         */
        this.device = device;

        /**
         * The ID of the sensor.
         * @type {Number}
         */
        this.id = id;

        /**
         * The name of the sensor.
         * @type {string}
         */
        this.name = "";

        /**
         * The type of sensor.
         * @type {EVWEB2.securityIntegrationsSensorType}
         */
        this.type = EVWEB2.securityIntegrationsSensorType.none;

        /**
         * The direction of the sensor.
         * @type {EVWEB2.securityIntegrationsSensorDirection}
         */
        this.direction = EVWEB2.securityIntegrationsSensorDirection.none;

        /**
         * The actions available to perform by the sensor.
         * @type {EVWEB2.securityIntegrationsSensorAction[]}
         */
        this.availableActions = [];

        /**
         * Associated {@link EVWEB2.SecurityIntegrationsDeviceSensor} IDs contained by this sensor.
         * @type {Number[]}
         */
        this.inputs = [];

        /**
         * The default timeout, in seconds, of performing an action.
         * @type {number}
         */
        this.defaultActionTimeout = 0;

        /**
         * The maximum timeout, in seconds, of performing an action.
         * @type {number}
         */
        this.maxActionTimeout = 0;

        /**
         * The current states of the sensor.
         * @type {EVWEB2.securityIntegrationsSensorState[]}
         */
        this.status = [];

        /**
         * The current alarms of the sensor.
         * @type {EVWEB2.securityIntegrationsSensorAlarm[]}
         */
        this.alarm = [];

        /**
         * The timestamp of the last status information if available.
         * @type {Date}
         */
        this.statusTimestamp = null;

        /**
         * The current status message of the sensor.
         * @type {string}
         */
        this.statusMessage = '';


        /**
         * @typedef {Object} PersistedStatus
         * @property {EVWEB2.securityIntegrationsSensorState[]} status
         * @property {Date} statusTimeStamp
         * @property {string} statusMessage
         */
        /**
         * The persisted status of the sensor, e.g. for a reader this would hold the last card
         * used, the time, and access granted/denied status.
         * @type {PersistedStatus[]}
         */
        this.persistedStatus = [];

        if(name !== undefined) {
            this.name = name;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(direction !== undefined) {
            this.direction = direction;
        }
        if(availableActions !== undefined) {
            this.availableActions = availableActions;
        }
        if(inputs !== undefined) {
            this.inputs = inputs;
        }
        if(defaultActionTimeout !== undefined) {
            this.defaultActionTimeout = defaultActionTimeout;
        }
        if(maxActionTimeout !== undefined) {
            this.maxActionTimeout = maxActionTimeout;
        }
        if(status !== undefined) {
            this.status = status;
        }
        if(alarm !== undefined) {
            this.alarm = alarm;
        }
        if(statusTimestamp !== undefined) {
            this.statusTimestamp = statusTimestamp;
        }
        if(statusMessage !== undefined) {
            this.statusMessage = statusMessage;
        }

        if(persistedStatus !== undefined) {
            this.persistedStatus = persistedStatus;
        }


        /**
         * Perform an action with this sensor.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, a boolean if the action was
         *  successful, and a EVWEB2.securityIntegrationsSensorErrorType value indicating the status of the
         *  operation.
         * @param {EVWEB2.securityIntegrationsSensorAction} action The action to perform.
         * @param {Number} [timeout=0] The timeout for the action
         */
        this.performAction = function(callback, action, timeout) {
            var instance = this;

            if (!instance.device.isLoggedIn()){
                var errorResponse = new EVWEB2.ResponseStatus(false, 'Not logged in');
                callback(errorResponse);
                return;
            }

            if (timeout === undefined) {
                timeout = instance.defaultActionTimeout;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse, false);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse, false);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.actionSuccessful, data.operationStatus);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.device.server.service.url() + EVWEB2.urls.securityIntegrationsDeviceSensors,
                type: 'POST',
                data: {
                    s: instance.device.server.sessionId,
                    token: instance.device.token,
                    device: instance.device.id,
                    sensor: instance.id,
                    action: action,
                    timeout: timeout
                }
            };

            if(instance.device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };
    };
}());
/*globals EVWEB2:true*/
/**
 * @namespace EVWEB2
 */
(function() {
    "use strict";

    /**
     * The positions available for camera OSD text.
     * @enum {number}
     * @readonly
     * @category Camera
     */
    EVWEB2.osdPosition = {
        /**
         * None
         */
        none: 0,
        /**
         * Top-Left
         */
        topLeft: 1,
        /**
         * Top-Center
         */
        topCenter: 2,
        /**
         * Top-Right
         */
        topRight: 3,
        /**
         * Bottom-Left
         */
        bottomLeft: 7,
        /**
         * Bottom-Center
         */
        bottomCenter: 8,
        /**
         * Bottom-Right
         */
        bottomRight: 9
    };

    /**
     * The OSD text available for display.
     * @enum {number}
     * @readonly
     * @category Camera
     */
    EVWEB2.osdDisplay = {
        /**
         * Name
         */
        name: 0x8,
        /**
         * Time
         */
        time: 0x4,
        /**
         * Timezone
         */
        timezone: 0x2,
        /**
         * Date
         */
        date: 0x1
    };

    /**
     * The CameraOsdInfo object is a container for the OSD information for a camera.
     * @param {EVWEB2.osdPosition} [position=EVWEB2.osdPosition.none] The position of the OSD.
     * @param {Boolean} [name=false] Boolean flag for whether the camera name should be displayed on the OSD.
     * @param {Boolean} [time=true] Boolean flag for whether the time should be displayed on the OSD.
     * @param {Boolean} [date=false] Boolean flag for whether the date should be displayed on the OSD.
     * @param {Boolean} [timezone=false] Boolean flag for whether the timezone should be displayed on the OSD.
     * @param {String} [font='Sans'] The font used for displaying the OSD.
     * @param {Number} [fontSize=10] The font size used for displaying the OSD.
     * @param {EVWEB2.fontColor} [fontColor=EVWEB2.fontColor.white] The font color used for displaying the OSD.
     * @param {EVWEB2.fontStyle} [fontStyle=EVWEB2.fontStyle.normal] The font style used for displaying the OSD.
     * @param {EVWEB2.fontFamily} [fontFamily=EVWEB2.fontFamily.default] The font family used for displaying the OSD.
     * @param {EVWEB2.fontWeight} [fontWeight=EVWEB2.fontWeight.light] The font weight used for displaying the OSD.
     * @constructor
     * @category Camera
     */
    EVWEB2.CameraOsdInfo = function(position, name, time, date, timezone, font, fontSize, fontColor, fontStyle,
                                    fontFamily, fontWeight){

        /**
         * The position of the OSD information.
         * @type {EVWEB2.osdPosition}
         */
        this.position = EVWEB2.osdPosition.none;

        /**
         * Boolean flag for whether the camera name should be displayed on the OSD.
         * @type {boolean}
         */
        this.name = false;

        /**
         * Boolean flag for whether the time should be displayed on the OSD.
         * @type {boolean}
         */
        this.time = false;

        /**
         * Boolean flag for whether the date should be displayed on the OSD.
         * @type {boolean}
         */
        this.date = false;

        /**
         * Boolean flag for whether the timezone should be displayed on the OSD.
         * @type {boolean}
         */
        this.timezone = false;

        /**
         * The font used for displaying OSD.
         * @type {String}
         */
        this.font = 'Sans';

        /**
         * The font size for displaying OSD.
         * @type {Number}
         */
        this.fontSize = 10;

        /**
         * The font color for displaying OSD.
         * @type {EVWEB2.fontColor}
         */
        this.fontColor = EVWEB2.fontColor.white;

        /**
         * The font style for displaying OSD.
         * @type {EVWEB2.fontStyle}
         */
        this.fontStyle = EVWEB2.fontStyle.normal;

        /**
         * The font family for displaying OSD.
         * @type {EVWEB2.fontStyle}
         */
        this.fontFamily = EVWEB2.fontFamily.defaultFont;

        /**
         * The font weight for displaying OSD.
         * @type {EVWEB2.fontWeight}
         */
        this.fontWeight = EVWEB2.fontWeight.light;


        if(position !== undefined) {
            this.position = position;
        }

        if(name !== undefined) {
            this.name = name;
        }

        if(time !== undefined) {
            this.time = time;
        }

        if(date !== undefined) {
            this.date = date;
        }

        if(timezone !== undefined) {
            this.timezone = timezone;
        }

        if(font !== undefined) {
            this.font = font;
        }

        if(fontSize !== undefined) {
            this.fontSize = fontSize;
        }

        if(fontColor !== undefined) {
            this.fontColor = fontColor;
        }

        if(fontStyle !== undefined) {
            this.fontStyle = fontStyle;
        }

        if(fontFamily !== undefined) {
            this.fontFamily = fontFamily;
        }

        if(fontWeight !== undefined) {
            this.fontWeight = fontWeight;
        }

        /**
         * Retrieve the bitmask value used for setting the OSD display
         * @returns {number} The bitmask OSD value
         * @internal
         */
        this.getDisplayBitmask = function(){
            /* eslint-disable no-bitwise */
            var bitmask = 0;

            if(this.name) {
                bitmask |= EVWEB2.osdDisplay.name;
            }

            if(this.date){
                bitmask |= EVWEB2.osdDisplay.date;
            }

            if(this.time){
                bitmask |= EVWEB2.osdDisplay.time;
            }

            if(this.timezone){
                bitmask |= EVWEB2.osdDisplay.timezone;
            }
            /* eslint-enable no-bitwise */

            return bitmask;
        };
    };

    /**
     * Camera Configuration container
     * @param {EVWEB2.Camera} camera the camera instance the config belongs to
     * @constructor
     * @category Camera
     */
    EVWEB2.CameraConfig = function(camera) {
        if(camera === undefined){
            throw new Error('Camera required');
        }

        /**
         * The camera instance this config belongs to
         * @type {EVWEB2.Camera}
         */
        this.camera = camera;

        /**
         * Cached OSD information.
         * @type {EVWEB2.CameraOsdInfo}
         */
        var osdInfo = null;

        /**
         * The average frame size received from the camera
         * @type {number}
         */
        var averageFrameSize = 0;

        /**
         *
         * The setOsdInfo is a method that sets the OSD display information for a camera on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response.
         * @param {EVWEB2.CameraOsdInfo} cameraOsdInfo The new OSD info to apply to the camera.
         */
        this.setOsdInfo = function(callback, cameraOsdInfo){
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            if(cameraOsdInfo === undefined) {
                throw new Error('CameraOsdInfo required');
            }

            var onSetCameraOsdError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSetCameraOsdSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: this.camera.server.sessionId,
                camera: this.camera.id,
                position: cameraOsdInfo.position,
                display: cameraOsdInfo.getDisplayBitmask(),
                fontName: cameraOsdInfo.font,
                fontSize: cameraOsdInfo.fontSize,
                evFontColor: cameraOsdInfo.fontColor,
                evFontFamily: cameraOsdInfo.fontFamily,
                evFontStyle: cameraOsdInfo.fontStyle,
                evFontWeight: cameraOsdInfo.fontWeight
            };

            var settings = {
                success: onSetCameraOsdSuccess,
                error: onSetCameraOsdError,
                url: this.camera.server.service.url() + EVWEB2.urls.camera,
                data: params,
                type: 'POST'
            };
            EVWEB2.ajax(settings, this.camera.server.service, true);
        };

        /**
         * Utility function to generate the legacy OSD position strings still in use
         * from the new {@link EVWEB2.osdPosition} enumerations.
         * @param {EVWEB2.osdPosition} newPosition The new OSD position value.
         * @returns {String} The corresponding legacy string that matches the new position.
         */
        var generateDeprecatedOsdPosition = function(newPosition){
            var oldPosition;
            switch(newPosition){
                case EVWEB2.osdPosition.bottomLeft:
                    oldPosition = 'bottom-left';
                    break;
                case EVWEB2.osdPosition.bottomCenter:
                    oldPosition = 'bottom-center';
                    break;
                case EVWEB2.osdPosition.bottomRight:
                    oldPosition = 'bottom-right';
                    break;
                case EVWEB2.osdPosition.topLeft:
                    oldPosition = 'top-left';
                    break;
                case EVWEB2.osdPosition.topCenter:
                    oldPosition = 'top-center';
                    break;
                case EVWEB2.osdPosition.topRight:
                    oldPosition = 'top-right';
                    break;
                default:
                    oldPosition = 'none';
            }
            return oldPosition;
        };

        /* TODO The camera.web endpoint exposes a lot of this information from a single endpoint
         * there should be a higher level function that can be called to update all of the configuration
         * state at once (osd info, average frame size, etc). Each get method should call that higher level
         * function which updates all of the configuration state at once instead of each function re-querying
         * the server
         */

        /**
         * Retrieves the OSD information for a camera from the web service.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response, an instance of
         * {@link EVWEB2.CameraOsdInfo}, and the camera {@link EVWEB2.Camera} instance it belongs to.
         * @param {Boolean} [forceUpdate=false] Flag to use cached OSD information or not. By default if OSD information
         * has already been fetched and is available this function will return that. When true this function will always
         * query the server for the latest OSD information.
         */
        this.getOsdInfo = function(callback, forceUpdate) {
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            if(forceUpdate === undefined){
                forceUpdate = false;
            }

            var instance = this;

            if(osdInfo !== null && !forceUpdate){
                // use cached value
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, osdInfo, instance.camera);
                return;
            }

            var onGetCameraOsdError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetCameraOsdSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                if(osdInfo === null) {
                    osdInfo = new EVWEB2.CameraOsdInfo();
                }

                osdInfo.position = data.camera.osdInfo.position;
                /* eslint-disable no-bitwise */
                osdInfo.name = Boolean(data.camera.osdInfo.display & EVWEB2.osdDisplay.name);
                osdInfo.time = Boolean(data.camera.osdInfo.display & EVWEB2.osdDisplay.time);
                osdInfo.date = Boolean(data.camera.osdInfo.display & EVWEB2.osdDisplay.date);
                osdInfo.timezone = Boolean(data.camera.osdInfo.display & EVWEB2.osdDisplay.timezone);
                /* eslint-enable no-bitwise */
                osdInfo.font = data.camera.osdInfo.fontName;
                osdInfo.fontSize = data.camera.osdInfo.fontSize;
                osdInfo.fontColor = data.camera.osdInfo.evFontColor;
                osdInfo.fontStyle = data.camera.osdInfo.evFontStyle;
                osdInfo.fontFamily = data.camera.osdInfo.evFontFamily;
                osdInfo.fontWeight = data.camera.osdInfo.evFontWeight;


                // update deprecated osd information
                instance.camera.osd.position = generateDeprecatedOsdPosition(osdInfo.position);
                instance.camera.osd.name = osdInfo.name;
                instance.camera.osd.time = osdInfo.time;
                instance.camera.osd.date = osdInfo.date;
                instance.camera.osd.timezone = osdInfo.timezone;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, osdInfo, instance.camera);
            };

            var params = {
                s: this.camera.server.sessionId,
                camera: this.camera.id
            };

            var settings = {
                success: onGetCameraOsdSuccess,
                error: onGetCameraOsdError,
                url: this.camera.server.service.url() + EVWEB2.urls.camera,
                data: params
            };

            EVWEB2.ajax(settings, this.camera.server.service);
        };


        /**
         * Retrieves the average frame size received for a camera from the web service.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response, the average frame size,
         * and the {@link EVWEB2.Camera} instance
         */
        this.getAverageFrameSize = function(callback) {

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var instance = this;

            var onGetAvgFrameSizeError= function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetAvgFrameSizeSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                averageFrameSize = data.camera.averageFrameSize;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, averageFrameSize, instance.camera);
            };

            var params = {
                s: this.camera.server.sessionId,
                camera: this.camera.id
            };

            var settings = {
                success: onGetAvgFrameSizeSuccess,
                error: onGetAvgFrameSizeError,
                url: this.camera.server.service.url() + EVWEB2.urls.camera,
                data: params
            };

            EVWEB2.ajax(settings, this.camera.server.service);
        };
    };

    /**
     * Definitions for the types of digital PTZ available to cameras.
     * @enum {number}
     * @category Camera
     * @readonly
     */
    EVWEB2.digitalPtzTypes = {
        /**
         * Normal
         */
        normal: 1,
        /**
         * Dewarp
         */
        dewarp: 2,
        /**
         * Panorama
         */
        panorama: 4,
        /**
         * Dual-View
         */
        dualView: 8
    };

    /**
     * Definitions for the basic types of PTZ available to cameras.
     * @enum {string}
     * @category Camera
     * @readonly
     */
    EVWEB2.ptzTypes = {
        /**
         * None
         */
        none: 'none',
        /**
         * Standard (Mechanical)
         */
        standard: 'standard',
        /**
         * Digital
         */
        digital: 'digital'
    };

    /**
     * Definitions for the ptz directions used by {@link EVWEB2.Camera.ptzMove}
     * @enum {string}
     * @readonly
     * @category Camera
     */
    EVWEB2.ptzDirections = {
        /**
         * Up-Left
         */
        upLeft: 'ul',
        /**
         * Up
         */
        up: 'u',
        /**
         * Up-Right
         */
        upRight: 'ur',
        /**
         * Left
         */
        left: 'l',
        /**
         * None
         */
        none: 'n',
        /**
         * Right
         */
        right: 'r',
        /**
         * Down-Left
         */
        downLeft: 'dl',
        /**
         * Down
         */
        down: 'd',
        /**
         * Down-Right
         */
        downRight: 'dr',
        /**
         * Zoom-In
         */
        zoomIn: 'i',
        /**
         * Zoom-Out
         */
        zoomOut: 'o'
    };


    /**
     * Definitions for the available camera formats.
     * @enum {number}
     * @readonly
     * @category Camera
     */
    EVWEB2.cameraFormats = {
        /**
         * JPEG
         */
        jpeg: 0,
        /**
         * MPEG 1
         */
        mpeg1: 1,
        /**
         * MPEG 2
         */
        mpeg2: 2,
        /**
         * h.263
         */
        h263: 3,
        /**
         * MPEG 4
         */
        mpeg4: 4,
        /**
         * h.264
         */
        h264: 5,
        /**
         * Transcoded JPEG
         */
        transcodedJpeg: 6
    };

    /**
     * Definitions of the available thumbnail sizes.
     * @enum {number}
     * @readonly
     * @category Camera
     */
    EVWEB2.cameraThumbnailSizes = {
        /**
         * 80x80 thumbnail
         */
        size80x80: 0,
        /**
         * 128x128 thumbnail
         */
        size128x128: 1,
        /**
         * 200x200 thumbnail
         */
        size200x200: 2
    };

    /**
     * A digital PTZ rectangle.
     * @param {Number} [x=0] The x-coordinate of the rectangle.
     * @param {Number} [y=0] The y-coordinate of the rectangle.
     * @param {Number} [width=0] The width of the rectangle.
     * @param {Number} [height=0] The height of the rectangle.
     * @constructor
     * @class
     * @category Camera
     */
    EVWEB2.DigitalPtzRectangle = function(x, y, width, height) {
        /**
         * The x-coordinate of the rectangle.
         * @type Number
         */
        this.x = 0;

        /**
         * The y-coordinate of the rectangle.
         * @type Number
         */
        this.y = 0;

        /**
         * The width of the rectangle.
         * @type Number
         */

        this.width = 0;

        /**
         * The height of the rectangle.
         * @type Number
         */
        this.height = 0;

        //Assign the constructor values
        if(typeof x !== 'undefined') {
            this.x = x;
        }
        if(typeof y !== 'undefined') {
            this.y = y;
        }
        if(typeof width !== 'undefined') {
            this.width = width;
        }
        if(typeof height !== 'undefined') {
            this.height = height;
        }
    };


    /**
     * A PTZ preset retrieved from {@link EVWEB2.Camera.getPtzPresets}
     * @param {String} [id=''] The ID of the PTZ preset.
     * @param {String} [name='Undefined'] The name of the PTZ preset.
     * @constructor
     * @class
     * @category Camera
     */
    EVWEB2.PtzPreset = function(id, name) {
        /**
         * Unique ID for this PTZ preset
         * @type String
         */
        this.id = '';

        /**
         * Name of this PTZ preset
         * @type String
         */
        this.name = 'Undefined';

        //Assign the constructor values
        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
    };

    /**
     * A camera resolution.
     * @param {Number} [width=0] The width, in pixels, of the resolution.
     * @param {Number} [height=0] The height, in pixels, of the resolution.
     * @constructor
     * @class
     * @category Camera
     */
    EVWEB2.CameraResolution = function(width, height) {
        /**
         * The width, in pixels, of the resolution.
         * @type Number
         */
        this.width = 0;

        /**
         * The height, in pixels, of the resolution.
         * @type Number
         */
        this.height = 0;

        //Assign the constructor values
        if(typeof width !== 'undefined') {
            this.width = width;
        }
        if(typeof height !== 'undefined') {
            this.height = height;
        }
    };

    /**
     * The camera object acts as a large container for all the camera feed operations and information.
     * It is initially populated from the information retrieved in the {@link EVWEB2.Server.getCameras} function and
     * holds the unique information for an individual camera on an exacqVision server.  The information
     * can be used to then retrieve images or searching information from the server specific to this camera
     * device.
     * @param {EVWEB2.Server} [server=null] Server instance this camera is associated with.
     * @param {String} [id=''] ID of the camera according to the web service.
     * @param {String} [ctx=''] Context ID for this camera.
     * @param {String} [name='Undefined'] Name of this camera.
     * @param {Boolean} [ptz=false] Boolean flag for whether PTZ is attached to this camera.
     * @param {Boolean} [disabled=true] Boolean flag for whether the camera is disabled.
     * @param {Boolean} [hasVideo=false] Boolean flag for whether the camera gets video.
     * @param {Object} [osd={}] Object containing all OSD information.
     * @param {String} [osd.position='none'] The position of the OSD.
     * @param {Boolean} [osd.name=false] Boolean flag for whether the camera name should be displayed on the OSD.
     * @param {Boolean} [osd.time=false] Boolean flag for whether the time should be displayed on the OSD.
     * @param {Boolean} [osd.date=false] Boolean flag for whether the date should be displayed on the OSD.
     * @param {Boolean} [osd.timezone=false] Boolean flag for whether the timezone should be displayed on the OSD.
     * @param {EVWEB2.ptzTypes} [ptzType=EVWEB2.ptzTypes.none] The type of PTZ of this camera.
     * @param {EVWEB2.digitalPtzTypes[]} [digitalPtzTypes=[]] Array of {@link EVWEB2.digitalPtzTypes} detailing the
     * digital ptz types the camera supports.
     * @param {EVWEB2.cameraFormats[]} [formats=[EVWEB2.cameraFormats.transcodedJpeg]] The formats available for
     * retrieiving video for the camera.
     * @param {EVWEB2.CameraResolution} [resolution=null] The resolution of the camera.
     * @param {Number} [quality=-1] The quality of the camera, ranging from 0-10.  For cameras with no quality
     * setting, this value will be -1.
     * @param {Number} [frameRate=-1] The frame rate of the camera.  For cameras with no frame rate setting, this
     * value will be -1.
     * @param {String} [parentId=id] If camera is a sub-context, the ID of the parent camera. Equal to its own ID if
     * otherwise.
     * @param {Number} [rotation=0] The rotation, in degrees, of the camera.
     * @class
     * @category Camera
     */
    EVWEB2.Camera = function (server, id, ctx, name, ptz, disabled, hasVideo, osd, ptzType, digitalPtzTypes,
        formats, resolution, quality, frameRate, parentId, rotation) {
        /**
         * Unique ID for this camera
         * @type string
         */
        this.id = '';

        /**
         * An instance of the source camera for this camera.  Used only for digital PTZ
         * cameras, which are based off another camera.
         * @type {EVWEB2.Camera}
         */
        this.sourceCamera = this;

        /**
         * Context ID for this camera
         * @private
         * @type String
         */
        this.ctx = '';

        /**
         * Name of this camera
         * @type String
         */
        this.name = 'Undefined';

        /**
         * Server instance this camera is attached to
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * Boolean flag for whether PTZ is attached to this camera
         * @type Boolean
         */
        this.ptz = false;

        /**
         * The type of PTZ that is attached to this camera
         * @type {EVWEB2.ptzTypes}
         */
        this.ptzType = EVWEB2.ptzTypes.none;

        /**
         * The digital PTZ types the camera supports
         * @type {Array}
         */
        this.digitalPtzTypes = [];

        /**
         * The current digital PTZ type of this camera
         * @type {EVWEB2.digitalPtzTypes}
         */
        this.digitalPtzType = null;

        /**
         * Boolean flag for whether the camera is disabled
         * @type Boolean
         */
        this.disabled = true;

        /**
         * Boolean flag for whether the camera gets video
         * @type Boolean
         */
        this.video = false;

        /**
         * Object containing all OSD information.
         * Deprecated in favor of new {@link EVWEB2.CameraConfig} API which includes
         * more exhaustive OSD information.
         * @type Object
         * @deprecated
         */
        this.osd = {
            /**
             * String for OSD position
             * @type String
             */
            position: 'none',

            /**
             * Boolean flag for the OSD display for name
             * @type Boolean
             */
            name: false,

            /**
             * Boolean flag for the OSD display for time
             * @type Boolean
             */
            time: false,

            /**
             * Boolean flag for the OSD display for date
             * @type Boolean
             */
            date: false,

            /**
             * Boolean flag for the OSD display for timezone
             * @type Boolean
             */
            timezone: false
        };

        /**
         * The formats available for retrieiving video for the camera.
         * @type {EVWEB2.cameraFormats[]}
         */
        this.formats = [
            EVWEB2.cameraFormats.transcodedJpeg
        ];

        /**
         * The resolution of the camera.
         * @type {EVWEB2.CameraResolution}
         */
        this.resolution = null;

        /**
         * The quality of the camera, ranging from 0-10.  For cameras with no quality setting, this value will be -1.
         * @type {Number}
         */
        this.quality = -1;

        /**
         * The frame rate of the camera.  For cameras with no frame rate setting, this value will be -1.
         * @type {Number}
         */
        this.frameRate = -1;


        /**
         * The configuration settings for the camera.
         * @type {EVWEB2.CameraConfig}
         */
        this.config = new EVWEB2.CameraConfig(this);


        /**
         * Flag used internally by panel to decide if it should try to instantiate a native (H264) decoder.
         * If a decoder was instantiated for this camera previously it can 'mark' the camera so the panel
         * knows to not try again during the current session.
         * @internal
         * @private
         * @type {boolean}
         */
        this.nativeDecodingFailed = false;

        /**
         * Unique ID of the parent camera
         * @type {string}
         */
        this.parentId = typeof id !== 'undefined' ? id : '';

        /**
         * The rotation, in degrees, of the camera.
         * @type {Number}
         */
        this.rotation = 0;

        /**
         * Internal value of the PTZ camera's speed.  Defaults to 50.
         * @private
         * @type Number
         */
        var ptzSpeed = 50;

        /**
         * Internal value specifiying whether the formats of the camera support getFrame requests.  This is used
         * to cache the value of {@link EVWEB2.Camera.supportsGetFrame}.
         * @private
         * @internal
         * @type {Boolean}
         */
        var formatsSupportGetFrame;

        /**
         * Internal value specifiying whether the formats of the camera support getVideo requests.  This is used
         * to cache the value of {@link EVWEB2.Camera.supportsGetVideo}.
         * @private
         * @internal
         * @type {Boolean}
         */
        var formatsSupportGetVideo;

        //Assign the constructor values
        if(server !== undefined) {
            this.server = server;
        }
        if(id !== undefined) {
            this.id = id;
        }
        if(ctx !== undefined) {
            this.ctx = ctx;
        }
        if(name !== undefined) {
            this.name = name;
        }
        if(ptz !== undefined) {
            this.ptz = ptz;
        }
        if(ptzType !== undefined) {
            this.ptzType = ptzType;
        }
        if(disabled !== undefined) {
            this.disabled = disabled;
        }
        if(hasVideo !== undefined) {
            this.video = hasVideo;
        }
        if(osd !== undefined) {
            if(osd.position !== undefined) {
                this.osd.position = osd.position;
            }
            if(osd.name !== undefined) {
                this.osd.name = osd.name;
            }
            if(osd.time !== undefined) {
                this.osd.time = osd.time;
            }
            if(osd.date !== undefined) {
                this.osd.date = osd.date;
            }
            if(osd.timezone !== undefined) {
                this.osd.timezone = osd.timezone;
            }
        }
        if(digitalPtzTypes !== undefined) {
            this.digitalPtzTypes = digitalPtzTypes;
        }
        if(formats !== undefined) {
            this.formats = formats;
        }
        if(resolution !== undefined) {
            this.resolution = resolution;
        }
        if(quality !== undefined) {
            this.quality = quality;
        }
        if(frameRate !== undefined) {
            this.frameRate = frameRate;
        }
        if(parentId !== undefined) {
            this.parentId = parentId;
        }
        if(rotation !== undefined) {
            this.rotation = rotation;
        }

        // Update the digital PTZ info if transcoding is not available.
        if($.inArray(EVWEB2.cameraFormats.transcodedJpeg, this.formats) === -1) {
            this.digitalPtzType = null;
            this.digitalPtzTypes = [];
        }

        /**
         * Generates a stream ID for a video.web or pull.web request based off of the provided ID.
         * @param {String} streamId The stream ID to process.
         * @return {String} A stream ID
         */
        var generateStreamId = function(streamId) {
            if (typeof streamId === "undefined") {
                if (EVWEB2.config.defaultStreamId === null) {
                    EVWEB2.config.defaultStreamId = EVWEB2.util.generateStreamId();
                }
                streamId = EVWEB2.config.defaultStreamId;
            }
            return streamId;
        };

        /**
         * Determines whether the formats of the camera support getFrame requests.
         * @return {Boolean} Whether the formats of the camera support getFrame requests.
         */
        this.supportsGetFrame = function() {
            if(typeof formatsSupportGetFrame === 'undefined') {

                var supportsJpeg = $.inArray(EVWEB2.cameraFormats.jpeg, this.formats) !== -1;
                var supportsTranscodedJpeg = $.inArray(EVWEB2.cameraFormats.transcodedJpeg, this.formats) !== -1;
                formatsSupportGetFrame = supportsJpeg || supportsTranscodedJpeg;
            }
            return formatsSupportGetFrame;
        };

        /**
         * Determines whether the formats of the camera support getVideo requests.
         * @return {Boolean} Whether the formats of the camera support getVideo requests.
         */
        this.supportsGetVideo = function() {
            if(typeof formatsSupportGetVideo === 'undefined') {
                var streamableFormats = [
                    EVWEB2.cameraFormats.mpeg1,
                    EVWEB2.cameraFormats.mpeg2,
                    EVWEB2.cameraFormats.h263,
                    EVWEB2.cameraFormats.mpeg4,
                    EVWEB2.cameraFormats.h264
                ];
                formatsSupportGetVideo = false;
                var i, len;
                for(i=0, len=streamableFormats.length; i<len; i++) {
                    if($.inArray(streamableFormats[i], this.formats) !== -1) {
                        formatsSupportGetVideo = true;
                        return formatsSupportGetVideo;
                    }
                }
            }
            return formatsSupportGetVideo;
        };

        /**
         * Generates the legacy pull.web request for a frame.
         * @private
         * @param {EVWEB2.Camera} instance The camera instance for the request.
         * @param {Number} width The width of the image in pixels
         * @param {Number} height The height of the image in pixels
         * @param {Number} quality Quality between 1 and 10 with the level of quality of the image (1 lowest, 10
         * highest)
         * @param {String} [searchId] The unique search ID for the feed
         * @param {String} [streamId] The unique stream ID for the feed
         * @return {String} The pull.web URL to request the desired frame from this Camera
         */
        var legacyGetFrame = function(instance, width, height, quality, searchId, streamId) {
            var url = instance.server.service.url() + EVWEB2.urls.legacyGetFrame;
            var params = [
                's=' + instance.server.sessionId,
                'camera=' + instance.id,
                'q=' + quality,
                'w=' + width,
                'h=' + height
            ];

            if (typeof searchId !== 'undefined') {
                params.push('search_id=' + searchId);
            }

            if (typeof streamId === "undefined") {
                if (EVWEB2.config.defaultStreamId === null) {
                    EVWEB2.config.defaultStreamId = EVWEB2.util.generateStreamId();
                }
                streamId = EVWEB2.config.defaultStreamId;
            }
            params.push('stream='+streamId);

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         *	The camera object, once set, has all the information needed to retrieve a frame (an image) from the web
         *	service for it.  Since this image requires a specific URL, each Camera instance contains a method
         *	to generate the URL for retrieving frames.  If the search ID parameter is set, the returned URL will be
         *	pulling from an already initialized search session.  This ID will point to the requested history feed
         *	from the camera.
         *	@param {Number} width The width of the image in pixels
         *	@param {Number} height The height of the image in pixels
         *	@param {Number} quality Quality between 1 and 10 with the level of quality of the image (1 lowest, 10
         *	highest)
         *	@param {String} [searchId] The unique search ID for the feed
         *	@param {String} [streamId] The unique stream ID for the feed
         *
         *	@return {String} The URL to request the desired frame from this Camera
         */
        this.getFrame = function (width, height, quality, searchId, streamId) {
            var testCamera = this;
            if(this.sourceCamera !== this) {
                testCamera = this.sourceCamera;
            }
            if(testCamera.formats.length === 1 && testCamera.formats[0] === EVWEB2.cameraFormats.transcodedJpeg) {
                // If only transcoded JPEG is available, this service doesn't provide video.web.
                return legacyGetFrame(this, width, height, quality, searchId, streamId);
            }
            if(!testCamera.supportsGetFrame()) {
                return '';
            }

            var url = this.server.service.url() + EVWEB2.urls.video;
            var params = [
                's=' + this.server.sessionId,
                'camera=' + this.id,
                'stream=' + generateStreamId(streamId)
            ];
            if (typeof searchId !== 'undefined') {
                params.push('search_id=' + searchId);
            }

            var useNativeJpeg = false;
            var forwardingSettings = this.server.service.jpegForwarding;
            if(forwardingSettings.enabled && $.inArray(EVWEB2.cameraFormats.jpeg, this.formats) !== -1) {
                useNativeJpeg = this.quality * (forwardingSettings.qualityThreshold/100) < quality &&
                                (this.resolution.width * (forwardingSettings.sizeThreshold/100) < width ||
                                this.resolution.height * (forwardingSettings.sizeThreshold/100) < height);
            }

            var format = EVWEB2.cameraFormats.transcodedJpeg;
            if(useNativeJpeg || $.inArray(EVWEB2.cameraFormats.transcodedJpeg, this.formats) === -1) {
                format = EVWEB2.cameraFormats.jpeg;
            }
            if(format !== EVWEB2.cameraFormats.jpeg) {
                params.push('w='+width);
                params.push('h='+height);
                params.push('q='+quality);
            }
            params.push('format='+format);

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * Generates the legacy pull.web request for a frame download.
         * @param {EVWEB2.Camera} instance The camera instance for the request.
         * @param {String} fileName The requested name for the file download.
         * @param {Number} quality Quality between 1 and 10 with the level of quality of the image (1 lowest, 10
         * highest)
         * @param {String} [searchId] The unique search ID for the feed
         * @param {String} [streamId] The unique stream ID for the feed
         * @return {String} The pull.web URL to request the desired frame from this Camera
         * @private
         */
        var legacyGetDownloadFrame = function(instance, fileName, quality, searchId, streamId) {
            var url = instance.server.service.url() + EVWEB2.urls.legacyGetFrame;
            var params = [
                's=' + instance.server.sessionId,
                'camera=' + instance.id,
                'q=' + quality,
                'download=' + fileName,
                'stream=' + generateStreamId(streamId)
            ];

            if (typeof searchId !== 'undefined') {
                params.push('search_id=' + searchId);
            }

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * Generates a URL to download the current frame.
         * @param {String} fileName Name of the file to be downloaded
         * @param {Number} [quality] Quality between 1 and 10 with the level of quality of the image (1 lowest,
         * 10 highest)
         * @param {String} [searchId] The unique search ID for the feed
         * @param {String} [streamId] The unique stream ID for the feed
         *
         * @return {String} The URL to request the desired frame from this Camera
         */
        this.getDownloadFrame = function (fileName, quality, searchId, streamId) {
            if(this.formats.length === 1 && this.formats[0] === EVWEB2.cameraFormats.transcodedJpeg) {
                // If only transcoded JPEG is available, this service doesn't provide video.web.
                return legacyGetDownloadFrame(this, fileName, quality, searchId, streamId);
            }
            if(!this.supportsGetFrame()) {
                return '';
            }

            var url = this.server.service.url() + EVWEB2.urls.video;
            var params = [
                's=' + this.server.sessionId,
                'camera=' + this.id,
                'download=' + fileName,
                'stream=' + generateStreamId(streamId)
            ];

            if (typeof searchId !== 'undefined') {
                params.push('search_id=' + searchId);
            }

            var useNativeJpeg = false;
            var forwardingSettings = this.server.service.jpegForwarding;
            if(forwardingSettings.enabled && $.inArray(EVWEB2.cameraFormats.jpeg, this.formats) !== -1) {
                useNativeJpeg = this.quality * (forwardingSettings.qualityThreshold/100) < quality;
            }

            var format = EVWEB2.cameraFormats.transcodedJpeg;
            if(useNativeJpeg) {
                format = EVWEB2.cameraFormats.jpeg;
            }
            else {
                params.push('q='+quality);
            }
            params.push('format='+format);

            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * DEPRECATED: This method is deprecated by {@link EVWEB2.Camera.getVideoStream}.
         *
         * Generates a URL to retrieve a video stream for the camera.  For the formats
         * {@link EVWEB2.cameraFormats.jpeg} and {@link EVWEB2.cameraFormats.transcodedJpeg}, the generated URL will
         * provide the current frame (functionally the same as {@link EVWEB2.Camera.getFrame}).  For all other formats,
         * a stream will be opened.
         * If the requested format is not available, an empty string will be returned.
         * @deprecated
         * @param {EVWEB2.cameraFormat} format The video format to be requested.
         * @param {String} [searchId] The unique search ID for the feed
         * @param {String} [streamId] The unique stream ID for the feed
         * @param {String} [downloadFileName] The file name to set for the HTTP Content-Dispositon: Attachment header.
         * Note: If this value is not set, the content disposition will not be set.
         * @param {Number} [width] The width of the image in pixels. This value is only processed for the format
         * {@link EVWEB2.cameraFormats.transcodedJpeg}
         * @param {Number} [height] The height of the image in pixels. This value is only processed for the format
         * {@link EVWEB2.cameraFormats.transcodedJpeg}
         * @param {Number} [quality] Quality between 1 and 10 with the level of quality of the image (1 lowest, 10
         * highest). This value is only processed for the format {@link EVWEB2.cameraFormats.transcodedJpeg}
         * @param {Boolean} [multipartEncoding=false] Use multi-part encoding in the response stream.  The multi-part
         * encoding will mark a boundary at each frame, providing frame-specific information:
         *     Content-Type: The content-type of the frame data
         *     DataLen: The length of the current frame
         *     Iframe: Whether the frame is an iframe.  Present only if the frame is an iframe.
         *     Frame: (Search only) The frame number in the context of the entire search
         *     TimeOffset: (Search only) The time offset, in ms, in the context of the entire search.
         *
         * @return {String} The URL to request the video frame for this camera.
         */
        this.getVideo = function (format, searchId, streamId, downloadFileName, width, height, quality,
                                  multipartEncoding) {
            if($.inArray(format, this.formats) === -1) {
                return '';
            }
            if(this.formats.length === 1 && this.formats[0] === EVWEB2.cameraFormats.transcodedJpeg) {
                // If only transcoded JPEG is available, this service doesn't provide video.web.
                return '';
            }

            if(typeof multipartEncoding === 'undefined') {
                multipartEncoding = false;
            }

            var url = this.server.service.url() + EVWEB2.urls.video;
            var params = [
                's=' + this.server.sessionId,
                'camera=' + this.id,
                'format=' + format,
                'stream=' + generateStreamId(streamId)
            ];
            if (typeof searchId !== 'undefined') {
                params.push('search_id=' + searchId);
            }
            if(format === EVWEB2.cameraFormats.transcodedJpeg) {
                params.push('w='+width);
                params.push('h='+height);
                params.push('q='+quality);
            }

            if(typeof downloadFileName !== 'undefined') {
                params.push('download='+downloadFileName);
            }

            if(multipartEncoding) {
                params.push('multipart_encode=1');
            }
            url += '?' + params.join(';') + ';';

            var date = new Date();
            url += date.getTime();
            return url;
        };

        /**
         * The getVideoStream function generates a configured stream instance for this camera. Once returned, consumers
         * call {@link EVWEB2.VideoStream#start|EVWEB2.VideoStream.start()} to begin receiving frames.
         * @param {Number} format The video format. One of the camera's supported {@link EVWEB2.cameraFormats}.
         * @param {Number} [streamId=generateStreamId()] A stream id.
         * @param {Number} [width] Transcoded image width. Ignored for native formats.
         * @param {Number} [height] Transcoded image height. Ignored for native formats.
         * @param {Number} [quality] Transcoded image quality on the interval [1,10]. Ignored for native formats.
         * @return {EVWEB2.VideoStream} A stream instance.
         */
        this.getVideoStream = function(format, streamId, width, height, quality) {
            var url = this.server.service.url();
            if (url.indexOf('http://') === 0) {
                url = url.replace('http://', 'ws://');
            } else {
                url = url.replace('https://', 'wss://');
            }

            url += EVWEB2.urls.video;
            var params = [
                's=' + this.server.sessionId,
                'camera=' + this.id,
                'format=' + format,
                'stream=' + generateStreamId(streamId)
            ];
            if (format === EVWEB2.cameraFormats.transcodedJpeg) {
                params.push('w=' + width);
                params.push('h=' + height);
                params.push('q=' + quality);
            }

            url += '?' + params.join('&');
            return new EVWEB2.VideoStream(url, format);
        };

        /**
         * The getSearchSnapshot method allows the caller to retrieve a single, previously-recorded frame from a camera.
         * Note that due to the overhead involved with retrieving a single frame from the server, this method should NOT
         * be used to perform stored video playback. If you wish to conduct playback of recorded video, do so by
         * creating a {@link EVWEB2.getSearch|search}.
         * @param {Date} time The time for which to retrieve a frame.
         * @param {EVWEB2.cameraFormats} format The desired frame format. Note that since this method retrieves a single
         * frame, you MUST request either {@link EVWEB2.cameraFormats.jpeg|native} or
         * {@link EVWEB2.cameraFormats.transcodedJpeg|transcoded JPEG}.
         * @param {Number} [width] Transcoded image width if requesting transcoded JPEG.
         * @param {Number} [height] Transcoded image height if requesting transcoded JPEG.
         * @param {Number} [quality] Transcoded image quality on the interval [1,10] if requesting transcoded JPEG.
         * @return {String} A URL that points to a frame for the camera at the given time.
         */
        this.getSearchSnapshot = function(time, format, width, height, quality) {
            var params = [
                's=' + this.server.sessionId,
                'camera=' + this.id,
                'time=' + EVWEB2.util.Date2IETF(time, true),
                'format=' + format
            ];

            if (format === EVWEB2.cameraFormats.transcodedJpeg &&
                this.server.service.jpegForwarding.enabled &&
                this.server.service.jpegForwarding.shouldForward(this, width, height, quality)) {
                format = EVWEB2.cameraFormats.jpeg;
            }
            if (format === EVWEB2.cameraFormats.transcodedJpeg) {
                if (width) {
                    params.push('w=' + width);
                }
                if (height) {
                    params.push('h=' + height);
                }
                if (quality) {
                    params.push('q=' + quality);
                }
            }
            return this.server.service.url() + EVWEB2.urls.searchSnapshot + '?' + params.join('&');
        };

        /**
         * Retrieves the PTZ presets for this camera
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.PtzPreset} instances.
         */
        this.getPtzPresets = function(callback) {
            if(!this.ptz) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'Camera does not support PTZ.');
                callback(errorResponse);
            }

            var camera = this;
            var onGetPtzPresetsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetPtzPresetsSuccess = function(data/*, textStatus, xhr*/) {
                if(data === EVWEB2.errors.ptz) {
                    //Call the error callback
                    onGetPtzPresetsError();
                }

                // v2.0 web services don't return a proper JSON object, as no callback wraps the response.  For these
                // responses, attempt to manually parse the JSON.
                if(typeof data === 'string') {
                    try {
                        data = JSON.parse(data);
                    }
                    catch(err) {
                        onGetPtzPresetsError();
                        return;
                    }
                }

                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);

                var presets = $.map(data.Presets, function(element) {
                    return new EVWEB2.PtzPreset(element.id, element.name);
                });

                callback(successResponse, camera, presets);
            };

            var settings = {
                success: onGetPtzPresetsSuccess,
                error: onGetPtzPresetsError,
                url: server.service.url() + EVWEB2.urls.ptz,
                data: {
                    s: this.server.sessionId,
                    camera: this.id
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Sets the camera to a PTZ preset
         * @param {String} presetId The ID of the preset.
         */
        this.recallPtzPreset = function(presetId) {
            if(!this.ptz) {
                throw new Error('Camera does not support PTZ.');
            }

            var params = {
                s: this.server.sessionId,
                camera: this.id,
                preset: presetId
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var service = this.server.service;

            var onVersionCallback = function(response, version) {
                // Version 2.0 did not support POST PTZ requests.  As such, only perform a
                // POST action on newer methods.
                var isGetMethod = version === '2.0.0';

                var settings = {
                    url: service.url() + EVWEB2.urls.ptz,
                    type: isGetMethod ? 'GET' : 'POST',
                    dataType: 'text',
                    data: params
                };

                EVWEB2.ajax(settings, service, true);
            };
            this.server.service.version(onVersionCallback);
        };

        /**
         * Moves the camera in a direction.
         * @param {EVWEB2.ptzDirections} direction The direction to move the camera.
         */
        this.ptzMove = function(direction) {
            if(!this.ptz) {
                throw new Error('Camera does not support PTZ.');
            }

            var params = {
                s: this.server.sessionId,
                camera: this.id,
                dir: direction
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var service = this.server.service;

            var onVersionCallback = function(response, version) {
                // Version 2.0 did not support POST PTZ requests.  As such, only perform a
                // POST action on newer methods.
                var isGetMethod = version === '2.0.0';

                var settings = {
                    url: service.url() + EVWEB2.urls.ptz,
                    type: isGetMethod ? 'GET' : 'POST',
                    dataType: 'text',
                    data: params
                };

                EVWEB2.ajax(settings, service, true);
            };
            this.server.service.version(onVersionCallback);
        };

        /**
         * Sets the PTZ speed of the camera
         * @param {Number} speed The PTZ speed for the camera (0-100).
         */
        this.setPtzSpeed = function(speed) {
            if(!this.ptz) {
                throw new Error('Camera does not support PTZ.');
            }

            ptzSpeed = speed;

            var params = {
                s: this.server.sessionId,
                camera: this.id,
                zpeed: speed,
                tspeed: speed,
                pspeed: speed
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var settings = {
                url: this.server.service.url() + EVWEB2.urls.ptz,
                type: 'POST',
                dataType: 'text',
                data: params
            };
            EVWEB2.ajax(settings, this.server.service, true);
        };

        /**
         * Gets the PTZ speed of the camera
         * @return {Number} The PTZ speed
         */
        this.getPtzSpeed = function() {
            if(!this.ptz) {
                throw new Error('Camera does not support PTZ.');
            }

            return ptzSpeed;
        };


        /**
         * Checks to see if digital PTZ of the camera can move in a direction.
         * @param {Function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, the digital PTZ ID, and a
         *  Boolean indicating whether the move can be made.
         * @param {EVWEB2.ptzDirections} direction The direction to move the camera.
         */
        this.ptzCanMove = function(callback, direction) {
            if(!this.ptz) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'Camera does not support PTZ.');
                callback(errorResponse);
            }

            if(this.ptzType === EVWEB2.ptzTypes.standard) {
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, true);
                return;
            }

            var onDigitalPtzCanMoveError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onDigitalPtzCanMoveSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Call the error callback
                    onDigitalPtzCanMoveError();
                    return;
                }

                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, data.canMove);
            };

            var settings = {
                success: onDigitalPtzCanMoveSuccess,
                error: onDigitalPtzCanMoveError,
                url: server.service.url() + EVWEB2.urls.digitalPtz,
                data: {
                    s: this.server.sessionId,
                    ptz: this.id,
                    dir: direction
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Clones a camera
         * @internal
         * @return {EVWEB2.Camera} The cloned instance
         */
        this.cloneCamera = function() {
            var ptzTypes = this.digitalPtzTypes.slice(0);
            var formats = this.formats.slice(0);
            var resolution;
            if(this.resolution !== null) {
                resolution = new EVWEB2.CameraResolution(this.resolution.width, this.resolution.height);
            }
            var clonedCamera = new EVWEB2.Camera(this.server, this.id, this.ctx, this.name, this.ptz, this.disabled,
                this.video, this.osd, this.ptzType, ptzTypes, formats, resolution, this.quality);
            clonedCamera.sourceCamera = this.sourceCamera;
            clonedCamera.digitalPtzType = this.digitalPtzType;
            return clonedCamera;
        };

        /**
         * The last used cache break time, used to avoid sending the same cache break parameter twice.  See
         * {@link generateCacheBreakParameter} for more details.
         * @internal
         * @type {Number}
         */
        var lastCacheBreakTime = 0;

        /**
         * The count of the number of times the lastCacheBreakTime has been used.  Used to avoid sending the same cache
         * break parameter twice.  See {@link generateCacheBreakParameter} for more details.
         * @internal
         * @type {Number}
         */
        var lastCacheBreakCount = 0;

        /**
         * Chrome has a tendency to cache requests, even if the cache-control headers are set to no-store, no-cache.
         * This comes into play primarily when creating multiple digital PTZ cameras from the same source camera in a
         * short interval (such as when loading a custom view).  In this situation, only one request is made, such that
         * the multiple digital PTZ cameras all share the same ID.  To get around this, we're appending a timestamp as
         * a cache breaker on create digital PTZ requests.  However, requests can be trigger more than once per ms, so
         * store the previous requests, and if an identical request is present, increment it by one.
         * @internal
         * @return {String} The cache break parameter
         */
        var generateCacheBreakParameter = function() {
            var cacheBreak = (new Date()).getTime();
            if(lastCacheBreakTime === cacheBreak) {
                lastCacheBreakCount++;
            }
            else {
                lastCacheBreakTime = cacheBreak;
                lastCacheBreakCount = 0;
            }
            return lastCacheBreakTime.toString() + lastCacheBreakCount.toString();
        };

        /**
         * Creates a digital PTZ rectangle
         * @param {Function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance, the {@link EVWEB2.Camera} instance, the generated digital PTZ ID,
         *  and a {@link EVWEB2.DigitalPtzRectangle} instance describing the current rectangle.
         * @param {EVWEB2.digitalPtzTypes} digitalPtzType The type of digital PTZ rectangle to create.
         * @param {String} [searchId] The search ID for this camera.
         * @param {EVWEB2.View} [view] A view for this camera to apply any view-specific digital PTZ.  {@link slotIndex}
         *  is required if this parameter is present.
         * @param {Number} [slotIndex] The slot index for the view.  {@link view} is required if this parameter is
         *  present.
         */
        this.createDigitalPtzCamera = function(callback, digitalPtzType, searchId, view, slotIndex) {
            if(this.digitalPtzTypes.length === 0) {
                throw new Error('Camera does not support digital PTZ.');
            }
            if($.inArray(digitalPtzType, this.digitalPtzTypes) === -1) {
                throw new Error('Camera does not support this type of digital PTZ.');
            }

            var sessionId = this.server.sessionId;
            if(searchId !== undefined) {
                sessionId = searchId;
            }

            var camera = this;
            var onCreateDigitalPtzRectangleError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onCreateDigitalPtzRectangleSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Call the error callback
                    onCreateDigitalPtzRectangleError();
                    return;
                }

                //Assign the digital PTZ ID
                var digitalPtzId = data.ptzId;

                var successResponse = new EVWEB2.ResponseStatus(true);

                //Create the digital PTZ camera
                var digitalPtzCam = camera.cloneCamera();
                digitalPtzCam.id = digitalPtzId;
                digitalPtzCam.ptz = true;
                digitalPtzCam.sourceCamera = camera;
                digitalPtzCam.digitalPtzType = digitalPtzType;
                digitalPtzCam.ptzType = EVWEB2.ptzTypes.digital;

                // Digital PTZ is only available as transcoded JPEG
                digitalPtzCam.formats = [EVWEB2.cameraFormats.transcodedJpeg];

                if(searchId !== undefined) {
                    // Create a new server with the session ID set to the source camera
                    // var s = camera.server;
                    // digitalPtzCam.server = new EVWEB2.Server(s.service, s.name, s.id, s.login, s.restricted,
                    //     sessionId, s.gmtOffset, s.osd);
                    digitalPtzCam.server = $.extend({}, camera.server, {sessionId: sessionId});
                }

                digitalPtzCam.setPtzSpeed(50);

                // Create the rectangle instance
                var rectangle = new EVWEB2.DigitalPtzRectangle(data.x, data.y, data.width, data.height);

                callback(successResponse, digitalPtzCam, rectangle);
            };

            var settings = {
                success: onCreateDigitalPtzRectangleSuccess,
                error: onCreateDigitalPtzRectangleError,
                url: server.service.url() + EVWEB2.urls.digitalPtz,
                data: {
                    s: sessionId,
                    camera: this.id,
                    type: digitalPtzType,
                    cacheBreak: generateCacheBreakParameter()
                }
            };

            if(view !== undefined && slotIndex !== undefined) {
                settings.data.view = view.name;
                settings.data.slot = slotIndex;
            }

            EVWEB2.ajax(settings, server.service);
        };


        /**
         * Retrieves the current digital PTZ rectangle
         * @param {Function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, the the {@link EVWEB2.Camera}
         *  instance, the digital PTZ ID, and a {@link EVWEB2.DigitalPtzRectangle} instance describing the current
         *  rectangle.
         */
        this.getDigitalPtzRectangle = function(callback) {
            if(this.digitalPtzTypes.length === 0) {
                throw new Error('Camera does not support digital PTZ.');
            }
            if(this.sourceCamera === this) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'This camera is not a digital PTZ camera.');
                callback(errorResponse);
                return;
            }

            var camera = this;
            var onGetDigitalPtzRectangleError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetDigitalPtzRectangleSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Call the error callback
                    onGetDigitalPtzRectangleError();
                    return;
                }

                //Return the server list
                var successResponse = new EVWEB2.ResponseStatus(true);

                var rectangle = new EVWEB2.DigitalPtzRectangle(data.x, data.y, data.width, data.height);

                callback(successResponse, camera, rectangle);
            };

            var settings = {
                success: onGetDigitalPtzRectangleSuccess,
                error: onGetDigitalPtzRectangleError,
                url: server.service.url() + EVWEB2.urls.digitalPtz,
                data: {
                    s: this.server.sessionId,
                    ptz: this.id
                }
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * Sets the current digital PTZ rectangle.
         * Due to XSS restrictions, the POST request can not deliver a response.  As such, this will internally call
         * getPtzRectangle() before returning the response in these situations which will increase latency.  If this
         * behavior is not desired, leave callback undefined and the call will not be made.
         * @param {Function} [callback] Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response, the {@link EVWEB2.Camera}
         * instance, the digital PTZ ID, and a {@link EVWEB2.DigitalPtzRectangle} instance describing the resultant
         * rectangle.
         * @param {Number} x Number x-coordinate of the rectangle
         * @param {Number} y Number y-coordinate of the rectangle
         * @param {Number} width Number width of the rectangle
         * @param {Number} height Number height of the rectangle
         */
        this.setDigitalPtzRectangle = function(callback, x, y, width, height) {
            if(this.digitalPtzTypes.length === 0) {
                throw new Error('Camera does not support digital PTZ.');
            }
            if(this.sourceCamera === this) {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'This camera is not a digital PTZ camera.');
                    callback(errorResponse);
                }
                return;
            }

            var camera = this;
            var onSetDigitalPtzRectangleError = function(/*xhr, textStatus, errorThrown*/) {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                    callback(errorResponse);
                }
            };

            var onSetDigitalPtzRectangleSuccess = function(data/*, textStatus, xhr*/) {
                if(typeof callback !== 'function') {
                    return;
                }

                if(!data.success) {
                    //Call the error callback
                    onSetDigitalPtzRectangleError();
                    return;
                }

                if(data.xssPost) {
                    if(typeof callback !== 'undefined') {
                        camera.getDigitalPtzRectangle(callback);
                    }
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var rectangle = new EVWEB2.DigitalPtzRectangle(data.x, data.y, data.width, data.height);

                callback(successResponse, camera, rectangle);
            };

            var params = {
                s: this.server.sessionId,
                ptz: this.id,
                x: x,
                y: y,
                w: width,
                h: height
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var settings = {
                url: this.server.service.url() + EVWEB2.urls.digitalPtz,
                success: onSetDigitalPtzRectangleSuccess,
                error: onSetDigitalPtzRectangleError,
                type: 'POST',
                data: params
            };
            EVWEB2.ajax(settings, this.server.service, true);
        };

        /**
         * Deletes the current digital PTZ camera.
         * @param {Function} [callback] Callback function to be executed when the call completes. Callback is
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response and the original
         * {@link EVWEB2.Camera} instance the digital PTZ camera was generated from.
         *
         */
        this.deleteDigitalPtzCamera = function(callback) {
            if(this.digitalPtzTypes.length === 0) {
                throw new Error('Camera does not support digital PTZ.');
            }

            if(this.sourceCamera === this) {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false,'This camera is not a digital PTZ camera.');
                    callback(errorResponse);
                }
                return;
            }

            var instance = this;

            var params = {
                s: this.server.sessionId,
                ptz: this.id,
                action: 'delete'
            };

            if (this.server.requiresResourceKey()) {
                if (this.server.service.resourceKey === '') {
                    throw new Error("CSRF enforced, passthrough will not work.");
                }
                params.key = this.server.service.resourceKey;
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                if(typeof callback === 'function') {
                    var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                    callback(errorResponse);
                }
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(typeof callback === 'function') {
                    if(!data.success) {
                        var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                        callback(errorResponse);
                        return;
                    }

                    var successResponse = new EVWEB2.ResponseStatus(true);
                    callback(successResponse, instance.sourceCamera);
                }
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.server.service.url() + EVWEB2.urls.digitalPtz,
                type: 'POST',
                data: params
            };
            EVWEB2.ajax(settings, this.server.service, true);
        };

        /**
         * Initializes thumbnail search and retrieves the total frame count and frame timestamps for a given
         * search duration and specified interval.
         *
         * @param {Function} callback Callback function to be executed when the call
         * completes. Callback is passed a {@link EVWEB2.ResponseStatus} instance with
         * the details of the response and an {@link EVWEB2.ThumbnailSearch} instance.
         * @param {Date} start The start time of the thumbnail search.
         * @param {Date} end The end time of the thumbnail search.
         * @param {Number} interval The interval in seconds between frames for searching.
         */
        this.getThumbnailSearch = function (callback, start, end, interval) {
            var camera = this;

            var onGetThumbnailSearchError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onGetThumbnailSearchSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false,data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                if(data.frames === "0") {
                    callback(successResponse, null);
                    return;
                }

                var framesInfoList = $.map(data.frames_timestamps, function(element, i) {
                    return new EVWEB2.ThumbnailSearchInfo(data.session_id, camera, element, i);
                });


                var thumbnailSearch = new EVWEB2.ThumbnailSearch(data.session_id, camera, data.start, data.end,
                                                    framesInfoList);
                callback(successResponse, thumbnailSearch);
            };

            var server = camera.server;
            var url = server.service.url() + EVWEB2.urls.thumbnail;

            var params = [
                's=' + server.sessionId,
                'camera=' + camera.id,
                'start=' + EVWEB2.util.Date2IETF(start),
                'end=' + EVWEB2.util.Date2IETF(end),
                'interval=' + interval
            ];

            url += '?' + params.join(';');

            var settings = {
                success: onGetThumbnailSearchSuccess,
                error: onGetThumbnailSearchError,
                url: url,
                data: {
                    output: 'json'
                }
            };

            EVWEB2.ajax(settings, server.service);
        };


        /**
         * This function sets a new name for the camera on the server.
         * @param {Function} callback Callback function to be executed when the call completes. The function gets
         * passed a {@link EVWEB2.ResponseStatus} instance with the details of the response and the updated camera
         * {EVWEB2.Camera} instance as a convenience.
         * @param {String} name The name
         */
        this.setName = function(callback, name){
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            if(typeof name === 'undefined'){
                var errorResponse = new EVWEB2.ResponseStatus(false, 'New name required');
                callback(errorResponse);
                return;
            }

            var instance = this;

            var onSetCameraNameError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSetCameraNameSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                if(!data.xssPost) {
                    // update the camera instance
                    instance.name = name;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, instance);
            };

            var params = {
                s: this.server.sessionId,
                camera: this.id,
                name: name
            };

            var settings = {
                success: onSetCameraNameSuccess,
                error: onSetCameraNameError,
                url: this.server.service.url() + EVWEB2.urls.camera,
                data: params,
                type: 'POST'
            };
            EVWEB2.ajax(settings, this.server.service, true);
        };

        /**
         * Generates a URL for retrieving a thumbnail image of the camera's feed. This thumbnail
         * does not represent a live snapshot, but merely a representative value of the camera's feed.
         *
         * @param {EVWEB2.cameraThumbnailSizes} [size=EVWEB2.cameraThumbnailSizes.size80x80] The size
         * of the thumbnail to request.
         * @return {String} The URL to request the desired thumbnail image frame for this camera
         */
        this.getThumbnailUrl = function(size) {
            if (size === undefined){
                size = EVWEB2.cameraThumbnailSizes.size80x80;
            }

            var camera = this;
            var baseUrl = camera.server.service.url() + EVWEB2.urls.cachedThumbnail;
            var data = {
                s: camera.server.sessionId,
                camera: camera.id,
                size: size
            };

            var key, query_string = '';
            for (key in data) {
                if (data.hasOwnProperty(key)){
                    query_string += (query_string === ''? '' : '&') + key + '=' + data[key];
                }
            }

            return baseUrl + '?' + query_string;
        };


        /**
         * Retrieves the association info for this camera
         * @param {Function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an {@link EVWEB2.Association}
         *  object detailing all of the assocation items associated with the camera or null, if no association is
         *  present.
         */
        this.getAssociations = function(callback) {
            var camera = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                if(data.association === null) {
                    // Call back immediately as there is no association to return.
                    callback(successResponse, null);
                    return;
                }
                var raw = data.association;

                // Process the associations
                var associationItems = $.map(raw.items, function(element) {
                    return new EVWEB2.AssociationItem(element.id, element.type, element.position, element.statusOnly,
                        element.extra);
                });

                var fontInfo = new EVWEB2.FontInfo(raw.fontName, raw.fontSize, raw.fontStyle,
                    raw.fontColor, raw.fontFamily, raw.fontWeight);

                var association = new EVWEB2.Association(camera.server, camera, raw.guid, associationItems,
                    raw.label, raw.overlayStyle, raw.position, raw.backgroundColor,
                    raw.opacity, fontInfo);

                callback(successResponse, association);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: camera.server.service.url() + EVWEB2.urls.associationsCamera,
                data: {
                    s: camera.server.sessionId,
                    camera: camera.parentId
                }
            };

            if(camera.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };
    };

    /**
     *	The getCameras function is meant to act as a handler and parser for list retrieval from the exacqVision
     *	web service back-end.  It uses asynchronous javascript requests to the server for information on
     *	the available camera feeds available from the requested server.  The information received from this call
     *	is then parsed and properly formatted into {@link EVWEB2.Camera} objects that then provide the proper
     *	methods for viewing the camera feeds.
     *  @param {Function} callback Callback function to be executed when the call completes. The function gets passed
     *  three arguments: {@link EVWEB2.ResponseStatus} instance with the details of the response, an array of
     *  {@link EVWEB2.Camera} instances, and a modified instance of {@link EVWEB2.Server}. (Note: The instance passed
     *  into the call is modified as well.)
     *	@param {EVWEB2.Server} server Server object to retrieve cameras from
     *  @deprecated This method is superceded by {@link EVWEB2.Server.getCameras}.
     *  @category Camera
     */
    EVWEB2.getCameras = function (callback, server) {
        server.getCameras(callback);
    };
}());

/*globals EVWEB2:true*/
(function() {

    /**
     * @class
     * The SystemHardwareInfo object represents the basic hardware information of the system.
     * @param {String} [serialNumber=''] The serial number of the system.
     * @param {String} [modelNumber=''] The model number of the system.
     * @param {String} [motherboard=''] The system motherboard information.
     * @param {String} [bios=''] The system BIOS information.
     * @param {String} [processor=''] The processor information.
     * @param {String} [totalMemory=''] The total memory of the system in bytes.
     * @param {String} [os=''] The system OS information.
     * @param {Date} [runningSince=null] The timestamp since the system has been running.
     * @constructor
     * @category Server
     */
    EVWEB2.SystemHardwareInfo = function(serialNumber, modelNumber, motherboard, bios, processor, totalMemory,
                                                os, runningSince) {
        /**
         * The serial number of the system.
         * @type String
         */
        this.serialNumber = '';

        /**
         * The model number of the system.
         * @type String
         */
        this.modelNumber = '';

        /**
         * The system motherboard information.
         * @type String
         */
        this.motherboard = '';

        /**
         * The system BIOS information.
         * @type String
         */
        this.bios = '';

        /**
         * The processor information.
         * @type String
         */
        this.processor = '';

        /**
         * The total memory of the system in bytes.
         * @type String
         */
        this.totalMemory = '';

        /**
         * The system OS information.
         * @type String
         */
        this.os = '';

        /**
         * The timestamp since the system has been running.
         * @type Date
         */
        this.runningSince = null;

        //Assign the constructor values
        if(typeof serialNumber !== 'undefined') {
            this.serialNumber = serialNumber;
        }
        if(typeof modelNumber !== 'undefined') {
            this.modelNumber = modelNumber;
        }
        if(typeof motherboard !== 'undefined') {
            this.motherboard = motherboard;
        }
        if(typeof bios !== 'undefined') {
            this.bios = bios;
        }
        if(typeof processor !== 'undefined') {
            this.processor = processor;
        }
        if(typeof totalMemory !== 'undefined') {
            this.totalMemory = totalMemory;
        }
        if(typeof os !== 'undefined') {
            this.os = os;
        }
        if(typeof runningSince !== 'undefined') {
            this.runningSince = runningSince;
        }
    };

    /**
     * The SystemConfig object acts as a container for system configuration information.
     * @param {EVWEB2.Server} [server=null] The associated server.
     * @param {String} [systemName=''] The name of the system.
     * @param {EVWEB2.SystemHardwareInfo} [hardwareInfo=null] The hardware information of the system.
     * @param {Boolean} [isUtf8=false] Whether the system has utf-8 support enabled or not.
     * @constructor
     * @class
     * @category Server
     */
    EVWEB2.SystemConfig = function(server, systemName, hardwareInfo, isUtf8) {
        /**
         * The associated server.
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * The system name.
         * @type String
         */
        this.systemName = '';

        /**
         * The system hardware information.
         * @type EVWEB2.SystemHardwareInfo
         */
        this.hardwareInfo = null;

        /**
         * Whether the system has utf-8 support enabled or not.
         * @type Boolean
         */
        this.isUtf8 = false;

        // Assign the constructor values
        if(typeof server !== 'undefined') {
            this.server = server;
        }
        if(typeof systemName !== 'undefined') {
            this.systemName = systemName;
        }
        if(typeof hardwareInfo !== 'undefined') {
            this.hardwareInfo = hardwareInfo;
        }
        if(typeof isUtf8 !== 'undefined') {
            this.isUtf8 = isUtf8;
        }

        /**
         * Set the new system name.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response and the new system name.
         * @param {String} systemName The new system name to set.
         */
        this.setSystemName = function(callback, systemName) {
            var server = this.server;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                server.name = systemName;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, systemName);
            };

            var params = {
                s: server.sessionId,
                systemName: systemName
            };

            var settings = {
                url: server.service.url() + EVWEB2.urls.systemInfo,
                success: onSuccess,
                error: onError,
                type: 'POST',
                data: params
            };
            EVWEB2.ajax(settings, server.service, true);
        };

        /**
         * This method allows to enable UTF-8 support on the system. Note: Once UTF-8 support is enabled on a system,
         * it cannot be reversed.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.enableSystemUtf8 = function(callback) {
            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };
            if(this.isUtf8) {
                // UTF-8 is already enabled
                var errorResponse = new EVWEB2.ResponseStatus(false, 'UTF-8 is already enabled on this system.');
                callback(errorResponse);
                return;
            }

            var params = {
                s: this.server.sessionId,
                utf8Enabled: true
            };

            var settings = {
                url: this.server.service.url() + EVWEB2.urls.systemInfo,
                success: onSuccess,
                error: onError,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, this.server.service, true);
        };
    };

}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for capabilities for VideoPush clients.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.VideoPushCapabilities = {
        /**
         * Live Video
         */
        liveVideo : 0,
        /**
         * Live Audio
         */
        liveAudio: 1,
        /**
         * Live Serial
         */
        liveSerial: 2,
        /**
         * Live Digital PTZ
         */
        liveDigitalPtz: 3,
        /**
         * Live Tours
         */
        liveTours: 4,
        /**
         * Live Custom Layouts
         */
        liveCustomLayouts: 5,
        /**
         * Live Full Screen
         */
        liveFullScreen: 6,
        /**
         * Live Maps
         */
        liveMaps: 7
    };

    /**
     * Definitions for the types of VideoPush applications
     * @enum {Number}
     * @readonly
     * @category Server
     */
    EVWEB2.VideoPushApplications = {
        /**
         * Web
         */
        web: 0,
        /**
         * Mobile
         */
        mobile: 1
    };

    /**
     * Definitions for the types of VideoPush display settings
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.VideoPushDisplaySettings = {
        /**
         * Full screen
         */
        fullScreen: 0,
        /**
         * Hide toolbar
         */
        hideToolbar: 1,
        /**
         * Hide navigation bar
         */
        hideNavbar: 2
    };

    /**
     * Definitions for the types of VideoPush messages
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.VideoPushMessageTypes = {
        /**
         * Invalid
         */
        invalid: -1,
        /**
         * Display Settings
         */
        displaySettings: 0,
        /**
         * Live Views
         */
        liveViews: 1,
        /**
         * Live Tours
         */
        liveTours: 2
    };

    /**
     * Definitions for the statuses for VideoPush messages.
     * @enum {string}
     * @readonly
     * @category Server
     */
    EVWEB2.VideoPushStatuses = {
        /**
         * Not sent
         */
        notSent: '',
        /**
         * Pending
         */
        pending: 'Pending',
        /**
         * Sent
         */
        sent: 'Sent'
    };

    /**
     * The VideoPushTarget object acts as a container for all information about a VideoPush target.
     * @param {String} [id=''] The ID of this VideoPush target.
     * @param {String} [name=''] The display name of this VideoPush target.
     * @param {EVWEB2.Server[]} [servers=[]] The server instances associated with this target.
     * @param {EVWEB2.VideoPushCapabilities[]} [capabilities=[]] The capabilities associated with this target.  The
     * target will only respond to VideoPush messages falling into these capabilities.
     * @param {Number} [maxPanels=0] The maximum number of video panels this target supports.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.VideoPushTarget = function(id, name, servers, capabilities, maxPanels) {

        /**
         * The ID of this VideoPush target.
         * @type {string}
         */
        this.id = '';

        /**
         * The display name of this VideoPush target.
         * @type {string}
         */
        this.name = '';

        /**
         * The server instances associated with this target.
         * @type {EVWEB2.Server[]}
         */
        this.servers = [];

        /**
         * The capabilities associated with this target.  The target will only respond to VideoPush messages falling
         * into these capabilities.
         * @type {EVWEB2.VideoPushCapabilities[]}
         */
        this.capabilities = [];

        /**
         * The maximum number of video panels this target supports.
         * @type {Number}
         */
        this.maxPanels = 0;

        if(typeof id !== 'undefined') {
            this.id = id;
        }
        if(typeof name !== 'undefined') {
            this.name = name;
        }
        if(typeof servers !== 'undefined') {
            this.servers = servers;
        }
        if(typeof capabilities !== 'undefined') {
            this.capabilities = capabilities;
        }
        if(typeof maxPanels !== 'undefined') {
            this.maxPanels = maxPanels;
        }
    };

    /**
     * The VideoPushMessageStatus object acts as a container for status information about a
     * {@link EVWEB2.VideoPushMessage} instance.
     * @param {EVWEB2.VideoPushStatuses} [status=EVWEB2.VideoPushStatuses.notSent] The current status of the message.
     * @param {EVWEB2.Server[]} [appliedServers=[]] The servers that the message has been applied to.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.VideoPushMessageStatus = function(status, appliedServers) {

        /**
         * The ID of this VideoPush target.
         * @type {EVWEB2.VideoPushStatuses}
         */
        this.status = EVWEB2.VideoPushStatuses.notSent;

        /**
         * The servers that this message has been applied to.
         * @type {EVWEB2.Server[]}
         */
        this.appliedServers = [];

        if(typeof status !== 'undefined') {
            this.status = status;
        }
        if(typeof appliedServers !== 'undefined') {
            this.appliedServers = appliedServers;
        }
    };


    /**
     * The VideoPushMessage object acts as a container for all information about a VideoPush message.  This
     * object exposes the the ability to poll for the status of the sent message to this target.
     * @param {EVWEB2.VideoPushTarget} [target=null] The VideoPush target instance.
     * @param {String} [sender=''] The name of the client that sent the message.
     * @param {EVWEB2.VideoPushDisplaySettings[]|EVWEB2.View|EVWEB2.Tour} [content=''] The content of the message.  This can
     * be any one of the three specified types.
     * @param {EVWEB2.TourFolder[]} [tourContentFolders] The tour folders associated with the specified
     * {@link EVWEB2.Tour}. Note: This parameter is only necessary when sending a tour.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.VideoPushMessage = function(target, sender, content, tourContentFolders) {

        /**
         * The type of VideoPush message.
         * @type {EVWEB2.VideoPushMessageTypes}
         */
        this.type = EVWEB2.VideoPushMessageTypes.invalid;

        /**
         * The VideoPush target instance.
         * @type {EVWEB2.VideoPushTarget}
         */
        this.target = null;

        /**
         * The name of the client that sent the message.
         * @type {String}
         */
        this.sender = '';

        /**
         * The content of the message.  This can be any one of the three specified types.
         * @type {EVWEB2.VideoPushDisplaySettings[]|EVWEB2.View|EVWEB2.Tour}
         */
        this.content = '';

        /**
         * The message ID associated with this message.  This value is generated and applied by
         * {@link EVWEB2.VideoPush.sendMessage()} and is used to check the status of a message in
         * {@link EVWEB2.VideoPushMessage.getStatus}.
         * @type {String}
         */
        this.messageId = '';


        /**
         * The servers associated with this message.  This value is generated and applied by
         * {@link EVWEB2.VideoPush.sendMessage()} and is used to check the status of a message in
         * {@link EVWEB2.VideoPushMessage.getStatus}.
         * @type {EVWEB2.Server[]}
         */
        this.servers = [];

        /**
         * The list of {EVWEB2.TourFolder} instances associated with the tour content specified for this message.
         * @type {EVWEB2.TourFolder[]}
         */
        this.tourFolders = [];

        if(typeof target !== 'undefined') {
            this.target = target;
        }
        if(typeof sender !== 'undefined') {
            this.sender = sender;
        }
        if(typeof content !== 'undefined') {
            this.content = content;
            if(content instanceof EVWEB2.View) {
                this.type = EVWEB2.VideoPushMessageTypes.liveViews;
            }
            else if(content instanceof EVWEB2.Tour) {
                this.type = EVWEB2.VideoPushMessageTypes.liveTours;
            }
            else if(content instanceof Array) {
                this.type = EVWEB2.VideoPushMessageTypes.displaySettings;
            }
        }
        if(typeof tourContentFolders !== 'undefined') {
            this.tourFolders = tourContentFolders;
        }

        /**
         * Determinmes the {@link EVWEB2.ViewSlotItemTypes} for a given {@link EVWEB2.ViewSlotItem} instance.
         * @param {EVWEB2.ViewSlotItem} viewSlotItem The view slot item to process
         * @returns {EVWEB2.ViewSlotItemTypes} The view slot item type.
         * @internal
         * @private
         */
        var getViewSlotItemType = function(viewSlotItem) {
            var type = EVWEB2.ViewSlotItemTypes.none;
            if(viewSlotItem.type === EVWEB2.Camera) {
                type = EVWEB2.ViewSlotItemTypes.camera;
            }
            else if(viewSlotItem.type === EVWEB2.Map) {
                type = EVWEB2.ViewSlotItemTypes.group;
            }
            else if(viewSlotItem.type === EVWEB2.AudioDevice) {
                type = EVWEB2.ViewSlotItemTypes.audio;
            }
            return type;
        };

        /**
         * Gets the tour folder instance from tourFolders matching the provided ID.
         * @param {String} id The tour folder ID to find.
         * @param {EVWEB2.TourFolder[]} tourFolders The list of tour folders to search.
         * @returns {EVWEB2.TourFolder} The tour folder with the specified ID.
         * @internal
         * @private
         */
        var getTourFolderById = function(id, tourFolders) {
            return $.grep(tourFolders, function(element) {
                return element.id === id;
            })[0];
        };

        /**
         * Generates the JSON-encoded string of the message content for use in sending the message.
         * @internal
         * @returns {String} The JSON-encoded string of the message content for the server.
         */
        this.generateContent = function() {
            var submissionContent = '';

            var instance = this;
            if(this.type === EVWEB2.VideoPushMessageTypes.displaySettings) {
                submissionContent = instance.content;
            }
            else if(this.type === EVWEB2.VideoPushMessageTypes.liveViews) {
                submissionContent = {
                    layout: instance.content.layout,
                    items: $.map(instance.content.items, function(element) {
                        return {
                            slot: element.slotIndex,
                            id: element.id,
                            server: element.server,
                            type: getViewSlotItemType(element)
                        };
                    })
                };
            }
            else if(this.type === EVWEB2.VideoPushMessageTypes.liveTours) {
                var folders = [];

                var tourFolder;


                if(this.content.folder !== null) {
                    tourFolder = getTourFolderById(instance.content.folder.id, instance.tourFolders);
                }

                if(tourFolder !== undefined) {
                    folders.push(tourFolder.name);
                }
                while(tourFolder !== undefined && tourFolder.id !== tourFolder.parentId) {
                    tourFolder = getTourFolderById(tourFolder.parentId, instance.tourFolders);
                    folders.unshift(tourFolder.name);
                }

                submissionContent = {
                    name: instance.content.name,
                    folders: folders
                };
            }
            return JSON.stringify(submissionContent);
        };

        /**
         * Queries the status of the message.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance with the details of the response and a
         * {@link EVWEB2.VideoPushMessageStatus} instance describing the status of the message.
         */
        this.getStatus = function(callback) {
            var message = this;
            var onGetStatusError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetStatusSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }


                var appliedServers = $.map(data.applied, function(element) {
                    return $.grep(message.target.servers, function(el) {
                        return el.id.toString() === element.toString();
                    })[0];
                });

                var status = new EVWEB2.VideoPushMessageStatus(data.status, appliedServers);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, status);
            };

            var service = this.target.servers[0].service;
            var serverIds = $.map(this.target.servers, function(element) {
                return element.sessionId;
            });
            var settings = {
                success: onGetStatusSuccess,
                error: onGetStatusError,
                url: service.url() + EVWEB2.urls.videopushMessage + '/' + this.messageId,
                traditional: true,
                data: {
                    s: serverIds
                }
            };

            EVWEB2.ajax(settings, service);
        };
    };


    /**
     * The VideoPush object acts as a container for all video push actions
     * performed on the server.  It exposes methods for both sending and receiving
     * VideoPush events.
     * @param {String} [clientGuid=''] The GUID of this VideoPush target.  When initially creating a VideoPush
     * client, this value will be generated and should be stored and re-used for the lifetime of the
     * client.  For example, a web client user should generate this GUID once, store it in Local Storage and,
     * on each reload, should provide this value to the constructor.
     * @class
     * @category Server
     */
    EVWEB2.VideoPush = function(clientGuid) {

        /**
         * The GUID of this VideoPush target.  This value is initially created by a call to
         * {@link EVWEB2.VideoPush.updateClient}.  All uses afterward should have this value
         * applied as part of the constructor.
         * @private
         * @internal
         * @type {string}
         */
        var guid = '';

        if(typeof clientGuid !== 'undefined') {
            guid = clientGuid;
        }

        /**
         * The display name of the VideoPush client to be shown to other VideoPush clients.  When no capabilities are
         * present, this value is not used and can be an empty string.  This value is set by
         * {@link EVWEB2.VideoPush.updateClient}.
         * @type {String}
         * @private
         * @internal
         */
        var clientName = '';

        /**
         * The server instances associated with this client. This value is set by {@link EVWEB2.VideoPush.updateClient}.
         * @type {EVWEB2.Server[]}
         * @private
         * @internal
         */
        var clientServers = [];


        /**
         * The capabilities of the VideoPush client.  This value is set by {@link EVWEB2.VideoPush.updateClient}.
         * @type {EVWEB2.VideoPushCapabilities[]}
         * @private
         * @internal
         */
        var clientCapabilities = [];

        /**
         * The maximum number of video panels available to this client.  This value is set by
         * {@link EVWEB2.VideoPush.updateClient}.
         * @type {Number}
         * @private
         * @internal
         */
        var clientMaxPanels = 0;

        /**
         * The type of VideoPush application this client is.  This value is set by
         * {@link EVWEB2.VideoPush.updateClient}.
         * @type {EVWEB2.VideoPushApplications}
         * @private
         * @internal
         */
        var clientApplicationType = EVWEB2.VideoPushApplications.web;


        /**
         * Retrieves a list of all of the available VideoPush targets on the provided servers.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         * {@link EVWEB2.VideoPushTarget} instances.
         * @param {EVWEB2.Server[]} servers An array of {@link EVWEB2.Server} instances to query the video push targets.
         * from which to get targets.
         */
        this.getTargets = function(callback, servers) {
            var onGetTargetsError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetTargetsSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var targets = $.map(data.targets, function(targetData) {
                    var sessionIds = $.map(targetData.sessionIds, function(element) {
                        return element.toString();
                    });

                    var targetServers = $.grep(servers, function(el) {
                        return $.inArray(el.id, sessionIds) !== -1;
                    });
                    return new EVWEB2.VideoPushTarget(targetData.id, targetData.name, targetServers,
                        targetData.capabilities, targetData.maxPanels);
                });
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, targets);
            };

            var service = servers[0].service;
            var serverIds = $.map(servers, function(element) {
                return element.sessionId;
            });
            var settings = {
                success: onGetTargetsSuccess,
                error: onGetTargetsError,
                url: service.url() + EVWEB2.urls.videopush,
                traditional: true,
                data: {
                    s: serverIds
                }
            };

            EVWEB2.ajax(settings, service);
        };


        /**
         * Update a client's VideoPush status, including the initial creation of a VideoPush target.  This
         * method is used to register a client with the server as being a sender and/or receiver of VideoPush
         * events.
         *
         * At the base level, a sender of VideoPush events is a client with no capabilities.  To receive events,
         * capabilities must be defined, each listing the types of content the client can receive.
         *
         * When initially creating a VideoPush target, a client GUID will be generated and returned in the callback.
         * This GUID should be stored externally and used in the constructor for all future instances of this client,
         * preserving the unique client connection.
         *
         * Note: When registering a client for receiving (i.e. setting any capabilities), it is important to unregister
         * those capabilities when finished listening.  This is done automatically after a set timeout period, but it is
         * highly recommended that a call to updateClient is made when finished listening to remove all capabilities.
         *
         * Note: Due to how the EV Server manages VideoPush connections, the same GUID cannot be used with multiple
         * separate logins on the same server.  In this situation, it is recommended that the original GUID is updated to
         * no capabilities and a new GUID is generated for the new login.  For example: A user has a client GUID is
         * generated for a user using the passthrough connection on the server. Later, that user receives personal
         * credentials to that same server and logs in.  In this situation, the original GUID must be set to no
         * capabilities and a new GUID must be generated.
         *
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a string of the client's GUID.
         * @param {EVWEB2.Server[]} servers The server instances associated with this client.  In general, this value
         * should be all of the connected servers.
         * @param {String} name The display name of the VideoPush client to be shown to other VideoPush clients.  When
         * no capabilities are present, this value is not used and can be an empty string.
         * @param {EVWEB2.VideoPushCapabilities[]} capabilities The capabilities this VideoPush client supports.  When
         * no capabilities are present, this client is considered "send only" and will not be displayed to receive
         * any events.
         * @param {Number} maxPanels The maximum number of video panels available to this client.
         * @param {EVWEB2.VideoPushApplications} [applicationType=EVWEB2.VideoPushApplications.web] The type of
         * VideoPush application this client is.
         */
        this.updateClient = function(callback, servers, name, capabilities, maxPanels, applicationType) {
            if(typeof applicationType === 'undefined') {
                applicationType = EVWEB2.VideoPushApplications.web;
            }

            var onUpdateClientError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onUpdateClientSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Update the internal information
                guid = data.target.guid;
                clientServers = servers;
                clientName = name;
                clientCapabilities = capabilities;
                clientMaxPanels = maxPanels;
                clientApplicationType = applicationType;

                var successResponse = new EVWEB2.ResponseStatus(true);
                //Return the server list
                callback(successResponse, guid);
            };

            var service = servers[0].service;
            var serverIds = $.map(servers, function(element) {
                return element.sessionId;
            });

            var settings = {
                success: onUpdateClientSuccess,
                error: onUpdateClientError,
                url: service.url() + EVWEB2.urls.videopush,
                type: 'POST',
                traditional: true,
                data: {
                    s: serverIds,
                    name: name,
                    maxPanels: maxPanels,
                    capabilities: capabilities
                }
            };

            if(applicationType === EVWEB2.VideoPushApplications.mobile) {
                settings.data.mobile = 1;
            }

            if(guid !== '') {
                settings.data.guid = guid;
            }

            EVWEB2.ajax(settings, service);
        };

        /**
         * Sends a VideoPush message to the specified target.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance with the details of the response and a {@link EVWEB2.VideoPushMessage}
         * instance describing the sent message.
         * @param {EVWEB2.VideoPushMessage} message The VideoPush message to send.
         */
        this.sendMessage = function(callback, message) {
            var onSendMessageError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSendMessageSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                // Update the message info
                message.messageId = data.messageId;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, message);
            };

            if(guid === '') {
                var guidError = new EVWEB2.ResponseStatus(false, 'GUID not specified for client.');
                callback(guidError);
            }

            if (message.target.servers.length === 0) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'No servers match the push target.');
                callback(errorResponse);
            }

            var service = message.target.servers[0].service;
            var serverIds = $.map(message.target.servers, function(element) {
                return element.sessionId;
            });

            var settings = {
                success: onSendMessageSuccess,
                error: onSendMessageError,
                url: service.url() + EVWEB2.urls.videopush + '/' + guid,
                type: 'POST',
                traditional: true,
                data: {
                    s: serverIds,
                    targetId: message.target.id,
                    type: message.type,
                    content: message.generateContent()
                }
            };

            EVWEB2.ajax(settings, service);
        };

        /**
         * Checks for incoming messages for this client.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         * {@link EVWEB2.VideoPushMessage} instances describing the received messages.
         * Note: The {@link EVWEB2.View} and {@link EVWEB2.Tour} instances returned are not the same instances provided
         * by {@link EVWEB2.Service.getViews} and {@link EVWEB2.Service.getTours} and are not necessarily complete.
         * They only provide the minimum information to apply the message content.
         * @param {EVWEB2.Server[]} servers The server instances to check for messages.  Messages spanning servers will
         * be merged into one message.
         */
        this.checkMessages = function(callback, servers) {
            var onCheckMessagesError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onCheckMessagesSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var target = new EVWEB2.VideoPushTarget('', clientName, clientServers, clientCapabilities,
                    clientMaxPanels);

                var messages = $.map(data.events, function(element) {
                    var content;
                    var itemContent = element.content;
                    var tourFolders;

                    if(element.type === EVWEB2.VideoPushMessageTypes.displaySettings) {
                        content = itemContent;
                    }
                    else if(element.type === EVWEB2.VideoPushMessageTypes.liveViews) {
                        var items = $.map(itemContent.items, function(item) {
                            var server = $.grep(servers, function(el) {
                                return el.id.toString() === item.server.toString();
                            })[0];
                            var type = null;
                            if(item.type === EVWEB2.ViewSlotItemTypes.camera) {
                                type = EVWEB2.Camera;
                            }
                            else if(item.type === EVWEB2.ViewSlotItemTypes.group) {
                                type = EVWEB2.Map;
                            }
                            else if(item.type === EVWEB2.ViewSlotItemTypes.audio) {
                                type = EVWEB2.AudioDevice;
                            }
                            return new EVWEB2.ViewSlotItem(item.id, server, type, item.slot, item.digitalPtzType);
                        });

                        var layoutSlots = $.map(itemContent.layout_info.slots, function(slot) {
                            return new EVWEB2.LayoutSlot(slot.y, slot.x, slot.width, slot.height);
                        });

                        var layoutInfo = new EVWEB2.Layout(undefined, itemContent.layout_info.width,
                            itemContent.layout_info.height, itemContent.layout_info.length, layoutSlots);

                        // The folder for incoming views is always treated as the root folder.
                        var folder = new EVWEB2.ViewFolder('0', '', '0');

                        content = new EVWEB2.View(itemContent.name, folder, items, itemContent.layout, layoutInfo);
                    }
                    else if(element.type === EVWEB2.VideoPushMessageTypes.liveTours) {
                        tourFolders = $.map(itemContent.folders, function(folder, index) {
                            var parentIndex = index - 1;
                            if(parentIndex < 0) {
                                parentIndex = 0;
                            }
                            return new EVWEB2.TourFolder(index.toString(), folder, parentIndex.toString());
                        });
                        var tourFolder;
                        if(tourFolders.length > 0) {
                            tourFolder = tourFolders[tourFolders.length - 1];
                        }
                        var views = $.map(itemContent.views, function(view) {
                            return new EVWEB2.TourItem(view.index, view.dwell, view.view);
                        });

                        content = new EVWEB2.Tour(itemContent.name, tourFolder, views, itemContent.description);
                    }

                    var message = new EVWEB2.VideoPushMessage(target, element.sender, content, tourFolders);
                    message.type = element.type;
                    return message;
                });


                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, messages);
            };

            if(guid === '') {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'GUID not specified for client.');
                callback(errorResponse);
            }

            var service = servers[0].service;
            var serverIds = $.map(servers, function(element) {
                return element.sessionId;
            });

            var settings = {
                success: onCheckMessagesSuccess,
                error: onCheckMessagesError,
                url: service.url() + EVWEB2.urls.videopush + '/' + guid,
                type: 'GET',
                traditional: true,
                data: {
                    s: serverIds
                }
            };

            EVWEB2.ajax(settings, service);
        };
    };

}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The ServerConfig object acts as a container for configuration information for all devices on the specified server.
     * @param {EVWEB2.Server} [server=null] The associated server.
     * @class
     * @category Server
     */
    EVWEB2.ServerConfig = function(server) {
        /**
         * The associated server.
         * @type EVWEB2.Server
         */
        this.server = null;

        // Assign the constructor values
        if(server !== undefined) {
            this.server = server;
        }

        /**
         * Retrieve configuration information of all devices on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.DeviceConfig} objects.
         */
        this.getDevicesConfiguration = function(callback) {
            var serverInstance = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetDevicesConfigError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetDevicesConfigSuccess = function(data/*, textStatus, xhr*/) {
                var devices = data.devices;

                var devicesList = $.map(devices, function(element) {
                    var cameraInfo = $.map(element.cameras, function(element) {
                        return new EVWEB2.DeviceConfigCameraInfo(element.cameraId.toString(),
                            element.parentCameraId.toString(), element.name, element.isPrimary);
                    });

                    return new EVWEB2.DeviceConfig(element.id, element.name, element.host, element.port, element.type,
                        element.model, element.macAddress, element.firmware, element.enabled, element.isConnected,
                        cameraInfo, element.user, serverInstance, element.serial, element.videoStandard);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, devicesList, serverInstance);
            };

            var settings = {
                success: onGetDevicesConfigSuccess,
                error: onGetDevicesConfigError,
                url: serverInstance.service.url() + EVWEB2.urls.devices,
                data: {
                    s: serverInstance.sessionId
                }
            };

            EVWEB2.ajax(settings, serverInstance.service);
        };

        /**
         * Retrieve the list of supported device types on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.DeviceTypeInfo} objects.
         */
        this.getDeviceTypes = function(callback) {
            var serverInstance = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onGetDeviceTypesError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetDeviceTypesSuccess = function(data/*, textStatus, xhr*/) {
                var deviceTypes = data.deviceTypes;

                var deviceTypesList = $.map(deviceTypes, function(element) {
                    return new EVWEB2.DeviceTypeInfo(element.name, element.defaultUser, element.defaultPassword,
                        element.defaultPort);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, deviceTypesList);
            };

            var settings = {
                success: onGetDeviceTypesSuccess,
                error: onGetDeviceTypesError,
                url: serverInstance.service.url() + EVWEB2.urls.deviceTypes,
                data: {
                    s: serverInstance.sessionId
                }
            };

            EVWEB2.ajax(settings, serverInstance.service);
        };

        /* The addDevice is a method that adds a device to the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response.
         * @param {EVWEB2.DeviceConfig} deviceConfiguration The new device configuration to apply.
         * @param {String} [password] The password for connections to the device.
         */
        this.addDevice = function(callback, deviceConfiguration, password) {
            var serverInstance = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: serverInstance.sessionId,
                host: deviceConfiguration.hostName,
                port: deviceConfiguration.port,
                user: deviceConfiguration.username,
                enabled: deviceConfiguration.enabled,
                deviceType: deviceConfiguration.type
            };

            if(password !== undefined) {
                params.password = password;
            }

            var settings = {
                url: serverInstance.service.url() + EVWEB2.urls.devices,
                success: onSuccess,
                error: onError,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, serverInstance.service, true);
        };

        /**
         * The getArchiveTargets method lists the archive targets configured on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed an
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.ArchiveTarget} objects.
         */
        this.getArchiveTargets = function(callback) {
            if (typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var server = this.server;

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    callback(new EVWEB2.ResponseStatus(false, data.errorText));
                    return;
                }

                var archiveTargets = [];
                data.archiveTargets.forEach(function(target) {
                    var upload = new EVWEB2.ArchiveUploadConfig(target.upload.address, target.upload.hasBookmarks,
                        target.upload.percentToUse, target.upload.username, target.upload.password,
                        target.upload.mountPoint, target.upload.desiredContentAge, target.upload.expirationType,
                        target.upload.expirationDuration);
                    var search = new EVWEB2.ArchiveSearchConfig(target.search.enabled, target.search.address,
                        target.search.username, target.search.password);
                    var archiveTarget = new EVWEB2.ArchiveTarget(server, target.id, target.enabled, target.type, upload,
                        search);
                    archiveTargets.push(archiveTarget);
                });
                callback(new EVWEB2.ResponseStatus(true), archiveTargets);
            };

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                callback(new EVWEB2.ResponseStatus(false, 'An error occurred.'));
            };

            var settings = {
                url: server.service.url() + EVWEB2.urls.archiveTargets,
                type: 'GET',
                data: {
                    s: server.sessionId
                },
                success: onSuccess,
                error: onError
            };
            EVWEB2.ajax(settings, server.service, true);
        };
    };

}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Available video standards a device could possibly be reported as.
     * @enum {number}
     * @readonly
     * @category Device
     */
    EVWEB2.videoStandards = {
        /**
         * None
         */
        none: 0,
        /**
         * NTSC
         */
        ntsc: 1,
        /**
         * PAL
         */
        pal: 2,
        /**
         * Unknown
         */
        unknown: 3
    };

    /**
     * The DeviceConfigCameraInfo object acts as a container for camera information of a device.
     * @param {String} [id=''] The ID of the camera
     * @param {String} [parentId=''] The ID of the parent camera.  This will be equal to
     * {@link EVWEB2.DeviceConfigCameraInfo.id} if the camera is the primary camera.
     * @param {String} [name=''] The display name of the camera.
     * @param {Boolean} [isPrimary=false] Whether the camera is the primary camera.
     * @class
     * @constructor
     * @category Device
     */
    EVWEB2.DeviceConfigCameraInfo = function(id, parentId, name, isPrimary) {
        /**
         * The ID of the camera.
         * @type String
         */
        this.id = '';

        /**
         * The ID of the parent camera.  This will be equal to  {@link EVWEB2.DeviceConfigCameraInfo.id} if the camera
         * is the primary camera.
         * @type String
         */
        this.parentId = '';

        /**
         * The display name of the camera.
         * @type String
         */
        this.name = '';

        /**
         * Whether the camera is the primary camera.
         * @type Boolean
         */
        this.isPrimary = false;

        //Assign the constructor values
        if(id !== undefined) {
            this.id = id;
        }
        if(parentId !== undefined) {
            this.parentId = parentId;
        }
        if(name !== undefined) {
            this.name = name;
        }
        if(isPrimary !== undefined) {
            this.isPrimary = isPrimary;
        }
    };

    /**
     * The DeviceTypeInfo object acts as a container for configuration information related to supported device types.
     * @param {String} [name=''] The name of the device type.
     * @param {String} [username=''] The default username for connections to the device.
     * @param {String} [password=''] The default password for connections to the device.
     * @param {Number} [port=0] The default port for the device.
     * @class
     * @constructor
     * @category Device
     */
    EVWEB2.DeviceTypeInfo = function(name, username, password, port) {
        /**
         * The name of the device type.
         * @type String
         */
        this.name = '';

        /**
         * The default username for connections to the device.
         * @type String
         */
        this.username = '';

        /**
         * The default password for connections to the device.
         * @type String
         */
        this.password = '';

        /**
         * The default port for the device.
         * @type Number
         */
        this.port = 0;

        //Assign the constructor values
        if(name !== undefined) {
            this.name = name;
        }
        if(username !== undefined) {
            this.username = username;
        }
        if(password !== undefined) {
            this.password = password;
        }
        if(port !== undefined) {
            this.port = port;
        }
    };

    /**
     * The DeviceConfig object acts as a container for configuration information of a device.
     * @param {Number} [id=0] The device ID.
     * @param {String} [name=''] The name of the device.
     * @param {String} [hostName=''] The host name of the device.
     * @param {Number} [port=0] The port for the device.
     * @param {String} [type=''] The type of device.
     * @param {String} [model=''] The device model.
     * @param {String} [macAddress=''] The MAC address of the device.
     * @param {String} [firmware=''] The firmware information of the device.
     * @param {Boolean} [enabled=false] Whether the device is enabled or not.
     * @param {Boolean} [connectionStatus=false] The connection status of the device.
     * @param {EVWEB2.DeviceConfigCameraInfo[]} [cameraInfo=[]] Information about the cameras associated with this
     * device.
     * @param {String} [username=''] The username for connections to the device.
     * @param {EVWEB2.Server} [server=null] The server associated with the device.
	 * @param {String} [serial=''] The serial number of the device.
     * @param {Number} [videoStandard=EVWEB2.videoStandards.none] The device video standard.
     * @class
     * @category Device
     */
    EVWEB2.DeviceConfig = function(id, name, hostName, port, type, model, macAddress, firmware, enabled,
                                   connectionStatus, cameraInfo, username, server, serial, videoStandard) {
        /**
         * The name of the device.
         * @type String
         */
        this.name = '';

        /**
         * The host name of the device.
         * @type String
         */
        this.hostName = '';

        /**
         * The device port.
         * @type Number
         */
        this.port = 0;

        /**
         * The username for connections to the device.
         * @type String
         */
        this.username = '';

        /**
         * The device type.
         * @type String
         */
        this.type = '';

        /**
         * The device ID.
         * @type Number
         */
        this.id = 0;

        /**
         * Whether the device is enabled or not.
         * @type Boolean
         */
        this.enabled = false;

        /**
         * The device model.
         * @type String
         */
        this.model = '';

        /**
         * The device MAC address.
         * @type String
         */
        this.macAddress = '';

        /**
         * The device serial number .
         * @type String
         */
        this.serial = '';

        /**
         * The firmware information of the device.
         * @type String
         */
        this.firmware = '';

        /**
         * The connection status of the device.
         * @type Boolean
         */
        this.connectionStatus = false;

        /**
         * Information about the cameras associated with this device.
         * @type EVWEB2.DeviceConfigCameraInfo[]
         */
        this.cameraInfo = [];

        /**
         * The server instance associated with the device.
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * The video standard of the device.
         * @type EVWEB2.videoStandards
         */
        this.videoStandard = EVWEB2.videoStandards.none;

        //Assign the constructor values
        if(name !== undefined) {
            this.name = name;
        }
        if(hostName !== undefined) {
            this.hostName = hostName;
        }
        if(port !== undefined) {
            this.port = port;
        }
        if(username !== undefined) {
            this.username = username;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(id !== undefined) {
            this.id = id;
        }
        if(enabled !== undefined) {
            this.enabled = Boolean(enabled);
        }
        if(model !== undefined) {
            this.model = model;
        }
        if(macAddress !== undefined) {
            this.macAddress = macAddress;
        }
        if(firmware !== undefined) {
            this.firmware = firmware;
        }
        if(connectionStatus !== undefined) {
            this.connectionStatus = connectionStatus;
        }
        if(cameraInfo !== undefined) {
            this.cameraInfo = cameraInfo;
        }
        if(server !== undefined) {
            this.server = server;
        }

        if(serial !== undefined) {
            this.serial = serial;
        }

        if(videoStandard !== undefined) {
            this.videoStandard = videoStandard;
        }

        /**
         * The deleteDevice is a method that deletes a device from the server. Note: Deleting a device will make
         * any recorded video non-searchable.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance with the details of the response.
         */
        this.deleteDevice = function(callback) {
            var server = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onDeleteDeviceError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onDeleteDeviceSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: server.sessionId,
                id: this.id
            };

            var settings = {
                success: onDeleteDeviceSuccess,
                error: onDeleteDeviceError,
                url: server.service.url() + EVWEB2.urls.devices,
                type: 'DELETE',
                data: params
            };

            EVWEB2.ajax(settings, server.service);

        };

        /**
         * The updateDevice is a method that helps to update the device configuration on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         * @param {String} [password] The password for connections to the device.
         */
        this.updateDevice = function(callback, password) {
            var server = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onUpdateDeviceError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onUpdateDeviceSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: server.sessionId,
                id: this.id,
                host: this.hostName,
                port: this.port,
                user: this.username,
                enabled: this.enabled
            };

            if(password !== undefined) {
                params.password = password;
            }

            var settings = {
                success: onUpdateDeviceSuccess,
                error: onUpdateDeviceError,
                url: server.service.url() + EVWEB2.urls.devices,
                type: 'PUT',
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };
    };

}());
/*globals EVWEB2:true*/

(function() {
    "use strict";

    /**
     * The LiveUserPermissions object represents the permissions for live playback on the specified server.
     * @param {Boolean} [base=false] Permission to view the live tab.  Note: If this parameter is false,
     * all other parameters will be ignored and set to false.
     * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
     * about a group and all its permissions.
     * @param {Boolean} [groups=false] Permission to view groups.
     * @param {Boolean} [maps=false] Permission to view maps.
     * @param {Boolean} [views=false] Permission to view views.
     * @param {Boolean} [quickReplay=false] Permission to view quickReplay.
     * @param {Boolean} [ptz=false] Permission to perform PTZ actions.
     * @param {Boolean} [twoWayAudio=false] Permission to interact with two-way audio.
     * @param {Boolean} [eventMonitor=false] Permission to view event monitor.
     * @param {Boolean} [saveImage=false] Permission to save images.
     * @param {Boolean} [printImage=false] Permission to print images.
     * @param {Boolean} [cameras=false] Permission to view cameras.
     * @param {Boolean} [videoPush=false] Permission to perform video push.
     * @class
     * @category Server
     */
    EVWEB2.LiveUserPermissions = function(base, groups, maps, views, quickReplay, ptz, twoWayAudio, eventMonitor,
                                                   saveImage, printImage, cameras, videoPush) {
        /**
         * Permission to view the live tab.  Note: If this parameter is false, all other parameters will be ignored
         * and set to false.
         * @type Boolean
         */
        this.base = false;

        /**
         * Whether the user has permission to view groups.
         * @type Boolean
         */
        this.groups = false;

        /**
         * Whether the user has permission to view maps.
         * @type Boolean
         */
        this.maps = false;

        /**
         * Whether the user has permission to view views.
         * @type Boolean
         */
        this.views = false;

        /**
         * Whether the user has permission to view quickReplay.
         * @type Boolean
         */
        this.quickReplay = false;

        /**
         * Whether the user has permission to perform ptz actions.
         * @type Boolean
         */
        this.ptz = false;

        /**
         * Whether the user has permission to interact with two-way audio.
         * @type Boolean
         */
        this.twoWayAudio = false;

        /**
         * Whether the user has permission to view event monitor.
         * @type Boolean
         */
        this.eventMonitor = false;

        /**
         * Whether the user has permission to save images.
         * @type Boolean
         */
        this.saveImage = false;

        /**
         * Whether the user has permission to print images.
         * @type Boolean
         */
        this.printImage = false;

        /**
         * Whether the user has permission to view cameras.
         * @type Boolean
         */
        this.cameras = false;

        /**
         * Whether the user has permission to perform video push.
         * @type Boolean
         */
        this.videoPush = false;

        //Assign the constructor values
        if(base !== undefined) {
            this.base = base;
            if(!this.base) {
                // If the base level isn't supported, all the others will stay at the default false.
                return;
            }
        }
        if(groups !== undefined) {
            this.groups = groups;
        }
        if(maps !== undefined) {
            this.maps = maps;
        }
        if(views !== undefined) {
            this.views = views;
        }
        if(quickReplay !== undefined) {
            this.quickReplay = quickReplay;
        }
        if(ptz !== undefined) {
            this.ptz = ptz;
        }
        if(twoWayAudio !== undefined) {
            this.twoWayAudio = twoWayAudio;
        }
        if(eventMonitor !== undefined) {
            this.eventMonitor = eventMonitor;
        }
        if(saveImage !== undefined) {
            this.saveImage = saveImage;
        }
        if(printImage !== undefined) {
            this.printImage = printImage;
        }
        if(cameras !== undefined) {
            this.cameras = cameras;
        }
        if(videoPush !== undefined) {
            this.videoPush = videoPush;
        }
    };

    /**
     * The SearchUserPermissions object represents the permissions for search playback on the specified server.
     * @param {Boolean} [base=false] Permission to view the search tab.  Note: If this parameter is false,
     * all other parameters will be ignored and set to false.
     * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
     * about a group and all its permissions.
     * @param {Boolean} [groups=false] Permission to search groups.
     * @param {Boolean} [maps=false] Permission to search maps.
     * @param {Boolean} [views=false] Permission to search views.
     * @param {Boolean} [events=false] Permission to search events.
     * @param {Boolean} [saveImage=false] Permission to save images.
     * @param {Boolean} [printImage=false] Permission to print images.
     * @param {Boolean} [burnDisc=false] Permission to burn discs.
     * @param {Boolean} [exportVideo=false] Permission to export video.
     * @param {Boolean} [smartSearch=false] Permission to perform smart search.
     * @param {Boolean} [cases=false] Permission to search cases.
     * @param {Boolean} [cameras=false] Permission to search cameras.
     * @class
     * @category Server
     */
    EVWEB2.SearchUserPermissions = function(base, groups, maps, views, events, saveImage, printImage, burnDisc,
                                                                    exportVideo, smartSearch, cases, cameras) {
        /**
         * Permission to view the search tab.  Note: If this parameter is false, all other parameters will be ignored
         * and set to false.
         * @type Boolean
         */
        this.base = false;

        /**
         * Whether the user has permission to search groups.
         * @type Boolean
         */
        this.groups = false;

        /**
         * Whether the user has permission to search maps.
         * @type Boolean
         */
        this.maps = false;

        /**
         * Whether the user has permission to search views.
         * @type Boolean
         */
        this.views = false;

        /**
         * Whether the user has permission to search events.
         * @type Boolean
         */
        this.events = false;

        /**
         * Whether the user has permission to save images.
         * @type Boolean
         */
        this.saveImage = false;

        /**
         * Whether the user has permission to print images.
         * @type Boolean
         */
        this.printImage = false;

        /**
         * Whether the user has permission to view burn discs.
         * @type Boolean
         */
        this.burnDisc = false;

        /**
         * Whether the user has permission to export video.
         * @type Boolean
         */
        this.exportVideo = false;

        /**
         * Whether the user has permission to perform smart search.
         * @type Boolean
         */
        this.smartSearch = false;

        /**
         * Whether the user has permission to search cases.
         * @type Boolean
         */
        this.cases = false;

        /**
         * Whether the user has permission to search cameras.
         * @type Boolean
         */
        this.cameras = false;

        //Assign the constructor values
        if(base !== undefined) {
            this.base = base;
            if(!this.base) {
                // If the base level isn't supported, all the others will stay at the default false.
                return;
            }
        }
        if(groups !== undefined) {
            this.groups = groups;
        }
        if(maps !== undefined) {
            this.maps = maps;
        }
        if(views !== undefined) {
            this.views = views;
        }
        if(events !== undefined) {
            this.events = events;
        }
        if(saveImage !== undefined) {
            this.saveImage = saveImage;
        }
        if(printImage !== undefined) {
            this.printImage = printImage;
        }
        if(burnDisc !== undefined) {
            this.burnDisc = burnDisc;
        }
        if(exportVideo !== undefined) {
            this.exportVideo = exportVideo;
        }
        if(smartSearch !== undefined) {
            this.smartSearch = smartSearch;
        }
        if(cases !== undefined) {
            this.cases = cases;
        }
        if(cameras !== undefined) {
            this.cameras = cameras;
        }
    };

    /**
     * The ConfigUserPermissions object represents the user permissions for configuring the specified server.
     * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
     * about a group and all its permissions.
     * @param {Boolean} [userAdmin=false] Permission to administrate users.
     * @param {Boolean} [viewAdmin=false] Permission to administrate views.
     * @class
     * @category Server
     */
    EVWEB2.ConfigUserPermissions = function(userAdmin, viewAdmin) {
        /**
         * Permission to administrate users.
         * @type Boolean
         */
        this.userAdmin = false;

        /**
         * Permission to administrate views.
         * @type Boolean
         */
        this.viewAdmin = false;

        //Assign the constructor values
        if(userAdmin !== undefined) {
            this.userAdmin = userAdmin;
        }
        if(viewAdmin !== undefined) {
            this.viewAdmin = viewAdmin;
        }
    };

    /**
     * The UserPermissions object represents the user permissions for the logged in user on the specified server.
     * @deprecated This object is deprecated in favor of {@link EVWEB2.UserGroup} which includes information
     * about a group and all its permissions.
     * @param {EVWEB2.LiveUserPermissions} [livePermissions=null] The live permissions for the user on the provided server.
     * @param {EVWEB2.SearchUserPermissions} [searchPermissions=null] The search permissions for the user on the
     * provided server.
     * @param {EVWEB2.ConfigUserPermissions} [configPermissions=null] The configuration permissions for the user on the
     * provided server.
     * @param {EVWEB2.accessLevelType} [accessLevel=EVWEB2.accessLevelType.unknown] The access level of the user.
     * @class
     * @category Server
     */
    EVWEB2.UserPermissions = function(livePermissions, searchPermissions, configPermissions, accessLevel) {
        /**
         * The live permissions for the user on the provided server.
         * @type EVWEB2.LiveUserPermissions
         */
        this.livePermissions = null;

        /**
         * The live permissions for the user on the provided server.
         * @type EVWEB2.SearchUserPermissions
         */
        this.searchPermissions = null;

        /**
         * The permissions for the user to configure the provided server.
         * @type EVWEB2.ConfigUserPermissions
         */
        this.configPermissions = null;

        /**
         * The access level of the user.
         * @type EVWEB2.accessLevelType
        */
        this.accessLevel = EVWEB2.accessLevelType.unknown;

        //Assign the constructor values
        if(livePermissions !== undefined) {
            this.livePermissions = livePermissions;
        }
        if(searchPermissions !== undefined) {
            this.searchPermissions = searchPermissions;
        }
        if(configPermissions !== undefined) {
            this.configPermissions = configPermissions;
        }
        if(accessLevel !== undefined) {
            this.accessLevel = accessLevel;
        }
    };
}());
/*globals EVWEB2:true*/

(function() {
    "use strict";

    /**
     * The account type of the user.
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.accountTypes = {
        /**
         * Local User
         */
        local: 0,
        /**
         * LDAP User
         */
        ldap: 1
    };

    /**
     * The User object represents a single user account on the server.
     * @param {EVWEB2.Server} [server=null] The server the user is associated with.
     * @param {String} [username=''] The user's login username.
     * @param {String} [groupName=''] The name of the group the user belongs to.
     * @param {EVWEB2.accountTypes} [accountType=EVWEB2.accountTypes.local] The type of user account.
     * @param {Boolean} [isOrphaned=false] Whether the account is orphaned or not. This flag is set only for LDAP accounts.
     * @param {Boolean} [isManaged=false] Whether the account is managed or not. If this flag is set, the user is
     * managed by an external third-party and can not be edited by users of the server.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.User = function(server, username, groupName, accountType, isOrphaned, isManaged) {
        /**
         * The erver associated with the user.
         * @type EVWEB2.Server
         */
        this.server = null;

        /**
         * The user's login username.
         * @type String
         */
        this.username = '';

        /**
         * The group name the user belongs to.
         * @type ''
        */
        this.groupName = '';

        /**
         * The type of user account.
         * @type EVWEB2.accountTypes
        */
        this.accountType = EVWEB2.accountTypes.local;

        /**
         * Whether the account is managed or not. If this flag is set, the user is managed by an
         * external third-party and can not be edited by users of the server.
         * @type {boolean}
         */
        this.isManaged = false;

        //Assign the constructor values
        if(server !== undefined) {
            this.server = server;
        }
        if(username !== undefined) {
            this.username = username;
        }
        if(groupName !== undefined) {
            this.groupName = groupName;
        }
        if (accountType !== undefined) {
            this.accountType = accountType;
        }
        if(accountType === EVWEB2.accountTypes.ldap && isOrphaned !== undefined) {
            this.isOrphaned = isOrphaned;
        }
        if(isManaged !== undefined) {
            this.isManaged = isManaged;
        }

        /**
         * Store the original username to detect name changes
         * @type {String}
         */
        var originalUsername = this.username;

        /**
         * Delete a user from the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance
         */
        this.deleteUser = function(callback) {
            var server = this.server;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onDeleteUserError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onDeleteUserSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: server.sessionId,
                user: this.username
            };

            var settings = {
                success: onDeleteUserSuccess,
                error: onDeleteUserError,
                url: server.service.url() + EVWEB2.urls.users,
                type: 'DELETE',
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };

        /**
         * This method updates an existing user on the server. This function is also used to update a group by making
         * changes to the user's group.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed
         * a {@link EVWEB2.ResponseStatus} instance.
         * @param {EVWEB2.UserGroup} [userGroup] The user group information.
         * @param {String} [password=''] The password for the user account, password left untouched if not given.
         */
        this.update = function(callback, userGroup, password) {
            var server = this.server;
            var user = this;

            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }

            var onUpdateUserError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onUpdateUserSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                if (user.username !== originalUsername){
                    // reset original name for subsequent updates
                    originalUsername = user.username;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var params = {
                s: server.sessionId,
                name: this.username,
                role: userGroup.accessLevel,
                accountType: this.accountType
            };

            if (userGroup !== undefined) {
                var bitmask = EVWEB2.util.internal.generatePermissionsBitmask(userGroup.permissions);
                params['guid'] = userGroup.guid;
                params['grpName'] = userGroup.name;
                params['grpGroupPermission'] = bitmask.group;
                params['grpUserPermission'] = bitmask.user;
                params['grpAdminPermission'] = bitmask.admin;
                params['grpCameras'] = userGroup.customGroupPermissions.cameras.join(",");
                params['grpAudios'] = userGroup.customGroupPermissions.audios.join(",");
                params['grpSerials'] = userGroup.customGroupPermissions.serials.join(",");
                params['grpSoftTriggers'] = userGroup.customGroupPermissions.softTriggers.join(",");
            }

            if (originalUsername !== '' && originalUsername !== this.username){
                params['originalName'] = originalUsername;
            }

            if (password !== undefined && password !== ''){
                params['password'] = password;
            }

            var priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.ptz);
            if (priority !== undefined){
                params['grpPtzPriority'] = priority.value;
            }

            priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.twoWayAudio);
            if (priority !== undefined){
                params['grpAudioPriority'] = priority.value;
            }

            priority = userGroup.getPriority(EVWEB2.groupPriorityTypes.client);
            if (priority !== undefined){
                params['grpRemotePriority'] = priority.value;
            }

            var settings = {
                success: onUpdateUserSuccess,
                error: onUpdateUserError,
                url: server.service.url() + EVWEB2.urls.users,
                type: 'PUT',
                data: params
            };

            EVWEB2.ajax(settings, server.service);
        };
    };
}());
/* globals EVWEB2:true */

(function() {
    /**
     * In server arbitration cases, a user with priority can override those without
     * @enum {number}
     * @readonly
     * @category Server
     */
    EVWEB2.groupPriorityTypes = {
        /**
         * None.  User always loses arbitration
         */
        none: 0,
        /**
         * PTZ. User can take over PTZ controls from those with lower priority
         */
        ptz: 1,
        /**
         * Two-way Audio. User can take over sound sent out of a device from those with lower priority
         */
        twoWayAudio: 2,
        /**
         * Client. User can override other pushed video from those with lower priority
         */
        client: 3
    };

    /**
     * The UserGroupPermissions object represents the permissions associated with a particular group on
     * the specified server.
     * @param {EVWEB2.userPermissions[]} [permissions=[]] An array of the available named permissions for
     * a group.
     * @constructor
     * @category Server
     */
    EVWEB2.UserGroupPermissions = function(permissions) {
        /**
         * An array of the available permissions for a group.
         * @type EVWEB2.userPermissions[]
         */
        this.permissions = [];

        //Assign the constructor values
        if (permissions !== undefined) {
            this.permissions = permissions;
        }

        /**
         * Determines whether the EVWEB2.UserGroupPermissions object has a specific permission.
         * @param {EVWEB2.userPermissions} permission The user permission to check.
         * @returns {Boolean} Whether the object has the specified permission.
         */
        this.hasPermission = function (permission) {
            if($.inArray(permission, this.permissions) !== -1) {
                return true;
            }

            return false;
        };

        /**
         * Determines whether the object has ANY of the permissions given.
         * @param {EVWEB2.userPermissions[]} permissions Array of permissions to check.
         * @returns {Boolean} Whether the object has at least one of the specified permissions.
         */
        this.hasAnyPermissions = function (permissions) {
            var permissionsArray = this.permissions;
            var i;

            for(i=0; i<permissions.length; i++) {
                if($.inArray(permissions[i], permissionsArray) !== -1) {
                    return true;
                }
            }
            return false;
        };

        /**
         * Determines whether the object has ALL of the permissions given.
         * @param {EVWEB2.userPermissions[]} permissions Array of permissions to check.
         * @returns {Boolean} Whether the object has ALL of the specified permissions.
         */
        this.hasAllPermissions = function (permissions) {
            var permissionsArray = this.permissions;
            var hasAllPermissions = true;

            $.each(permissions, function(index, element) {
                hasAllPermissions = $.inArray(element, permissionsArray) !== -1 && hasAllPermissions;
            });
            return hasAllPermissions;
        };
    };

    /**
     * The CustomGroupPermissions object represents the additional group permissions/restrictions for a
     * particular group on the specified server.
     * @param {Number[]} [cameras=[]] An array of camera id's the group has permissions for.
     * @param {Number[]} [audios=[]] An array of audio id's the group has permissions for.
     * @param {Number[]} [serials=[]] An array of serial id's the group has permissions for.
     * @param {Number[]} [softTriggers=[]] An array of soft trigger id's the group has permissions for.
     * @constructor
     * @category Server
     */
    EVWEB2.CustomGroupPermissions = function(cameras, audios, serials, softTriggers) {
        /**
         * An array of camera id's the group has permissions for.
         * @type Number[]
         */
        this.cameras = [];

        /**
         * An array of audio id's the group has permissions for.
         * @type Number[]
         */
        this.audios = [];

        /**
         * An array of serial id's the group has permissions for.
         * @type Number[]
         */
        this.serials = [];

        /**
         * An array of soft trigger id's the group has permissions for.
         * @type Number[]
         */
        this.softTriggers = [];

        //Assign the constructor values
        if(cameras !== undefined) {
            this.cameras = cameras;
        }
        if(audios !== undefined) {
            this.audios = audios;
        }
        if(serials !== undefined) {
            this.serials = serials;
        }
        if(softTriggers !== undefined) {
            this.softTriggers = softTriggers;
        }
    };

     /**
     * The UserGroupPriority represents a single priority for a group.
     * @param {EVWEB2.groupPriorityTypes} [priority=EVWEB2.groupPriorityTypes.none] The type of priority.
     * @param {Number} value The value to assign to the priority.
     * @constructor
      * @category Server
     */
    EVWEB2.UserGroupPriority = function(priority, value) {
        /**
         * The priority type.
         * @type EVWEB2.groupPriorityTypes
         */
        this.priority = EVWEB2.groupPriorityTypes.none;

        /**
         * The value to assign to the priority.
         * @type Number
         */
        this.value = -1;

        //Assign the constructor values
        if(priority !== undefined) {
            this.priority = priority;
        }
        if(value !== undefined) {
            this.value = value;
        }
    };

    /**
     * The UserGroup object represents a server side group and all of it's permissions.
     * @param {String} [name=''] The name of the group.
     * @param {EVWEB2.accessLevelType} [accessLevel=EVWEB2.accessLevelType.unknown] The access level of the user.
     * @param {EVWEB2.UserGroupPermissions} [permissions=null] The permissions associated with the built-in group.
     * @param {EVWEB2.UserGroupPriority[]} [priorities=[]] An array of the priorities assigned to the group.
     * @param {String} [guid=''] The guid of a custom group.  This value is null for built-in groups (i.e. accessLevel
     * other than {@link EVWEB2.accessLevelType.none})
     * @param {EVWEB2.CustomGroupPermissions} [customGroupPermissions=null] The permissions associated with the custom group.
     * @param {Boolean} [isManaged=false] Whether the group is managed or not. If this flag is set, the group is
     * managed by an external third-party and can not be edited by users of the server.
     * @class
     * @constructor
     * @category Server
     */
    EVWEB2.UserGroup = function(name, accessLevel, permissions, priorities, guid, customGroupPermissions, isManaged) {
        /**
         * The group name.
         * @type String
         */
        this.name = '';

        /**
         * The access level of the user.
         * @type EVWEB2.accessLevelType
         */
        this.accessLevel = EVWEB2.accessLevelType.unknown;

        /**
         * The group permissions.
         * @type EVWEB2.UserGroupPermissions
         */
        this.permissions = null;

        /**
         * An array of the priorities assigned to the group.
         * @type EVWEB2.UserGroupPriority[]
        */
        this.priorities = [];

        /**
         * The guid of a custom group.
         * @type String
        */
        this.guid = '';

        /**
         * The permissions of the custom group.
         * @type EVWEB2.CustomGroupPermissions
        */
        this.customGroupPermissions = null;

        /**
         * Whether the group is managed or not. If this flag is set, the group is managed by an
         * external third-party and can not be edited by users of the server.
         * @type {boolean}
         */
        this.isManaged = false;

        //Assign the constructor values
        if(name !== undefined) {
            this.name = name;
        }
        if(accessLevel !== undefined) {
            this.accessLevel = accessLevel;
        }
        if(permissions !== undefined) {
            this.permissions = permissions;
        }
        if(priorities !== undefined) {
            this.priorities = priorities;
        }
        if(guid !== undefined) {
            this.guid = guid;
        }
        if(customGroupPermissions !== undefined) {
            this.customGroupPermissions = customGroupPermissions;
        }
        if(isManaged !== undefined) {
            this.isManaged = isManaged;
        }

        /**
         * Retrieve a specific priority type
         * @param {EVWEB2.groupPriorityTypes} priorityType The type of priority to retrive
         * @returns {EVWEB2.UserGroupPriority} The existing priority or null if none exists.
         */
        this.getPriority = function (priorityType){
            for(var i = 0; i < this.priorities.length; ++i){
                if (this.priorities[i].priority === priorityType){
                    return this.priorities[i];
                }
            }
            return undefined;
        };

        /**
         * Set a priority or create it if it does not already exist
         * @param {EVWEB2.groupPriorityTypes} priorityType The type of priority to set
         * @param {Number} value the value to assign to the priority
         */
        this.setPriority = function (priorityType, value){
            var existingPriority = this.getPriority(priorityType);
            if (existingPriority !== undefined){
                existingPriority.value = value;
            }else{
                this.priorities.push(new EVWEB2.UserGroupPriority(priorityType, value));
            }
        };
    };
}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for types of event monitor profiles.
     * @enum {number}
     * @readonly
     * @category Events
     */
    EVWEB2.EventMonitorProfileTypes = {
        /**
         * Unknown
         */
        Unknown: -1,
        /**
         * Video
         */
        Video: 0,
        /**
         * View
         */
        View: 1
    };

    /**
     * Definitions for types of event monitor source events.
     * @enum {number}
     * @readonly
     * @category Events
     */
    EVWEB2.EventMonitorLinkSourceTypes = {
        /**
         * None
         */
        None: 0,
        /**
         * Soft Trigger
         */
        SoftTrigger: 1,
        /**
         * Time Trigger
         */
        TimeTrigger: 2,
        /**
         * Input Trigger
         */
        InputTrigger: 3,
        /**
         * Video Loss
         */
        VideoLoss: 4,
        /**
         * Video Motion
         */
        VideoMotion: 5,
        /**
         * Disconnect Device
         */
        DisconnectDevice: 6,
        /**
         * Serial Port
         */
        SerialPort: 7,
        /**
         * Serial Profile
         */
        SerialProfile: 8,
        /**
         * Health
         */
        Health: 9,
        /**
         * Button
         */
        Button: 10,
        /**
         * Analytics
         */
        Analytics: 11,
        /**
         * Group
         */
        Group: 12,
        /**
         * Disconnect Video
         */
        DisconnectVideo: 13,
        /**
         * Disconnect Audio
         */
        DisconnectAudio: 14,
        /**
         * Auto-connection
         */
        AutoConnection: 15,
        /**
         * Default
         */
        Default: 16,
        /**
         * Security Integration
         */
        SecurityIntegration: 17,
        /**
         * Security Integration Connected
         */
        SecurityIntegrationConnected: 18,
        /**
         * Serial Port Connection
         */
        SerialPortConnection: 19
    };

    /**
     * Definitions for types of event monitor target events.
     * @enum {number}
     * @readonly
     * @category Events
     */
    EVWEB2.EventMonitorLinkTargetTypes = {
        /**
         * None
         */
        None: 0,
        /**
         * View
         */
        View: 1,
        /**
         * Sound
         */
        Sound: 2,
        /**
         * Tour
         */
        Tour: 3,
        /**
         * Video
         */
        Video: 4,
        /**
         * Log
         */
        Log: 5,
        /**
         * Digital PTZ Preset
         */
        DigitalPreset: 6,
        /**
         * Audio
         */
        Audio: 7
    };

    /**
     * An event monitor link event that has occurred.  Contains the triggered event monitor link, as well as
     * the associated server information.
     * @param {EVWEB2.EventMonitorLink} [eventLink=null] The triggered event link.
     * @param {String} [sourceId=''] The ID of the item that triggered the event link.
     * @param {String} [extraId=''] An extra ID to associate with triggering the event link.
     * @class
     * @constructor
     * @category Events
     */
    EVWEB2.EventMonitorLinkEvent = function(eventLink, sourceId, extraId) {

        /**
         * The triggered event link.
         * @type {EVWEB2.EventMonitorLink}
         */
        this.eventLink = null;

        /**
         * The ID of the item that triggered the event link.
         * @type {string}
         */
        this.sourceId = '';

        /**
         * An extra ID to associate with triggering the event link.
         * @type {string}
         */
        this.extraId = '';

        if(eventLink !== undefined) {
            this.eventLink = eventLink;
        }
        if(sourceId !== undefined) {
            this.sourceId = sourceId;
        }
        if(extraId !== undefined) {
            this.extraId = extraId;
        }
    };

    /**
     * The EventMonitorLinkSource object acts as a container for all information about an event monitor source.
     * @param {String} [server=''] The session ID of the server associated with this event monitor source.
     * @param {String} [id=''] The ID of the item.
     * @param {EVWEB2.EventMonitorLinkSourceTypes} [type=EVWEB2.EventMonitorLinkSourceTypes.None] The type of event
     * monitor source.
     * @param {String} [extraId=''] An extra ID to associate with the event monitor source. Note: This value is
     * currently only used for analytics rules IDs and for Health types.
     * @param {Boolean} [any=false] Whether any item will trigger this source.
     * @class
     * @constructor
     * @category Events
     */
    EVWEB2.EventMonitorLinkSource = function(server, id, type, extraId, any) {

        /**
         * The session ID of the server associated with this event monitor source.
         * @type {string}
         */
        this.server = '';

        /**
         * The ID of the item.
         * @type {string}
         */
        this.id = '';

        /**
         * The type of event monitor source.
         * @type {EVWEB2.EventMonitorLinkSourceTypes}
         */
        this.type = EVWEB2.EventMonitorLinkSourceTypes.None;

        /**
         * An extra ID to associate with the event monitor source. Note: This value is currently only used for
         * analytics rules IDs and Health types.
         * @type {string}
         */
        this.extraId = '';

        /**
         * Whether any item will trigger this source.
         * @type {boolean}
         */
        this.any = false;

        if(server !== undefined) {
            this.server = server;
        }
        if(id !== undefined) {
            this.id = id;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(extraId !== undefined) {
            this.extraId = extraId;
        }
        if(any !== undefined) {
            this.any = any;
        }
    };

    /**
     * The EventMonitorLinkTarget object acts as a container for all information about an event monitor target.
     * @param {String} [server=''] The session ID of the server associated with this event monitor target.
     * @param {String} [value=''] Either the ID or the name of the item.  This is dependent on the
     * {@link EVWEB2.EventMonitorLinkTarget.type} of the target.
     * @param {EVWEB2.EventMonitorLinkTargetTypes} [type=EVWEB2.EventMonitorLinkTargetTypes.None] The type of event
     * monitor target.
     * @param {String} [extraId=''] An extra ID to associate with the event monitor target. Note: This value is
     * currently only used for selecting a digital preset ID.
     * @param {string[]} [folders=[]] An array of the folders for the value.  Note: This value is used for types
     * that do no have IDs, such as views.
     * @class
     * @constructor
     * @category Events
     */
    EVWEB2.EventMonitorLinkTarget = function(server, value, type, extraId, folders) {

        /**
         * The session ID of the server associated with this event monitor target.
         * @type {string}
         */
        this.server = '';

        /**
         * Either the ID or the name of the item.  This is dependen {@link EVWEB2.EventMonitorLinkTarget.type} of
         * the target.
         * @type {string}
         */
        this.value = '';

        /**
         * The type of event monitor target.
         * @type {EVWEB2.EventMonitorLinkTargetTypes}
         */
        this.type = EVWEB2.EventMonitorLinkTargetTypes.None;

        /**
         * An extra ID to associate with the event monitor target. Note: This value is currently only used for
         * selecting a digital preset ID.
         * @type {string}
         */
        this.extraId = '';

        /**
         * An array of the folders for the value.  Note: This value is used for types that do no have IDs, such as
         * views.
         * @type {string[]}
         */
        this.folders = [];

        if(server !== undefined) {
            this.server = server;
        }
        if(value !== undefined) {
            this.value = value;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(extraId !== undefined) {
            this.extraId = extraId;
        }
        if(folders !== undefined) {
            this.folders = folders;
        }
    };

    /**
     * The EventMonitorLink object acts as a container for all information about an individual event monitor.
     * @param {EVWEB2.Service} [service=null] The service associated with this event monitor link.
     * @param {EVWEB2.EventMonitorProfile} [profile=null] The profile associated with this event monitor link.
     * @param {String} [guid=''] The GUID associated with this event monitor link.
     * @param {EVWEB2.EventMonitorLinkSource} [source=null] The source of the event monitor link.
     * @param {EVWEB2.EventMonitorLinkTarget} [target=null] The target of the event monitor link.
     * @param {Number} [priority=1] The priority of the event monitor link, in a scale between 1-10.
     * @param {Boolean} [confirm=false] Whether the user is required to manually clear the event (e.g. the event does
     * not timeout, independent of the value of the timeout parameter).
     * @param {Number} [timeout=0] The timeout duration of the event, in seconds.  Valid values are 0-60.
     * @param {String} [message=''] The message to display for this event monitor link.
     * @class
     * @constructor
     * @category Events
     */
    EVWEB2.EventMonitorLink = function(service, profile, guid, source, target, priority, confirm, timeout, message) {

        /**
         * The service associated with this event monitor link.
         * @type {EVWEB2.Service}
         */
        this.service = null;


        /**
         * The profile associated with this event monitor link.
         * @type {EVWEB2.EventMonitorProfile}
         */
        this.profile = null;

        /**
         * The GUID associated with this event monitor link.
         * @type {string}
         */
        this.guid = '';

        /**
         * The source of the event monitor link.
         * @type {EVWEB2.EventMonitorLinkSource}
         */
        this.source = null;

        /**
         * The target of the event monitor link.
         * @type {EVWEB2.EventMonitorLinkTarget}
         */
        this.target = null;

        /**
         * The priority of the event monitor link, in a scale between 1-10.
         * @type {number}
         */
        this.priority = 1;

        /**
         * Whether the user is required to manually clear the event (e.g. the event does not timeout, independent of
         * the value of the timeout parameter).
         * @type {boolean}
         */
        this.confirm = false;

        /**
         * The timeout duration of the event, in seconds.  Valid values are 0-60.
         * @type {number}
         */
        this.timeout = 0;

        /**
         * The message to display for this event monitor link.
         * @type {string}
         */
        this.message = '';

        if(service !== undefined) {
            this.service = service;
        }
        if(profile !== undefined) {
            this.profile = profile;
        }
        if(guid !== undefined) {
            this.guid = guid;
        }
        if(source !== undefined) {
            this.source = source;
        }
        if(target !== undefined) {
            this.target = target;
        }
        if(priority !== undefined) {
            this.priority = priority;
        }
        if(confirm !== undefined) {
            this.confirm = confirm;
        }
        if(timeout !== undefined) {
            this.timeout = timeout;
        }
        if(message !== undefined) {
            this.message = message;
        }

        /**
         * Updates the values of this event monitor link on the server.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.applyUpdate = function(callback) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };


            // Populate the parameters
            var params = {
                guid: this.guid,
                priority: this.priority,
                confirm: this.confirm,
                timeout: this.timeout,
                message: this.message
            };
            if(this.source !== null) {
                params.eventSourceId = this.source.id;
                params.eventSourceServer = this.source.server;
                params.eventSourceType = this.source.type;
                params.eventSourceExtra = this.source.extraId;
                params.eventSourceAny = this.source.any;
            }
            else {
                params.eventSourceServer = this.target.server;
                params.eventSourceType = EVWEB2.EventMonitorLinkSourceTypes.None;
            }
            if(this.target !== null) {
                params.eventTargetId = this.target.value;
                params.eventTargetServer = this.target.server;
                params.eventTargetType = this.target.type;
                params.eventTargetExtra = this.target.extraId;
                params.eventTargetFolderName = this.target.folders;
            }
            else {
                params.eventTargetServer = this.source.server;
                params.eventTargetType = EVWEB2.EventMonitorLinkTargetTypes.None;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                type: 'PUT',
                url: this.service.url() + EVWEB2.urls.eventMonitoring + '/' + this.profile.name,
                traditional: true,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };
    };

    /**
     * The EventMonitorProfile object acts as a container for all information about an event monitoring profile.
     * @param {EVWEB2.Service} [service=null] The service associated with this event monitor link.
     * @param {String} [name=''] The name of this profile.
     * @param {EVWEB2.EventMonitorProfileTypes} [type=EVWEB2.EventMonitorProfileTypes.unknown] The type of this profile.
     * @param {String} [description=''] The description of this profile.
     * @param {Boolean} [showEventsList=false] Whether to show the events list on triggering of a link.
     * @param {Boolean} [showNewest=false] Whether to show the newest events.
     * @param {EVWEB2.EventMonitorLink[]} [events=[]] The event monitoring links associated with this profile.
     * @class
     * @constructor
     * @category Events
     */
    EVWEB2.EventMonitorProfile = function(service, name, type, description, showEventsList, showNewest, events) {

        /**
         * The service associated with this event monitor link.
         * @type {EVWEB2.Service}
         */
        this.service = null;

        /**
         * The name of this profile.
         * @type {string}
         */
        this.name = '';

        /**
         * The type of this profile
         * @type {EVWEB2.EventMonitorProfileTypes}
         */
        this.type = EVWEB2.EventMonitorProfileTypes.unknown;

        /**
         * The description of this profile.
         * @type {string}
         */
        this.description = '';

        /**
         * Whether to show the events list on triggering of a link.
         * @type {boolean}
         */
        this.showEventsList = false;

        /**
         * Whether to show the newest events.
         * @type {boolean}
         */
        this.showNewest = false;

        /**
         * The event monitoring links associated with this profile.
         * @type {Array}
         */
        this.events = [];

        if(service !== undefined) {
            this.service = service;
        }
        if(name !== undefined) {
            this.name = name;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(description !== undefined) {
            this.description = description;
        }
        if(showEventsList !== undefined) {
            this.showEventsList = showEventsList;
        }
        if(showNewest !== undefined) {
            this.showNewest = showNewest;
        }
        if(events !== undefined) {
            this.events = events;
        }

        /**
         * Generates an array of all associated session IDs by checking the source and target of each event link.
         * @param {EVWEB2.EventMonitorLink[]} links The list of links to use to generate the session IDs.
         * @returns {string[]} Array of session IDs.
         * @private
         */
        var generateSessionIdList = function(links) {
            var sessionIds = [];
            $.each(links, function(index, element) {
                if(element.source !== null
                        && element.source.type !== EVWEB2.EventMonitorLinkSourceTypes.None
                        && $.inArray(element.source.server, sessionIds) === -1) {
                    sessionIds.push(element.source.server);
                }
                if(element.target !== null
                        && element.target.type !== EVWEB2.EventMonitorLinkTargetTypes.None
                        && $.inArray(element.target.server, sessionIds) === -1) {
                    sessionIds.push(element.target.server);
                }
            });

            return sessionIds;
        };

        /**
         * Checks for whether any event links associated with this profile have been triggered.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.EventMonitorLinkEvent} instances
         * describing the triggered event links that have been triggered since the last request.
         * @param {number} [duration=3] The duration in the past, in seconds, to retrieve events. Triggered events are
         * not stored for more than 1 minute, so values greater than 60 are ignored.
         */
        this.checkEventLinks = function(callback, duration) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var links = $.map(data.triggeredEvents, function(triggeredEvent) {
                    var eventLink = $.grep(instance.events, function(event) {
                        return event.guid === triggeredEvent.guid;
                    })[0];
                    return new EVWEB2.EventMonitorLinkEvent(eventLink, triggeredEvent.id, triggeredEvent.extraId);
                });
                var response = new EVWEB2.ResponseStatus(data.success);
                callback(response, links);
            };

            if(duration === undefined) {
                duration = 3;
            }

            // Populate the parameters
            var params = {
                s: generateSessionIdList(this.events),
                duration: duration
            };

            var settings = {
                success: onSuccess,
                error: onError,
                traditional: true,
                url: this.service.url() + EVWEB2.urls.eventMonitoring + '/' + this.name,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Updates an event monitor profile.  Note: {@link EVWEB2.EventMonitorProfile.events} is not modified by
         * this method.  To modify the event monitor links, see the {@link EVWEB2.EventMonitorLink.update},
         * {@link EVWEB2.EventMonitorProfile.addLink}, and {@link EVWEB2.EventMonitorProfile.removeLink}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.update = function(callback) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };


            // Populate the parameters
            var params = {
                name: this.name,
                description: this.description,
                type: this.type,
                showEventsList: this.showEventsList,
                showNewestEvent: this.showNewest,
                s: generateSessionIdList(this.events)
            };

            var settings = {
                success: onSuccess,
                error: onError,
                type: 'PUT',
                traditional: true,
                url: this.service.url() + EVWEB2.urls.eventMonitoring,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Adds an event monitor link.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance and a copy of the updated {@link EVWEB2.EventMonitorLink}
         * instance.
         * @param {EVWEB2.EventMonitorLink} link The event monitor link to add.
         */
        this.addLink = function(callback, link) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    callback(new EVWEB2.ResponseStatus(data.success, data.errorText));
                    return;
                }

                var updateLink = data.event;
                var source = updateLink.source;
                link.source = new EVWEB2.EventMonitorLinkSource();
                if(source !== null) {
                    link.source = new EVWEB2.EventMonitorLinkSource(source.server, source.id, source.type,
                        source.extra, source.any);
                }

                var target = updateLink.target;
                link.target = new EVWEB2.EventMonitorLinkTarget();
                if(target !== null) {
                    link.target = new EVWEB2.EventMonitorLinkTarget(target.server, target.value, target.type,
                        target.extra, target.folders);
                }

                link.guid = updateLink.guid;
                link.priority = updateLink.priority;
                link.confirm = updateLink.confirm;
                link.timeout = updateLink.timeout;
                link.message = updateLink.message;

                var response = new EVWEB2.ResponseStatus(data.success);
                callback(response, link);
            };

            // Populate the parameters
            var params = {
                eventConfirm: link.confirm,
                eventMessage: link.message,
                eventTimeout: link.timeout,
                eventPriority: link.priority
            };
            if(link.source !== null) {
                params.eventSourceId = link.source.id;
                params.eventSourceServer = link.source.server;
                params.eventSourceType = link.source.type;
                params.eventSourceExtra = link.source.extraId;
                params.eventSourceAny = link.source.any;
            }
            else {
                params.eventSourceServer = link.target.server;
                params.eventSourceType = EVWEB2.EventMonitorLinkSourceTypes.None;
            }
            if(link.target !== null) {
                params.eventTargetValue = link.target.value;
                params.eventTargetServer = link.target.server;
                params.eventTargetType = link.target.type;
                params.eventTargetExtra = link.target.extraId;
                params.eventTargetFolders = link.target.folders;
            }
            else {
                params.eventTargetServer = link.source.server;
                params.eventTargetType = EVWEB2.EventMonitorLinkTargetTypes.None;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                type: 'POST',
                url: this.service.url() + EVWEB2.urls.eventMonitoring + '/' + this.name,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Removes an event monitor link.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         * @param {EVWEB2.EventMonitorLink} link The event monitor link to remove.
         */
        this.removeLink = function(callback, link) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };


            // Populate the parameters
            var params = {
                s: generateSessionIdList([link]),
                guid: link.guid
            };


            var settings = {
                success: onSuccess,
                error: onError,
                type: 'DELETE',
                traditional: true,
                url: this.service.url() + EVWEB2.urls.eventMonitoring + '/' + this.name,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Deletes this event monitor profile on the associated servers.
         * @param {Function} callback Callback function to be executed when the call completes. Callback is passed a
         * {@link EVWEB2.ResponseStatus} instance.
         */
        this.deleteProfile = function(callback) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };

            // Populate the parameters
            var params = {
                s: generateSessionIdList(this.events),
                name: this.name
            };


            var settings = {
                success: onSuccess,
                error: onError,
                type: 'DELETE',
                traditional: true,
                url: this.service.url() + EVWEB2.urls.eventMonitoring,
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Registers a push notification client to receive notifications for events on this profile.  Once
         * subscribed, push notifications will be sent to the client until the client unsubscribes using
         * {@link EVWEB2.EventMonitorProfile.pushNotificationUnsubscribe} or until the client is unregistered
         * using {@link EVWEB2.PushNotification.unregisterClient}.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance.
         * @param {string} clientId The client ID to update.  This value was generated in a previous call
         * to {@EVWEB2.PushNotification.registerClient}.
         * @param {EVWEB2.EventMonitorLink} link The link to receive notifications on.
         */
        this.pushNotificationSubscribe = function(callback, clientId, link) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };

            var params = {
                id: clientId,
                profile: this.name,
                guid: link.guid
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.eventMonitoringPush,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Unregisters a push notification client to receive notifications for events on this profile.  Once
         * unsubscribed, push notifications will no longer be sent to the client until the client re-subscribes using
         * {@link EVWEB2.EventMonitorProfile.pushNotificationSubscribe}.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.ResponseStatus} instance.
         * @param {string} clientId The client ID to update.  This value was generated in a previous call
         * to {@EVWEB2.PushNotification.registerClient}.
         * @param {EVWEB2.EventMonitorLink} link The link to receive notifications on.
         */
        this.pushNotificationUnsubscribe = function(callback, clientId, link) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };

            var params = {
                id: clientId,
                profile: this.name,
                guid: link.guid
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.eventMonitoringPush,
                type: 'DELETE',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

    };

}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for the types of push notification clients.  These values correspond to the different
     * push notification networks.
     * @enum {number}
     * @readonly
     * @category Service
     */
    EVWEB2.PushNotificationClientType = {
        /**
         * Apple Push Notification Service
         */
        APNS: 0,
        /**
         * Google Cloud Messaging
         */
        GCM: 1,
        /**
         * Microsoft Push Notification Service
         */
        MPNS: 2
        //ADM: 3
    };

    /**
     * Base container for Push Notification actions for mobile clients.  This class exposes
     * the different methods required to configure a mobile client to receive push
     * notifications from the server.
     * Note: Do not instantiate this class directly.  This functionality is exposed through
     * {@link EVWEB2.Service.pushNotification} and should be used there.
     * @param {EVWEB2.Service} [service=null] A reference to the parent service instance.
     * @class
     * @constructor
     * @category Service
     */
    EVWEB2.PushNotification = function(service) {

        /**
         * A reference to the parent service instance.
         * @type {EVWEB2.Service}
         */
        this.service = null;


        if(service !== undefined) {
            this.service = service;
        }

        /**
         * Retrieves the RSA PKCS1-OAEP public key for encrypting client tokens sent to the web
         * service. Note: This encryption only necessary when sending MPNS (Windows Phone 8)
         * tokens over unencrypted protocols and is not recommended to be used in any other
         * situations.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.Server.ResponseStatus} instance and a string of
         * the encryption key.
         */
        this.getPublicKey = function(callback) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response;
                if(!data.success) {
                    response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                    callback(response);
                    return;
                }

                response = new EVWEB2.ResponseStatus(true);
                callback(response, data.key);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.pushNotification
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Registers a client to receive push notifications.  Each client must use this call to register
         * as a client at least once and use the response client ID to register for receiving individual
         * push notifications.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.Server.ResponseStatus} instance and the generated client
         * ID used in subsequent push notification functions.
         * @param {EVWEB2.PushNotificationClientType} type The type of client being registered.
         * @param {string} token The registration token of the client.  The format of each depends on the
         * device type.  Reference the vendor documentation for the push notification network on generating
         * this value.
         * @param {boolean} [encrypted=false] Whether the provided token is encrypted using RSA PKCS1-OAEP encyrption.
         * Note: This is only necessary when sending MPNS (Windows Phone 8) tokens over unencrypted protocols and is
         * not recommended to be used in any other situations.
         */
        this.registerClient = function(callback, type, token, encrypted) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response;
                if(!data.success) {
                    response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                    callback(response);
                    return;
                }

                response = new EVWEB2.ResponseStatus(true);
                callback(response, data.id);
            };

            var params = {
                type: type,
                token: token
            };
            if(encrypted !== undefined) {
                params.encrypted = encrypted;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.pushNotification,
                type: 'POST',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Updates an existing client ID with a new token.  Similar to registering a device, some push
         * notification networks provide new tokens after an error.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.Server.ResponseStatus} instance and the generated client
         * ID used in subsequent push notification functions.  Note: The client ID will be the same as
         * passed in as a parameter, it is provided here for convenience.
         * @param {string} clientId The client ID to update.  This value was generated in a previous call
         * to {@EVWEB2.PushNotification.registerClient}.
         * @param {string} newToken The new registration token of the client.  The format of each depends on the
         * device type.  Reference the vendor documentation for the push notification network on generating
         * this value.
         * @param {boolean} [encrypted=false] Whether the provided token is encrypted using RSA PKCS1-OAEP encyrption.
         * Note: This is only necessary when sending MPNS (Windows Phone 8) tokens over unencrypted protocols and is
         * not recommended to be used in any other situations.
         */
        this.updateClientToken = function(callback, clientId, newToken, encrypted) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response;
                if(!data.success) {
                    response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                    callback(response);
                    return;
                }

                response = new EVWEB2.ResponseStatus(true);
                callback(response, data.id);
            };

            var params = {
                id: clientId,
                newtoken: newToken
            };
            if(encrypted !== undefined) {
                params.encrypted = encrypted;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.pushNotification,
                type: 'PUT',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };

        /**
         * Unregisters a client from receiving push notifications.  This will remove all push notification
         * subscriptions for this device, as well as unregistering the device.  After this call, a device
         * must re-register using {@link EVWEB2.PushNotification.registerClient} before any subscriptions
         * can be made.
         * @param {Function} callback Callback function to be executed when the call completes.
         * Callback is passed a {@link EVWEB2.Server.ResponseStatus} instance.
         * @param {string} clientId The client ID to unregister.  This value was generated in a previous call
         * to {@EVWEB2.PushNotification.registerClient}.
         */
        this.unregisterClient = function(callback, clientId) {
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                var response = new EVWEB2.ResponseStatus(data.success, data.errorText);
                callback(response);
            };

            var params = {
                id: clientId
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: this.service.url() + EVWEB2.urls.pushNotification,
                type: 'DELETE',
                data: params
            };

            EVWEB2.ajax(settings, this.service);
        };
    };
}());
/*globals EVWEB2:true, uuid:true, ArrayBuffer:false, DataView:true, WebSocket:false, Blob:false*/
(function() {
    "use strict";

    /**
     * The protocol message type.
     * @enum {number}
     * @readonly
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
     var protocolMessageType = {
        publish: 1,
        published: 2,
        subscribe: 3,
        subscribed: 4,
        unsubscribe: 5,
        unsubscribed: 6
    };

    /**
     * The possible error enum values set on EVWEB2.ResponseStatus objects for websocket calls
     * @enum {number}
     * @readonly
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.websocketErrorCodes = {
        /**
         * Unknown Topic
         */
        unknownTopic: -1,
        /**
         * Unknown Subscription
         */
        unknownSubscription: -2,
        /**
         * Disabled
         */
        disabled: -3,
        /**
         * Connection Lost
         */
        connectionLost: -4,
        /**
         * Send Failed
         */
        sendFailed: -5,
        /**
         * Login Required
         */
        loginRequired: -6
    };

    /**
     * Helper method to replace the the topic string with the item ids.
     * @param {String} string The topic string.
     * @param {Array} args an array of item ids.
     * @returns {String} The formatted string
     * @internal
     */
    var formatString = function(string, args) {
        var result = string;
        var i = args.length;

        while (i--) {
            result = result.replace(new RegExp('\\{' + i + '\\}', 'gm'), args[i]);
        }
        return result;
    };

    /**
     * Format the session Id topic with the item ids passed.
     * @param {String} topic The topic string.
     * @param {Array} ids An array of either EVWEB2 types or strings.
     * @returns {String} The formatted topic
     * @internal
     */
    var formatTopic = function(topic, ids) {
        var formatStr = topic.rawTopicStr;
        var requiredTypes = topic.idTypes;
        var formattedIds = [];

        var instanceOfAny = function(obj, types) {
            for (var i=0; i < types.length; ++i){
                if (obj instanceof types[i]){
                    return true;
                }
            }
            return false;
        };

        var getId = function(obj){
            if (instanceOfAny(obj, [EVWEB2.Camera, EVWEB2.DeviceConfig, EVWEB2.Trigger])) {
                return obj.id;
            }
            // default case
            return obj.toString();
        };

        for(var i = 0; i < requiredTypes.length; ++i){
            formattedIds.push(getId(ids[i]));
        }

        return formatString(formatStr, formattedIds);
    };

    /**
     * The available EVWEB2 publish/subscribe topics
     * @type Object
     * @readonly
     */
    EVWEB2.pubSubTopic = {
        server: {
            rawTopicStr: "nvr.config.server",
            idTypes: []
        },
        serverStatus: {
            rawTopicStr: "nvr.status.server",
            idTypes: []
        },
        devices: {
            rawTopicStr: "nvr.config.devices",
            idTypes: []
        },
        cameraOsd: {
            rawTopicStr: "nvr.config.cameras.settings.osd",
            idTypes: []
        },
        users: {
            rawTopicStr: "nvr.config.users",
            idTypes: []
        },
        userGroups: {
            rawTopicStr: "nvr.config.userGroups",
            idTypes: []
        },
        cameras: {
            rawTopicStr: "nvr.config.cameras",
            idTypes: []
        },
        activeUsers: {
            rawTopicStr: "nvr.config.users.active",
            idTypes: []
        },
        triggers: {
            rawTopicStr: "nvr.status.softtriggers",
            idTypes: []
        },
        motion: {
            rawTopicStr: "nvr.status.camera.motion",
            idTypes: []
        },
        loss: {
            rawTopicStr: "nvr.status.camera.loss",
            idTypes: []
        },
        cameraConnection: {
            rawTopicStr: "nvr.status.camera.connection",
            idTypes: []
        },
        deviceConnection: {
            rawTopicStr: "nvr.status.device.connection",
            idTypes: []
        },
        plugins: {
            rawTopicStr: "nvr.config.plugins",
            idTypes: []
        },
        avgFrameSize: {
            rawTopicStr: "nvr.video.camera.{0}.stats.avg_frame_size",
            idTypes: [EVWEB2.Camera]
        },
        videoH264: {
            rawTopicStr: "nvr.video.camera.{0}.native",
            idTypes: [EVWEB2.Camera]
        },
        videoJPEG: {
            rawTopicStr: "nvr.video.camera.{0}.jpeg",
            idTypes: [EVWEB2.Camera]
        },
        securityIntegrationDevices: {
            rawTopicStr: "nvr.config.securityintegrations.devices",
            idTypes: []
        },
        securityIntegrationSensors: {
            rawTopicStr: "nvr.config.securityintegrations.sensors",
            idTypes: []
        },
        securityIntegrationSensorStatus: {
            rawTopicStr: "nvr.status.securityintegrations.sensors",
            idTypes: []
        },
        securityIntegrationDeviceConnection: {
            rawTopicStr: "nvr.status.securityintegrations.devices.connection",
            idTypes: []
        },
        associations: {
            rawTopicStr: "nvr.config.associations",
            idTypes: []
        }
    };

    /**
     * Protocol flag bitmasks
     * @type {object}
     * @internal
     */
    var protoFlags = {
        ackBitmask : 0x0001,
        bigEndianBitmask: 0x0002,
        binaryBitmask : 0x0004,
        versionBitmask: 0x00E0
    };

    /**
     * Container for protocol flags
     * @param {Boolean} [ack=false] flag to acknowledge the request
     * @param {Boolean} [binary=false] flag if the serialiation format is binary
     * @param {Boolean} [bigEndian=false] flag for endianess
     * @param {Number} [version=0] the protocol version number
     * @constructor
     * @this ProtocolFlags
     * @internal
     */
    var ProtocolFlags = function(ack, binary, bigEndian, version) {

        /**
         * Flag for acknowledgement
         * @type {boolean}
         */
        this.ack = false;

        /**
         * Flag if serialization format is binary
         * @type {boolean}
         */
        this.isBinary = false;

        /**
         * Flag if big endian
         * @type {boolean}
         */
        this.isBigEndian = false;

        /**
         * The protocol version number
         * @type {number}
         */
        this.version = 0;

        if (ack !== undefined){
            this.ack = ack;
        }
        if (binary !== undefined){
            this.isBinary = binary;
        }
        if (bigEndian !== undefined){
            this.isBigEndian = bigEndian;
        }
        if (version !== undefined){
            this.version = version;
        }

        /**
         * Retrieve the bitmask value for inclusion in header
         * @returns {number} The bitmask value
         */
        this.bitmask = function() {
            var bitmask = 0x0000;
			/* eslint-disable no-bitwise */
            bitmask |= this.ack ? protoFlags.ackBitmask : 0;
            bitmask |= this.isBinary ? protoFlags.binaryBitmask : 0;
            bitmask |= this.isBigEndian ? protoFlags.bigEndianBitmask: 0;
            bitmask |= (this.version & 0x0007) << 5;
			/* eslint-enable no-bitwise */
            return bitmask;
        };

        /**
         * Set the instance flags/values from a bitmask
         * @param {Number} bitmask the bitmask value to set flags from
         */
        this.setFromBitmask = function(bitmask) {
			/* eslint-disable no-bitwise */
            this.ack = Boolean(bitmask & protoFlags.ackBitmask);
            this.isBinary = Boolean(bitmask & protoFlags.binaryBitmask);
            this.isBigEndian = Boolean(bitmask & protoFlags.bigEndianBitmask);
            this.version = (bitmask & protoFlags.versionBitmask) >> 5;
			/* eslint-enable no-bitwise */
        };
    };

    /**
     * Container for header information for protocol messages
     * @param requestId
     * @param topic
     * @param messageType
     * @param flags
     * @constructor
     * @this ProtocolHeader
     * @internal
     */
    var ProtocolHeader = function(requestId, topic, messageType, flags){

        /**
         * The request ID of the message.
         * @type String
         */
        this.requestId = requestId;

        /**
         * The topic.
         * @type String
         */
        this.topic = topic;

        /**
         * The protocol message type
         * @type {number}
         */
        this.messageType = messageType;

        /**
         * The protocol options/flags
         * @type {ProtocolFlags}
         */
        this.flags = flags;

        this.marshal = function() {
            var hdr = this;
            return {
                request: hdr.messageType,
                rid: hdr.requestId,
                topic: hdr.topic,
                flags: hdr.flags.bitmask(),
                // TODO add in JS support for sub protocols
                subProtocol: 0x00,
                subProtocolFlags: 0x00
            };
        };
    };

    /**
     * PubSub 'Unsubscribe' protocol message, sent to the server to unsubscribe completely from a topic.
     * @param {ProtocolHeader} header The header for this request.
     * @param {String} subscriptionId The subscription id to unsubscribe.
     * @internal
     * @constructor
     * @this UnsubscribeMessage
     */
    var UnsubscribeMessage = function(header, subscriptionId) {
        // ensure the header is correct
        header.messageType = protocolMessageType.unsubscribe;

        /**
         * The message header
         * @type {ProtocolHeader}
         */
        this.hdr = header;

        /**
         * The subscription id
         * @type {string}
         */
        this.subscriptionId = subscriptionId;

        this.marshal = function() {
            var message = this;

            return {
                'header': message.hdr.marshal(),
                'payload': {
                    'subscriptionId': message.subscriptionId
                }
            };
        };
    };

    /**
     * Pending un-subscribe request object, used to hold state in-between unsubscribe and server acknowledgement
     * @param {EVWEB2.Subscription} subscription The subscription to unsubscribe
     * @param {$.Deferred} onAcknowledge The deferred to resolve when the request is completed
     * @private
     * @constructor
     * @this UnsubscribeRequest
     */
    var UnsubscribeRequest = function(subscription, onAcknowledge) {

        /**
         * The subscription to unsubscribe
         * @type {EVWEB2.Subscription}
         */
        this.subscription = subscription;

        /**
         * The deferred object to resolve when unsubscribed completely
         * @type {$.Deferred}
         */
        this.onAcknowledge = onAcknowledge;

    };

    /**
     * PubSub 'Subscribe' protocol message, sent to the server to request a new subscription be made
     * @param {ProtocolHeader} header The header for this request
     * @param {String} [requestedSid=''] Request a particular subscription ID from the server
     * @this SubscribeMessage
     * @class
     */
    var SubscribeMessage = function(header, requestedSid) {
        // ensure the header is correct
        header.messageType = protocolMessageType.subscribe;

        /**
         * The message header
         * @type {ProtocolHeader}
         */
        this.hdr = header;

        /**
         * A specific subscription id to request the server use
         * @type {string}
         */
        this.requestedSid = '';

        if(requestedSid !== undefined && requestedSid !== '') {
            this.requestedSid = requestedSid;
        }

        this.marshal = function() {
            var message = this;
            var options = {
            };

            if(message.requestedSid !== ''){
                options['requestedSID'] = message.requestedSid;
            }

            return {
                'header': message.hdr.marshal(),
                'payload': {
                    'options': options
                }
            };
        };
    };

    /**
     * JSON serializer
     * @constructor
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.JsonSerializer = function() {

        /**
         * Flag for protocol flags
         * @type {boolean}
         */
        this.isBinary = false;

        this.serialize = function(data) {
            return JSON.stringify(data);
        };

        this.unserialize = function(payload) {
            return JSON.parse(payload);
        };
    };

    /**
     * Composite Binary serializer. The composite serializer includes a binary header with a
     * serialized payload and an optional binary payload.
     *
     * Wire Format of a composite serialized message:
     *
     *  0...2...........7...............15.............23...............31
     *  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     *  | protoMsgType  | uint16_t flags       VVVSSBEA | SubProtocol   |
     *  +---------------+---------------+-------------------------------+
     *  |    spf flags  | Reserved      |                               |
     *  +---------------+---------------+                               |
     *  |                                                               |
     *  |                           UUID  requestId   (16 bytes)        |
     *  |                                                               |
     *  |                                ---------------+---------------+
     *  |                               |   uint16_t  topic length      |
     *  +---------------+---------------+---------------+---------------+
     *  |     uint32_t      dataLength                                  |
     *  +---------------+---------------+---------------+---------------+
     *  |     uint32_t      blobLength                                  |
     *  +---------------+---------------+---------------+---------------+
     *  |     String        topic   (ascii)                             |
     *  +---------------+---------------+---------------+---------------+
     *  |     Serialized Payload                                        |
     *  +---------------+---------------+---------------+---------------+
     *  |     Binary payload                                            |
     *  +---------------+---------------+---------------+---------------+
     *
     * @constructor
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.CompositeSerializer = function () {

        /**
         * Flag for protocol flags / sendMessage
         * @type {boolean}
         */
        this.isBinary = true;

        var jsonSerializer = new EVWEB2.JsonSerializer();
        var serializerMap = {
            0x00: jsonSerializer
        };

        /**
         * Get the serializer from the flag bitmask that should be used to
         * decode any serialized content
         * @param {number} flags The bitmask
         * @returns {Object} The decoded object
         */
        var serializer_from_bitmask = function (flags) {
            /* eslint-disable no-bitwise */
            var stype = (flags & 0x18) >> 3;
            /* eslint-enable no-bitwise */
            var mappedSerializer = serializerMap[stype];
            return mappedSerializer === undefined ? jsonSerializer : mappedSerializer;
        };

        /**
         * Encapsulates the logic to encode a marshalled message to a binary buffer
         * @private
         * @constructor
         * @this MessageEncoder
         */
        var MessageEncoder = function () {

            /**
             * The current view offset
             * @type {number}
             */
            this.offset = 0;

            /**
             * Write the bytes of a string to a data view. Expected to be ASCII strings only. The
             * encoder offset is advanced by the string length.
             * @param {DataView} view The view object to write the string to
             * @param {String} str The string to encode as bytes into the view
             */
            this.writeString = function (view, str) {
                var encoder = this;
                var offset = encoder.offset;
                for (var i = 0; i < str.length; ++i, ++offset) {
                    var byte = str.charCodeAt(i);
                    view.setUint8(offset, byte);
                }
                encoder.offset = offset;
            };

            /**
             * Write the bytes of a UUID to a data view. The encoder offset is advanced by
             * 16 (the byte length of a UUID)
             * @param {DataView} view the view object to write UUID bytes to
             * @param {String} uuidStr The hex UUID string in 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx' format
             */
            this.writeUUID = function (view, uuidStr) {
                var encoder = this;
                var bytes = uuid.parse(uuidStr);
                for (var i = 0; i < bytes.length; ++i) {
                    view.setUint8(encoder.offset, bytes[i]);
                    encoder.offset += 1;
                }
            };

            /**
             * Encode the header information into a data view. The enocder offset is advanced by the
             * fixed header length + topic length
             * @param {DataView} view the dataview to encode the header to
             * @param {Object} header the marshalled header information
             * @param {Number} dataLength The length of the (serialized) data
             * @param {Number} blobLength The length of any binary data
             */
            this.writeHeader = function (view, header, dataLength, blobLength) {
                var encoder = this;
                view.setUint8(encoder.offset++, header.request);
                view.setUint16(encoder.offset, header.flags);
                encoder.offset += 2;

                // TODO add in JS support for subprotocols
                view.setUint8(encoder.offset++, 0);
                view.setUint8(encoder.offset++, 0);

                // reserved byte
                view.setUint8(encoder.offset++, 0);

                encoder.writeUUID(view, header.rid);

                var topicLength = header.topic.length;
                view.setUint16(encoder.offset, topicLength);
                encoder.offset += 2;

                view.setUint32(encoder.offset, dataLength);
                encoder.offset += 4;

                view.setUint32(encoder.offset, blobLength);
                encoder.offset += 4;

                encoder.writeString(view, header.topic);
            };

            /**
             * Encode a marshalled PubSub message to an array buffer
             * @param {Object} value instance of a marshalled pubsub message
             * @returns {ArrayBuffer} The encoded array buffer
             */
            this.encode = function (value) {
                var encoder = this;
                var fixedHeaderLength = 32;
                var serializer = serializer_from_bitmask(value.header.flags);
                var serializedContent = serializer.serialize(value.payload);
                var header = value.header;
                var blob = '';
                if (value.blob !== undefined && value.blob !== '') {
                    blob = value.blob;
                }

                var dataLength = 0, blobLength = 0;
                if (serializer.isBinary){
                    dataLength = serializedContent.byteLength;
                    blobLength = blob.byteLength;
                }else{
                    dataLength = serializedContent.length;
                    blobLength = blob.length;
                }

                var bufsize = fixedHeaderLength + header.topic.length + dataLength + blobLength;
                var buffer = new ArrayBuffer(bufsize);
                var view = new DataView(buffer);
                encoder.writeHeader(view, header, dataLength, blobLength);

                if(serializer.isBinary){
                    // TODO join array buffers (assumes arraybuffer is returned by binary serializers 'serialize' method)
                }else{
                    encoder.writeString(view, serializedContent);
                    encoder.writeString(view, blob);
                }

                return buffer;
            };
        };

        /**
         * Encapsulates the logic to decode a single pubsub message serialized in the expected format.
         * @param {DataView} view the dataview around the received array buffer to be decoded
         * @param {Number} [offset=0] The offset into the view to start decoding
         * @private
         * @constructor
         * @this MessageDecoder
         */
        var MessageDecoder = function (view, offset) {
            this.view = view;
            this.offset = offset || 0;

            /**
             * Read a string from the view. ASCII only. The decoder offset is advanced by the
             * string length
             * @param {Number} offset the offset into the view to begin reading a string
             * @param {Number} length the expected string length (number of bytes to read)
             * @returns {string} The read string
             */
            this.readString = function (offset, length) {
                var decoder = this;
                var string = "";
                for (var i = offset, end = offset + length; i < end; ++i) {
                    // UTF8??
                    var byte = decoder.view.getUint8(i);
                    string += String.fromCharCode(byte);
                    decoder.offset += 1;
                }
                return string;
            };

            /**
             * Read the bytes of a UUID and reconstruct into the hex string format
             * e.g. 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'. The decoder offset is advanced
             * by 16 bytes.
             * @param {Number} offset the offset into the view to begin reading UUID bytes
             * @returns {String} The UUID
             */
            this.readUUID = function (offset) {
                var decoder = this;
                var uuidLength = 16;
                var buf = new Array(uuidLength);
                for (var i = offset, end = offset + uuidLength; i < end; ++i) {
                    buf[i - offset] = decoder.view.getUint8(i);
                }

                decoder.offset += uuidLength;
                return uuid.unparse(buf);
            };

            /**
             * Read a PubSub message header and construct an equivalent marshalled header
             * object. The decoder offset is advanced by the fixed header length + the
             * topic string length.
             * @returns {Object} A marshalled PubSub message header with additional
             * 'dataLength' and 'blobLength' attributes for further processing.
             */
            this.readHeader = function() {
                var decoder = this;
                var header = {
                    request: 0,
                    rid: '',
                    flags: 0,
                    topic: '',
                    subProtocol: 0,
                    subProtocolFlags: 0,
                    dataLength: 0,  // these keys are added for further processing
                    blobLength: 0
                };

                header.request = view.getUint8(decoder.offset++);
                header.flags = view.getUint16(decoder.offset);
                decoder.offset += 2;

                header.subProtocol = view.getUint8(decoder.offset++);
                header.subProtocolFlags = view.getUint8(decoder.offset++);

                // skip the reserved byte
                decoder.offset++;

                header.rid = decoder.readUUID(decoder.offset);
                var topicLength = view.getUint16(decoder.offset);
                decoder.offset += 2;

                header.dataLength = view.getUint32(decoder.offset);
                decoder.offset += 4;

                header.blobLength = view.getUint32(decoder.offset);
                decoder.offset += 4;

                header.topic = decoder.readString(decoder.offset, topicLength);
                return header;
            };


            /**
             * Parse a PubSub message into its marshalled form
             * @returns {{header: Object, payload: Object}} The pubsub message
             */
            this.parse = function () {
                var decoder = this;
                var header = decoder.readHeader();

                var serializer = serializer_from_bitmask(header.flags);

                var serializedContent;
                if (serializer.isBinary){
                    serializedContent = decoder.view.buffer.slice(decoder.offset, decoder.offset + header.dataLength);
                    decoder.offset += header.dataLength;
                } else {
                    serializedContent = decoder.readString(decoder.offset, header.dataLength);
                }
                var content = serializer.unserialize(serializedContent);

                var obj = {
                    header: header,
                    payload: content
                };

                var blob;
                if (header.blobLength > 0){
                    blob = view.buffer.slice(decoder.offset, decoder.offset + header.blobLength);
                    decoder.offset += header.blobLength;
                    obj['payload']['data']['blob'] = blob;
                }

                // remove extra properties
                delete obj.header['blobLength'];
                delete obj.header['dataLength'];

                return obj;
            };
        };

        /**
         * Serialize a marshalled object to a binary buffer
         * @param {Object} data The marshalled object
         * @returns {ArrayBuffer} The serialized buffer
         */
        this.serialize = function (data) {
            var encoder = new MessageEncoder();
            return encoder.encode(data);
        };

        /**
         * Unserialize a binary buffer to a marshalled pubsub object
         * @param {ArrayBuffer} buf The binary buffer
         * @returns {Object} Marshalled pubsub object
         */
        this.unserialize = function (buf) {
            var view = new DataView(buf);
            var decoder = new MessageDecoder(view);
            return decoder.parse();
        };
    };


    /**
     * Internal callback for topic 'triggers'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onSoftTriggerUpdated = function(subscriptions, data){
        var args = data.args;
        var triggerId = args[0];
        var name = args[1];
        var state = args[2];

        var trigger = new EVWEB2.Trigger(subscriptions[0].server, triggerId, name, state);
        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], trigger);
        }
    };

    /**
     * Internal callback for topic 'activeUsers'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onActiveUsersChanged = function(subscriptions, data){
        var args = data.args;
        var users = args[0];

        var usersList = $.map(users, function(element) {
            return new EVWEB2.SystemUsageInfo(element.username, element.level, element.address,
                element.streams, element.audit, element.instanceName);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], usersList);
        }
    };

    /**
     * Internal callback for topic 'plugins'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onPluginsChanged = function(subscriptions, data) {
        var args = data.args;
        var plugins = args[0];

        var pluginsList = $.map(plugins, function(element) {
            return new EVWEB2.SystemPluginInfo(element.name, element.filename, element.version, element.isOpen,
                                                 element.openCode);
        });
        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], pluginsList);
        }
    };

    /**
     * Internal callback for topic 'motion'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onMotionChanged = function(subscriptions, data){
        var args = data.args;
        var cameraId = args[0];
        var hasMotion = args[1];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraId, hasMotion);
        }
    };

    /**
     * Internal callback for topic 'loss'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onLossChanged = function(subscriptions, data){
        var args = data.args;
        var cameraId = args[0];
        var state = args[1];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraId, state);
        }
    };

    /**
     * Internal callback for topic 'cameraConnection' and 'deviceConnection'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onConnectionChanged = function(subscriptions, data){
        var args = data.args;
        var uniqueId = args[0];
        var state = args[1];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], uniqueId, state);
        }
    };

    var responseToCameraInstance = function(response, server) {
        var disabled = response.disabled !== 0;
        var video = response.state === 0;

        var ptz = response.ptz === 1;
        var ptzType = EVWEB2.ptzTypes.none;
        if(ptz) {
            ptzType = EVWEB2.ptzTypes.standard;
        }

        if(response.id === undefined) {
            // Generate the ID from the plugin, interface, device, and context IDs.
            response.id = EVWEB2.util.pidToCameraId(response.p, response.i, response.d, response.ctx);
        }

        var resolution;
        if(response.resolution !== undefined) {
            resolution = new EVWEB2.CameraResolution(response.resolution.width, response.resolution.height);
        }

        return new EVWEB2.Camera(server, response.id, response.ctx, response.name, ptz, disabled, video,
            response.OSD, ptzType, response.digitalPtz, response.formats, resolution, response.quality,
            response.frameRate);
    };


    /**
     * Internal callback for topic 'cameras'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onCameraListChanged = function(subscriptions, data){
        var args = data.args;
        var resultList = args[0];

        var server = subscriptions[0].server;
        var cameraList = $.map(resultList, function(element) {
            return responseToCameraInstance(element, server);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraList);
        }
    };

    /**
     * Internal callback for topic 'users'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onUserListChanged = function(subscriptions, data){
        var args = data.args;
        var usersList = args[0];

        var server = subscriptions[0].server;

        var users = $.map(usersList, function(element) {
            return new EVWEB2.User(server, element.name, element.groupName, element.accountType, element.isOrphaned);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], users);
        }
    };

    /**
     * Internal callback for topic 'userGroups'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onUserGroupListChanged = function(subscriptions, data){
        var args = data.args;
        var customGroupsList = args[0];

        var customUserGroups = $.map(customGroupsList, function(element) {
            var accessLevel = element.role;

            var permissions = EVWEB2.util.internal.processUserGroupPermissions(element.permissions);

            var priorities = $.map(element.priorities, function(elem) {
                return new EVWEB2.UserGroupPriority(elem.priority, elem.value);
            });

            var customGroupPermissions = new EVWEB2.CustomGroupPermissions(element.cameras, element.audios,
                element.serials, element.softTriggers);

            return new EVWEB2.UserGroup(element.name, accessLevel, permissions, priorities, element.guid,
                customGroupPermissions);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], customUserGroups);
        }
    };

    /**
     * Internal callback for topic 'devices'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onDeviceListChanged = function(subscriptions, data){
        var args = data.args;
        var devices = args[0];

        var server = subscriptions[0].server;
        var devicesList = $.map(devices, function(element) {
            var cameraInfo = $.map(element.cameras, function(element) {
                return new EVWEB2.DeviceConfigCameraInfo(element.cameraId.toString(),
                    element.parentCameraId.toString(), element.name, element.isPrimary);
            });

            return new EVWEB2.DeviceConfig(element.id, element.name, element.host, element.port, element.type,
                element.model, element.macAddress, element.firmware, element.enabled, element.isConnected,
                cameraInfo, element.user, server, element.serial);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], devicesList);
        }
    };

    /**
     * Internal callback for topic 'cameraOsd'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onCameraOsdChanged = function(subscriptions, data){
        var args = data.args;
        var cameraInfos = args[0];
        var osdInfos = $.map(cameraInfos, function(element){
            var osdInfo = EVWEB2.util.internal.formatOsdInfo(element.osdInfo);
            return {
                osdInfo: osdInfo,
                cameraId: element.cameraId
            };
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], osdInfos);
        }
    };

    /**
     * Internal callback for topic 'server'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onServersUpdated = function(subscriptions, data){
        var args = data.args;
        var element = args[0];

        var serverId = element.id;
        if(serverId !== undefined) {
            serverId = serverId.toString();
        }

        var serverInfo = EVWEB2.util.internal.processServerDetails(element);
        var licenseInfo = EVWEB2.util.internal.processServerLicense(element);

        var customGroupPermissions;
        var userGroup, passthroughGroup;

        if (element.group !== undefined && element.group !== null) {
            var group = element.group;

            var groupPermissions = EVWEB2.util.internal.processUserGroupPermissions(group.permissions);

            customGroupPermissions = new EVWEB2.CustomGroupPermissions(group.cameras, group.audios,
                group.serials, group.softTriggers);
            userGroup = new EVWEB2.UserGroup(group.name, group.role, groupPermissions, group.priorities,
                group.guid, customGroupPermissions);

        }
        else {
            userGroup = EVWEB2.util.processServerPermissions(element);
        }

        if (!element.login){
            passthroughGroup = userGroup;
            userGroup = undefined;
        }

        var service = subscriptions[0].server.service;
        var sessionId = subscriptions[0].server.sessionId;
        var server = new EVWEB2.Server(service, element.name, serverId, element.login, element.restricted,
            sessionId, undefined, undefined, serverInfo, licenseInfo, userGroup, passthroughGroup);

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], server);
        }
    };

    /**
     * Internal callback for topic 'serverStatus'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onServerStatusChanged = function(subscriptions, data){
        var args = data.args;
        var status = args[0];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], status);
        }
    };

    /**
     * Internal callback for topic 'avgFrameSize'
     * @param {Array} subscriptions The list of available subscriptions for this topic.
     * @param {Object} data The data received for this topic.
     */
    var onAvgFrameSize = function(subscriptions, data){
        var args = data.args;
        var cameraId = args[0].toString();
        var frameSize = args[1];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraId, frameSize);
        }
    };

    var onH264Frame = function(subscriptions, data){
        var args = data.args;
        var cameraId = args[0].toString();
        var isIframe = args[1];
        var timestamp = EVWEB2.util.IETF2Date(args[2]);
        var flags = args[3];

        var frameData = data.blob;

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraId, frameData, isIframe, timestamp, flags);
        }
    };

    var onJPEGFrame = function(subscriptions, data){
        var args = data.args;
        var cameraId = args[0].toString();
        var timestamp = EVWEB2.util.IETF2Date(args[1]);
        var flags = args[2];
        var frameData = data.blob;

        //var view = new Uint8Array(frameData);
        var blob = new Blob([frameData], {type: 'image/jpeg'});

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], cameraId, blob, timestamp, flags);
        }
    };

    var onAccessControlDevicesUpdated = function(subscriptions, data){
        var server = subscriptions[0].server;
        var rawDevices = data.args[0];

        // Process the devices
        var devices = $.map(rawDevices, function(element) {
            return new EVWEB2.SecurityIntegrationsDevice(server, element.id, element.name, element.host, element.port,
                element.type, element.enabled, element.connectionStatus, element.firmware, element.serial,
                element.user, element.auth);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], devices);
        }

    };

    var onAccessControlSensorsUpdated = function(subscriptions, data){
        var deviceId = data.args[0];
        var rawSensors = data.args[1];

        // Process the sensors
        var sensors = $.map(rawSensors, function(element) {
            var timestamp = element.statusTimestamp ?
                EVWEB2.util.IETF2Date(element.statusTimestamp) : undefined;

            var persistedStatuses = element.persistedStatus ? element.persistedStatus.map(function(obj){
                obj.statusTimestamp = EVWEB2.util.IETF2Date(obj.statusTimestamp);
                return obj;
            }) : undefined;

            return new EVWEB2.SecurityIntegrationsDeviceSensor(undefined, element.sensorId, element.name, element.type,
                element.direction, element.availableActions, element.inputs, element.defaultActionTimeout,
                element.maxActionTimeout, element.status, element.alarm,
                timestamp, element.statusMessage, persistedStatuses);
        });

        for (var i = 0; i < subscriptions.length; ++i){
            // We do not have a reference to the device object for each sensor,
            // user is required to lookup the device object and set it themselves.
            subscriptions[i].externalCallback(subscriptions[i], deviceId, sensors);
        }
    };

    var onAccessControlSensorStatusChanged = function(subscriptions, data){
        var sensorStatusObj = data.args[0];
        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], sensorStatusObj);
        }
    };

    var onAccessControlDeviceConnectionChanged = function(subscriptions, data){
        var deviceId = data.args[0];
        var deviceStatus = data.args[1];

        for (var i = 0; i < subscriptions.length; ++i){
            subscriptions[i].externalCallback(subscriptions[i], deviceId, deviceStatus);
        }
    };


    var onAssociationsUpdated = function(subscriptions, data){
        var args = data.args;
        var associationsByCameraId = {};

        $.each(args[0], function(index, raw){
            // Process the associations
            var associationItems = $.map(raw.items, function(element) {
                return new EVWEB2.AssociationItem(element.id, element.type, element.position, element.statusOnly,
                    element.extra);
            });

            var fontInfo = new EVWEB2.FontInfo(raw.fontName, raw.fontSize, raw.fontStyle,
                raw.fontColor, raw.fontFamily, raw.fontWeight);

            var association = new EVWEB2.Association(subscriptions[0].server, undefined, raw.guid, associationItems,
                raw.label, raw.overlayStyle, raw.position, raw.backgroundColor,
                raw.opacity, fontInfo);

            associationsByCameraId[raw.cameraId] = association;
        });

        for (var i = 0; i < subscriptions.length; ++i){

            for(var key in associationsByCameraId){
                if (associationsByCameraId.hasOwnProperty(key)) {
                    var cameraId = parseInt(key, 10);
                    // We do not have a reference to the camera objects for each association,
                    // user is required to lookup the camera object and set it themselves.
                    subscriptions[i].externalCallback(subscriptions[i], cameraId, associationsByCameraId[cameraId]);
                }
            }
        }
    };

    /**
     * The internal callback functions associated with each topic.
     * @private
     * @type Object
     */
    var internalCallbacks = {
        'nvr.status.softtriggers': onSoftTriggerUpdated,
        'nvr.status.camera.motion': onMotionChanged,
        'nvr.status.camera.loss': onLossChanged,
        'nvr.config.users.active': onActiveUsersChanged,
        'nvr.status.camera.connection': onConnectionChanged,
        'nvr.status.device.connection': onConnectionChanged,
        'nvr.config.cameras': onCameraListChanged,
        'nvr.config.users': onUserListChanged,
        'nvr.config.userGroups': onUserGroupListChanged,
        'nvr.config.devices': onDeviceListChanged,
        'nvr.config.cameras.settings.osd': onCameraOsdChanged,
        'nvr.config.plugins': onPluginsChanged,
        'nvr.config.server': onServersUpdated,
        'nvr.status.server': onServerStatusChanged,
        'nvr.video.camera.{0}.stats.avg_frame_size': onAvgFrameSize,
        'nvr.video.camera.{0}.native': onH264Frame,
        'nvr.video.camera.{0}.jpeg': onJPEGFrame,
        'nvr.config.securityintegrations.devices': onAccessControlDevicesUpdated,
        'nvr.config.securityintegrations.sensors': onAccessControlSensorsUpdated,
        'nvr.status.securityintegrations.sensors': onAccessControlSensorStatusChanged,
        'nvr.status.securityintegrations.devices.connection': onAccessControlDeviceConnectionChanged,
        'nvr.config.associations': onAssociationsUpdated
    };

    /**
     * Pending subscribe request object, used to hold state in-between subscribe and server acknowledgement
     * @param {String} requestId The unique ID of the request.
     * @param {EVWEB2.Server} server The server associated with the request.
     * @param {String} topic The topic associated with the request.
     * @param {Function} internalCallback The internal callback function.
     * @param {Function} externalCallback The external callback function.
     * @param {$.Deferred} onReply The callback to call when a subscription is acknowledged
     * @param {Boolean} [acknowledge=false] Flag if the user wants the subscribe request acknowledged
     * @class
     * @this SubscribeRequest
     */
    var SubscribeRequest = function(requestId, server, topic, internalCallback, externalCallback, onReply,
                                    acknowledge) {
        /**
         * Unique request ID.
         * @type {String}
         */
        this.requestId = requestId;

        /**
         * Server instance associated with the request.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * Topic of the subscription request.
         * @type {String}
         */
        this.topic = topic;

        /**
         * The internal callback function.
         * @function
         */
        this.internalCallback = internalCallback;

        /**
         * The external callback function.
         * @function
         */
        this.externalCallback = externalCallback;

        /**
         * The callback to call when the subscription is successfully made/acknowledged.
         * @type {$.Deferred}
         */
        this.onReply = onReply;

        /**
         * Flag for if the subscription should be acknowledged once made.
         * @type {boolean}
         */
        this.acknowledge = false;

        // Assign constructor values
        if(acknowledge !== undefined){
            this.acknowledge = acknowledge;
        }
    };


    /**
     * The InternalSubscription is a placeholder for real subscriptions. It stores the internal callbacks
     * that pre-process the data before delivering the final published event (as EVWEB2 types).
     * @param {Function} handler The internal callback function called when an event is published to the topic
     * @param {String} topic The topic name associated with the internal callback
     * @private
     * @constructor
     * @this InternalSubscription
     */
    var InternalSubscription = function(handler, topic){
        /**
         * The internal callback function
         * @function
         */
        this.fn = handler;

        /**
         * The topic subscribed to
         * @type {String}
         */
        this.topic = topic;

        /**
         * The array of active subscriptions that are associated with this internal subscription
         * @type {EVWEB2.Subscription[]}
         */
        this.subscriptions = [];
    };


    /**
     * The Subscription object represents an active subscription.
     * @param {String} subscriptionId The unique ID of the subscription.
     * @param {EVWEB2.Server} server The server associated with the subscription.
     * @param {String} topic The topic associated with the subscription.
     * @param {function} externalCallback The external callback function
     * @class
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.Subscription = function(subscriptionId, server, topic, externalCallback) {
        /**
         * The unique ID of the subscription.
         * @type {String}
         */
        this.subscriptionId = '';

        /**
         * Server instance associated with the subscription.
         * @type {EVWEB2.Server}
         */
        this.server = null;

        /**
         * Topic of the subscription.
         * @type {String}
         */
        this.topic = '';

        /**
         * The external callback function.
         * @type {Function}
         */
        this.externalCallback = $.noop;

        /**
         * Flag that indicates the subscription state, an active subscription will receive publications
         * @type {boolean}
         */
        this.isActive = true;

        // Assign constructor values
        if(subscriptionId !== undefined) {
            this.subscriptionId = subscriptionId;
        }
        if(server !== undefined) {
            this.server = server;
        }
        if(topic !== undefined) {
            this.topic = topic;
        }
        if(externalCallback !== undefined) {
            this.externalCallback = externalCallback;
        }
    };

    /**
     * Generate a unique random id for protocol requests
     * @returns {String} The unique ID
     * @private
     */
    var generateId = function() {
        return uuid.v4();
    };

    /**
     * The available websocket handler states
     * @private
     * @enum {number}
     */
    var wsStates = {
        /**
         * Initializing
         */
        initializing: 0,
        /**
         * Connected
         */
        connected: 1,
        /**
         * Reconnecting
         */
        reconnecting: 2
    };

    /**
     * The WebsocketConfig object is a container for all configuration information related to the websocket connection.
     * @param {String} [host=''] The websocket host url
     * @param {Number} [port=0] The websocket port
     * @param {Number} [sslPort=0] The websocket SSL port (only valid if the service is configured to use SSL)
     * @class
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.WebsocketConfig = function(host, port, sslPort) {
        /**
         * The host url the websocket is configured to connect to
         * @type {string}
         */
        this.host = '';

        /**
         * The port the websocket is configured to connect to
         * @type {number}
         */
        this.port = 0;

        /**
         * The SSL port the websocket is configured to connect to
         * @type {number}
         */
        this.sslPort = 0;

        if (host !== undefined){
            var beginIdx = 0, endIdx = host.length;
            if (host.slice(0, 7) === "http://"){
                beginIdx = 7;
            }else if (host.slice(0, 8) === "https://"){
                beginIdx = 8;
            }
            if(host.slice(-1) === "/"){
                --endIdx;
            }

            this.host = host.slice(beginIdx, endIdx);

            if(this.host === '') {
                this.host = window.location.hostname;
            }
        }

        if (port !== undefined){
            this.port = port;
        }

        if (sslPort !== undefined){
            this.sslPort = sslPort;
        }

        /**
         * @returns {string} The formatted URL used to connect a WebSocket instance.
         */
        this.getUrl = function() {
            if (window.location.protocol === "https:") {
                return "wss://" + this.host + ":" + this.sslPort;
            } else {
                return "ws://" + this.host + ":" + this.port;
            }
        };
    };

    /**
     * Enum of type of connection events for websockets.
     * @enum {number}
     * @readonly
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.connectionEvent = {
        /**
         * Open
         */
        open: 0,
        /**
         * Timed out
         */
        timedOut: 1
    };

    /**
     * Enum values denoting state of the websocket connection
     * @enum {number}
     * @readonly
     */
    var readyStates = {
        connecting: 0,
        open: 1,
        closing: 2,
        closed: 3
    };

    /**
     * The WebSocketHandler object receives all websocket communication from the service end. It initiates a connection
     * and subscribes to incoming messages from the service. It then parses these messages to known
     * EVWEB2 types and publishes them.
     * @param {EVWEB2.Service} [service=null] The service instance.
     * @class
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.WebSocketHandler = function(service) {
        /**
         * Object to determine if legacy websockets are being used.
         * @type {Object}
         */
        this.isLegacy = false;

        /**
         * A reference to the service instance.
         * @type {EVWEB2.Service}
         */
        this.service = null;

        /**
         * The serializer to use when communicating with the service
         * @type {CompositeSerializer}
         */
        this.serializer = new EVWEB2.CompositeSerializer();

        var instance = this;

        /**
         * Pending subscription requests, indexed by request id
         * @private
         * @type {SubscribeRequest}
         */
        var pendingSubscribeRequests = {};

        /**
         * Active subscriptions, indexed by topic
         * @private
         * @type {EVWEB2.Subscription}
         */
        var activeSubscriptions = {};

        /**
         * Pending un-subscribe requests, indexed by request id
         * @private
         * @type {UnsubscribeRequest}
         */
        var pendingUnsubscribeRequests = {};

        /**
         * The WebSocket instance
         * @private
         * @type {WebSocket}
         */
        var sock = null;

        /**
         * The stored user callback to call when the websocket connection is open or timed out.
         * @private
         * @function
         */
        var onConnectionCallback = $.noop;

        /**
         * Flag indicating if we have already called the open callback so it isn't called twice
         * @type {boolean}
         */
        var onOpenCalled = false;

        /**
         * The current state of the websocket handler
         * @private
         * @type {wsStates}
         */
        var state = wsStates.initializing;

        /**
         * Cached websocket config
         * @type {EVWEB2.WebsocketConfig}
         */
        var wsConfig = null;

        /**
         * The slot time (discrete delay increments) to feed into exponential backoff algorithm
         * @type {number}
         */
        var reconnectSlotTime = 0.0125;

        /**
         * The number of reconnect attempts that have been made
         * @type {number}
         */
        var reconnectAttempts = 0;

        /**
         * constraint for the exponentiation term to give the desired max delay of ~10 seconds
         *
         * Follows the following formula
         *      (2^c-1)*reconnectSlotTime = DesiredMaxDelay
         *      c = ln((DesiredMaxDelay / reconnectSlotTime) + 1) / ln(2)
         *
         * NOTE: desired max delay expressed in ms for use with setTimeout
         * @private
         * @type {number}
         */
        var maxReconnectAttempts = 19.7;

        var timeoutHandle = null;
        /**
         * Boolean flag indicating if the set timeout was reached.
         * @type {Boolean}
         */
        var connectionTimeout = false;

        // Assign the values
        if(service !== undefined) {
            this.service = service;
        }

        /**
         * Re-subscribe/re-initialize the current set of subscriptions after a reconnect.
         */
        var resubscribe = function() {
            EVWEB2.log("Re-initializing currently active subscriptions");
            // clear active subscriptions
            var currentActive = $.extend(true, {}, activeSubscriptions);
            activeSubscriptions = {};

            // loop through active subscriptions and re-subscribe
            $.each(currentActive, function(topic, internalSubscription){
                $.each(internalSubscription.subscriptions, function(idx, subscription){
                    var requestId = generateId();
                    var onReply = $.Deferred();

                    // store the pending request
                    pendingSubscribeRequests[requestId] = new SubscribeRequest(requestId, subscription.server, topic,
                        internalSubscription.fn, subscription.externalCallback, onReply, true);

                    // send a subscribe protocol message to the server with the original subscription id
                    var header = new ProtocolHeader(requestId, topic, protocolMessageType.subscribe,
                        new ProtocolFlags(true, instance.serializer.isBinary));
                    var subscribeMsg = new SubscribeMessage(header, subscription.subscriptionId);
                    var payload = instance.serializer.serialize(subscribeMsg.marshal());

                    try {
                        sock.send(payload);
                    }catch(error){
                        EVWEB2.log("Error trying to resubscribe: " + error);
                        delete pendingSubscribeRequests[requestId];
                    }
                });
            });
        };

        /**
         * Callback for the 'onopen' event, fired when the websocket connection is established
         * @param {Event} e the websocket event
         * @private
         */
        var onOpen = function(e) {
            EVWEB2.log("WebsocketHandler::onOpen");

            if(!onOpenCalled){
                onConnectionCallback(EVWEB2.connectionEvent.open);
                onOpenCalled = true;
            }

            if(state === wsStates.reconnecting) {
                // reset
                reconnectAttempts = 0;
                resubscribe();
            }

            state = wsStates.connected;
        };

        /**
         * Callback for the 'onmessage' event, fired when the websocket receives a message
         * @param {Event} e the websocket event
         * @private
         */
        var onMessage = function(e) {
            var payload = e.data;
            var msg = instance.serializer.unserialize(payload);

            switch(msg.header.request) {
                case protocolMessageType.subscribed:
                    if(pendingSubscribeRequests[msg.header.rid] === undefined){
                        return;
                    }

                    var request = pendingSubscribeRequests[msg.header.rid];
                    delete pendingSubscribeRequests[msg.header.rid];

                    if (activeSubscriptions[msg.header.topic] === undefined) {
                        activeSubscriptions[msg.header.topic] = new InternalSubscription(request.internalCallback,
                                                                    msg.header.topic);
                    }

                    var subscription = new EVWEB2.Subscription(msg.payload.subscriptionId, request.server,
                                                            msg.header.topic, request.externalCallback);
                    activeSubscriptions[msg.header.topic].subscriptions.push(subscription);

                    // handle acknowledge
                    request.onReply.resolve(subscription);

                    break;
                case protocolMessageType.publish:
                    var internalSubscription = activeSubscriptions[msg.header.topic];

                    if (internalSubscription === undefined || internalSubscription.subscriptions.length === 0){
                        return;
                    }

                    internalSubscription.fn(internalSubscription.subscriptions, msg.payload.data);

                    break;
                case protocolMessageType.unsubscribed:
                    if(pendingUnsubscribeRequests[msg.header.rid] === undefined) {
                        return;
                    }

                    var unsubscribeRequest = pendingUnsubscribeRequests[msg.header.rid];
                    delete pendingUnsubscribeRequests[msg.header.rid];

                    unsubscribeRequest.subscription.isActive = false;
                    unsubscribeRequest.onAcknowledge.resolve(unsubscribeRequest.subscription);
                    break;
                default :
                    break;
            }

        };

        /**
         * Calculates the delay to use before attempting to reconnect
         * @returns {number} The calculated delay
         * @private
         */
        var calculateNextReconnectDelay = function() {
            // exponential backoff with max threshold
            // wait between [0, 2^c-1) slot times
            // first attempt 0 or 1 slots, second attempt 0-3 slots, etc
            var exponent = Math.min(reconnectAttempts, maxReconnectAttempts);
            var maxSlots = Math.pow(2, exponent) - 1;

            return Math.floor((Math.random() * maxSlots)) * reconnectSlotTime;
        };

        var onError = function(e) {
            // not used by sockjs
            EVWEB2.log("WebsocketHandler::onError: " + e.reason);
        };
		
		// Forward  declaring due to circular dependencies
		var onClose;
		
		/**
         * Initialize and bind a WebSocket connection
         * @private
         * @param {EVWEB2.WebsocketConfig} config The websocket configuration
         */
        var initSock = function(config) {
            var url = config.getUrl();
            EVWEB2.log("Initializing WebSocket: " + url);
            sock = new WebSocket(url);
            // bind the callbacks
            sock.onopen = onOpen;
            sock.onmessage = onMessage;
            sock.onclose = onClose;
            sock.onerror = onError;
            sock.binaryType = "arraybuffer";
        };
		
        /**
         * Callback for the 'onmclose' event, fired when the websocket connection is lost (or could not be established)
         * @param {Event} e the websocket event
         * @private
         */
        onClose = function(e) {
            EVWEB2.log("WebsocketHandler::onClose: reason=" + e.reason + ", code=" + e.code +
                ", wasClean=" + e.wasClean);

            // switch states and attempt reconnection with exponential backoff
            state = wsStates.reconnecting;

            if(connectionTimeout) {
                return;
            }

            var nextReconnectAttempt = calculateNextReconnectDelay();
            EVWEB2.log("Reconnect attempts: " + reconnectAttempts + ", reconnecting in " + nextReconnectAttempt);

            reconnectAttempts += 1;
            timeoutHandle = setTimeout(function() {
                initSock(wsConfig);
            }, nextReconnectAttempt);
        };

        /**
         * Retrieve the websocket configuration information
         * @param {Function} callback The callback function to call when the response completes. The callback is passed
         * an {@link EVWEB2.ResponseStatus} instance with the details of the response and (on success) an instance of
         * {@link EVWEB2.WebsocketConfig}.
         */
        this.getConfig = function(callback) {
            if(typeof callback !== 'function') {
                throw new Error('Callback required');
            }
            var websocket = this;

            var onGetConfigError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetConfigSuccess = function(data /*, textStatus, xhr*/){
                var successResponse = new EVWEB2.ResponseStatus(data.success, data.errorText);

                var hostUrl = websocket.service.hostUrl;
                if(hostUrl.substr(hostUrl.length - 1) !== "/"){
                    hostUrl = hostUrl.slice(0, hostUrl.length - 1);
                }
                var websocketConfig = new EVWEB2.WebsocketConfig(hostUrl, data.port, data.sslPort);

                callback(successResponse, websocketConfig);
            };

            var settings = {
                success: onGetConfigSuccess,
                error: onGetConfigError,
                url: websocket.service.url() + EVWEB2.urls.brokerConfig,
                data: {}
            };

            if(websocket.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, websocket.service);
            }

            $.ajax(settings);
        };

        var onConnectionTimeout = function() {
            if(sock !== undefined && sock.readyState === readyStates.connecting) {
                connectionTimeout = true;
                if(timeoutHandle !== null) {
                    clearTimeout(timeoutHandle);
                    timeoutHandle = null;
                }
                onConnectionCallback(EVWEB2.connectionEvent.timedOut);
            }
        };

        /**
         * This method initiates a websocket connection with the WebSocket server.
         * @param {Function} callback Callback function to be executed when the call completes.
         * @param {EVWEB2.WebsocketConfig} config The configuration information for the websocket connection
         * @param {Number} [timeout] Number of milliseconds to wait for websocket connection to be opened
         */
        this.init = function(callback, config, timeout) {
            if(typeof callback === 'function') {
                onConnectionCallback = callback;
            }
            if(timeout !== undefined) {
                setTimeout(onConnectionTimeout, timeout);
            }

            wsConfig = config;
            initSock(wsConfig);
        };

        /**
         * Subscribes to websocket messages and routes the event payload to the appropriate callbacks.
         * @param {EVWEB2.pubSubTopic} topic The topic to subscribe to.
         * @param {EVWEB2.Server} server The server associated with the subscription.
         * @param {Function} handler The callback responsible for handling events published to the given topic
         * @param {Object} [options] Additional available options.
         * @param {Array} [ids=[]] ids is an array of either EVWEB2 types or strings. The ids required by a topic
         * are documented as part of each {@link EVWEB2.pubSubTopic} topic.
         * @returns {Promise<EVWEB2.Subscription, EVWEB2.ResponseStatus>} A promise that returns the new subscription
         * instance to the caller when resolved, or an {@link EVWEB2.ResponseStatus} instance when rejected.
         */
        this.subscribe = function(topic, server, handler, options, ids) {
            var websocket = this;

            var onReply = $.Deferred();
            var response;
            if (sock === null){
                response = new EVWEB2.ResponseStatus(false,
                    "WebSocket support is not enabled.", EVWEB2.websocketErrorCodes.disabled);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            if (state === wsStates.reconnecting){
                response = new EVWEB2.ResponseStatus(false,
                    "Subscribe failed. Connection lost.", EVWEB2.websocketErrorCodes.connectionLost);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            if(topic === undefined) {
                response = new EVWEB2.ResponseStatus(false,
                        "Trying to subscribe to unknown EVWEB2.pubSubTopic: " + topic,
                        EVWEB2.websocketErrorCodes.unknownTopic);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            if (!server.isPassthroughServer() && !server.isLoggedIn()){
                response = new EVWEB2.ResponseStatus(false,
                    "Subscribe failed. Server login required.", EVWEB2.websocketErrorCodes.loginRequired);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            var topicName = topic.rawTopicStr;
            var internalCallback = internalCallbacks[topicName];
            
            // Convert to a protocol message
            var requestId = generateId();
            var sessionTopic = topicName + '.' + server.sessionId;
            if(ids !== undefined && ids.length > 0) {
                sessionTopic = formatTopic(topic, ids) + '.' + server.sessionId;
            }

            
            var acknowledge = false;
            if (options !== undefined) {
                acknowledge = options.acknowledge === undefined ? false : options.acknowledge;
            }

            // store the subscribe request
            pendingSubscribeRequests[requestId] = new SubscribeRequest(requestId, server, sessionTopic,
                internalCallback, handler, onReply, acknowledge);

            var flags = new ProtocolFlags(acknowledge, websocket.serializer.isBinary);
            var header = new ProtocolHeader(requestId, sessionTopic, protocolMessageType.subscribe, flags);
            var subscribeMsg = new SubscribeMessage(header);
            var payload = websocket.serializer.serialize(subscribeMsg.marshal());

            try {
                sock.send(payload);
            } catch(e){
                EVWEB2.log("subscribe failed: " + e.message);
                response = new EVWEB2.ResponseStatus(false,
                    "Subscribe failed. Unable to send server request.", EVWEB2.websocketErrorCodes.sendFailed);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            // return a deferred that will be resolved when the subscription is made
            return onReply.promise();
        };

        /**
         * This method is used to unsubscribe from an existing subscription.
         * @param {EVWEB2.Subscription} subscription An existing subscription instance
         * @param {Boolean} [acknowledge=true] A flag indicating if acknowledgement is requested when
         * the request completes
         * @returns {Promise<EVWEB2.Subscription, EVWEB2.ResponseStatus>} A promise that returns the subscription
         * instance (now inactive) back to the caller when resolved, or an {@link EVWEB2.ResponseStatus} instance
         * if rejected.
         */
        this.unsubscribe = function(subscription, acknowledge) {
            if(acknowledge === undefined) {
                acknowledge = true;
            }
            var onUnsubscribed = $.Deferred();

            var internalSubscription = activeSubscriptions[subscription.topic];
            var response;
            if (internalSubscription === undefined){
                response = new EVWEB2.ResponseStatus(false,
                    "unsubscribe failed, no active subscriptions found for topic: " + subscription.topic,
                    EVWEB2.websocketErrorCodes.unknownTopic);
                onUnsubscribed.reject(response);
                return onUnsubscribed.promise();
            }

            if (state === wsStates.reconnecting){
                response = new EVWEB2.ResponseStatus(false,
                    "unsubscribe failed, not connected", EVWEB2.websocketErrorCodes.connectionLost);
                onUnsubscribed.reject(response);
                return onUnsubscribed.promise();
            }


            var index = -1;

            var sub = $.grep(internalSubscription.subscriptions, function(elem, i){
               if(elem.subscriptionId === subscription.subscriptionId) {
                    index = i;
                    return true;
               }
            });

            if(sub.length === 0) {
                response = new EVWEB2.ResponseStatus(false,
                    "unsubscribe failed, unknown subscription ID: " + subscription.subscriptionId,
                    EVWEB2.websocketErrorCodes.unknownSubscription);
                onUnsubscribed.reject(response);
                return onUnsubscribed.promise();
            }

            // remove the subscription from the active subscriptions
            internalSubscription.subscriptions.splice(index, 1);

            if(internalSubscription.subscriptions.length === 0) {
                // last subscription to this topic, completely unsubscribe from the server
                var requestId = generateId();
                var flags = new ProtocolFlags(acknowledge, instance.serializer.isBinary);
                var header = new ProtocolHeader(requestId, internalSubscription.topic,
                    protocolMessageType.unsubscribe, flags);
                var unsubscribeMsg = new UnsubscribeMessage(header, subscription.subscriptionId);
                var payload = instance.serializer.serialize(unsubscribeMsg.marshal());

                try{
                    sock.send(payload);
                }catch(e){
                    EVWEB2.log("unsubscribe failed: " + e.message);
                    response = new EVWEB2.ResponseStatus(false,
                        "unsubscribe failed, unable to send server request", EVWEB2.websocketErrorCodes.sendFailed);
                    onUnsubscribed.reject(response);
                    return onUnsubscribed.promise();
                }

                delete activeSubscriptions[subscription.topic];

                pendingUnsubscribeRequests[requestId] = new UnsubscribeRequest(subscription, onUnsubscribed);
            }
            else {
                subscription.isActive = false;
                onUnsubscribed.resolve(subscription);
            }

            return onUnsubscribed.promise();
        };
    };
}());

/*globals EVWEB2:true, uuid:true*/
(function() {
    "use strict";

    /**
     * Definitions of all legacy handling functions.  Each function performs the traditional polling method
     * and formats the response into the web sockets response signature.
     * @internal
     */
    var legacyHandlers = {};
    legacyHandlers[EVWEB2.pubSubTopic.server.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, servers) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                legacyHandlers[topic].data = servers;

                var targetServer = $.grep(servers, function (element) {
                    return element.id === subscription.server.id;
                })[0];

                if (targetServer === undefined) {
                    EVWEB2.log('Target server removed from list:', topic, response);
                }

                subscription.externalCallback(subscription, targetServer);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                // Use the cached data for the response
                onCallback(new EVWEB2.ResponseStatus(true), legacyHandlers[topic].data);
                return;
            }
            subscription.server.service.getServers(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.serverStatus.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, status) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push(status);
                subscription.externalCallback(subscription, status.serverStatus);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                // See if the cached data is available
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data);
                    return;
                }
            }
            if(!subscription.server.isLoggedIn() && !subscription.server.isPassthroughServer()) {
                // We'll just be making an empty request
                callback();
                return;
            }
            subscription.server.getServerStatus(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.devices.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, devices) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Update the devices' servers
                $.each(devices, function(index, element) {
                    element.server = subscription.server;
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    devices: devices
                });

                subscription.externalCallback(subscription, devices);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.devices);
                    return;
                }
            }
            subscription.server.configuration.getDevicesConfiguration(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.cameraOsd.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, cameras) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                var osdInfos = $.map(cameras, function(element){
                    var osdInfo = EVWEB2.util.internal.formatOsdInfo(element.osdInfo);
                    return {
                        osdInfo: osdInfo,
                        cameraId: element.cameraId
                    };
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    osdInfos: osdInfos
                });
                subscription.externalCallback(subscription, osdInfos);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var cachedData = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (cachedData !== undefined) {
                    // Use the cached data for the response
                    subscription.externalCallback(subscription, cachedData.osdInfos);
                    callback();
                    return;
                }
            }

            var onGetCamerasOsdSuccess = function(data) {
                onCallback(new EVWEB2.ResponseStatus(true), data.camera);
            };

            var onGetCamerasOsdError = function(/*xhr, textStatus, errorThrown*/) {
                onCallback(new EVWEB2.ResponseStatus(false));
            };

            var params = {
                s: subscription.server.sessionId
            };
            var settings = {
                success: onGetCamerasOsdSuccess,
                error: onGetCamerasOsdError,
                url: subscription.server.service.url() + EVWEB2.urls.legacyWebsocketCamerasOsd,
                data: params,
                type: 'GET'
            };
            $.ajax(settings);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.users.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, users) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Update the users' servers
                $.each(users, function(index, element) {
                    element.server = subscription.server;
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    users: users
                });

                subscription.externalCallback(subscription, users);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.users);
                    return;
                }
            }
            subscription.server.getUsers(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.userGroups.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, groups) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    groups: groups
                });

                subscription.externalCallback(subscription, groups);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.groups);
                    return;
                }
            }
            subscription.server.getUserGroups(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.cameras.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, cameras) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Update the cameras' servers
                $.each(cameras, function(index, element) {
                    element.server = subscription.server;
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    cameras: cameras
                });

                subscription.externalCallback(subscription, cameras);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.cameras);
                    return;
                }
            }
            subscription.server.getCameras(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.activeUsers.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, usageInfo) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    usageInfo: usageInfo
                });
                subscription.externalCallback(subscription, usageInfo);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.usageInfo);
                    return;
                }
            }
            subscription.server.getSystemUsageInfo(onCallback);
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.triggers.rawTopicStr] = {
        data: [],
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            // Triggers expects updates of individual triggers that have changed state.
            // As such, store the entire trigger list and notify only on those that
            // have changed.
            var onCallback = function (response, newTriggers) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }
                var store = legacyHandlers[topic].store;
                var sourceTriggersStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if(sourceTriggersStore === undefined) {
                    sourceTriggersStore = {
                        server: subscription.server,
                        triggers: newTriggers
                    };
                    store.push(sourceTriggersStore);
                }

                var updatedTriggers = $.grep(newTriggers, function(element) {
                    var origTrigger = $.grep(sourceTriggersStore.triggers, function(el) {
                        return el.id === element.id;
                    })[0];
                    if(origTrigger === undefined || origTrigger.state !== element.state
                        || origTrigger.name !== element.name) {
                        return element;
                    }
                });
                sourceTriggersStore.triggers = newTriggers;

                $.each(updatedTriggers, function(index, element) {
                    subscription.externalCallback(subscription, element);
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    triggers: updatedTriggers
                });
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    $.each(data.triggers, function(index, element) {
                        subscription.externalCallback(subscription, element);
                    });
                    callback();
                    return;
                }
            }
            EVWEB2.getTriggers(onCallback, subscription.server);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.motion.rawTopicStr] = {
        data: [],
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            // Motion expects updates of individual cameras that have changed state.
            // As such, store the entire camera status list and notify only on those that
            // have changed.
            var onCallback = function (response, newCameras) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }
                var store = legacyHandlers[topic].store;
                var sourceCamerasStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if(sourceCamerasStore === undefined) {
                    sourceCamerasStore = {
                        server: subscription.server,
                        cameras: newCameras
                    };
                    store.push(sourceCamerasStore);
                }

                var updatedCameras = $.grep(newCameras, function(element) {
                    var origCamera = $.grep(sourceCamerasStore.cameras, function(el) {
                        return el.id === element.id;
                    })[0];
                    if(origCamera === undefined || origCamera.status.motion !== element.status.motion) {
                        return element;
                    }
                });
                sourceCamerasStore.cameras = newCameras;

                $.each(updatedCameras, function(index, element) {
                    subscription.externalCallback(subscription, element.id, element.status.motion);
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    cameras: newCameras
                });

                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var cachedData = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (cachedData !== undefined) {
                    // Use the cached data for the response
                    $.each(cachedData.cameras, function(index, element) {
                        subscription.externalCallback(subscription, element.id, element.status.motion);
                    });
                    callback();
                    return;
                }
            }

            var onGetStatusSuccess = function(data) {
                onCallback(new EVWEB2.ResponseStatus(true), data.camera);
            };

            var onGetStatusError = function(/*xhr, textStatus, errorThrown*/) {
                onCallback(new EVWEB2.ResponseStatus(false));
            };

            var params = {
                s: subscription.server.sessionId
            };
            var settings = {
                success: onGetStatusSuccess,
                error: onGetStatusError,
                url: subscription.server.service.url() + EVWEB2.urls.legacyWebsocketStatus,
                data: params,
                type: 'GET'
            };
            $.ajax(settings);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.loss.rawTopicStr] = {
        data: [],
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            // Loss expects updates of individual cameras that have changed state.
            // As such, store the entire camera status list and notify only on those that
            // have changed.
            var onCallback = function (response, newCameras) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }
                var store = legacyHandlers[topic].store;
                var sourceCamerasStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if(sourceCamerasStore === undefined) {
                    sourceCamerasStore = {
                        server: subscription.server,
                        cameras: newCameras
                    };
                    store.push(sourceCamerasStore);
                }

                var updatedCameras = $.grep(newCameras, function(element) {
                    var origCamera = $.grep(sourceCamerasStore.cameras, function(el) {
                        return el.id === element.id;
                    })[0];
                    if(origCamera === undefined || origCamera.status.loss !== element.status.loss) {
                        return element;
                    }
                });
                sourceCamerasStore.cameras = newCameras;

                $.each(updatedCameras, function(index, element) {
                    subscription.externalCallback(subscription, element.id, element.status.loss);
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    cameras: newCameras
                });

                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var cachedData = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (cachedData !== undefined) {
                    // Use the cached data for the response
                    $.each(cachedData.cameras, function(index, element) {
                        subscription.externalCallback(subscription, element.id, element.status.loss);
                    });
                    callback();
                    return;
                }
            }

            var onGetStatusSuccess = function(data) {
                onCallback(new EVWEB2.ResponseStatus(true), data.camera);
            };

            var onGetStatusError = function(/*xhr, textStatus, errorThrown*/) {
                onCallback(new EVWEB2.ResponseStatus(false));
            };

            var params = {
                s: subscription.server.sessionId
            };
            var settings = {
                success: onGetStatusSuccess,
                error: onGetStatusError,
                url: subscription.server.service.url() + EVWEB2.urls.legacyWebsocketStatus,
                data: params,
                type: 'GET'
            };
            $.ajax(settings);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.plugins.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, pluginsList) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    pluginsList: pluginsList
                });
                subscription.externalCallback(subscription, pluginsList);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.pluginsList);
                    return;
                }
            }
            subscription.server.getSystemPluginInfo(onCallback);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.deviceConnection.rawTopicStr] = {
        data: [],
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            // deviceConnection expects updates of individual devices that have changed state.
            // As such, store the entire devices list and notify only on those that
            // have changed.
            var onCallback = function (response, newDevices) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                var store = legacyHandlers[topic].store;
                var sourceDevicesStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if(sourceDevicesStore === undefined) {
                    sourceDevicesStore = {
                        server: subscription.server,
                        devices: newDevices
                    };
                    store.push(sourceDevicesStore);
                }
                var updatedDevices = $.grep(newDevices, function(element) {
                    var origDevice = $.grep(sourceDevicesStore.devices, function(el) {
                        return el.id === element.id;
                    })[0];
                    if(origDevice === undefined || origDevice.connectionStatus !== element.connectionStatus) {
                        return element;
                    }
                });
                sourceDevicesStore.devices = newDevices;

                $.each(updatedDevices, function(index, element) {
                    subscription.externalCallback(subscription, element.id, element.connectionStatus);
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    devices: updatedDevices
                });
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    $.each(data.devices, function(index, element) {
                        subscription.externalCallback(subscription, element.id, element.connectionStatus);
                    });
                    callback();
                    return;
                }
            }
            subscription.server.configuration.getDevicesConfiguration(onCallback);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.cameraConnection.rawTopicStr] = {
        data: [],
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            // cameraConnection expects updates of individual devices that have changed state.
            // As such, store the entire devices list and notify only on those that
            // have changed.
            var onCallback = function (response, newCameras) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                var store = legacyHandlers[topic].store;
                var sourceCamerasStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if(sourceCamerasStore === undefined) {
                    sourceCamerasStore = {
                        server: subscription.server,
                        cameras: newCameras
                    };
                    store.push(sourceCamerasStore);
                }
                var updatedCameras = $.grep(newCameras, function(element) {
                    var origCamera = $.grep(sourceCamerasStore.cameras, function(el) {
                        return el.id === element.id;
                    })[0];
                    if(origCamera === undefined || origCamera.connectionStatus !== element.connectionStatus) {
                        return element;
                    }
                });
                sourceCamerasStore.cameras = newCameras;

                $.each(updatedCameras, function(index, element) {
                    subscription.externalCallback(subscription, element.id, element.connectionStatus);
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    cameras: updatedCameras
                });
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    $.each(data.cameras, function(index, element) {
                        subscription.externalCallback(subscription, element.id, element.connectionStatus);
                    });
                    callback();
                    return;
                }
            }
            subscription.server.configuration.getDevicesConfiguration(onCallback);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.avgFrameSize.rawTopicStr] = {
        fn: function (callback, subscription, topic, options, ids) {
            var camera = ids[0];

            var onCallback = function (response, frameSize) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();

                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }
                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    cameraId: camera.id,
                    frameSize: frameSize
                });
                subscription.externalCallback(subscription, camera.id, frameSize);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id && element.cameraId === camera.id;
                })[0];
                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.frameSize, data.cameraId);
                    return;
                }
            }
            camera.config.getAverageFrameSize(onCallback);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr] = {
        store: [],
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, devices) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                var store = legacyHandlers[topic].store;
                var deviceStore = $.grep(store, function(element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if(deviceStore === undefined) {
                    deviceStore = {
                        server: subscription.server,
                        devices: devices
                    };
                    store.push(deviceStore);
                } else{
                    // update the device list
                    deviceStore.devices = devices;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }

                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    devices: devices
                });

                subscription.externalCallback(subscription, devices);
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.devices);
                    return;
                }
            }
            subscription.server.getSecurityIntegrationsDevices(onCallback);
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationSensors.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, sensors) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }

                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    sensors: sensors
                });

                if (sensors.length > 0){
                    var deviceId = sensors[0].device.id;
                    subscription.externalCallback(subscription, deviceId, sensors);
                }
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.sensors);
                    return;
                }
            }

            var onGetDevices = function(response, devices){
                if (!response.success){
                    callback();
                    return;
                }

                $.each(devices, function(index, element) {
                    element.getSensors(onCallback);
                });
            };

            // attempt to use cached devices
            var deviceStore = $.grep(legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,
                function(element){
                    return element.server.id === subscription.server.id;
                })[0];

            if (deviceStore === undefined){
                subscription.server.getSecurityIntegrationsDevices(onGetDevices);
            }else{
                var response = new EVWEB2.ResponseStatus(true);
                onGetDevices(response, deviceStore.devices);
            }
        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationSensorStatus.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, sensors) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }

                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    sensors: sensors
                });

                var statusObjects = $.map(sensors, function(obj){
                    return {
                        server: subscription.server,
                        deviceId: obj.device.id,
                        sensorId: obj.id,
                        status: obj.status,
                        alarm: obj.alarm,
                        statusMessage: obj.statusMessage,
                        statusTimestamp: EVWEB2.util.Date2IETF(obj.statusTimestamp)
                    };
                });

                // Call external callback with each statusObj
                $.each(statusObjects, function(index, element){
                    subscription.externalCallback(subscription, element);
                });

                callback();
            };

            // attempt to use cached data
            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.sensors);
                    return;
                }
            }

            // make the request(s)
            var onGetDevices = function(response, devices){
                if (!response.success){
                    callback();
                    return;
                }

                $.each(devices, function(index, element) {
                    element.getSensors(onCallback);
                });
            };

            // attempt to use cached devices
            var deviceStore = $.grep(legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,
                function(element){
                    return element.server.id === subscription.server.id;
                })[0];

            if (deviceStore === undefined){
                subscription.server.getSecurityIntegrationsDevices(onGetDevices);
            }else{
                var response = new EVWEB2.ResponseStatus(true);
                onGetDevices(response, deviceStore.devices);
            }

        }
    };

    legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationDeviceConnection.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {
            var onCallback = function (response, devices) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }

                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    devices: devices
                });

                // Call external callback with each device connections status
                $.each(devices, function(index, element){
                    subscription.externalCallback(subscription, element.id, element.connectionStatus);
                });

                callback();
            };

            // attempt to use cached data
            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if (data !== undefined) {
                    // Use the cached data for the response
                    onCallback(new EVWEB2.ResponseStatus(true), data.devices);
                    return;
                }
            }

            // attempt to use cached devices
            var deviceStore = $.grep(legacyHandlers[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,
                function(element){
                    return element.server.id === subscription.server.id;
                })[0];

            if (deviceStore === undefined){
                subscription.server.getSecurityIntegrationsDevices(onCallback);
            }else{
                var response = new EVWEB2.ResponseStatus(true);
                onCallback(response, deviceStore.devices);
            }
        }
    };
    legacyHandlers[EVWEB2.pubSubTopic.associations.rawTopicStr] = {
        fn: function (callback, subscription, topic/*, options, ids*/) {

            var triggerExternalCallback = function(associationsByCameraId){
                for(var key in associationsByCameraId){
                    if (associationsByCameraId.hasOwnProperty(key)) {
                        var cameraId = parseInt(key, 10);
                        subscription.externalCallback(subscription, cameraId, associationsByCameraId[cameraId]);
                    }
                }
            };

            var onCallback = function (response, associations) {
                if (!response.success) {
                    EVWEB2.log('Legacy subscription failed:', topic, response);
                    callback();
                    return;
                }

                var associationsByCameraId = {};
                $.each(associations, function(index, raw){
                    // Process the associations
                    var associationItems = $.map(raw.items, function(element) {
                        return new EVWEB2.AssociationItem(element.id, element.type, element.position,
                            element.statusOnly, element.extra);
                    });

                    var fontInfo = new EVWEB2.FontInfo(raw.fontName, raw.fontSize, raw.fontStyle,
                        raw.fontColor, raw.fontFamily, raw.fontWeight);

                    var association = new EVWEB2.Association(subscription.server, undefined, raw.guid, associationItems,
                        raw.label, raw.overlayStyle, raw.position, raw.backgroundColor,
                        raw.opacity, fontInfo);

                    associationsByCameraId[raw.cameraId] = association;
                });

                // Set the cached data
                if (legacyHandlers[topic].data === undefined) {
                    legacyHandlers[topic].data = [];
                }

                legacyHandlers[topic].data.push({
                    server: subscription.server,
                    associationsByCameraId: associationsByCameraId
                });

                triggerExternalCallback(associationsByCameraId);

                // call external callback
                callback();
            };

            if (legacyHandlers[topic].data !== undefined) {
                var data = $.grep(legacyHandlers[topic].data, function (element) {
                    return element.server.id === subscription.server.id;
                })[0];

                if (data !== undefined) {
                    // Use the cached data for the response
                    triggerExternalCallback(data.associationsByCameraId);
                    callback();
                    return;
                }
            }

            var onGetAssociationsSuccess = function(data) {
                onCallback(new EVWEB2.ResponseStatus(true), data.associations);
            };

            var onGetAssociationsError = function(/*xhr, textStatus, errorThrown*/) {
                onCallback(new EVWEB2.ResponseStatus(false));
            };

            // make request
            var params = {
                s: subscription.server.sessionId
            };
            var settings = {
                success: onGetAssociationsSuccess,
                error: onGetAssociationsError,
                url: subscription.server.service.url() + EVWEB2.urls.associations,
                data: params,
                type: 'GET'
            };
            $.ajax(settings);
        }
    };

    /**
     * Helper method to replace the the topic string with the item ids.
     * @param {String} string The topic string.
     * @param {Array} args an array of item ids.
     * @returns {String} The topic string with the item IDs
     * @internal
     */
    var formatString = function(string, args) {
        var result = string;
        var i = args.length;

        while (i--) {
            result = result.replace(new RegExp('\\{' + i + '\\}', 'gm'), args[i]);
        }
        return result;
    };

    /**
     * Format the session Id topic with the item ids passed.
     * @param {String} topic The topic string.
     * @param {Array} ids An array of either EVWEB2 types or strings.
     * @returns {String} The session ID topic with item IDs
     * @internal
     */
    var formatTopic = function(topic, ids) {
        var formatStr = topic.rawTopicStr;
        var requiredTypes = topic.idTypes;
        var formattedIds = [];

        var instanceOfAny = function(obj, types) {
            for (var i=0; i < types.length; ++i){
                if (obj instanceof types[i]){
                    return true;
                }
            }
            return false;
        };

        var getId = function(obj){
            if (instanceOfAny(obj, [EVWEB2.Camera, EVWEB2.DeviceConfig, EVWEB2.Trigger])) {
                return obj.id;
            }
            // default case
            return obj.toString();
        };

        for(var i = 0; i < requiredTypes.length; ++i){
            formattedIds.push(getId(ids[i]));
        }

        return formatString(formatStr, formattedIds);
    };


    /**
     * The LegacyWebSocketHandler object mimics the behavior of {@link EVWEB2.WebSocketHandler}
     * using the traditional polling mechanisms found in the API.  It is loaded dynamically to override
     * the web socket implementation if the browser doesn't support web sockets or binary data parsing
     * functionality.
     * @param {EVWEB2.Service} [service=null] The service instance.
     * @class
     * @deprecated Web Socket functionality has been removed from the web API in 9.6.0.
     * @category Service
     */
    EVWEB2.LegacyWebSocketHandler = function (service) {
        /**
         * Object to determine if legacy websockets are being used.
         * @type {Object}
         */
        this.isLegacy = true;

        /**
         * A reference to the service instance.
         * @type {EVWEB2.Service}
         */
        this.service = null;

        /**
         * The interval for calling {@link legacyPoll}.
         * @type {Number|null}
         */
        var pollTimeout = null;

        /**
         * Interval duration (in ms) of the interval for calling {@link legacyPoll}.
         * @private
         * @type {number}
         */
        var pollTimeoutValue = 3000;

        /**
         * List of active subscriptions.
         * @private
         * @type {Array}
         */
        var subscriptions = [];

        // Assign the values
        if (service !== undefined) {
            this.service = service;
        }

        /**
         * Generate a unique random id for protocol requests
         * @private
         * @returns {String} Unique random ID
         */
        var generateId = function() {
            return uuid.v4();
        };

        /**
         * Calls the legacy handler function for each subscription.
         * @private
         */
        var legacyPoll = function () {
            // Reset any legacyHandlers data
            var topicStr;
            for (topicStr in legacyHandlers) {
                if (legacyHandlers.hasOwnProperty(topicStr) && legacyHandlers[topicStr].data !== undefined) {
                    delete legacyHandlers[topicStr].data;
                }
            }

            var index = 0;
            var onComplete = function () {
                var subscriptionInfo = subscriptions[index];
                if (subscriptionInfo === undefined) {
                    clearTimeout(pollTimeout);
                    // We're at the end of the chain
                    pollTimeout = setTimeout(legacyPoll, pollTimeoutValue);
                    return;
                }

                var subscription = subscriptionInfo.subscription;
                var targetHandler = legacyHandlers[subscriptionInfo.topic];
                index++;
                // Perform the subscription poll
                if (targetHandler === undefined) {
                    // Continue the execution chain
                    onComplete();
                }
                else {
                    targetHandler.fn(onComplete, subscription, subscriptionInfo.topic, subscriptionInfo.options,
                        subscriptionInfo.ids);
                }
            };

            // Start the subscription chain
            onComplete();
        };

        /**
         * Retrieve the websocket configuration information.
         * @param {Function} callback The callback function to call when the response completes. The callback is passed
         * an {@link EVWEB2.ResponseStatus} instance with the details of the response and (on success) an instance of
         * {@link EVWEB2.WebsocketConfig}.
         */
        this.getConfig = function (callback) {
            if (typeof callback !== 'function') {
                throw new Error('Callback required');
            }
            var websocket = this;

            var onGetConfigError = function (/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, 'An error occurred.');
                callback(errorResponse);
            };

            var onGetConfigSuccess = function (data /*, textStatus, xhr*/) {
                var successResponse = new EVWEB2.ResponseStatus(data.success, data.errorText);

                var hostUrl = websocket.service.hostUrl;
                if (hostUrl.substr(hostUrl.length - 1) !== "/") {
                    hostUrl = hostUrl.slice(0, hostUrl.length - 1);
                }
                var websocketConfig = new EVWEB2.WebsocketConfig(hostUrl, data.port);

                callback(successResponse, websocketConfig);
            };

            var settings = {
                success: onGetConfigSuccess,
                error: onGetConfigError,
                url: websocket.service.url() + EVWEB2.urls.brokerConfig,
                data: {}
            };

            if (websocket.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, websocket.service);
            }

            $.ajax(settings);
        };

        /**
         * This method initiates a websocket connection with the server.
         * @param {Function} callback Callback function to be executed when the call completes.
         * @param {EVWEB2.WebsocketConfig} config The configuration information for the websocket connection
         * @param {Number} timeout Number of milliseconds to wait for websocket connection to be opened
         */
        this.init = function (callback/*, config, timeout*/) {
            // Do nothing
            callback();
        };

        /**
         * Fakes subscribing to websocket messages by individually polling for content and routes the event payload
         * to the appropriate callbacks.
         * @private
         * @param {EVWEB2.pubSubTopic} topic The topic to subscribe to.
         * @param {EVWEB2.Server} server The server associated with the subscription.
         * @param {Function} handler The callback responsible for handling events published to the given topic
         * @param {Object} [options] Additional available options.
         * @param {Array} [ids=[]] ids is an array of either EVWEB2 types or strings. The ids required by a topic
         * are documented as part of each {@link EVWEB2.pubSubTopic} topic.
         * @returns {Promise<EVWEB2.Subscription, EVWEB2.ResponseStatus>} A promise that returns the new subscription
         * instance to the caller when resolved, or an {@link EVWEB2.ResponseStatus} instance when rejected.
         */
        this.subscribe = function (topic, server, handler, options, ids) {
            var onReply = $.Deferred();
            var response;

            if (topic === undefined) {
                response = new EVWEB2.ResponseStatus(false,
                    "Trying to subscribe to unknown EVWEB2.pubSubTopic: " + topic,
                    EVWEB2.websocketErrorCodes.unknownTopic);
                onReply.reject(response, topic, server, handler);
                return onReply.promise();
            }

            var subscriptionId = generateId();
            var topicName = topic.rawTopicStr;
            var sessionTopic = topicName + '.' + server.sessionId;
            if (ids !== undefined && ids.length > 0) {
                sessionTopic = formatTopic(topic, ids) + '.' + server.sessionId;
            }

            var subscription = new EVWEB2.Subscription(subscriptionId, server, sessionTopic, handler);

            // NOTE: There can be multiple subscriptions per topic in the poll chain which
            // is where cached data values come into play
            subscriptions.push({
                'subscription': subscription,
                'topic': topicName,
                'options': options,
                'ids': ids
            });
            if (pollTimeout === null) {
                pollTimeout = setTimeout(legacyPoll, pollTimeoutValue);
            }

            onReply.resolve(subscription);
            return onReply.promise();
        };

        /**
         * This method is used to unsubscribe from an existing subscription.
         * @param {EVWEB2.Subscription} subscription An existing subscription instance
         * @param {Boolean} [acknowledge=true] A flag indicating if acknowledgement is requested when
         * the request completes
         * @returns {Promise<EVWEB2.Subscription, EVWEB2.ResponseStatus>} A promise that returns the subscription
         * instance (now inactive) back to the caller when resolved, or an {@link EVWEB2.ResponseStatus} instance
         * if rejected.
         */
        this.unsubscribe = function (subscription/*, acknowledge*/) {
            var onUnsubscribed = $.Deferred();

            var internalSubscription = $.grep(subscriptions, function(element) {
                return element.subscription === subscription;
            })[0];
            var response;
            if (internalSubscription === undefined){
                response = new EVWEB2.ResponseStatus(false,
                    "unsubscribe failed, no active subscriptions found for topic: " + subscription.topic,
                    EVWEB2.websocketErrorCodes.unknownTopic);
                onUnsubscribed.reject(response);
                return onUnsubscribed.promise();
            }

            // Remove the subscription
            var index = $.inArray(internalSubscription, subscriptions);
            if(index !== -1) {
                subscriptions.splice(index, 1);
            }

            if(subscriptions.length === 0 && pollTimeout !== null) {
                clearTimeout(pollTimeout);
                pollTimeout = null;
            }

            onUnsubscribed.resolve(subscription);
            return onUnsubscribed.promise();
        };
    };
    if(window.WebSocket === undefined || window.DataView === undefined || window.ArrayBuffer === undefined) {
        // Override the existing web socket handler with the legacy version.
        EVWEB2.WebSocketHandler = EVWEB2.LegacyWebSocketHandler;
    }
}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The item types available to bookmark items.
     * @enum {number}
     * @readonly
     * @category Case Management
     */
    EVWEB2.bookmarkItemTypes = {
        /**
         * Camera
         */
        camera: 0,
        /**
         * Audio
         */
        audio: 1,
        /**
         * Serial
         */
        serial: 2,
        /**
         * Event
         */
        event: 3
    };

    /**
     * Container for bookmark item information.
     * @param {EVWEB2.Server} server The server associated with the item.
     * @param {Number} id The item ID
     * @param {EVWEB2.bookmarkItemTypes} type The type of the item.
     * @constructor
     * @category Case Management
     */
    EVWEB2.BookmarkItem = function(server, id, type) {
        /**
         * The server associated with the item.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The item ID
         * @type {Number}
         */
        this.id = id;

        /**
         * The type of the item.
         * @type {EVWEB2.bookmarkItemTypes}
         */
        this.type = type;
    };

    /**
     * Container for bookmark information.
     * @param {String} name The bookmark name
     * @param {String} guid The unique bookmark id
     * @param {Date} start The start time of the bookmark.
     * @param {Date} end The end time of the bookmark.
     * @param {EVWEB2.BookmarkItem[]} items The items associated with the bookmark.
     * @param {String} [description=""] The case description
     * @param {Number} [size=0] The size of the bookmark, in KB.
     * @param {String} [caseId=null] The associated case ID, if applicable.
     * @constructor
     * @category Case Management
     */
    EVWEB2.Bookmark = function(name, guid, start, end, items, description, size, caseId) {
        /**
         * The bookmark name
         * @type {string}
         */
        this.name = name;

        /**
         * The unique bookmark id
         * @type {string}
         */
        this.guid = guid;

        /**
         * The start time of the bookmark
         * @type {Date}
         */
        this.start = start;

        /**
         * The end time of the bookmark
         * @type {Date}
         */
        this.end = end;

        /**
         * The items associated with the bookmark
         * @type {EVWEB2.BookmarkItem[]}
         */
        this.items = items;

        /**
         * The bookmark description
         * @type {string}
         */
        this.description = '';

        /**
         * The size of the bookmark in KB.
         * @type {Number}
         */
        this.size = 0;

        /**
         * The associated case ID, if applicable.
         * @type {String|null}
         */
        this.caseId = null;

        if (description !== undefined) {
            this.description = description;
        }
        if (size !== undefined) {
            this.size = size;
        }
        if (caseId !== undefined) {
            this.caseId = caseId;
        }

        /**
         * Updates a bookmark instance. NOTE: this function only updates base bookmark information (e.g. name,
         * description). To modify the items associated with a bookmark, see {@link EVWEB2.Bookmark.addItem} and
         * {@link EVWEB2.Bookmark.deleteItem}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and the updated bookmark.
         */
        this.update = function(callback) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                instance.name = data.bookmark.name;
                instance.description = data.bookmark.description;
                instance.start = EVWEB2.util.IETF2Date(data.bookmark.start);
                instance.end = EVWEB2.util.IETF2Date(data.bookmark.end);

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, instance);
            };

            var data = {
                s: $.map(instance.items, function(element) {
                    return element.server.sessionId;
                }),
                guid: instance.guid,
                name: instance.name,
                description: instance.description,
                start: EVWEB2.util.Date2IETF(instance.start),
                end: EVWEB2.util.Date2IETF(instance.end)
            };

            if(instance.caseId !== null) {
                data['case'] = instance.caseId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.items[0].server.service.url() + EVWEB2.urls.bookmark,
                type: 'PUT',
                data: data,
                traditional: true
            };

            if(instance.items[0].server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance.items[0].server.service);
            }
            $.ajax(settings);
        };

        /**
         * Delete a bookmark.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance.
         */
        this.deleteBookmark = function(callback) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var data = {
                s: $.map(instance.items, function(element) {
                    return element.server.sessionId;
                }),
                guid: instance.guid
            };

            if(instance.caseId !== null) {
                data['case'] = instance.caseId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.items[0].server.service.url() + EVWEB2.urls.bookmark,
                type: 'DELETE',
                data: data,
                traditional: true
            };

            if(instance.items[0].server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance.items[0].server.service);
            }
            $.ajax(settings);
        };

        /**
         * Adds an item to a bookmark.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and the updated bookmark.
         * @param {EVWEB2.BookmarkItem} bookmarkItem The bookmark item to add to the bookmark.
         */
        this.addItem = function(callback, bookmarkItem) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                instance.items.push(bookmarkItem);
                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, instance);
            };

            var data = {
                s: $.map(instance.items, function(element) {
                    return element.server.sessionId;
                }),
                guid: instance.guid,
                id: bookmarkItem.id,
                type: bookmarkItem.type,
                sessionId: bookmarkItem.server.sessionId
            };
            if(instance.caseId !== null) {
                data['case'] = instance.caseId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: bookmarkItem.server.service.url() + EVWEB2.urls.bookmarkItems,
                type: 'POST',
                data: data,
                traditional: true
            };

            if(bookmarkItem.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, bookmarkItem.server.service);
            }
            $.ajax(settings);
        };

        /**
         * Deletes an item from the bookmark.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and the updated bookmark.
         * @param {EVWEB2.BookmarkItem} bookmarkItem The bookmark item to add to the bookmark.
         */
        this.deleteItem = function(callback, bookmarkItem) {
            var instance = this;

            var internalItem = $.grep(instance.items, function(element) {
                return element.id === bookmarkItem.id
                    && element.type === bookmarkItem.type
                    && element.server === bookmarkItem.server;
            })[0];
            if(internalItem === undefined) {
                var errorResponse = new EVWEB2.ResponseStatus(false, "Item not removed from bookmark.");
                callback(errorResponse);
                return;
            }

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var index = $.inArray(internalItem, instance.items);
                if(index !== -1) {
                    instance.items.splice(index, 1);
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, instance);
            };

            var data = {
                s: internalItem.server.sessionId,
                guid: instance.guid,
                id: internalItem.id,
                type: internalItem.type
            };
            if(instance.caseId !== null) {
                data['case'] = instance.caseId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: internalItem.server.service.url() + EVWEB2.urls.bookmarkItems,
                type: 'DELETE',
                data: data
            };

            if(bookmarkItem.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, internalItem.server.service);
            }
            $.ajax(settings);
        };

    };

    /**
     * Container for case information
     * @param {EVWEB2.Server[]} servers The server(s) the case is stored on
     * @param {String} guid The unique case id
     * @param {String} name The case name
     * @param {String} [description=""] The case description
     * @param {Number} [count=0] The number of bookmarks associated with the case
     * @constructor
     * @category Case Management
     */
    EVWEB2.Case = function(servers, guid, name, description, count) {
        /**
         * The server(s) the case is stored on
         * @type {EVWEB2.Server[]}
         */
        this.servers = servers;

        /**
         * The unique case id
         * @type {string}
         */
        this.guid = guid;

        /**
         * The case name
         * @type {string}
         */
        this.name = name;

        /**
         * The case description
         * @type {string}
         */
        this.description = '';

        /**
         * The number of bookmarks associated with the case
         * @type {number}
         */
        this.count = 0;

        if(description !== undefined) {
            this.description = description;
        }
        if(count !== undefined) {
            this.count = count;
        }

        /**
         * Update a case instance. NOTE: this function only updates case information (e.g. name, description).
         * To modify bookmarks associated with a case see {@link EVWEB2.Bookmark.update}.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and the updated case.
         */
        this.update = function(callback) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }
                var caseInfo = data['case'];
                instance.servers = $.grep(instance.servers, function(el) {
                    return $.inArray(el.sessionId.toString(), caseInfo.servers) !== -1;
                });
                instance.guid = caseInfo.guid;
                instance.name = caseInfo.name;
                instance.description = caseInfo.description;
                instance.count = caseInfo.bookmarks;

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, instance);
            };

            var data = {
                s: $.map(instance.servers, function(element) {
                    return element.sessionId;
                }),
                guid: instance.guid,
                name: instance.name,
                description: instance.description
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.servers[0].service.url() + EVWEB2.urls.bookmarkCases,
                type: 'PUT',
                data: data,
                traditional: true
            };

            if(instance.servers[0].service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance.servers[0].service);
            }
            $.ajax(settings);
        };

        /**
         * Deletes this case.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance.
         */
        this.deleteCase = function(callback) {
            var instance = this;

            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse);
            };

            var data = {
                s: $.map(instance.servers, function(element) {
                    return element.sessionId;
                }),
                guid: instance.guid
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.servers[0].service.url() + EVWEB2.urls.bookmarkCases,
                type: 'DELETE',
                data: data,
                traditional: true
            };

            if(instance.servers[0].service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance.servers[0].service);
            }
            $.ajax(settings);
        };

        /**
         * Retreive the list of bookmarks for this case.  Note: The bookmarks retrieved through this method are also
         * returned by {@link EVWEB2.Service.getBookmarks}.  This method is provided only for convenience when working
         * with specific cases.
         * @param {Function} callback Callback function to be executed when the call completes. Callback
         * is passed a {@link EVWEB2.ResponseStatus} instance and an array of {@link EVWEB2.Bookmark} instances.
         */
        this.getBookmarks = function(callback) {
            var instance = this;
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr));
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var serverMap = {};
                $.each(instance.servers, function(index, element) {
                    serverMap[element.sessionId] = element;
                });

                var bookmarks = $.map(data.bookmarks, function(element) {
                    var items = $.map(element.items, function(el) {
                        return new EVWEB2.BookmarkItem(serverMap[el.server], el.id, el.type);
                    });
                    var start = EVWEB2.util.IETF2Date(element.start);
                    var end = EVWEB2.util.IETF2Date(element.end);

                    return new EVWEB2.Bookmark(element.name, element.guid, start, end, items, element.description,
                        element.size, element['case']);
                });

                var successResponse = new EVWEB2.ResponseStatus(true);
                callback(successResponse, bookmarks);
            };

            var data = {
                s: $.map(instance.servers, function(element) {
                    return element.sessionId;
                }),
                guid: instance.guid
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: instance.servers[0].service.url() + EVWEB2.urls.bookmark,
                type: 'GET',
                data: data,
                traditional: true
            };

            if(instance.servers[0].service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings, instance.servers[0].service);
            }
            $.ajax(settings);
        };
    };

}());
/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * Definitions for types of uses for serial ports.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialPortUses = {
        /**
         * Unused
         */
        Unused: 0,
        /**
         * POS
         */
        POS: 1,
        /**
         * PTZ
         */
        PTZ: 2,
        /**
         * ATM
         */
        ATM: 3,
        /**
         * Access Control
         */
        AccessControl: 4,
        /**
         * Internal
         */
        Internal: 5
    };

    /**
     * Definitions for types of IP serial port connections.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialIpTypes = {
        /**
         * TCP
         */
        TCP: 0,
        /**
         * HTTP
         */
        HTTP: 1,
        /**
         * TCP Listener
         */
        TcpListener: 2,
        /**
         * UDP
         */
        UDP: 3
    };

    /**
     * Definitions for types of parity for Uart serial ports.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialPortParity = {
        /**
         * None
         */
        None: 0,
        /**
         * Odd
         */
        Odd: 1,
        /**
         * Even
         */
        Even: 2
    };

    /**
     * Definitions for types of flow control for Uart serial ports.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialPortFlowControl = {
        /**
         * None
         */
        None: 0,
        /**
         * Software
         */
        Software: 1,
        /**
         * Hardware
         */
        Hardware: 2
    };

    /**
     * Definitions for types of serial devices.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialDeviceTypes = {
        /**
         * Unknown
         */
        Unknown: 0,
        /**
         * UART
         */
        Uart: 1,
        /**
         * IP
         */
        Ip: 2
    };

    /**
     * Definitions for types of serial profile transmission markers.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialProfileMarkerTypes = {
        /**
         * Standard
         */
        Standard: 0,
        /**
         * XML
         */
        XML: 1
    };


    /**
     * Definitions for field positions in serial profile rules.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialProfileRuleFieldPositions = {
        /**
         * Before
         */
        Before: 0,
        /**
         * After
         */
        After: 1
    };

    /**
     * Definitions for the types of operators for serial profile rules.
     * @enum {number}
     * @readonly
     * @category Serial
     */
    EVWEB2.SerialProfileRuleOperatorTypes = {
        /**
         * Unknown
         */
        Unknown: 0,
        /**
         * Equal
         */
        Equal: 1,
        /**
         * Not equal
         */
        NotEqual: 2,
        /**
         * Greater than or equal
         */
        GreaterOrEqual: 3,
        /**
         * Less than or equal
         */
        LessOrEqual: 4,
        /**
         * Greater than
         */
        GreaterThan: 5,
        /**
         * Less than
         */
        LessThan: 6,
        /**
         * Contains
         */
        Contains: 7,
        /**
         * Does not contain
         */
        NotContains: 8
    };

    /**
     * Server serial supports information, detailing the supported functionality related to serial devices.
     * @param {Boolean} [advancedLineEnding=false] Whether the server supports advanced line endings.
     * @param {Boolean} [sotMarkers=false] Whether the server supports SOT markers.
     * @param {Boolean} [xmlFormatting=false] Whether the server supports XML formatting in transmission markers.
     * @param {Boolean} [replace=false] Whether the server supports replacements.
     * @param {Boolean} [rules=false] Whether the server supports rules.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.ServerSerialFunctionality = function(advancedLineEnding, sotMarkers, xmlFormatting, replace, rules) {

        /**
         * Whether the server supports advanced line endings.
         * @type {boolean}
         */
        this.advancedLineEnding = false;

        /**
         * Whether the server supports SOT markers.
         * @type {boolean}
         */
        this.sotMarkers = false;

        /**
         * Whether the server supports XML formatting in transmission markers.
         * @type {boolean}
         */
        this.xmlFormatting = false;

        /**
         * Whether the server supports replacements.
         * @type {boolean}
         */
        this.replace = false;

        /**
         * Whether the server supports rules.
         * @type {boolean}
         */
        this.rules = false;

        //Assign the constructor values
        if(advancedLineEnding !== undefined) {
            this.advancedLineEnding = advancedLineEnding;
        }
        if(sotMarkers !== undefined) {
            this.sotMarkers = sotMarkers;
        }
        if(xmlFormatting !== undefined) {
            this.xmlFormatting = xmlFormatting;
        }
        if(replace !== undefined) {
            this.replace = replace;
        }
        if(rules !== undefined) {
            this.rules = rules;
        }
    };

    /**
     * Server serial support information, detailing the available types, uses, and supported functionality
     * of serial ports on the server.
     * @param {EVWEB2.Server} server The server associated with this information.
     * @param {EVWEB2.ServerSerialFunctionality} supports The supported functionality of serial devices.
     * @param {Number} [numUart=0] The number of supported Uart serial devices.
     * @param {Number} [numIp=0] The number of supported IP serial devices.
     * @param {EVWEB2.SerialPortUses[]} [uses=[]] The supported uses of serial devices.
     * @param {EVWEB2.SerialIpTypes[]} [ipTypes=[]] The supported types of IP serial devices.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.ServerSerialSupport = function(server, supports, numUart, numIp, uses, ipTypes) {

        /**
         * The server associated with this information.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The supported functionality of serial devices.
         * @type {EVWEB2.ServerSerialFunctionality}
         */
        this.supports = supports;

        /**
         * The number of supported Uart serial devices.
         * @type {number}
         */
        this.numUart = 0;

        /**
         * The number of supported IP serial devices.
         * @type {number}
         */
        this.numIp = 0;

        /**
         * The supported uses of serial devices.
         * @type {EVWEB2.SerialPortUses[]}
         */
        this.uses = [];

        /**
         * The supported uses of serial devices.
         * @type {EVWEB2.SerialIpTypes[]}
         */
        this.ipTypes = [];

        //Assign the constructor values
        if(numUart !== undefined) {
            this.numUart = numUart;
        }
        if(numIp !== undefined) {
            this.numIp = numIp;
        }
        if(uses !== undefined) {
            this.uses = uses;
        }
        if(ipTypes !== undefined) {
            this.ipTypes = ipTypes;
        }
    };

    /**
     * Container object for Uart serial device information.
     * @param {String} port The name of the server port for the serial device.
     * @param {Number} [baudRate=4800] The baud rate of the serial device.
     * @param {Number} [dataBits=8] The number of configured data bits for the serial device.
     * @param {Number} [stopBits=1] The number of configured stop bits for the serial device.
     * @param {EVWEB2.SerialPortParity} [parity=EVWEB2.SerialPortParity.None] The parity of the serial device.
     * @param {EVWEB2.SerialPortFlowControl} [flowControl=EVWEB2.SerialPortFlowControl.None] The flow control of the
     *   serial device.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.UartSerialDeviceConnectionInfo = function(port, baudRate, dataBits, stopBits, parity, flowControl) {
        /**
         * The name of the server port for the serial device.
         * @type {String}
         */
        this.port = port;

        /**
         * The baud rate of the serial device.
         * @type {Number}
         */
        this.baudRate = 4800;

        /**
         * The number of configured data bits for the serial device.
         * @type {Number}
         */
        this.dataBits = 8;

        /**
         * The number of configured stop bits for the serial device.
         * @type {Number}
         */
        this.stopBits = 1;

        /**
         * The parity of the serial device.
         * @type {EVWEB2.SerialPortParity}
         */
        this.parity = EVWEB2.SerialPortParity.None;

        /**
         * The flow control of the serial device.
         * @type {EVWEB2.SerialPortFlowControl}
         */
        this.flowControl = EVWEB2.SerialPortFlowControl.None;

        //Assign the constructor values
        if(baudRate !== undefined) {
            this.baudRate = baudRate;
        }
        if(dataBits !== undefined) {
            this.dataBits = dataBits;
        }
        if(stopBits !== undefined) {
            this.stopBits = stopBits;
        }
        if(parity !== undefined) {
            this.parity = parity;
        }
        if(flowControl !== undefined) {
            this.flowControl = flowControl;
        }
    };


    /**
     * Container object for Uart serial device information.
     * @param {String} address The IP address of the serial device.
     * @param {EVWEB2.SerialIpTypes} [type=EVWEB2.SerialIpTypes.TCP] The type of the serial device.
     * @param {Number} [ipPort=0] The IP port of the serial device.
     * @param {Number} [remotePort=] The remote port to use for the serial device.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.IpSerialDeviceConnectionInfo = function(address, type, ipPort, remotePort) {
        /**
         * The IP address of the serial device.
         * @type {String}
         */
        this.address = address;

        /**
         * The type of the serial device.
         * @type {EVWEB2.SerialIpTypes}
         */
        this.type = EVWEB2.SerialIpTypes.TCP;

        /**
         * The IP port of the serial device.
         * @type {Number}
         */
        this.ipPort = 0;

        /**
         * The remote port to use for the serial device.
         * @type {Number}
         */
        this.remotePort = 0;

        //Assign the constructor values
        if(type !== undefined) {
            this.type = type;
        }
        if(ipPort !== undefined) {
            this.ipPort = ipPort;
        }
        if(remotePort !== undefined) {
            this.remotePort = remotePort;
        }
    };

    /**
     * Container object for Uart serial device information.
     * @param {Number} [maxLineLength=80] The configured max line length of the serial device.
     * @param {String} [lineEnding=''] The token indicating a line end for the serial device.
     * @param {Number} [timeout=0] The timeout for the line ending, in seconds.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialDeviceLineInfo = function(maxLineLength, lineEnding, timeout) {
        /**
         * The configured max line length of the serial device.
         * @type {number}
         */
        this.maxLineLength = 80;

        /**
         * The token indicating a line end for the serial device.
         * @type {string}
         */
        this.lineEnding = '';

        /**
         * The timeout for the line ending, in seconds.
         * @type {number}
         */
        this.timeout = 0;

        //Assign the constructor values
        if(maxLineLength !== undefined) {
            this.maxLineLength = maxLineLength;
        }
        if(lineEnding !== undefined) {
            this.lineEnding = lineEnding;
        }
        if(timeout !== undefined) {
            this.timeout = timeout;
        }
    };

    /**
     * Container object for stored serial data items.
     * @param {String} [data=''] The stored serial data.
     * @param {Date} [start=null] The start time of the serial data.
     * @param {Date} [end=null] The end time of the serial data.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialStoredData = function(data, start, end) {
        /**
         * The stored serial data.
         * @type {String}
         */
        this.data = '';

        /**
         * The start time of the serial data.
         * @type {Date}
         */
        this.start = null;

        /**
         * The end time of the serial data.
         * @type {Date}
         */
        this.end = null;

        //Assign the constructor values
        if(data !== undefined) {
            this.data = data;
        }
        if(start !== undefined) {
            this.start = start;
        }
        if(end !== undefined) {
            this.end = end;
        }
    };

    /**
     * Container object for serial device information.
     * @param {EVWEB2.Server} server The server associated with this serial device.
     * @param {Number} id The ID of the serial device.
     * @param {String} name The name of the serial device.
     * @param {EVWEB2.UartSerialDeviceConnectionInfo|EVWEB2.IpSerialDeviceConnectionInfo} connectionInfo The connection
     *  info for the serial device.
     * @param {EVWEB2.SerialDeviceLineInfo} lineInfo The line processing information for the serial device.
     * @param {EVWEB2.SerialPortUses} [use=EVWEB2.SerialPortUses.Unused] The use of the serial device.
     * @param {EVWEB2.SerialDeviceTypes} [type=EVWEB2.SerialDeviceTypes.Unknown] The type of the serial device.
     * @param {Number|null} [profile=null] The ID of the serial profile associated with the serial device.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialDevice = function(server, id, name, connectionInfo, lineInfo, use, type, profile) {
        /**
         * The server associated with this serial device.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The ID of the serial device.
         * @type {Number}
         */
        this.id = id;

        /**
         * The name of the serial device.
         * @type {String}
         */
        this.name = name;

        /**
         * The connection info for the serial device.
         * @type {EVWEB2.UartSerialDeviceConnectionInfo|EVWEB2.IpSerialDeviceConnectionInfo}
         */
        this.connectionInfo = connectionInfo;

        /**
         * The line processing information for the serial device.
         * @type {EVWEB2.SerialDeviceLineInfo}
         */
        this.lineInfo = lineInfo;

        /**
         * The use of the serial device.
         * @type {EVWEB2.SerialPortUses}
         */
        this.use = EVWEB2.SerialPortUses.Unused;

        /**
         * The type of the serial device.
         * @type {EVWEB2.SerialDeviceTypes}
         */
        this.type = EVWEB2.SerialDeviceTypes.Unknown;

        /**
         * The ID of the serial profile associated with the serial device.
         * @type {Number|null}
         */
        this.profile = null;

        /**
         * The applied stream ID for this serial device.  This value is set by {@link EVWEB2.SerialDevice.getData},
         * either using the provided stream ID or a server-generated value received in the response.
         * @type {Number|null}
         * @internal
         * @private
         */
        var appliedStreamId = null;

        //Assign the constructor values
        if(use !== undefined) {
            this.use = use;
        }
        if(type !== undefined) {
            this.type = type;
        }
        if(profile !== undefined) {
            this.profile = profile;
        }

        /**
         * Retrieves stream data from a serial device.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and a array of strings of any
         *  serial data.
         * @param {Number} [streamId] The unique stream ID for the feed.  If this is not provided, one will be
         * automatically generated.
         */
        this.getData = function(callback, streamId) {
            var device = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                if(appliedStreamId === null) {
                    appliedStreamId = data.stream;
                }

                callback(successResponse, data.data);
            };

            if(streamId !== undefined) {
                appliedStreamId = streamId;
            }

            var data = {
                s: device.server.sessionId,
                serial: device.id
            };

            if(appliedStreamId !== null) {
                data.stream = appliedStreamId;
            }

            var settings = {
                success: onSuccess,
                error: onError,
                url: device.server.service.url() + EVWEB2.urls.serialData,
                data: data
            };

            if(device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves stored data from a serial device.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response, an array
         *  of {@link EVWEB2.SerialStoredData} instances, and a boolean indicating whether the search has
         *  finished retrieving all of the data.  If this value is false, then re-calling this method is
         *  recommended to ensure that all stored data is retrieved.
         * @param {Number} searchId The ID of the search associated with the stored serial data.
         * automatically generated.
         */
        this.getStoredData = function(callback, searchId) {
            var device = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var storedData = $.map(data.stored, function(element) {
                    return new EVWEB2.SerialStoredData(element.data, EVWEB2.util.IETF2Date(element.start),
                        EVWEB2.util.IETF2Date(element.end));
                });

                callback(successResponse, storedData, data.complete);
            };

            var data = {
                s: searchId,
                serial: device.id
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: device.server.service.url() + EVWEB2.urls.serialStoredData,
                data: data
            };

            if(device.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

    };

    /**
     * Container object for serial profile case sensitivity settings.
     * @param {Boolean} [transmissionMarkers=false] Whether transmission markers are case sensitive.
     * @param {Boolean} [keywords=false] Whether keywords are case sensitive.
     * @param {Boolean} [masks=false] Whether masks are case sensitive.
     * @param {Boolean} [replacements=false] Whether replacements are case sensitive.
     * @param {Boolean} [rules=false] Whether rules are case sensitive.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialCaseSensitivity = function(transmissionMarkers, keywords, masks, replacements, rules) {
        /**
         * Whether transmission markers are case sensitive.
         * @type {boolean}
         */
        this.transmissionMarkers = false;

        /**
         * Whether keywords are case sensitive.
         * @type {boolean}
         */
        this.keywords = false;

        /**
         * Whether masks are case sensitive.
         * @type {boolean}
         */
        this.masks = false;

        /**
         * Whether replacements are case sensitive.
         * @type {boolean}
         */
        this.replacements = false;

        /**
         * Whether rules are case sensitive.
         * @type {boolean}
         */
        this.rules = false;

        //Assign the constructor values
        if(transmissionMarkers !== undefined) {
            this.transmissionMarkers = transmissionMarkers;
        }
        if(keywords !== undefined) {
            this.keywords = keywords;
        }
        if(masks !== undefined) {
            this.masks = masks;
        }
        if(replacements !== undefined) {
            this.replacements = replacements;
        }
        if(rules !== undefined) {
            this.rules = rules;
        }
    };

    /**
     * Container object for serial profile transmission markers settings.
     * @param {EVWEB2.SerialProfileMarkerTypes} [type=EVWEB2.SerialProfileMarkerTypes.Standard] The type of the profile
     *  marker.
     * @param {String} [start=""] The start of transmission marker.
     * @param {String} [end=""] The end of transmission marker.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileMarkers = function(type, start, end) {
        /**
         * The type of the profile marker.
         * @type {EVWEB2.SerialProfileMarkerTypes}
         */
        this.type = EVWEB2.SerialProfileMarkerTypes.Standard;

        /**
         * The start of transmission marker.
         * @type {string}
         */
        this.start = '';

        /**
         * The end of transmission marker.
         * @type {string}
         */
        this.end = '';

        //Assign the constructor values
        if(type !== undefined) {
            this.type = type;
        }
        if(start !== undefined) {
            this.start = start;
        }
        if(end !== undefined) {
            this.end = end;
        }
    };

    /**
     * Container object for a serial profile keyword.
     * @param {EVWEB2.SerialProfile} profile The serial profile associated with this keyword.
     * @param {Number} id The ID of the serial profile keyword.
     * @param {String} [match=""] The match text of the keyword.
     * @param {Boolean} [enabled=false] Whether the keyword is enabled.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileKeyword = function(profile, id, match, enabled) {
        /**
         * The serial profile associated with this keyword.
         * @type {EVWEB2.SerialProfile}
         */
        this.profile = profile;

        /**
         * The ID of the serial profile keyword.
         * @type {Number}
         */
        this.id = id;

        /**
         * The match text of the keyword.
         * @type {string}
         */
        this.match = "";

        /**
         * Whether the keyword is enabled.
         * @type {boolean}
         */
        this.enabled = false;

        //Assign the constructor values
        if(match !== undefined) {
            this.match = match;
        }
        if(enabled !== undefined) {
            this.enabled = enabled;
        }
    };

    /**
     * Container object for a serial profile line mask.
     * @param {EVWEB2.SerialProfile} profile The serial profile associated with this line mask.
     * @param {String} [match=""] The match text of the mask.
     * @param {Boolean} [live=false] Whether the mask is enabled for live.
     * @param {Boolean} [search=false] Whether the mask is enabled for search.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileLineMask = function(profile, match, live, search) {
        /**
         * The serial profile associated with this line mask.
         * @type {EVWEB2.SerialProfile}
         */
        this.profile = profile;

        /**
         * The match text of the mask.
         * @type {string}
         */
        this.match = "";

        /**
         * Whether the mask is enabled for live.
         * @type {boolean}
         */
        this.live = false;

        /**
         * Whether the mask is enabled for search.
         * @type {boolean}
         */
        this.search = false;

        //Assign the constructor values
        if(match !== undefined) {
            this.match = match;
        }
        if(live !== undefined) {
            this.live = live;
        }
        if(search !== undefined) {
            this.search = search;
        }
    };

    /**
     * Container object for a serial profile replacement.
     * @param {EVWEB2.SerialProfile} profile The serial profile associated with this replacement.
     * @param {String} [match=""] The match text of the replacement.
     * @param {String} [replace=""] The replace text of the replacement.
     * @param {Boolean} [live=false] Whether the replacement is enabled for live.
     * @param {Boolean} [search=false] Whether the replacement is enabled for search.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileReplacement = function(profile, match, replace, live, search) {
        /**
         * The serial profile associated with this replacement.
         * @type {EVWEB2.SerialProfile}
         */
        this.profile = profile;

        /**
         * The match text of the replacement.
         * @type {string}
         */
        this.match = "";

        /**
         * The match text of the replacement.
         * @type {string}
         */
        this.replace = "";

        /**
         * Whether the replacement is enabled for live.
         * @type {boolean}
         */
        this.live = false;

        /**
         * Whether the replacement is enabled for search.
         * @type {boolean}
         */
        this.search = false;

        //Assign the constructor values
        if(match !== undefined) {
            this.match = match;
        }
        if(replace !== undefined) {
            this.replace = replace;
        }
        if(live !== undefined) {
            this.live = live;
        }
        if(search !== undefined) {
            this.search = search;
        }

    };

    /**
     * Container object for a serial profile rule.
     * @param {EVWEB2.SerialProfile} profile The serial profile associated with this rule.
     * @param {Number} id The ID of the serial profile rule.
     * @param {String} name The name of the rule.
     * @param {EVWEB2.SerialProfileRulePattern[]} [patterns=[]] The patterns defining the rule.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileRule = function(profile, id, name, patterns) {
        /**
         * The serial profile associated with this rule.
         * @type {EVWEB2.SerialProfile}
         */
        this.profile = profile;

        /**
         * The ID of the serial profile rule.
         * @type {Number}
         */
        this.id = id;

        /**
         * TThe name of the rule.
         * @type {string}
         */
        this.name = name;

        /**
         * The patterns defining the rule.
         * @type {EVWEB2.SerialProfileRulePattern[]}
         */
        this.patterns = [];

        //Assign the constructor values
        if(patterns !== undefined) {
            this.patterns = patterns;
        }
    };

    /**
     * Container object for a serial profile rule pattern.
     * @param {Number} id The ID of the rule pattern.
     * @param {EVWEB2.SerialProfileRuleFieldPositions} [position=EVWEB2.SerialProfileRuleFieldPositions.Before] The
     *  position of the field.
     * @param {String} [field=""] The field of the rule.
     * @param {EVWEB2.SerialProfileRuleOperatorTypes} [op=EVWEB2.SerialProfileRuleOperatorTypes.Equal] The operator of
     *  the rule.
     * @param {String} [value=""] The value of the rule
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfileRulePattern = function(id, position, field, op, value) {
        /**
         * The ID of the rule pattern.
         * @type {Number}
         */
        this.id = id;

        /**
         * The position of the field.
         * @type {EVWEB2.SerialProfileRuleFieldPositions}
         */
        this.position = EVWEB2.SerialProfileRuleFieldPositions.Before;

        /**
         * The field of the rule.
         * @type {string}
         */
        this.field = "";

        /**
         * The operator of the rule.
         * @type {EVWEB2.SerialProfileRuleOperatorTypes}
         */
        this.op = EVWEB2.SerialProfileRuleOperatorTypes.Equal;

        /**
         * The value of the rule
         * @type {string}
         */
        this.value = "";

        //Assign the constructor values
        if(position !== undefined) {
            this.position = position;
        }
        if(field !== undefined) {
            this.field = field;
        }
        if(op !== undefined) {
            this.op = op;
        }
        if(value !== undefined) {
            this.value = value;
        }
    };

    /**
     * Container object for serial profile information.
     * @param {EVWEB2.Server} server The server associated with this serial profile.
     * @param {Number} id The ID of the serial profile.
     * @param {String} name The name of the serial profile.
     * @param {EVWEB2.FontInfo} fontInfo The font settings for the serial profile.
     * @param {EVWEB2.SerialCaseSensitivity} caseSensitivity The case sensitivity settings for the serial profile.
     * @param {EVWEB2.SerialProfileMarkers} markers The markers configuration for the serial profile.
     * @param {Number} [retention=87840] The retention period of the profile, in seconds.
     * @class
     * @constructor
     * @category Serial
     */
    EVWEB2.SerialProfile = function(server, id, name, fontInfo, caseSensitivity, markers, retention) {
        /**
         * The server associated with this serial profile.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The ID of the serial profile.
         * @type {Number}
         */
        this.id = id;

        /**
         * The name of the serial profile.
         * @type {String}
         */
        this.name = name;

        /**
         * The font settings for the serial profile.
         * @type {EVWEB2.FontInfo}
         */
        this.fontInfo = fontInfo;

        /**
         * The case sensitivity settings for the serial profile.
         * @type {EVWEB2.SerialCaseSensitivity}
         */
        this.caseSensitivity = caseSensitivity;

        /**
         * The markers configuration for the serial profile.
         * @type {EVWEB2.SerialProfileMarkers}
         */
        this.markers = markers;

        /**
         * The retention period of the profile, in seconds.
         * @type {number}
         */
        this.retention = 87840;

        //Assign the constructor values
        if(retention !== undefined) {
            this.retention = retention;
        }

        /**
         * Retrieves information on the keywords configured for a profile.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialProfileKeyword} instances.
         */
        this.getKeywords = function(callback) {
            var profile = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var keywords = $.map(data.keywords, function(element) {
                    return new EVWEB2.SerialProfileKeyword(profile, element.id, element.match, element.enabled);
                });

                callback(successResponse, keywords);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: profile.server.service.url() + EVWEB2.urls.serialProfileKeywords,
                data: {
                    s: profile.server.sessionId,
                    profile: profile.id
                }
            };

            if(profile.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves information on the line masks configured for a profile.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialProfileLineMask} instances.
         */
        this.getLineMasks = function(callback) {
            var profile = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var keywords = $.map(data.masks, function(element) {
                    return new EVWEB2.SerialProfileLineMask(profile, element.match, element.live, element.search);
                });

                callback(successResponse, keywords);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: profile.server.service.url() + EVWEB2.urls.serialProfileLineMasks,
                data: {
                    s: profile.server.sessionId,
                    profile: profile.id
                }
            };

            if(profile.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves information on the replacements configured for a profile.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialProfileReplacement} instances.
         */
        this.getReplacements = function(callback) {
            var profile = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var replacements = $.map(data.replacements, function(element) {
                    return new EVWEB2.SerialProfileReplacement(profile, element.match, element.replace,
                        element.live, element.search);
                });

                callback(successResponse, replacements);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: profile.server.service.url() + EVWEB2.urls.serialProfileReplacements,
                data: {
                    s: profile.server.sessionId,
                    profile: profile.id
                }
            };

            if(profile.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

        /**
         * Retrieves information on the rules configured for a profile.
         * @param {function} callback Function Callback function to be executed when the call completes. Callback is passed a
         *  {@link EVWEB2.ResponseStatus} instance with the details of the response and an array of
         *  {@link EVWEB2.SerialProfileRule} instances.
         */
        this.getRules = function(callback) {
            var profile = this;

            var onError = function(/*xhr, textStatus, errorThrown*/) {
                var errorResponse = new EVWEB2.ResponseStatus(false,'An error occurred.');
                callback(errorResponse);
            };

            var onSuccess = function(data/*, textStatus, xhr*/) {
                if(!data.success) {
                    //Send the error response
                    var errorResponse = new EVWEB2.ResponseStatus(false, data.errorText);
                    callback(errorResponse);
                    return;
                }

                var successResponse = new EVWEB2.ResponseStatus(true);

                var rules = $.map(data.rules, function(element) {
                    var patterns = $.map(element.patterns, function(el) {
                        return new EVWEB2.SerialProfileRulePattern(el.id, el.fieldPosition, el.field, el.op, el.value);
                    });
                    return new EVWEB2.SerialProfileRule(profile, element.id, element.name, patterns);
                });

                callback(successResponse, rules);
            };

            var settings = {
                success: onSuccess,
                error: onError,
                url: profile.server.service.url() + EVWEB2.urls.serialProfileRules,
                data: {
                    s: profile.server.sessionId,
                    profile: profile.id
                }
            };

            if(profile.server.service.isXss()) {
                EVWEB2.util.updateRequestForXss(settings);
            }
            $.ajax(settings);
        };

    };

}());
/*globals EVWEB2:true*/

(function() {
    "use strict";

    /**
     * The types of events.
     * @enum {number}
     * @readonly
     * @category Events
     */
    EVWEB2.EventType = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Video Motion
         */
        videoMotion: 1,
        /**
         * Video Loss
         */
        videoLoss: 2,
        /**
         * Input Trigger
         */
        inputTrigger: 3,
        /**
         * Serial Port
         */
        serialPort: 4,
        /**
         * Serial Profile
         */
        serialProfile: 5,
        /**
         * Button Input
         */
        buttonInput: 6,
        /**
         * Device Failure
         */
        deviceFailure: 7,
        /**
         * Device Temperature
         */
        deviceTemperature: 8,
        /**
         * Device Fan
         */
        deviceFan: 9,
        /**
         * Device Power Supply
         */
        devicePowerSupply: 10,
        /**
         * Storage
         */
        storage: 11,
        /**
         * Subscription Expiration
         */
        subscriptionExpiration: 12,
        /**
         * Video Throttling
         */
        videoThrottling: 13,
        /**
         * System Voltage
         */
        systemVoltage: 14,
        /**
         * System Temperature
         */
        systemTemperature: 15,
        /**
         * System Fan
         */
        systemFan: 16,
        /**
         * Archive Connection
         */
        archiveConnection: 17,
        /**
         * Archive Task
         */
        archiveTask: 18,
        /**
         * Record Content Age
         */
        recordContentAge: 19,
        /**
         * Archive Content Age
         */
        archiveContentAge: 20,
        /**
         * IP Camera Connection
         */
        ipCameraConnection: 21,
        /**
         * Soft Trigger
         */
        softTrigger: 22,
        /**
         * Time Trigger
         */
        timeTrigger: 23,
        /**
         * Analytics
         */
        analytics: 24,
        /**
         * Outbound Connection
         */
        outboundConnection: 25,
        /**
         * Security Integration Connection
         */
        securityIntegrationConnection: 26,
        /**
         * Security Integration Alert
         */
        securityIntegrationAlert: 27,
        /**
         * Security Integration Alarm
         */
        securityIntegrationAlarm: 28,
        /**
         * Serial Port Connection
         */
        serialPortConnection: 29
    };

    /**
     * The types of items associated with events.
     * @enum {number}
     * @readonly
     * @category Events
     */
    EVWEB2.EventItemType = {
        /**
         * Unknown
         */
        unknown: 0,
        /**
         * Camera
         */
        camera: 1,
        /**
         * Audio
         */
        audio: 2,
        /**
         * Input Trigger
         */
        inputTrigger: 3,
        /**
         * Serial Keyword
         */
        serialKeyword: 4,
        /**
         * Serial Profile
         */
        serialProfile: 5,
        /**
         * Analytics Rule
         */
        analyticsRule: 6,
        /**
         * Security Integration Sensor
         */
        securityIntegrationSensor: 7
    };

    /**
     * The EventExtraInfo object represents an additional device information associated with an event.
     * @param {EVWEB2.Server} server The server associated with the event.
     * @param {Number} id The ID of the additional item associated with the event.
     * @param {EVWEB2.EventItemType} type The type of the additional item associated with the event.
     * @class
     * @category Events
     */
    EVWEB2.EventExtraInfo = function(server, id, type) {
        /**
         * The server associated with the event.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The ID of the additional item associated with the event.
         * @type {Number}
         */
        this.id = id;

        /**
         * The type of the additional item associated with the event.
         * @type {EVWEB2.EventItemType}
         */
        this.type = type;

    };

    /**
     * The Event object represents an active event on the server.
     * @param {EVWEB2.Server} server The server associated with the event.
     * @param {EVWEB2.EventType} type The type of event.
     * @param {Date} time The time that the event was triggered.
     * @param {Number} [deviceId] Device ID of device associated with the event.
     * @param {EVWEB2.EventExtraInfo} [extraInfo] Extra information associated with the event.
     * @class
     * @category Events
     */
    EVWEB2.Event = function(server, type, time, deviceId, extraInfo) {
        /**
         * The server associated with the event.
         * @type {EVWEB2.Server}
         */
        this.server = server;

        /**
         * The type of event.
         * @type {EVWEB2.EventType}
         */
        this.type = type;

        /**
         * The time that the event was triggered.
         * @type {Date}
         */
        this.time = time;

        /**
         * Device ID of device associated with the event.
         * @type {Number|null}
         */
        this.deviceId = null;

        /**
         * Extra information associated with the event.
         * @type {EVWEB2.EventExtraInfo|null}
         */
        this.extraInfo = null;

        if(deviceId !== undefined) {
            this.deviceId = deviceId;
        }
        if(extraInfo !== undefined) {
            this.extraInfo = extraInfo;
        }
    };
}());

/*globals EVWEB2:true*/
(function() {
    "use strict";

    /**
     * The available types of archive targets.
     * @enum {Number}
     * @readonly
     * @category Archiving
     */
    EVWEB2.archiveTargetType = {
        /**
         * None
         */
        none: 0,
        /**
         * SMB
         */
        smb: 1,
        /**
         * NFS
         */
        nfs: 2,
        /**
         * iSCSI
         */
        iscsi: 3,
        /**
         * Cloud
         */
        cloud: 4
    };

    /** 
     * The available methods for archive content expiration.
     * @enum {Number}
     * @readonly
     * @category Archiving
     */
    EVWEB2.archiveExpirationType = {
        /**
         * None
         */
        none: 0,
        /**
         * At least.  Note: This should never occur with an archive target.
         */
        atLeast: 1,
        /**
         * At most
         */
        atMost: 2
    };

    /**
     * The ArchiveTarget is a container for an nvr archive target.
     * @param {EVWEB2.Server} [server=null] The {@link EVWEB2.Server} instance associated with the archive target.
     * @param {Number} [id=0] The server-assigned identifier for the archive target.
     * @param {Boolean} [enabled=false] Whether the target is currently enabled.
     * @param {EVWEB2.archiveTargetType} [type=EVWEB2.archiveTargetType.none] The type of this target.
     * @param {EVWEB2.ArchiveUploadConfig} [upload=null] The uploading configuration for this target.
     * @param {EVWEB2.ArchiveSearchConfig} [search=null] The direct search configuration for this target.
     * @class
     * @category Archiving
     */
    EVWEB2.ArchiveTarget = function(server, id, enabled, type, upload, search) {

        /**
         * The {@link EVWEB2.Server} instance associated with the archive target.
         * @type {EVWEB2.Server}
         */
        this.server = server || null;

        /**
         * The server-assigned identifier for the archive target.
         * @type {Number}
         */
        this.id = id || 0;

        /**
         * Whether the target is currently enabled.
         * @type {Boolean}
         */
        this.enabled = enabled || false;

        /**
         * The type of this target.
         * @type {EVWEB2.archiveTargetType}
         */
        this.type = type || EVWEB2.archiveTargetType.none;

        /**
         * The uploading configuration for this target.
         * @type {EVWEB2.ArchiveUploadConfig|null}
         */
        this.upload = upload || null;

        /**
         * The direct search configuration for this target.
         * @type {EVWEB2.ArchiveSearchConfig}
         */
        this.search = search || null;
    };

    /**
     * ArchiveUploadConfig represents the upload configuration for an {@link EVWEB2.ArchiveTarget}. Note that targets
     * of the {@link EVWEB2.archiveTargetType.cloud} do not use most of these settings, as uploading for that kind of
     * archive is managed differently.
     * @param {String} [address] The address used to upload to the archive.
     * @param {Boolean} [hasBookmarks=false] Whether the archive supports bookmarking.
     * @param {Number} [percentToUse=0] The percent of archive disk space to use for storage. Cloud archives will always
     * use 100% of available disk space
     * @param {String} [username] The username used to upload to the archive.
     * @param {String} [password] The password used to upload to the archive.
     * @param {String} [mountPoint] The mount point of the archive on the nvr file system.
     * @param {Number} [desiredContentAge] The minimum desired amount of footage, in seconds, that the archive should
     * store. Storing less than this will cause the server to emit an alarm state.
     * @param {EVWEB2.archiveExpirationType} [expirationType=EVWEB2.archiveExpirationType.none] The type of content expiration
     * used to determine the lifetime of uploaded footage. Content on an archive is always stored up to an effective "maximum"
     * age, meaning that this value should always be {@link EVWEB2.archiveExpirationType.atMost}.
     * @param {Number} [expirationDuration] The amount of time, in seconds, that determines how content expires on the server,
     * used in tandem with the 'expirationType' property.
     * @class
     * @category Archiving
     */
    EVWEB2.ArchiveUploadConfig = function(address, hasBookmarks, percentToUse, username, password, mountPoint,
        desiredContentAge, expirationType, expirationDuration) {

        /**
         * The address used to upload to the archive.
         * @type {String}
         */
        this.address = address || '';

        /**
         * Whether the archive supports bookmarking.
         * @type {Boolean}
         */
        this.hasBookmarks = hasBookmarks || false;

        /**
         * The percent of archive disk space to use for storage. Cloud archives will always use 100%
         * of available disk space
         * @type {Number}
         */
        this.percentToUse = percentToUse || 0;

        /**
         * The username used to upload to the archive.
         * @type {String}
         */
        this.username = username;

        /**
         * The password used to upload to the archive.
         * @type {String}
         */
        this.password = password;

        /**
         * The mount point of the archive on the nvr file system.
         * @type {String}
         */
        this.mountPoint = mountPoint;

        /**
         * The minimum desired amount of footage, in seconds, that the archive should
         * store. Storing less than this will cause the server to emit an alarm state.
         * @type {Number}
         */
        this.desiredContentAge = desiredContentAge;

        /**
         * The type of content expiration used to determine the lifetime of uploaded footage. Content on
         * an archive is always stored up to an effective "maximum" age, meaning that this value should
         * always be {@link EVWEB2.archiveExpirationType.atMost}.
         * @type {EVWEB2.archiveExpirationType}
         */
        this.expirationType = expirationType || EVWEB2.archiveExpirationType.none;

        /**
         * The amount of time, in seconds, that determines how content expires on the server,
         * used in tandem with the 'expirationType' property.
         * @type {Number}
         */
        this.expirationDuration = expirationDuration;
    };

    /**
     * An ArchiveSearchConfig represents the configuration for direct search on an {@link EVWEB2.ArchiveTarget}.
     * @class
     * @param {Boolean} [enabled=false] Whether direct archive search is enabled for this target.
     * @param {String} [address=''] The address used to conduct direct search on this target.
     * @param {String} [username=''] The username used for direct search.
     * @param {String} [password=''] The password used for direct search.
     * @category Archiving
     */
    EVWEB2.ArchiveSearchConfig = function(enabled, address, username, password) {

        /**
         * Whether direct archive search is enabled for this target.
         * @type {Boolean}
         */
        this.enabled = enabled || false;

        /**
         * The address used to conduct direct search on this target.
         * @type {String}
         */
        this.address = address || '';

        /**
         * The username used for direct search.
         * @type {String}
         */
        this.username = username || '';

        /**
         * The password used for direct search.
         * @type {String}
         */
        this.password = password || '';
    };
}());

/*globals EVWEB2:true*/
(function() {
    'use strict';

    /**
     * The byte length of our injected frame header.
     * @type {Number}
     * @constant
     */
    var FRAME_HEAD_LENGTH = 29;

    /**
     * The byte length of the h624 sei rbsp, containing the payload of type sei_userdata_unregistered,
     * that we include with frames to provide metadata. This is effectively {@link FRAME_HEAD_LENGTH}
     * plus 16 bytes for the guid and 2 for the sei_userdata type/length.
     * @type {Number}
     * @constant
     */
    var SEI_RBSP_LENGTH = FRAME_HEAD_LENGTH + 18;

    /**
     * EVWEB2.VideoStream exposes a video frame stream.
     * An instance can be used for multiple start/stop calls across a single server session.
     * @param {String} url The endpoint location used to stream video.
     * @param {EVWEB2.cameraFormats} format The video format being used for this stream.
     * @constructor
     * @category Camera
     */
    EVWEB2.VideoStream = function(url, format) {
        /**
         * The endpoint location used to stream video.
         * @type {String}
         */
        this.url = url;

        /**
         * The video format being used for this stream. One of {@link EVWEB2.cameraFormats}.
         * @type {Number}
         */
        this.format = format;

        /**
         * The underlying websocket connection on which frames are received. Unused when streaming via legacy
         * polling.
         * @type {WebSocket}
         */
        this._conn = null;

        /**
         * A text decoder, used to read RFC timestamps from a frame payload.
         * @type {TextDecoder}
         */
        this._decoder = new TextDecoder();

        /**
         * Opens the video stream, wiring frame/error callbacks with provided functions.
         * @param {Function} onFrame Callback invoked when a frame is received. Callback is given an instance of
         * {@link EVWEB2.VideoFrame} from the stream.
         * @param {Function} onError. Callback invoked when a stream error is encountered. Callback is passed
         * no parameters.
         */
        this.start = function(onFrame, onError) {
            if (this._conn) {
                return;
            }

            this._conn = new WebSocket(this.url);
            this._conn.binaryType = 'arraybuffer';

            var self = this;
            this._conn.onmessage = function(message) {
                var data = new Uint8Array(message.data);
                var head;
                if (self.format === EVWEB2.cameraFormats.h264) {
                    // we don't need to slice the sei off of the buffer as decoders will skip over it
                    head = self._readSeiHead(data);
                } else {
                    head = self._readBinaryHead(data);
                    data = data.subarray(FRAME_HEAD_LENGTH);
                }

                onFrame(new EVWEB2.VideoFrame(head.time, head.flags, head.isIframe, data));
            };
            this._conn.onerror = onError;
            this._conn.onclose = onError;
        };

        /**
         * Closes the video stream. No further frames will be received once this message is called unless start()
         * is invoked again.
         */
        this.stop = function() {
            if (!this._conn) {
                return;
            }

            this._conn.onmessage = null;
            this._conn.onerror = null;
            this._conn.onclose = null;

            this._conn.close();
            this._conn = null;
        };

        /**
         * Parse h264 metadata, which comes in an SEI with sei_userdata_unregistered, out of a websocket message.
         * Since this has to be done on every frame, we take advantage of the fact that the web service
         * provides the unregistered userdata SEI at the beginning of the message.
         * @param {Uint8Array} data The websocket payload.
         * @return {{time: Date, flags: Number, isIframe: Boolean}} The frame metadata.
         * @private
         */
        this._readSeiHead = function(data) {
            // The rbsp will be of fixed length once prevention bytes are stripped.
            var rbsp = new Uint8Array(SEI_RBSP_LENGTH);

            // Grab the complete RBSP minus the emulation prevention bytes.
            // Skip the first startcode and the forbidden_zero/ref_idc/type byte.
            // see ITU-T H.264 7.3.1
            for (var i = 5, ri = 0; i < data.length; ++i, ++ri) {
                if (data[i] === 0x00 && data[i+1] === 0x00 && data[i+2] === 0x00 && data[i+3] === 0x01) {
                    break;
                }
                if (data[i] === 0x00 && data[i+1] === 0x00 && data[i+2] === 0x03) {
                    rbsp[ri] = data[i];
                    rbsp[ri+1] = data[i+1];
                    i += 2;
                    ++ri;
                } else {
                    rbsp[ri] = data[i];
                }
            }

            // The rbsp now contains the full sei_message with payload type user_data_unregistered.
            // The full layout is:
            //  0: [1 byte]    u8: sei payload type
            //  1: [1 byte]    u8: sei payload length
            //  2: [16 byte] uuid: our constant guid for these metadata payloads
            // 18: [24 byte]  str: RFC3339 timestamp
            // 42: [4 byte]   u32: frame flags
            // 30: [1 byte]  bool: idr flag
            var time = new Date(this._decoder.decode(rbsp.subarray(18, 42)));
            var flags = rbsp[42]<<24 | rbsp[43]<<16 | rbsp[44]<<8 | rbsp[45];
            var isIframe = rbsp[46] === 0x01;
            return {
                time: time,
                flags: flags,
                isIframe: isIframe,
            };
        };

        /**
         * Parse non-h264 metadata, which comes in as a binary structure, out of a websocket message.
         * @param {Uint8Array} data The websocket payload.
         * @return {{time: Date, flags: Number, isIframe: Boolean}} The frame metadata.
         * @private
         */
        this._readBinaryHead = function(data) {
            // The following offsets have what we need:
            //  0: [24 byte] str: RFC3339 timestamp
            // 24: [4 byte]  u32: frame flags
            // 28: [1 byte] bool: idr flag
            var time = new Date(this._decoder.decode(data.subarray(0, 24)));
            var flags = data[24]<<24 | data[25]<<16 | data[26]<<8 | data[27];
            var isIframe = data[28] === 0x01;
            return {
                time: time,
                flags: flags,
                isIframe: isIframe,
            };
        };
    };

    /**
     * EVWEB2.VideoFrame represents a single video frame emitted from our server.
     * @param {Date} time The frame time.
     * @param {Number} flags Bitset of frame flags.
     * @param {Boolean} isIframe Whether this frame is an independent (i-frame) data slice. Irrelevant for video sources
     * that do not use interframe compression.
     * @param {Uint8Array} data The frame payload.
     * @constructor
     * @category Camera
     */
    EVWEB2.VideoFrame = function(time, flags, isIframe, data) {
        /**
         * The frame time.
         * @type {Date}
         */
        this.time = time;

        /**
         * Bitset of frame flags.
         * @type {Number}
         */
        this.flags = flags;

        /**
         * Whether this frame is an independent (i-frame) data slice. Irrelevant for video sources
         * that do not use interframe compression.
         * @type {Boolean}
         */
        this.isIframe = isIframe;

        /**
         * The frame payload.
         * @type {Uint8Array}
         */
        this.data = data;
    };
}());

/*globals EVWEB2:true*/
(function() {
    'use strict';

    /**
     * Enumeration of associated source types for analytic rules.
     * @enum {Number}
     * @readonly
     * @category Analytics
     */
    EVWEB2.analyticRuleSourceType = {
        /**
         * Unknown (invalid)
         */
        unknown: 0,
        /**
         * Source is an associated camera
         */
        camera: 1,
        /**
         * Source is an associated audio device
         */
        audio: 2
    };

    /**
     * Points to a camera source associated with an analytic rule.
     * @param {Number} [id=0] The camera ID.
     * @class
     * @category Analytics
     */
    EVWEB2.AssociatedCameraSource = function(id) {
        /**
         * The camera ID.
         * @type {Number}
         */
        this.id = id;
    };

    /**
     * Points to an audio source associated with an analytic rule.
     * @param {Number} [id=0] The audio device ID.
     * @class
     * @category Analytics
     */
    EVWEB2.AssociatedAudioSource = function(id) {
        /**
         * The audio device ID.
         * @type {Number}
         */
        this.id = id;
    };

    /**
     * Defines an analytic rule configuration.
     * @param {EVWEB2.Server} [server=null] The server that hosts this rule.
     * @param {Number} [id=0] The rule ID.
     * @param {Number} [deviceId=0] The ID of the device to which this rule is attached.
     * @param {EVWEB2.AssociatedCameraSource|EVWEB2.AssociatedAudioSource} [sourceId=null] The identifier of the source
     * with which this rule is associated.
     * @param {String} [name=''] The name of this rule.
     * @param {EVWEB2.AnalyticRuleOSDConfig} [osdConfig=null] Rule OSD configuration, used when the rule presents
     * metadata for providing an analytic overlay over video.
     * @param {Boolean} [metadataEnabled=false] Whether metadata is enabled on this rule. If true, push notifications
     * for the rule will be dispatched with the metadata for the triggered event as part of the notification payload.
     * @param {EVWEB2.EventMetadataTemplate[]} [metadataTemplates=[]] The set of metadata fields that status
     * events for this rule may present.
     * @class
     * @category Analytics
     */
    EVWEB2.AnalyticRule = function(server, id, deviceId, sourceId, name, osdConfig, metadataEnabled,
        metadataTemplates) {
        /**
         * The server that hosts this rule.
         * @type {EVWEB2.Server}
         */
        this.server = server || null;

        /**
         * The rule ID.
         * @type {Number}
         */
        this.id = id || 0;

        /**
         * The ID of the IP device to which this rule is attached. This is not necessarily the source that emits the
         * data being tracked for analytic matches, see {@link EVWEB2.AnalyticRule#sourceId|this.sourceId} to determine
         * the nature of that association.
         * @type {Number}
         */
        this.deviceId = deviceId || 0;

        /**
         * The identifier of the source with which this rule is associated.
         * @type {EVWEB2.AssociatedCameraSource|EVWEB2.AssociatedAudioSource}
         */
        this.sourceId = sourceId || null;

        /**
         * The name of this rule.
         * @type {String}
         */
        this.name = name || '';

        /**
         * Rule OSD configuration, used when the rule presents metadata for drawing shapes over video.
         * @type {EVWEB2.AnalyticRuleOSDConfig}
         */
        this.osdConfig = osdConfig || null;

        /**
         * Whether metadata is enabled on this rule (presented on status events).
         * @type {Boolean}
         */
        this.metadataEnabled = metadataEnabled || false;

        /**
         * The set of metadata fields that status events for this rule may present.
         * @type {EVWEB2.EventMetadataTemplate[]}
         */
        this.metadataTemplates = metadataTemplates || [];
        
        /**
         * Callback invoked by
         * {@link EVWEB2.AnalyticRule#pushNotificationSubscribe|pushNotificationSubscribe()}.
         * @callback EVWEB2.AnalyticRule~onPushNotificationSubscribe
         * @param {EVWEB2.ResponseStatus} response Success state of the response.
         */
        /**
         * Register a client to receive push notifications for alarmed matches associated with this rule.
         * @param {EVWEB2.AnalyticRule~onPushNotificationSubscribe} callback Callback to be invoked on completion.
         * @param {String} clientId The client ID, generated in a previous call to
         * {@link EVWEB2.PushNotification#registerClient|EVWEB2.PushNotification.registerClient()}.
         */
        this.pushNotificationSubscribe = function(callback, clientId) {
            var onSuccess = function(data/*, textStatus, xhr*/) {
                callback(new EVWEB2.ResponseStatus(data.success));
            };
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                callback(new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr)));
            };

            EVWEB2.ajax({
                url: this.server.service.url() + EVWEB2.urls.analyticRulePush,
                type: 'POST',
                data: {
                    s: this.server.sessionId,
                    clientId: clientId,
                    deviceId: this.deviceId,
                    ruleId: this.id
                },
                success: onSuccess,
                error: onError
            }, this.server.service);
        };
        
        /**
         * Callback invoked by
         * {@link EVWEB2.AnalyticRule#pushNotificationUnsubscribe|pushNotificationUnsubscribe()}.
         * @callback EVWEB2.AnalyticRule~onPushNotificationUnsubscribe
         * @param {EVWEB2.ResponseStatus} response Success state of the response.
         */
        /**
         * Remove a client's registration for push notifications associated with this rule.
         * @param {EVWEB2.AnalyticRule~onPushNotificationUnsubscribe} callback Callback to be invoked on completion.
         * @param {String} clientId The client ID, generated in a previous call to
         * {@link EVWEB2.PushNotification#registerClient|EVWEB2.PushNotification.registerClient()}.
         */
        this.pushNotificationUnsubscribe = function(callback, clientId) {
            var onSuccess = function(data/*, textStatus, xhr*/) {
                callback(new EVWEB2.ResponseStatus(data.success));
            };
            var onError = function(xhr/*, textStatus, errorThrown*/) {
                callback(new EVWEB2.ResponseStatus(false, EVWEB2.util.getErrorText(xhr)));
            };

            EVWEB2.ajax({
                url: this.server.service.url() + EVWEB2.urls.analyticRulePush,
                type: 'DELETE',
                data: {
                    s: this.server.sessionId,
                    clientId: clientId,
                    deviceId: this.deviceId,
                    ruleId: this.id
                },
                success: onSuccess,
                error: onError
            }, this.server.service);
        };
    };

    /**
     * OSD configuration for an analytic rule that draws shapes over video.
     * @param {RGBA} [backgroundColor=[0,0,0,0]] The overlay background color.
     * @param {RGBA} [borderColor=[0,0,0,0]] The overlay border color.
     * @class
     * @category Analytics
     */
    EVWEB2.AnalyticRuleOSDConfig = function(backgroundColor, borderColor) {
        /**
         * The overlay background color.
         * @type {RGBA}
         */
        this.backgroundColor = backgroundColor || [0,0,0,0];

        /**
         * The overlay border color.
         * @type {RGBA}
         */
        this.borderColor = borderColor || [0,0,0,0];
    };
}());

/*globals EVWEB2:true*/
(function() {
    'use strict';

    /**
     * Enumeration of event metadata types.
     * @enum {Number}
     * @readonly
     * @category Events
     */
    EVWEB2.eventMetadataValueType = {
        /**
         * Unknown (invalid)
         */
        unknown: 0,
        /**
         * Numeric form
         */
        number: 1,
        /**
         * String form
         */
        string: 2,
        /**
         * Well-known textual representation of geometry (WKT) form,
         * as specified in ISO/IEC 13249-3:2016
         */
        wkt: 3
    };

    /**
     * Defines a metadata template (a key-value set that different status events may present).
     * Metadata that may be provided alongside analytic status events are as follows:
     * <pre>
     * * "ObjectId": {@link EVWEB2.eventMetadataValueType.string}
     * * "BoundingBox": {@link EVWEB2.eventMetadataValueType.wkt}
     * * "PersonKey": {@link EVWEB2.eventMetadataValueType.string}
     * </pre>
     * @param {String} [key=''] The key.
     * @param {EVWEB2.eventMetadataValueType} [valueType=EVWEB2.eventMetadataValueType.unknown] The type of value.
     * @class
     * @category Events
     */
    EVWEB2.EventMetadataTemplate = function(key, valueType) {
        /**
         * The key.
         * @type {String}
         */
        this.key = key || '';

        /**
         * The type of value.
         * @type {EVWEB2.eventMetadataValueType}
         */
        this.valueType = valueType || EVWEB2.eventMetadataValueType.unknown;
    };
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInYyLnMyTG9hZGVyLmpzIiwidjIuY29yZS5qcyIsInYyLnJlc3BvbnNlU3RhdHVzLmpzIiwidjIubG9nZ2luZy5qcyIsInYyLnV0aWwuanMiLCJ2Mi51dGlsLmludGVybmFsLmpzIiwidjIuc2VydmljZS5qcyIsInYyLnNlcnZpY2UuY29uZmlnLmpzIiwidjIuc2VydmljZS5oZWFsdGguanMiLCJ2Mi5zZXJ2aWNlLnN0YXR1cy5qcyIsInYyLnNlcnZpY2VVcGRhdGUuanMiLCJ2Mi5zZXJ2aWNlQXV0aC5qcyIsInYyLmRpc2NvdmVyeS5qcyIsInYyLnNlcnZlci5qcyIsInYyLnRyaWdnZXIuanMiLCJ2Mi52aWV3LmpzIiwidjIubWV0YWRhdGEuanMiLCJ2Mi5zZWFyY2guanMiLCJ2Mi5sYXlvdXQuanMiLCJ2Mi5hdWRpby5qcyIsInYyLmV4cG9ydC5qcyIsInYyLm1hcC5qcyIsInYyLnN0YXR1cy5qcyIsInYyLmdyb3VwLmpzIiwidjIudGh1bWJuYWlsLmpzIiwidjIudG91cnMuanMiLCJ2Mi5hc3NvY2lhdGlvbnMuanMiLCJ2Mi5zZWN1cml0eUludGVncmF0aW9ucy5qcyIsInYyLmNhbWVyYS5qcyIsInYyLnN5c3RlbUNvbmZpZy5qcyIsInYyLnZpZGVvcHVzaC5qcyIsInYyLnNlcnZlckNvbmZpZy5qcyIsInYyLmRldmljZUNvbmZpZy5qcyIsInYyLnNlcnZlci1kZXByZWNhdGVkLmpzIiwidjIudXNlci5qcyIsInYyLnVzZXJHcm91cC5qcyIsInYyLmV2ZW50bW9uaXRvcmluZy5qcyIsInYyLnB1c2hub3RpZmljYXRpb24uanMiLCJ2Mi53ZWJzb2NrZXQuanMiLCJ2Mi53ZWJzb2NrZXRMZWdhY3kuanMiLCJ2Mi5ib29rbWFya2luZy5qcyIsInYyLnNlcmlhbC5qcyIsInYyLmV2ZW50LmpzIiwidjIuYXJjaGl2ZS5qcyIsInYyLnZpZGVvLmpzIiwidjIuYW5hbHl0aWNzLmpzIiwidjIuZXZlbnQubWV0YWRhdGEuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcmxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25rRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFnR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0ZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdmxCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMTBFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdmVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMWpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDejNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25TQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDblRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM1dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdk9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDanVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzkwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ROQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25PQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3I1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOTRDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOWpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3B6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwaS12Mi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFscyBzMjpmYWxzZSxldl9VUkw6ZmFsc2Usd2lyZVVwUzJDdXN0b21pemF0aW9uczpmYWxzZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgLy8gTG9hZCBTMiBDdXN0b21pemF0aW9uc1xuICAgIGlmICh3aW5kb3cubG9hZENhbWVyYSAmJiB0eXBlb2YgczIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICAgICAgICBzY3JpcHQuc2V0QXR0cmlidXRlKFwic3JjXCIsIGV2X1VSTCArIFwiczIuanNcIik7XG4gICAgICAgIHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dC9qYXZhc2NyaXB0XCIpO1xuXG4gICAgICAgIHZhciBjYWxsYmFja1BlcmZvcm1lZCA9IGZhbHNlO1xuXG4gICAgICAgIHZhciBvbkxvYWRGdW5jdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gc2NyaXB0LnJlYWR5U3RhdGU7XG5cbiAgICAgICAgICAgIGlmICghY2FsbGJhY2tQZXJmb3JtZWQgJiYgKCFzdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KHN0YXRlKSkpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFja1BlcmZvcm1lZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgd2lyZVVwUzJDdXN0b21pemF0aW9ucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vT25jZSB0aGUgc2NyaXB0IGhhcyBsb2FkZWQsIGNhbGwgdGhlIHdpcmUgdXAgZnVuY3Rpb25cbiAgICAgICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG9uTG9hZEZ1bmN0aW9uO1xuICAgICAgICBzY3JpcHQub25sb2FkID0gb25Mb2FkRnVuY3Rpb247XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgIH1cbn0oKSk7IiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIFRoZSByb290IGdsb2JhbCBvYmplY3QgZm9yIHRoaXMgQVBJLlxuICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAqL1xuICAgIHdpbmRvdy5FVldFQjIgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEFkdmFuY2VkIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4gIFRoZXNlIHNob3VsZCBub3QgYmUgbW9kaWZpZWQuXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKi9cbiAgICBFVldFQjIuY29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRlZmF1bHQgc3RyZWFtIElEIHRvIGJlIHVzZWQgd2hlbiByZXF1ZXN0aW5nIHZpZGVvLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIGRlZmF1bHRTdHJlYW1JZDogbnVsbCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVydmFsIGZvciBwb2xsaW5nIGEgdHJpZ2dlciBvbiwgaW4gbWlsbGlzZWNvbmRzLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRyaWdnZXJQb2xsaW5nUmF0ZTogMTAwMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRpbWVvdXQgc3BlY2lmaWVkIGZvciBKU09OUCByZXF1ZXN0cyBiZWZvcmUgaXNzdWluZyBhbiBlcnJvciByZXNwb25zZS5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICBqc29ucFJlcXVlc3RUaW1lb3V0OiA1MDAwXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIFVzZSBPbmx5LiBUaGUgYmFzZSBlcnJvciBzdHJpbmdzIHJldHVybmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKiBAdHlwZSBPYmplY3RcbiAgICAgKi9cbiAgICBFVldFQjIuZXJyb3JzID0ge1xuICAgICAgICBjb25maWc6IFwiaW52YWxpZCBzZXNzaW9uXCIsXG4gICAgICAgIHNlcnZlcnM6IFwie1xcblxcdEVSUk9SXFxufVwiLFxuICAgICAgICBsb2dpbjogJzwhRE9DVFlQRSBIVE1MIFBVQkxJQyBcXFwiLS8vVzNDLy9EVEQgSFRNTCA0LjAxLy9FTlxcXCI+JyArXG4gICAgICAgICAgICAnXFxuPGh0bWw+XFxuPGhlYWQ+XFxuPHRpdGxlPkNvbmZpZzwvdGl0bGU+XFxuPC9oZWFkPlxcbjxib2R5PlxcbjxoMT5FcnJvcjwvaDE+XFxuPC9ib2R5PlxcbjwvaHRtbD4nLFxuICAgICAgICB0cmlnZ2VyczogXCJ7XFxuXFx0RVJST1JcXG59XCIsXG4gICAgICAgIHB0ejogXCJ7XFxuXFx0RVJST1JcXG59XCIsXG4gICAgICAgIHNlYXJjaDogXCJ7XFxuXFx0RVJST1JcXG59XCIsXG4gICAgICAgIGpzb25Mb2dpbkZhaWxlZDogJ0xvZ2luIGZhaWxlZCdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRm9yd2FyZCBkZWNsYXJhdGlvbiBvZiBFVldFQjIuYWpheCBhbGlhcyBvZiB7QGxpbmsgRVZXRUIyLnV0aWwuaW50ZXJuYWwuYWpheH0sIGRlZmluZWQgZm9yXG4gICAgICogY29udmVuaWVuY2UuICBUaGUgYWN0dWFsIGFzc2lnbm1lbnQgb2YgdGhpcyBhbGlhcyBpcyBwZXJmb3JtZWQgd2l0aCB0aGUgZGVmaW5pdGlvbiBvZiB0aGVcbiAgICAgKiBhY3R1YWwgaW1wbGVtZW50YXRpb24uXG4gICAgICogQGlnbm9yZVxuICAgICAqIEB0eXBlIEZ1bmN0aW9uXG4gICAgICovXG4gICAgRVZXRUIyLmFqYXggPSB1bmRlZmluZWQ7XG5cblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIFVzZSBPbmx5LiBUaGUgVVJMIGVuZHBvaW50cyBmb3IgdGhlIHZhcmlvdXMgd2ViIHNlcnZpY2UgY2FsbHMuXG4gICAgICogQGlnbm9yZVxuICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAqL1xuICAgIEVWV0VCMi51cmxzID0ge1xuICAgICAgICBnZXRTZXJ2ZXJMaXN0OiAnbG9naW4ud2ViP291dHB1dD1qc29uJyxcbiAgICAgICAgZ2V0Q2FtZXJhTGlzdDogJ2NvbmZpZy53ZWInLFxuICAgICAgICBnZXRWaWV3TGlzdDogJ3ZpZXcud2ViJyxcbiAgICAgICAgbG9naW46ICdsb2dpbi53ZWInLFxuICAgICAgICBsb2dvdXQ6ICdsb2dvdXQud2ViJyxcbiAgICAgICAgbGVnYWN5R2V0RnJhbWU6ICdwdWxsLndlYicsXG4gICAgICAgIHZpZGVvOiAndmlkZW8ud2ViJyxcbiAgICAgICAgc2VhcmNoOiAnc2VhcmNoLndlYicsXG4gICAgICAgIHNlYXJjaFN0YXR1czogJ3NlYXJjaC53ZWIvc3RhdHVzJyxcbiAgICAgICAgc3BlZWQ6ICdwbGF5c3BlZWQud2ViJyxcbiAgICAgICAgc3RlcDogJ3N0ZXAud2ViJyxcbiAgICAgICAgdGltZTogJ3RpbWVzdGFtcC53ZWInLFxuICAgICAgICBwdHo6ICdwdHoud2ViJyxcbiAgICAgICAgdHJpZ2dlcjogJ3RyaWdnZXIud2ViJyxcbiAgICAgICAgbWV0YWRhdGE6ICdtZXRhZGF0YS53ZWInLFxuICAgICAgICByZXNvdXJjZUtleTogJ2tleS53ZWInLFxuICAgICAgICB2ZXJzaW9uOiAndmVyc2lvbi53ZWInLFxuICAgICAgICBkaWdpdGFsUHR6OiAnZGlnaXRhbHB0ei53ZWInLFxuICAgICAgICBzZXJ2aWNlOiAnc2VydmljZS53ZWInLFxuICAgICAgICBzZXJ2aWNlRGlzY292ZXJ5OiAnc2VydmljZS53ZWIvZGlzY292ZXJ5JyxcbiAgICAgICAgYXVkaW86ICdhdWRpby53ZWInLFxuICAgICAgICB2aWRlb2V4cG9ydDogJ2V4cG9ydC53ZWInLFxuICAgICAgICBtYXA6ICdtYXAud2ViJyxcbiAgICAgICAgc3RhdHVzOiAnc3RhdHVzLndlYicsXG4gICAgICAgIGdyb3VwczogJ2dyb3Vwcy53ZWInLFxuICAgICAgICB0aHVtYm5haWw6ICd0aHVtYm5haWwud2ViJyxcbiAgICAgICAgdG91cnM6ICd0b3VyLndlYicsXG4gICAgICAgIHNlcnZlclVzZXJzOiAnc2VydmVyLndlYi91c2VycycsXG4gICAgICAgIHNlcnZlclBsdWdpbnM6ICdzZXJ2ZXIud2ViL3BsdWdpbnMnLFxuICAgICAgICBoZWFsdGg6ICdoZWFsdGgud2ViJyxcbiAgICAgICAgc3lzdGVtSW5mbzogJ3NlcnZlci53ZWInLFxuICAgICAgICB2aWRlb3B1c2g6ICd2aWRlb3B1c2gud2ViJyxcbiAgICAgICAgdmlkZW9wdXNoTWVzc2FnZTogJ3ZpZGVvcHVzaC53ZWIvbWVzc2FnZScsXG4gICAgICAgIGRldmljZXM6ICdzZXJ2ZXIud2ViL2RldmljZXMnLFxuICAgICAgICBkZXZpY2VUeXBlczogJ3NlcnZlci53ZWIvZGV2aWNlcy90eXBlcycsXG4gICAgICAgIGNhY2hlZFRodW1ibmFpbDogJ3ZpZGVvLndlYi90aHVtYm5haWwnLFxuICAgICAgICBjYW1lcmE6ICdjYW1lcmEud2ViJyxcbiAgICAgICAgY29uZmlnVXBkYXRlU3RhdHVzOiAnc2VydmVyLndlYi9ldmVudHMvc3RhdHVzJyxcbiAgICAgICAgdXNlcnM6ICd1c2Vycy53ZWInLFxuICAgICAgICB1c2VyR3JvdXBzOiAndXNlcnMud2ViL2dyb3VwcycsXG4gICAgICAgIGV2ZW50TW9uaXRvcmluZzogJ2V2ZW50bW9uaXRvcmluZy53ZWInLFxuICAgICAgICBldmVudE1vbml0b3JpbmdQdXNoOiAnZXZlbnRtb25pdG9yaW5nLndlYi9wdXNoJyxcbiAgICAgICAgcHVzaE5vdGlmaWNhdGlvbjogJ3B1c2hub3RpZmljYXRpb24ud2ViJyxcbiAgICAgICAgYnJva2VyQ29uZmlnOiAnYnJva2VyLndlYi9jb25maWcnLFxuICAgICAgICBsZWdhY3lXZWJzb2NrZXRTdGF0dXM6ICdzdGF0dXMud2ViL2xlZ2FjeXdlYnNvY2tldCcsXG4gICAgICAgIGxlZ2FjeVdlYnNvY2tldENhbWVyYXNPc2Q6ICdjYW1lcmEud2ViL2xlZ2FjeXdlYnNvY2tldCcsXG4gICAgICAgIGF1dGg6ICdhdXRoLndlYicsXG4gICAgICAgIGF1dGhMb2dvdXQ6ICdhdXRoLndlYi9sb2dvdXQnLFxuICAgICAgICBib29rbWFyazogJ2Jvb2ttYXJrLndlYicsXG4gICAgICAgIGJvb2ttYXJrSXRlbXM6ICdib29rbWFyay53ZWIvaXRlbXMnLFxuICAgICAgICBib29rbWFya0Nhc2VzOiAnYm9va21hcmsud2ViL2Nhc2VzJyxcbiAgICAgICAgYXNzb2NpYXRpb25zOiAnYXNzb2NpYXRpb25zLndlYicsXG4gICAgICAgIGFzc29jaWF0aW9uc0NhbWVyYTogJ2Fzc29jaWF0aW9ucy53ZWIvY2FtZXJhJyxcbiAgICAgICAgYXNzb2NpYXRpb25zQ2FtZXJhSXRlbTogJ2Fzc29jaWF0aW9ucy53ZWIvY2FtZXJhL2l0ZW0nLFxuICAgICAgICBzZWN1cml0eUludGVncmF0aW9uRGV2aWNlczogJ3NlY3VyaXR5aW50ZWdyYXRpb25zLndlYicsXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlTG9naW46ICdzZWN1cml0eWludGVncmF0aW9ucy53ZWIvbG9naW4nLFxuICAgICAgICBzZWN1cml0eUludGVncmF0aW9uc0RldmljZVNlbnNvcnM6ICdzZWN1cml0eWludGVncmF0aW9ucy53ZWIvc2Vuc29ycycsXG4gICAgICAgIHNlcnZlclNlcmlhbEluZm86ICdzZXJ2ZXIud2ViL3NlcmlhbCcsXG4gICAgICAgIHNlcmlhbERldmljZXM6ICdzZXJpYWwud2ViJyxcbiAgICAgICAgc2VyaWFsRGF0YTogJ3NlcmlhbC53ZWIvZGF0YScsXG4gICAgICAgIHNlcmlhbFN0b3JlZERhdGE6ICdzZXJpYWwud2ViL2RhdGEvc3RvcmVkJyxcbiAgICAgICAgc2VyaWFsUHJvZmlsZXM6ICdzZXJpYWwud2ViL3Byb2ZpbGUnLFxuICAgICAgICBzZXJpYWxQcm9maWxlS2V5d29yZHM6ICdzZXJpYWwud2ViL3Byb2ZpbGUva2V5d29yZHMnLFxuICAgICAgICBzZXJpYWxQcm9maWxlTGluZU1hc2tzOiAnc2VyaWFsLndlYi9wcm9maWxlL21hc2tzJyxcbiAgICAgICAgc2VyaWFsUHJvZmlsZVJlcGxhY2VtZW50czogJ3NlcmlhbC53ZWIvcHJvZmlsZS9yZXBsYWNlbWVudHMnLFxuICAgICAgICBzZXJpYWxQcm9maWxlUnVsZXM6ICdzZXJpYWwud2ViL3Byb2ZpbGUvcnVsZXMnLFxuICAgICAgICBzZXJ2aWNlSW5mbzogJ3NlcnZpY2Uud2ViL2luZm8nLFxuICAgICAgICBzZXJ2aWNlQ29uZmlnVG9rZW46ICdzZXJ2aWNlLndlYi90b2tlbicsXG4gICAgICAgIHNlcnZpY2VDb25maWdTZXJ2ZXJzOiAnc2VydmljZS53ZWIvc2VydmVycycsXG4gICAgICAgIHNlcnZpY2VDb25maWdTZXJ2ZXJzWGR2OiAnc2VydmljZS53ZWIvc2VydmVycy94ZHYnLFxuICAgICAgICBzZXJ2aWNlQ29uZmlnUmVtb3RlU2VydmVyczogJ3NlcnZpY2Uud2ViL3JlbW90ZXNlcnZlcnMnLFxuICAgICAgICBzZXJ2aWNlQ29uZmlnUmVtb3RlU2VydmVyc0xpc3RlbmVyOiAnc2VydmljZS53ZWIvcmVtb3Rlc2VydmVycy9saXN0ZW5lcicsXG4gICAgICAgIHNlcnZpY2VDb25maWdMb2dnaW5nOiAnc2VydmljZS53ZWIvbG9nZ2luZycsXG4gICAgICAgIHNlcnZpY2VDb25maWdMb2dnaW5nRmlsZTogJ3NlcnZpY2Uud2ViL2xvZ2dpbmcvZmlsZScsXG4gICAgICAgIHNlcnZpY2VDb25maWdCYXNpYzogJ3NlcnZpY2Uud2ViL2NvbmZpZycsXG4gICAgICAgIHNlcnZpY2VDb25maWdVcGRhdGVzOiAnc2VydmljZS53ZWIvdXBkYXRlcycsXG4gICAgICAgIHNlcnZpY2VDb25maWdFeHRlcm5hbEF1dGg6ICdzZXJ2aWNlLndlYi9leHRlcm5hbGF1dGgnLFxuICAgICAgICBzZXJ2aWNlQ29uZmlnQWRtaW46ICdzZXJ2aWNlLndlYi9hZG1pbicsXG4gICAgICAgIHNlcnZpY2VDb25maWdTdGF0dXM6ICdzZXJ2aWNlLndlYi9zdGF0dXMnLFxuICAgICAgICBzZXJ2aWNlQ29ubmVjdGl2aXR5U3RhdHVzOiAnc2VydmljZS53ZWIvc3RhdHVzL2Nvbm5lY3Rpdml0eScsXG4gICAgICAgIHNlcnZpY2VTZXJ2ZXJTdGF0dXM6ICdzZXJ2aWNlLndlYi9zdGF0dXMvc2VydmVyJyxcbiAgICAgICAgc2VydmljZVNTTENvbmZpZ1R5cGU6ICdzZXJ2aWNlLndlYi9jb25maWcvc3NsJyxcbiAgICAgICAgc2VydmljZVNTTEV4dGVybmFsQ29uZmlnOiAnc2VydmljZS53ZWIvY29uZmlnL3NzbC9leHRlcm5hbCcsXG4gICAgICAgIHNlcnZpY2VTU0xBY21lQ29uZmlnOiAnc2VydmljZS53ZWIvY29uZmlnL3NzbC9hY21lJyxcbiAgICAgICAgc2VydmljZVNTTEFjbWVTdGF0dXM6ICdzZXJ2aWNlLndlYi9jb25maWcvc3NsL2FjbWUvc3RhdHVzJyxcbiAgICAgICAgc2VydmljZVJlc3RvcmVEZWZhdWx0czogJ3NlcnZpY2Uud2ViL3Jlc2V0JyxcbiAgICAgICAgZXZlbnRzOiAnZXZlbnRzLndlYicsXG4gICAgICAgIGFyY2hpdmVUYXJnZXRzOiAnc2VydmVyLndlYi9hcmNoaXZlJyxcbiAgICAgICAgc2VhcmNoVmlkZW86ICd2aWRlby53ZWIvc2VhcmNoJyxcbiAgICAgICAgYWRkcmVzc2VzOiAnc2VydmljZS53ZWIvYWRkcmVzc2VzJyxcbiAgICAgICAgYW5hbHl0aWNSdWxlczogJ2FuYWx5dGljcy53ZWIvcnVsZXMnLFxuICAgICAgICBhbmFseXRpY1J1bGVQdXNoOiAnYW5hbHl0aWNzLndlYi9ydWxlcy9wdXNoJyxcbiAgICAgICAgc2VhcmNoU25hcHNob3Q6ICd2aWRlby53ZWIvc2VhcmNoL3NuYXBzaG90J1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFRoZSBmb250IHN0eWxlcyBhdmFpbGFibGUuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi5mb250U3R5bGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm9ybWFsXG4gICAgICAgICAqL1xuICAgICAgICBub3JtYWw6IDkwLFxuICAgICAgICAvKipcbiAgICAgICAgICogSXRhbGljXG4gICAgICAgICAqL1xuICAgICAgICBpdGFsaWM6IDkzLFxuICAgICAgICAvKipcbiAgICAgICAgICogU2xhbnRcbiAgICAgICAgICovXG4gICAgICAgIHNsYW50OiA5NFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZm9udCBjb2xvcnMgYXZhaWxhYmxlLlxuICAgICAqIEBlbnVtIHtOdW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuZm9udENvbG9yID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogVW5rbm93blxuICAgICAgICAgKi9cbiAgICAgICAgdW5rbm93bjogLTEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGl0ZVxuICAgICAgICAgKi9cbiAgICAgICAgd2hpdGU6IDBYRkZGRkZGLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXF1YVxuICAgICAgICAgKi9cbiAgICAgICAgYXF1YTogMFgwMEZGRkYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGdXNoaWFcbiAgICAgICAgICovXG4gICAgICAgIGZ1c2hpYTogMFhGRjAwRkYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBZZWxsb3dcbiAgICAgICAgICovXG4gICAgICAgIHllbGxvdzogMFhGRkZGMDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaWx2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHNpbHZlcjogMFhDMEMwQzAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWRcbiAgICAgICAgICovXG4gICAgICAgIHJlZDogMFhGRjAwMDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaW1lXG4gICAgICAgICAqL1xuICAgICAgICBsaW1lOiAwWDAwRkYwMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJsdWVcbiAgICAgICAgICovXG4gICAgICAgIGJsdWU6IDBYMDAwMEZGLFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JheVxuICAgICAgICAgKi9cbiAgICAgICAgZ3JheTogMFg4MDgwODAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZWFsXG4gICAgICAgICAqL1xuICAgICAgICB0ZWFsOiAwWDAwODA4MCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFB1cnBsZVxuICAgICAgICAgKi9cbiAgICAgICAgcHVycGxlOiAwWDgwMDA4MCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9saXZlXG4gICAgICAgICAqL1xuICAgICAgICBvbGl2ZTogMFg4MDgwMDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCbGFja1xuICAgICAgICAgKi9cbiAgICAgICAgYmxhY2s6IDBYMDAwMDAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFyb29uXG4gICAgICAgICAqL1xuICAgICAgICBtYXJvb246IDBYODAwMDAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JlZW5cbiAgICAgICAgICovXG4gICAgICAgIGdyZWVuOiAwWDAwODAwMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hdnlcbiAgICAgICAgICovXG4gICAgICAgIG5hdnk6IDBYMDAwMDgwXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBmb250IHdlaWdodHMgYXZhaWxhYmxlLlxuICAgICAqIEBlbnVtIHtOdW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuZm9udFdlaWdodCA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaWdodFxuICAgICAgICAgKi9cbiAgICAgICAgbGlnaHQ6IDkwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQm9sZFxuICAgICAgICAgKi9cbiAgICAgICAgYm9sZDogOTJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGZvbnQgZmFtaWxpZXMgYXZhaWxhYmxlLlxuICAgICAqIEBlbnVtIHtOdW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuZm9udEZhbWlseSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWZhdWx0IEZvbnRcbiAgICAgICAgICovXG4gICAgICAgIGRlZmF1bHRGb250OiA3MCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlY29yYXRpdmVcbiAgICAgICAgICovXG4gICAgICAgIGRlY29yYXRpdmU6IDcxLFxuICAgICAgICAvKipcbiAgICAgICAgICogUm9tYW5cbiAgICAgICAgICovXG4gICAgICAgIHJvbWFuOiA3MixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNjcmlwdFxuICAgICAgICAgKi9cbiAgICAgICAgc2NyaXB0OiA3MyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN3aXNzXG4gICAgICAgICAqL1xuICAgICAgICBzd2lzczogNzQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb2Rlcm5cbiAgICAgICAgICovXG4gICAgICAgIG1vZGVybjogNzUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUZWxldHlwZVxuICAgICAgICAgKi9cbiAgICAgICAgdGVsZXR5cGU6IDc2XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgZm9udCBpbmZvcm1hdGlvbi4gIFVzZWQgcHJpbWFyaWx5IGJ5IHtAbGluayBFVldFQjIuQXNzb2NpYXRpb259LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZm9udD0nU2FucyddIFRoZSBuYW1lIG9mIHRoZSBmb250LlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbc2l6ZT0xMF0gVGhlIGZvbnQgc2l6ZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5mb250U3R5bGV9IFtzdHlsZT1FVldFQjIuZm9udFN0eWxlLm5vcm1hbF0gVGhlIGZvbnQgc3R5bGUgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmZvbnRDb2xvcn0gW2NvbG9yPUVWV0VCMi5mb250Q29sb3Iud2hpdGVdIFRoZSBmb250IGNvbG9yIHVzZWQgZm9yIGRpc3BsYXlpbmcgdGV4dC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5mb250RmFtaWx5fSBbZmFtaWx5PUVWV0VCMi5mb250RmFtaWx5LmRlZmF1bHRGb250XSBUaGUgZm9udCBmYW1pbHkgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmZvbnRXZWlnaHR9IFt3ZWlnaHQ9RVZXRUIyLmZvbnRXZWlnaHQubGlnaHRdIFRoZSBmb250IHdlaWdodCB1c2VkIGZvciBkaXNwbGF5aW5nIHRleHQuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbdW5kZXJsaW5lPWZhbHNlXSBXaGV0aGVyIHRoZSBmb250IHNob3VsZCBiZSB1bmRlcmxpbmVkLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLkZvbnRJbmZvID0gZnVuY3Rpb24oZm9udCwgc2l6ZSwgc3R5bGUsIGNvbG9yLCBmYW1pbHksIHdlaWdodCwgdW5kZXJsaW5lKXtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hbWUgb2YgdGhlIGZvbnQuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZvbnQgPSAnU2Fucyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmb250IHNpemUuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNpemUgPSAxMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgc3R5bGUgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmZvbnRTdHlsZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3R5bGUgPSBFVldFQjIuZm9udFN0eWxlLm5vcm1hbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgY29sb3IgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmZvbnRDb2xvcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29sb3IgPSBFVldFQjIuZm9udENvbG9yLndoaXRlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9udCBmYW1pbHkgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmZvbnRGYW1pbHl9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZhbWlseSA9IEVWV0VCMi5mb250RmFtaWx5LmRlZmF1bHRGb250O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9udCB3ZWlnaHQgdXNlZCBmb3IgZGlzcGxheWluZyB0ZXh0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmZvbnRXZWlnaHR9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndlaWdodCA9IEVWV0VCMi5mb250V2VpZ2h0LmxpZ2h0O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBmb250IHNob3VsZCBiZSB1bmRlcmxpbmVkLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudW5kZXJsaW5lID0gZmFsc2U7XG5cbiAgICAgICAgaWYoZm9udCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZvbnQgPSBmb250O1xuICAgICAgICB9XG4gICAgICAgIGlmKHNpemUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zaXplID0gc2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBpZihzdHlsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlID0gc3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIGlmKGZhbWlseSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZhbWlseSA9IGZhbWlseTtcbiAgICAgICAgfVxuICAgICAgICBpZih3ZWlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy53ZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodW5kZXJsaW5lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudW5kZXJsaW5lID0gdW5kZXJsaW5lO1xuICAgICAgICB9XG4gICAgfTtcblxufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgLyoqXG4gICAgICogUGFzc2VkIGZvciBhbGwge0BsaW5rIEVWV0VCMn0gY2FsbHMgdGhhdCByZXR1cm4gYSByZXN1bHQgYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBvZiBldmVyeSByZXNwb25zZSBjYWxsYmFjayB0b1xuICAgICAqIHByb3ZpZGUgaW5mb3JtYXRpb24gb24gdGhlIHN1Y2Nlc3MvZmFpbHVyZSBvZiBhIHJlcXVlc3QuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBzdWNjZXNzIFdoZXRoZXIgdGhlIHJlcXVlc3Qgc3VjY2VlZGVkXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtlcnJvclRleHRdIEVycm9yIHRleHQgb2YgdGhlIHJlc3BvbnNlXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtlcnJvckNvZGVdIEVycm9yIGNvZGUgb2YgdGhlIHJlc3BvbnNlLiAgKFJlc2VydmVkIGZvciBmdXR1cmUgdXNlLilcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi5SZXNwb25zZVN0YXR1cyA9IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yVGV4dCwgZXJyb3JDb2RlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSByZXF1ZXN0IHN1Y2NlZWRlZFxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1Y2Nlc3MgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVycm9yIHRleHQgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXJyb3JUZXh0ID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBlcnJvciBjb2RlIG9mIHRoZSByZXNwb25zZS4gIChOb3QgY3VycmVudGx5IHVzZWQpXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcnJvckNvZGUgPSAwO1xuXG4gICAgICAgIGlmKHR5cGVvZiBzdWNjZXNzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zdWNjZXNzID0gc3VjY2VzcztcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZXJyb3JUZXh0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5lcnJvclRleHQgPSBlcnJvclRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGVycm9yQ29kZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JDb2RlID0gZXJyb3JDb2RlO1xuICAgICAgICB9XG4gICAgfTtcbn0oKSk7IiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cblxuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogQmFzaWMgY29udGFpbmVyIGZvciBsb2cgaXRlbXMuXG4gICAgICogQHBhcmFtIHtEYXRlfSB0aW1lIFRoZSB0aW1lIGF0IHdoaWNoIHRoZSBsb2cgaXRlbSB3YXMgcmVjb3JkZWQuXG4gICAgICogQHBhcmFtIHtBcnJheX0gYXJncyBUaGUgYXJyYXkgb2YgYXJndW1lbnRzIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24uXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuTG9nSXRlbSA9IGZ1bmN0aW9uKHRpbWUsIGFyZ3MpIHtcbiAgICAgICAgdGhpcy50aW1lID0gdGltZTtcbiAgICAgICAgdGhpcy5hcmdzID0gYXJncztcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBMb2dnaW5nIHN5c3RlbS4gIFdyYXBzIGNvbnNvbGUubG9nLCBkZWJ1ZywgYW5kIGVycm9yLCBmaWx0ZXJpbmcgb3V0IG1lc3NhZ2VzIGlmIGl0IGlzIG5vdFxuICAgICAqIGVuYWJsZWQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuTG9nZ2luZyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGxvZ2dpbmcgaXMgZW5hYmxlZCBvciBub3QuICBJZiBub3QgZW5hYmxlZCwgdGhlIHBhc3RcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5Mb2dnaW5nLnJlY29yZHNUb1N0b3JlfSB3aWxsIGJlIHN0b3JlZCwgYnV0IG5vbmUgd2lsbCBiZSB3cml0dGVuIG91dCB0byB0aGVcbiAgICAgICAgICogY29uc29sZS5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHJlY29yZHMgdG8gc3RvcmUgZm9yIGVhY2ggbG9nIHR5cGUuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlY29yZHNUb1N0b3JlID0gNTA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0b3JlcyB0aGUgcGFzdCB7QGxpbmsgRVZXRUIyLkxvZ2dpbmcucmVjb3Jkc1RvU3RvcmV9IGxvZ3Mgb2YgZWFjaCB0eXBlIHBhc3NlZCBpbnRvIGNvbnNvbGUuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtPYmplY3R9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgbG9ncyA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGxpc3Qgb2YgdGhlIHN1cHBvcnRlZCBjb25zb2xlIG1ldGhvZHMgdGhhdCBhcmUgd3JhcHBlZC4gIFRoZXNlIGNhbiBiZSBleHRlbmRlZCB0b1xuICAgICAgICAgKiBpbmNsdWRlIG90aGVycywgaWYgbmVjZXNzYXJ5LlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nW119XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgY29uc29sZU1lc3NhZ2VzID0gWydsb2cnLCAnZGVidWcnLCAnZXJyb3InXTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPdmVycmlkZSBjYWxsYmFjayB0byBiZSB1c2VkIGluIHBsYWNlIG9mIHRoZSBkZWZhdWx0IGNvbnNvbGUgbG9nZ2luZy5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge2Z1bmN0aW9ufHVuZGVmaW5lZH1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBvdmVycmlkZUNhbGxiYWNrO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWZlcmVuY2UgdG8gdGhpcyBvYmplY3QgZm9yIGR5bmFtaWNhbGx5IGV4dGVuZGluZyB0aGUgb2JqZWN0LlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkxvZ2dpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQcmltYXJ5IGFjdGlvbiBvZiBlYWNoIGNvbnNvbGUgd3JhcHBlciBtZXRob2QuICBTdG9yZXMgdGhlIG1lc3NhZ2UgaW4ge0Bsb2dzfSBhbmQsIGlmXG4gICAgICAgICAqIGVuYWJsZWQsIHBhc3NlcyB0aGUgY29udGVudCB0byB0aGUgY29uc29sZSBuYXRpdmUgbWV0aG9kLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kIFRoZSBtZXRob2QgY2FsbGVkIG9uIGNvbnNvbGUuIChlLmcuICdsb2cnLCAnZGVidWcnLCBldGMuKVxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIFRoZSBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBvcmlnaW5hbCBjYWxsLlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGNvbnNvbGVBY3Rpb24gPSBmdW5jdGlvbihtZXRob2QsIGFyZ3MpIHtcbiAgICAgICAgICAgIGlmKGxvZ3NbbWV0aG9kXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbG9nc1ttZXRob2RdID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbG9nSXRlbSA9IG5ldyBFVldFQjIuTG9nSXRlbShuZXcgRGF0ZSgpLCBhcmdzKTtcbiAgICAgICAgICAgIGxvZ3NbbWV0aG9kXS5wdXNoKGxvZ0l0ZW0pO1xuXG4gICAgICAgICAgICB2YXIgbG9nTGVuZ3RoID0gbG9nc1ttZXRob2RdLmxlbmd0aDtcbiAgICAgICAgICAgIGlmKGxvZ0xlbmd0aCA+IGluc3RhbmNlLnJlY29yZHNUb1N0b3JlKSB7XG4gICAgICAgICAgICAgICAgbG9nc1ttZXRob2RdID0gbG9nc1ttZXRob2RdLnNsaWNlKGxvZ0xlbmd0aCAtIGluc3RhbmNlLnJlY29yZHNUb1N0b3JlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoaW5zdGFuY2UuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIGlmKG92ZXJyaWRlQ2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBvdmVycmlkZUNhbGxiYWNrKGxvZ0l0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29uc29sZSAhPT0gdW5kZWZpbmVkICYmIGNvbnNvbGVbbWV0aG9kXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGVbbWV0aG9kXS5hcHBseShjb25zb2xlLCBhcmdzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyB0aGUgYW5vbnltb3VzIGZ1bmN0aW9uIGZvciBiaW5kaW5nIHRoZSBjb25zb2xlIHdyYXBwZXIgbWV0aG9kcy5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZCBUaGUgbWV0aG9kIGNhbGxlZCBvbiBjb25zb2xlLiAoZS5nLiAnbG9nJywgJ2RlYnVnJywgZXRjLilcbiAgICAgICAgICogQHJldHVybnMge0Z1bmN0aW9ufSBUaGUgYW5vbnltb3VzIGZ1bmN0aW9uIGNhbGxpbmcge0BsaW5rIGNvbnNvbGVBY3Rpb259LlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGdlbmVyYXRlQ29uc29sZUFjdGlvbiA9IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGVBY3Rpb24obWV0aG9kLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBXaXJlIHVwIGVhY2ggb2YgdGhlIGNvbnNvbGUgbWVzc2FnZXMgd2l0aCB0aGVpciB3cmFwcGVyIG1ldGhvZC5cbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvcihpPTA7IGk8Y29uc29sZU1lc3NhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbWV0aG9kID0gY29uc29sZU1lc3NhZ2VzW2ldO1xuICAgICAgICAgICAgaW5zdGFuY2VbbWV0aG9kXSA9IGdlbmVyYXRlQ29uc29sZUFjdGlvbihtZXRob2QpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFwcGxpZXMgYW4gb3ZlcnJpZGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIGluIHBsYWNlIG9mIHRoZSBkZWZhdWx0IGNvbnNvbGUgbWV0aG9kcy4gIFRoaXNcbiAgICAgICAgICogY2FuIGJlIHVzZWQgdG8gaW50ZWdyYXRlIHRoZSBpbnRlcm5hbCBBUEkgbG9nZ2luZyBpbnRvIG90aGVyIGxvZ2dpbmcgc3RydWN0dXJlcy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb3ZlcnJpZGUgQSBmdW5jdGlvbiB1c2VkIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGxvZ2dpbmcgbWV0aG9kcy4gIFRoaXNcbiAgICAgICAgICogY2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYW4ge0BsaW5rIEVWV0VCMi5Mb2dJdGVtfSBmb3IgZWFjaCBlbmFibGVkIGxvZ2dpbmcgc3RhdGVtZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hcHBseU92ZXJyaWRlID0gZnVuY3Rpb24ob3ZlcnJpZGUpIHtcbiAgICAgICAgICAgIGlmKG92ZXJyaWRlQ2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi5sb2dnZXIubWFpbi5kZWJ1ZygnT3ZlcnJpZGluZyBleGlzdGluZyBsb2dnaW5nIGNhbGxiYWNrLicsIG92ZXJyaWRlQ2FsbGJhY2ssIG92ZXJyaWRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG92ZXJyaWRlQ2FsbGJhY2sgPSBvdmVycmlkZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVtb3ZlcyBhbiBleGlzdGluZyBvdmVycmlkZSBjYWxsYmFjaywgcmV0dXJuaW5nIHRoZSBsb2dnZXIgdG8gdXNpbmcgdGhlIGRlZmF1bHQgY29uc29sZVxuICAgICAgICAgKiBtZXRob2RzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZW1vdmVPdmVycmlkZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYob3ZlcnJpZGVDYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLmxvZ2dlci5tYWluLmRlYnVnKCdSZW1vdmluZyBsb2dnaW5nIGNhbGxiYWNrIHdpdGggbm9uZSBhcHBsaWVkLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3ZlcnJpZGVDYWxsYmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBzdG9yZWQgbG9ncyBmb3IgdGhlIHByb3ZpZGVkIG1ldGhvZC5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBUaGUgbWV0aG9kIGNhbGxlZCBvbiBjb25zb2xlLiAoZS5nLiAnbG9nJywgJ2RlYnVnJywgZXRjLilcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtudW1SZWNvcmRzPUVWV0VCMi5sb2dnZXIucmVjb3Jkc1RvU3RvcmVdIFRoZSBtYXhpbXVtIG51bWJlciBvZiByZWNvcmRzXG4gICAgICAgICAqIHRvIHJldHVybi5cbiAgICAgICAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiBsb2cgaXRlbXMgc29ydGVkIGJ5IHRoZSB0aW1lIGVhY2ggd2FzIGFwcGxpZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0b3JlZExvZ3MgPSBmdW5jdGlvbihtZXRob2QsIG51bVJlY29yZHMpIHtcbiAgICAgICAgICAgIGlmKGxvZ3NbbWV0aG9kXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYobnVtUmVjb3JkcyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbnVtUmVjb3JkcyA9IGluc3RhbmNlLnJlY29yZHNUb1N0b3JlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYobnVtUmVjb3JkcyA+IGluc3RhbmNlLnJlY29yZHNUb1N0b3JlKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLmxvZ2dlci5tYWluLmRlYnVnKCdNb3JlIHJlY29yZHMgcmVxdWVzdGVkIHRoYW4gbWF4IHN0b3JlZC4nLCBudW1SZWNvcmRzLCBpbnN0YW5jZS5yZWNvcmRzVG9TdG9yZSk7XG4gICAgICAgICAgICAgICAgbnVtUmVjb3JkcyA9IGluc3RhbmNlLnJlY29yZHNUb1N0b3JlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHNsaWNlSW5kZXggPSBsb2dzW21ldGhvZF0ubGVuZ3RoIC0gbnVtUmVjb3JkcztcbiAgICAgICAgICAgIGlmKHNsaWNlSW5kZXggPCAwKSB7XG4gICAgICAgICAgICAgICAgc2xpY2VJbmRleCA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbG9nc1ttZXRob2RdLnNsaWNlKHNsaWNlSW5kZXgpO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwcmltYXJ5IGxvZ2dlciBpbnN0YW5jZSBmb3IgRVZXRUIyLlxuICAgICAqIEB0eXBlIHtFVldFQjIuTG9nZ2luZ31cbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi5sb2dnZXIgPSB7XG4gICAgICAgIG1haW46IG5ldyBFVldFQjIuTG9nZ2luZygpXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEhlbHBlciByZWZlcmVuY2UgZm9yIGFzc29jaWF0aW5nIHdpdGggdGhlIHByaW1hcnkgbG9nZ2luZyBpbnN0YW5jZS4gIFRoaXMgaXMgYSBtYXBwaW5nIG9mXG4gICAgICoge0BsaW5rIEVWV0VCMi5sb2dnZXIubWFpbi5sb2d9LlxuICAgICAqIEB0eXBlIHtmdW5jdGlvbn1cbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi5sb2cgPSBFVldFQjIubG9nZ2VyLm1haW4ubG9nO1xufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgLyoqXG4gICAgICogQSBjb2xsZWN0aW9uIG9mIHV0aWxpdHkgZnVuY3Rpb25zIHVzZWQgYnkgdGhlIEFQSS5cbiAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBEYXRlMklFVEYgZnVuY3Rpb24gaXMgYSBoZWxwZXIgZnVuY3Rpb24gZm9yIGNvbW11bmljYXRpbmcgd2l0aCB0aGUgc2VhcmNoIHN5c3RlbS4gIFRoZSBzZWFyY2ggc3lzdGVtXG4gICAgICogdXNlcyBhbGwgdGltZXMgaW4gSUVURiBSRkMgMzMzOSBmb3JtYXQsIHNvIHRvIGFpZCBpbiBjb21tdW5pY2F0aW5nIHdpdGggdGhlIHNlYXJjaCBBUEksIHRoaXMgZnVuY3Rpb24gd2lsbFxuICAgICAqIHRha2UgdGhlIG5hdGl2ZSBKYXZhU2NyaXB0IERhdGUgb2JqZWN0IGFuZCBjb252ZXJ0IGl0IGludG8gYW4gSUVURiBSRkMgMzMzOSBjb21wbGlhbnQgc3RyaW5nIGZvcm1hdC4gIElmIHRoZVxuICAgICAqIHBhc3NlZCBpbiBwYXJhbWV0ZXIgaXMgbm90IGEgdmFsaWQgRGF0ZSBPYmplY3QsIGFuIGVtcHR5IHN0cmluZyB3aWxsIGJlIHJldHVybmVkLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gZGF0ZU9iaiBEYXRlIG9iamVjdCB0aGF0IGlzIHRoZSBzb3VyY2UgZm9yIHRoZSBjb252ZXJ0ZWQgSUVURiBjb21wbGlhbnQgc3RyaW5nLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gdXNlTXMgV2hldGhlciBvciBub3QgdG8gaW5jbHVkZSBtaWxsaXNlY29uZHMgaW4gdGhlIElFVEYgZm9ybWF0LlxuICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGRhdGUgaW4gdGhlIElFVEYgZm9ybWF0LCBvciBhbiBlbXB0eSBzdHJpbmcgaWYgdGhlIG9iamVjdCBpcyBub3QgdGhlIHZhbGlkIERhdGVcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLkRhdGUySUVURiA9IGZ1bmN0aW9uIChkYXRlT2JqLCB1c2VNcykge1xuICAgICAgICB1c2VNcyA9IHVzZU1zIHx8IGZhbHNlO1xuXG4gICAgICAgIGlmKHR5cGVvZiBkYXRlT2JqID09PSAndW5kZWZpbmVkJyB8fCBkYXRlT2JqID09PSBudWxsIHx8IHR5cGVvZiBkYXRlT2JqLmdldEhvdXJzID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaWV0ZiA9IGRhdGVPYmouZ2V0VVRDRnVsbFllYXIoKSArICctJztcbiAgICAgICAgdmFyIG1vbnRoID0gZGF0ZU9iai5nZXRVVENNb250aCgpICsgMTtcbiAgICAgICAgaWYobW9udGggPCAxMCkge1xuICAgICAgICAgICAgaWV0ZiArPSAnMCc7XG4gICAgICAgIH1cbiAgICAgICAgaWV0ZiArPSBtb250aCArICctJztcblxuICAgICAgICB2YXIgZGF0ZSA9IGRhdGVPYmouZ2V0VVRDRGF0ZSgpO1xuICAgICAgICBpZihkYXRlIDwgMTApIHtcbiAgICAgICAgICAgIGlldGYgKz0gJzAnO1xuICAgICAgICB9XG4gICAgICAgIGlldGYgKz0gZGF0ZSArICdUJztcblxuICAgICAgICB2YXIgaG91cnMgPSBkYXRlT2JqLmdldFVUQ0hvdXJzKCk7XG4gICAgICAgIGlmKGhvdXJzIDwgMTApIHtcbiAgICAgICAgICAgIGlldGYgKz0gJzAnO1xuICAgICAgICB9XG4gICAgICAgIGlldGYgKz0gaG91cnMgKyAnOic7XG5cbiAgICAgICAgdmFyIG1pbnV0ZXMgPSBkYXRlT2JqLmdldFVUQ01pbnV0ZXMoKTtcbiAgICAgICAgaWYobWludXRlcyA8IDEwKSB7XG4gICAgICAgICAgICBpZXRmICs9ICcwJztcbiAgICAgICAgfVxuICAgICAgICBpZXRmICs9IG1pbnV0ZXMgKyAnOic7XG5cbiAgICAgICAgdmFyIHNlY29uZHMgPSBkYXRlT2JqLmdldFVUQ1NlY29uZHMoKTtcbiAgICAgICAgaWYgKHNlY29uZHMgPCAxMCkge1xuICAgICAgICAgICAgaWV0ZiArPSAnMCc7XG4gICAgICAgIH1cbiAgICAgICAgaWV0ZiArPSBzZWNvbmRzO1xuXG4gICAgICAgIGlmKHVzZU1zKSB7XG4gICAgICAgICAgICB2YXIgbXMgPSBkYXRlT2JqLmdldFVUQ01pbGxpc2Vjb25kcygpO1xuICAgICAgICAgICAgaWYgKG1zID4gMCkge1xuICAgICAgICAgICAgICAgIGlldGYgKz0gJy4nO1xuICAgICAgICAgICAgICAgIGlmIChtcyA8IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICBpZXRmICs9ICcwJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobXMgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICBpZXRmICs9ICcwJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZXRmICs9IG1zO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWV0ZiArPSAnWic7XG4gICAgICAgIHJldHVybiBpZXRmO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgSUVURjJEYXRlIGZ1bmN0aW9uIGlzIGEgcmV2ZXJzZSBvZiB0aGUge0BsaW5rIEVWV0VCMi51dGlsLkRhdGUySUVURn0gZnVuY3Rpb24gdGhhdCB0cmFuc2xhdGVzIHRoZSBJRVRGXG4gICAgICogZm9ybWF0dGVkIHN0cmluZyBpbnRvIGEgbmF0aXZlIEphdmFTY3JpcHQgRGF0ZSBvYmplY3QuICBXaXRoIGEgcGFzc2VkIGluIElFVEYgUkZDIDMzMzkgZGF0ZS10aW1lIHN0cmluZywgdGhpc1xuICAgICAqIHdpbGwgc3BsaXQgYW5kIHBhcnNlIHRoZSBzdHJpbmcgaW50byBhIHByb3BlciBEYXRlIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHdpdGggdGltZSB0cmFja2luZyBvZiB0aGUgc2VhcmNoXG4gICAgICogZmVlZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWV0ZiBTdHJpbmcgaW4gSUVURiBmb3JtYXQgdG8gYmUgY29udmVydGVkIHRvIGEgRGF0ZSBvYmplY3RcbiAgICAgKiBAcmV0dXJuIHtEYXRlfSBBIGRhdGUgb2JqZWN0IHdpdGggdGhlIGRhdGUtdGltZSBmcm9tIHRoZSBnaXZlbiBJRVRGIGRhdGUtdGltZSBzdHJpbmcgb3IgbnVsbCBpZiB0aGUgc3RyaW5nIGlzXG4gICAgICogaW52YWxpZFxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuSUVURjJEYXRlID0gZnVuY3Rpb24gKGlldGYpIHtcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgwKTtcblxuICAgICAgICBpZih0eXBlb2YgaWV0ZiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlldGZTcGxpdCA9IGlldGYuc3BsaXQoJ1QnKTtcbiAgICAgICAgaWYoaWV0ZlNwbGl0Lmxlbmd0aCAhPT0gMikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGRhdGVEYXRhID0gaWV0ZlNwbGl0WzBdLnNwbGl0KCctJyk7XG4gICAgICAgIGlmIChkYXRlRGF0YS5sZW5ndGggIT09IDMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcihkYXRlRGF0YVswXSk7XG4gICAgICAgIGRhdGUuc2V0VVRDTW9udGgocGFyc2VJbnQoZGF0ZURhdGFbMV0sMTApIC0gMSk7XG4gICAgICAgIGRhdGUuc2V0VVRDRGF0ZShkYXRlRGF0YVsyXSk7XG5cbiAgICAgICAgdmFyIHRpbWVEYXRhID0gaWV0ZlNwbGl0WzFdLnNwbGl0KCc6Jyk7XG4gICAgICAgIGlmICh0aW1lRGF0YS5sZW5ndGggIT09IDMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0ZS5zZXRVVENIb3Vycyh0aW1lRGF0YVswXSk7XG4gICAgICAgIGRhdGUuc2V0VVRDTWludXRlcyh0aW1lRGF0YVsxXSk7XG5cbiAgICAgICAgdmFyIHNlY0RhdGEgPSB0aW1lRGF0YVsyXS5zcGxpdCgvWy5aXS8pO1xuICAgICAgICBkYXRlLnNldFVUQ1NlY29uZHMoc2VjRGF0YVswXSk7XG5cbiAgICAgICAgaWYgKHNlY0RhdGFbMV0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgZGF0ZS5zZXRVVENNaWxsaXNlY29uZHMoc2VjRGF0YVsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQHR5cGVkZWYge051bWJlcltdfSBSR0JBXG4gICAgICogQW4gUkdCQSBjb2xvciBzdG9yZWQgYXNcbiAgICAgKiA8cHJlPltyZWQsIGdyZWVuLCBibHVlLCBhbHBoYV08L3ByZT5cbiAgICAgKiBUaGUgcmdiIGNvbXBvbmVudHMgYXMgcmVwcmVzZW50ZWQgYXMgOC1iaXQgdW5zaWduZWQgaW50ZWdlcnMsIHRoZSBhbHBoYSBjb21wb25lbnQgaXMgc3RvcmVkIGFzIGEgZmxvYXRpbmctcG9pbnRcbiAgICAgKiBudW1iZXIgaW4gdGhlIHJhbmdlIFswLDFdLlxuICAgICAqL1xuICAgIC8qKlxuICAgICAqIEFycmFuZ2VzIHNlcGFyYXRlIFJHQiBhbmQgYWxwaGEgY29tcG9uZW50cyBvZiBhIGNvbG9yIGludG8gYSBjb21wb3NpdGUge0BsaW5rIFJHQkF9IGRlY2xhcmF0aW9uLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSByZ2IgVGhlIFJHQiBjb21wb25lbnQgb2YgdGhlIGNvbG9yLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBhbHBoYSBUaGUgYWxwaGEgY29tcG9uZW50IG9mIHRoZSBjb2xvci5cbiAgICAgKiBAcmV0dXJuIHtSR0JBfSBUaGUgY29sb3IgZGVjbGFyYXRpb24uXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5SR0JBID0gZnVuY3Rpb24ocmdiLCBhbHBoYSkge1xuICAgIC8qZXNsaW50LWRpc2FibGUgbm8tYml0d2lzZSovXG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICByZ2IgJiAweGZmMDAwMCA+PiAxNixcbiAgICAgICAgICAgIHJnYiAmIDB4ZmYwMCA+PiA4LFxuICAgICAgICAgICAgcmdiICYgMHhmZixcbiAgICAgICAgICAgIGFscGhhIC8gMTAwXG4gICAgICAgIF07XG4gICAgfTtcbiAgICAvKmVzbGludC1lbmFibGUgbm8tYml0d2lzZSovXG5cbiAgICAvKipcbiAgICAgKiBFdmVudCBoYW5kbGVyIGZvciB0aGUgbG9hZCBldmVudCBmb3IgdGhlIGltYWdlIHVzZWQgYnkge0BsaW5rIEVWV0VCMi51dGlsLmF0dGFjaENhbWVyYX0uICBDb250aW51ZXMgdG8gdXBkYXRlXG4gICAgICogdGhlIGltYWdlIHdpdGggdGhlIG5leHQgZnJhbWUgYWZ0ZXIgZWFjaCBzdWNjZXNzaXZlIGxvYWQuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3RcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIHZhciBvbkNhbWVyYUltZ0xvYWQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSAkKGUudGFyZ2V0KTtcblxuICAgICAgICB2YXIgcGFyYW1zID0gdGFyZ2V0LmF0dHIoJ3RpdGxlJyk7XG4gICAgICAgIHBhcmFtcyA9IHBhcmFtcy5zcGxpdCgnOycpO1xuICAgICAgICBpZiAodGFyZ2V0LmF0dHIoJ2FsdCcpID09PSAnLTEnKSB7XG4gICAgICAgICAgICB0YXJnZXQuc3JjID0gZS5kYXRhLmNhbWVyYS5nZXRGcmFtZShwYXJzZUludChwYXJhbXNbMF0sMTApLCBwYXJzZUludChwYXJhbXNbMV0sMTApLCBwYXJzZUludChwYXJhbXNbMl0sMTApKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC5zcmMgPSBlLmRhdGEuY2FtZXJhLmdldEZyYW1lKHBhcnNlSW50KHBhcmFtc1swXSwxMCksIHBhcnNlSW50KHBhcmFtc1sxXSwxMCksIHBhcnNlSW50KHBhcmFtc1syXSwxMCksXG4gICAgICAgICAgICAgICAgdGFyZ2V0LmF0dHIoJ2FsdCcpKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlx0VGhlIGF0dGFjaENhbWVyYSBmdW5jdGlvbiBpcyBkZXNpZ25lZCB0byBnaXZlIGEgc2ltcGxlIHdheSBvZiB0dXJuaW5nIGEgZG9jdW1lbnQgZWxlbWVudCBpbnRvIGEgZmVlZFxuICAgICAqXHRkaXNwbGF5LiAgSXQgd2lsbCBzdGFydCBhIGxvb3BpbmcgcmVxdWVzdC1kaXNwbGF5IHN5c3RlbSBvbiB0aGUgb2JqZWN0LCByZXBsYWNpbmcgaXQgd2l0aCB0aGUgaW1hZ2UgZm9yXG4gICAgICpcdHRoZSBkZXNpcmVkIENhbWVyYSBmZWVkLiAgT25jZSB0aGUgaW1hZ2UgaGFzIGJlZW4gcmVjZWl2ZWQgYW5kIGxvYWRlZCwgYW5vdGhlciBpbWFnZSBpcyByZXF1ZXN0ZWQsXG4gICAgICpcdGFuZCB0aGlzIGNvbnRpbnVlcyBsb29waW5nIHVudGlsIHN0b3BwZWQuICBUaGUgc3BlZWQgb2YgdGhlIGRpc3BsYXkgZm9yIHRoZSBmZWVkIFwidmlkZW9cIiBpcyBkZXBlbmRlbnQgb25cbiAgICAgKlx0YSBudW1iZXIgb2YgZmFjdG9ycywgaW5jbHVkaW5nIHRoZSBjb25uZWN0aW9uIHNwZWVkIGJldHdlZW4gdGhlIHVzZXIgYW5kIHRoZSB3ZWIgc2VydmljZSwgdGhlIGNvbm5lY3Rpb25cbiAgICAgKlx0YmV0d2VlbiB0aGUgd2ViIHNlcnZpY2Ugd2ViIHNlcnZlciBhbmQgdGhlIGV4YWNxVmlzaW9uIHNlcnZlciwgb3IgdGhlIEpQRUcgZGVjb21wcmVzc2lvbiBzcGVlZCBvZiB0aGVcbiAgICAgKlx0dXNlcidzIGNvbXB1dGVyLiAgVG8gcHJvdmlkZSBhIHNpbXBsZSBhbmQgdmFyeWluZyB1cGRhdGUgc3BlZWQsIHRoZSBvbkxvYWQgc3lzdGVtIGlzIHVzZWQgb24gdGhlIGltYWdlLFxuICAgICAqXHRyYXRoZXIgdGhhbiBhIFRpbWVyIGxpbmtlZCBldmVudC5cbiAgICAgKlx0QHBhcmFtIHtTdHJpbmd8T2JqZWN0fSBlbGVtZW50IEVpdGhlciBhIGpRdWVyeSBzZWxlY3RvciBvciBub2Rlc2V0IG9mIHRoZSBlbGVtZW50IHRvIGF0dGFjaCB0aGUgY2FtZXJhIHRvLlxuICAgICAqXHRAcGFyYW0ge0VWV0VCMi5DYW1lcmF9IGNhbWVyYSBDYW1lcmEgaW5zdGFuY2UgdG8gZnJvbSB3aGljaCB0byByZXRyaWV2ZSB0aGUgZmVlZC5cbiAgICAgKiAgQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBpbWFnZVxuICAgICAqICBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSBpbWFnZVxuICAgICAqICBAcGFyYW0ge051bWJlcn0gcXVhbGl0eSBUaGUgcXVhbGl0eSBvZiB0aGUgaW1hZ2UgKGJldHdlZW4gMSBhbmQgMTApXG4gICAgICogIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuYXR0YWNoQ2FtZXJhID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNhbWVyYSwgaGVpZ2h0LCB3aWR0aCwgcXVhbGl0eSkge1xuICAgICAgICBlbGVtZW50ID0gJChlbGVtZW50KTtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZWxlbWVudCk7XG4gICAgICAgIGlmKCF0YXJnZXQuaXMoJ2ltZycpKSB7XG4gICAgICAgICAgICB2YXIgaW1nID0gJCgnPGltZy8+Jyk7XG4gICAgICAgICAgICBpbWcuYXR0cignaWQnLCAnQycgKyBjYW1lcmEuaWQpO1xuICAgICAgICAgICAgdGFyZ2V0LmFwcGVuZChpbWcpO1xuICAgICAgICAgICAgdGFyZ2V0ID0gaW1nO1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldC5hdHRyKCd0aXRsZScsIHdpZHRoLnRvU3RyaW5nKCkgKyAnOycgKyBoZWlnaHQudG9TdHJpbmcoKSArICc7JyArIHF1YWxpdHkudG9TdHJpbmcoKSk7XG4gICAgICAgIHRhcmdldC5vbignbG9hZCcsIHtjYW1lcmE6IGNhbWVyYX0sIG9uQ2FtZXJhSW1nTG9hZCk7XG4gICAgICAgIHRhcmdldC5hdHRyKCdzcmMnLCBjYW1lcmEuZ2V0RnJhbWUod2lkdGgsIGhlaWdodCwgcXVhbGl0eSkpO1xuICAgICAgICB0YXJnZXQuYXR0cignYWx0JywgJy0xJyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhIHVuaXF1ZSBzdHJlYW0gSUQuXG4gICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgZ2VuZXJhdGVkIHN0cmVhbSBJRC5cbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLmdlbmVyYXRlU3RyZWFtSWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMHhmZmZmZmZmZik7XG4gICAgICAgIHJldHVybiByLnRvU3RyaW5nKDE2KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgbGVnYWN5IHBsdWdpbiwgZGV2aWNlLCBpbnRlcmZhY2UgYW5kIGNvbnRleHQgSURzIGludG8gYSBjYW1lcmEgSUQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHBsdWdpbklkIFRoZSBwbHVnaW4gSUQgZm9yIHRoZSBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGludGVyZmFjZUlkIFRoZSBpbnRlcmZhY2UgSUQgZm9yIHRoZSBjYW1lcmFcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZGV2aWNlSWQgVGhlIGRldmljZSBJRCBmb3IgdGhlIGNhbWVyYS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2NvbnRleHRJZD0wXSBUaGUgY29udGV4dCBJRCBmb3IgdGhlIGNhbWVyYS5cbiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBjYW1lcmEgSUQuXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5waWRUb0NhbWVyYUlkID0gZnVuY3Rpb24ocGx1Z2luSWQsIGludGVyZmFjZUlkLCBkZXZpY2VJZCwgY29udGV4dElkKSB7XG4gICAgICAgIGlmKHR5cGVvZiBjb250ZXh0SWQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBjb250ZXh0SWQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgdmFyIGNhbWVyYUlkID0gY29udGV4dElkIDw8IDI4IHwgcGx1Z2luSWQgfCAoZGV2aWNlSWQgPDwgOCkgfCBpbnRlcmZhY2VJZDtcbiAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgIHJldHVybiBjYW1lcmFJZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXRpbGl0eSBmb3IgcGVyZm9ybWluZyBhbiBYU1MgUE9TVCByZXF1ZXN0IGJ5IGNyZWF0aW5nIGFuZCBzdWJtaXR0aW5nIGFuICZsdDtpZnJhbWUmZ3Q7IG9uIHRoZSBwYWdlLiAgTm90ZTpcbiAgICAgKiB3aGVuIHVzaW5nIHRoaXMgbWV0aG9kLCB0aGVyZSBpcyBubyB3YXkgdG8gcmV0cmlldmUgdGhlIHJlc3BvbnNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIFVSTCBmb3IgdGhlIFBPU1QgcmVxdWVzdC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1ldGVycyBBbiBvYmplY3Qgb2YgbmFtZSB2YWx1ZSBwYWlycyB0byBiZSBwYXNzZWQgYXMgcGFyYW1ldGVycyB0byB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQGRlcHJlY2F0ZWQgVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiB7QGxpbmsgRVZXRUIyLnV0aWwuaW50ZXJuYWwuWFNTUG9zdH0uXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuWFNTUG9zdCA9IGZ1bmN0aW9uKHVybCwgcGFyYW1ldGVycykge1xuICAgICAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5YU1NQb3N0KHVybCwgcGFyYW1ldGVycyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgYSBqUXVlcnkgQUpBWCByZXF1ZXN0IHNldHRpbmdzIG9iamVjdCB3aXRoIFhTUy1zcGVjaWZpYyBvcHRpb25zLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0IGpRdWVyeSBBSkFYIHJlcXVlc3Qgc2V0dGluZ3Mgb2JqZWN0XG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZX0gW3NlcnZpY2VdIFRoZSBzZXJ2aWNlIG9mIHRoZSByZXNvdXJjZSBrZXkgdG8gYWRkLiAgV2hlbiBzZXQsIHRoZSByZXNvdXJjZSBrZXkgcHJvcGVydHlcbiAgICAgKiB3aWxsIGJlIGFwcGxpZWQgdG8gdGhlIHJlcXVlc3QuXG4gICAgICogQHJldHVybnMge09iamVjdH0gVGhlIHVwZGF0ZWQgcmVxdWVzdFxuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Yge0BsaW5rIEVWV0VCMi51dGlsLmludGVybmFsLnVwZGF0ZVJlcXVlc3RGb3JYc3N9LlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3MgPSBmdW5jdGlvbihyZXF1ZXN0LCBzZXJ2aWNlKSB7XG4gICAgICAgIHJldHVybiBFVldFQjIudXRpbC5pbnRlcm5hbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHJlcXVlc3QsIHNlcnZpY2UpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQb2xscyB0aGUgc2VydmljZSBieSBzZW5kaW5nIHZlcnNpb24ud2ViIHJlcXVlc3RzIHRvIGRldGVybWluZSB3aGVuIHRoZSBzZXJ2aWNlIGhhcyByZXN0YXJ0ZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGEgY29weSBvZiB0aGUge0BsaW5rIEVWV0VCMi5TZXJ2aWNlfSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBUaGUgc2VydmljZSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcG9sbGluZ0ludGVydmFsIFRoZSBpbnRlcnZhbCBkdXJhdGlvbiBmb3IgcG9sbGluZyBhdHRlbXB0cyBmb3IgZGV0ZXJtaW5pbmcgd2hlbiB0aGUgc2VydmljZSBoYXNcbiAgICAgKiByZXN0YXJ0ZWQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHBvbGxpbmdNYXhSZXRyaWVzIFRoZSBudW1iZXIgb2YgcG9sbCBhdHRlbXB0cyBiZWZvcmUgcmV0dXJuaW5nIGFuIGVycm9yIG9uIHNlcnZpY2UgcmVzdGFydC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcG9sbGluZ0NvbmZpcm1hdGlvbnNSZXF1aXJlZCBUaGUgbnVtYmVyIG9mIHN1Y2Nlc3NmdWwgc3Vic2VxdWVudCBwb2xscyBiZWZvcmUgcmV0dXJuaW5nIGFcbiAgICAgKiBzdWNjZXNzIG9uIHNlcnZpY2UgcmVzdGFydC5cbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIudXRpbC5pbnRlcm5hbC5ub3RpZnlPblNlcnZpY2VSZXN0YXJ0fS5cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5ub3RpZnlPblNlcnZpY2VSZXN0YXJ0ID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNlcnZpY2UsIHBvbGxpbmdJbnRlcnZhbCwgcG9sbGluZ01heFJldHJpZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2xsaW5nQ29uZmlybWF0aW9uc1JlcXVpcmVkKSB7XG5cbiAgICAgICAgcmV0dXJuIEVWV0VCMi51dGlsLmludGVybmFsLm5vdGlmeU9uU2VydmljZVJlc3RhcnQoY2FsbGJhY2ssIHNlcnZpY2UsIHBvbGxpbmdJbnRlcnZhbCwgcG9sbGluZ01heFJldHJpZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvbGxpbmdDb25maXJtYXRpb25zUmVxdWlyZWQpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBoZWxwZXIgdXRpbGl0eSBmb3IgcHJvY2Vzc2luZyBhIHNlcnZlciByZXNwb25zZSB0byBnZW5lcmF0ZSBhIHVzZXIgcGVybWlzc2lvbnMgb2JqZWN0LlxuICAgICAqIFRoaXMgaXMgYSBsZWdhY3kgbWV0aG9kIHRoYXQgcHJvY2Vzc2VzIHBlcm1pc3Npb25zIGF0IHRoZSB1c2VyIGxldmVsLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXJ2ZXJEYXRhIFRoZSBzZXJ2ZXIgcmVzcG9uc2UgZGF0YVxuICAgICAqIEByZXR1cm5zIHtFVldFQjIuVXNlclBlcm1pc3Npb25zfSBUaGUgdXNlciBwZXJtaXNzaW9uc1xuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Yge0BsaW5rIEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NTZXJ2ZXJQZXJtaXNzaW9uc30uXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwucHJvY2Vzc1NlcnZlclBlcm1pc3Npb25zID0gZnVuY3Rpb24oc2VydmVyRGF0YSkge1xuICAgICAgICByZXR1cm4gRVZXRUIyLnV0aWwuaW50ZXJuYWwucHJvY2Vzc1NlcnZlclBlcm1pc3Npb25zKHNlcnZlckRhdGEpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZSB0aGUgSVAgYWRkcmVzcyBmcm9tIGFuIFJUU1AgaG9zdCBVUkwuXG4gICAgICogTk9URTogQ2FuIG9ubHkgcGFyc2UgSVB2NCBhZGRyZXNzZXMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGhvc3QgdGhlIFJUU1AgVVJMXG4gICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIElQIGFkZHJlc3Mgb3IgbnVsbCBpZiBhIHZhbGlkIElQIGFkZHJlc3Mgd2FzIG5vdCBmb3VuZC5cbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIudXRpbC5pbnRlcm5hbC5wYXJzZVJ0c3BJcEFkZHJlc3N9LlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKiBAY2F0ZWdvcnkgVXRpbFxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLnBhcnNlUnRzcElwQWRkcmVzcyA9IGZ1bmN0aW9uKGhvc3QpIHtcbiAgICAgICAgcmV0dXJuIEVWV0VCMi51dGlsLmludGVybmFsLnBhcnNlUnRzcElwQWRkcmVzcyhob3N0KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBlcnJvciB0ZXh0IGZyb20gYSBmYWlsZWQgWEhSIHJlc3BvbnNlIG9iamVjdCwgaWYgcG9zc2libGUuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHhociBUaGUgZmFpbGVkIHJlcXVlc3QuXG4gICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIGVycm9yIHRleHQuXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0ID0gZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgIHZhciBlcnJvclRleHQgPSAnQW4gZXJyb3Igb2NjdXJyZWQuJztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmKHhoci5yZXNwb25zZVRleHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvclRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgaWYocmVzcG9uc2UuZXJyb3JUZXh0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlcnJvclRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZXJyb3JUZXh0O1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBlcnJvclRleHQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBlcnJvciBjb2RlIGZyb20gYSBmYWlsZWQgWEhSIHJlc3BvbnNlIG9iamVjdCwgaWYgcG9zc2libGUuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHhociBUaGUgZmFpbGVkIHJlcXVlc3QuXG4gICAgICogQHJldHVybnMge051bWJlcnx1bmRlZmluZWR9IFRoZSBlcnJvciBjb2RlIGlmIHByZXNlbnQuXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuZ2V0RXJyb3JDb2RlID0gZnVuY3Rpb24oeGhyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZih4aHIucmVzcG9uc2VUZXh0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgaWYocmVzcG9uc2UuZXJyb3JDb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZXJyb3JDb2RlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9O1xufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIEBjbGFzc1xuICAgICAqIEEgY29sbGVjdGlvbiBvZiB1dGlsaXR5IGZ1bmN0aW9ucyB1c2VkIGJ5IHRoZSBBUEkuXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIFV0aWxpdHkgZm9yIHBlcmZvcm1pbmcgYW4gWFNTIFBPU1QgcmVxdWVzdCBieSBjcmVhdGluZyBhbmQgc3VibWl0dGluZyBhbiAmbHQ7aWZyYW1lJmd0OyBvbiB0aGUgcGFnZS4gIE5vdGU6XG4gICAgICogd2hlbiB1c2luZyB0aGlzIG1ldGhvZCwgdGhlcmUgaXMgbm8gd2F5IHRvIHJldHJpZXZlIHRoZSByZXNwb25zZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSBVUkwgZm9yIHRoZSBQT1NUIHJlcXVlc3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtZXRlcnMgQW4gb2JqZWN0IG9mIG5hbWUgdmFsdWUgcGFpcnMgdG8gYmUgcGFzc2VkIGFzIHBhcmFtZXRlcnMgdG8gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5YU1NQb3N0ID0gZnVuY3Rpb24odXJsLCBwYXJhbWV0ZXJzKSB7XG4gICAgICAgIHZhciBpZnJhbWUgPSAkKCc8aWZyYW1lIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj48aHRtbD48Ym9keT48L2JvZHk+PC9odG1sPjwvaWZyYW1lPicpO1xuICAgICAgICAkKCdib2R5JykuYXBwZW5kKGlmcmFtZSk7XG4gICAgICAgIHZhciBmb3JtID0gJCgnPGZvcm0+PC9mb3JtPicpO1xuICAgICAgICBmb3JtLmF0dHIoJ2FjdGlvbicsIHVybCk7XG4gICAgICAgIGZvcm0uYXR0cignbWV0aG9kJywgJ3Bvc3QnKTtcbiAgICAgICAgdmFyIGtleTtcbiAgICAgICAgdmFyIGZvcm1IYXNGaWxlSW5wdXQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGlucHV0c1RvUmV2ZXJ0ID0gW107XG4gICAgICAgIGZvcihrZXkgaW4gcGFyYW1ldGVycykge1xuICAgICAgICAgICAgaWYocGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0O1xuICAgICAgICAgICAgICAgIGlmKHBhcmFtZXRlcnNba2V5XSBpbnN0YW5jZW9mICQgKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1IYXNGaWxlSW5wdXQgPSBwYXJhbWV0ZXJzW2tleV0uYXR0cigndHlwZScpID09PSAnZmlsZSc7XG4gICAgICAgICAgICAgICAgICAgIGlucHV0ID0gcGFyYW1ldGVyc1trZXldO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dHNUb1JldmVydC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0OiBpbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudDogaW5wdXQucGFyZW50KClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dCA9ICQoJzxpbnB1dCB0eXBlPVwiaGlkZGVuXCIvPicpO1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCd2YWx1ZScsIHBhcmFtZXRlcnNba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlucHV0LmF0dHIoJ25hbWUnLCBrZXkpO1xuICAgICAgICAgICAgICAgIGZvcm0uYXBwZW5kKGlucHV0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihmb3JtSGFzRmlsZUlucHV0KSB7XG4gICAgICAgICAgICBmb3JtLmF0dHIoJ2VuY3R5cGUnLCAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJldmVydE1vdmVkSW5wdXRzID0gZnVuY3Rpb24obW92ZWRJbnB1dHMpIHtcbiAgICAgICAgICAgICQuZWFjaChtb3ZlZElucHV0cywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudC5hcHBlbmQoZWxlbWVudC5pbnB1dCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZihpZnJhbWUuY29udGVudHMoKS5maW5kKCdib2R5JykubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICBpZnJhbWUuY29udGVudHMoKS5maW5kKCdib2R5JykuYXBwZW5kKGZvcm0pO1xuICAgICAgICAgICAgZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIGlmcmFtZS5vbignbG9hZCByZWFkeXN0YXRlY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5vbignc3VibWl0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldmVydE1vdmVkSW5wdXRzKGlucHV0c1RvUmV2ZXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgaWZyYW1lLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBJRSBkb2Vzbid0IG1ha2UgdGhlIGlmcmFtZSdzIGJvZHkgYXZhaWxhYmxlIHVudGlsIGFmdGVyIHRoZSBpZnJhbWUgaXMgbG9hZGVkLlxuICAgICAgICAgICAgdmFyIG9uSWVJZnJhbWVMb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWZyYW1lLm9mZignbG9hZCByZWFkeXN0YXRlY2hhbmdlJywgb25JZUlmcmFtZUxvYWQpO1xuICAgICAgICAgICAgICAgIGlmcmFtZS5jb250ZW50cygpLmZpbmQoJ2JvZHknKS5hcHBlbmQoZm9ybSk7XG4gICAgICAgICAgICAgICAgZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgICAgICByZXZlcnRNb3ZlZElucHV0cyhpbnB1dHNUb1JldmVydCk7XG4gICAgICAgICAgICAgICAgaWZyYW1lLnJlbW92ZSgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWZyYW1lLm9uKCdsb2FkIHJlYWR5c3RhdGVjaGFuZ2UnLCBvbkllSWZyYW1lTG9hZCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXBkYXRlcyBhIGpRdWVyeSBBSkFYIHJlcXVlc3Qgc2V0dGluZ3Mgb2JqZWN0IHdpdGggWFNTLXNwZWNpZmljIG9wdGlvbnMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3QgalF1ZXJ5IEFKQVggcmVxdWVzdCBzZXR0aW5ncyBvYmplY3RcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZV0gVGhlIHNlcnZpY2Ugb2YgdGhlIHJlc291cmNlIGtleSB0byBhZGQuICBXaGVuIHNldCwgdGhlIHJlc291cmNlIGtleSBwcm9wZXJ0eVxuICAgICAqIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgcmVxdWVzdC5cbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSB1cGRhdGVkIHJlcXVlc3RcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwudXBkYXRlUmVxdWVzdEZvclhzcyA9IGZ1bmN0aW9uKHJlcXVlc3QsIHNlcnZpY2UpIHtcbiAgICAgICAgcmVxdWVzdC5kYXRhVHlwZSA9ICdqc29ucCc7XG4gICAgICAgIHJlcXVlc3QudGltZW91dCA9IEVWV0VCMi5jb25maWcuanNvbnBSZXF1ZXN0VGltZW91dDtcbiAgICAgICAgaWYocmVxdWVzdC50eXBlICE9PSB1bmRlZmluZWQgJiYgcmVxdWVzdC50eXBlICE9PSAnR0VUJykge1xuICAgICAgICAgICAgaWYocmVxdWVzdC5kYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0LmRhdGEgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXVlc3QuZGF0YS52ZXJiID0gcmVxdWVzdC50eXBlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZihyZXF1ZXN0LmRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QuZGF0YSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVxdWVzdC5kYXRhLmtleSA9IHNlcnZpY2UucmVzb3VyY2VLZXk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENhY2hlZCB2YWx1ZSBvZiB3aGV0aGVyIENPUlMgaXMgc3VwcG9ydGVkIGZvciB0aGlzIGluc3RhbmNlLiAgVGhpcyB2YWx1ZSBpcyBzZXQgYW5kXG4gICAgICogcmVmZXJlbmNlZCBieSB7QGxpbmsgRVZXRUIyLnV0aWwuaW50ZXJuYWwuY29yc1N1cHBvcnRlZH0uXG4gICAgICogQHR5cGUge3VuZGVmaW5lZHxCb29sZWFufVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICB2YXIgY29yc1N1cHBvcnRlZDtcblxuICAgIC8qKlxuICAgICAqIFV0aWxpdHkgbWV0aG9kIHRvIGRldGVybWluZSB3aGV0aGVyIENPUlMgc3VwcG9ydCBpcyBlbmFibGVkIGZvciB0aGlzIGJyb3dzZXIuXG4gICAgICogQHJldHVybnMge0Jvb2xlYW59IFdoZXRoZXIgQ09SUyBpcyBzdXBwb3J0ZWRcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwuY29yc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZihjb3JzU3VwcG9ydGVkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvcnNTdXBwb3J0ZWQgPSAnd2l0aENyZWRlbnRpYWxzJyBpbiBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29yc1N1cHBvcnRlZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogV3JhcHBlciBtZXRob2QgZm9yICQuYWpheCwgd2hpY2ggYXBwbGllcyBhbnkgZXhpc3RpbmcgYXV0aG9yaXphdGlvbiB0b2tlbiB0byB0aGUgcmVxdWVzdCxcbiAgICAgKiBhcyB3ZWxsIGFzIGNhbGwge0BsaW5rIEVWV0VCMi51dGlsLmludGVybmFsLnVwZGF0ZVJlcXVlc3RGb3JYc3N9IHRvIGFwcGx5IGFueSBuZWNlc3NhcnlcbiAgICAgKiBYU1MgdHJhbnNmb3JtYXRpb25zLiAgQXMgYSBjb252ZW5pZW5jZSwgdGhpcyBmdW5jdGlvbiBpcyBhbGlhc2VkIGFzIHtAbGluayBFVldFQjIuYWpheH1cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3MgVGhlIHNldHRpbmdzIG9iamVjdCBmb3IgJC5hamF4LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2V9IHNlcnZpY2UgVGhlIHNlcnZpY2UgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcmVxdWVzdC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtub25Db3JzRm9yY2VQb3N0PWZhbHNlXSBXaGV0aGVyIHRvIGZvcmNlIGEgUE9TVCBmb3Igbm9uLUNPUlMgWFNTIFBPU1RcbiAgICAgKiByZXF1ZXN0cyB1c2luZyB7QGxpbmsgRVZXRUIyLnV0aWwuaW50ZXJuYWwuWFNTUG9zdH1cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwuYWpheCA9IGZ1bmN0aW9uKHNldHRpbmdzLCBzZXJ2aWNlLCBub25Db3JzRm9yY2VQb3N0KSB7XG4gICAgICAgIGlmKEVWV0VCMi51dGlsLmludGVybmFsLmNvcnNTdXBwb3J0ZWQoKSAmJiBzZXJ2aWNlLnN1cHBvcnRzQ29ycygpKSB7XG4gICAgICAgICAgICBpZiAoc2VydmljZS5hdXRoLnRva2VuICE9PSAnJyAmJlxuICAgICAgICAgICAgICAgIChzZXJ2aWNlLmF1dGgudHlwZSAhPT0gRVZXRUIyLnNlcnZpY2VBdXRoVHlwZXMudW5rbm93blxuICAgICAgICAgICAgICAgIHx8IHNlcnZpY2UuYXV0aC50eXBlICE9PSBFVldFQjIuc2VydmljZUF1dGhUeXBlcy5ub25lKSkge1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIGluIHRoZSBIVFRQIEF1dGggQmVhcmVyIGhlYWRlcnNcbiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaGVhZGVycyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmhlYWRlcnMgPSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gJ0JlYXJlciAnICsgc2VydmljZS5hdXRoLnRva2VuO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIGluIHRoZSB3aXRoQ3JlZGVudGlhbHMgcHJvcGVydHkgdG8geGhyRmllbGRzXG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MueGhyRmllbGRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MueGhyRmllbGRzID0ge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldHRpbmdzLnhockZpZWxkc1tcIndpdGhDcmVkZW50aWFsc1wiXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZihub25Db3JzRm9yY2VQb3N0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBub25Db3JzRm9yY2VQb3N0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHJlcXVlc3QgZm9yIFhTUyByZXF1ZXN0c1xuICAgICAgICAgICAgaWYgKHNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT09ICdQT1NUJyAmJiBub25Db3JzRm9yY2VQb3N0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgWFNTIFBvc3QgYW5kIGNhbGwgdGhlIHN1Y2Nlc3MgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwuWFNTUG9zdChzZXR0aW5ncy51cmwsIHNldHRpbmdzLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgeHNzUG9zdDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5zdWNjZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLnN1Y2Nlc3MocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHJlcXVlc3QgdG8gdXNlIEpTT05QXG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgc2VydmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQWxpYXMgZm9yIEVWV0VCMi51dGlsLmludGVybmFsLmFqYXhcbiAgICAgKiBAdHlwZSB7RVZXRUIyLnV0aWwuaW50ZXJuYWwuYWpheHwqfVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIuYWpheCA9IEVWV0VCMi51dGlsLmludGVybmFsLmFqYXg7XG5cbiAgICAvKipcbiAgICAgKiBQb2xscyB0aGUgc2VydmljZSBieSBzZW5kaW5nIHZlcnNpb24ud2ViIHJlcXVlc3RzIHRvIGRldGVybWluZSB3aGVuIHRoZSBzZXJ2aWNlIGhhcyByZXN0YXJ0ZWQuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgY29weSBvZiB0aGUge0BsaW5rIEVWV0VCMi5TZXJ2aWNlfSBpbnN0YW5jZSwgYW5kIGEgQm9vbGVhbi5cbiAgICAgKiBmbGFnIGluZGljYXRpbmcgaWYgdGhlIHNlcnZpY2UgcmVzdGFydCB3YXMgY29uZmlybWVkLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2V9IFtzZXJ2aWNlPW51bGxdIFRoZSBzZXJ2aWNlIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwb2xsaW5nSW50ZXJ2YWwgVGhlIGludGVydmFsIGR1cmF0aW9uIGZvciBwb2xsaW5nIGF0dGVtcHRzIGZvciBkZXRlcm1pbmluZyB3aGVuIHRoZSBzZXJ2aWNlIGhhc1xuICAgICAqIHJlc3RhcnRlZC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcG9sbGluZ01heFJldHJpZXMgVGhlIG51bWJlciBvZiBwb2xsIGF0dGVtcHRzIGJlZm9yZSByZXR1cm5pbmcgYW4gZXJyb3Igb24gc2VydmljZSByZXN0YXJ0LlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBwb2xsaW5nQ29uZmlybWF0aW9uc1JlcXVpcmVkIFRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCBzdWJzZXF1ZW50IHBvbGxzIGJlZm9yZSByZXR1cm5pbmcgYVxuICAgICAqIHN1Y2Nlc3Mgb24gc2VydmljZSByZXN0YXJ0LlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5ub3RpZnlPblNlcnZpY2VSZXN0YXJ0ID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNlcnZpY2UsIHBvbGxpbmdJbnRlcnZhbCwgcG9sbGluZ01heFJldHJpZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2xsaW5nQ29uZmlybWF0aW9uc1JlcXVpcmVkKSB7XG5cbiAgICAgICAgdmFyIGNvbmZpcm1lZFJldHJpZXMgPSAwO1xuICAgICAgICB2YXIgcmV0cmllcyA9IDA7XG5cbiAgICAgICAgdmFyIHBvbGxWZXJzaW9uO1xuXG4gICAgICAgIHZhciBvblZlcnNpb25TdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25maXJtZWRSZXRyaWVzKys7XG4gICAgICAgICAgICBpZihjb25maXJtZWRSZXRyaWVzID49IHBvbGxpbmdDb25maXJtYXRpb25zUmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBTZW5kIGEgc3VjY2Vzc2Z1bCByZXNwb25zZS5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNlcnZpY2UsIHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gUG9sbCB0aGUgdmVyc2lvbiBhZ2Fpbi5cbiAgICAgICAgICAgICAgICBwb2xsVmVyc2lvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBvblZlcnNpb25FcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uZmlybWVkUmV0cmllcyA9IDA7XG4gICAgICAgICAgICBpZihyZXRyaWVzID49IHBvbGxpbmdNYXhSZXRyaWVzKSB7XG4gICAgICAgICAgICAgICAgLy8gU2VuZCBhbiBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgIHZhciBlcnJvclRleHQgPSAnQW4gZXJyb3Igb2NjdXJyZWQgd2hlbiByZXN0YXJ0aW5nIHRoZSB3ZWIgc2VydmljZS4nO1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCB1bmRlZmluZWQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXRyaWVzKys7XG5cbiAgICAgICAgICAgIC8vIFBvbGwgdGhlIHZlcnNpb24gYWdhaW5cbiAgICAgICAgICAgIHBvbGxWZXJzaW9uKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcG9sbFZlcnNpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblZlcnNpb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogb25WZXJzaW9uRXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnZlcnNpb25cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaWYoc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmljZSk7XG5cbiAgICAgICAgICAgIH0sIHBvbGxpbmdJbnRlcnZhbCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gU3RhcnQgcG9sbGluZyB0aGUgdmVyc2lvbi5cbiAgICAgICAgcG9sbFZlcnNpb24oKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgaGVscGVyIHV0aWxpdHkgZm9yIHByb2Nlc3NpbmcgYSBncm91cCdzIHBlcm1pc3Npb25zIGJpdG1hc2sgdmFsdWVzIHRvIGdlbmVyYXRlIGEgdXNlciBncm91cCBwZXJtaXNzaW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGJpdG1hc2tWYWx1ZXMgVGhlIHBlcm1pc3Npb25zIGJpdG1hc2sgdmFsdWVzIHJlY2VpdmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEByZXR1cm5zIHtFVldFQjIuVXNlckdyb3VwUGVybWlzc2lvbnN9IFRoZSB1c2VyIGdyb3VwIHBlcm1pc3Npb25zIG9iamVjdC5cbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwucHJvY2Vzc1VzZXJHcm91cFBlcm1pc3Npb25zID0gZnVuY3Rpb24oYml0bWFza1ZhbHVlcykge1xuICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IFtdO1xuICAgICAgICB2YXIgdXNlclBlcm1pc3Npb25zQXJyID0gW1xuICAgICAgICAgICAgRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5saXZlUGVybWlzc2lvbnMsXG4gICAgICAgICAgICBFVldFQjIudXNlclBlcm1pc3Npb25zLnNlYXJjaFBlcm1pc3Npb25zXG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIHVzZXJQZXJtaXNzaW9uc0JpdG1hc2sgPSBbXG4gICAgICAgICAgICBFVldFQjIucGVybWlzc2lvbnNCaXRtYXNrLmxpdmVQZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIEVWV0VCMi5wZXJtaXNzaW9uc0JpdG1hc2suc2VhcmNoUGVybWlzc2lvbnNcbiAgICAgICAgXTtcblxuICAgICAgICB2YXIgdXNlck1hc2sgPSBiaXRtYXNrVmFsdWVzLnVzZXI7XG4gICAgICAgICQuZWFjaCh1c2VyUGVybWlzc2lvbnNCaXRtYXNrLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZigoKHZhbHVlIHwgdXNlck1hc2spID09PSB1c2VyTWFzaykgJiYgdXNlclBlcm1pc3Npb25zQXJyW2luZGV4XS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zLnB1c2godXNlclBlcm1pc3Npb25zQXJyW2luZGV4XVtrZXldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIGFkbWluUGVybWlzc2lvbnNBcnIgPSBbRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5jb25maWdQZXJtaXNzaW9uc107XG4gICAgICAgIHZhciBhZG1pblBlcm1pc3Npb25zQml0bWFzayA9IFtFVldFQjIucGVybWlzc2lvbnNCaXRtYXNrLmNvbmZpZ1Blcm1pc3Npb25zXTtcbiAgICAgICAgdmFyIGFkbWluTWFzayA9IGJpdG1hc2tWYWx1ZXMuYWRtaW47XG4gICAgICAgICQuZWFjaChhZG1pblBlcm1pc3Npb25zQml0bWFzaywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICQuZWFjaChlbGVtZW50LCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYoKCh2YWx1ZSB8IGFkbWluTWFzaykgPT09IGFkbWluTWFzaykgJiYgYWRtaW5QZXJtaXNzaW9uc0FycltpbmRleF0uaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucy5wdXNoKGFkbWluUGVybWlzc2lvbnNBcnJbaW5kZXhdW2tleV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgdmFyIGdyb3VwUGVybWlzc2lvbnNBcnIgPSBbRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5ncm91cFBlcm1pc3Npb25zXTtcbiAgICAgICAgdmFyIGdyb3VwUGVybWlzc2lvbnNCaXRtYXNrID0gW0VWV0VCMi5wZXJtaXNzaW9uc0JpdG1hc2suZ3JvdXBQZXJtaXNzaW9uc107XG4gICAgICAgIHZhciBncm91cE1hc2sgPSBiaXRtYXNrVmFsdWVzLmdyb3VwO1xuICAgICAgICAkLmVhY2goZ3JvdXBQZXJtaXNzaW9uc0JpdG1hc2ssIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAkLmVhY2goZWxlbWVudCwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmKCgodmFsdWUgfCBncm91cE1hc2spID09PSBncm91cE1hc2spICYmIGdyb3VwUGVybWlzc2lvbnNBcnJbaW5kZXhdLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMucHVzaChncm91cFBlcm1pc3Npb25zQXJyW2luZGV4XVtrZXldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tYml0d2lzZSAqL1xuXG4gICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlVzZXJHcm91cFBlcm1pc3Npb25zKHBlcm1pc3Npb25zKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgaGVscGVyIHV0aWxpdHkgZm9yIHByb2Nlc3NpbmcgYSBzZXJ2ZXIgcmVzcG9uc2UgdG8gZ2VuZXJhdGUgYSB1c2VyIHBlcm1pc3Npb25zIG9iamVjdC5cbiAgICAgKiBUaGlzIGlzIGEgbGVnYWN5IG1ldGhvZCB0aGF0IHByb2Nlc3NlcyBwZXJtaXNzaW9ucyBhdCB0aGUgdXNlciBsZXZlbC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2VydmVyRGF0YSBUaGUgc2VydmVyIHJlc3BvbnNlIGRhdGFcbiAgICAgKiBAcmV0dXJucyB7RVZXRUIyLlVzZXJQZXJtaXNzaW9uc30gVGhlIHVzZXIgcGVybWlzc2lvbnNcbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIudXRpbC5pbnRlcm5hbC5wcm9jZXNzVXNlckdyb3VwUGVybWlzc2lvbnN9IHdoaWNoIGdlbmVyYXRlc1xuICAgICAqIGEgdXNlciBncm91cCBwZXJtaXNzaW9ucyBvYmplY3QuXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NTZXJ2ZXJQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKHNlcnZlckRhdGEpIHtcbiAgICAgICAgdmFyIHVzZXJQZXJtaXNzaW9uc0luZm8gPSBzZXJ2ZXJEYXRhLnVzZXJfcGVybWlzc2lvbnM7XG4gICAgICAgIHZhciBsaXZlUGVybWlzc2lvbnM7XG4gICAgICAgIHZhciBzZWFyY2hQZXJtaXNzaW9ucztcbiAgICAgICAgdmFyIGFjY2Vzc0xldmVsID0gRVZXRUIyLmFjY2Vzc0xldmVsVHlwZS51bmtub3duO1xuXG4gICAgICAgIGlmKHVzZXJQZXJtaXNzaW9uc0luZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB1c2VyIHBlcm1pc3Npb25zIGZvciBMaXZlXG4gICAgICAgICAgICBsaXZlUGVybWlzc2lvbnMgPSBuZXcgRVZXRUIyLkxpdmVVc2VyUGVybWlzc2lvbnModXNlclBlcm1pc3Npb25zSW5mby5saXZlLFxuICAgICAgICAgICAgICAgIHVzZXJQZXJtaXNzaW9uc0luZm8ubGl2ZV9ncm91cHMsIHVzZXJQZXJtaXNzaW9uc0luZm8ubGl2ZV9tYXBzLCB1c2VyUGVybWlzc2lvbnNJbmZvLmxpdmVfdmlld3MsXG4gICAgICAgICAgICAgICAgdXNlclBlcm1pc3Npb25zSW5mby5xdWlja19yZXBsYXksIHVzZXJQZXJtaXNzaW9uc0luZm8ucHR6LCB1c2VyUGVybWlzc2lvbnNJbmZvLnR3b193YXlfYXVkaW8sXG4gICAgICAgICAgICAgICAgdXNlclBlcm1pc3Npb25zSW5mby5ldmVudF9tb25pdG9yLCB1c2VyUGVybWlzc2lvbnNJbmZvLmxpdmVfc2F2ZV9pbWFnZSxcbiAgICAgICAgICAgICAgICB1c2VyUGVybWlzc2lvbnNJbmZvLmxpdmVfcHJpbnRfaW1hZ2UsIHVzZXJQZXJtaXNzaW9uc0luZm8ubGl2ZV9jYW1lcmFzLCB1c2VyUGVybWlzc2lvbnNJbmZvLnZpZGVvX3B1c2gpO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHVzZXIgcGVybWlzc2lvbnMgZm9yIFNlYXJjaFxuICAgICAgICAgICAgc2VhcmNoUGVybWlzc2lvbnMgPSBuZXcgRVZXRUIyLlNlYXJjaFVzZXJQZXJtaXNzaW9ucyh1c2VyUGVybWlzc2lvbnNJbmZvLnNlYXJjaCxcbiAgICAgICAgICAgICAgICB1c2VyUGVybWlzc2lvbnNJbmZvLnNlYXJjaF9ncm91cHMsIHVzZXJQZXJtaXNzaW9uc0luZm8uc2VhcmNoX21hcHMsIHVzZXJQZXJtaXNzaW9uc0luZm8uc2VhcmNoX3ZpZXdzLFxuICAgICAgICAgICAgICAgIHVzZXJQZXJtaXNzaW9uc0luZm8uc2VhcmNoX2V2ZW50cywgdXNlclBlcm1pc3Npb25zSW5mby5zYXZlX2ltYWdlLCB1c2VyUGVybWlzc2lvbnNJbmZvLnByaW50X2ltYWdlLFxuICAgICAgICAgICAgICAgIHVzZXJQZXJtaXNzaW9uc0luZm8uYnVybl9kaXNjLCB1c2VyUGVybWlzc2lvbnNJbmZvLmV4cG9ydF92aWRlbywgdXNlclBlcm1pc3Npb25zSW5mby5zbWFydF9zZWFyY2gsXG4gICAgICAgICAgICAgICAgdXNlclBlcm1pc3Npb25zSW5mby5zZWFyY2hfY2FzZXMsIHVzZXJQZXJtaXNzaW9uc0luZm8uc2VhcmNoX2NhbWVyYXMpO1xuXG4gICAgICAgICAgICBhY2Nlc3NMZXZlbCA9IHVzZXJQZXJtaXNzaW9uc0luZm8uYWNjZXNzTGV2ZWw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBjb25maWcgcGVybWlzc2lvbnMgZm9yIHRoZSB1c2VyXG4gICAgICAgIHZhciBhZG1pbkFjY2Vzc0luZm8gPSBzZXJ2ZXJEYXRhLmFkbWluX2FjY2Vzc19wZXJtaXNzaW9ucztcbiAgICAgICAgdmFyIGNvbmZpZ1Blcm1pc3Npb25zO1xuICAgICAgICBpZihhZG1pbkFjY2Vzc0luZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY29uZmlnUGVybWlzc2lvbnMgPSBuZXcgRVZXRUIyLkNvbmZpZ1VzZXJQZXJtaXNzaW9ucyhhZG1pbkFjY2Vzc0luZm8udXNlcnMsIGFkbWluQWNjZXNzSW5mby52aWV3cyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVXNlclBlcm1pc3Npb25zKGxpdmVQZXJtaXNzaW9ucywgc2VhcmNoUGVybWlzc2lvbnMsIGNvbmZpZ1Blcm1pc3Npb25zLCBhY2Nlc3NMZXZlbCk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFBhcnNlIHRoZSBJUCBhZGRyZXNzIGZyb20gYW4gUlRTUCBob3N0IFVSTC5cbiAgICAgKiBOT1RFOiBDYW4gb25seSBwYXJzZSBJUHY0IGFkZHJlc3Nlcy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaG9zdCB0aGUgUlRTUCBVUkxcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgSVAgYWRkcmVzcyBvciBudWxsIGlmIGEgdmFsaWQgSVAgYWRkcmVzcyB3YXMgbm90IGZvdW5kLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5wYXJzZVJ0c3BJcEFkZHJlc3MgPSBmdW5jdGlvbihob3N0KSB7XG4gICAgICAgIGlmKHR5cGVvZiBob3N0ICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcnRzcDovLzxpcC1hZGRyZXNzPjpwb3J0L3BhdGgjPGtleT49PHZhbHVlPiY8a2V5Pj08dmFsdWU+XG4gICAgICAgIC8vIGh0dHA6Ly88aXAtYWRkcmVzcz46cG9ydC9wYXRoIzxrZXk+PTx2YWx1ZT4mPGtleT49PHZhbHVlPlxuXG4gICAgICAgIC8vIGZyb20gcmVnZXggY29va2Jvb2tcbiAgICAgICAgdmFyIGlwdjRSZSA9IC8oPzooPzoyNVswLTVdfDJbMC00XVswLTldfFswMV0/WzAtOV1bMC05XT8pXFwuKXszfSg/OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPykvO1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IGhvc3QubWF0Y2goaXB2NFJlKTtcbiAgICAgICAgaWYgKG1hdGNoZXMgIT09IG51bGwgJiYgbWF0Y2hlcy5sZW5ndGgpe1xuICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbMF07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2ltcGxlSG9zdFJlID0gLyg/OnJ0c3B8aHR0cHxodHRwcyk6XFwvXFwvKFswLTlhLXpBLVpcXC5dKykoOlswLTldKyk/LztcbiAgICAgICAgbWF0Y2hlcyA9IGhvc3QubWF0Y2goc2ltcGxlSG9zdFJlKTtcbiAgICAgICAgaWYgKG1hdGNoZXMgIT09IG51bGwgJiYgbWF0Y2hlcy5sZW5ndGggPiAxKXtcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzWzFdO1xuICAgICAgICB9XG5cblxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXRpbGl0eSBmdW5jdGlvbiB0byBnZW5lcmF0ZSB0aGUgZ3JvdXAgcGVybWlzc2lvbnMgb2JqZWN0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlVzZXJQZXJtaXNzaW9uc30gW3Blcm1pc3Npb25zPW51bGxdIFRoZSB1c2VyIHBlcm1pc3Npb25zIG9iamVjdFxuICAgICAqIEByZXR1cm4ge0VWV0VCMi5Vc2VyR3JvdXBQZXJtaXNzaW9uc30gVGhlIGdyb3VwIHBlcm1pc3Npb25zXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLmludGVybmFsLmdlbmVyYXRlR3JvdXBQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKHBlcm1pc3Npb25zKSB7XG4gICAgICAgIHZhciBwZXJtaXNzaW9uc0FyciA9IFtcbiAgICAgICAgICAgIHBlcm1pc3Npb25zLmxpdmVQZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIHBlcm1pc3Npb25zLnNlYXJjaFBlcm1pc3Npb25zLFxuICAgICAgICAgICAgcGVybWlzc2lvbnMuY29uZmlnUGVybWlzc2lvbnNcbiAgICAgICAgXTtcbiAgICAgICAgdmFyIHVzZXJQZXJtaXNzaW9uc0FyciA9IFtcbiAgICAgICAgICAgIEVWV0VCMi51c2VyUGVybWlzc2lvbnMubGl2ZVBlcm1pc3Npb25zLFxuICAgICAgICAgICAgRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5zZWFyY2hQZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIEVWV0VCMi51c2VyUGVybWlzc2lvbnMuY29uZmlnUGVybWlzc2lvbnNcbiAgICAgICAgXTtcbiAgICAgICAgdmFyIGdyb3VwUGVybWlzc2lvbnMgPSBbXTtcblxuICAgICAgICAkLmVhY2gocGVybWlzc2lvbnNBcnIsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICBpZihlbGVtZW50ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5lYWNoKGVsZW1lbnQsIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZih2YWx1ZSAmJiB1c2VyUGVybWlzc2lvbnNBcnJbaW5kZXhdLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBQZXJtaXNzaW9ucy5wdXNoKHVzZXJQZXJtaXNzaW9uc0FycltpbmRleF1ba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Vc2VyR3JvdXBQZXJtaXNzaW9ucyhncm91cFBlcm1pc3Npb25zKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVXRpbGl0eSBmdW5jdGlvbiB0byBnZW5lcmF0ZSB0aGUgdXNlciBwZXJtaXNzaW9ucyBvYmplY3QuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVXNlckdyb3VwUGVybWlzc2lvbnN9IGdyb3VwUGVybWlzc2lvbnMgVGhlIGdyb3VwIHBlcm1pc3Npb25zIG9iamVjdFxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmFjY2Vzc0xldmVsVHlwZX0gW2FjY2Vzc0xldmVsPUVWV0VCMi5hY2Nlc3NMZXZlbFR5cGUudW5rbm93bl0gVGhlIGFjY2VzcyBsZXZlbCBvZiB0aGUgZ3JvdXBcbiAgICAgKiBAcmV0dXJuIHtFVldFQjIuVXNlclBlcm1pc3Npb25zfSBUaGUgdXNlciBwZXJtaXNzaW9uc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5nZW5lcmF0ZVVzZXJQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKGdyb3VwUGVybWlzc2lvbnMsIGFjY2Vzc0xldmVsKSB7XG4gICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IGdyb3VwUGVybWlzc2lvbnMucGVybWlzc2lvbnM7XG4gICAgICAgIHZhciB1c2VyUGVybWlzc2lvbnNBcnIgPSBbXG4gICAgICAgICAgICBFVldFQjIudXNlclBlcm1pc3Npb25zLmxpdmVQZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIEVWV0VCMi51c2VyUGVybWlzc2lvbnMuc2VhcmNoUGVybWlzc2lvbnMsXG4gICAgICAgICAgICBFVldFQjIudXNlclBlcm1pc3Npb25zLmNvbmZpZ1Blcm1pc3Npb25zXG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIGk7XG4gICAgICAgIHZhciBsaXZlUGVybWlzc2lvbnMgPSBuZXcgRVZXRUIyLkxpdmVVc2VyUGVybWlzc2lvbnMoKTtcbiAgICAgICAgdmFyIHNlYXJjaFBlcm1pc3Npb25zID0gbmV3IEVWV0VCMi5TZWFyY2hVc2VyUGVybWlzc2lvbnMoKTtcbiAgICAgICAgdmFyIGNvbmZpZ1Blcm1pc3Npb25zID0gbmV3IEVWV0VCMi5Db25maWdVc2VyUGVybWlzc2lvbnMoKTtcblxuICAgICAgICB2YXIga2V5cyA9IFtsaXZlUGVybWlzc2lvbnMsIHNlYXJjaFBlcm1pc3Npb25zLCBjb25maWdQZXJtaXNzaW9ucywgdW5kZWZpbmVkXTtcblxuICAgICAgICBmb3IoaT0wOyBpIDwgcGVybWlzc2lvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBlbnVtVmFsID0gcGVybWlzc2lvbnNbaV07XG4gICAgICAgICAgICAkLmVhY2godXNlclBlcm1pc3Npb25zQXJyLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVudW1WYWwgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlzW2luZGV4XVtrZXldID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Vc2VyUGVybWlzc2lvbnMobGl2ZVBlcm1pc3Npb25zLCBzZWFyY2hQZXJtaXNzaW9ucywgY29uZmlnUGVybWlzc2lvbnMsIGFjY2Vzc0xldmVsKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgaGVscGVyIHV0aWxpdHkgZm9yIGdlbmVyYXRpbmcgYSB1c2VyIGdyb3VwJ3MgcGVybWlzc2lvbnMgYml0bWFzayB2YWx1ZXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVXNlckdyb3VwUGVybWlzc2lvbnN9IGdyb3VwUGVybWlzc2lvbnMgVGhlIHVzZXIgZ3JvdXAgcGVybWlzc2lvbnMuXG4gICAgICogQHJldHVybnMge09iamVjdH0gVGhlIGJpdG1hc2sgdmFsdWVzLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5nZW5lcmF0ZVBlcm1pc3Npb25zQml0bWFzayA9IGZ1bmN0aW9uKGdyb3VwUGVybWlzc2lvbnMpIHtcbiAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gZ3JvdXBQZXJtaXNzaW9ucy5wZXJtaXNzaW9ucztcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tYml0d2lzZSAqL1xuICAgICAgICB2YXIgYml0bWFzayA9IHtcbiAgICAgICAgICAgIHVzZXI6IDAsXG4gICAgICAgICAgICBhZG1pbjogMCxcbiAgICAgICAgICAgIGdyb3VwOiAwXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHVzZXJQZXJtaXNzaW9uc0FyciA9IFtcbiAgICAgICAgICAgIEVWV0VCMi51c2VyUGVybWlzc2lvbnMubGl2ZVBlcm1pc3Npb25zLFxuICAgICAgICAgICAgRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5zZWFyY2hQZXJtaXNzaW9uc1xuICAgICAgICBdO1xuXG4gICAgICAgIHZhciB1c2VyUGVybWlzc2lvbnNCaXRtYXNrID0gW1xuICAgICAgICAgICAgRVZXRUIyLnBlcm1pc3Npb25zQml0bWFzay5saXZlUGVybWlzc2lvbnMsXG4gICAgICAgICAgICBFVldFQjIucGVybWlzc2lvbnNCaXRtYXNrLnNlYXJjaFBlcm1pc3Npb25zXG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIGFkbWluUGVybWlzc2lvbnNBcnIgPSBbRVZXRUIyLnVzZXJQZXJtaXNzaW9ucy5jb25maWdQZXJtaXNzaW9uc107XG4gICAgICAgIHZhciBhZG1pblBlcm1pc3Npb25zQml0bWFzayA9IFtFVldFQjIucGVybWlzc2lvbnNCaXRtYXNrLmNvbmZpZ1Blcm1pc3Npb25zXTtcblxuICAgICAgICB2YXIgZ3JvdXBQZXJtaXNzaW9uc0FyciA9IFtFVldFQjIudXNlclBlcm1pc3Npb25zLmdyb3VwUGVybWlzc2lvbnNdO1xuICAgICAgICB2YXIgZ3JvdXBQZXJtaXNzaW9uc0JpdG1hc2sgPSBbRVZXRUIyLnBlcm1pc3Npb25zQml0bWFzay5ncm91cFBlcm1pc3Npb25zXTtcblxuICAgICAgICB2YXIgaTtcbiAgICAgICAgZm9yKGk9MDsgaSA8IHBlcm1pc3Npb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAkLmVhY2godXNlclBlcm1pc3Npb25zQXJyLCBmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goZWxlbWVudCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBwZXJtaXNzaW9uc1tpXSAmJiB1c2VyUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaXRtYXNrLnVzZXIgPSBiaXRtYXNrLnVzZXIgfCB1c2VyUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XVtrZXldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJC5lYWNoKGFkbWluUGVybWlzc2lvbnNBcnIsIGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHBlcm1pc3Npb25zW2ldICYmIGFkbWluUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaXRtYXNrLmFkbWluID0gYml0bWFzay5hZG1pbiB8IGFkbWluUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XVtrZXldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJC5lYWNoKGdyb3VwUGVybWlzc2lvbnNBcnIsIGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IHBlcm1pc3Npb25zW2ldICYmIGdyb3VwUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBiaXRtYXNrLmdyb3VwID0gYml0bWFzay5ncm91cCB8IGdyb3VwUGVybWlzc2lvbnNCaXRtYXNrW2luZGV4XVtrZXldO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgcmV0dXJuIGJpdG1hc2s7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFByb2Nlc3NlcyBhIHJlc3BvbnNlIHNlcnZlciBpdGVtIGZyb20gYSBsb2dpbi53ZWIgY2FsbCBhbmQgZ2VuZXJhdGVzIGFuIEVWV0VCMi5TZXJ2ZXJEZXRhaWxJbmZvIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXJ2ZXJSZXNwb25zZSBBIHNlcnZlciBlbnRyeSBmcm9tIGEgbG9naW4ud2ViIGNhbGwuXG4gICAgICogQHJldHVybiB7RVZXRUIyLlNlcnZlckRldGFpbEluZm99IFRoZSBzZXJ2ZXIgZGV0YWlsc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5wcm9jZXNzU2VydmVyRGV0YWlscyA9IGZ1bmN0aW9uKHNlcnZlclJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBzZXJ2ZXJJbmZvO1xuICAgICAgICBpZih0eXBlb2Ygc2VydmVyUmVzcG9uc2UuYWRkcmVzcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgc2VydmVyIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgc2VydmVySW5mbyA9IG5ldyBFVldFQjIuU2VydmVyRGV0YWlsSW5mbyhzZXJ2ZXJSZXNwb25zZS5hZGRyZXNzLCBzZXJ2ZXJSZXNwb25zZS5wb3J0LFxuICAgICAgICAgICAgICAgIHNlcnZlclJlc3BvbnNlLm1vZGVsLCBzZXJ2ZXJSZXNwb25zZS5zZXJpYWwsIHNlcnZlclJlc3BvbnNlLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgc2VydmVyUmVzcG9uc2UuZGF5c1JlY29yZGVkVmlkZW8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzZXJ2ZXJJbmZvO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQcm9jZXNzZXMgYSByZXNwb25zZSBzZXJ2ZXIgaXRlbSBmcm9tIGEgbG9naW4ud2ViIGNhbGwgYW5kIGdlbmVyYXRlcyBhbiBFVldFQjIuU2VydmVyTGljZW5zZUluZm8gaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNlcnZlclJlc3BvbnNlIEEgc2VydmVyIGVudHJ5IGZyb20gYSBsb2dpbi53ZWIgY2FsbC5cbiAgICAgKiBAcmV0dXJuIHtFVldFQjIuU2VydmVyTGljZW5zZUluZm99IFRoZSBzZXJ2ZXIgbGljZW5zZSBpbmZvXG4gICAgICogQGludGVybmFsXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NTZXJ2ZXJMaWNlbnNlID0gZnVuY3Rpb24oc2VydmVyUmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGxpY2Vuc2VJbmZvO1xuICAgICAgICB2YXIgbGljZW5zZSA9IHNlcnZlclJlc3BvbnNlLmxpY2Vuc2VJbmZvO1xuICAgICAgICBpZih0eXBlb2YgbGljZW5zZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIC8vIEFkZGl0aW9uYWwgc2VydmVyIGluZm9ybWF0aW9uIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgdmFyIGV4cGlyYXRpb25EYXRlID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGxpY2Vuc2UuZXhwaXJhdGlvbkRhdGUpO1xuICAgICAgICAgICAgbGljZW5zZUluZm8gPSBuZXcgRVZXRUIyLlNlcnZlckxpY2Vuc2VJbmZvKGxpY2Vuc2UubWFjQWRkcmVzcywgZXhwaXJhdGlvbkRhdGUsIGxpY2Vuc2UuZXhwaXJlZCxcbiAgICAgICAgICAgICAgICBsaWNlbnNlLnJlc3RyaWN0ZWQsIGxpY2Vuc2UuZW50ZXJwcmlzZSwgbGljZW5zZS5tYXhBbmFsb2dDYW1lcmFzLCBsaWNlbnNlLm1heElwQ2FtZXJhcyxcbiAgICAgICAgICAgICAgICBsaWNlbnNlLm1heEJvYXJkcywgbGljZW5zZS5saWNlbnNlVHlwZSwgbGljZW5zZS5saWNlbnNlS2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGljZW5zZUluZm87XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFV0aWxpdHkgbWV0aG9kIHRoYXQgcHJvY2Vzc2VzIGEgY2FtZXJhIG9zZCBpbmZvcm1hdGlvbiBhbmQgZ2VuZXJhdGVzIGFuIEVWV0VCMi5DYW1lcmFPc2RJbmZvIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvc2QgVGhlIG9zZCBpbmZvIGZvciBhIGNhbWVyYS5cbiAgICAgKiBAcmV0dXJuIHtFVldFQjIuQ2FtZXJhT3NkSW5mb30gVGhlIGNhbWVyYSBPU0QgaW5mb1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBFVldFQjIudXRpbC5pbnRlcm5hbC5mb3JtYXRPc2RJbmZvID0gZnVuY3Rpb24ob3NkKSB7XG4gICAgICAgIHZhciBvc2RJbmZvID0gbmV3IEVWV0VCMi5DYW1lcmFPc2RJbmZvKCk7XG5cbiAgICAgICAgb3NkSW5mby5wb3NpdGlvbiA9IG9zZC5wb3NpdGlvbjtcbiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tYml0d2lzZSAqL1xuICAgICAgICBvc2RJbmZvLm5hbWUgPSBCb29sZWFuKG9zZC5kaXNwbGF5ICYgRVZXRUIyLm9zZERpc3BsYXkubmFtZSk7XG4gICAgICAgIG9zZEluZm8udGltZSA9IEJvb2xlYW4ob3NkLmRpc3BsYXkgJiBFVldFQjIub3NkRGlzcGxheS50aW1lKTtcbiAgICAgICAgb3NkSW5mby5kYXRlID0gQm9vbGVhbihvc2QuZGlzcGxheSAmIEVWV0VCMi5vc2REaXNwbGF5LmRhdGUpO1xuICAgICAgICBvc2RJbmZvLnRpbWV6b25lID0gQm9vbGVhbihvc2QuZGlzcGxheSAmIEVWV0VCMi5vc2REaXNwbGF5LnRpbWV6b25lKTtcbiAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgIG9zZEluZm8uZm9udCA9IG9zZC5mb250TmFtZTtcbiAgICAgICAgb3NkSW5mby5mb250U2l6ZSA9IG9zZC5mb250U2l6ZTtcbiAgICAgICAgb3NkSW5mby5mb250Q29sb3IgPSBvc2QuZXZGb250Q29sb3I7XG4gICAgICAgIG9zZEluZm8uZm9udFN0eWxlID0gb3NkLmV2Rm9udFN0eWxlO1xuICAgICAgICBvc2RJbmZvLmZvbnRGYW1pbHkgPSBvc2QuZXZGb250RmFtaWx5O1xuICAgICAgICBvc2RJbmZvLmZvbnRXZWlnaHQgPSBvc2QuZXZGb250V2VpZ2h0O1xuXG4gICAgICAgIHJldHVybiBvc2RJbmZvO1xuICAgIH07XG5cbn0oKSk7XG4iLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogQGNsYXNzXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgYSBzZXJ2aWNlIHZlcnNpb24uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFttYWpvcj0wXSBUaGUgbWFqb3IgY29tcG9uZW50IG9mIGEgdmVyc2lvbi5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW21pbm9yPTBdIFRoZSBtaW5vciBjb21wb25lbnQgb2YgYSB2ZXJzaW9uLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbYnVpbGQ9MF0gVGhlIGJ1aWxkIGNvbXBvbmVudCBvZiBhIHZlcnNpb24uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtxZmU9MF0gVGhlIFFGRSBjb21wb25lbnQgb2YgYSB2ZXJzaW9uLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VWZXJzaW9uID0gZnVuY3Rpb24obWFqb3IsIG1pbm9yLCBidWlsZCwgcWZlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWFqb3IgY29tcG9uZW50IG9mIGEgdmVyc2lvblxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tYWpvciA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtaW5vciBjb21wb25lbnQgb2YgYSB2ZXJzaW9uXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1pbm9yID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGJ1aWxkIGNvbXBvbmVudCBvZiBhIHZlcnNpb25cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnVpbGQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgUUZFIGNvbXBvbmVudCBvZiBhIHZlcnNpb25cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucWZlID0gMDtcblxuICAgICAgICBpZihtYWpvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1ham9yID0gbWFqb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYobWlub3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5taW5vciA9IG1pbm9yO1xuICAgICAgICB9XG4gICAgICAgIGlmKGJ1aWxkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYnVpbGQgPSBidWlsZDtcbiAgICAgICAgfVxuICAgICAgICBpZihxZmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5xZmUgPSBxZmU7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQ29udmVydHMgdGhlIHZlcnNpb24gdG8gYSBzdHJpbmcgb2YgdGhlIGZvcm1hdCBNQUpPUi5NSU5PUi5CVUlMRC5RRkUuXG4gICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSB2ZXJzaW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFqb3IudG9TdHJpbmcoKSArICcuJyArXG4gICAgICAgICAgICAgICAgKHRoaXMubWFqb3IgPj0gMTkgJiYgdGhpcy5taW5vciA8IDEwID9cbiAgICAgICAgICAgICAgICAgICAgJzAnICsgdGhpcy5taW5vci50b1N0cmluZygpICsgJy4nICA6ICArIHRoaXMubWlub3IudG9TdHJpbmcoKSArICcuJykgK1xuICAgICAgICAgICAgICAgIHRoaXMuYnVpbGQudG9TdHJpbmcoKSArICcuJyArXG4gICAgICAgICAgICAgICAgdGhpcy5xZmUudG9TdHJpbmcoKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ29tcGFyZXMgd2hldGhlciB0aGUgcHJvdmlkZWQgdmVyc2lvbiBpcyB0aGUgc2FtZSBhcyB0aGlzIHZlcnNpb25cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVZlcnNpb259IHZlcnNpb24gVGhlIHZlcnNpb24gdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdmVyc2lvbnMgYXJlIHRoZSBzYW1lLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcXVhbHMgPSBmdW5jdGlvbih2ZXJzaW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tYWpvciA9PT0gdmVyc2lvbi5tYWpvclxuICAgICAgICAgICAgICAgICYmIHRoaXMubWlub3IgPT09IHZlcnNpb24ubWlub3JcbiAgICAgICAgICAgICAgICAmJiB0aGlzLmJ1aWxkID09PSB2ZXJzaW9uLmJ1aWxkXG4gICAgICAgICAgICAgICAgJiYgdGhpcy5xZmUgPT09IHZlcnNpb24ucWZlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb21wYXJlcyB3aGV0aGVyIHRoaXMgdmVyc2lvbiBpcyBsZXNzIHRoYW4gdGhlIHByb3ZpZGVkIHZlcnNpb24uICBOb3RlOiB0aGlzIGRvZXMgbm90XG4gICAgICAgICAqIHRha2UgaW50byBhY2NvdW50IGVxdWFsaXR5LiAgSWYgdGhlIHZlcnNpb25zIGFyZSBlcXVhbCwgdGhlIHNvdXJjZSB2ZXJzaW9uIGlzIG5vdFxuICAgICAgICAgKiBsZXNzIHRoYW4gdGhlIHByb3ZpZGVkIHZlcnNpb24gYW5kIHdpbGwgcmV0dXJuIGZhbHNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlVmVyc2lvbn0gdmVyc2lvbiBUaGUgdmVyc2lvbiB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdmVyc2lvbiBpcyBsZXNzIHRoYW4gdGhlIHByb3ZpZGVkIHZlcnNpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxlc3NUaGFuID0gZnVuY3Rpb24odmVyc2lvbikge1xuICAgICAgICAgICAgaWYodGhpcy5tYWpvciA8IHZlcnNpb24ubWFqb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMubWFqb3IgIT09IHZlcnNpb24ubWFqb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMubWlub3IgPCB2ZXJzaW9uLm1pbm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLm1pbm9yICE9PSB2ZXJzaW9uLm1pbm9yKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZih0aGlzLmJ1aWxkIDwgdmVyc2lvbi5idWlsZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5idWlsZCAhPT0gdmVyc2lvbi5idWlsZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucWZlIDwgdmVyc2lvbi5xZmU7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbXBhcmVzIHdoZXRoZXIgdGhpcyB2ZXJzaW9uIGlzIGdyZWF0ZXIgdGhhbiB0aGUgcHJvdmlkZWQgdmVyc2lvbi4gIE5vdGU6IHRoaXMgZG9lcyBub3RcbiAgICAgICAgICogdGFrZSBpbnRvIGFjY291bnQgZXF1YWxpdHkuICBJZiB0aGUgdmVyc2lvbnMgYXJlIGVxdWFsLCB0aGUgc291cmNlIHZlcnNpb24gaXMgbm90XG4gICAgICAgICAqIGdyZWF0ZXIgdGhhbiB0aGUgcHJvdmlkZWQgdmVyc2lvbiBhbmQgd2lsbCByZXR1cm4gZmFsc2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VWZXJzaW9ufSB2ZXJzaW9uIFRoZSB2ZXJzaW9uIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgICAgICogQHJldHVybnMge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB2ZXJzaW9uIGlzIGdyZWF0ZXIgdGhhbiB0aGUgcHJvdmlkZWQgdmVyc2lvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JlYXRlclRoYW4gPSBmdW5jdGlvbih2ZXJzaW9uKSB7XG4gICAgICAgICAgICBpZih0aGlzLm1ham9yID4gdmVyc2lvbi5tYWpvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5tYWpvciAhPT0gdmVyc2lvbi5tYWpvcikge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYodGhpcy5taW5vciA+IHZlcnNpb24ubWlub3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMubWlub3IgIT09IHZlcnNpb24ubWlub3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMuYnVpbGQgPiB2ZXJzaW9uLmJ1aWxkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLmJ1aWxkICE9PSB2ZXJzaW9uLmJ1aWxkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5xZmUgPiB2ZXJzaW9uLnFmZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2VzIGEgc3RyaW5nIG9mIHRoZSBmb3JtYXQgTUFKT1IuTUlOT1IuQlVJTEQuUUZFIGFuZCBwb3B1bGF0ZXMgdGhlIG9iamVjdCB3aXRoIHRob3NlIHZhbHVlcy5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHZlcnNpb25TdHJpbmcgVGhlIHZlcnNpb24gc3RyaW5nIHRvIHBhcnNlLlxuICAgICAgICAgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBwYXJzaW5nIHdhcyBzdWNjZXNzZnVsLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3B1bGF0ZUZyb21TdHJpbmcgPSBmdW5jdGlvbih2ZXJzaW9uU3RyaW5nKSB7XG4gICAgICAgICAgICB2YXIgc3RyaW5nVmFsdWVzID0gdmVyc2lvblN0cmluZy5zcGxpdCgnLicpO1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9ICQubWFwKHN0cmluZ1ZhbHVlcywgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyc2VkVmFsdWUgPSBwYXJzZUludCh2YWx1ZSwgMTApO1xuXG4gICAgICAgICAgICAgICAgaWYoIWlzTmFOKHBhcnNlZFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VkVmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZih2YWx1ZXMubGVuZ3RoICE9PSA0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5tYWpvciA9IHZhbHVlc1swXTtcbiAgICAgICAgICAgIHRoaXMubWlub3IgPSB2YWx1ZXNbMV07XG4gICAgICAgICAgICB0aGlzLmJ1aWxkID0gdmFsdWVzWzJdO1xuICAgICAgICAgICAgdGhpcy5xZmUgPSB2YWx1ZXNbM107XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBzZXJ2aWNlIEpQRUcgZm9yd2FyZGluZyBzZXR0aW5ncyBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhbGwgSlBFRyBmb3J3YXJkaW5nLXJlbGF0ZWQgaW5mb3JtYXRpb24gYXNzb2NpYXRlZFxuICAgICAqIHdpdGggYSBzZXJ2aWNlLlxuICAgICAqXG4gICAgICogSlBFRyBmb3J3YXJkaW5nIGlzIHRoZSBwcm9jZXNzIG9mIHJlcXVlc3RpbmcgYSBuYXRpdmUgSlBFRyBmcmFtZSwgaWYgYXZhaWxhYmxlLCBpbnN0ZWFkIG9mIGEgcmVzaXplZCBKUEVHIGZyYW1lLlxuICAgICAqIFVzaW5nIHRoZSBuYXRpdmUgZnJhbWUgcmVzdWx0cyBpbiBhIGxhcmdlciBmaWxlIHNpemUsIGJ1dCByZWR1Y2VzIHNlcnZlciBsb2FkIGFuZCBkZWNyZWFzZXMgcmVxdWVzdCBwcm9jZXNzaW5nXG4gICAgICogdGltZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2VuYWJsZWQ9ZmFsc2VdIFdoZXRoZXIgdG8gZW5hYmxlIEpQRUcgZm9yd2FyZGluZ1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbc2l6ZVRocmVzaG9sZD0xMDBdIFRoZSB0aHJlc2hvbGQgcGVyY2VudGFnZSBvZiB0aGUgcmVxdWVzdGVkIHNpemUgYmVmb3JlIGEgY2FtZXJhIHNob3VsZCB1c2VcbiAgICAgKiB0aGUgbmF0aXZlIEpQRUcgZnJhbWUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtxdWFsaXR5VGhyZXNob2xkPTEwMF0gVGhlIHRocmVzaG9sZCBwZXJjZW50YWdlIG9mIHRoZSByZXF1ZXN0ZWQgcXVhbGl0eSBiZWZvcmUgdGhlIGNhbWVyYVxuICAgICAqIHNob3VsZCB1c2UgdGhlIG5hdGl2ZSBKUEVHIGZyYW1lLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VKcGVnRm9yd2FyZGluZ1NldHRpbmdzID0gZnVuY3Rpb24oZW5hYmxlZCwgc2l6ZVRocmVzaG9sZCwgcXVhbGl0eVRocmVzaG9sZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0byBlbmFibGUgSlBFRyBmb3J3YXJkaW5nICh1c2Ugb2YgdGhlIG5hdGl2ZSBKUEVHIGZyYW1lLCBpZiBhdmFpbGFibGUsIGluc3RlYWQgb2YgYSByZXNpemVkIEpQRUdcbiAgICAgICAgICogZnJhbWUpIGZvciBhbGwgY2FtZXJhcyBvbiB0aGlzIHNlcnZpY2UgY29ubmVjdGlvbi4gIElmIGVuYWJsZWQsXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUpwZWdGb3J3YXJkaW5nU2V0dGluZ3Muc2l6ZVRocmVzaG9sZH0gYW5kXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUpwZWdGb3J3YXJkaW5nU2V0dGluZ3MucXVhbGl0eVRocmVzaG9sZH0gd2lsbCBiZSB1c2VkIHRvIGNhbGN1bGF0ZSB3aGV0aGVyIGEgcmVxdWVzdGVkXG4gICAgICAgICAqIGZyYW1lIHNob3VsZCBiZSB0aGUgbmF0aXZlIEpQRUcgZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIE5vdGU6IFRoaXMgc2V0dGluZyB3aWxsIGFwcGx5IGV2ZW4gaWYgcmVxdWVzdGVkIGFzcGVjdCByYXRpbyBpcyBkaWZmZXJlbnQgdGhhbiB0aGUgbmF0aXZlIGFzcGVjdCByYXRpby4gIEluXG4gICAgICAgICAqIHRoZXNlIHNpdHVhdGlvbnMsIHRoZSBibGFjayBiYW5kaW5nIHdpbGwgbm90IGJlIGFwcGxpZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdGhyZXNob2xkIHBlcmNlbnRhZ2Ugb2YgdGhlIHJlcXVlc3RlZCBzaXplIGJlZm9yZSBhIGNhbWVyYSBzaG91bGQgdXNlIHRoZSBuYXRpdmUgSlBFRyBmcmFtZSwgaWZcbiAgICAgICAgICogYXZhaWxhYmxlLCBpbnN0ZWFkIG9mIGEgc2NhbGVkIHZhbHVlLiAgVGhpcyBzZXR0aW5nIGlzIHVzZWQgaW4gdGFuZGVtIHdpdGhcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlSnBlZ0ZvcndhcmRpbmdTZXR0aW5ncy5xdWFsaXR5VGhyZXNob2xkfSwgc3VjaCB0aGF0IGJvdGggbXVzdCBiZSBhcHBsaWVkIGJlZm9yZSBhXG4gICAgICAgICAqIG5hdGl2ZSBKUEVHIGZyYW1lIGlzIHJldHJpZXZlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogRm9yIGV4YW1wbGUsIGlmIGEgY2FtZXJhJ3MgbmF0aXZlIHJlc29sdXRpb24gaXMgNjQweDQ4MCB3aXRoIGEgZm9yd2FyZGluZyB0aHJlc2hvbGQgb2YgNzAsIGFueSByZXF1ZXN0cyB0aGF0XG4gICAgICAgICAqIGFyZSBsYXJnZXIgdGhhbiA0NDh4MzM2ICg2NDAgKiAoNzAvMTAwKSl4KDQ4MCAqICg3MC8xMDApKSB3aWxsIGJlIHJldHVybmVkIGFzIHRoZSBuYXRpdmUgZnJhbWUuXG4gICAgICAgICAqXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcHJvcGVydHkgaXMgbm90IHVzZWQgaWYge0BsaW5rIEVWV0VCMi5TZXJ2aWNlSnBlZ0ZvcndhcmRpbmdTZXR0aW5ncy5lbmFibGVkfSBpcyBzZXQgdG8gZmFsc2UuXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaXplVGhyZXNob2xkID0gMTAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdGhyZXNob2xkIHBlcmNlbnRhZ2Ugb2YgdGhlIHJlcXVlc3RlZCBxdWFsaXR5IGJlZm9yZSB0aGUgY2FtZXJhIHNob3VsZCB1c2UgdGhlIG5hdGl2ZSBKUEVHIGZyYW1lLCBpZlxuICAgICAgICAgKiBhdmFpbGFibGUsIGluc3RlYWQgb2YgYSBzY2FsZWQgdmFsdWUuICBUaGlzIHNldHRpbmcgaXMgdXNlZCBpbiB0YW5kZW0gd2l0aFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VKcGVnRm9yd2FyZGluZ1NldHRpbmdzLnNpemVUaHJlc2hvbGR9LCBzdWNoIHRoYXQgYm90aCBtdXN0IGJlIGFwcGxpZWQgYmVmb3JlIGEgbmF0aXZlXG4gICAgICAgICAqIEpQRUcgZnJhbWUgaXMgcmV0cmlldmVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBGb3IgZXhhbXBsZSwgaWYgYSBjYW1lcmEncyBuYXRpdmUgcXVhbGl0eSBpcyA1IHdpdGggYSBmb3J3YXJkaW5nIHF1YWxpdHkgdGhyZXNob2xkIG9mIDcwLCBhbnkgcmVxdWVzdHMgdGhhdFxuICAgICAgICAgKiBoYXZlIGEgcXVhbGl0eSBhYm92ZSAzIChNYXRoLmZsb29yKDUgKiAoNzAvMTAwKSkpIHdpbGwgYmUgcmV0dXJuZWQgYXMgdGhlIG5hdGl2ZSBmcmFtZS5cbiAgICAgICAgICpcbiAgICAgICAgICogTm90ZTogVGhpcyBwcm9wZXJ0eSBpcyBub3QgdXNlZCBpZiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VKcGVnRm9yd2FyZGluZ1NldHRpbmdzLmVuYWJsZWR9IGlzIHNldCB0byBmYWxzZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnF1YWxpdHlUaHJlc2hvbGQgPSAxMDA7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgZW5hYmxlZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9IGVuYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHNpemVUaHJlc2hvbGQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNpemVUaHJlc2hvbGQgPSBzaXplVGhyZXNob2xkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBxdWFsaXR5VGhyZXNob2xkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5xdWFsaXR5VGhyZXNob2xkID0gcXVhbGl0eVRocmVzaG9sZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgYSBzZXQgb2YgdHJhbnNjb2RpbmcgcGFyYW1ldGVycyBhcmUgd2l0aGluIHRoZSB0aHJlc2hvbGQgdG8gYXBwbHkganBlZyBmb3J3YXJkaW5nIGZvciBhXG4gICAgICAgICAqIHBhcnRpY3VsYXIgY2FtZXJhLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5DYW1lcmF9IGNhbWVyYSBUaGUgY2FtZXJhLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIHRhcmdldCB0cmFuc2NvZGUgd2lkdGguXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIHRhcmdldCB0cmFuc2NvZGUgaGVpZ2h0LlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gcXVhbGl0eSBUaGUgdGFyZ2V0IHRyYW5zY29kZSBxdWFsaXR5ICgxLTEwKS5cbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0gV2hldGhlciBqcGVnIGZvcndhcmRpbmcgc2hvdWxkIGJlIGFwcGxpZWQgaWYgdGhlc2UgcGFyYW1ldGVycyBhcmUgdXNlZCB0byByZXF1ZXN0IGEgZnJhbWUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3VsZEZvcndhcmQgPSBmdW5jdGlvbihjYW1lcmEsIHdpZHRoLCBoZWlnaHQsIHF1YWxpdHkpIHtcbiAgICAgICAgICAgIGlmIChjYW1lcmEuZm9ybWF0cy5pbmRleE9mKEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWcpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNpemVSYXRpbyA9IHRoaXMuc2l6ZVRocmVzaG9sZCAvIDEwMDtcbiAgICAgICAgICAgIHJldHVybiBjYW1lcmEucXVhbGl0eSAqICh0aGlzLnF1YWxpdHlUaHJlc2hvbGQgLyAxMDApIDwgcXVhbGl0eSAmJlxuICAgICAgICAgICAgICAgIChjYW1lcmEucmVzb2x1dGlvbi53aWR0aCAqIHNpemVSYXRpbyA8IHdpZHRoIHx8IGNhbWVyYS5yZXNvbHV0aW9uLmhlaWdodCAqIHNpemVSYXRpbyA8IGhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIENvbmZpZ1VwZGF0ZVN0YXR1cyBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGNvbmZpZyB1cGRhdGUgc3RhdHVzIGluZm9ybWF0aW9uIHJlY2VpdmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2Vzc2lvbklkPScnXSBUaGUgc2Vzc2lvbiBJZCBvZiB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW2xhc3RVcGRhdGVkPW5ldyBEYXRlKCldIFRoZSB0aW1lc3RhbXAgb2YgdGhlIGxhc3QgY29uZmlnIHVwZGF0ZSBvbiB0aGUgc2VydmVyLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLkNvbmZpZ1VwZGF0ZVN0YXR1cyA9IGZ1bmN0aW9uIChzZXNzaW9uSWQsIGxhc3RVcGRhdGVkKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2Vzc2lvbiBJZCBvZiB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRpbWVzdGFtcCBvZiB0aGUgbGFzdCBjb25maWcgdXBkYXRlIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHNlc3Npb25JZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGxhc3RVcGRhdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFVwZGF0ZWQgPSBsYXN0VXBkYXRlZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBMaXN0aW5nIG9mIHdlYiBzZXJ2aWNlIHZlcnNpb25zIGFzc29jaWF0ZWQgd2l0aCBzcGVjaWZpYyBmZWF0dXJlcy4gIFRoaXMgaXNcbiAgICAgKiB1c2VkIHByaW1hcmlseSBmb3IgZmVhdHVyZSBjaGVja2luZyB3aGVuIGEgZmFsbGJhY2sgaXMgYXZhaWxhYmxlLlxuICAgICAqIEB0eXBlIHt7Y29yczogRVZXRUIyLlNlcnZpY2VWZXJzaW9ufX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICB2YXIgc2VydmljZUZlYXR1cmVWZXJzaW9ucyA9IHtcbiAgICAgICAgY29yczogbmV3IEVWV0VCMi5TZXJ2aWNlVmVyc2lvbig3LCA2LCAwKVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGEgd2ViIHNlcnZpY2UgYmFja2VuZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2hvc3RVcmw9JyddIFdlYiBzZXJ2aWNlIGJhc2UgVVJMIHVzZWQgaWYgZGlmZmVyZW50IHRoYW4gY3VycmVudCBVUkwuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzdWJkaXJlY3Rvcnk9JyddIFdlYiBzZXJ2aWNlIHN1YmRpcmVjdG9yeSBvbiB0aGUgY3VycmVudCBVUkwuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPSdVbnNldCddIE5hbWUgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3ZpZGVvUHVzaENsaWVudEd1aWRdIFRoZSBWaWRlb1B1c2ggY2xpZW50IEdVSUQgZ2VuZXJhdGVkIGZvciB0aGlzIGNsaWVudC4gIFRoaXMgdmFsdWUgaXNcbiAgICAgKiBjcmVhdGVkIGJ5IHRoZSBmaXJzdCBjYWxsIHRvIHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnVwZGF0ZUNsaWVudH0gYW5kIHNob3VsZCBiZSBzYXZlZCBhbmQgcmUtdXNlZCBmb3IgYWxsXG4gICAgICogbGF0ZXIgaW5zdGFudGlhdGlvbnMgb2YgdGhpcyBjbGllbnQuICBOb3RlOiBUaGUgbWV0aG9kIHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnNldFZpZGVvUHVzaENsaWVudEd1aWR9IGlzXG4gICAgICogcHJvdmlkZWQgdG8gcHJvdmlkZSB0aGUgc2FtZSBmdW5jdGlvbmFsaXR5IGFmdGVyIHNlcnZpY2UgY29uc3RydWN0aW9uLiAgVGhpcyBtZXRob2QgZG9lcyBub3QgbmVlZCB0byBiZSBjYWxsZWRcbiAgICAgKiBpZiBzcGVjaWZ5aW5nIHRoZSBHVUlEIGluIHRoaXMgY29uc3RydWN0b3Igb3IgaWYgdGhlIEdVSUQgaXMgY3JlYXRlZCBpbiB0aGlzIHNlc3Npb24uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZSA9IGZ1bmN0aW9uIChob3N0VXJsLCBzdWJkaXJlY3RvcnksIG5hbWUsIHZpZGVvUHVzaENsaWVudEd1aWQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhlIHNlcnZpY2VcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW5zZXQnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIb3N0IGJhc2UgVVJMXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ob3N0VXJsID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVmZmVjdGl2ZSBob3N0IFVSTC4gU2V0IGJ5IHtAbGluayBFVldFQjIuU2VydmljZS5zZXRVcmx9LlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZWZmZWN0aXZlVXJsID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhvc3QgYmFzZSBzdWJkaXJlY3RvcnlcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1YmRpcmVjdG9yeSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBVc2UgT25seS4gSWdub3JlcyBYU1Mgc2V0dGluZ3MgYW5kIG1ha2VzIHN0YW5kYXJkIEFKQVggcmVxdWVzdHMgaW5zdGVhZCBvZiBKU09OUC5cbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlnbm9yZVhzcyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCBVc2UgT25seS4gVGhlIHJlc291cmNlIGtleSBmb3IgcGFzc3Rocm91Z2ggY29tbXVuaWNhdGlvbiB0byBwcmV2ZW50IENTUkYgcmVxdWVzdC5cbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVzb3VyY2VLZXkgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBDU1JGIHByb3RlY3Rpb24gaXMgZW5hYmxlZCBmb3IgdGhlIHNlcnZpY2UuXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jc3JmID0gdHJ1ZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIEpQRUcgZm9yd2FyZGluZyBzZXR0aW5ncyBmb3IgdGhpcyBzZXJ2aWNlLiAgSlBFRyBmb3J3YXJkaW5nIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmljZUpwZWdGb3J3YXJkaW5nU2V0dGluZ3N9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmpwZWdGb3J3YXJkaW5nID0gbmV3IEVWV0VCMi5TZXJ2aWNlSnBlZ0ZvcndhcmRpbmdTZXR0aW5ncyhmYWxzZSwgMTAwLCAxMDApO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgc2VydmljZSdzIHtAbGluayBFVldFQjIuVmlkZW9QdXNofSBpbnN0YW5jZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5WaWRlb1B1c2h9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZpZGVvUHVzaCA9IG5ldyBFVldFQjIuVmlkZW9QdXNoKHZpZGVvUHVzaENsaWVudEd1aWQpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHVzaCBub3RpZmljYXRpb24gaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgc2VydmljZS4gIFRoaXMgaXMgdXNlZCB0byByZWdpc3RlciBhbmRcbiAgICAgICAgICogdW5yZWdpc3RlciBjbGllbnRzIGZvciByZWNlaXZpbmcgcHVzaCBub3RpZmljYXRpb25zLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlB1c2hOb3RpZmljYXRpb259XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnB1c2hOb3RpZmljYXRpb24gPSBuZXcgRVZXRUIyLlB1c2hOb3RpZmljYXRpb24odGhpcyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhpcyBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLldlYlNvY2tldEhhbmRsZXJ9XG4gICAgICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuICBUaGUgZGVmYXVsdCB2YWx1ZSBmb3IgdGhpc1xuICAgICAgICAgKiB3aWxsIGJlIHVwZGF0ZWQgdG8gRVZXRUIyLkxlZ2FjeVdlYlNvY2tldEhhbmRsZXIsIHdoaWNoIGltcGxlbWVudHMgcG9sbGluZyB0byByZXRyaWV2ZSBhbnkgc3RhdHVzXG4gICAgICAgICAqIGluZm9ybWF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53ZWJzb2NrZXQgPSBuZXcgRVZXRUIyLldlYlNvY2tldEhhbmRsZXIodGhpcyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhdXRob3JpemF0aW9uIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHNlcnZpY2UuICBUaGlzIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIHRoZVxuICAgICAgICAgKiB0eXBlIG9mIGF1dGhlbnRpY2F0aW9uIHVzZWQsIGFzIHdlbGwgYXMgdG8gYXV0aGVudGljYXRlIGZvciBhbGwgcmVxdWVzdHMgdG8gdGhpcyBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2VBdXRofVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRoID0gbmV3IEVWV0VCMi5TZXJ2aWNlQXV0aCh0aGlzKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHZlcnNpb24gbnVtYmVyIGhhcyBiZWVuIHJlcXVlc3RlZC5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgdmVyc2lvbk51bWJlclJlcXVlc3RlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgc2VydmljZSdzIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlQ29uZmlnfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb25maWcgPSBuZXcgRVZXRUIyLlNlcnZpY2VDb25maWcodGhpcyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZlcnNpb24gbnVtYmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2aWNlVmVyc2lvblxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdmFpbGFibGUgdmVyc2lvbiBudW1iZXJcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZpY2VWZXJzaW9uXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgYXZhaWxhYmxlVmVyc2lvbk51bWJlciA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIGNhY2hlZCBsaXN0IG9mIGF2YWlsYWJsZSBpbnB1dCBzdHJlYW0gZm9ybWF0IHR5cGVzLiAgVXNlZCBleGNsdXNpdmVseSBieVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2UuYXVkaW9JbnB1dEZvcm1hdFR5cGVzfS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5hdWRpb0lucHV0U3RyZWFtRm9ybWF0VHlwZXNbXX1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBhdmFpbGFibGVBdWRpb0lucHV0Rm9ybWF0cyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZnJpZW5kbHkgbmFtZSBvZiB0aGUgd2ViIHNlcnZpY2UuICBUaGlzIGlzIGEgY2FjaGVkIHZhbHVlIG9mIHRoZSByZXN1bHQgb2ZcbiAgICAgICAgICogYSBjYWxsIHRvIHtAbGluayBFVldFQjIuU2VydmljZS5mcmllbmRseU5hbWV9LlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGZyaWVuZGx5TmFtZSA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBob3N0VXJsICE9PSAndW5kZWZpbmVkJyAmJiBob3N0VXJsICE9PSAnJykge1xuICAgICAgICAgICAgLy8gVmVyaWZ5IGFuZCBjb3JyZWN0IHRoYXQgdGhlIGhvc3RuYW1lIGVuZHMgaW4gYSBzbGFzaFxuICAgICAgICAgICAgaWYgKGhvc3RVcmwuc3Vic3RyKGhvc3RVcmwubGVuZ3RoLTEpICE9PSBcIi9cIikge1xuICAgICAgICAgICAgICAgIGhvc3RVcmwgKz0gXCIvXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBWZXJpZnkgYW5kIGNvcnJlY3QgdGhhdCB0aGUgaG9zdG5hbWUgYmVnaW5zIHdpdGggYSBodHRwIGRlY2xhcmF0aW9uXG4gICAgICAgICAgICBpZiAoaG9zdFVybC5tYXRjaCgvXmh0dHBbc117MCwxfTpcXC9cXC8vKSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGhvc3RVcmwgPSBcImh0dHA6Ly9cIiArIGhvc3RVcmw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuaG9zdFVybCA9IGhvc3RVcmw7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0eXBlb2Ygc3ViZGlyZWN0b3J5ICE9PSAndW5kZWZpbmVkJyAmJiBzdWJkaXJlY3RvcnkgIT09ICcnKSB7XG4gICAgICAgICAgICBpZih0aGlzLmhvc3RVcmwgPT09ICcnICYmIHN1YmRpcmVjdG9yeS5zdWJzdHIoMCwxKSAhPT0gJy8nKSB7XG4gICAgICAgICAgICAgICAgc3ViZGlyZWN0b3J5ID0gJy8nICsgc3ViZGlyZWN0b3J5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0aGlzLmhvc3RVcmwgIT09ICcnICYmIHN1YmRpcmVjdG9yeS5zdWJzdHIoMCwxKSA9PT0gJy8nKSB7XG4gICAgICAgICAgICAgICAgc3ViZGlyZWN0b3J5ID0gc3ViZGlyZWN0b3J5LnN1YnN0cigxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFZlcmlmeSBhbmQgY29ycmVjdCB0aGF0IHRoZSBzdWJkaXJlY3RvcnkgZW5kcyBpbiBhIHNsYXNoXG4gICAgICAgICAgICBpZihzdWJkaXJlY3RvcnkubGVuZ3RoID4gMCAmJiBzdWJkaXJlY3Rvcnkuc3Vic3RyKHN1YmRpcmVjdG9yeS5sZW5ndGggLTEpICE9PSAnLycpIHtcbiAgICAgICAgICAgICAgICBzdWJkaXJlY3RvcnkgKz0gJy8nO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN1YmRpcmVjdG9yeSA9IHN1YmRpcmVjdG9yeTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHRoZSBWaWRlb1B1c2ggY2xpZW50IEdVSUQgZm9yIHRoaXMgc2VydmljZSBpbnN0YW5jZS4gIFRoaXMgdmFsdWUgaXMgY3JlYXRlZCBieSB0aGUgZmlyc3QgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaC51cGRhdGVDbGllbnR9IGFuZCBzaG91bGQgYmUgc2F2ZWQgYW5kIHJlLXVzZWQgZm9yIGFsbCBsYXRlciBpbnN0YW50aWF0aW9ucyBvZiB0aGlzXG4gICAgICAgICAqIGNsaWVudC4gIE5vdGU6IFRoaXMgdmFsdWUgY2FuIGFsc28gYmUgc2V0IHZpYSB0aGUge0BsaW5rIEVWV0VCMi5TZXJ2aWNlfSBjb25zdHJ1Y3RvciBhbmQgdGhpcyBmdW5jdGlvbiBpc1xuICAgICAgICAgKiBwcm92aWRlZCB0byBwcm92aWRlIHRoZSBzYW1lIGZ1bmN0aW9uYWxpdHkgYWZ0ZXIgc2VydmljZSBjb25zdHJ1Y3Rpb24uICBUaGlzIG1ldGhvZCBkb2VzIG5vdCBuZWVkIHRvIGJlXG4gICAgICAgICAqIGNhbGxlZCBpZiBzcGVjaWZ5aW5nIHRoZSBHVUlEIGluIHRoaXMgY29uc3RydWN0b3Igb3IgaWYgdGhlIEdVSUQgaXMgY3JlYXRlZCBpbiB0aGlzIHNlc3Npb24uXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBndWlkIFRoZSBnZW5lcmF0ZWQgVmlkZW9QdXNoIGNsaWVudCBHVUlEXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNldFZpZGVvUHVzaENsaWVudEd1aWQgPSBmdW5jdGlvbihndWlkKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvUHVzaCA9IG5ldyBFVldFQjIuVmlkZW9QdXNoKGd1aWQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm5zIHdoZXRoZXIgY29udGFjdGluZyB0aGUgc2VydmVyIGlzIGRvbmUgdmlhIFhTUyBvciBub3QuXG4gICAgICAgICAqIEByZXR1cm4gQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc1hzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLmlnbm9yZVhzcyAmJiB0aGlzLmhvc3RVcmwgIT09ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZW5lcmF0ZXMgdGhlIGZ1bGwgVVJMIHRvIGJlIHVzZWQgd2hlbiBjb250YWN0aW5nIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEByZXR1cm4gU3RyaW5nIFRoZSBmdWxsIFVSTCBmb3IgdGhlIHNlcnZlci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXJsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lZmZlY3RpdmVVcmwgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWZmZWN0aXZlVXJsICsgdGhpcy5zdWJkaXJlY3Rvcnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ob3N0VXJsICsgdGhpcy5zdWJkaXJlY3Rvcnk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVWV0VCMi5TZXJ2aWNlLnNldFVybCBhbGxvd3MgYSBjYWxsZXIgdG8gb3ZlcnJpZGUgdGhlIG5ldHdvcmsgYWRkcmVzcyBvcmlnaW5hbGx5IHByb3ZpZGVkIGluIHRoZVxuICAgICAgICAgKiBjb25zdHJ1Y3Rvci4gRnV0dXJlIGNhbGxzIHRvIEVWV0VCMi5TZXJ2aWNlLnVybCgpIHdpbGwgcmV0dXJuIHRoZSB2YWx1ZSBzZXQgYnkgdGhpcyBmdW5jdGlvbi4gT3V0c2lkZVxuICAgICAgICAgKiBvZiBvYmplY3QgcmVmIGNvbXBhcmlzb24sIHRoZSBzZXJ2aWNlIGNhbiBzdGlsbCBiZSB1bmlxdWVseSBpZGVudGlmaWVkIGJ5IGl0cyBvcmlnaW5hbCB7QGxpbmsgdGhpcy5ob3N0VXJsfVxuICAgICAgICAgKiBvbmNlIGFuIGVmZmVjdGl2ZSBhZGRyZXNzIGhhcyBiZWVuIHNldC5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCBUaGUgZWZmZWN0aXZlIHVybC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0VXJsID0gZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgICB0aGlzLmVmZmVjdGl2ZVVybCA9IHVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRVZXRUIyLlNlcnZpY2UucmVzZXRVcmwgYWxsb3dzIGEgY2FsbGVyIHRvIHJlc2V0IGFueSBwcmV2aW91cyBuZXR3b3JrIGFkZHJlc3Mgb3ZlcnJpZGUuIEZ1dHVyZVxuICAgICAgICAgKiBjYWxscyB0byBFVldFQjIuU2VydmljZS51cmwoKSB3aWxsIHJldHVybiB0aGUgb3JpZ2luYWwgaG9zdCBVUkwgcHJvdmlkZWQgaW4gdGhlIGNvbnN0cnVjdG9yLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXNldFVybCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdGhpcy5lZmZlY3RpdmVVcmwgPSAnJztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSB2ZXJzaW9uIG51bWJlciBmcm9tIHRoZSB3ZWIgc2VydmljZS4gIFRoaXMgY2FuIGJlIHVzZWQgdG8gZGV0ZXJtaW5lIHN1cHBvcnRlZCBmZWF0dXJlcy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIFRoZSBmdW5jdGlvbiBnZXRzXG4gICAgICAgICAqIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCB0aGUgcmVzdWx0aW5nIHZlcnNpb25cbiAgICAgICAgICogbnVtYmVyIHN0cmluZywgYSB7QGxpbmsgRVZXRUIyLlNlcnZpY2VWZXJzaW9ufSBpbnN0YW5jZSBvZiB0aGUgdmVyc2lvbiwgYW5kIGEge0BsaW5rIEVWV0VCMi5TZXJ2aWNlVmVyc2lvbn1cbiAgICAgICAgICogaW5zdGFuY2UgaW5kaWNhdGluZyB0aGUgbW9zdCByZWNlbnQgYXZhaWxhYmxlIHVwZGF0ZSB2ZXJzaW9uLlxuICAgICAgICAgKiBOb3RlOiBJZiB0aGUgbW9zdCByZWNlbnQgYXZhaWxhYmxlIHVwZGF0ZSB2ZXJzaW9uIGNhbid0IGJlIGRldGVybWluZWQsIHRoaXMgdmFsdWUgd2lsbCBiZSBcIjAuMC4wLjBcIi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmVyc2lvbiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cbiAgICAgICAgICAgIHZhciBvblZlcnNpb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZlcnNpb25OdW1iZXIgPSBuZXcgRVZXRUIyLlNlcnZpY2VWZXJzaW9uKCk7XG4gICAgICAgICAgICAgICAgYXZhaWxhYmxlVmVyc2lvbk51bWJlciA9IG5ldyBFVldFQjIuU2VydmljZVZlcnNpb24oKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVZlcnNpb25OdW1iZXIgPSBkYXRhO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhQXZhaWxhYmxlVmVyc2lvbk51bWJlcjtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgZGF0YSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVZlcnNpb25OdW1iZXIgPSBkYXRhLnZlcnNpb247XG4gICAgICAgICAgICAgICAgICAgIGRhdGFBdmFpbGFibGVWZXJzaW9uTnVtYmVyID0gZGF0YS5hdmFpbGFibGVWZXJzaW9uO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKCF2ZXJzaW9uTnVtYmVyLnBvcHVsYXRlRnJvbVN0cmluZyhkYXRhVmVyc2lvbk51bWJlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbk51bWJlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZVZlcnNpb25OdW1iZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZCBwcm9jZXNzaW5nIHRoZSB2ZXJzaW9uLicpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKGRhdGFBdmFpbGFibGVWZXJzaW9uTnVtYmVyID09PSB1bmRlZmluZWQgfHwgIWF2YWlsYWJsZVZlcnNpb25OdW1iZXIucG9wdWxhdGVGcm9tU3RyaW5nKGRhdGFBdmFpbGFibGVWZXJzaW9uTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVWZXJzaW9uTnVtYmVyID0gbmV3IEVWV0VCMi5TZXJ2aWNlVmVyc2lvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgdmVyc2lvbiBudW1iZXJcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHZlcnNpb25OdW1iZXIudG9TdHJpbmcoKSwgdmVyc2lvbk51bWJlciwgYXZhaWxhYmxlVmVyc2lvbk51bWJlcik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25WZXJzaW9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIGlmKHhoci5zdGF0dXMgPT09IDQwNCB8fCAoeGhyLnN0YXR1cyA9PT0gMCAmJiB4aHIuc3RhdHVzVGV4dCA9PT0gJ3RpbWVvdXQnKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZWIgc2VydmljZSB2MiBkb2VzIG5vdCBleHBvc2UgdmVyc2lvbi53ZWIuICBBc3N1bWUgYWxsIDQwNCB2ZXJzaW9uIGNhbGxzXG4gICAgICAgICAgICAgICAgICAgIC8vIGFyZSBhIDIuMCBzZXJ2aWNlLlxuICAgICAgICAgICAgICAgICAgICB2YXIgdmVyc2lvblJlc3BvbnNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogJzIuMC4wLjAnXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIG9uVmVyc2lvblN1Y2Nlc3ModmVyc2lvblJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIC8vSWYgdGhlIHZlcnNpb24gbnVtYmVyIGhhcyBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCByZXR1cm4gdGhlIGNhY2hlZCB2ZXJzaW9uLlxuICAgICAgICAgICAgaWYoKHZlcnNpb25OdW1iZXIgIT09IG51bGwpICYmIChhdmFpbGFibGVWZXJzaW9uTnVtYmVyICE9PSBudWxsKSkge1xuICAgICAgICAgICAgICAgIG9uVmVyc2lvblN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uTnVtYmVyLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGF2YWlsYWJsZVZlcnNpb246IGF2YWlsYWJsZVZlcnNpb25OdW1iZXIudG9TdHJpbmcoKVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uVmVyc2lvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uVmVyc2lvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmwoKSArIEVWV0VCMi51cmxzLnZlcnNpb24sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZlcnNpb25OdW1iZXJSZXF1ZXN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgb3Igbm90IHRoZSBzZXJ2aWNlIHN1cHBvcnRzIENPUlMgcmVxdWVzdHMsIHdoaWNoIHdlcmUgYWRkZWQgaW4gNy42LlxuICAgICAgICAgKiBTaW5jZSB3ZSBoYXZlIG5vIHdheSB0byBrbm93IHVudGlsIHdlIGhhdmUgdGhlIHZlcnNpb24gKHdoaWNoLCBpbiBpdHNlbGYgcmVxdWlyZXMgYSByZXF1ZXN0XG4gICAgICAgICAqIHRoYXQgbWF5IG5vdCBiZSBDT1JTKSwgd2UgbXVzdCByZXR1cm4gZmFsc2UgaW5pdGlhbGx5IGFuZCB0aGVuIHJlcXVlc3QgdGhlIHZlcnNpb24uICBBZnRlcndhcmRzLFxuICAgICAgICAgKiB3ZSBjYW4gZGVmaW5pdGl2ZWx5IHJlc3BvbmQuXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFdoZXRoZXIgQ09SUyBzdXBwb3J0IGlzIGN1cnJlbnRseSBhdmFpbGFibGUgZm9yIGNvbW11bmljYXRpb24gd2l0aCB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1cHBvcnRzQ29ycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYodmVyc2lvbk51bWJlciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhdmVyc2lvbk51bWJlci5sZXNzVGhhbihzZXJ2aWNlRmVhdHVyZVZlcnNpb25zLmNvcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIXZlcnNpb25OdW1iZXJSZXF1ZXN0ZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBSZXF1ZXN0IHRoZSB2ZXJzaW9uIHRvIHBvcHVsYXRlIGl0IGZvciBmdXR1cmUgcmVxdWVzdHMuXG4gICAgICAgICAgICAgICAgdGhpcy52ZXJzaW9uKCQubm9vcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIFVzZSBPbmx5LiBTZXRzIHRoZSByZXNvdXJjZSBrZXkgZm9yIHBhc3N0aHJvdWdoIGNvbW11bmljYXRpb24gdG8gcHJldmVudCBDU1JGIHJlcXVlc3RzLlxuICAgICAgICAgKiBAaWdub3JlXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRSZXNvdXJjZUtleSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VLZXkgPSBrZXk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIFVzZSBPbmx5LiBSZXRyaWV2ZXMgYSByZXNvdXJjZSBrZXkgZm9yIHBhc3N0aHJvdWdoIGNvbW11bmljYXRpb24gdG8gcHJldmVudCBDU1JGIHJlcXVlc3RzLiAgVXBvblxuICAgICAgICAgKiByZXRyaWV2aW5nIHRoZSBrZXksIHNldHMgdGhlIHtAbGluayBFVldFQjIuU2VydmljZS5yZXNvdXJjZUtleX0gdG8gdGhlIG5ldyB2YWx1ZS5cbiAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIGVuZHBvaW50IGhhcyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYWx3YXlzIHJldHVybiBhIGR1bW15IGtleSB2YWx1ZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIFRoZSBmdW5jdGlvbiBnZXRzXG4gICAgICAgICAqIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCB0aGUgcmVzdWx0aW5nIHJlc291cmNlXG4gICAgICAgICAqIGtleS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0UmVzb3VyY2VLZXkgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciByZXNvdXJjZSBrZXkgcmVxdWVzdCBlcnJvclxuICAgICAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgb25HZXRSZXNvdXJjZUtleUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgcmVzb3VyY2Uga2V5IHJlcXVlc3Qgc3VjY2Vzc1xuICAgICAgICAgICAgICogQGlnbm9yZVxuICAgICAgICAgICAgICogQHBhcmFtIGRhdGFcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdmFyIG9uR2V0UmVzb3VyY2VLZXlTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSAnJztcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gZGF0YS5yZXBsYWNlKC9ea2V5PS8sJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAga2V5ID0gZGF0YS5rZXk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBrZXkgPT09ICd1bmRlZmluZWQnIHx8IGtleSA9PT0gJy0xJykge1xuICAgICAgICAgICAgICAgICAgICBvbkdldFJlc291cmNlS2V5RXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXJ2aWNlLnJlc291cmNlS2V5ID0ga2V5O1xuICAgICAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBzZXJ2ZXIgbGlzdFxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2VydmljZS5yZXNvdXJjZUtleSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRSZXNvdXJjZUtleVN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0UmVzb3VyY2VLZXlFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMudXJsKCkgKyBFVldFQjIudXJscy5yZXNvdXJjZUtleVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYodGhpcy5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiAnanNvbidcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZ2V0U2VydmVycyBmdW5jdGlvbiBpcyB0aGUgaW5pdGlhbCBmdW5jdGlvbiBmb3IgaW50ZXJhY3Rpb24gd2l0aCB0aGUgZXhhY3FWaXNpb24gd2ViIHNlcnZpY2UuICBJdFxuICAgICAgICAgKiBpcyB1c2VkIHRvIHJlcXVlc3QgZm9yIHRoZSBhdmFpbGFibGUgc2VydmVycyBvbiB0aGUgYmFja2VuZCB3ZWIgc2VydmVyIGZvciB0aGUgd2ViIHNlcnZpY2UuICBUaGlzXG4gICAgICAgICAqIGxpc3QgaXMgYmFzZWQgb24gdGhlIHNlcnZlcnMgcHJvdmlkZWQgdXBvbiBpbnN0YWxsYXRpb24gb2YgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlcyBhdHRhY2hlZCB0byB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFNlcnZlcnMgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvbkdldFNlcnZlcnNFcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHhociAhPT0gJ3VuZGVmaW5lZCcgJiYgeGhyLnN0YXR1cyA9PT0gMCAmJiB4aHIuc3RhdHVzVGV4dCA9PT0gJ3RpbWVvdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yUmVzcG9uc2UuZXJyb3JUZXh0ID0gXCJYU1MgcmVxdWVzdCB0aW1lb3V0LlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkdldFNlcnZlcnNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKGRhdGEgPT09IEVWV0VCMi5lcnJvcnMuc2VydmVycykge1xuICAgICAgICAgICAgICAgICAgICAvL0NhbGwgdGhlIGVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIG9uR2V0U2VydmVyc0Vycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyB2Mi4wIHdlYiBzZXJ2aWNlcyBkb24ndCByZXR1cm4gYSBwcm9wZXIgSlNPTiBvYmplY3QsIGFzIG5vIGNhbGxiYWNrIHdyYXBzIHRoZSByZXNwb25zZS4gIEZvciB0aGVzZVxuICAgICAgICAgICAgICAgIC8vIHJlc3BvbnNlcywgYXR0ZW1wdCB0byBtYW51YWxseSBwYXJzZSB0aGUgSlNPTi5cbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNhdGNoKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25HZXRTZXJ2ZXJzRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRMaXN0ID0gZGF0YS5saXN0O1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlckxpc3QgPSAkLm1hcChyZXN1bHRMaXN0LCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJJZCA9IGVsZW1lbnQuaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHNlcnZlcklkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVySWQgPSBzZXJ2ZXJJZC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZlckluZm8gPSBFVldFQjIudXRpbC5pbnRlcm5hbC5wcm9jZXNzU2VydmVyRGV0YWlscyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpY2Vuc2VJbmZvID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwucHJvY2Vzc1NlcnZlckxpY2Vuc2UoZWxlbWVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1c3RvbUdyb3VwUGVybWlzc2lvbnM7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXNzdGhyb3VnaEdyb3VwO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50Lmdyb3VwICE9PSB1bmRlZmluZWQgJiYgZWxlbWVudC5ncm91cCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gZWxlbWVudC5ncm91cDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhc3N0aHJvdWdoUGVybWlzc2lvbnMgPSBFVldFQjIudXRpbC5pbnRlcm5hbC5wcm9jZXNzVXNlckdyb3VwUGVybWlzc2lvbnMoZ3JvdXAucGVybWlzc2lvbnMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21Hcm91cFBlcm1pc3Npb25zID0gbmV3IEVWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zKGdyb3VwLmNhbWVyYXMsIGdyb3VwLmF1ZGlvcywgZ3JvdXAuc2VyaWFscywgZ3JvdXAuc29mdFRyaWdnZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N0aHJvdWdoR3JvdXAgPSBuZXcgRVZXRUIyLlVzZXJHcm91cChncm91cC5uYW1lLCBncm91cC5yb2xlLCBwYXNzdGhyb3VnaFBlcm1pc3Npb25zLCBncm91cC5wcmlvcml0aWVzLCBncm91cC5ndWlkLCBjdXN0b21Hcm91cFBlcm1pc3Npb25zKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3Rocm91Z2hHcm91cCA9IEVWV0VCMi51dGlsLnByb2Nlc3NTZXJ2ZXJQZXJtaXNzaW9ucyhlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlcnZlcihzZXJ2aWNlLCBlbGVtZW50Lm5hbWUsIHNlcnZlcklkLCBlbGVtZW50LmxvZ2luLCBlbGVtZW50LnJlc3RyaWN0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBzZXJ2ZXJJbmZvLCBsaWNlbnNlSW5mbywgdW5kZWZpbmVkLCBwYXNzdGhyb3VnaEdyb3VwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tYW5hZ2VkRmVhdHVyZXMsIGVsZW1lbnQuY2FuQXV0b0xvZ2luKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGRhdGEuQ1NSRiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmljZS5jc3JmID0gZGF0YS5DU1JGO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNlcnZlckxpc3QpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U2VydmVyc1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0U2VydmVyc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmwoKSArIEVWV0VCMi51cmxzLmdldFNlcnZlckxpc3QsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVjdXJzaXZlbHkgcGFyc2VzIHRoZSBmb2xkZXIgb2JqZWN0IHJldHVybmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlIGludG8gYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5WaWV3Rm9sZGVyfVxuICAgICAgICAgKiBpbnN0YW5jZXMuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBmb2xkZXJPYmogVGhlIGZvbGRlciBvYmplY3QgcmV0dXJuZWQgZnJvbSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmb2xkZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBmb2xkZXIuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXJlbnRJZCBUaGUgcGFyZW50IGZvbGRlcidzIElELlxuICAgICAgICAgKiBAcmV0dXJuIHtFVldFQjIuVmlld0ZvbGRlcltdfSBUaGUgdmlldyBmb2xkZXJzXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcGFyc2VGb2xkZXJzID0gZnVuY3Rpb24gKGZvbGRlck9iaiwgZm9sZGVyTmFtZSwgcGFyZW50SWQpIHtcbiAgICAgICAgICAgIHZhciBmb2xkZXJzID0gW107XG4gICAgICAgICAgICBpZih0eXBlb2YgcGFyZW50SWQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50SWQgPSBmb2xkZXJPYmouaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb2xkZXJzLnB1c2gobmV3IEVWV0VCMi5WaWV3Rm9sZGVyKGZvbGRlck9iai5pZCwgZm9sZGVyTmFtZSwgcGFyZW50SWQpKTtcbiAgICAgICAgICAgIGlmIChmb2xkZXJPYmouZm9sZGVycyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lO1xuICAgICAgICAgICAgICAgIGZvciAobmFtZSBpbiBmb2xkZXJPYmouZm9sZGVycykge1xuICAgICAgICAgICAgICAgICAgICBpZihmb2xkZXJPYmouZm9sZGVycy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YkZvbGRlcnMgPSBwYXJzZUZvbGRlcnMoZm9sZGVyT2JqLmZvbGRlcnNbbmFtZV0sIG5hbWUsIGZvbGRlck9iai5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb2xkZXJzID0gZm9sZGVycy5jb25jYXQoc3ViRm9sZGVycyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZm9sZGVycztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2VzIGEgdmlldyBsYXlvdXQgaW5mbyByZXNwb25zZSBpbnRvIGEge0BsaW5rIEVWV0VCMi5MYXlvdXR9IGluc3RhbmNlLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gbGF5b3V0SW5mb1Jlc3BvbnNlIFRoZSByZXNwb25zZSBvYmplY3QgdG8gcHJvY2Vzcy5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLkxheW91dH0gVGhlIGxheW91dFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHByb2Nlc3NWaWV3TGF5b3V0UmVzcG9uc2UgPSBmdW5jdGlvbihsYXlvdXRJbmZvUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciBsYXlvdXQ7XG4gICAgICAgICAgICBpZih0eXBlb2YgbGF5b3V0SW5mb1Jlc3BvbnNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZhciBzbG90cyA9ICQubWFwKGxheW91dEluZm9SZXNwb25zZS5zbG90cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5MYXlvdXRTbG90KGVsZW1lbnQueSwgZWxlbWVudC54LCBlbGVtZW50LndpZHRoLCBlbGVtZW50LmhlaWdodCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbGF5b3V0ID0gbmV3IEVWV0VCMi5MYXlvdXQobGF5b3V0SW5mb1Jlc3BvbnNlLm5hbWUsIGxheW91dEluZm9SZXNwb25zZS53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0SW5mb1Jlc3BvbnNlLmhlaWdodCwgbGF5b3V0SW5mb1Jlc3BvbnNlLmxlbmd0aCwgc2xvdHMsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0SW5mb1Jlc3BvbnNlLndpZGVzY3JlZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGxheW91dDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGVzIGEgZ3JlcCBmdW5jdGlvbiBmb3IgZmluZGluZyBhIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggYSB2aWV3IHJlc3BvbnNlLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VydmVySWQgVGhlIHNlcnZlciBJRCBhc3NvY2lhdGVkLlxuICAgICAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gVGhlIGdyZXAgZnVuY3Rpb25cbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZW5lcmF0ZVNlcnZlckdyZXAgPSBmdW5jdGlvbihzZXJ2ZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHZpZXdSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3UmVzcG9uc2UuaWQgPT09IHNlcnZlcklkO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2VzIGEgdmlldyBhdWRpbyBpbnB1dCByZXNwb25zZSBpbnRvIGEge0BsaW5rIEVWV0VCMi5WaWV3QXVkaW9JbnB1dEluZm99IGluc3RhbmNlLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmlld1Jlc3BvbnNlIFRoZSByZXNwb25zZSBvYmplY3QgdG8gcHJvY2Vzcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgVGhlIHNlcnZlcnMgYXNzb2NpYXRlZCB3aXRoIHRoZSB2aWV3cy5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLlZpZXdBdWRpb0lucHV0SW5mb30gVGhlIGF1ZGlvIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcHJvY2Vzc1ZpZXdBdWRpb0lucHV0UmVzcG9uc2UgPSBmdW5jdGlvbih2aWV3UmVzcG9uc2UsIHNlcnZlcnMpIHtcbiAgICAgICAgICAgIHZhciBhdWRpb0lucHV0O1xuICAgICAgICAgICAgaWYodHlwZW9mIHZpZXdSZXNwb25zZS5hdWRpb0lucHV0ICE9PSAndW5kZWZpbmVkJyAmJiB2aWV3UmVzcG9uc2UuYXVkaW9JbnB1dCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBhdWRpb0lucHV0U2VydmVyID0gJC5ncmVwKHNlcnZlcnMsIGZ1bmN0aW9uKHNlcnZlcikge1xuICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGlzIGNoZWNrIGZvciBzZXNzaW9uIElEIGlzIGR1ZSB0byBhbiBpbXBsZW1lbnRhdGlvbiBpc3N1ZVxuICAgICAgICAgICAgICAgICAgICAvLyBpbiBsZWdhY3kgc2VydmljZXMgKHByZS04LjIpIHdoZXJlIHRoZSBzZXJ2ZXIgcHJvcGVydHkgb2YgdGhlIGRlcHJlY2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gYXVkaW9JbnB1dCBmbGFnIHdhcyBpbmNvcnJlY3RseSBzZXQgdG8gdGhlIHNlc3Npb24gSUQuICBBZGRpdGlvbmFsbHksIHRoZVxuICAgICAgICAgICAgICAgICAgICAvLyBzZXNzaW9uIElEIHdhcyBub3Qgc2V0IHRvIHRoZSBwcm9wZXIgaGV4IHJlcHJlc2VudGF0aW9uLlxuICAgICAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbklkID0gdmlld1Jlc3BvbnNlLmF1ZGlvSW5wdXQuc2VydmVyO1xuICAgICAgICAgICAgICAgICAgICBpZihzZXNzaW9uSWQuc3Vic3RyKDAsMikgIT09ICcweCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25JZCA9ICcweCcgKyBwYXJzZUludChzZXNzaW9uSWQsIDEwKS50b1N0cmluZygxNik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlld1Jlc3BvbnNlLmF1ZGlvSW5wdXQuc2VydmVyID09PSBzZXJ2ZXIuaWQgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25JZCA9PT0gc2VydmVyLnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBhdWRpb0lucHV0ID0gbmV3IEVWV0VCMi5WaWV3QXVkaW9JbnB1dEluZm8odmlld1Jlc3BvbnNlLmF1ZGlvSW5wdXQuaWQsIGF1ZGlvSW5wdXRTZXJ2ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGF1ZGlvSW5wdXQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnNlcyBhIHZpZXcgcmVzcG9uc2UgaW50byBhIHtAbGluayBFVldFQjIuVmlld30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB2aWV3UmVzcG9uc2UgVGhlIHJlc3BvbnNlIG9iamVjdCB0byBwcm9jZXNzLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJbXX0gc2VydmVycyBUaGUgc2VydmVycyBhc3NvY2lhdGVkIHdpdGggdGhlIHZpZXdzLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWV3Rm9sZGVyW119IGZvbGRlcnMgVGhlIGZvbGRlcnMgYXNzb2NpYXRlZCB3aXRoIHRoZSB2aWV3cy5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLlZpZXd9IFRoZSB2aWV3XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcHJvY2Vzc1ZpZXdSZXNwb25zZSA9IGZ1bmN0aW9uKHZpZXdSZXNwb25zZSwgc2VydmVycywgZm9sZGVycykge1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgVmlldyBvYmplY3RzXG4gICAgICAgICAgICB2YXIgbGF5b3V0ID0gcHJvY2Vzc1ZpZXdMYXlvdXRSZXNwb25zZSh2aWV3UmVzcG9uc2UubGF5b3V0X2luZm8pO1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGxpc3Qgb2YgVmlld1Nsb3RJdGVtIG9iamVjdHNcbiAgICAgICAgICAgIHZhciB2aWV3SXRlbUxpc3QgPSAkLm1hcCh2aWV3UmVzcG9uc2UuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQvKiwgaW5kZXgqLykge1xuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSAkLmdyZXAoc2VydmVycywgZ2VuZXJhdGVTZXJ2ZXJHcmVwKGVsZW1lbnQuc2VydmVyKSlbMF07XG5cbiAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYoZWxlbWVudC50eXBlID09PSBFVldFQjIuVmlld1Nsb3RJdGVtVHlwZXMuY2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBFVldFQjIuQ2FtZXJhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKGVsZW1lbnQudHlwZSA9PT0gRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzLmdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBFVldFQjIuTWFwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKGVsZW1lbnQudHlwZSA9PT0gRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzLmF1ZGlvKSB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSBFVldFQjIuQXVkaW9EZXZpY2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVmlld1Nsb3RJdGVtKGVsZW1lbnQuaWQsIHNlcnZlciwgdHlwZSwgZWxlbWVudC5zbG90LCBlbGVtZW50LmRpZ2l0YWxQdHpUeXBlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBGaW5kIHRoZSB2aWV3IGZvbGRlciBmb3IgdGhlIHZpZXdcbiAgICAgICAgICAgIHZhciB2aWV3Rm9sZGVyID0gJC5ncmVwKGZvbGRlcnMsIGZ1bmN0aW9uKHZmKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZmLmlkID09PSB2aWV3UmVzcG9uc2UuZm9sZGVyO1xuICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgIHZhciBhdWRpb0lucHV0ID0gcHJvY2Vzc1ZpZXdBdWRpb0lucHV0UmVzcG9uc2Uodmlld1Jlc3BvbnNlLCBzZXJ2ZXJzKTtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVmlldyh2aWV3UmVzcG9uc2UubmFtZSwgdmlld0ZvbGRlciwgdmlld0l0ZW1MaXN0LCB2aWV3UmVzcG9uc2UubGF5b3V0LCBsYXlvdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3UmVzcG9uc2Uub3JkZXIsIGF1ZGlvSW5wdXQsIHZpZXdSZXNwb25zZS5kZXNjcmlwdGlvbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnNlcyBhIGxlZ2FjeSB2aWV3IHJlc3BvbnNlIGludG8gYSB7QGxpbmsgRVZXRUIyLlZpZXd9IGluc3RhbmNlLiAgTGVnYWN5IHJlc3BvbnNlcyBhcmUgdGhvc2UgdGhhdCBvbmx5XG4gICAgICAgICAqIGV4cG9zZSB0aGUgZGVwcmVjYXRlZCBcImNhbWVyYVwiIHByb3BlcnR5LCBub3QgdGhlIGN1cnJlbnQgXCJpdGVtc1wiIHByb3BlcnR5LlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmlld1Jlc3BvbnNlIFRoZSByZXNwb25zZSBvYmplY3QgdG8gcHJvY2Vzcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgVGhlIHNlcnZlcnMgYXNzb2NpYXRlZCB3aXRoIHRoZSB2aWV3cy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuVmlld0ZvbGRlcltdfSBmb2xkZXJzIFRoZSBmb2xkZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGUgdmlld3MuXG4gICAgICAgICAqIEByZXR1cm4ge0VWV0VCMi5WaWV3fSBUaGUgdmlld1xuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHByb2Nlc3NMZWdhY3lWaWV3UmVzcG9uc2UgPSBmdW5jdGlvbih2aWV3UmVzcG9uc2UsIHNlcnZlcnMsIGZvbGRlcnMpIHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIFZpZXcgb2JqZWN0c1xuICAgICAgICAgICAgdmFyIGxheW91dCA9IHByb2Nlc3NWaWV3TGF5b3V0UmVzcG9uc2Uodmlld1Jlc3BvbnNlLmxheW91dF9pbmZvKTtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBsaXN0IG9mIFZpZXdDYW1lcmFJbmZvIG9iamVjdHNcbiAgICAgICAgICAgIHZhciB2aWV3Q2FtZXJhSW5mb0xpc3QgPSBbXTtcbiAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgZm9yKGk9MDsgaTx2aWV3UmVzcG9uc2UuY2FtZXJhcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciB2aWV3Q2FtZXJhSW5mbyA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlckRhdGEgPSB2aWV3UmVzcG9uc2UuY2FtZXJhc1tpXTtcbiAgICAgICAgICAgICAgICBpZihzZXJ2ZXJEYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSAkLmdyZXAoc2VydmVycywgZ2VuZXJhdGVTZXJ2ZXJHcmVwKHNlcnZlckRhdGEuc2VydmVyKSlbMF07XG4gICAgICAgICAgICAgICAgICAgIHZpZXdDYW1lcmFJbmZvID0gbmV3IEVWV0VCMi5WaWV3Q2FtZXJhSW5mbyhzZXJ2ZXJEYXRhLmNhbWVyYSwgc2VydmVyLCBzZXJ2ZXJEYXRhLmRpZ2l0YWxQdHpUeXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmlld0NhbWVyYUluZm9MaXN0LnB1c2godmlld0NhbWVyYUluZm8pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGaW5kIHRoZSB2aWV3IGZvbGRlciBmb3IgdGhlIHZpZXdcbiAgICAgICAgICAgIHZhciB2aWV3Rm9sZGVyID0gJC5ncmVwKGZvbGRlcnMsIGZ1bmN0aW9uKHZmKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZmLmlkID09PSB2aWV3UmVzcG9uc2UuZm9sZGVyO1xuICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgIHZhciBhdWRpb0lucHV0ID0gcHJvY2Vzc1ZpZXdBdWRpb0lucHV0UmVzcG9uc2Uodmlld1Jlc3BvbnNlLCBzZXJ2ZXJzKTtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVmlldyh2aWV3UmVzcG9uc2UubmFtZSwgdmlld0ZvbGRlciwgdmlld0NhbWVyYUluZm9MaXN0LCB2aWV3UmVzcG9uc2UubGF5b3V0LCBsYXlvdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3UmVzcG9uc2Uub3JkZXIsIGF1ZGlvSW5wdXQsIHZpZXdSZXNwb25zZS5kZXNjcmlwdGlvbik7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqICBUaGUgZ2V0Vmlld3MgZnVuY3Rpb24gcmV0cmlldmVzIHRoZSBzZXJ2ZXIgc2lkZSB2aWV3cyBmcm9tIHRoZSBleGFjcVZpc2lvbiBzZXJ2ZXJzLlxuICAgICAgICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UsIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuVmlld31cbiAgICAgICAgICogICBpbnN0YW5jZXMsIGFuZCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlZpZXdGb2xkZXJ9IGluc3RhbmNlcy5cbiAgICAgICAgICogIEBwYXJhbSB7RVZXRUIyLlNlcnZlcnxFVldFQjIuU2VydmVyW119IHNlcnZlcnMgQSBzaW5nbGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIG9yIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlcnZlcn0gaW5zdGFuY2VzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFZpZXdzID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNlcnZlcnMpIHtcbiAgICAgICAgICAgIGlmKCEkLmlzQXJyYXkoc2VydmVycykpIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJzID0gW3NlcnZlcnNdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXRWaWV3c0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0Vmlld3NTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciBmb2xkZXJzID0gcGFyc2VGb2xkZXJzKGRhdGEuRm9sZGVycywgXCJcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBWaWV3IG9iamVjdHNcbiAgICAgICAgICAgICAgICB2YXIgdmlld3NMaXN0ID0gJC5tYXAoZGF0YS5WaWV3cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgZWxlbWVudC5pdGVtcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzVmlld1Jlc3BvbnNlKGVsZW1lbnQsIHNlcnZlcnMsIGZvbGRlcnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NMZWdhY3lWaWV3UmVzcG9uc2UoZWxlbWVudCwgc2VydmVycywgZm9sZGVycyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBzZXJ2ZXIgbGlzdFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdmlld3NMaXN0LCBmb2xkZXJzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2VydmVyc1JlcXVpcmluZ0tleSA9ICQuZ3JlcChzZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuaXNQYXNzdGhyb3VnaFNlcnZlcigpICYmIGVsZW1lbnQuc2VydmljZS5pc1hzcygpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFZpZXdzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRWaWV3c0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc2VydmVyc1swXS5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZ2V0Vmlld0xpc3QsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2VydmVyc1JlcXVpcmluZ0tleS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5yZXNvdXJjZUtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ1NSRiBlbmZvcmNlZCwgcGFzc3Rocm91Z2ggd2lsbCBub3Qgd29yay5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldHRpbmdzLmRhdGEua2V5ID0gdGhpcy5yZXNvdXJjZUtleTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYXJzZXMgYSBtYXAgcmVzcG9uc2UgaW50byBhIHtAbGluayBFVldFQjIuTWFwfSBpbnN0YW5jZS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG1hcFJlc3BvbnNlIFRoZSByZXNwb25zZSBvYmplY3QgdG8gcHJvY2Vzcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgVGhlIHNlcnZlcnMgYXNzb2NpYXRlZCB3aXRoIHRoZSB2aWV3cy5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLk1hcH0gVGhlIG1hcFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHByb2Nlc3NNYXBSZXNwb25zZSA9IGZ1bmN0aW9uKG1hcFJlc3BvbnNlLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgaXRlbUxpc3QgPSAkLm1hcChtYXBSZXNwb25zZS5pdGVtcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHZhciBjYXB0aW9uSW5mbyA9IG5ldyBFVldFQjIuTWFwSXRlbUNhcHRpb25JbmZvKGVsZW1lbnQuY2FwdGlvbiwgZWxlbWVudC5jb2xvcik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5NYXBJdGVtSW5mbyhlbGVtZW50LmlkLCBlbGVtZW50LnNlcnZlciwgZWxlbWVudC50eXBlLCBlbGVtZW50LnNoYXBlLCBlbGVtZW50LngsXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQueSwgY2FwdGlvbkluZm8sIGVsZW1lbnQucm90YXRpb24sIGVsZW1lbnQuZmxhZ3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gJC5ncmVwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQudG9TdHJpbmcoKSA9PT0gbWFwUmVzcG9uc2Uucm9vdFNlcnZlci50b1N0cmluZygpO1xuICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLk1hcChzZXJ2ZXIuc2VydmljZSwgbWFwUmVzcG9uc2UuaWQsIHNlcnZlciwgbWFwUmVzcG9uc2UucGFyZW50LCBtYXBSZXNwb25zZS5uYW1lLFxuICAgICAgICAgICAgICAgIG1hcFJlc3BvbnNlLmRlc2NyaXB0aW9uLCBpdGVtTGlzdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqICBUaGUgZ2V0TWFwcyBmdW5jdGlvbiByZXRyaWV2ZXMgYW5kIGNvbWJpbmVzIHRoZSBzZXJ2ZXIgc2lkZSBtYXBzIGZyb20gdGhlIGV4YWNxVmlzaW9uIHNlcnZlcnMuXG4gICAgICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLk1hcH1cbiAgICAgICAgICogIGluc3RhbmNlcy5cbiAgICAgICAgICogIEBwYXJhbSB7RVZXRUIyLlNlcnZlcnxFVldFQjIuU2VydmVyW119IHNlcnZlcnMgQSBzaW5nbGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIG9yIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlcnZlcn0gaW5zdGFuY2VzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldE1hcHMgPSBmdW5jdGlvbihjYWxsYmFjaywgc2VydmVycykge1xuICAgICAgICAgICAgaWYoISQuaXNBcnJheShzZXJ2ZXJzKSkge1xuICAgICAgICAgICAgICAgIHNlcnZlcnMgPSBbc2VydmVyc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgb25HZXRNYXBzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRNYXBzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBNYXBzIG9iamVjdHNcbiAgICAgICAgICAgICAgICB2YXIgbWFwc0xpc3QgPSAkLm1hcChkYXRhLm1hcHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIGVsZW1lbnQuaXRlbXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc01hcFJlc3BvbnNlKGVsZW1lbnQsIHNlcnZlcnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgbWFwcyBsaXN0XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBtYXBzTGlzdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChzZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0TWFwc1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0TWFwc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmwoKSArIEVWV0VCMi51cmxzLm1hcCxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnNlcyBhIGdyb3VwIHJlc3BvbnNlIGludG8gYSB7QGxpbmsgRVZXRUIyLkdyb3VwfSBpbnN0YW5jZS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGdyb3VwUmVzcG9uc2UgVGhlIHJlc3BvbnNlIG9iamVjdCB0byBwcm9jZXNzLlxuICAgICAgICAgKiBAcmV0dXJuIHtFVldFQjIuR3JvdXB9IFRoZSBncm91cFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHByb2Nlc3NHcm91cFJlc3BvbnNlID0gZnVuY3Rpb24oZ3JvdXBSZXNwb25zZS8qLCBzZXJ2ZXJzKi8pIHtcbiAgICAgICAgICAgIHZhciBpdGVtTGlzdCA9ICQubWFwKGdyb3VwUmVzcG9uc2UuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Hcm91cEl0ZW1JbmZvKGVsZW1lbnQuaWQsIGVsZW1lbnQuc2VydmVyLCBlbGVtZW50LnR5cGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Hcm91cChncm91cFJlc3BvbnNlLmlkLCBncm91cFJlc3BvbnNlLm5hbWUsXG4gICAgICAgICAgICAgICAgZ3JvdXBSZXNwb25zZS5kZXNjcmlwdGlvbiwgZ3JvdXBSZXNwb25zZS5pY29uLCBpdGVtTGlzdCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICogUmV0cmlldmVzIGFuZCBjb21iaW5lcyB0aGUgc2VydmVyIHNpZGUgZ3JvdXBzIGZyb20gdGhlIHNwZWNpZmllZCBzZXJ2ZXJzLlxuICAgICAgICAqXG4gICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbFxuICAgICAgICAqIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aFxuICAgICAgICAqIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5Hcm91cH0gaW5zdGFuY2VzLlxuICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcnxFVldFQjIuU2VydmVyW119IHNlcnZlcnMgQSBzaW5nbGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICogaW5zdGFuY2Ugb3IgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlcy5cbiAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRHcm91cHMgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHNlcnZlcnMpIHtcbiAgICAgICAgICAgIGlmKCEkLmlzQXJyYXkoc2VydmVycykpIHtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJzID0gW3NlcnZlcnNdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG9uR2V0R3JvdXBzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRHcm91cHNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIEdyb3VwcyBvYmplY3RzXG4gICAgICAgICAgICAgICAgdmFyIGdyb3Vwc0xpc3QgPSAkLm1hcChkYXRhLmdyb3VwcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgZWxlbWVudC5pdGVtcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzR3JvdXBSZXNwb25zZShlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIGdyb3VwcyBsaXN0XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBncm91cHNMaXN0KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG91dHB1dDogJ2pzb24nXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRHcm91cHNTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldEdyb3Vwc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmwoKSArIEVWV0VCMi51cmxzLmdyb3VwcyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlY3Vyc2l2ZWx5IHBhcnNlcyB0aGUgZm9sZGVyIG9iamVjdCByZXR1cm5lZCBmcm9tIHRoZSB3ZWIgc2VydmljZSBpbnRvIGFuIGFycmF5IG9mXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVG91ckZvbGRlcn0gaW5zdGFuY2VzLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZm9sZGVyT2JqIFRoZSBmb2xkZXIgb2JqZWN0IHJldHVybmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZm9sZGVyTmFtZSBUaGUgbmFtZSBvZiB0aGUgZm9sZGVyLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFyZW50SWQgVGhlIHBhcmVudCBmb2xkZXIncyBJRC5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLlRvdXJGb2xkZXJbXX0gVGhlIHRvdXIgZm9sZGVyc1xuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHBhcnNlVG91ckZvbGRlcnMgPSBmdW5jdGlvbiAoZm9sZGVyT2JqLCBmb2xkZXJOYW1lLCBwYXJlbnRJZCkge1xuICAgICAgICAgICAgdmFyIGZvbGRlcnMgPSBbXTtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBwYXJlbnRJZCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnRJZCA9IGZvbGRlck9iai5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvbGRlcnMucHVzaChuZXcgRVZXRUIyLlRvdXJGb2xkZXIoZm9sZGVyT2JqLmlkLCBmb2xkZXJOYW1lLCBwYXJlbnRJZCkpO1xuICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICBmb3IoaT0wOyBpPGZvbGRlck9iai5mb2xkZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1YkZvbGRlcnMgPSBwYXJzZVRvdXJGb2xkZXJzKGZvbGRlck9iai5mb2xkZXJzW2ldLCBmb2xkZXJPYmouZm9sZGVyc1tpXS5uYW1lLCBmb2xkZXJPYmouaWQpO1xuICAgICAgICAgICAgICAgIGZvbGRlcnMgPSBmb2xkZXJzLmNvbmNhdChzdWJGb2xkZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmb2xkZXJzO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiAgVGhlIGdldFRvdXJzIGZ1bmN0aW9uIHJldHJpZXZlcyB0aGUgc2VydmVyIHNpZGUgdG91cnMgZnJvbSB0aGUgZXhhY3FWaXNpb24gc2VydmVycy5cbiAgICAgICAgICogIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAgIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlRvdXJ9XG4gICAgICAgICAqICAgaW5zdGFuY2VzLCBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5Ub3VyRm9sZGVyfSBpbnN0YW5jZXMuXG4gICAgICAgICAqICBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ8RVZXRUIyLlNlcnZlcltdfSBzZXJ2ZXJzIEEgc2luZ2xlIHtAbGluayBFVldFQjIuU2VydmVyfSBpbnN0YW5jZSBvciBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VG91cnMgPSBmdW5jdGlvbihjYWxsYmFjaywgc2VydmVycykge1xuICAgICAgICAgICAgaWYoISQuaXNBcnJheShzZXJ2ZXJzKSkge1xuICAgICAgICAgICAgICAgIHNlcnZlcnMgPSBbc2VydmVyc107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkdldFRvdXJzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRUb3Vyc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZvbGRlcnMgPSBwYXJzZVRvdXJGb2xkZXJzKGRhdGEuZm9sZGVycywgXCJcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSB0b3VyIG9iamVjdHNcbiAgICAgICAgICAgICAgICB2YXIgdG91cnMgPSAkLm1hcChkYXRhLnRvdXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBsaXN0IG9mIFRvdXJJdGVtIG9iamVjdHNcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdXJJdGVtcyA9ICQubWFwKGVsZW1lbnQudmlld3MsIGZ1bmN0aW9uKGVsLyosIGluZGV4Ki8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlRvdXJJdGVtKGVsLmluZGV4LCBlbC5kd2VsbCwgZWwudmlldyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEZpbmQgdGhlIGZvbGRlciBmb3IgdGhlIHRvdXJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvbGRlciA9ICQuZ3JlcChmb2xkZXJzLCBmdW5jdGlvbih2Zikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZmLmlkID09PSBlbGVtZW50LmZvbGRlcl9pZDtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVG91cihlbGVtZW50Lm5hbWUsIGZvbGRlciwgdG91ckl0ZW1zLCBlbGVtZW50LmRlc2NyaXB0aW9uLCBpbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHRvdXJzLCBmb2xkZXJzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRUb3Vyc1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0VG91cnNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlcnNbMF0uc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnRvdXJzLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSB0eXBlcyBvZiBhdWRpbyBmb3JtYXRzIHN1cHBvcnRlZCBmb3IgdGhlIHNlcnZpY2VcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLmF1ZGlvSW5wdXRTdHJlYW1Gb3JtYXRUeXBlc30uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGlvSW5wdXRGb3JtYXRUeXBlcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYoYXZhaWxhYmxlQXVkaW9JbnB1dEZvcm1hdHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGF2YWlsYWJsZUF1ZGlvSW5wdXRGb3JtYXRzKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkF1ZGlvSW5wdXRGb3JtYXRUeXBlc0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uQXVkaW9JbnB1dEZvcm1hdFR5cGVzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhdmFpbGFibGVBdWRpb0lucHV0Rm9ybWF0cyA9IGRhdGEuZm9ybWF0cztcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGF2YWlsYWJsZUF1ZGlvSW5wdXRGb3JtYXRzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkF1ZGlvSW5wdXRGb3JtYXRUeXBlc1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uQXVkaW9JbnB1dEZvcm1hdFR5cGVzRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnVybCgpICsgRVZXRUIyLnVybHMuYXVkaW9cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSB0eXBlcyBvZiB2aWRlbyBleHBvcnQgZm9ybWF0cyBhdmFpbGFibGUgZm9yIHRoZSBzZXJ2aWNlXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGxcbiAgICAgICAgICogY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmRcbiAgICAgICAgICogYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi52aWRlb0V4cG9ydEZvcm1hdFR5cGVzfSBkZXRhaWxpbmcgdGhlIGF2YWlsYWJsZVxuICAgICAgICAgKiB2aWRlbyBleHBvcnQgZm9ybWF0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmlkZW9FeHBvcnRGb3JtYXRUeXBlcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uVmlkZW9FeHBvcnRGb3JtYXRUeXBlc0Vycm9ycyA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblZpZGVvRXhwb3J0Rm9ybWF0VHlwZXNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5mb3JtYXRUeXBlcyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25WaWRlb0V4cG9ydEZvcm1hdFR5cGVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25WaWRlb0V4cG9ydEZvcm1hdFR5cGVzRXJyb3JzLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy51cmwoKSArIEVWV0VCMi51cmxzLnZpZGVvZXhwb3J0LFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiAnanNvbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgb3ZlcmFsbCBzdGF0dXMgZm9yIHRoZSBwcm92aWRlZCBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuU2VydmVyU3RhdHVzfSBpbnN0YW5jZXMsXG4gICAgICAgICAqICB3aGljaCBkZXRhaWwgdGhlIG92ZXJhbGwgc3RhdHVzIG9mIGVhY2ggc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJbXX0gc2VydmVycyBUaGUgdGFyZ2V0IHNlcnZlcnNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U2VydmVyc1N0YXR1cyA9IGZ1bmN0aW9uIChjYWxsYmFjaywgc2VydmVycykge1xuICAgICAgICAgICAgdmFyIG9uR2V0U2VydmVyU3RhdHVzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRTZXJ2ZXJTdGF0dXNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzdGF0dXNlcyA9ICQubWFwKGRhdGEuc3RhdHVzZXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcnZlciA9ICQuZ3JlcChzZXJ2ZXJzLCBmdW5jdGlvbihzZXJ2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2Vydi5zZXNzaW9uSWQudG9TdHJpbmcoKSA9PT0gZWxlbWVudC5zZXNzaW9uSWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlcnZlclN0YXR1cyhzZXJ2ZXIsIGVsZW1lbnQubG9zcywgZWxlbWVudC5tb3Rpb24sIGVsZW1lbnQuYWxhcm0sIGVsZW1lbnQuc2VydmVyU3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc3RhdHVzZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChzZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U2VydmVyU3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRTZXJ2ZXJTdGF0dXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMudXJsKCkgKyBFVldFQjIudXJscy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSBoZWFsdGggb2YgdGhlIHdlYiBzZXJ2aWNlIGluY2x1ZGluZyB1cHRpbWUgYW5kIGJhc2ljIGluZm9ybWF0aW9uIGFib3V0IGN1cnJlbnQgc2VydmVyIGNvbm5lY3Rpb25zXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWRcbiAgICAgICAgICogYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYSB7QGxpbmsgRVZXRUIyLlNlcnZpY2VIZWFsdGh9XG4gICAgICAgICAqIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRIZWFsdGggPSBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhIC8qLCB0ZXh0U3RhdHVzLCB4aHIqLyl7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVycyA9IFtdO1xuICAgICAgICAgICAgICAgIC8vIHJlc3BvbnNlIHNpZ25hdHVyZSBpbmNsdWRpbmcgc2VydmVycyB3YXMgZGVwcmVjYXRlZCwgc2hvdWxkIGFsd2F5cyBiZSBlbXB0eSA5LjIuMCtcbiAgICAgICAgICAgICAgICBzZXJ2ZXJzID0gJC5tYXAoZGF0YS5zZXJ2ZXJzLCBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VydmVyID0gIG5ldyBFVldFQjIuU2VydmVySGVhbHRoKGVsZW0uc2VydmVySUQsIGVsZW0uc2VydmVyQWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0ubGl2ZUNvbm5lY3Rpb25zLCBlbGVtLnNlYXJjaENvbm5lY3Rpb25zLCBlbGVtLnBhc3N0aHJvdWdoRXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnVzZXJzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBTdHJlYW0gaW5mbyB3YXMgYWRkZWQgaW4gNy43LjU3MDBcbiAgICAgICAgICAgICAgICAgICAgaWYoZWxlbS5zdHJlYW1zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlci5zdHJlYW1zID0gbmV3IEVWV0VCMi5TZXJ2ZXJIZWFsdGhTdHJlYW1JbmZvKHNlcnZlci5zZXJ2ZXJJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtLnN0cmVhbXMuY29tcHJlc3NlZCwgZWxlbS5zdHJlYW1zLnVuY29tcHJlc3NlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlcnZlcjtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdHJlYW1JbmZvO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0cmVhbXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzdHJlYW1JbmZvID0gbmV3IEVWV0VCMi5TZXJ2aWNlSGVhbHRoU3RyZWFtSW5mbyhkYXRhLnN0cmVhbXMuY29tcHJlc3NlZCwgZGF0YS5zdHJlYW1zLnVuY29tcHJlc3NlZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVmVyc2lvbiBhbmQgT1MgaW5mbyB3ZXJlIGFkZGVkIGluIDcuMS44LCBzbyBjaGVjayB0byBlbnN1cmUgdGhleSBhcmUgcHJlc2VudCB3aGVuXG4gICAgICAgICAgICAgICAgLy8gcHJvY2Vzc2luZyB0aGUgcmVxdWVzdC5cbiAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbkluZm87XG4gICAgICAgICAgICAgICAgaWYoZGF0YS52ZXJzaW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbkluZm8gPSBuZXcgRVZXRUIyLlNlcnZpY2VIZWFsdGhWZXJzaW9uSW5mbyhkYXRhLnZlcnNpb24uc2VydmljZSwgZGF0YS52ZXJzaW9uLmV2YXBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS52ZXJzaW9uLndlYlNlcnZlcik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIG9zSW5mbztcbiAgICAgICAgICAgICAgICBpZihkYXRhLm9zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgb3NJbmZvID0gbmV3IEVWV0VCMi5TZXJ2aWNlSGVhbHRoT3NJbmZvKGRhdGEub3Muc3lzdGVtLCBkYXRhLm9zLnJlbGVhc2UsIGRhdGEub3MudmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEub3MubWFjaGluZSwgZGF0YS5vcy5wcm9jZXNzb3IsIGRhdGEub3Mubm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhbmQgU3lzdGVtIGluZm8gd2VyZSBhZGRlZCBpbiA3LjcuNTcwMCwgc28gY2hlY2sgdG8gZW5zdXJlIHRoZXkgYXJlIHByZXNlbnQgd2hlblxuICAgICAgICAgICAgICAgIC8vIHByb2Nlc3NpbmcgdGhlIHJlcXVlc3RcbiAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc0luZm87XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5wcm9jZXNzZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSW5mbyA9ICQubWFwKGRhdGEucHJvY2Vzc2VzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJ2aWNlSGVhbHRoUHJvY2Vzc0luZm8oZWxlbWVudC5uYW1lLCBlbGVtZW50LmNwdSwgZWxlbWVudC5yYW0sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VydmVySWQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3lzdGVtSW5mbztcbiAgICAgICAgICAgICAgICBpZihkYXRhLnN5c3RlbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHN5c3RlbUluZm8gPSBuZXcgRVZXRUIyLlNlcnZpY2VIZWFsdGhTeXN0ZW1JbmZvKGRhdGEuc3lzdGVtLmNvcmVzLCBkYXRhLnN5c3RlbS5tZW1vcnkudG90YWwsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnN5c3RlbS5tZW1vcnkuYXZhaWxhYmxlLCBkYXRhLnN5c3RlbS5jcHUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdGhlIGZ1bGwgaGVhbHRoIG9iamVjdFxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlSGVhbHRoID0gbmV3IEVWV0VCMi5TZXJ2aWNlSGVhbHRoKGRhdGEudXB0aW1lLCBzZXJ2ZXJzLCB2ZXJzaW9uSW5mbywgb3NJbmZvLFxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzSW5mbywgc3lzdGVtSW5mbywgc3RyZWFtSW5mbyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXJ2aWNlSGVhbHRoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnVybCgpICsgRVZXRUIyLnVybHMuaGVhbHRoLFxuICAgICAgICAgICAgICAgIGRhdGE6IHt9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSB0aW1lc3RhbXAgb2YgdGhlIGxhc3QgY29uZmlnIHVwZGF0ZSBvbiBlYWNoIGNvbm5lY3RlZCBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5Db25maWdVcGRhdGVTdGF0dXN9IGluc3RhbmNlcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfEVWV0VCMi5TZXJ2ZXJbXX0gc2VydmVycyBBIHNpbmdsZSB7QGxpbmsgRVZXRUIyLlNlcnZlcn0gaW5zdGFuY2Ugb3IgYW4gYXJyYXkgb2ZcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlc1xuICAgICAgICAgKi9cblxuICAgICAgICB0aGlzLmdldENvbmZpZ1VwZGF0ZVN0YXR1cyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldENvbmZpZ1VwZGF0ZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkdldENvbmZpZ1VwZGF0ZVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIGNvbmZpZ1N0YXR1c2VzID0gJC5tYXAoZGF0YS5zdGF0dXNlcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFVwZGF0ZWQgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUoZWxlbWVudC5jb25maWcubGFzdFVwZGF0ZWQpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkNvbmZpZ1VwZGF0ZVN0YXR1cyhlbGVtZW50LnNlc3Npb25JZCwgbGFzdFVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgY29uZmlnU3RhdHVzZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGlkcyA9ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbS5zZXNzaW9uSWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAncyc6IGlkc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0Q29uZmlnVXBkYXRlU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRDb25maWdVcGRhdGVFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMudXJsKCkgKyBFVldFQjIudXJscy5jb25maWdVcGRhdGVTdGF0dXMsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBldmVudCBtb25pdG9yaW5nIHByb2ZpbGVzIGZvciB0aGUgcHJvdmlkZWQgc2VydmVycy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmVyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JQcm9maWxlfSBpbnN0YW5jZXMuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcltdfSBzZXJ2ZXJzIFRoZSBzZXJ2ZXJzIHRvIHRvIHJldHJpZXZlIGFzc29jaWF0ZWQgZXZlbnQgbW9uaXRvcmluZyBwcm9maWxlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RXZlbnRNb25pdG9yUHJvZmlsZXMgPSBmdW5jdGlvbihjYWxsYmFjaywgc2VydmVycykge1xuICAgICAgICAgICAgaWYoISQuaXNBcnJheShzZXJ2ZXJzKSkge1xuICAgICAgICAgICAgICAgIHNlcnZlcnMgPSBbc2VydmVyc107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBldmVudCBtb25pdG9yaW5nIHByb2ZpbGVzXG4gICAgICAgICAgICAgICAgdmFyIHByb2ZpbGVzID0gJC5tYXAoZGF0YS5wcm9maWxlcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZSA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZShpbnN0YW5jZSwgZWxlbWVudC5uYW1lLCBlbGVtZW50LnR5cGUsIGVsZW1lbnQuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNob3dFdmVudHNMaXN0LCBlbGVtZW50LnNob3dOZXdlc3RFdmVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZS5ldmVudHMgPSAkLm1hcChlbGVtZW50LmV2ZW50cywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBldmVudC5zb3VyY2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlua1NvdXJjZSA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc291cmNlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlua1NvdXJjZSA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZShzb3VyY2Uuc2VydmVyLCBzb3VyY2UuaWQsIHNvdXJjZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UuZXh0cmEsIHNvdXJjZS5hbnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtUYXJnZXQgPSBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtUYXJnZXQgPSBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXQodGFyZ2V0LnNlcnZlciwgdGFyZ2V0LnZhbHVlLCB0YXJnZXQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmV4dHJhLCB0YXJnZXQuZm9sZGVycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmsoaW5zdGFuY2UsIHByb2ZpbGUsIGV2ZW50Lmd1aWQsIGxpbmtTb3VyY2UsIGxpbmtUYXJnZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJpb3JpdHksIGV2ZW50LmNvbmZpcm0sIGV2ZW50LnRpbWVvdXQsIGV2ZW50Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb2ZpbGU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHByb2ZpbGVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2UudXJsKCkgKyBFVldFQjIudXJscy5ldmVudE1vbml0b3JpbmcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGVzIGFuIGV2ZW50IG1vbml0b3JpbmcgcHJvZmlsZS4gIE5vdGU6IGEgcHJvZmlsZSBtdXN0IGhhdmUgb25lIChhbmQgb25seSBvbmUpXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuRXZlbnRNb25pdG9yTGlua30gYXNzaWduZWQgc2luY2UgcHJvZmlsZXMgd2l0aG91dCBhdCBsZWFzdCBvbmUgZXZlbnQgbGluayBhcmUgY29uc2lkZXJlZCBtYXJrZWRcbiAgICAgICAgICogZm9yIGRlbGV0aW9uLiAgSWYgbXVsdGlwbGUgZXZlbnQgbGlua3MgYXJlIHByb3ZpZGVkIGluIHRoZSBwcm9maWxlLCBvbmx5IHRoZSBmaXJzdCB3aWxsIGJlIHN1Ym1pdHRlZC4gIEFsbFxuICAgICAgICAgKiBvdGhlcnMgbXVzdCBiZSBhZGRlZCB0aHJvdWdoIHtAbGluayBFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZS5hZGRMaW5rfS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmVyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYSBtb2RpZmllZCBpbnN0YW5jZSBvZiB0aGUgcHJvdmlkZWRcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JQcm9maWxlfS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZX0gcHJvZmlsZSBUaGUgZXZlbnQgbW9uaXRvciBwcm9maWxlIHRvIGFkZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3JlYXRlRXZlbnRNb25pdG9yUHJvZmlsZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBwcm9maWxlKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBldmVudCBtb25pdG9yaW5nIHByb2ZpbGVcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVyUHJvZmlsZSA9IGRhdGEucHJvZmlsZTtcbiAgICAgICAgICAgICAgICBwcm9maWxlLm5hbWUgPSBzZXJ2ZXJQcm9maWxlLm5hbWU7XG4gICAgICAgICAgICAgICAgcHJvZmlsZS50eXBlID0gc2VydmVyUHJvZmlsZS50eXBlO1xuICAgICAgICAgICAgICAgIHByb2ZpbGUuZGVzY3JpcHRpb24gPSBzZXJ2ZXJQcm9maWxlLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgIHByb2ZpbGUuc2hvd0V2ZW50c0xpc3QgPSBzZXJ2ZXJQcm9maWxlLnNob3dFdmVudHNMaXN0O1xuICAgICAgICAgICAgICAgIHByb2ZpbGUuc2hvd05ld2VzdCA9IHNlcnZlclByb2ZpbGUuc2hvd05ld2VzdEV2ZW50O1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBldmVudHNcbiAgICAgICAgICAgICAgICBwcm9maWxlLmV2ZW50cyA9ICQubWFwKHNlcnZlclByb2ZpbGUuZXZlbnRzLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gZXZlbnQuc291cmNlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlua1NvdXJjZSA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZSgpO1xuICAgICAgICAgICAgICAgICAgICBpZihzb3VyY2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmtTb3VyY2UgPSBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtTb3VyY2Uoc291cmNlLnNlcnZlciwgc291cmNlLmlkLCBzb3VyY2UudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UuZXh0cmEsIHNvdXJjZS5hbnkpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmtUYXJnZXQgPSBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYodGFyZ2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5rVGFyZ2V0ID0gbmV3IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0KHRhcmdldC5zZXJ2ZXIsIHRhcmdldC52YWx1ZSwgdGFyZ2V0LnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmV4dHJhLCB0YXJnZXQuZm9sZGVycyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rKGluc3RhbmNlLCBwcm9maWxlLCBldmVudC5ndWlkLCBsaW5rU291cmNlLCBsaW5rVGFyZ2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJpb3JpdHksIGV2ZW50LmNvbmZpcm0sIGV2ZW50LnRpbWVvdXQsIGV2ZW50Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBwcm9maWxlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBsaW5rID0gcHJvZmlsZS5ldmVudHNbMF07XG4gICAgICAgICAgICBpZihsaW5rID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBldmVudCBsaW5rIHNwZWNpZmllZCBmb3IgcHJvZmlsZS4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBwcm9maWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHByb2ZpbGUuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgdHlwZTogcHJvZmlsZS50eXBlLFxuICAgICAgICAgICAgICAgIHNob3dFdmVudHNMaXN0OiBwcm9maWxlLnNob3dFdmVudHNMaXN0LFxuICAgICAgICAgICAgICAgIHNob3dOZXdlc3RFdmVudDogcHJvZmlsZS5zaG93TmV3ZXN0LFxuICAgICAgICAgICAgICAgIGV2ZW50Q29uZmlybTogbGluay5jb25maXJtLFxuICAgICAgICAgICAgICAgIGV2ZW50TWVzc2FnZTogbGluay5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIGV2ZW50VGltZW91dDogbGluay50aW1lb3V0LFxuICAgICAgICAgICAgICAgIGV2ZW50UHJpb3JpdHk6IGxpbmsucHJpb3JpdHlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGxpbmsuc291cmNlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlSWQgPSBsaW5rLnNvdXJjZS5pZDtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VTZXJ2ZXIgPSBsaW5rLnNvdXJjZS5zZXJ2ZXI7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlVHlwZSA9IGxpbmsuc291cmNlLnR5cGU7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlQW55ID0gbGluay5zb3VyY2UuYW55O1xuICAgICAgICAgICAgICAgIGlmIChsaW5rLnNvdXJjZS5leHRyYUlkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlRXh0cmEgPSBsaW5rLnNvdXJjZS5leHRyYUlkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlU2VydmVyID0gbGluay50YXJnZXQuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZVR5cGUgPSBFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZVR5cGVzLk5vbmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihsaW5rLnRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFZhbHVlID0gbGluay50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0U2VydmVyID0gbGluay50YXJnZXQuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFR5cGUgPSBsaW5rLnRhcmdldC50eXBlO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldEZvbGRlcnMgPSBsaW5rLnRhcmdldC5mb2xkZXJzO1xuICAgICAgICAgICAgICAgIGlmIChsaW5rLnRhcmdldC5leHRyYUlkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0RXh0cmEgPSBsaW5rLnRhcmdldC5leHRyYUlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFNlcnZlciA9IGxpbmsuc291cmNlLnNlcnZlcjtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRUYXJnZXRUeXBlID0gRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXRUeXBlcy5Ob25lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2UudXJsKCkgKyBFVldFQjIudXJscy5ldmVudE1vbml0b3JpbmcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyZWl2ZSB0aGUgbGlzdCBvZiBjYXNlcyBmcm9tIGEgbGlzdCBvZiBzZXJ2ZXJzXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFja1xuICAgICAgICAgKiBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5DYXNlfSBpbnN0YW5jZXMuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcltdfSBzZXJ2ZXJzIEFycmF5IG9mIHNlcnZlcnMgdG8gcmV0cmlldmUgY2FzZXMgZm9yLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRDYXNlcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY2FzZXMgPSAkLm1hcChkYXRhLmNhc2VzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXNlU2VydmVycyA9ICQuZ3JlcChzZXJ2ZXJzLCBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQuaW5BcnJheShlbC5zZXNzaW9uSWQudG9TdHJpbmcoKSwgZWxlbWVudC5zZXJ2ZXJzKSAhPT0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5DYXNlKGNhc2VTZXJ2ZXJzLCBlbGVtZW50Lmd1aWQsIGVsZW1lbnQubmFtZSwgZWxlbWVudC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYm9va21hcmtzKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgY2FzZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgczogJC5tYXAoc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBpbnN0YW5jZS51cmwoKSArIEVWV0VCMi51cmxzLmJvb2ttYXJrQ2FzZXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYodGhpcy5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZSBhIG5ldyBjYXNlLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2tcbiAgICAgICAgICogaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIHtAbGluayBFVldFQjIuQ2FzZX0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhc2V9IG5ld0Nhc2UgVGhlIG5ldyBjYXNlIHRvIGNyZWF0ZS4gIE5vdGU6IHtAbGluayBFVldFQjIuQ2FzZS5ndWlkfSBpcyBpZ25vcmVkIGJ5IHRoaXNcbiAgICAgICAgICogbWV0aG9kIGFuZCBjYW4gYmUgbGVmdCBibGFuay4gIFRoZSBnZW5lcmF0ZWQgY2FzZSB3aWxsIGhhdmUgYSBuZXcgZ3VpZCBhcHBsaWVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jcmVhdGVDYXNlID0gZnVuY3Rpb24oY2FsbGJhY2ssIG5ld0Nhc2UpIHtcbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNhc2VJbmZvID0gZGF0YVsnY2FzZSddO1xuICAgICAgICAgICAgICAgIHZhciBjYXNlU2VydmVycyA9ICQuZ3JlcChuZXdDYXNlLnNlcnZlcnMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoZWwuc2Vzc2lvbklkLnRvU3RyaW5nKCksIGNhc2VJbmZvLnNlcnZlcnMpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgYm9va21hcmtDYXNlID0gbmV3IEVWV0VCMi5DYXNlKGNhc2VTZXJ2ZXJzLCBjYXNlSW5mby5ndWlkLCBjYXNlSW5mby5uYW1lLCBjYXNlSW5mby5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgY2FzZUluZm8uYm9va21hcmtzKTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgYm9va21hcmtDYXNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKG5ld0Nhc2Uuc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmFtZTogbmV3Q2FzZS5uYW1lXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihuZXdDYXNlLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmRlc2NyaXB0aW9uID0gbmV3Q2FzZS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGluc3RhbmNlLnVybCgpICsgRVZXRUIyLnVybHMuYm9va21hcmtDYXNlcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYodGhpcy5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyZWl2ZSB0aGUgbGlzdCBvZiBib29rbWFya3MgZnJvbSBhIGxpc3Qgb2Ygc2VydmVyc1xuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2tcbiAgICAgICAgICogaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuQm9va21hcmt9IGluc3RhbmNlcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgQXJyYXkgb2Ygc2VydmVycyB0byByZXRyaWV2ZSBjYXNlcyBmb3IuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEJvb2ttYXJrcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJNYXAgPSB7fTtcbiAgICAgICAgICAgICAgICAkLmVhY2goc2VydmVycywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyTWFwW2VsZW1lbnQuc2Vzc2lvbklkXSA9IGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYm9va21hcmtzID0gJC5tYXAoZGF0YS5ib29rbWFya3MsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gJC5tYXAoZWxlbWVudC5pdGVtcywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkJvb2ttYXJrSXRlbShzZXJ2ZXJNYXBbZWwuc2VydmVyXSwgZWwuaWQsIGVsLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0ID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGVsZW1lbnQuc3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGVsZW1lbnQuZW5kKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Cb29rbWFyayhlbGVtZW50Lm5hbWUsIGVsZW1lbnQuZ3VpZCwgc3RhcnQsIGVuZCwgaXRlbXMsIGVsZW1lbnQuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnNpemUsIGVsZW1lbnRbJ2Nhc2UnXSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGJvb2ttYXJrcyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChzZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGluc3RhbmNlLnVybCgpICsgRVZXRUIyLnVybHMuYm9va21hcmssXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYodGhpcy5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGUgYSBuZXcgYm9va21hcmsuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFja1xuICAgICAgICAgKiBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4ge0BsaW5rIEVWV0VCMi5Cb29rbWFya30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkJvb2ttYXJrfSBib29rbWFyayBUaGUgYm9va21hcmsgdG8gY3JlYXRlLiAgTm90ZToge0BsaW5rIEVWV0VCMi5ib29rbWFyay5ndWlkfSBpcyBpZ25vcmVkIGJ5XG4gICAgICAgICAqIHRoaXMgbWV0aG9kIGFuZCBjYW4gYmUgbGVmdCBibGFuay4gIFRoZSBnZW5lcmF0ZWQgYm9va21hcmsgd2lsbCBoYXZlIGEgbmV3IGd1aWQgYXBwbGllZC4gIE5vdGU6IElmIHRoaXNcbiAgICAgICAgICogYm9va21hcmsgaXMgYXNzaWduZWQgdG8gYSBjYXNlLCB0aGF0IGNhc2UgbXVzdCBiZSBwcmVzZW50IG9uIGFsbCBvZiB0aGUgc2VydmVycyByZWZlcmVuY2VkIGJ5IHRoZSBib29rbWFya1xuICAgICAgICAgKiBpdGVtcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3JlYXRlQm9va21hcmsgPSBmdW5jdGlvbihjYWxsYmFjaywgYm9va21hcmspIHtcbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlck1hcCA9IHt9O1xuICAgICAgICAgICAgICAgICQuZWFjaChib29rbWFyay5pdGVtcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyTWFwW2VsZW1lbnQuc2VydmVyLnNlc3Npb25JZF0gPSBlbGVtZW50LnNlcnZlcjtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9ICQubWFwKGRhdGEuYm9va21hcmsuaXRlbXMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkJvb2ttYXJrSXRlbShzZXJ2ZXJNYXBbZWwuc2VydmVyXSwgZWwuaWQsIGVsLnR5cGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShkYXRhLmJvb2ttYXJrLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICB2YXIgZW5kID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGRhdGEuYm9va21hcmsuZW5kKTtcblxuICAgICAgICAgICAgICAgIHZhciBuZXdCb29rbWFyayA9IG5ldyBFVldFQjIuQm9va21hcmsoZGF0YS5ib29rbWFyay5uYW1lLCBkYXRhLmJvb2ttYXJrLmd1aWQsIHN0YXJ0LCBlbmQsIGl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmJvb2ttYXJrLmRlc2NyaXB0aW9uLCBkYXRhLmJvb2ttYXJrLnNpemUsIGRhdGEuYm9va21hcmtbJ2Nhc2UnXSk7XG5cblxuICAgICAgICAgICAgICAgIHZhciByZW1haW5pbmdCb29rbWFya3MgPSBib29rbWFyay5pdGVtcy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgIHZhciBhZGRJdGVtRmFpbGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIG9uQm9va21hcmtJdGVtQWRkZWQgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdCb29rbWFya3MtLTtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEl0ZW1GYWlsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHJlbWFpbmluZ0Jvb2ttYXJrcyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JUZXh0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWRkSXRlbUZhaWxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yVGV4dCA9ICdOb3QgYWxsIGl0ZW1zIHdlcmUgYWRkZWQgdG8gdGhlIGJvb2ttYXJrLic7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlLCBlcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBuZXdCb29rbWFyayk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgaWYocmVtYWluaW5nQm9va21hcmtzID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIGl0ZW1zLlxuICAgICAgICAgICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGk9MTsgaTxib29rbWFyay5pdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Qm9va21hcmsuYWRkSXRlbShvbkJvb2ttYXJrSXRlbUFkZGVkLCBib29rbWFyay5pdGVtc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIG5ld0Jvb2ttYXJrKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGJvb2ttYXJrLml0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgXCJBIGJvb2ttYXJrIG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgaXRlbS5cIik7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBNYWtlIHRoZSBpbml0aWFsIGNyZWF0ZSByZXF1ZXN0IHdpdGggdGhlIGZpcnN0IGl0ZW0uXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBib29rbWFyay5pdGVtc1swXS5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGJvb2ttYXJrLm5hbWUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGJvb2ttYXJrLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHN0YXJ0OiBFVldFQjIudXRpbC5EYXRlMklFVEYoYm9va21hcmsuc3RhcnQpLFxuICAgICAgICAgICAgICAgIGVuZDogRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKGJvb2ttYXJrLmVuZCksXG4gICAgICAgICAgICAgICAgaXRlbUlkOiBib29rbWFyay5pdGVtc1swXS5pZCxcbiAgICAgICAgICAgICAgICBpdGVtVHlwZTogYm9va21hcmsuaXRlbXNbMF0udHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKGJvb2ttYXJrLmNhc2VJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGRhdGFbXCJjYXNlXCJdID0gYm9va21hcmsuY2FzZUlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2UudXJsKCkgKyBFVldFQjIudXJscy5ib29rbWFyayxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoaW5zdGFuY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIGluc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgY29uZmlndXJlZCBmcmllbmRseSBuYW1lIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gVGhlIGZ1bmN0aW9uIGdldHNcbiAgICAgICAgICogcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIHRoZSBmcmllbmRseSBuYW1lXG4gICAgICAgICAqIG9mIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZnJpZW5kbHlOYW1lID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBmcmllbmRseU5hbWUgPSBkYXRhLm5hbWU7XG5cbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgdmVyc2lvbiBudW1iZXJcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGZyaWVuZGx5TmFtZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvL0lmIHRoZSBuYW1lIGhhcyBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCByZXR1cm4gdGhlIGNhY2hlZCBuYW1lLlxuICAgICAgICAgICAgaWYoZnJpZW5kbHlOYW1lICE9PSAnJykge1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZnJpZW5kbHlOYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUluZm9cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHRoaXMuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQGNhbGxiYWNrIG9uR2V0QWRkcmVzc2VzXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlJlc3BvbnNlU3RhdHVzfSByZXNwb25zZSBTdWNjZXNzIHN0YXRlIG9mIHRoZSByZXNwb25zZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZUFkZHJlc3Nlc30gYWRkcmVzc2VzIFRoZSBzZXJ2aWNlIGFkZHJlc3MgY29uZmlndXJhdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmdbXX0gdGhyb3R0bGVkUmVsYXlNQUNzIEEgbGlzdCBvZiBtYWMgYWRkcmVzc2VzLCBjb3JyZXNwb25kaW5nIHRvIHNlcnZlcnMgdGhhdCB3b3VsZCBoYXZlXG4gICAgICAgICAqIHZpZGVvIGNvbm5lY3Rpb25zIHRocm90dGxlZCBpZiB0aGUgSFRUUCBpbnRlcmZhY2Ugd2VyZSB0byBiZSB1c2VkIG92ZXIgdGhlIHJlbGF5LlxuICAgICAgICAgKiBAaWdub3JlXG4gICAgICAgICAqL1xuICAgICAgICAvKipcbiAgICAgICAgICogRVZXRUIyLlNlcnZpY2UuZ2V0QWRkcmVzc2VzIHJldHJpZXZlcyB0aGUgc2V0IG9mIGFsbCBuZXR3b3JrIGFkZHJlc3NlcyBmb3IgYSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZSB0aGF0IHdoaWxlIGFsbCBhZGRyZXNzZXMgYXJlIHJldHVybmVkLCBhIGNsaWVudCBtYXkgbm90IGJlIGFibGUgdG8gY29ubmVjdCB0aHJvdWdoIGFsbCBvZlxuICAgICAgICAgKiB0aGVtIGRlcGVuZGluZyBvbiBpdHMgb3duIG5ldHdvcmsgc2l0dWF0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge29uR2V0QWRkcmVzc2VzfSBjYiBGdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0QWRkcmVzc2VzID0gZnVuY3Rpb24oY2IpIHtcbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGludGVybmFsO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmFkZHJlc3Nlcy5pbnRlcm5hbCkge1xuICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbCA9IGRhdGEuYWRkcmVzc2VzLmludGVybmFsLm1hcChmdW5jdGlvbihhZGRyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5OZXR3b3JrQWRkcmVzcyhhZGRyLnByb3RvY29sLCBhZGRyLmhvc3QsIGFkZHIucG9ydCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBkZXRlY3RlZDtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5hZGRyZXNzZXMuZGV0ZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQgPSBkYXRhLmFkZHJlc3Nlcy5kZXRlY3RlZC5tYXAoZnVuY3Rpb24oYWRkcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuTmV0d29ya0FkZHJlc3MoYWRkci5wcm90b2NvbCwgYWRkci5ob3N0LCBhZGRyLnBvcnQpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWw7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuYWRkcmVzc2VzLmV4dGVybmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4dGVybmFsID0gbmV3IEVWV0VCMi5OZXR3b3JrQWRkcmVzcyhcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWRkcmVzc2VzLmV4dGVybmFsLnByb3RvY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hZGRyZXNzZXMuZXh0ZXJuYWwuaG9zdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuYWRkcmVzc2VzLmV4dGVybmFsLnBvcnRcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVsYXk7XG4gICAgICAgICAgICAgICAgdmFyIHRocm90dGxlZCA9IFtdO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLmFkZHJlc3Nlcy5yZWxheSkge1xuICAgICAgICAgICAgICAgICAgICByZWxheSA9IG5ldyBFVldFQjIuTmV0d29ya0FkZHJlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmFkZHJlc3Nlcy5yZWxheS5hZGRyZXNzLnByb3RvY29sLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hZGRyZXNzZXMucmVsYXkuYWRkcmVzcy5ob3N0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5hZGRyZXNzZXMucmVsYXkuYWRkcmVzcy5wb3J0XG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIHRocm90dGxlZCA9IGRhdGEuYWRkcmVzc2VzLnJlbGF5LnRocm90dGxlZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYWRkcmVzc2VzID0gbmV3IEVWV0VCMi5TZXJ2aWNlQWRkcmVzc2VzKFxuICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbCxcbiAgICAgICAgICAgICAgICAgICAgZGV0ZWN0ZWQsXG4gICAgICAgICAgICAgICAgICAgIGV4dGVybmFsLFxuICAgICAgICAgICAgICAgICAgICByZWxheVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgY2IobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKSwgYWRkcmVzc2VzLCB0aHJvdHRsZWQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIGNiKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheCh7XG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnVybCgpICsgRVZXRUIyLnVybHMuYWRkcmVzc2VzLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvclxuICAgICAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEVWV0VCMi5OZXR3b3JrQWRkcmVzcyBwb2ludHMgdG8gYSBuZXR3b3JrIGVuZHBvaW50LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm90b2NvbCBUaGUgcHJvdG9jb2wuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGhvc3RuYW1lIFRoZSBob3N0bmFtZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcG9ydCBUaGUgcG9ydC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5OZXR3b3JrQWRkcmVzcyA9IGZ1bmN0aW9uKHByb3RvY29sLCBob3N0bmFtZSwgcG9ydCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHByb3RvY29sLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm90b2NvbCA9IHByb3RvY29sIHx8ICdodHRwJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHByb3RvY29sLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3RuYW1lIHx8ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHJvdG9jb2wuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvcnQgPSBwb3J0IHx8ICh0aGlzLnByb3RvY29sID09PSAnaHR0cHMnID8gNDQzIDogODApO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBFVldFQjIuU2VydmljZUFkZHJlc3NlcyBkZXNjcmliZXMgdGhlIG5ldHdvcmsgYWRkcmVzc2VzIG9uIHdoaWNoIGEgc2VydmljZSBjYW4gYmUgcmVhY2hlZC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5OZXR3b3JrQWRkcmVzc1tdfSBpbnRlcm5hbCBUaGUgc2V0IG9mIGNvbmZpZ3VyZWQgaW50ZXJuYWwgYWRkcmVzc2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLk5ldHdvcmtBZGRyZXNzW119IGRldGVjdGVkIFRoZSBzZXQgb2YgZGV0ZWN0ZWQgZXh0ZXJuYWwgYWRkcmVzc2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLk5ldHdvcmtBZGRyZXNzfSBleHRlcm5hbCBUaGUgY29uZmlndXJlZCBleHRlcm5hbCBhZGRyZXNzLCBpZiBzZXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuTmV0d29ya0FkZHJlc3N9IHJlbGF5IFRoZSBuZXR3b3JrIHJlbGF5IGFkZHJlc3MsIGlmIGNvbmZpZ3VyZWQuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZUFkZHJlc3NlcyA9IGZ1bmN0aW9uKGludGVybmFsLCBkZXRlY3RlZCwgZXh0ZXJuYWwsIHJlbGF5KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2V0IG9mIGNvbmZpZ3VyZWQgaW50ZXJuYWwgbmV0d29yayBhZGRyZXNzZXMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuTmV0d29ya0FkZHJlc3NbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW50ZXJuYWwgPSBpbnRlcm5hbCB8fCBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNldCBvZiBkZXRlY3RlZCBleHRlcm5hbCBhZGRyZXNzZXMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuTmV0d29ya0FkZHJlc3NbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGV0ZWN0ZWQgPSBkZXRlY3RlZCB8fCBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV4dGVybmFsbHkgYWNjZXNzaWJsZSBhZGRyZXNzLCBpZiBjb25maWd1cmVkLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLk5ldHdvcmtBZGRyZXNzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHRlcm5hbCA9IGV4dGVybmFsIHx8IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuZXR3b3JrIHJlbGF5IGFkZHJlc3MsIGlmIGNvbmZpZ3VyZWQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuTmV0d29ya0FkZHJlc3N9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlbGF5ID0gcmVsYXkgfHwgbnVsbDtcbiAgICB9O1xufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBFbnVtZXJhdGlvbiBvZiBIVFRQIHBvbGljaWVzIGVuZm9yY2VkIHdoaWxlIEhUVFBTIGlzIGNvbmZpZ3VyZWQuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5odHRwUG9saWN5ID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQ29uZHVjdCBIVFRQIHRyYWZmaWMgYXMgdXN1YWwuXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogUmVkaXJlY3QgYWxsIEhUVFAgdHJhZmZpYyB0byBIVFRQUy5cbiAgICAgICAgICovXG4gICAgICAgIHJlZGlyZWN0OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogRG8gbm90IGFjY2VwdCBpbmNvbWluZyBjb25uZWN0aW9ucyBvbiB0aGUgSFRUUCBwb3J0LlxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYWJsZTogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGJhc2ljIFNTbC9UTFMgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbi5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NvbW1vbk5hbWU9JyddIFRoZSBjb21tb24gbmFtZSAoQ04pIHRoZSBjZXJ0aWZpY2F0ZSBpcyBjb25maWd1cmVkIGZvciAoaWYgYW55KVxuICAgICAqIEBwYXJhbSB7U3RyaW5nW119IFtkb21haW5zPVtdXSBUaGUgbGlzdCBvZiBhbGwgZG9tYWlucyB0aGUgY2VydGlmaWNhdGUgaXMgY29uZmlndXJlZCBmb3IgKGlmIGFueSkgKENOICsgU0FOcylcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt2YWxpZD1mYWxzZV0gRmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBjb25maWd1cmF0aW9uIGlzIHZhbGlkXG4gICAgICogQHBhcmFtIHtEYXRlfG51bGx9IFtleHBpcmF0aW9uPW51bGxdIFRoZSBkYXRlIHRoZSBjZXJ0aWZpY2F0ZSBleHBpcmVzXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuQmFzaWNTU0xDb25maWcgPSBmdW5jdGlvbihjb21tb25OYW1lLCBkb21haW5zLCB2YWxpZCwgZXhwaXJhdGlvbikge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY29tbW9uIG5hbWUgY29uZmlndXJlZFxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb21tb25OYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkb21haW4gbmFtZXMgY29uZmlndXJlZCAoQ04gKyBTQU5zKVxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRvbWFpbnMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBTU0wgY29uZmlndXJhdGlvbi9jZXJ0aWZpY2F0ZSBpcyB2YWxpZFxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmFsaWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV4cGlyYXRpb24gZGF0ZSBvZiB0aGUgY2VydGlmaWNhdGVcbiAgICAgICAgICogQHR5cGUge0RhdGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4cGlyYXRpb24gPSBudWxsO1xuXG4gICAgICAgIGlmKGNvbW1vbk5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb21tb25OYW1lID0gY29tbW9uTmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihkb21haW5zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZG9tYWlucyA9IGRvbWFpbnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYodmFsaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52YWxpZCA9IHZhbGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4cGlyYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHBpcmF0aW9uID0gZXhwaXJhdGlvbjtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgZXh0ZXJuYWwgU1NMIGNvbmZpZyBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gU1NMIGNvbmZpZ3VyYXRpb25zXG4gICAgICogdGhhdCB1c2UgYW4gZXh0ZXJuYWxseSBwcm92aWRlZCBwcml2YXRlIGtleSBhbmQgY2VydGlmaWNhdGUgKGUuZy4gRGlnaUNlcnQpXG4gICAgICogQGNsYXNzXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBlbmFibGVkIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIFNTTCBzdXBwb3J0IGlzIGNvbmZpZ3VyZWQgYW5kIGVuYWJsZWRcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5CYXNpY1NTTENvbmZpZ3xudWxsfSBiYXNpY0NvbmZpZyBDb21tb24gU1NMIGNvbmZpZ3VyYXRpb24uIElmIGRpc2FibGVkIHRoaXMgbWF5IGJlIG51bGwuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuRXh0ZXJuYWxTU0xDb25maWcgPSBmdW5jdGlvbihlbmFibGVkLCBiYXNpY0NvbmZpZykge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBTU0wvVExTIGlzIGVuYWJsZWQuIElmIHRoaXMgaXMgZmFsc2Ugbm9uZSBvZiB0aGUgb3RoZXIgcGFyYW1ldGVycyBoYXZlXG4gICAgICAgICAqIGFueSBtZWFuaW5nLlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGVuYWJsZWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbW1vbiBTU0wgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvblxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkJhc2ljU1NMQ29uZmlnfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJhc2ljID0gYmFzaWNDb25maWc7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb24gb2YgdGhlIHBvc3NpYmxlIFNTTCBjb25maWcgdHlwZXNcbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLnNzbENvbmZpZ1R5cGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTU0wvVExTIGlzIG5vdCBjb25maWd1cmVkIGJ5IHRoZSBzZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gZXh0ZXJuYWxseS1wcm92aWRlZCBjb25maWd1cmF0aW9uIGlzIGVuYWJsZWRcbiAgICAgICAgICovXG4gICAgICAgIGV4dGVybmFsOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gQUNNRSBzZXJ2ZXIgY29uZmlndXJhdGlvbiBpcyBlbmFibGVkXG4gICAgICAgICAqL1xuICAgICAgICBhY21lOiAyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb24gb2YgQUNNRSByZXF1ZXN0IHN0YXR1cyBjb2Rlc1xuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuYWNtZVNTTFJlcXVlc3RTdGF0dXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXF1ZXN0IGlzIGluLWZsaWdodCBhbmQgc3RpbGwgcGVuZGluZ1xuICAgICAgICAgKi9cbiAgICAgICAgcGVuZGluZzogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENlcnRpZmljYXRlIHdhcyBpc3N1ZWQgYW5kIGNvbmZpZ3VyZWRcbiAgICAgICAgICovXG4gICAgICAgIHN1Y2Nlc3M6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSFRUUCBjaGFsbGVuZ2Ugc3VibWl0dGVkIHRvIHRoZSBBQ01FIHNlcnZlciBmYWlsZWRcbiAgICAgICAgICovXG4gICAgICAgIGh0dHBDaGFsbGVuZ2VGYWlsZWQ6IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogRmFpbGVkIHRvIHZlcmlmeSB0aGUgcmVxdWVzdGVkIGRvbWFpbiBtYXBzIHRvIHRoZSBzZXJ2aWNlIElQXG4gICAgICAgICAqL1xuICAgICAgICBsb2NhbERvbWFpblZlcmlmeUZhaWxlZDogLTIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOZXR3b3JrIHByb2JsZW0gKGUuZy4gdW5yZWFjaGFibGUgQUNNRSBzZXJ2ZXIpXG4gICAgICAgICAqL1xuICAgICAgICBuZXR3b3JrRXJyb3I6IC0zLFxuICAgICAgICAvKipcbiAgICAgICAgICogVG9vIG1hbnkgcmVxdWVzdHMgbWFkZSBpbiBhIHJvdywgdGVtcG9yYXJpbHkgcmF0ZS1saW1pdGVkIGJ5IEFDTUUgc2VydmVyLiBUcnkgYWdhaW4gbGF0ZXJcbiAgICAgICAgICovXG4gICAgICAgIHJhdGVMaW1pdGVkOiAtNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFDTUUgYWNjb3VudCBkYXRhIGlzIGNvcnJ1cHRlZFxuICAgICAgICAgKi9cbiAgICAgICAgYWNjb3VudERhdGFDb3JydXB0OiAtNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFDTUUgc2VydmVyIGhhcyByZWplY3RlZCB0aGUgZG9tYWluIGFzIGludmFsaWRcbiAgICAgICAgICovXG4gICAgICAgIGludmFsaWREb21haW46IC02LFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gQUNNRSBwcm90b2NvbCBlcnJvciBvY2N1cnJlZFxuICAgICAgICAgKi9cbiAgICAgICAgcHJvdG9jb2xFcnJvcjogLTcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duIGVycm9yLiBDb25zdWx0IHRoZSBzZXJ2aWNlIGxvZ3NcbiAgICAgICAgICovXG4gICAgICAgIHVua25vd25FcnJvcjogLThcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIEFDTUUgU1NMIGNvbmZpZyBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gU1NMIGNvbmZpZ3VyYXRpb25zIHRoYXRcbiAgICAgKiB1c2UgYW4gQUNNRSBzZXJ2ZXIgdG8gYXV0b21hdGljYWxseSBtYW5hZ2UgU1NMIGNlcnRpZmljYXRlcyBhbmQgcHJpdmF0ZSBrZXlzIChlLmcuIExldCdzIEVuY3J5cHRcbiAgICAgKiBpcyBhbiBBQ01FIHNlcnZlcikuXG4gICAgICogQGNsYXNzXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBlbmFibGVkIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIFNTTCBzdXBwb3J0IGlzIGNvbmZpZ3VyZWQgYW5kIGVuYWJsZWRcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5CYXNpY1NTTENvbmZpZ3xudWxsfSBiYXNpY0NvbmZpZyBDb21tb24gU1NMIGNvbmZpZ3VyYXRpb24uIElmIGRpc2FibGVkIHRoaXMgbWF5IGJlIG51bGwuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYXV0b1JlbmV3PWZhbHNlXSBGbGFnIGluZGljYXRpbmcgd2hldGhlciBhdXRvLXJlbmV3YWwgaXMgZW5hYmxlZCwgaWYgdHJ1ZSB0aGVcbiAgICAgKiBzZXJ2aWNlIHdpbGwgYXR0ZW1wdCB0byByZW5ldyB0aGUgY2VydGlmaWNhdGUgYmVmb3JlIGl0IGV4cGlyZXMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFthY21lU2VydmVyPW51bGxdIFRoZSBBQ01FIHNlcnZlciB1c2VkIHRvIHByb3Zpc2lvbiB0aGUgY2VydGlmaWNhdGUuIElmIG5vdCBwcm92aWRlZFxuICAgICAqIHRoaXMgZGVmYXVsdHMgdG8gdGhlIExldCdzIEVuY3J5cHQgcHJvZHVjdGlvbiBzZXJ2ZXIncy5cbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5BY21lU1NMQ29uZmlnID0gZnVuY3Rpb24oZW5hYmxlZCwgYmFzaWNDb25maWcsIGF1dG9SZW5ldywgYWNtZVNlcnZlcikge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBTU0wvVExTIGlzIGVuYWJsZWQuIElmIHRoaXMgaXMgZmFsc2Ugbm9uZSBvZiB0aGUgb3RoZXIgcGFyYW1ldGVycyBoYXZlXG4gICAgICAgICAqIGFueSBtZWFuaW5nLlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGVuYWJsZWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbW1vbiBTU0wgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvblxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkJhc2ljU1NMQ29uZmlnfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJhc2ljID0gYmFzaWNDb25maWc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZsYWcgaW5kaWNhdGluZyB3aGV0aGVyIGF1dG8tcmVuZXdhbCBpcyBlbmFibGVkXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRvUmVuZXcgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIEFDTUUgc2VydmVyICh1cmwpIHVzZWQgdG8gcHJvdmlzaW9uIHRoZSBjZXJ0aWZpY2F0ZVxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY21lU2VydmVyID0gbnVsbDtcblxuICAgICAgICBpZiAoYXV0b1JlbmV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXV0b1JlbmV3ID0gYXV0b1JlbmV3O1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY21lU2VydmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWNtZVNlcnZlciA9IGFjbWVTZXJ2ZXI7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZpY2Ugc2VydmVyIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbCBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCBhXG4gICAgICogc2VydmVyIG9uIGEgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2lkPTBdIFRoZSBzZXJ2ZXIgSUQgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFthZGRyZXNzPScnXSBUaGUgYWRkcmVzcyBmb3IgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MF0gVGhlIHBvcnQgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt0aW1lb3V0PTBdIFRoZSB0aW1lb3V0IGR1cmF0aW9uIGZvciBzZXJ2ZXIgcmVxdWVzdHMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcGFzc3Rocm91Z2g9ZmFsc2VdIFdoZXRoZXIgdGhlIHNlcnZlciBpcyBjb25maWd1cmVkIGFzIGEgcGFzc3Rocm91Z2ggc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdXNlcm5hbWU9JyddIFRoZSB1c2VybmFtZSBmb3IgcGFzc3Rocm91Z2ggY29ubmVjdGlvbnMgdG8gdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bhc3N3b3JkPScnXSBUaGUgcGFzc3dvcmQgZm9yIHBhc3N0aHJvdWdoIGNvbm5lY3Rpb25zIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYXV0b3BvcHVsYXRlPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgaXMgY29uZmlndXJlZCB0byBhdXRvcG9wdWxhdGUgb24gbG9hZC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtwb3dlclVzZXI9ZmFsc2VdIFdoZXRoZXIgdGhlIHNlcnZlciBoYXMgYSBwb3dlciB1c2VyIHByb2Nlc3MgY29uZmlndXJlZC4gIFBvd2VyIHVzZXIgcHJvY2Vzc2VzXG4gICAgICogICBhcmUgdXNlZCB0byBlbmFibGUgZnVuY3Rpb25hbGl0eSBvdXRzaWRlIG9mIHRoZSBjdXJyZW50IHNlc3Npb24sIGZvciBleGFtcGxlLCBwdXNoIG5vdGlmaWNhdGlvbnMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtwb3dlclVzZXJVc2VybmFtZT0nJ10gVGhlIHVzZXJuYW1lIGZvciB0aGUgcG93ZXIgdXNlciBwcm9jZXNzIGNvbm5lY3Rpb24gdG8gdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bvd2VyVXNlclBhc3N3b3JkPScnXSBUaGUgcGFzc3dvcmQgZm9yIHRoZSBwb3dlciB1c2VyIHByb2Nlc3MgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIG5hbWUgb2YgdGhlIHNlcnZlciBpZiBrbm93bi5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlU2VydmVyQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKGlkLCBhZGRyZXNzLCBwb3J0LCB0aW1lb3V0LCBwYXNzdGhyb3VnaCwgdXNlcm5hbWUsIHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9wb3B1bGF0ZSwgcG93ZXJVc2VyLCBwb3dlclVzZXJVc2VybmFtZSwgcG93ZXJVc2VyUGFzc3dvcmQsIG5hbWUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgSUQgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFkZHJlc3MgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvcnQgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvcnQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdGltZW91dCBkdXJhdGlvbiBmb3Igc2VydmVyIHJlcXVlc3RzLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aW1lb3V0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGlzIGNvbmZpZ3VyZWQgYXMgYSBwYXNzdGhyb3VnaCBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzdGhyb3VnaCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgZm9yIHBhc3N0aHJvdWdoIGNvbm5lY3Rpb25zIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwYXNzd29yZCBmb3IgcGFzc3Rocm91Z2ggY29ubmVjdGlvbnMgdG8gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGFzc3dvcmQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGlzIGNvbmZpZ3VyZWQgdG8gYXV0b3BvcHVsYXRlIG9uIGxvYWQuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIHZhbHVlIGlzIG5vIGxvbmdlciBwcm9jZXNzZWQgYW5kIGNhbiBiZSBpZ25vcmVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRvcG9wdWxhdGUgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGhhcyBhIHBvd2VyIHVzZXIgcHJvY2VzcyBjb25maWd1cmVkLiAgUG93ZXIgdXNlciBwcm9jZXNzZXMgYXJlIHVzZWRcbiAgICAgICAgICogdG8gZW5hYmxlIGZ1bmN0aW9uYWxpdHkgb3V0c2lkZSBvZiB0aGUgY3VycmVudCBzZXNzaW9uLCBmb3IgZXhhbXBsZSwgcHVzaCBub3RpZmljYXRpb25zLlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG93ZXJVc2VyID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1c2VybmFtZSBmb3IgdGhlIHBvd2VyIHVzZXIgcHJvY2VzcyBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvd2VyVXNlclVzZXJuYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwYXNzd29yZCBmb3IgdGhlIHBvd2VyIHVzZXIgcHJvY2VzcyBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvd2VyVXNlclBhc3N3b3JkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSAoZnJpZW5kbHkpIG5hbWUgb2YgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICAgICAgfVxuICAgICAgICBpZihwb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHBhc3N0aHJvdWdoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFzc3Rocm91Z2ggPSBwYXNzdGhyb3VnaDtcbiAgICAgICAgfVxuICAgICAgICBpZih1c2VybmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYocGFzc3dvcmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGF1dG9wb3B1bGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmF1dG9wb3B1bGF0ZSA9IGF1dG9wb3B1bGF0ZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwb3dlclVzZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wb3dlclVzZXIgPSBwb3dlclVzZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYocG93ZXJVc2VyVXNlcm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wb3dlclVzZXJVc2VybmFtZSA9IHBvd2VyVXNlclVzZXJuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBvd2VyVXNlclBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG93ZXJVc2VyUGFzc3dvcmQgPSBwb3dlclVzZXJQYXNzd29yZDtcbiAgICAgICAgfVxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZpY2UgcmVtb3RlIHNlcnZlciBjb25maWd1cmF0aW9uIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhbGwgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkXG4gICAgICogd2l0aCBhIHJlbW90ZSBzZXJ2ZXIgb24gYSBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaWQ9MF0gVGhlIHNlcnZlciBJRCBmb3IgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkZW50aWZpZXI9JyddIFRoZSBpZGVudGlmaWVyIGZvciB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbdGltZW91dD0wXSBUaGUgdGltZW91dCBkdXJhdGlvbiBmb3Igc2VydmVyIHJlcXVlc3RzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3Bhc3N0aHJvdWdoPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgaXMgY29uZmlndXJlZCBhcyBhIHBhc3N0aHJvdWdoIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJuYW1lPScnXSBUaGUgdXNlcm5hbWUgZm9yIHBhc3N0aHJvdWdoIGNvbm5lY3Rpb25zIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtwYXNzd29yZD0nJ10gVGhlIHBhc3N3b3JkIGZvciBwYXNzdGhyb3VnaCBjb25uZWN0aW9ucyB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2F1dG9wb3B1bGF0ZT1mYWxzZV0gV2hldGhlciB0aGUgc2VydmVyIGlzIGNvbmZpZ3VyZWQgdG8gYXV0b3BvcHVsYXRlIG9uIGxvYWQuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcG93ZXJVc2VyPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgaGFzIGEgcG93ZXIgdXNlciBwcm9jZXNzIGNvbmZpZ3VyZWQuICBQb3dlciB1c2VyIHByb2Nlc3Nlc1xuICAgICAqIGFyZSB1c2VkIHRvIGVuYWJsZSBmdW5jdGlvbmFsaXR5IG91dHNpZGUgb2YgdGhlIGN1cnJlbnQgc2Vzc2lvbiwgZm9yIGV4YW1wbGUsIHB1c2ggbm90aWZpY2F0aW9ucy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bvd2VyVXNlclVzZXJuYW1lPScnXSBUaGUgdXNlcm5hbWUgZm9yIHRoZSBwb3dlciB1c2VyIHByb2Nlc3MgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcG93ZXJVc2VyUGFzc3dvcmQ9JyddIFRoZSBwYXNzd29yZCBmb3IgdGhlIHBvd2VyIHVzZXIgcHJvY2VzcyBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPScnXSBUaGUgbmFtZSBvZiB0aGUgc2VydmVyIGlmIGtub3duLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VSZW1vdGVTZXJ2ZXJDb25maWd1cmF0aW9uID0gZnVuY3Rpb24oaWQsIGlkZW50aWZpZXIsIHRpbWVvdXQsIHBhc3N0aHJvdWdoLCB1c2VybmFtZSwgcGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BvcHVsYXRlLCBwb3dlclVzZXIsIHBvd2VyVXNlclVzZXJuYW1lLCBwb3dlclVzZXJQYXNzd29yZCwgbmFtZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBJRCBmb3IgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaWRlbnRpZmllciBmb3IgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWRlbnRpZmllciA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdGltZW91dCBkdXJhdGlvbiBmb3Igc2VydmVyIHJlcXVlc3RzLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aW1lb3V0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGlzIGNvbmZpZ3VyZWQgYXMgYSBwYXNzdGhyb3VnaCBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzdGhyb3VnaCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgZm9yIHBhc3N0aHJvdWdoIGNvbm5lY3Rpb25zIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwYXNzd29yZCBmb3IgcGFzc3Rocm91Z2ggY29ubmVjdGlvbnMgdG8gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGFzc3dvcmQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGlzIGNvbmZpZ3VyZWQgdG8gYXV0b3BvcHVsYXRlIG9uIGxvYWQuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRvcG9wdWxhdGUgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGhhcyBhIHBvd2VyIHVzZXIgcHJvY2VzcyBjb25maWd1cmVkLiAgUG93ZXIgdXNlciBwcm9jZXNzZXMgYXJlIHVzZWRcbiAgICAgICAgICogdG8gZW5hYmxlIGZ1bmN0aW9uYWxpdHkgb3V0c2lkZSBvZiB0aGUgY3VycmVudCBzZXNzaW9uLCBmb3IgZXhhbXBsZSwgcHVzaCBub3RpZmljYXRpb25zLlxuICAgICAgICAgKiBUaGVzZSBwcm9jZXNzZXMgYXJlIG5ldmVyIGFjY2Vzc2VkIGJ5IGEgY2xpZW50IG9mIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvd2VyVXNlciA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgZm9yIHRoZSBwb3dlciB1c2VyIHByb2Nlc3MgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3dlclVzZXJVc2VybmFtZSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcGFzc3dvcmQgZm9yIHRoZSBwb3dlciB1c2VyIHByb2Nlc3MgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3dlclVzZXJQYXNzd29yZCA9ICcnO1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSAoZnJpZW5kbHkpIG5hbWUgb2YgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGlkZW50aWZpZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pZGVudGlmaWVyID0gaWRlbnRpZmllcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0aW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYocGFzc3Rocm91Z2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wYXNzdGhyb3VnaCA9IHBhc3N0aHJvdWdoO1xuICAgICAgICB9XG4gICAgICAgIGlmKHVzZXJuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwYXNzd29yZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBhc3N3b3JkID0gcGFzc3dvcmQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYXV0b3BvcHVsYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXV0b3BvcHVsYXRlID0gYXV0b3BvcHVsYXRlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBvd2VyVXNlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBvd2VyVXNlciA9IHBvd2VyVXNlcjtcbiAgICAgICAgfVxuICAgICAgICBpZihwb3dlclVzZXJVc2VybmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBvd2VyVXNlclVzZXJuYW1lID0gcG93ZXJVc2VyVXNlcm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYocG93ZXJVc2VyUGFzc3dvcmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wb3dlclVzZXJQYXNzd29yZCA9IHBvd2VyVXNlclBhc3N3b3JkO1xuICAgICAgICB9XG4gICAgICAgIGlmKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSByZW1vdGUgc2VydmVyIHNldHRpbmdzIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbFxuICAgICAqIGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIGhhbmRsaW5nIHJlbW90ZSBzZXJ2ZXJzIG9uIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtlbmFibGVkPWZhbHNlXSBXaGV0aGVyIHJlbW90ZSBzZXJ2ZXJzIHN1cHBvcnQgaXMgZW5hYmxlZC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MzUxMTFdIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgaW5jb21pbmcgcmVtb3RlIHNlcnZlciBjb25uZWN0aW9ucy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlUmVtb3RlU2VydmVyU2V0dGluZ3NDb25maWd1cmF0aW9uID0gZnVuY3Rpb24oZW5hYmxlZCwgcG9ydCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciByZW1vdGUgc2VydmVycyBzdXBwb3J0IGlzIGVuYWJsZWQuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgaW5jb21pbmcgcmVtb3RlIHNlcnZlciBjb25uZWN0aW9ucy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydCA9IDM1MTExO1xuICAgICAgICBcbiAgICAgICAgaWYoZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSBlbmFibGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBvcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydDtcbiAgICAgICAgfVxuICAgIH07ICAgIFxuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSBsb2dnaW5nIGxldmVscyBmb3IgYSBzZXJ2aWNlIGNvbmZpZ3VyYXRpb25cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLnNlcnZpY2VMb2dnaW5nTGV2ZWxzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm90IHNldFxuICAgICAgICAgKi9cbiAgICAgICAgTk9UU0VUOiAtMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBFUlJPUjogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdhcm5pbmdcbiAgICAgICAgICovXG4gICAgICAgIFdBUk5JTkc6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbmZvXG4gICAgICAgICAqL1xuICAgICAgICBJTkZPOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVidWdcbiAgICAgICAgICovXG4gICAgICAgIERFQlVHOiAzXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgbG9nIGZpbGUgaW50ZXJ2YWwgdHlwZXNcbiAgICAgKiBAZW51bSB7U3RyaW5nfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLnNlcnZpY2VMb2dGaWxlSW50ZXJ2YWxUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmUgOiAnJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1pbnV0ZVxuICAgICAgICAgKi9cbiAgICAgICAgbWludXRlIDogJ00nLFxuICAgICAgICAvKipcbiAgICAgICAgICogSG91clxuICAgICAgICAgKi9cbiAgICAgICAgaG91ciA6ICdIJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERheVxuICAgICAgICAgKi9cbiAgICAgICAgZGF5IDogJ0QnLFxuICAgICAgICAvKipcbiAgICAgICAgICogV2Vla1xuICAgICAgICAgKi9cbiAgICAgICAgd2VlayA6ICdXJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSBsb2cgZmlsZSBjb25maWd1cmF0aW9uIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhbGwgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkXG4gICAgICogd2l0aCB0aGUgbG9nIGZpbGUgZm9yIHRoZSBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaW50ZXJ2YWw9MF0gVGhlIGludGVydmFsIGFnZSBvZiB0aGUgbG9nIGZpbGUuXG4gICAgICogQHBhcmFtIHtFVldFQjIuc2VydmljZUxvZ0ZpbGVJbnRlcnZhbFR5cGVzfSBbdHlwZT1FVldFQjIuc2VydmljZUxvZ0ZpbGVJbnRlcnZhbFR5cGVzLm5vbmVdIFRoZSBpbnRlcnZhbCB0eXBlIG9mXG4gICAgICogdGhlIGxvZyBmaWxlIGFnZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2NvdW50PTBdIFRoZSBudW1iZXIgb2YgYmFja3VwcyB0byBiZSB1c2VkIGZvciB0aGlzIGxvZyBmaWxlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnNlcnZpY2VMb2dnaW5nTGV2ZWxzfSBbbGV2ZWw9RVZXRUIyLnNlcnZpY2VMb2dnaW5nTGV2ZWxzLk5PVFNFVF0gVGhlIGxvZ2dpbmcgbGV2ZWwgb2YgdGhlIHdlYlxuICAgICAqIHNlcnZpY2UuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZUxvZ0ZpbGVDb25maWd1cmF0aW9uID0gZnVuY3Rpb24oaW50ZXJ2YWwsIHR5cGUsIGNvdW50LCBsZXZlbCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGludGVydmFsIGFnZSBvZiB0aGUgbG9nIGZpbGVcbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW50ZXJ2YWwgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW50ZXJ2YWwgdHlwZSBvZiB0aGUgbG9nIGZpbGUgYWdlLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuc2VydmljZUxvZ0ZpbGVJbnRlcnZhbFR5cGVzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIuc2VydmljZUxvZ0ZpbGVJbnRlcnZhbFR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgYmFja3VwcyB0byBiZSB1c2VkIGZvciB0aGlzIGxvZyBmaWxlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb3VudCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsb2dnaW5nIGxldmVsIG9mIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5zZXJ2aWNlTG9nZ2luZ0xldmVsc3xudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxldmVsID0gRVZXRUIyLnNlcnZpY2VMb2dnaW5nTGV2ZWxzLk5PVFNFVDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGludGVydmFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSBpbnRlcnZhbDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY291bnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb3VudCA9IGNvdW50O1xuICAgICAgICB9XG4gICAgICAgIGlmKGxldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcG9ydCBjb25maWd1cmF0aW9uIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhbGwgcG9ydCBjb25maWd1cmF0aW9uXG4gICAgICogaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2h0dHA9ODBdIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgSFRUUCB0cmFmZmljLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaHR0cHM9NDQzXSBUaGUgbGlzdGVuaW5nIHBvcnQgZm9yIEhUVFBTIHRyYWZmaWMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3cz04MDgyXSBUaGUgbGlzdGVuaW5nIHBvcnQgZm9yIFdlYiBTb2NrZXQgdHJhZmZpYy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3dzcz04MDgzXSBUaGUgbGlzdGVuaW5nIHBvcnQgZm9yIFNlY3VyZSBXZWIgU29ja2V0IHRyYWZmaWMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuaHR0cFBvbGljeX0gW2h0dHBQb2xpY3k9RVZXRUIyLmh0dHBQb2xpY3kubm9uZV0gVGhlIHBvbGljeSB0byBlbmZvcmNlIGZvciBIVFRQIHRyYWZmaWMgd2hlbiBIVFRQU1xuICAgICAqIGlzIGNvbmZpZ3VyZWQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZVBvcnRzQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKGh0dHAsIGh0dHBzLCB3cywgd3NzLCBodHRwUG9saWN5KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGlzdGVuaW5nIHBvcnQgZm9yIEhUVFAgdHJhZmZpYy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaHR0cCA9IGh0dHAgfHwgODA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgSFRUUFMgdHJhZmZpYy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaHR0cHMgPSBodHRwcyB8fCA0NDM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgV2ViIFNvY2tldCB0cmFmZmljLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53cyA9IHdzIHx8IDgwODI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXN0ZW5pbmcgcG9ydCBmb3IgU2VjdXJlIFdlYiBTb2NrZXQgdHJhZmZpYy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud3NzID0gd3NzIHx8IDgwODM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwb2xpY3kgdG8gZW5mb3JjZSBmb3IgSFRUUCB0cmFmZmljIHdoZW4gSFRUUFMgaXMgY29uZmlndXJlZC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5odHRwUG9saWN5fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5odHRwUG9saWN5ID0gaHR0cFBvbGljeSB8fCBFVldFQjIuaHR0cFBvbGljeS5ub25lO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdXBkYXRlIHNldHRpbmdzIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbFxuICAgICAqIHVwZGF0ZSBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt1cmw9JyddIFRoZSBVUkwgbG9jYXRpb24gb2YgdGhlIGRvd25sb2FkcyBpbmZvIGZpbGUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt0aW1lb3V0PTBdIFRoZSB0aW1lb3V0IGR1cmF0aW9uIGZvciByZXF1ZXN0aW5nIHRoZSBkb3dubG9hZHMgaW5mbyBmaWxlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VVcGRhdGVDb25maWd1cmF0aW9uID0gZnVuY3Rpb24odXJsLCB0aW1lb3V0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgVVJMIGxvY2F0aW9uIG9mIHRoZSBkb3dubG9hZHMgaW5mbyBmaWxlLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cmwgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRpbWVvdXQgZHVyYXRpb24gZm9yIHJlcXVlc3RpbmcgdGhlIGRvd25sb2FkcyBpbmZvIGZpbGUuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRpbWVvdXQgPSAwO1xuXG4gICAgICAgIGlmKHVybCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVybCA9IHVybDtcbiAgICAgICAgfVxuICAgICAgICBpZih0aW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGJhc2ljIHNlcnZpY2Ugc2V0dGluZ3MgY29uZmlndXJhdGlvbiBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsXG4gICAgICogYmFzaWMgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT1cIlwiXSBUaGUgZnJpZW5kbHkgbmFtZSBvZiB0aGUgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VybD1cIlwiXSBUaGUgZXh0ZXJuYWwgVVJMIGZvciB0aGUgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlUG9ydHNDb25maWd1cmF0aW9ufSBbcG9ydHM9bnVsbF0gVGhlIHBvcnRzIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2NzcmY9dHJ1ZV0gV2hldGhlciB0byBlbmFibGUgQ1NSRiBwcm90ZWN0aW9uIGZvciBzdGF0ZS1jaGFuZ2luZyBjYWxscy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2xvZ2luRXhwaXJhdGlvbj0zMF0gVGhlIG51bWJlciBvZiBkYXlzIGJlZm9yZSBhIHNhdmVkIGxvZ2luIGV4cGlyZXMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpbmFjdGl2aXR5VGltZW91dD0wXSBUaGUgZGVmYXVsdCBpbmFjdGl2aXR5IHRpbWVvdXQgdG8gdXNlIGlmIG5vdCBzZXQgKGRpc2FibGVkPTApLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2F1dG9jb21wbGV0ZT1mYWxzZV0gV2hldGhlciB0byBhbGxvdyBpbnB1dCBlbGVtZW50cyBpbiB3ZWIgc2VydmljZSBIVE1MIHRvIGF1dG9jb21wbGV0ZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtyZWxheT1mYWxzZV0gV2hldGhlciB0byBlbmFibGUgZXh0ZXJuYWwgcmVsYXkgVVJMLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VCYXNpY0NvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbihuYW1lLCB1cmwsIHBvcnRzLCBjc3JmLCBsb2dpbkV4cGlyYXRpb24sIGluYWN0aXZpdHlUaW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlLCByZWxheSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZyaWVuZGx5IG5hbWUgb2YgdGhlIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV4dGVybmFsIFVSTCBmb3IgdGhlIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVybCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcG9ydHMgY29uZmlndXJhdGlvbiBmb3IgdGhlIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmljZVBvcnRzQ29uZmlndXJhdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydHMgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRvIGVuYWJsZSBDU1JGIHByb3RlY3Rpb24gZm9yIHN0YXRlLWNoYW5naW5nIGNhbGxzLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3NyZiA9IHRydWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgZGF5cyBiZWZvcmUgYSBzYXZlZCBsb2dpbiBleHBpcmVzLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sb2dpbkV4cGlyYXRpb24gPSAzMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiBkYXlzIGJlZm9yZSBhIHNhdmVkIGxvZ2luIGV4cGlyZXMuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluYWN0aXZpdHlUaW1lb3V0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0byBhbGxvdyBpbnB1dCBlbGVtZW50cyBpbiB3ZWIgc2VydmljZSBIVE1MIHRvIGF1dG9jb21wbGV0ZS5cbiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZSA9IGF1dG9jb21wbGV0ZSB8fCBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0byBlbmFibGUgZXh0ZXJuYWwgcmVsYXkgVVJMLlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVsYXkgPSByZWxheSB8fCBmYWxzZTtcblxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodXJsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXJsID0gdXJsO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBvcnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydHMgPSBwb3J0cztcbiAgICAgICAgfVxuICAgICAgICBpZihjc3JmICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3NyZiA9IGNzcmY7XG4gICAgICAgIH1cbiAgICAgICAgaWYobG9naW5FeHBpcmF0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9naW5FeHBpcmF0aW9uID0gbG9naW5FeHBpcmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKGluYWN0aXZpdHlUaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5hY3Rpdml0eVRpbWVvdXQgPSBpbmFjdGl2aXR5VGltZW91dDtcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFuIGVudW0gZGVmaW5pbmcgdGhlIHR5cGVzIG9mIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIGF2YWlsYWJsZS5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbnRlcnByaXNlIE1hbmFnZXJcbiAgICAgICAgICovXG4gICAgICAgIGVzbTogMVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSBleHRlcm5hbCBhdXRoIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbCBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uIGFzc29jaWF0ZWRcbiAgICAgKiB3aXRoIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlc30gW3R5cGU9RVZXRUIyLlNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5ub25lXSBUaGUgdHlwZSBvZiBleHRlcm5hbFxuICAgICAqIGF1dGhlbnRpY2F0aW9uIGVuYWJsZWQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSBBbiBvYmplY3QgY29udGFpbmluZyB0aGUgYXV0aGVudGljYXRpb24tc3BlY2lmaWMgaW5mb3JtYXRpb24uXG4gICAgICogICAgRVZXRUIyLlNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5ub25lOiBObyBvcHRpb25zIGFyZSByZXF1aXJlZFxuICAgICAqICAgIEVWV0VCMi5TZXJ2aWNlRXh0ZXJuYWxBdXRoVHlwZXMuZXNtOiBSZXF1aXJlcyB0aGUgZm9sbG93aW5nIG9wdGlvbnNcbiAgICAgKiAgICAgICogb3B0aW9ucy51cmxcbiAgICAgKiAgICAgICogb3B0aW9ucy51c2VyXG4gICAgICogICAgICAqIG9wdGlvbnMucGFzc3dvcmRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMudXJsPScnXSBUaGUgVVJMIHRvIHRoZSBFU00gaW5zdGFuY2UgcHJvdmlkaW5nIGF1dGhlbnRpY2F0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy51c2VyPScnXSBUaGUgYWRtaW4gdXNlcm5hbWUgdG8gdGhlIEVTTSBpbnN0YW5jZSwgcHJvdmlkaW5nIGEgbWFzdGVyIHNlcnZlciBsaXN0IGFuZFxuICAgICAqICAgICAgcG93ZXIgdXNlciBwcm9jZXNzIGNyZWRlbnRpYWxzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5wYXNzd29yZD0nJ10gVGhlIGFkbWluIHBhc3N3b3JkIHRvIHRoZSBFU00gaW5zdGFuY2UsIHByb3ZpZGluZyBhIG1hc3RlciBzZXJ2ZXIgbGlzdFxuICAgICAqICAgICAgYW5kIHBvd2VyIHVzZXIgcHJvY2VzcyBjcmVkZW50aWFscy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlRXh0ZXJuYWxBdXRoQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKHR5cGUsIG9wdGlvbnMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIGVuYWJsZWQuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5zZXJ2aWNlRXh0ZXJuYWxBdXRoVHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IEVWV0VCMi5zZXJ2aWNlRXh0ZXJuYWxBdXRoVHlwZXMubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVybCB0byB0aGUgRVNNIGluc3RhbmNlIHdoZW4gdXNpbmcgRVNNIGF1dGhlbnRpY2F0aW9uICh7QGxpbmsgRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5lc219KS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVybCA9ICcnO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhZG1pbiB1c2VybmFtZSB0byB0aGUgRVNNIGluc3RhbmNlIHdoZW4gdXNpbmcgRVNNIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgICAqICh7QGxpbmsgRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5lc219KSwgcHJvdmlkaW5nIGEgbWFzdGVyIHNlcnZlciBsaXN0IGFuZCBwb3dlciB1c2VyIHByb2Nlc3NcbiAgICAgICAgICogY3JlZGVudGlhbHMuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51c2VyID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhZG1pbiBwYXNzd29yZCB0byB0aGUgRVNNIGluc3RhbmNlIHdoZW4gdXNpbmcgRVNNIGF1dGhlbnRpY2F0aW9uXG4gICAgICAgICAqICh7QGxpbmsgRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5lc219KSwgcHJvdmlkaW5nIGEgbWFzdGVyIHNlcnZlciBsaXN0IGFuZCBwb3dlciB1c2VyIHByb2Nlc3NcbiAgICAgICAgICogY3JlZGVudGlhbHMuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzd29yZCA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKG9wdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgdHlwZS1zcGVjaWZpYyBwcm9wZXJ0aWVzXG4gICAgICAgICAgICBpZih0aGlzLnR5cGUgPT09IEVWV0VCMi5zZXJ2aWNlRXh0ZXJuYWxBdXRoVHlwZXMuZXNtKSB7XG4gICAgICAgICAgICAgICAgaWYob3B0aW9ucy51cmwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVybCA9IG9wdGlvbnMudXJsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRpb25zLnVzZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXIgPSBvcHRpb25zLnVzZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKG9wdGlvbnMucGFzc3dvcmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhc3N3b3JkID0gb3B0aW9ucy5wYXNzd29yZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbiBvZiB0aGUgY29uZmlnIGFjY2VzcyByZXN0cmljdGlvbiBsZXZlbHMgdGhhdCBtYXkgYmUgZW5mb3JjZWQuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5jb25maWdBY2Nlc3NMZXZlbCA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsaWVudHMgZnJvbSBhbnkgcG9pbnQgaW4gdGhlIG5ldHdvcmsgbWF5IGFjY2VzcyB0aGUgY29uZmlnLlxuICAgICAgICAgKi9cbiAgICAgICAgYWxsOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzYWxsb3cgY29uZmlnIGFjY2VzcyB0byByZXF1ZXN0cyBjb21pbmcgb3ZlciB0aGUgcmVsYXkuXG4gICAgICAgICAqL1xuICAgICAgICBub1JlbGF5OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzYWxsb3cgY29uZmlnIGFjY2VzcyB0byByZXF1ZXN0cyBub3Qgb3ZlciB0aGUgbG9vcGJhY2sgZGV2aWNlLlxuICAgICAgICAgKi9cbiAgICAgICAgbG9jYWxob3N0T25seTogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYWRtaW4gY29uZmlndXJhdGlvbiBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsIGFkbWluIGNvbmZpZ3VyYXRpb25cbiAgICAgKiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VybmFtZSBUaGUgdXNlcm5hbWUgb2YgdGhlIGNvbmZpZ3VyYXRpb24gYWRtaW5pc3RyYXRpb24gYWNjb3VudC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bhc3N3b3JkPVwiXCJdIFRoZSBwYXNzd29yZCBvZiB0aGUgY29uZmlndXJhdGlvbiBhZG1pbmlzdHJhdGlvbiBhY2NvdW50LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmNvbmZpZ0FjY2Vzc0xldmVsfSBbYWNjZXNzTGV2ZWw9RVZXRUIyLmNvbmZpZ0FjY2Vzc0xldmVsLm5vUmVsYXldIFRoZSBsZXZlbCBvZlxuICAgICAqIGNvbmZpZyBhY2Nlc3MgcmVzdHJpY3Rpb24gdG8gYmUgYXBwbGllZC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlQWRtaW5Db25maWd1cmF0aW9uID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBhY2Nlc3NMZXZlbCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVzZXJuYW1lIG9mIHRoZSBjb25maWd1cmF0aW9uIGFkbWluaXN0cmF0aW9uIGFjY291bnQuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gdXNlcm5hbWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwYXNzd29yZCBvZiB0aGUgY29uZmlndXJhdGlvbiBhZG1pbmlzdHJhdGlvbiBhY2NvdW50LlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzd29yZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGV2ZWwgb2YgY29uZmlnIGFjY2VzcyByZXN0cmljdGlvbiBiZWluZyBlbmZvcmNlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5jb25maWdBY2Nlc3NMZXZlbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWNjZXNzTGV2ZWwgPSBFVldFQjIuY29uZmlnQWNjZXNzTGV2ZWwubm9SZWxheTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogREVQUkVDQVRFRC4gQ29udHJvbCBhY2Nlc3MgcmVzdHJpY3Rpb24gdmlhIHtAbGluayB0aGlzLmFjY2Vzc0xldmVsfSBpbnN0ZWFkLlxuICAgICAgICAgKiBXaGV0aGVyIHRvIHJlc3RyaWN0IGFjY2VzcyB0byB0aGUgc2VydmljZSBjb25maWd1cmF0aW9uIHRvIHJlcXVlc3RzIG9yaWdpbmF0aW5nIGZyb20gbG9jYWxob3N0LlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICogQGRlcHJlY2F0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9jYWxob3N0UmVzdHJpY3Rpb24gPSBmYWxzZTtcblxuICAgICAgICBpZihwYXNzd29yZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBhc3N3b3JkID0gcGFzc3dvcmQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY2Vzc0xldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYWNjZXNzTGV2ZWwgIT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgIHRoaXMuYWNjZXNzTGV2ZWwgPSBhY2Nlc3NMZXZlbDtcbiAgICAgICAgICAgICAgICB0aGlzLmxvY2FsaG9zdFJlc3RyaWN0aW9uID0gYWNjZXNzTGV2ZWwgPT09IEVWV0VCMi5jb25maWdBY2Nlc3NMZXZlbC5sb2NhbGhvc3RPbmx5O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBhY2NvdW50IGZvciBsZWdhY3kgdXNlcyBvZiBjb25zdHJ1Y3RvciB3aGVyZSAzcmQgcGFyYW0gd2FzIGJvb2wgbG9jYWxob3N0UmVzdHJpY3Rpb25cbiAgICAgICAgICAgICAgICB0aGlzLmxvY2FsaG9zdFJlc3RyaWN0aW9uID0gYWNjZXNzTGV2ZWw7XG4gICAgICAgICAgICAgICAgdGhpcy5hY2Nlc3NMZXZlbCA9IGFjY2Vzc0xldmVsID9cbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmNvbmZpZ0FjY2Vzc0xldmVsLmxvY2FsaG9zdE9ubHkgOlxuICAgICAgICAgICAgICAgICAgICBFVldFQjIuY29uZmlnQWNjZXNzTGV2ZWwubm9SZWxheTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgc2VydmljZSBjb25maWd1cmF0aW9uIG9iamVjdCBhY3RzIGFzIGEgd3JhcHBlciBmb3IgYWxsIHNlcnZpY2UgY29uZmlndXJhdGlvbiBtZXRob2RzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2V9IHNlcnZpY2UgVGhlIGNvbnRhaW5pbmcgc2VydmljZSBmb3IgdGhpcyBjb25maWd1cmF0aW9uLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VDb25maWcgPSBmdW5jdGlvbihzZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb250YWluaW5nIHNlcnZpY2UgZm9yIHRoaXMgY29uZmlndXJhdGlvbi5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlfVxuICAgICAgICAgKi8gXG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZmVyZW5jZSB0byB0aGUgc2VydmljZSBjb25maWd1cmF0aW9uIGF1dGggdG9rZW4uICBJZiBub3Qgc3BlY2lmaWVkLCBhbGwgY29uZmlndXJhdGlvblxuICAgICAgICAgKiBtZXRob2RzIHdpbGwgZmFpbC4gVGhpcyB2YWx1ZSBpcyBtb2RpZmllZCBieSB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcjZ2V0QXV0aG9yaXphdGlvbnxnZXRBdXRob3JpemF0aW9uKCl9XG4gICAgICAgICAqIGFuZCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcjZGVzdHJveUF1dGhvcml6YXRpb258ZGVzdHJveUF1dGhvcml6YXRpb24oKX0uXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd8bnVsbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXV0aFRva2VuID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ29uZmlndXJhdGlvbiBzdGF0dXMgaW5mb3JtYXRpb25cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlU3RhdHVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGF0dXMgPSBuZXcgRVZXRUIyLlNlcnZpY2VTdGF0dXModGhpcyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbnRlcnZhbCBkdXJhdGlvbiBmb3IgcG9sbGluZyBhdHRlbXB0cyBmb3IgZGV0ZXJtaW5pbmcgd2hlbiB0aGUgc2VydmljZSBoYXMgcmVzdGFydGVkLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHJlc3RhcnRQb2xsaW5nSW50ZXJ2YWwgPSAzMDAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIHBvbGwgYXR0ZW1wdHMgYmVmb3JlIHJldHVybmluZyBhbiBlcnJvciBvbiBzZXJ2aWNlIHJlc3RhcnQuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcmVzdGFydFBvbGxpbmdNYXhSZXRyaWVzID0gMTA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2Ygc3VjY2Vzc2Z1bCBzdWJzZXF1ZW50IHBvbGxzIGJlZm9yZSByZXR1cm5pbmcgYSBzdWNjZXNzIG9uIHNlcnZpY2UgcmVzdGFydC5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciByZXN0YXJ0UG9sbGluZ0NvbmZpcm1hdGlvbnNSZXF1aXJlZCA9IDU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1cGRhdGVkIHBvcnRzIHZhbHVlcy4gIFRoaXMgaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IHRoZSB3ZWIgc2VydmljZSdzIGxpc3RlbmluZyBwb3J0c1xuICAgICAgICAgKiBoYXZlIGNoYW5nZWQgYW5kIHVzZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLnJlc3RhcnR9IHRvIHByb3Blcmx5IHJlZGlyZWN0IHRvIHRoZSBuZXdcbiAgICAgICAgICogbG9jYXRpb24uXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmljZVBvcnRzQ29uZmlndXJhdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciB1cGRhdGVkUG9ydHMgPSBudWxsO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzZWQgdG8gaW5kaWNhdGUgdGhhdCB0aGUgd2ViIHNlcnZpY2UncyBTU0wgY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCBhbmQgaXMgdXNlZCBieVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcucmVzdGFydH0gdG8gcHJvcGVybHkgcmVkaXJlY3QgdG8gdGhlIG5ldyBsb2NhdGlvbiAocGFydGljdWxhcmx5XG4gICAgICAgICAqIHdoZW4gZGVsZXRpbmcgdGhlIFNTTCBjb25maWd1cmF0aW9uIGFuZCBzd2l0Y2hpbmcgZnJvbSBodHRwcyB0byBodHRwfS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge3N0cmluZ3x1bmRlZmluZWR9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgdXBkYXRlZFByb3RvY29sO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgYXV0aG9yaXphdGlvbiBjb2RlIGZvciBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uLiAgVGhlIHJlc3VsdCBvZiB0aGlzIGNhbGwgaXMgdXNlZCBieSBhbGwgbWV0aG9kc1xuICAgICAgICAgKiBpbiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWd9IGFuZCBtdXN0IGJlIHByb3ZpZGVkIGJlZm9yZSBhbnkgb3RoZXIgcmVxdWVzdHMgYXJlIG1hZGUuICBOb3RlOiB0aGUgZGVmYXVsdFxuICAgICAgICAgKiByZXF1ZXN0IG1ldGhvZCBmb3IgdGhpcyBmdW5jdGlvbiBpcyBQT1NULCB3aGljaCB3aWxsIG5vdCB3b3JrIGluIFhTUyBzaXR1YXRpb25zLiAgV2hpbGUgaXRzIHVzZSBpcyBub3RcbiAgICAgICAgICogcmVjb21tZW5kZWQsIHRoZSB1c2VHZXRSZXF1ZXN0IHBhcmFtZXRlciBzd2l0Y2hlcyB0aGUgdXNlIHRvIGEgR0VUIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgdGhlIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZ31cbiAgICAgICAgICogaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VybmFtZSBUaGUgYWRtaW5pc3RyYXRpb24gdXNlcm5hbWUgZm9yIHRoZSBzZXJ2aWNlXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXNzd29yZCBUaGUgYWRtaW5pc3RyYXRpb24gcGFzc3dvcmQgZm9yIHRoZSBzZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEF1dGhvcml6YXRpb24gPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG4gICAgXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uZmlnLmF1dGhUb2tlbiA9IGRhdGEuYXV0aDtcbiAgICBcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgYXV0aG9yaXphdGlvbiB0b2tlblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgY29uZmlnKTtcbiAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnVG9rZW4sXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB1OiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVzdHJveXMgdGhlIHN0b3JlZCBhdXRob3JpemF0aW9uIGNvZGUgcHJldmlvdXNseSByZXRyaWV2ZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBXaGlsZSBhdXRob3JpemF0aW9uIGNvZGVzIHdpbGwgZXhwaXJlIGFmdGVyIGEgc2V0IGR1cmF0aW9uLCBpdCBpcyByZWNvbW1lbmRlZCB0aGF0IGFsbCBhdXRob3JpemF0aW9uIGNvZGVzXG4gICAgICAgICAqIGFyZSBtYW51YWxseSBkZXN0cm95ZWQuICBOb3RlOiB0aGUgZGVmYXVsdCByZXF1ZXN0IG1ldGhvZCBmb3IgdGhpcyBmdW5jdGlvbiBpcyBQT1NULCB3aGljaCB3aWxsIG5vdCB3b3JrIGluXG4gICAgICAgICAqIFhTUyBzaXR1YXRpb25zLiAgV2hpbGUgaXRzIHVzZSBpcyBub3QgcmVjb21tZW5kZWQsIHRoZSB1c2VHZXRSZXF1ZXN0IHBhcmFtZXRlciBzd2l0Y2hlcyB0aGUgdXNlIHRvIGEgR0VUXG4gICAgICAgICAqIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgdGhlIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZ30gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRlc3Ryb3lBdXRob3JpemF0aW9uID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnTm8gYXV0aG9yaXphdGlvbiB0byBkZXN0cm95LicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uZmlnLmF1dGhUb2tlbiA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgY29uZmlnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdUb2tlbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBjb25maWd1cmF0aW9uIG9mIGFsbCBzZXJ2ZXJzIGNvbmZpZ3VyZWQgb24gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0byBcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuU2VydmljZVNlcnZlckNvbmZpZ3VyYXRpb259IGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U2VydmVycyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcbiAgICBcbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcbiAgICBcbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VydmVycyA9ICQubWFwKGRhdGEuc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJ2aWNlU2VydmVyQ29uZmlndXJhdGlvbihlbGVtZW50LmlkLCBlbGVtZW50LmFkZHJlc3MsIGVsZW1lbnQucG9ydCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGltZW91dCwgZWxlbWVudC5wYXNzdGhyb3VnaCwgZWxlbWVudC51c2VyLCBlbGVtZW50LnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsIGVsZW1lbnQucG93ZXJVc2VyLCBlbGVtZW50LnBvd2VyVXNlclVzZXJuYW1lLCBlbGVtZW50LnBvd2VyVXNlclBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5mcmllbmRseU5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2VydmVycyk7XG4gICAgICAgICAgICB9O1xuICAgIFxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1NlcnZlcnMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTsgICAgICAgICAgICBcbiAgICAgICAgfTsgICAgICAgIFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGRzIGEgc2VydmVyIGNvbmZpZ3VyYXRpb24gdG8gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGFjdGlvbiByZXF1aXJlcyBhIHJlc3RhcnQgdG8gYmVcbiAgICAgICAgICogYXBwbGllZCwgYW5kIHRoZSBhZGRlZCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VTZXJ2ZXJDb25maWd1cmF0aW9ufSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVNlcnZlckNvbmZpZ3VyYXRpb259IHNlcnZlciBUaGUgc2VydmVyIGNvbmZpZ3VyYXRpb24gdG8gYWRkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hZGRTZXJ2ZXIgPSBmdW5jdGlvbihjYWxsYmFjaywgc2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc2VydmVyLmlkID0gZGF0YS5pZDtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5yZXN0YXJ0LCBzZXJ2ZXIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1NlcnZlcnMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuLFxuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBzZXJ2ZXIuYWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogc2VydmVyLnBvcnQsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N0aHJvdWdoOiBzZXJ2ZXIucGFzc3Rocm91Z2gsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHNlcnZlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlcnZlci5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogc2VydmVyLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIHBvd2VyVXNlcjogc2VydmVyLnBvd2VyVXNlcixcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyVXNlcm5hbWU6IHNlcnZlci5wb3dlclVzZXJVc2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyUGFzc3dvcmQ6IHNlcnZlci5wb3dlclVzZXJQYXNzd29yZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGVzIGEgc2VydmVyIGNvbmZpZ3VyYXRpb24gb24gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGFjdGlvbiByZXF1aXJlcyBhIHJlc3RhcnQgdG8gYmVcbiAgICAgICAgICogYXBwbGllZCwgYW5kIHRoZSB1cGRhdGVkIHtAbGluayBFVldFQjIuU2VydmljZVNlcnZlckNvbmZpZ3VyYXRpb259IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlU2VydmVyQ29uZmlndXJhdGlvbn0gc2VydmVyIFRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbiB0byB1cGRhdGUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZVNlcnZlciA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXIpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2VydmVyKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdTZXJ2ZXJzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuLFxuICAgICAgICAgICAgICAgICAgICBpZDogc2VydmVyLmlkLFxuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBzZXJ2ZXIuYWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogc2VydmVyLnBvcnQsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N0aHJvdWdoOiBzZXJ2ZXIucGFzc3Rocm91Z2gsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHNlcnZlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlcnZlci5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogc2VydmVyLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIHBvd2VyVXNlcjogc2VydmVyLnBvd2VyVXNlcixcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyVXNlcm5hbWU6IHNlcnZlci5wb3dlclVzZXJVc2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyUGFzc3dvcmQ6IHNlcnZlci5wb3dlclVzZXJQYXNzd29yZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmVzIGEgc2VydmVyIGNvbmZpZ3VyYXRpb24gZnJvbSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoaXMgYWN0aW9uIHJlcXVpcmVzIGEgcmVzdGFydCB0byBiZVxuICAgICAgICAgKiBhcHBsaWVkLCBhbmQgdGhlIGRlbGV0ZWQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlU2VydmVyQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VTZXJ2ZXJDb25maWd1cmF0aW9ufSBzZXJ2ZXIgVGhlIHNlcnZlciBjb25maWd1cmF0aW9uIHRvIGRlbGV0ZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVsZXRlU2VydmVyID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNlcnZlcikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5yZXN0YXJ0LCBzZXJ2ZXIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1NlcnZlcnMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGlkOiBzZXJ2ZXIuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSW1wb3J0IGEgY2xpZW50J3MgWERWIGNvbmZpZ3VyYXRpb24uXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoaXMgYWN0aW9uIHJlcXVpcmVzIGEgcmVzdGFydCB0b1xuICAgICAgICAgKiBiZSBhcHBsaWVkLCBhbmQgYSBsaXN0IG9mIHtAbGluayBFVldFQjIuU2VydmljZVNlcnZlckNvbmZpZ3VyYXRpb259IGluc3RhbmNlcyBkZXRhaWxpbmcgdGhlIG5ldyBzZXJ2ZXJcbiAgICAgICAgICogY29uZmlndXJhdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd8Tm9kZX0geGR2RGF0YSBFaXRoZXIgdGhlIFhEViBkYXRhIHRvIGltcG9ydCBpbiBhIGJhc2UtNjQgZW5jb2RlZCBzdHJpbmcgZm9ybSBvciBhXG4gICAgICAgICAqIGpRdWVyeSBub2Rlc2V0IG9mIGFuIGZpbGUgaW5wdXQgcG9wdWxhdGVkIHdpdGggdGhlIHNlbGVjdGVkIFhEViBmaWxlLlxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtkYXRhSXNVcmw9ZmFsc2VdIFdoZXRoZXIgdGhlIHhkdkRhdGEgcGFyYW1ldGVyIGlzIGEgVVJMIHRvIHRoZSBYRFYgZGF0YS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW1wb3J0WGR2ID0gZnVuY3Rpb24oY2FsbGJhY2ssIHhkdkRhdGEsIGRhdGFJc1VybCkge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJzID0gJC5tYXAoZGF0YS5zZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlcnZpY2VTZXJ2ZXJDb25maWd1cmF0aW9uKGVsZW1lbnQuaWQsIGVsZW1lbnQuYWRkcmVzcywgZWxlbWVudC5wb3J0LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50aW1lb3V0LCBlbGVtZW50LnBhc3N0aHJvdWdoLCBlbGVtZW50LnVzZXIsIGVsZW1lbnQucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZWxlbWVudC5wb3dlclVzZXIsIGVsZW1lbnQucG93ZXJVc2VyVXNlcm5hbWUsIGVsZW1lbnQucG93ZXJVc2VyUGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLnJlc3RhcnQsIHNlcnZlcnMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoZGF0YUlzVXJsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhSXNVcmwgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKGRhdGFJc1VybCkge1xuICAgICAgICAgICAgICAgIGRhdGEudXJsID0geGR2RGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEuaW5pID0geGR2RGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoZGF0YS5pbmkgaW5zdGFuY2VvZiAkKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuaW50ZXJuYWwuWFNTUG9zdChzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1NlcnZlcnNYZHYsIGRhdGEpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9uR2V0U2VydmVyc1Jlc3BvbnNlID0gZnVuY3Rpb24ocmVzcG9uc2UsIHNlcnZlcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLCB0cnVlLCBzZXJ2ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlLmNvbmZpZy5nZXRTZXJ2ZXJzKG9uR2V0U2VydmVyc1Jlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnU2VydmVyc1hkdixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFeHBvcnQgdGhlIFhEViBmaWxlIGZvciB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCB0aGUgdGV4dCBjb250ZW50IG9mXG4gICAgICAgICAqIHRoZSBJTkkgZmlsZS4gIE5vdGU6IHRoZSB0ZXh0IGNvbnRlbnQgb2YgdGhlIElOSSBmaWxlIHdpbGwgb25seSBiZSByZXR1cm5lZCBpZlxuICAgICAgICAgKiBkb3dubG9hZE5hbWUgaXMgdW5kZWZpbmVkLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Rvd25sb2FkTmFtZV0gVGhlIGZpbGUgbmFtZSB0byBzcGVjaWZ5IGZvciB0aGUgcmF3IGJpbmFyeSBjb250ZW50LiAgSWZcbiAgICAgICAgICogdGhpcyB2YWx1ZSBpcyBzZXQsIHRoZSBYRFYgY29udGVudCB3aWxsIGJlIHJldHVybmVkIGFzIGEgYmluYXJ5IGZpbGUgd2l0aCB0aGVcbiAgICAgICAgICogQ29udGVudC1EaXNwb3NpdGlvbiBoZWFkZXIgc2V0IHRvIGF0dGFjaG1lbnQsIHByb21wdGluZyBhIGZpbGUgZG93bmxvYWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4cG9ydFhkdiA9IGZ1bmN0aW9uIChjYWxsYmFjaywgZG93bmxvYWROYW1lKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLmluaSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1NlcnZlcnNYZHY7XG5cbiAgICAgICAgICAgIGlmKGRvd25sb2FkTmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHdpbmRvdy5sb2NhdGlvbiB0byBwcm9tcHQgdGhlIGRvd25sb2FkLlxuICAgICAgICAgICAgICAgIGRhdGEuZmlsZW5hbWUgPSBkb3dubG9hZE5hbWU7XG4gICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gJC5tYXAoZGF0YSwgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ga2V5ICsgJz0nICsgdmFsdWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gdXJsICsgJz8nICsgcXVlcnkuam9pbignJicpO1xuICAgICAgICAgICAgICAgIG9uU3VjY2VzcyhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFNlbmQgdGhlIG5vcm1hbCByZXF1ZXN0XG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgY29uZmlndXJhdGlvbiBvZiBhbGwgcmVtb3RlIHNlcnZlcnMgY29uZmlndXJlZCBvbiB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VSZW1vdGVTZXJ2ZXJDb25maWd1cmF0aW9ufVxuICAgICAgICAgKiBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFJlbW90ZVNlcnZlcnMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG4gICAgXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlcnMgPSAkLm1hcChkYXRhLnJlbW90ZVNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VydmljZVJlbW90ZVNlcnZlckNvbmZpZ3VyYXRpb24oZWxlbWVudC5pZCwgZWxlbWVudC5pZGVudGlmaWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50aW1lb3V0LCBlbGVtZW50LnBhc3N0aHJvdWdoLCBlbGVtZW50LnVzZXIsIGVsZW1lbnQucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZWxlbWVudC5wb3dlclVzZXIsIGVsZW1lbnQucG93ZXJVc2VyVXNlcm5hbWUsIGVsZW1lbnQucG93ZXJVc2VyUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZyaWVuZGx5TmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXJ2ZXJzKTtcbiAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnUmVtb3RlU2VydmVycyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpOyAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGRzIGEgcmVtb3RlIHNlcnZlciBjb25maWd1cmF0aW9uIHRvIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhpcyBhY3Rpb24gcmVxdWlyZXMgYSByZXN0YXJ0IHRvIGJlXG4gICAgICAgICAqIGFwcGxpZWQsIGFuZCB0aGUgYWRkZWQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlUmVtb3RlU2VydmVyQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VSZW1vdGVTZXJ2ZXJDb25maWd1cmF0aW9ufSBzZXJ2ZXIgVGhlIHNlcnZlciBjb25maWd1cmF0aW9uIHRvIGFkZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWRkUmVtb3RlU2VydmVyID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNlcnZlcikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlcnZlci5pZCA9IGRhdGEuaWQ7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2VydmVyKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdSZW1vdGVTZXJ2ZXJzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogc2VydmVyLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N0aHJvdWdoOiBzZXJ2ZXIucGFzc3Rocm91Z2gsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHNlcnZlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlcnZlci5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogc2VydmVyLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIHBvd2VyVXNlcjogc2VydmVyLnBvd2VyVXNlcixcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyVXNlcm5hbWU6IHNlcnZlci5wb3dlclVzZXJVc2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyUGFzc3dvcmQ6IHNlcnZlci5wb3dlclVzZXJQYXNzd29yZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVcGRhdGVzIGEgcmVtb3RlIHNlcnZlciBjb25maWd1cmF0aW9uIG9uIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhpcyBhY3Rpb24gcmVxdWlyZXMgYSByZXN0YXJ0IHRvIGJlXG4gICAgICAgICAqIGFwcGxpZWQsIGFuZCB0aGUgdXBkYXRlZCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VSZW1vdGVTZXJ2ZXJDb25maWd1cmF0aW9ufSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVJlbW90ZVNlcnZlckNvbmZpZ3VyYXRpb259IHNlcnZlciBUaGUgc2VydmVyIGNvbmZpZ3VyYXRpb24gdG8gdXBkYXRlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cGRhdGVSZW1vdGVTZXJ2ZXIgPSBmdW5jdGlvbihjYWxsYmFjaywgc2VydmVyKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLnJlc3RhcnQsIHNlcnZlcik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnUmVtb3RlU2VydmVycyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHNlcnZlci5pZCxcbiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcjogc2VydmVyLmlkZW50aWZpZXIsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N0aHJvdWdoOiBzZXJ2ZXIucGFzc3Rocm91Z2gsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHNlcnZlci51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IHNlcnZlci5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogc2VydmVyLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIHBvd2VyVXNlcjogc2VydmVyLnBvd2VyVXNlcixcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyVXNlcm5hbWU6IHNlcnZlci5wb3dlclVzZXJVc2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcG93ZXJVc2VyUGFzc3dvcmQ6IHNlcnZlci5wb3dlclVzZXJQYXNzd29yZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpOyAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZW1vdmVzIGEgcmVtb3RlIHNlcnZlciBjb25maWd1cmF0aW9uIGZyb20gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGFjdGlvbiByZXF1aXJlcyBhIHJlc3RhcnQgdG8gYmVcbiAgICAgICAgICogYXBwbGllZCwgYW5kIHRoZSBkZWxldGVkIHtAbGluayBFVldFQjIuU2VydmljZVJlbW90ZVNlcnZlckNvbmZpZ3VyYXRpb259IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlUmVtb3RlU2VydmVyQ29uZmlndXJhdGlvbn0gc2VydmVyIFRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbiB0byBkZWxldGUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRlbGV0ZVJlbW90ZVNlcnZlciA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXIpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2VydmVyKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdSZW1vdGVTZXJ2ZXJzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuLFxuICAgICAgICAgICAgICAgICAgICBpZDogc2VydmVyLmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgc2V0dGluZ3MgZm9yIGhhbmRsaW5nIHJlbW90ZSBzZXJ2ZXJzIGluIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIHtAbGluayBFVldFQjIuU2VydmljZVJlbW90ZVNlcnZlclNldHRpbmdzQ29uZmlndXJhdGlvbn1cbiAgICAgICAgICogaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFJlbW90ZVNlcnZlcnNTZXR0aW5ncyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlUmVtb3RlU2VydmVyU2V0dGluZ3NDb25maWd1cmF0aW9uKGRhdGEuZW5hYmxlZCwgZGF0YS5wb3J0KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1JlbW90ZVNlcnZlcnNMaXN0ZW5lcixcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBsaWVzIHRoZSBzZXR0aW5ncyBmb3IgaGFuZGxpbmcgcmVtb3RlIHNlcnZlcnMgaW4gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGlzIGFjdGlvbiByZXF1aXJlcyBhIHJlc3RhcnQgdG8gYmVcbiAgICAgICAgICogYXBwbGllZCwgYW5kIHRoZSBhcHBsaWVkIHtAbGluayBFVldFQjIuU2VydmljZVJlbW90ZVNlcnZlclNldHRpbmdzQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VSZW1vdGVTZXJ2ZXJTZXR0aW5nc0NvbmZpZ3VyYXRpb259IHNldHRpbmdzIFRoZSByZW1vdGUgc2VydmVyIHNldHRpbmdzIHRvIGFwcGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRSZW1vdGVTZXJ2ZXJzU2V0dGluZ3MgPSBmdW5jdGlvbihjYWxsYmFjaywgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnUmVtb3RlU2VydmVyc0xpc3RlbmVyLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogc2V0dGluZ3MuZW5hYmxlZCxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogc2V0dGluZ3MucG9ydFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChyZXF1ZXN0LCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgbG9nZ2luZyBjb25maWd1cmF0aW9uIG9mIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuU2VydmljZUxvZ0ZpbGVDb25maWd1cmF0aW9ufSBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldExvZ2dpbmdTZXR0aW5ncyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlTG9nRmlsZUNvbmZpZ3VyYXRpb24oZGF0YS5pbnRlcnZhbCwgZGF0YS50eXBlLCBkYXRhLmNvdW50LCBkYXRhLmxldmVsKTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ0xvZ2dpbmcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQXBwbGllcyB0aGUgbG9nZ2luZyBjb25maWd1cmF0aW9uIGZvciB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoaXMgYWN0aW9uIHJlcXVpcmVzIGEgcmVzdGFydCB0byBiZVxuICAgICAgICAgKiBhcHBsaWVkLCBhbmQgdGhlIGFwcGxpZWQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlTG9nRmlsZUNvbmZpZ3VyYXRpb259IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlTG9nRmlsZUNvbmZpZ3VyYXRpb259IHNldHRpbmdzIFRoZSBsb2dnaW5nIHNldHRpbmdzIHRvIGFwcGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRMb2dnaW5nU2V0dGluZ3MgPSBmdW5jdGlvbihjYWxsYmFjaywgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnTG9nZ2luZyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGxldmVsOiBzZXR0aW5ncy5sZXZlbCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogc2V0dGluZ3MudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWw6IHNldHRpbmdzLmludGVydmFsLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogc2V0dGluZ3MuY291bnRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgocmVxdWVzdCwgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgdGhlIGxvZyBmaWxlIGZvciB0aGUgc2VydmljZVxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2YgbGluZXMgY29tcG9zaW5nIHRoZSBsb2cgZmlsZVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW251bWJlckxpbmVzXSBUaGUgbnVtYmVyIG9mIGxpbmVzIHRvIHJlcXVlc3QuICBUaGUgbGluZXMgcmV0dXJuZWQgd2lsbCBiZSB0aGUgbW9zdCByZWNlbnRcbiAgICAgICAgICogbGluZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldExvZyA9IGZ1bmN0aW9uIChjYWxsYmFjaywgbnVtYmVyTGluZXMpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEubG9nKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZihudW1iZXJMaW5lcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5saW5lcyA9IG51bWJlckxpbmVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnTG9nZ2luZ0ZpbGUsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGUgYSBVUkwgZm9yIGRvd25sb2FkaW5nIHRoZSBsb2cgZmlsZSBpbiB0ZXh0IGZvcm1hdC5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBVUkwgZm9yIHRoZSBsb2cgZmlsZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0TG9nRG93bmxvYWRVcmwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZih0aGlzLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdXJsID0gdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ0xvZ2dpbmdGaWxlO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBmb3JtYXQ6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICBkb3dubG9hZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhdXRoOiB0aGlzLmF1dGhUb2tlblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBnZXRTdHJpbmdQYXJhbXMgPSAkLm1hcChwYXJhbXMsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga2V5ICsgJz0nICsgdmFsdWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHVybCArPSAnPycgKyBnZXRTdHJpbmdQYXJhbXMuam9pbignJicpO1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FsbGJhY2sgaW52b2tlZCBieVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcjZ2V0QmFzaWNTZXR0aW5nc3xnZXRCYXNpY1NldHRpbmdzKCl9LlxuICAgICAgICAgKiBAY2FsbGJhY2sgRVZXRUIyLlNlcnZpY2VDb25maWd+b25HZXRCYXNpY1NldHRpbmdzXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBzdGF0dXMgU3VjY2VzcyBzdGF0ZSBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VCYXNpY0NvbmZpZ3VyYXRpb259IFtzZXR0aW5nc10gVGhlIHJldHJpZXZlZCBiYXNpYyBzZXR0aW5ncy5cbiAgICAgICAgICovXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGJhc2ljIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3Mgb2YgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB0aGUgc2VydmljZSB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcjYXV0aFRva2VufGF1dGggdG9rZW59IGlzIHNldCBieSBhXG4gICAgICAgICAqIGNhbGwgdG8ge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnI2dldEF1dGhvcml6YXRpb258Z2V0QXV0aG9yaXphdGlvbigpfS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZUNvbmZpZ35vbkdldEJhc2ljU2V0dGluZ3N9IGNhbGxiYWNrIENhbGxiYWNrIHRvIGJlIGludm9rZWQgb24gY29tcGxldGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0QmFzaWNTZXR0aW5ncyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBwb3J0cyA9IG5ldyBFVldFQjIuU2VydmljZVBvcnRzQ29uZmlndXJhdGlvbihkYXRhLnBvcnRzLmh0dHAsIGRhdGEucG9ydHMuaHR0cHMsIGRhdGEucG9ydHMud3MsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEucG9ydHMud3NzLCBkYXRhLnBvcnRzLmh0dHBQb2xpY3kpO1xuXG4gICAgICAgICAgICAgICAgLy8gTWFyayB0aGUgSFRUUCBwb3J0IGFzIGJlaW5nIHVwZGF0ZWQuXG4gICAgICAgICAgICAgICAgY29uZmlnLm1hcmtQb3J0c1VwZGF0ZWQocG9ydHMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlQmFzaWNDb25maWd1cmF0aW9uKGRhdGEubmFtZSwgZGF0YS51cmwsIHBvcnRzLCBkYXRhLmNzcmYsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEubG9naW5FeHBpcmF0aW9uLCBkYXRhLmluYWN0aXZpdHlUaW1lb3V0LCBkYXRhLmF1dG9jb21wbGV0ZSwgZGF0YS5yZWxheSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNldHRpbmdzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdCYXNpYyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsYmFjayBpbnZva2VkIGJ5XG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZyNzZXRCYXNpY1NldHRpbmdzfHNldEJhc2ljU2V0dGluZ3MoKX0uXG4gICAgICAgICAqIEBjYWxsYmFjayBFVldFQjIuU2VydmljZUNvbmZpZ35vblNldEJhc2ljU2V0dGluZ3NcbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuUmVzcG9uc2VTdGF0dXN9IHN0YXR1cyBTdWNjZXNzIHN0YXRlIG9mIHRoZSByZXNwb25zZS5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbcmVzdGFydF0gV2hldGhlciBhIHJlc3RhcnQgaXMgcmVxdWlyZWQuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VCYXNpY0NvbmZpZ3VyYXRpb259IFtzZXR0aW5nc10gVGhlIGFwcGxpZWQgc2V0dGluZ3MuXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBbcG9ydENvbmZsaWN0c10gQW55IHBvcnQgY29uZmxpY3RzLiBQcmVzZW50IG9ubHkgd2hlbiB0aGUgc3VibWl0dGVkIGNvbmZpZyBjb250YWluZWQgYVxuICAgICAgICAgKiBjb25maWd1cmF0aW9uIHdpdGggcG9ydHMgdGhhdCB3ZXJlIGRldGVjdGVkIGFzIGluLXVzZSBieSBvdGhlciBhcHBsaWNhdGlvbnMgb24gdGhlIHN5c3RlbS5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBwb3J0Q29uZmxpY3RzLmh0dHAgV2hldGhlciB0aGUgcHJvdmlkZWQgSFRUUCBwb3J0IGNvdWxkIG5vdCBiZSBzZXQgZHVlIHRvIGNvbmZsaWN0LlxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHBvcnRDb25mbGljdHMuaHR0cHMgV2hldGhlciB0aGUgcHJvdmlkZWQgSFRUUFMgcG9ydCBjb3VsZCBub3QgYmUgc2V0IGR1ZSB0byBjb25mbGljdC5cbiAgICAgICAgICovXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBsaWVzIHRoZSBiYXNpYyBjb25maWd1cmF0aW9uIHNldHRpbmdzIGZvciB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHRoZSBzZXJ2aWNlIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZyNhdXRoVG9rZW58YXV0aCB0b2tlbn0gaXMgc2V0IGJ5IGFcbiAgICAgICAgICogY2FsbCB0byB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcjZ2V0QXV0aG9yaXphdGlvbnxnZXRBdXRob3JpemF0aW9uKCl9LlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlQ29uZmlnfm9uU2V0QmFzaWNTZXR0aW5nc30gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCBvbiBjb21wbGV0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlQmFzaWNDb25maWd1cmF0aW9ufSBzZXR0aW5ncyBUaGUgYmFzaWMgc2V0dGluZ3MgdG8gYXBwbHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNldEJhc2ljU2V0dGluZ3MgPSBmdW5jdGlvbihjYWxsYmFjaywgc2V0dGluZ3MpIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSwgZGF0YS5yZXN0YXJ0LCBzZXR0aW5ncywgZGF0YS5jb25mbGljdHMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIE1hcmsgdGhlIEhUVFAgcG9ydCBhcyBiZWluZyB1cGRhdGVkLlxuICAgICAgICAgICAgICAgIGNvbmZpZy5tYXJrUG9ydHNVcGRhdGVkKHNldHRpbmdzLnBvcnRzKTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5yZXN0YXJ0LCBzZXR0aW5ncyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdCYXNpYyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHNldHRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2V0dGluZ3MudXJsLFxuICAgICAgICAgICAgICAgICAgICBodHRwOiBzZXR0aW5ncy5wb3J0cy5odHRwLFxuICAgICAgICAgICAgICAgICAgICBodHRwczogc2V0dGluZ3MucG9ydHMuaHR0cHMsXG4gICAgICAgICAgICAgICAgICAgIHdzOiBzZXR0aW5ncy5wb3J0cy53cyxcbiAgICAgICAgICAgICAgICAgICAgd3NzOiBzZXR0aW5ncy5wb3J0cy53c3MsXG4gICAgICAgICAgICAgICAgICAgIGNzcmY6IHNldHRpbmdzLmNzcmYsXG4gICAgICAgICAgICAgICAgICAgIGxvZ2luRXhwaXJhdGlvbjogc2V0dGluZ3MubG9naW5FeHBpcmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBpbmFjdGl2aXR5VGltZW91dDogc2V0dGluZ3MuaW5hY3Rpdml0eVRpbWVvdXQsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogc2V0dGluZ3MuYXV0b2NvbXBsZXRlLFxuICAgICAgICAgICAgICAgICAgICByZWxheTogc2V0dGluZ3MucmVsYXksXG4gICAgICAgICAgICAgICAgICAgIGh0dHBQb2xpY3k6IHNldHRpbmdzLnBvcnRzLmh0dHBQb2xpY3lcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgocmVxdWVzdCwgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIHVwZGF0ZSBjb25maWd1cmF0aW9uIHNldHRpbmdzIG9mIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG8gXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhblxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4ge0BsaW5rIEVWV0VCMi5TZXJ2aWNlVXBkYXRlQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFVwZGF0ZVNldHRpbmdzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlVXBkYXRlQ29uZmlndXJhdGlvbihkYXRhLnVybCwgZGF0YS50aW1lb3V0KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1VwZGF0ZXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTsgICAgICAgICAgICBcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBsaWVzIHRoZSB1cGRhdGUgY29uZmlndXJhdGlvbiBzZXR0aW5ncyBmb3IgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0byBcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhpcyBhY3Rpb24gcmVxdWlyZXMgYSByZXN0YXJ0IHRvIGJlIFxuICAgICAgICAgKiBhcHBsaWVkLCBhbmQgdGhlIGFwcGxpZWQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlVXBkYXRlQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VVcGRhdGVDb25maWd1cmF0aW9ufSBzZXR0aW5ncyBUaGUgdXBkYXRlIHNldHRpbmdzIHRvIGFwcGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRVcGRhdGVTZXR0aW5ncyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXR0aW5ncykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEucmVzdGFydCwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnVXBkYXRlcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIHVybDogc2V0dGluZ3MudXJsLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiBzZXR0aW5ncy50aW1lb3V0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHJlcXVlc3QsIGNvbmZpZy5zZXJ2aWNlKTsgICAgICAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3Mgb2YgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0byBcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuU2VydmljZUV4dGVybmFsQXV0aENvbmZpZ3VyYXRpb259XG4gICAgICAgICAqIGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RXh0ZXJuYWxBdXRoU2V0dGluZ3MgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgIGlmKGRhdGEudHlwZSA9PT0gRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5lc20pIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51cmwgPSBkYXRhLnVybDtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51c2VyID0gZGF0YS51c2VybmFtZTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wYXNzd29yZCA9IGRhdGEucGFzc3dvcmQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlRXh0ZXJuYWxBdXRoQ29uZmlndXJhdGlvbihkYXRhLnR5cGUsIG9wdGlvbnMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXR0aW5ncyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnRXh0ZXJuYWxBdXRoLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7ICAgICAgICAgICAgICAgIFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFwcGxpZXMgdGhlIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MgZm9yIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG8gXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoaXMgYWN0aW9uIHJlcXVpcmVzIGEgcmVzdGFydCB0byBiZSBcbiAgICAgICAgICogYXBwbGllZCwgYW5kIHRoZSBhcHBsaWVkIHtAbGluayBFVldFQjIuU2VydmljZUV4dGVybmFsQXV0aENvbmZpZ3VyYXRpb259IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlRXh0ZXJuYWxBdXRoQ29uZmlndXJhdGlvbn0gc2V0dGluZ3MgVGhlIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIHNldHRpbmdzIHRvIGFwcGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRFeHRlcm5hbEF1dGhTZXR0aW5ncyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXR0aW5ncykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgIGlmKGRhdGEudHlwZSA9PT0gRVZXRUIyLnNlcnZpY2VFeHRlcm5hbEF1dGhUeXBlcy5lc20pIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51cmwgPSBkYXRhLnVybDtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy51c2VybmFtZSA9IGRhdGEudXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRXJhc2UgdGhlIHBhc3N3b3JkIHNvIHRoYXQgaXQgaXMgbm8gbG9uZ2VyIHN0b3JlZC5cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5wYXNzd29yZCA9ICcnO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLnJlc3RhcnQsIHNldHRpbmdzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgdHlwZTogc2V0dGluZ3MudHlwZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT09IEVWV0VCMi5zZXJ2aWNlRXh0ZXJuYWxBdXRoVHlwZXMuZXNtKSB7XG4gICAgICAgICAgICAgICAgZGF0YS51cmwgPSBzZXR0aW5ncy51cmw7XG4gICAgICAgICAgICAgICAgZGF0YS51c2VybmFtZSA9IHNldHRpbmdzLnVzZXI7XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5wYXNzd29yZCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wYXNzd29yZCA9IHNldHRpbmdzLnBhc3N3b3JkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlQ29uZmlnRXh0ZXJuYWxBdXRoLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChyZXF1ZXN0LCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG4gICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgYWRtaW4gY29uZmlndXJhdGlvbiBzZXR0aW5ncyBvZiB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCByZXF1aXJlcyB0aGF0IHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5hdXRofSBpcyBzZXQgYnkgYSBjYWxsIHRvIFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIE5vdGU6IFRoaXMgcmVxdWVzdCB3aWxsIG5vdCBwb3B1bGF0ZSB7QGxpbmsgRVZXRUIyLlNlcnZpY2VBZG1pbkNvbmZpZ3VyYXRpb24ucGFzc3dvcmR9LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIHtAbGluayBFVldFQjIuU2VydmljZUFkbWluQ29uZmlndXJhdGlvbn0gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEFkbWluU2V0dGluZ3MgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBhY2Nlc3NMZXZlbCA9IGRhdGEuYWNjZXNzTGV2ZWw7XG4gICAgICAgICAgICAgICAgaWYgKGFjY2Vzc0xldmVsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gb2xkZXIgc2VydmljZXMgd2lsbCBwcmVzZW50IGxvY2FsaG9zdFJlc3RyaWN0aW9uLCB0aGUgY29uc3RydWN0b3Igd2lsbCBoYW5kbGUgZWl0aGVyXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc0xldmVsID0gZGF0YS5sb2NhbGhvc3RSZXN0cmljdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gbmV3IEVWV0VCMi5TZXJ2aWNlQWRtaW5Db25maWd1cmF0aW9uKGRhdGEudXNlcm5hbWUsIHVuZGVmaW5lZCwgYWNjZXNzTGV2ZWwpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXR0aW5ncyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25maWdBZG1pbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChyZXF1ZXN0LCBjb25maWcuc2VydmljZSk7ICAgICAgICAgICAgICAgIFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFwcGxpZXMgdGhlIGV4dGVybmFsIGF1dGhlbnRpY2F0aW9uIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MgZm9yIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG8gXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogTm90ZTogSWYge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQWRtaW5Db25maWd1cmF0aW9uLnBhc3N3b3JkfSBpcyBhbiBlbXB0eSBzdHJpbmcgKHRoZSBkZWZhdWx0IHZhbHVlKSwgXG4gICAgICAgICAqIHRoZSBwYXNzd29yZCB3aWxsIG5vdCBiZSBjaGFuZ2VkLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhpcyBhY3Rpb24gcmVxdWlyZXMgYSByZXN0YXJ0IHRvIGJlIFxuICAgICAgICAgKiBhcHBsaWVkLCBhbmQgdGhlIGFwcGxpZWQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQWRtaW5Db25maWd1cmF0aW9ufSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZUFkbWluQ29uZmlndXJhdGlvbn0gc2V0dGluZ3MgVGhlIGFkbWluIHNldHRpbmdzIHRvIGFwcGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRBZG1pblNldHRpbmdzID0gZnVuY3Rpb24oY2FsbGJhY2ssIHNldHRpbmdzKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEVyYXNlIHRoZSBwYXNzd29yZCBzbyB0aGF0IGl0IGlzIG5vIGxvbmdlciBzdG9yZWQuXG4gICAgICAgICAgICAgICAgc2V0dGluZ3MucGFzc3dvcmQgPSAnJztcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5yZXN0YXJ0LCBzZXR0aW5ncyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuLFxuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBzZXR0aW5ncy51c2VybmFtZSxcbiAgICAgICAgICAgICAgICAvLyBkZXByZWNhdGVkLCBidXQgb2xkZXIgc2VydmljZXMgd2lsbCBzdGlsbCBiZSBsb29raW5nIGZvciBpdFxuICAgICAgICAgICAgICAgIGxvY2FsaG9zdFJlc3RyaWN0aW9uOiBzZXR0aW5ncy5sb2NhbGhvc3RSZXN0cmljdGlvbixcbiAgICAgICAgICAgICAgICBhY2Nlc3NMZXZlbDogc2V0dGluZ3MuYWNjZXNzTGV2ZWxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wYXNzd29yZCAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnBhc3N3b3JkID0gc2V0dGluZ3MucGFzc3dvcmQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ0FkbWluLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChyZXF1ZXN0LCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcmtzIHRoZSBIVFRQIHBvcnQgYXMgYmVpbmcgdXBkYXRlZCBleHRlcm5hbGx5IHRvIGFsbG93IGZvciB7QGxpbmsgRVZXRUIyLlNlcnZpY2UucmVzdGFydH1cbiAgICAgICAgICogdG8gcHJvcGVybHkgcmVkaXJlY3QuICBUaGlzIG1ldGhvZCBpcyBwcm92aWRlZCBleGNsdXNpdmVseSBmb3IgZGVwcmVjYXRlZCBtZXRob2RzLCBpbiBwYXJ0aWN1bGFyLFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2Uuc2V0Q29uZmlndXJhdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VQb3J0c0NvbmZpZ3VyYXRpb259IHBvcnRzIFRoZSB1cGRhdGVkIHBvcnRzIGNvbmZpZ3VyYXRpb24uXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hcmtQb3J0c1VwZGF0ZWQgPSBmdW5jdGlvbihwb3J0cykge1xuICAgICAgICAgICAgdXBkYXRlZFBvcnRzID0gcG9ydHM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc3RhcnQgdGhlIHdlYiBzZXJ2aWNlLiAgVGhpcyBpcyBnZW5lcmFsbHkgcGVyZm9ybWVkIGFmdGVyIHVwZGF0aW5nIHRoZSBjb25maWd1cmF0aW9uLCBhcyB0aGUgY2hhbmdlcyB3aWxsXG4gICAgICAgICAqIG5vdCBiZSBhcHBsaWVkIHVudGlsIHRoZSB3ZWIgc2VydmljZSBpcyByZXN0YXJ0ZWQuICBOb3RlOiBSZXN0YXJ0aW5nIHRoZSB3ZWIgc2VydmljZSBpcyBub3QgYW4gaW5zdGFudGFuZW91c1xuICAgICAgICAgKiBwcm9jZXNzLS1hZnRlciBjYWxsaW5nIHRoaXMgbWV0aG9kLCB0aGUgd2ViIHNlcnZpY2Ugd2lsbCBiZSB1bnJlYWNoYWJsZSBmb3IgYSBzbWFsbCBhbW91bnQgb2YgdGltZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmdldEF1dGhvcml6YXRpb259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgY29weSBvZiB0aGUge0BsaW5rIEVWV0VCMi5TZXJ2aWNlfSBpbnN0YW5jZSwgYW5kIGEgQm9vbGVhblxuICAgICAgICAgKiBmbGFnIGluZGljYXRpbmcgaWYgdGhlIHNlcnZpY2UgcmVzdGFydCB3YXMgY29uZmlybWVkLlxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjb25maXJtPVRydWVdIEZsYWcgdG8gY29uZmlybSB0aGUgcmVzdGFydCB3YXMgc3VjY2Vzc2Z1bC4gSWYgc2V0IHRvIGZhbHNlIHRoaXNcbiAgICAgICAgICogZnVuY3Rpb24gd2lsbCBub3QgYXR0ZW1wdCB0byB2ZXJpZnkgdGhlIHNlcnZpY2UgaXMgYmFjayB1cCBhbmQgcnVubmluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVzdGFydCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb25maXJtKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKGNvbmZpcm0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbmZpcm0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKGRhdGEueHNzUG9zdCkge1xuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiBUaGlzIHNob3VsZCBwb2xsLCBsaWtlIHRoZSBkZWZhdWx0IGJlaGF2aW9yLCBhZnRlciBhIHNob3J0IHRpbWVvdXQgaW5zdGVhZCBvZlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgcmV0dXJuaW5nLlxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2VuZCBhIHN1Y2Nlc3NmdWwgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2VydmljZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcG9ydCBoYXMgY2hhbmdlZCwgdXBkYXRlIHRoZSBVUkwgYXMgbmVjZXNzYXJ5LlxuICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjtcbiAgICAgICAgICAgICAgICBpZih1cGRhdGVkUG9ydHMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb3RvY29sSHR0cCA9IGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cDonIHx8IHVwZGF0ZWRQcm90b2NvbCA9PT0gJ2h0dHAnO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdFBvcnQgPSBwcm90b2NvbEh0dHAgPyA4MCA6IDQ0MztcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1BvcnQgPSBwcm90b2NvbEh0dHAgPyB1cGRhdGVkUG9ydHMuaHR0cCA6IHVwZGF0ZWRQb3J0cy5odHRwcztcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbmV3VXJsID0gc2VydmljZS5ob3N0VXJsO1xuICAgICAgICAgICAgICAgICAgICBpZihuZXdVcmwgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdVcmwgPSBsb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyBsb2NhdGlvbi5ob3N0bmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGxvY2F0aW9uLnBvcnQgIT09ICcnICYmIGxvY2F0aW9uLnBvcnQgIT09IGRlZmF1bHRQb3J0LnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdVcmwgKz0gJzonICsgbG9jYXRpb24ucG9ydDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1VybCArPSAnLyc7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBuZXdVcmwgPSBuZXdVcmwucmVwbGFjZSgvKDpcXGQrKT9bXFwvXT8kLywgJycpO1xuICAgICAgICAgICAgICAgICAgICBpZihuZXdQb3J0ICE9PSBkZWZhdWx0UG9ydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXJsICs9ICc6JyArIG5ld1BvcnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGJhY2sgdGhlIHRyYWlsaW5nIHNsYXNoXG4gICAgICAgICAgICAgICAgICAgIG5ld1VybCArPSAnLyc7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uZmlnLnNlcnZpY2UuaG9zdFVybCA9IG5ld1VybDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonICYmIHVwZGF0ZWRQcm90b2NvbCAhPT0gdW5kZWZpbmVkICYmIHVwZGF0ZWRQcm90b2NvbCAhPT0gJ2h0dHBzJykge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB1c2VyIGlzIGFscmVhZHkgdXNpbmcgaHR0cHMgYW5kIG5ldmVyIGNhbGxzIGdldC9zZXQvZGVsZXRlIHNzbCB0aGVuIHVwZGF0ZWRQcm90b2NvbCBpc1xuICAgICAgICAgICAgICAgICAgICAvLyB1bmRlZmluZWQgYW5kIHdlIGtlZXAgdGhlIGN1cnJlbnQgcHJvdG9jb2xcbiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGlmIHRoZSB1c2VyIGhhcyBtYWRlIGEgY2hhbmdlIHRvIHRoZSBTU0wgY29uZmlndXJhdGlvbiBpdCBpcyB0cmFja2VkIGluIGdldC9zZXQvZGVsZXRlXG4gICAgICAgICAgICAgICAgICAgIC8vIGFuZCBpZiB3ZSBoYXZlIGZhbGxlbiBpbnRvIGhlcmUgdGhlbiB0aGV5IGFyZSBjdXJyZW50bHkgdXNpbmcgaHR0cHMgYW5kIGFmdGVyIGEgcmVzdGFydFxuICAgICAgICAgICAgICAgICAgICAvLyBodHRwcyB3aWxsIG5vIGxvbmdlciBiZSB2YWxpZFxuICAgICAgICAgICAgICAgICAgICBjb25maWcuc2VydmljZS5ob3N0VXJsID0gY29uZmlnLnNlcnZpY2UuaG9zdFVybC5yZXBsYWNlKCdodHRwcycsICdodHRwJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgcmV0dXJuLiBXZSBjYW5ub3QgY29uZmlybSBpbiB0aGlzIGluc3RhbmNlLCBpdCB3aWxsIGJlIGJsb2NrZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gaW4gYnJvd3NlcnMgd2l0aCBhIE1peGVkLUNvbnRlbnQgZXJyb3IuXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoY29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCBwb2xsaW5nIHRvIHNlZSB3aGVuIHRoZSBzZXJ2aWNlIGlzIGJhY2sgdXBcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwubm90aWZ5T25TZXJ2aWNlUmVzdGFydChjYWxsYmFjaywgY29uZmlnLnNlcnZpY2UsIHJlc3RhcnRQb2xsaW5nSW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN0YXJ0UG9sbGluZ01heFJldHJpZXMsIHJlc3RhcnRQb2xsaW5nQ29uZmlybWF0aW9uc1JlcXVpcmVkKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLCBjb25maWcuc2VydmljZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdyZXN0YXJ0J1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlLCB0cnVlKTtcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVja3MgaWYgdXBkYXRlcyBhcmUgYXZhaWxhYmxlIGZvciB0aGUgc2VydmljZS5cbiAgICAgICAgICogTm90ZTogVGhpcyByZXF1ZXN0IHJlcXVpcmVzIHRoYXQge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnLmF1dGh9IGlzIHNldCBieSBhIGNhbGwgdG8gXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUNvbmZpZy5nZXRBdXRob3JpemF0aW9ufS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VVcGRhdGV9IGluc3RhbmNlcy5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVwZGF0ZXNGaWxlVXJsIFRoZSBVUkwgb2YgdGhlIHVwZGF0ZXMgZmlsZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jaGVja0ZvclVwZGF0ZXMgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHVwZGF0ZXNGaWxlVXJsKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuICAgIFxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlc0xpc3QgPSAkLm1hcChkYXRhLnVwZGF0ZV9pbmZvLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpc1JlY29tbWVuZGVkID0gZWxlbWVudC51cGRhdGVfdHlwZSA9PT0gXCJSZWNvbW1lbmRlZFwiO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJ2aWNlVXBkYXRlKHNlcnZpY2UsIGVsZW1lbnQudmVyc2lvbiwgZWxlbWVudC5saW5rLCBpc1JlY29tbWVuZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50b3RhbF9maWxlX3NpemUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdXBkYXRlc0xpc3QpO1xuICAgICAgICAgICAgfTtcbiAgICBcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2UsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBjb25maWcuYXV0aFRva2VuLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICd1cGRhdGVjaGVjaycsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZXNfZmlsZTogdXBkYXRlc0ZpbGVVcmxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgIFxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTsgICAgICAgICAgICBcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGxpc3Qgb2YgZGlzY292ZXJlZCBzZXJ2ZXJzLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHJlcXVlc3QgcmVxdWlyZXMgdGhhdCB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuYXV0aH0gaXMgc2V0IGJ5IGEgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VDb25maWcuZ2V0QXV0aG9yaXphdGlvbn0uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5EaXNjb3ZlcnlTZXJ2ZXJ9IGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RGlzY292ZXJlZFNlcnZlcnMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBkaXNjb3Zlcnkgc2VydmVyIGluc3RhbmNlc1xuICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXJzID0gJC5tYXAoZGF0YS5zZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkRpc2NvdmVyeVNlcnZlcihlbGVtZW50LmFkZHJlc3MsIGVsZW1lbnQucG9ydCwgZWxlbWVudC5uYW1lLCBlbGVtZW50Lm1hY0FkZHJlc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lm1vZGVsLCBlbGVtZW50LnNlcmlhbCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNlcnZlcnMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZURpc2NvdmVyeSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlIHRoZSB0eXBlIG9mIFNTTCBjb25maWd1cmF0aW9uIChpZiBhbnkpIGN1cnJlbnRseSBjb25maWd1cmVkLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGFuZCBhbiB7QGxpbmsgRVZXRUIyLnNzbENvbmZpZ1R5cGV9XG4gICAgICAgICAqIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTU0xDb25maWdUeXBlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpLCBFVldFQjIudXRpbC5nZXRFcnJvckNvZGUoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCwgZGF0YS5lcnJvckNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS50eXBlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VTU0xDb25maWdUeXBlLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlIHRoZSBhY3RpdmUgRXh0ZXJuYWwgU1NMIGNvbmZpZ3VyYXRpb24gKGlmIGN1cnJlbnRseSBjb25maWd1cmVkKS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhbmQgYW4ge0VWV0VCMi5FeHRlcm5hbFNTTENvbmZpZ31cbiAgICAgICAgICogaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEV4dGVybmFsU1NMQ29uZmlnID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihjb25maWcuYXV0aFRva2VuID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gYXV0aG9yaXphdGlvbi4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpLCBFVldFQjIudXRpbC5nZXRFcnJvckNvZGUoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCwgZGF0YS5lcnJvckNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciBleHBpcmF0aW9uID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGRhdGEuc3NsQ29uZmlnLmV4cGlyZXMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGVuYWJsZWQgPSBkYXRhLnNzbENvbmZpZy5lbmFibGVkO1xuICAgICAgICAgICAgICAgIHZhciBiYXNpY0NvbmZpZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKGVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFzaWNDb25maWcgPSBuZXcgRVZXRUIyLkJhc2ljU1NMQ29uZmlnKGRhdGEuc3NsQ29uZmlnLmNvbW1vbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNzbENvbmZpZy5kb21haW5zLCBkYXRhLnNzbENvbmZpZy52YWxpZCwgZXhwaXJhdGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBzc2wgYXMgYSB2YWxpZCBwcm90b2NvbFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkUHJvdG9jb2wgPSAnaHR0cHMnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZXh0ZXJuYWxDb25maWcgPSBuZXcgRVZXRUIyLkV4dGVybmFsU1NMQ29uZmlnKGVuYWJsZWQsIGJhc2ljQ29uZmlnKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGV4dGVybmFsQ29uZmlnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VTU0xFeHRlcm5hbENvbmZpZyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZSB0aGUgYWN0aXZlIEFDTUUgU1NMIGNvbmZpZ3VyYXRpb24gKGlmIGN1cnJlbnRseSBjb25maWd1cmVkKS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhbmQgYW4ge0VWV0VCMi5BY21lU1NMQ29uZmlnfVxuICAgICAgICAgKiBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0QWNtZVNTTENvbmZpZyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JDb2RlKHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQsIGRhdGEuZXJyb3JDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgZXhwaXJhdGlvbiA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShkYXRhLnNzbENvbmZpZy5leHBpcmVzKTtcbiAgICAgICAgICAgICAgICB2YXIgZW5hYmxlZCA9IGRhdGEuc3NsQ29uZmlnLmVuYWJsZWQ7XG4gICAgICAgICAgICAgICAgdmFyIGJhc2ljQ29uZmlnID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAoZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICBiYXNpY0NvbmZpZyA9IG5ldyBFVldFQjIuQmFzaWNTU0xDb25maWcoZGF0YS5zc2xDb25maWcuY29tbW9uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3NsQ29uZmlnLmRvbWFpbnMsIGRhdGEuc3NsQ29uZmlnLnZhbGlkLCBleHBpcmF0aW9uKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBtYXJrIHNzbCBhcyBhIHZhbGlkIHByb3RvY29sXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRQcm90b2NvbCA9ICdodHRwcyc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGFjbWVDb25maWcgPSBuZXcgRVZXRUIyLkFjbWVTU0xDb25maWcoZW5hYmxlZCwgYmFzaWNDb25maWcsIGRhdGEuYXV0b1JlbmV3LCBkYXRhLmFjbWVTZXJ2ZXIpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgYWNtZUNvbmZpZyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlU1NMQWNtZUNvbmZpZyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEltcG9ydCBhIHByaXZhdGUga2V5IGFuZCBjZXJ0aWZpY2F0ZSBvYnRhaW5lZCBmcm9tIGFuIGV4dGVybmFsIENBIGFuZCBjb25maWd1cmUgdGhlIHNlcnZpY2Unc1xuICAgICAgICAgKiB3ZWIgc2VydmVyIHRvIHVzZSB0aGVtLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXNcbiAgICAgICAgICogcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYSByZXN0YXJ0IGlzIHJlcXVpcmVkXG4gICAgICAgICAqIGZvciB0aGUgY2hhbmdlIHRvIGJlIGFwcGxpZWRcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHByaXZhdGVLZXkgVGhlIHByaXZhdGUga2V5IHRvIGltcG9ydCBhcyBhIGJhc2UtNjQgZW5jb2RlZCBzdHJpbmdcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGNlcnRpZmljYXRlIGtleSBUaGUgY2VydGlmaWNhdGUgdG8gaW1wb3J0IGFzIGEgYmFzZS02NCBlbmNvZGVkIHN0cmluZ1xuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2NlcnRpZmljYXRlQ2hhaW49dW5kZWZpbmVkXSBBbnkgYWRkaXRpb25hbCBpbnRlcm1lZGlhdGUgY2VydGlmaWNhdGUgYXV0aG9yaXRpZXMgZW5jb2RlZFxuICAgICAgICAgKiBhcyBhIGJhc2UtNjQgc3RyaW5nLiBTZXBhcmF0ZSBjaGFpbiBmaWxlcyBhcmUgb2Jzb2xldGUgYW5kIGFueSBpbnRlcm1lZGlhdGUgQ0EgaXNcbiAgICAgICAgICogdXN1YWxseSBwYXJ0IG9mIHRoZSBjZXJ0aWZpY2F0ZSBpdHNlbGYuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbmZpZ3VyZUV4dFNTTCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBwcml2YXRlS2V5LCBjZXJ0aWZpY2F0ZSwgY2VydGlmaWNhdGVDaGFpbikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhociksIEVWV0VCMi51dGlsLmdldEVycm9yQ29kZSh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0LCBkYXRhLmVycm9yQ29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gbWFyayBzc2wgYXMgYSB2YWxpZCBwcm90b2NvbFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRQcm90b2NvbCA9ICdodHRwcyc7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLnJlc3RhcnQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICBwcml2YXRlS2V5OiBwcml2YXRlS2V5LFxuICAgICAgICAgICAgICAgIGNlcnRpZmljYXRlOiBjZXJ0aWZpY2F0ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGNlcnRpZmljYXRlQ2hhaW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRhdGEuY2hhaW4gPSBjZXJ0aWZpY2F0ZUNoYWluO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlU1NMRXh0ZXJuYWxDb25maWcsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbmZpZ3VyZSB0aGUgc2VydmljZSdzIHdlYiBzZXJ2ZXIgdG8gb2J0YWluIGEgY2VydGlmaWNhdGUgYXV0b21hdGljYWxseSBmcm9tIGFuIEFDTUUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXNcbiAgICAgICAgICogcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGFuZCBhIHtTdHJpbmd9IHRva2VuIHRvIGNoZWNrIHRoZSBzdGF0dXMgb2YgdGhlXG4gICAgICAgICAqIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZG9tYWluPXVuZGVmaW5lZF0gVGhlIGRvbWFpbiBuYW1lIHRvIHJlcXVlc3QgYSBjZXJ0aWZpY2F0ZSBmb3IuIFRoaXMgd2lsbCBiZVxuICAgICAgICAgKiB0aGUgQ29tbW9uIE5hbWUgKENOKSBvZiB0aGUgY2VydGlmaWNhdGUuIElmIGxlZnQgdW5kZWZpbmVkIHRoZSBzZXJ2aWNlIHdpbGwgYXR0ZW1wdCB0byB1c2UgdGhlXG4gICAgICAgICAqIHNlcnZpY2UgZXh0ZXJuYWwgVVJMLlxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFthdXRvUmVuZXc9dHJ1ZV0gRmxhZyBpbmRpY2F0aW5nIGlmIHRoZSBjZXJ0aWZpY2F0ZSBzaG91bGQgYmUgYXV0b21hdGljYWxseSByZW5ld2VkLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBbc2Fucz1bXV0gQSBsaXN0IG9mIFguNTA5IFN1YmplY3QgQWx0ZXJuYXRpdmUgTmFtZXMgKFNBTlMpIHRvIHJlcXVlc3QgaW4gYWRkaXRpb25cbiAgICAgICAgICogdG8gdGhlIENOIChDb21tb24gTmFtZSkuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbYWNtZVNlcnZlcj11bmRlZmluZWRdIFRoZSBBQ01FIHNlcnZlciB0byByZXF1ZXN0IGEgY2VydGlmaWNhdGUgZnJvbSwgdGhpcyBkZWZhdWx0c1xuICAgICAgICAgKiB0byB0aGUgcHJvZHVjdGlvbiBMZXQncyBFbmNyeXB0IFNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtwcml2YXRlS2V5PXVuZGVmaW5lZF0gVGhlIHByaXZhdGUga2V5IHRvIHVzZSB3aXRoIHRoZSBjZXJ0aWZpY2F0ZSAob25lIHdpbGwgYmVcbiAgICAgICAgICogZ2VuZXJhdGVkIGlmIG5vdCBwcm92aWRlZCkgYXMgYSBiYXNlLTY0IGVuY29kZWQgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGtleSBkYXRhLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb25maWd1cmVBY21lU1NMID0gZnVuY3Rpb24oY2FsbGJhY2ssIGRvbWFpbiwgYXV0b1JlbmV3LCBzYW5zLCBhY21lU2VydmVyLCBwcml2YXRlS2V5KSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JDb2RlKHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQsIGRhdGEuZXJyb3JDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRhdGEudG9rZW4pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICBhdXRvUmVuZXc6IGF1dG9SZW5ldyAhPT0gdW5kZWZpbmVkID8gYXV0b1JlbmV3IDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGRvbWFpbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5kb21haW4gPSBkb21haW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYWNtZVNlcnZlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5hY21lU2VydmVyID0gYWNtZVNlcnZlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHByaXZhdGVLZXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGRhdGEucHJpdmF0ZUtleSA9IHByaXZhdGVLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChzYW5zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnNhbnMgPSBzYW5zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogY29uZmlnLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlU1NMQWNtZUNvbmZpZyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb2xsIHRoZSBzdGF0dXMgb2YgYW4gb25nb2luZyByZXF1ZXN0IHRvIGlzc3VlIGEgY2VydGlmaWNhdGUgZnJvbSBhbiBBQ01FIHNlcnZlci4gVGhpcyBtYXkgbmVlZFxuICAgICAgICAgKiB0byBiZSBjYWxsZWQgbXVsdGlwbGUgdGltZXMgdW50aWwgdGhlIHN0YXR1cyBpcyBubyBsb25nZXIgcGVuZGluZy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIGFcbiAgICAgICAgICogcmVzdGFydCBpcyByZXF1aXJlZCBmb3IgdGhlIGNoYW5nZSB0byBiZSBhcHBsaWVkLCBhbmQgYSB7RVZXRUIyLmFjbWVTU0xSZXF1ZXN0U3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHRva2VuIFRoZSB0b2tlbiBwcm92aWRlZCBieSB0aGUgY29uZmlndXJlIGNhbGwgdG8gY2hlY2sgdGhlIHN0YXR1cyBvZiByZXF1ZXN0aW5nXG4gICAgICAgICAqIGEgY2VydGlmaWNhdGUgZnJvbSB0aGUgQUNNRSBzZXJ2ZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoZWNrQWNtZVNTTFN0YXR1cyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB0b2tlbikge1xuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhociksIEVWV0VCMi51dGlsLmdldEVycm9yQ29kZSh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0LCBkYXRhLmVycm9yQ29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3RhcnQgPSBkYXRhLnJlc3RhcnQgIT09IHVuZGVmaW5lZCA/IGRhdGEucmVzdGFydCA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gRVZXRUIyLmFjbWVTU0xSZXF1ZXN0U3RhdHVzLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFyayBzc2wgYXMgYSB2YWxpZCBwcm90b2NvbFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVkUHJvdG9jb2wgPSAnaHR0cHMnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHJlc3RhcnQsIGRhdGEuc3RhdHVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VTU0xBY21lU3RhdHVzLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRva2VuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcblxuICAgICAgICB9O1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlbGV0ZSB0aGUgY3VycmVudGx5IGNvbmZpZ3VyZWQgU1NMIGNvbmZpZ3VyYXRpb24gaW5jbHVkaW5nIGFueSBjZXJ0aWZpY2F0ZXMgYW5kIHByaXZhdGUga2V5cy5cbiAgICAgICAgICogVGhpcyB3aWxsIGFsc28gZGlzYWJsZSBTU0wgaWYgaXQgaXMgY3VycmVudGx5IGVuYWJsZWQgYW5kIGNvbmZpZ3VyZWQgc2V0dGluZyB0aGUgY29uZmlndXJhdGlvblxuICAgICAgICAgKiB0byB7QGxpbmsgc3NsQ29uZmlnVHlwZS5ub25lfVxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYVxuICAgICAgICAgKiByZXN0YXJ0IGlzIHJlcXVpcmVkIGZvciB0aGUgY2hhbmdlIHRvIGJlIGFwcGxpZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRlbGV0ZVNTTENvbmZpZyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JDb2RlKHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQsIGRhdGEuZXJyb3JDb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBtYXJrIHNzbCBhcyBubyBsb25nZXIgdmFsaWRcbiAgICAgICAgICAgICAgICB1cGRhdGVkUHJvdG9jb2wgPSAnaHR0cCc7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdGFydCA9IGRhdGEucmVzdGFydCAhPT0gdW5kZWZpbmVkID8gZGF0YS5yZXN0YXJ0IDogZmFsc2U7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCByZXN0YXJ0KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VTU0xDb25maWdUeXBlLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG5cbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVzdG9yZSB0aGUgd2ViIHNlcnZpY2UgdG8gdGhlIGZhY3RvcnkgZGVmYXVsdCBzZXR0aW5ncy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIGEgcmVzdGFydCBpc1xuICAgICAgICAgKiByZXF1aXJlZC5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbZXhjbHVkZVBvcnRzPWZhbHNlXSBXaGV0aGVyIG9yIG5vdCB0aGUgY29uZmlndXJlZCBwb3J0cyBzaG91bGQgYmUga2VwdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVzdG9yZURlZmF1bHRzID0gZnVuY3Rpb24oY2FsbGJhY2ssIGV4Y2x1ZGVQb3J0cykge1xuICAgICAgICAgICAgZXhjbHVkZVBvcnRzID0gZXhjbHVkZVBvcnRzIHx8IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuYXV0aFRva2VuKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJykpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdGF0dXMsIGRhdGEucmVzdGFydCwgZGF0YS5jb25mbGljdHMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB1cGRhdGVkUHJvdG9jb2wgPSAnaHR0cCc7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3RhdHVzLCBkYXRhLnJlc3RhcnQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZVJlc3RvcmVEZWZhdWx0cyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYXV0aDogdGhpcy5hdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVQb3J0czogZXhjbHVkZVBvcnRzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG4gICAgfTtcbn0oKSk7XG4iLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlIG9mIHBhc3N0aHJvdWdoIGVycm9yc1xuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGRlcHJlY2F0ZWQgVGhpcyBlbnVtIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBmdXR1cmUgdmVyc2lvbnMuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuc2VydmVyUGFzc3Rocm91Z2hFcnJvcnMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTG9naW4gZXJyb3JcbiAgICAgICAgICovXG4gICAgICAgIGxvZ2luRXJyb3I6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb25uZWN0aW9uIEVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBjb25uZWN0RXJyb3I6IDJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCB3aXRoIGhlYWx0aCBpbmZvcm1hdGlvbiBmb3IgaW5kaXZpZHVhbCBzZXJ2ZXJzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbc2VydmVySUQ9LTFdIFRoZSBzZXJ2ZXIgaWQgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW251bUNvbXByZXNzZWQ9MF0gVGhlIHRvdGFsIG51bWJlciBvZiBjb21wcmVzc2VkIHN0cmVhbXMgYmVpbmcgcHJvY2Vzc2VkLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbnVtVW5jb21wcmVzc2VkPTBdIFRoZSB0b3RhbCBudW1iZXIgb2YgdW5jb21wcmVzc2VkICh0cmFuc2NvZGVkKSBzdHJlYW1zIGJlaW5nIHByb2Nlc3NlZC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG9iamVjdCBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gZnV0dXJlIHZlcnNpb25zLlxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZlckhlYWx0aFN0cmVhbUluZm8gPSBmdW5jdGlvbihzZXJ2ZXJJRCwgbnVtQ29tcHJlc3NlZCwgbnVtVW5jb21wcmVzc2VkKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGlkIG9mIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlcklEID0gLTE7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0b3RhbCBudW1iZXIgb2YgY29tcHJlc3NlZCBzdHJlYW1zIGJlaW5nIHByb2Nlc3NlZC5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubnVtQ29tcHJlc3NlZCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0b3RhbCBudW1iZXIgb2YgdW5jb21wcmVzc2VkICh0cmFuc2NvZGVkKSBzdHJlYW1zIGJlaW5nIHByb2Nlc3NlZC5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubnVtVW5jb21wcmVzc2VkID0gMDtcbiAgICAgICAgXG4gICAgICAgIGlmKHNlcnZlcklEICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVySUQgPSBzZXJ2ZXJJRDtcbiAgICAgICAgfVxuICAgICAgICBpZihudW1Db21wcmVzc2VkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubnVtQ29tcHJlc3NlZCA9IG51bUNvbXByZXNzZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYobnVtVW5jb21wcmVzc2VkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubnVtVW5jb21wcmVzc2VkID0gbnVtVW5jb21wcmVzc2VkO1xuICAgICAgICB9XG4gICAgfTsgICAgXG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgb2JqZWN0IGZvciBzdHJlYW1zIGJlaW5nIHByb2Nlc3NlZCBieSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtudW1Db21wcmVzc2VkPTBdIFRoZSB0b3RhbCBudW1iZXIgb2YgY29tcHJlc3NlZCBzdHJlYW1zIGJlaW5nIHByb2Nlc3NlZC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW251bVVuY29tcHJlc3NlZD0wXSBUaGUgdG90YWwgbnVtYmVyIG9mIHVuY29tcHJlc3NlZCAodHJhbnNjb2RlZCkgc3RyZWFtcyBiZWluZyBwcm9jZXNzZWQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZUhlYWx0aFN0cmVhbUluZm8gPSBmdW5jdGlvbihudW1Db21wcmVzc2VkLCBudW1VbmNvbXByZXNzZWQpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIG51bWJlciBvZiBjb21wcmVzc2VkIHN0cmVhbXMgYmVpbmcgcHJvY2Vzc2VkLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5udW1Db21wcmVzc2VkID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIG51bWJlciBvZiB1bmNvbXByZXNzZWQgKHRyYW5zY29kZWQpIHN0cmVhbXMgYmVpbmcgcHJvY2Vzc2VkLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5udW1VbmNvbXByZXNzZWQgPSAwO1xuICAgICAgICBcbiAgICAgICAgaWYobnVtQ29tcHJlc3NlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm51bUNvbXByZXNzZWQgPSBudW1Db21wcmVzc2VkO1xuICAgICAgICB9XG4gICAgICAgIGlmKG51bVVuY29tcHJlc3NlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm51bVVuY29tcHJlc3NlZCA9IG51bVVuY29tcHJlc3NlZDtcbiAgICAgICAgfVxuICAgIH07ICAgIFxuICAgIFxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3Qgd2l0aCBoZWFsdGggaW5mb3JtYXRpb24gZm9yIGluZGl2aWR1YWwgc2VydmVycy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3NlcnZlcklEPS0xXSBUaGUgc2VydmVyIGlkIG9mIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZXJ2ZXJBZGRyZXNzPScnXSBUaGUgYWRkcmVzcy9ob3N0bmFtZSBvZiB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbGl2ZUNvbm5lY3Rpb25zPTBdIFRoZSBjdXJyZW50IG51bWJlciBvZiBzZXJ2ZXIgY29ubmVjdGlvbnMgcmVsYXRlZCB0byBsaXZlIHZpZGVvLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbc2VhcmNoQ29ubmVjdGlvbnM9MF0gVGhlIGN1cnJlbnQgbnVtYmVyIG9mIHNlcnZlciBjb25uZWN0aW9ucyByZWxhdGVkIHRvIHZpZGVvIHNlYXJjaC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZXJ2ZXJQYXNzdGhyb3VnaEVycm9yc30gW3Bhc3N0aHJvdWdoRXJyb3I9RVZXRUIyLnNlcnZlclBhc3N0aHJvdWdoRXJyb3JzLm5vbmVdIFRoZSBlcnJvciBjb2RlIFxuICAgICAqIHNldCBpZiBhbnkgcGFzc3Rocm91Z2ggZXJyb3JzIGFyZSBwcmVzZW50LCAwIGlmIHRoZXJlIGFyZSBubyBwYXNzdGhyb3VnaCBlcnJvcnMgb3IgdGhlIHNlcnZlciBpcyBub3Qgc2V0dXAgdG8gXG4gICAgICogdXNlIHBhc3N0aHJvdWdoIGNyZWRlbnRpYWxzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nW119IFt1c2Vycz1bXV0gVGhlIGxpc3Qgb2YgdXNlcnMgY3VycmVudGx5IGFjY2Vzc2luZyB0aGlzIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJIZWFsdGhTdHJlYW1JbmZvfSBbc3RyZWFtcz1udWxsXSBUaGUgYWN0aXZlIHZpZGVvIHN0cmVhbSBpbmZvcm1hdGlvbiBmb3IgdGhlIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG9iamVjdCBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gZnV0dXJlIHZlcnNpb25zLlxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZlckhlYWx0aCA9IGZ1bmN0aW9uKHNlcnZlcklELCBzZXJ2ZXJBZGRyZXNzLCBsaXZlQ29ubmVjdGlvbnMsIHNlYXJjaENvbm5lY3Rpb25zLCBwYXNzdGhyb3VnaEVycm9yLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnMsIHN0cmVhbXMpe1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVuaXF1ZSBzZXJ2ZXIgSUQgdXNlZCBieSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlcklEID0gLTE7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJUCBhZGRyZXNzIG9yIGhvc3RuYW1lIChpZiBhdmFpbGFibGUpIG9mIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlckFkZHJlc3MgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGN1cnJlbnQgbnVtYmVyIG9mIHNlcnZlciBjb25uZWN0aW9ucyBvcGVuIGJ5IHRoZSB3ZWIgc2VydmljZSByZWxhdGVkIHRvIGxpdmUgdmlkZW8uXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxpdmVDb25uZWN0aW9ucyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjdXJyZW50IG51bWJlciBvZiBzZXJ2ZXIgY29ubmVjdGlvbnMgb3BlbiBieSB0aGUgd2ViIHNlcnZpY2UgcmVsYXRlZCB0byB2aWRlbyBzZWFyY2guXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlYXJjaENvbm5lY3Rpb25zID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogT25lIG9mIHRoZSBlbnVtIHZhbHVlcyBkZWZpbmVkIGJ5IHtAbGluayBFVldFQjIuc2VydmVyUGFzc3Rocm91Z2hFcnJvcnN9IGluZGljYXRpbmdcbiAgICAgICAgICogdGhlIHN0YXR1cyBvZiBhbnkgZXJyb3JzIHJlbGF0ZWQgdG8gcGFzc3Rocm91Z2ggY29ubmVjdGlvbnMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuc2VydmVyUGFzc3Rocm91Z2hFcnJvcnN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhc3N0aHJvdWdoRXJyb3IgPSBFVldFQjIuc2VydmVyUGFzc3Rocm91Z2hFcnJvcnMubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxpc3Qgb2YgdXNlcnMgY3VycmVudGx5IGFjY2Vzc2luZyB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ1tdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51c2VycyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYWN0aXZlIHZpZGVvIHN0cmVhbSBpbmZvcm1hdGlvbiBmb3IgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJIZWFsdGhTdHJlYW1JbmZvfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdHJlYW1zID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmVySUQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJJRCA9IHNlcnZlcklEO1xuICAgICAgICB9XG4gICAgICAgIGlmKHNlcnZlckFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJBZGRyZXNzID0gc2VydmVyQWRkcmVzcztcbiAgICAgICAgfVxuICAgICAgICBpZihsaXZlQ29ubmVjdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5saXZlQ29ubmVjdGlvbnMgPSBsaXZlQ29ubmVjdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2VhcmNoQ29ubmVjdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2hDb25uZWN0aW9ucyA9IHNlYXJjaENvbm5lY3Rpb25zO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBhc3N0aHJvdWdoRXJyb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wYXNzdGhyb3VnaEVycm9yID0gcGFzc3Rocm91Z2hFcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZih1c2VycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXJzID0gdXNlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3RyZWFtcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0cmVhbXMgPSBzdHJlYW1zO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgY29udGFpbmVyIG9iamVjdCBmb3Igc2VydmljZSB2ZXJzaW9uIGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgbW9yZSBpbmZvIHRoYW4gdGhlIGJhc2ljXG4gICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlLnZlcnNpb259IGNhbGwuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt2ZXJzaW9uPScnXSBUaGUgdmVyc2lvbiBudW1iZXIgb2YgdGhlIHNlcnZpY2UuICBUaGlzIHZhbHVlIGlzIGlkZW50aWNhbCB0b1xuICAgICAqIHRoYXQgcmV0dXJuZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2aWNlLnZlcnNpb259LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZXZhcGlWZXJzaW9uPScnXSBUaGUgdmVyc2lvbiBvZiBldkFQSSB1c2VkIGJ5IHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3dlYlNlcnZlclZlcnNpb249JyddIFRoZSB2ZXJzaW9uIG9mIHRoZSB3ZWIgc2VydmVyIHVzZWQgYnkgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VIZWFsdGhWZXJzaW9uSW5mbyA9IGZ1bmN0aW9uICh2ZXJzaW9uLCBldmFwaVZlcnNpb24sIHdlYlNlcnZlclZlcnNpb24pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2ZXJzaW9uIG51bWJlciBvZiB0aGUgc2VydmljZS4gIFRoaXMgdmFsdWUgaXMgaWRlbnRpY2FsIHRvIHRoYXQgcmV0dXJuZWQgYnlcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlLnZlcnNpb259LlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52ZXJzaW9uID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2ZXJzaW9uIG9mIGV2QVBJIHVzZWQgYnkgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmFwaVZlcnNpb24gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHZlcnNpb24gb2YgdGhlIHdlYiBzZXJ2ZXIgdXNlZCBieSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndlYlNlcnZlclZlcnNpb24gPSAnJztcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHZlcnNpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGV2YXBpVmVyc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmV2YXBpVmVyc2lvbiA9IGV2YXBpVmVyc2lvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHdlYlNlcnZlclZlcnNpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy53ZWJTZXJ2ZXJWZXJzaW9uID0gd2ViU2VydmVyVmVyc2lvbjtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgIC8qKlxuICAgICogQSBjb250YWluZXIgb2JqZWN0IGZvciBzZXJ2aWNlIE9TIGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgbW9yZSBpbmZvIHRoYW4gdGhlIGJhc2ljXG4gICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2UudmVyc2lvbn0gY2FsbC5cbiAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc3lzdGVtPScnXSBUaGUgbmFtZSBvZiB0aGUgaG9zdCBPUy5cbiAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcmVsZWFzZT0nJ10gVGhlIHJlbGVhc2UgbnVtYmVyIG9mIHRoZSBob3N0IE9TLlxuICAgICogQHBhcmFtIHtTdHJpbmd9IFt2ZXJzaW9uPScnXSBUaGUgdmVyc2lvbiBudW1iZXIgb2YgdGhlIGhvc3QgT1MuXG4gICAgKiBAcGFyYW0ge1N0cmluZ30gW21hY2hpbmU9JyddIFRoZSBtYWNoaW5lIHR5cGUgb2YgdGhlIGhvc3QgbWFjaGluZS5cbiAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcHJvY2Vzc29yPScnXSBUaGUgcHJvY2Vzc29yIHR5cGUgb2YgdGhlIGhvc3QgbWFjaGluZS5cbiAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbm9kZT0nJ10gVGhlIGhvc3QgbWFjaGluZSdzIG5ldHdvcmsgbmFtZS5cbiAgICAqIEBjbGFzc1xuICAgICogQGNvbnN0cnVjdG9yXG4gICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VIZWFsdGhPc0luZm8gPSBmdW5jdGlvbiAoc3lzdGVtLCByZWxlYXNlLCB2ZXJzaW9uLCBtYWNoaW5lLCBwcm9jZXNzb3IsIG5vZGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBob3N0IE9TLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zeXN0ZW0gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHJlbGVhc2UgbnVtYmVyIG9mIHRoZSBob3N0IE9TLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZWxlYXNlID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2ZXJzaW9uIG51bWJlciBvZiB0aGUgaG9zdCBPUy5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmVyc2lvbiA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWFjaGluZSB0eXBlIG9mIHRoZSBob3N0IG1hY2hpbmUuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hY2hpbmUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHByb2Nlc3NvciB0eXBlIG9mIHRoZSBob3N0IG1hY2hpbmUuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnByb2Nlc3NvciA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaG9zdCBtYWNoaW5lJ3MgbmV0d29yayBuYW1lLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ub2RlID0gJyc7XG5cblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHN5c3RlbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN5c3RlbSA9IHN5c3RlbTtcbiAgICAgICAgfVxuICAgICAgICBpZihyZWxlYXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVsZWFzZSA9IHJlbGVhc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYodmVyc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1hY2hpbmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tYWNoaW5lID0gbWFjaGluZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwcm9jZXNzb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzb3IgPSBwcm9jZXNzb3I7XG4gICAgICAgIH1cbiAgICAgICAgaWYobm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgY29udGFpbmVyIG9iamVjdCBmb3Igc2VydmljZSBwcm9jZXNzIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIG5hbWUgb2YgdGhlIHByb2Nlc3MuXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtjcHU9MF0gVGhlIHBlcmNlbnRhZ2Ugb2YgQ1BVIGNvbnN1bWVkIGJ5IHRoZSBwcm9jZXNzLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBbcmFtPTBdIFRoZSBhbW91bnQgb2YgUkFNIGNvbnN1bWVkIGJ5IHRoZSBwcm9jZXNzLCBpbiBieXRlcy5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW3NlcnZlcklkPW51bGxdIFRoZSBhc3NvY2lhdGVkIHNlcnZlciBJRCwgaWYgYW55LlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VIZWFsdGhQcm9jZXNzSW5mbyA9IGZ1bmN0aW9uIChuYW1lLCBjcHUsIHJhbSwgc2VydmVySWQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9jZXNzLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwZXJjZW50YWdlIG9mIENQVSBjb25zdW1lZCBieSB0aGUgcHJvY2Vzcy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3B1ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFtb3VudCBvZiBSQU0gY29uc3VtZWQgYnkgdGhlIHByb2Nlc3MsIGluIGJ5dGVzLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yYW0gPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXNzb2NpYXRlZCBzZXJ2ZXIgSUQsIGlmIGFueS5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICogQGRlcHJlY2F0ZWQgVGhpcyB2YWx1ZSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIG5vIGxvbmdlciBiZSBzdXBwb3J0ZWQgaW4gZnV0dXJlIHZlcnNpb25zLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXJJZCA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY3B1ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3B1ID0gY3B1O1xuICAgICAgICB9XG4gICAgICAgIGlmKHJhbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJhbSA9IHJhbTtcbiAgICAgICAgfVxuICAgICAgICBpZihzZXJ2ZXJJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlcklkID0gc2VydmVySWQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQSBjb250YWluZXIgb2JqZWN0IGZvciBzZXJ2aWNlIHN5c3RlbSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2NvcmVzPTBdIFRoZSB0b3RhbCBudW1iZXIgb2YgQ1BVIGNvcmVzIGluIHRoZSBzeXN0ZW0uXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFt0b3RhbE1lbW9yeT0wXSBUaGUgdG90YWwgcGh5c2ljYWwgc2VydmljZSBtZW1vcnkgaW4gYnl0ZXNcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gW2F2YWlsYWJsZU1lbW9yeT0wXSBUaGUgYXZhaWxhYmxlIHNlcnZpY2UgbWVtb3J5IGluIGJ5dGVzXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IFtjcHU9MF0gVGhlIHRvdGFsIENQVSB1c2FnZSBvZiB0aGUgc3lzdGVtIGFzIGEgcGVyY2VudGFnZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlSGVhbHRoU3lzdGVtSW5mbyA9IGZ1bmN0aW9uIChjb3JlcywgdG90YWxNZW1vcnksIGF2YWlsYWJsZU1lbW9yeSwgY3B1KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdG90YWwgbnVtYmVyIG9mIENQVSBjb3JlcyBpbiB0aGUgc3lzdGVtLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb3JlcyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0b3RhbCBhbW91bnQgb2YgbWVtb3J5IGluIHRoZSBzeXN0ZW0sIGluIGJ5dGVzLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3RhbE1lbW9yeSA9IDA7XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF2YWlsYWJsZSBtZW1vcnkgaW4gdGhlIHN5c3RlbSwgaW4gYnl0ZXMuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF2YWlsYWJsZU1lbW9yeSA9IDA7XG4gICAgICAgIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIENQVSB1c2FnZSBvZiB0aGUgc3lzdGVtIGFzIGEgcGVyY2VudGFnZS5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3B1ID0gMDtcbiAgICAgICAgXG4gICAgICAgIGlmKGNvcmVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29yZXMgPSBjb3JlcztcbiAgICAgICAgfVxuICAgICAgICBpZih0b3RhbE1lbW9yeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRvdGFsTWVtb3J5ID0gdG90YWxNZW1vcnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYXZhaWxhYmxlTWVtb3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlTWVtb3J5ID0gYXZhaWxhYmxlTWVtb3J5O1xuICAgICAgICB9XG4gICAgICAgIGlmKGNwdSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNwdSA9IGNwdTtcbiAgICAgICAgfVxuICAgIH07ICAgIFxuICAgIFxuICAgIC8qKlxuICAgICAqIFRoZSBTZXJ2aWNlIEhlYWx0aCBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGJhc2ljIGhlYWx0aCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt1cHRpbWU9MF0gSG93IGxvbmcgdGhlIHdlYiBzZXJ2aWNlIGhhcyBiZWVuIHJ1bm5pbmcgaW4gc2Vjb25kc1xuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlckhlYWx0aFtdfSBbc2VydmVycz1bXV0gQXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5TZXJ2ZXJIZWFsdGh9IGluc3RhbmNlc1xuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhWZXJzaW9uSW5mb30gW3ZlcnNpb25JbmZvPW51bGxdIFZlcnNpb24gaW5mb3JtYXRpb24gYXNzb2NpYXRlZFxuICAgICAqIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhPc0luZm99IFtvc0luZm89bnVsbF0gT1MgaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJcbiAgICAgKiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhQcm9jZXNzSW5mb1tdfSBbcHJvY2Vzc0luZm89W11dIFByb2Nlc3Mtc3BlY2lmaWMgaW5mb3JtYXRpb25cbiAgICAgKiBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhTeXN0ZW1JbmZvfSBbc3lzdGVtSW5mbz1udWxsXSBTeXN0ZW0gaW5mb3JtYXRpb24gYXNzb2NpYXRlZFxuICAgICAqIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhTdHJlYW1JbmZvfSBbc3RyZWFtSW5mbz1udWxsXSBDdXJyZW50bHkgcHJvY2Vzc2VkIHZpZGVvIHN0cmVhbSBpbmZvcm1hdGlvblxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VIZWFsdGggPSBmdW5jdGlvbiAodXB0aW1lLCBzZXJ2ZXJzLCB2ZXJzaW9uSW5mbywgb3NJbmZvLCBwcm9jZXNzSW5mbywgc3lzdGVtSW5mbywgc3RyZWFtSW5mbykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHdlYiBzZXJ2aWNlIHVwdGltZSBpbiBzZWNvbmRzLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cHRpbWUgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcnJheSBvZiB7QGxpbmsgRVZXRUIyLlNlcnZlckhlYWx0aH0gaW5zdGFuY2VzIGZvciBlYWNoIHNlcnZlciB0aGUgd2ViIHNlcnZpY2UgaXNcbiAgICAgICAgICogY29ubmVjdGVkIHRvLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlckhlYWx0aFtdfVxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIHZhbHVlIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBmdXR1cmUgdmVyc2lvbnMuIFBhcnQgb2YgdGhpcyBpbmZvcm1hdGlvbiB3aWxsXG4gICAgICAgICAqIGJlIGV4cG9zZWQgaW4gYSBuZXcgc3RyZWFtcyBwcm9wZXJ0eSB3aGVuIGl0IGlzIGludHJvZHVjZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlcnMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVmVyc2lvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhWZXJzaW9uSW5mb31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmVyc2lvbkluZm8gPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPUyBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2VIZWFsdGhPc0luZm99XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9zSW5mbyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByb2Nlc3Mtc3BlY2lmaWMgaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlSGVhbHRoUHJvY2Vzc0luZm9bXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJvY2Vzc0luZm8gPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3lzdGVtIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmljZUhlYWx0aFN5c3RlbUluZm99XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN5c3RlbUluZm8gPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdHJlYW0gaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlSGVhbHRoU3RyZWFtSW5mb31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RyZWFtSW5mbyA9IG51bGw7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih1cHRpbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51cHRpbWUgPSB1cHRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2VydmVycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlcnMgPSBzZXJ2ZXJzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHZlcnNpb25JbmZvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbkluZm8gPSB2ZXJzaW9uSW5mbztcbiAgICAgICAgfVxuICAgICAgICBpZihvc0luZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5vc0luZm8gPSBvc0luZm87XG4gICAgICAgIH1cbiAgICAgICAgaWYocHJvY2Vzc0luZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9jZXNzSW5mbyA9IHByb2Nlc3NJbmZvO1xuICAgICAgICB9XG4gICAgICAgIGlmKHN5c3RlbUluZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zeXN0ZW1JbmZvID0gc3lzdGVtSW5mbztcbiAgICAgICAgfVxuICAgICAgICBpZihzdHJlYW1JbmZvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RyZWFtSW5mbyA9IHN0cmVhbUluZm87XG4gICAgICAgIH1cbiAgICB9O1xuICBcbiAgICBcbn0oKSk7XG4iLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlIG9mIHJlbGF5IGVycm9yc1xuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIucmVsYXlFcnJvcnMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWxcbiAgICAgICAgICovXG4gICAgICAgIGludGVybmFsOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ29ubmVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgY29ubmVjdDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldCBBZGRyZXNzXG4gICAgICAgICAqL1xuICAgICAgICBnZXRBZGRyOiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogUmVxdWVzdFxuICAgICAgICAgKi9cbiAgICAgICAgcmVxdWVzdDogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpY2Vuc2VcbiAgICAgICAgICovXG4gICAgICAgIGxpY2Vuc2U6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2dpblxuICAgICAgICAgKi9cbiAgICAgICAgbG9naW46IDYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQcm94eVxuICAgICAgICAgKi9cbiAgICAgICAgcHJveHk6IDdcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgY2xhc3MgZm9yIElQIGFkZHJlc3Nlc1xuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBhZGRyZXNzIFRoZSBJTkVUL0lORVQ2IGFkZHJlc3NcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21hY0FkZHJlc3M9JyddIFRoZSBoYXJkd2FyZS9NQUMgYWRkcmVzcyBvZiB0aGUgSVAgKGlmIGtub3duKVxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VJUEFkZHJlc3MgPSBmdW5jdGlvbihhZGRyZXNzLCBtYWNBZGRyZXNzKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSU5FVC9JTkVUNiBJUCBBZGRyZXNzXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaGFyZHdhcmUvTUFDIGFkZHJlc3Mgb2YgdGhlIElQXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hYyA9ICcnO1xuICAgICAgICBcbiAgICAgICAgLy8gYXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobWFjQWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hYyA9IG1hY0FkZHJlc3M7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gdGhlIGN1cnJlbnQgbmV0d29yayBjb25maWd1cmF0aW9uIG9mIHRoZSBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VJUEFkZHJlc3NbXX0gW2ludGVybmFsSXA9W11dIFRoZSBJUCBhZGRyZXNzZXMgZGV0ZWN0ZWQgYnkgdGhlIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZUlQQWRkcmVzc30gW2V4dGVybmFsSXA9bnVsbF0gVGhlIGV4dGVybmFsIElQIGFkZHJlc3MgcmVwb3J0ZWQgYnkgdGhlIHNlcnZpY2UuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZU5ldHdvcmtDb25maWcgPSBmdW5jdGlvbihpbnRlcm5hbElwLCBleHRlcm5hbElwKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJUCBhZGRyZXNzZXMgZGV0ZWN0ZWQgYnkgdGhlIHNlcnZpY2VcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlSVBBZGRyZXNzW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmludGVybmFsSXAgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElQIGFkZHJlc3MgcmVwb3J0ZWQgYnkgdGhlIHNlcnZpY2VcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlSVBBZGRyZXNzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHRlcm5hbElwID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIC8vIGFzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGludGVybmFsSXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcm5hbElwID0gaW50ZXJuYWxJcDtcbiAgICAgICAgfVxuICAgICAgICBpZihleHRlcm5hbElwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXh0ZXJuYWxJcCA9IGV4dGVybmFsSXA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgcmVsYXkgY29ubmVjdGlvbiBzdGF0dXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIucmVsYXlFcnJvcnN9IFtlcnJvcj1FVldFQjIucmVsYXlFcnJvcnMubm9uZV0gQSAobm9uLW5vbmUpIGVycm9yIHZhbHVlIGlmZiByZWxheSBpcyBlbmFibGVkIGJ1dCBmYWlsZWQgdG8gc3RhcnQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFthZGRyZXNzPScnXSBUaGUgcHVibGljIHJlbGF5IGFkZHJlc3MgKEZRRE4pIGlmZiByZWxheSBpcyBlbmFibGVkIGFuZCBzdGFydGVkIHN1Y2Nlc3NmdWxseS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlUmVsYXlJbmZvID0gZnVuY3Rpb24oZXJyb3IsIGFkZHJlc3MpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgKG5vbi1ub25lKSBlcnJvciB2YWx1ZSBpZmYgcmVsYXkgaXMgZW5hYmxlZCBidXQgZmFpbGVkIHRvIHN0YXJ0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnJlbGF5RXJyb3JzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcnJvciA9IEVWV0VCMi5yZWxheUVycm9ycy5ub25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHVibGljIHJlbGF5IGFkZHJlc3MgKEZRRE4pIGlmZiByZWxheSBpcyBlbmFibGVkIGFuZCBzdGFydGVkIHN1Y2Nlc3NmdWxseS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWRkcmVzcyA9ICcnO1xuXG4gICAgICAgIGlmKGVycm9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgICBpZihhZGRyZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgIH1cbiAgICB9OyAgICBcblxuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIGZvciBzZXJ2aWNlIGNvbm5lY3Rpdml0eSBzdGF0dXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZU5ldHdvcmtDb25maWd9IG5ldHdvcmtDb25maWcgVGhlIG5ldHdvcmsgY29uZmlndXJhdGlvbiBhcyByZXBvcnRlZCBieSB0aGUgc2VydmljZVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW291dGJvdW5kPWZhbHNlXSBGbGFnIHNldCBpZiBvdXRib3VuZCBjb25uZWN0aW9ucyB0byB0aGUgaW50ZXJuZXQgY2FuIGJlIG1hZGUgYnkgdGhlXG4gICAgICogc2VydmljZS4gVGhpcyBlZmZlY3RzIHRoZSBzZXJ2aWNlJ3MgYWJpbGl0eSB0byB1c2UgcHVzaCBub3RpZmljYXRpb25zLCBkb3dubG9hZCB1cGRhdGVzLCBldGMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaHR0cD1mYWxzZV0gRmxhZyBzZXQgaWYgdGhlIGNvbmZpZ3VyZWQgSFRUUCBwb3J0IGNhbiBiZSByZWFjaGVkIGV4dGVybmFsbHkuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaHR0cHM9ZmFsc2VdIEZsYWcgc2V0IGlmIHRoZSBjb25maWd1cmVkIFNTTCAoSFRUUFMpIHBvcnQgY2FuIGJlIHJlYWNoZWQgZXh0ZXJuYWxseS5cbiAgICAgKiBOT1RFOiBUaGlzIHdpbGwgYWx3YXlzIGJlIGZhbHNlIGlmIFNTTC9IVFRQUyBpcyBub3QgY29uZmlndXJlZC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt3cz1mYWxzZV0gRmxhZyBzZXQgaWYgdGhlIGNvbmZpZ3VyZWQgd2Vic29ja2V0IHBvcnQgY2FuIGJlIHJlYWNoZWQgZXh0ZXJuYWxseS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt3c3M9ZmFsc2VdIEZsYWcgc2V0IGlmIHRoZSBjb25maWd1cmVkIHNlY3VyZSB3ZWJzb2NrZXQgKFNTTC9XU1MpIHBvcnQgY2FuIGJlIHJlYWNoZWRcbiAgICAgKiAgICAgZXh0ZXJuYWxseS4gTk9URTogVGhpcyB3aWxsIGFsd2F5cyBiZSBmYWxzZSBpZiBzZWN1cmUgd2Vic29ja2V0cyBhcmUgbm90IGNvbmZpZ3VyZWQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVJlbGF5SW5mb30gW3JlbGF5SW5mbz1udWxsXSBDdXJyZW50IHN0YXR1cyBvZiByZWxheSBjb25uZWN0aW9uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZUNvbm5lY3Rpdml0eSA9IGZ1bmN0aW9uKG5ldHdvcmtDb25maWcsIG91dGJvdW5kLCBodHRwLCBodHRwcywgd3MsIHdzcywgcmVsYXlJbmZvKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmV0d29yayBjb25maWcgb2YgdGhlIHNlcnZpY2VcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlTmV0d29ya0NvbmZpZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmV0d29ya0NvbmZpZyA9IG5ldHdvcmtDb25maWc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHNlcnZpY2UgY2FuIG1ha2Ugb3V0Ym91bmQgY29ubmVjdGlvbnMuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vdXRib3VuZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBjb25maWd1cmVkIEhUVFAgcG9ydCBjYW4gYmUgcmVhY2hlZCBleHRlcm5hbGx5LlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaHR0cCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBjb25maWd1cmVkIEhUVFBTIHBvcnQgY2FuIGJlIHJlYWNoZWQgZXh0ZXJuYWxseS5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmh0dHBzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGNvbmZpZ3VyZWQgd2Vic29ja2V0IHBvcnQgY2FuIGJlIHJlYWNoZWQgZXh0ZXJuYWxseS5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLndzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGNvbmZpZ3VyZWQgc2VjdXJlIHdlYnNvY2tldCBwb3J0IGNhbiBiZSByZWFjaGVkIGV4dGVybmFsbHkuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53c3MgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVsYXkgaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlUmVsYXlJbmZvfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZWxheUluZm8gPSBudWxsO1xuXG4gICAgICAgIFxuICAgICAgICAvLyBhc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihvdXRib3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm91dGJvdW5kID0gb3V0Ym91bmQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaHR0cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmh0dHAgPSBodHRwO1xuICAgICAgICB9XG4gICAgICAgIGlmKGh0dHBzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaHR0cHMgPSBodHRwcztcbiAgICAgICAgfVxuICAgICAgICBpZihodHRwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmh0dHBzID0gaHR0cHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYod3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy53cyA9IHdzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHdzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLndzcyA9IHdzcztcbiAgICAgICAgfVxuICAgICAgICBpZihyZWxheUluZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZWxheUluZm8gPSByZWxheUluZm87XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFxuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIGZvciBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRoZSBTU0wgY29uZmlndXJhdGlvbiBzdGF0dXMgb2YgdGhlIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaHR0cHM9ZmFsc2VdIEZsYWcgc2V0IGlmIFNTTCBpcyBjb25maWd1cmVkIGFuZCB3b3JraW5nIGxvY2FsbHkgZm9yIEhUVFBcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt3c3M9ZmFsc2VdIEZsYWcgc2V0IGlmIFNTTCBpcyBjb25maWd1cmVkIGFuZCB3b3JraW5nIGxvY2FsbHkgZm9yIHdlYnNvY2tldHNcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlU1NMU3RhdHVzID0gZnVuY3Rpb24oaHR0cHMsIHdzcykge1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHNlcnZpY2UgZGV0ZWN0cyBIVFRQUyBpcyBjb25maWd1cmVkIGFuZCB3b3JraW5nIGNvcnJlY3RseVxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaHR0cHMgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmljZSBkZXRlY3RzIHNlY3VyZSB3ZWJzb2NrZXRzIGFyZSBjb25maWd1cmVkIGFuZCB3b3JraW5nIGNvcnJlY3RseVxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud3NzID0gZmFsc2U7XG5cbiAgICAgICAgLy8gYXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoaHR0cHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5odHRwcyA9IGh0dHBzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHdzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLndzcyA9IHdzcztcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgcHVzaCBub3RpZmljYXRpb24gcmVsYXRlZCBzdGF0dXMgb2YgdGhlIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbY2VydGlmaWNhdGVzPWZhbHNlXSBGbGFnIHdoZXRoZXIgcHVzaCBub3RpZmljYXRpb24gY3JlZGVudGlhbHMgYXJlIHByb3Blcmx5IGxvYWRlZC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlUHVzaE5vdGlmaWNhdGlvblN0YXR1cyA9IGZ1bmN0aW9uKGNlcnRpZmljYXRlcykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHB1c2ggbm90aWZpY2F0aW9uIGNyZWRlbnRpYWxzIGFyZSBwcm9wZXJseSBsb2FkZWRcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNlcnRpZmljYXRlcyA9IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgLy8gYXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoY2VydGlmaWNhdGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2VydGlmaWNhdGVzID0gY2VydGlmaWNhdGVzO1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIGZvciBzdGF0dXMgcmVsYXRlZCB0byBzZXJ2aWNlIHVwZGF0ZXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcmVhY2hhYmxlPWZhbHNlXSBGbGFnIHNldCBpZiB0aGUgY29uZmlndXJlZCB1cGRhdGVzIFVSTCBpcyByZWFjaGFibGUgYnkgdGhlIHNlcnZpY2UuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmljZVVwZGF0ZXNTdGF0dXMgPSBmdW5jdGlvbihyZWFjaGFibGUpIHtcbiAgICAgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1cGRhdGVzIHVybCBpcyByZWFjaGFibGUgYnkgdGhlIHNlcnZpY2UgXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZWFjaGFibGUgPSBmYWxzZTtcblxuICAgICAgICAvLyBhc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihyZWFjaGFibGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZWFjaGFibGUgPSByZWFjaGFibGU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3Igc2VydmljZSBzdGF0dXMgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVNTTFN0YXR1c30gc3NsIFN0YXR1cyBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIFNTTC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlUHVzaE5vdGlmaWNhdGlvblN0YXR1c30gcHVzaE5vdGlmaWNhdGlvbnMgU3RhdHVzIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gcHVzaCBub3RpZmljYXRpb25zLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2VVcGRhdGVzU3RhdHVzfSB1cGRhdGVzIFN0YXR1cyBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHNlcnZpY2UgdXBkYXRlcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlQ29uZmlnU3RhdHVzID0gZnVuY3Rpb24oc3NsLCBwdXNoTm90aWZpY2F0aW9ucywgdXBkYXRlcykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGF0dXMgaW5mb3JtYXRpb24gcmVsYXRlZCB0byBTU0xcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlU1NMU3RhdHVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zc2wgPSBzc2w7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0YXR1cyBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHB1c2ggbm90aWZpY2F0aW9uc1xuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2VQdXNoTm90aWZpY2F0aW9uU3RhdHVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wdXNoTm90aWZpY2F0aW9ucyA9IHB1c2hOb3RpZmljYXRpb25zO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGF0dXMgaW5mb3JtYXRpb24gcmVsYXRlZCB0byBzZXJ2aWNlIHVwZGF0ZXNcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlVXBkYXRlc1N0YXR1c31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXBkYXRlcyA9IHVwZGF0ZXM7XG4gICAgfTtcbiAgICBcbiAgICBcbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgY2xhc3MgZm9yIHN0YXR1cyByZWxhdGVkIHRvIG9uZSBvZiB0aGUgY29uZmlndXJlZCBzZXJ2ZXJzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzZXJ2ZXJJZCBUaGUgc2VydmVyIElEXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcmVhY2hhYmxlPWZhbHNlXSBGbGFnIHNldCBpZiB0aGUgc2VydmVyIGlzIHJlYWNoYWJsZSBieSB0aGUgd2ViIHNlcnZpY2UgKG9yIGluIHRoZSBjYXNlIG9mXG4gICAgICogcmVtb3RlIHNlcnZlcnMgaWYgdGhhdCBzZXJ2ZXIgaXMgYWJsZSB0byBjb25uZWN0L3JlYWNoIHRoZSBzZXJ2aWNlKVxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3Bhc3N0aHJvdWdoPWZhbHNlXSBXaGV0aGVyIHRoZSBwYXNzdGhyb3VnaCB1c2VyIGFjY291bnQgaXMgdmFsaWQuIE5PVEU6IElmIHRoZSBzZXJ2ZXIgZG9lcyBub3RcbiAgICAgKiBoYXZlIGEgcGFzc3Rocm91Z2ggdXNlciBjb25maWd1cmVkIHRoaXMgdmFsdWUgd2lsbCBhbHdheXMgYmUgZmFsc2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcG93ZXJVc2VyPWZhbHNlXSBXaGV0aGVyIHRoZSBwb3dlciB1c2VyIGFjY291bnQgaXMgdmFsaWQuIE5PVEU6IElmIHRoZSBzZXJ2ZXIgZG9lcyBub3QgaGF2ZSBhXG4gICAgICogcG93ZXIgdXNlciBjb25maWd1cmVkIHRoaXMgdmFsdWUgd2lsbCBhbHdheXMgYmUgZmFsc2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcmVtb3RlPWZhbHNlXSBGbGFnIHNldCBpZiB0aGlzIGlzIGEgcmVtb3RlIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2ZXJDb25maWdTdGF0dXMgPSBmdW5jdGlvbihzZXJ2ZXJJZCwgcmVhY2hhYmxlLCBwYXNzdGhyb3VnaCwgcG93ZXJVc2VyLCByZW1vdGUpIHtcbiAgICAgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIElEIHN0YXR1cyBpbmZvcm1hdGlvbiBpcyBmb3JcbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBzZXJ2ZXJJZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGlzIHJlYWNoYWJsZSBieSB0aGUgd2ViIHNlcnZpY2UuIElmIHRoaXMgaXMgYSByZW1vdGUgc2VydmVyIHRoaXMgZmxhZyBcbiAgICAgICAgICogaXMgc2V0IGlmIHRoZSByZW1vdGUgc2VydmVyIGNhbiBjb25uZWN0IHRvIHRoZSBzZXJ2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVhY2hhYmxlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHBhc3N0aHJvdWdoIHVzZXIgYWNjb3VudCBpcyB2YWxpZC4gTk9URTogSWYgdGhlIHNlcnZlciBkb2VzIG5vdCBoYXZlIGFcbiAgICAgICAgICogcGFzc3Rocm91Z2ggdXNlciBjb25maWd1cmVkIHRoaXMgdmFsdWUgd2lsbCBhbHdheXMgYmUgZmFsc2UuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzdGhyb3VnaCA9IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHBvd2VyIHVzZXIgYWNjb3VudCBpcyB2YWxpZC4gTk9URTogSWYgdGhlIHNlcnZlciBkb2VzIG5vdCBoYXZlIGFcbiAgICAgICAgICogcG93ZXIgdXNlciBjb25maWd1cmVkIHRoaXMgdmFsdWUgd2lsbCBhbHdheXMgYmUgZmFsc2UuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3dlclVzZXIgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGlzIGlzIGEgcmVtb3RlIHNlcnZlciBvciBub3RcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlbW90ZSA9IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8vIGFzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHJlYWNoYWJsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJlYWNoYWJsZSA9IHJlYWNoYWJsZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwYXNzdGhyb3VnaCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBhc3N0aHJvdWdoID0gcGFzc3Rocm91Z2g7XG4gICAgICAgIH1cbiAgICAgICAgaWYocG93ZXJVc2VyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG93ZXJVc2VyID0gcG93ZXJVc2VyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJlbW90ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW90ZSA9IHJlbW90ZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgXG4gICAgLyoqXG4gICAgICogVGhlIFNlcnZpY2VTdGF0dXMgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgaW5mb3JtYXRpb24gcmVsYXRlZCB0byB0aGUgY3VycmVudCBzdGF0dXMgb2YgdGhlIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZUNvbmZpZ30gY29uZmlnIFRoZSBzZXJ2aWNlIGNvbmZpZ3VyYXRpb24gaW5zdGFuY2VcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlU3RhdHVzID0gZnVuY3Rpb24oY29uZmlnKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb250YWluaW5nIHNlcnZpY2UgY29uZmlndXJhdGlvbiBmb3IgdGhpcyBzdGF0dXMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmljZUNvbmZpZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVjayB0aGUgY29ubmVjdGl2aXR5IG9mIHRoZSBzZXJ2aWNlIGluY2x1ZGluZyBvdXRib3VuZCBjb25uZWN0aW9ucyBhbmQgdGhlIGFiaWxpdHlcbiAgICAgICAgICogdG8gcmVhY2ggdGhlIHZhcmlvdXMgY29uZmlndXJlZCBzZXJ2aWNlIHBvcnRzLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIGFuIHtAbGluayBFVldFQjIuU2VydmljZUNvbm5lY3Rpdml0eX0gaW5zdGFuY2UsIGFuZCBhIERhdGUgb2JqZWN0XG4gICAgICAgICAqIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxhc3QgdGltZSB0aGUgY29ubmVjdGl2aXR5IHRlc3Qgd2FzIHJ1biBieSB0aGUgc2VydmljZS5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbZm9yY2U9ZmFsc2VdICBGb3JjZSB0aGUgY29ubmVjdGl2aXR5IHRlc3QgdG8gcnVuIHByZXZlbnRpbmcgdGhlIHVzZSBvZiBhbnkgY2FjaGVkXG4gICAgICAgICAqIHJlc3VsdHMgKGlmIGFueSkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoZWNrQ29ubmVjdGl2aXR5ID0gZnVuY3Rpb24oY2FsbGJhY2ssIGZvcmNlKSB7XG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWc7XG5cbiAgICAgICAgICAgIGlmKGNvbmZpZy5hdXRoVG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBhdXRob3JpemF0aW9uLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBpbnRlcm5hbElwcyA9ICQubWFwKGRhdGEuaW50ZXJuYWxJcCwgZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VydmljZUlQQWRkcmVzcyh2YWx1ZS5hZGRyZXNzLCB2YWx1ZS5tYWMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbElwID0gbmV3IEVWV0VCMi5TZXJ2aWNlSVBBZGRyZXNzKGRhdGEuZXh0ZXJuYWxJcCk7XG4gICAgICAgICAgICAgICAgdmFyIG5ldHdvcmtDb25maWcgPSBuZXcgRVZXRUIyLlNlcnZpY2VOZXR3b3JrQ29uZmlnKGludGVybmFsSXBzLCBleHRlcm5hbElwKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVsYXlJbmZvID0gbmV3IEVWV0VCMi5TZXJ2aWNlUmVsYXlJbmZvKGRhdGEucmVsYXkuZXJyb3IsIGRhdGEucmVsYXkuYWRkcmVzcyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGNvbm5lY3Rpdml0eSA9IG5ldyBFVldFQjIuU2VydmljZUNvbm5lY3Rpdml0eShuZXR3b3JrQ29uZmlnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbm5lY3Rpdml0eS5vdXRib3VuZCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb25uZWN0aXZpdHkuaHR0cCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb25uZWN0aXZpdHkuaHR0cHMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEuY29ubmVjdGl2aXR5LndzLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLmNvbm5lY3Rpdml0eS53c3MsXG4gICAgICAgICAgICAgICAgICAgIHJlbGF5SW5mbyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGRhdGEubGFzdFVwZGF0ZWQpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGNvbm5lY3Rpdml0eSwgdGltZXN0YW1wKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VDb25uZWN0aXZpdHlTdGF0dXM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChmb3JjZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRhdGEuZm9yY2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGNvbmZpZy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXF1ZXN0IHRoZSBzdGF0dXMgb2YgdGhlIHNlcnZpY2UgY29uZmlndXJhdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhbmQgYW4ge0BsaW5rIEVWV0VCMi5TZXJ2aWNlQ29uZmlnU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0Q29uZmlnU3RhdHVzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHNzbFN0YXR1cyA9IG5ldyBFVldFQjIuU2VydmljZVNTTFN0YXR1cyhkYXRhLnNzbC5odHRwLCBkYXRhLnNzbC53cyk7XG4gICAgICAgICAgICAgICAgdmFyIHB1c2hTdGF0dXMgPSBuZXcgRVZXRUIyLlNlcnZpY2VQdXNoTm90aWZpY2F0aW9uU3RhdHVzKGRhdGEucHVzaE5vdGlmaWNhdGlvbnMuY2VydGlmaWNhdGVzKTtcbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlc1N0YXR1cyA9IG5ldyBFVldFQjIuU2VydmljZVVwZGF0ZXNTdGF0dXMoZGF0YS51cGRhdGVzKTtcbiAgICAgICAgICAgICAgICB2YXIgY29uZmlnU3RhdHVzID0gbmV3IEVWV0VCMi5TZXJ2aWNlQ29uZmlnU3RhdHVzKHNzbFN0YXR1cywgcHVzaFN0YXR1cywgdXBkYXRlc1N0YXR1cyk7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBjb25maWdTdGF0dXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZUNvbmZpZ1N0YXR1cztcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgYXV0aDogY29uZmlnLmF1dGhUb2tlblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBjb25maWcuc2VydmljZSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVxdWVzdCB0aGUgc3RhdHVzIG9mIHRoZSBzZXJ2aWNlIGNvbmZpZ3VyYXRpb24uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgYW5kIHtAbGluayBFVldFQjIuU2VydmVyQ29uZmlnU3RhdHVzW119IGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U2VydmVyU3RhdHVzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZztcblxuICAgICAgICAgICAgaWYoY29uZmlnLmF1dGhUb2tlbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIGF1dGhvcml6YXRpb24uJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c2VzID0gJC5tYXAoZGF0YS5zZXJ2ZXJzLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJ2ZXJDb25maWdTdGF0dXModmFsdWUuaWQsIHZhbHVlLnJlYWNoYWJsZSwgdmFsdWUucGFzc3Rocm91Z2gsIHZhbHVlLnBvd2VydXNlcik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVtb3RlU3RhdHVzZXMgPSAkLm1hcChkYXRhLnJlbW90ZVNlcnZlcnMsIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VydmVyQ29uZmlnU3RhdHVzKHZhbHVlLmlkLCB2YWx1ZS5jb25uZWN0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5wYXNzdGhyb3VnaCwgdmFsdWUucG93ZXJ1c2VyLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgYWxsID0gJC5tZXJnZShzdGF0dXNlcywgcmVtb3RlU3RhdHVzZXMpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgYWxsKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSBjb25maWcuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZpY2VTZXJ2ZXJTdGF0dXM7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGF1dGg6IGNvbmZpZy5hdXRoVG9rZW5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgY29uZmlnLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgfTtcbiAgICBcbn0oKSk7XG4iLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgcG9zc2libGUgZG93bmxvYWQgdXBkYXRlIHN0YXR1cyB0eXBlcyBhdmFpbGFibGUuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5kb3dubG9hZFVwZGF0ZVN0YXR1c1R5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm90IHN0YXJ0ZWRcbiAgICAgICAgICovXG4gICAgICAgIG5vdFN0YXJ0ZWQ6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEb3dubG9hZGluZ1xuICAgICAgICAgKi9cbiAgICAgICAgZG93bmxvYWRpbmc6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb21wbGV0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNvbXBsZXRlZDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBlcnJvcjogM1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgU2VydmljZVVwZGF0ZURvd25sb2FkU3RhdHVzIG9iamVjdCByZXByZXNlbnRzIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzdGF0dXMgb2YgYW4gdXBkYXRlIGRvd25sb2FkLlxuICAgICAqIFRoaXMgaXMgZ2VuZXJhdGVkIGFzIGEgcmVzcG9uc2UgdG8ge0BsaW5rIEVWV0VCMi5TZXJ2aWNlVXBkYXRlLmRvd25sb2FkVXBkYXRlU3RhdHVzfS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5kb3dubG9hZFVwZGF0ZVN0YXR1c1R5cGVzfSBbc3RhdHVzPUVWV0VCMi5kb3dubG9hZFVwZGF0ZVN0YXR1c1R5cGVzLm5vdFN0YXJ0ZWRdXG4gICAgICogVGhlIHN0YXR1cyBvZiB0aGUgdXBkYXRlIGRvd25sb2FkLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbY3VycmVudEZpbGVTaXplPTBdIFRoZSBmaWxlIHNpemUgb2YgdGhlIHVwZGF0ZSBjdXJyZW50bHkgYmVpbmcgZG93bmxvYWRlZCwgaW4gYnl0ZXMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt0b3RhbEZpbGVTaXplPTBdIFRoZSB0b3RhbCBmaWxlIHNpemUgb2YgdGhlIHVwZGF0ZSwgaW4gYnl0ZXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZVVwZGF0ZX0gW3VwZGF0ZT1udWxsXSBUaGUgdXBkYXRlIGluc3RhbmNlIHRoaXMgc3RhdHVzIGlzIGFzc29jaWF0ZWQgd2l0aFxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VVcGRhdGVEb3dubG9hZFN0YXR1cyA9IGZ1bmN0aW9uKHN0YXR1cywgY3VycmVudEZpbGVTaXplLCB0b3RhbEZpbGVTaXplLCB1cGRhdGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdGF0dXMgb2YgdGhlIHVwZGF0ZSBkb3dubG9hZC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmRvd25sb2FkVXBkYXRlU3RhdHVzVHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzID0gRVZXRUIyLmRvd25sb2FkVXBkYXRlU3RhdHVzVHlwZXMubm90U3RhcnRlZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGN1cnJlbnQgZmlsZSBzaXplIG9mIHRoZSB1cGRhdGUsIGluIGJ5dGVzLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3VycmVudEZpbGVTaXplID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIGZpbGUgc2l6ZSBvZiB0aGUgZG93bmxvYWQsIGluIGJ5dGVzLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG90YWxGaWxlU2l6ZSA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1cGRhdGUgaW5zdGFuY2UgdGhpcyBzdGF0dXMgaXMgYXNzb2NpYXRlZCB3aXRoXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2aWNlVXBkYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZSA9IG51bGw7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2Ygc3RhdHVzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBjdXJyZW50RmlsZVNpemUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGaWxlU2l6ZSA9IGN1cnJlbnRGaWxlU2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdG90YWxGaWxlU2l6ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWxGaWxlU2l6ZSA9IHRvdGFsRmlsZVNpemU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHVwZGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlID0gdXBkYXRlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTZXJ2aWNlVXBkYXRlIG9iamVjdCByZXByZXNlbnRzIGluZm9ybWF0aW9uIGFib3V0IGFuIGF2YWlsYWJsZSBzZXJ2aWNlIHVwZGF0ZS4gIFRoaXNcbiAgICAgKiBpcyBnZW5lcmF0ZWQgYXMgYSByZXNwb25zZSB0byB7QGxpbmsgRVZXRUIyLlNlcnZpY2UuY2hlY2tGb3JVcGRhdGVzfS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBUaGUgc2VydmljZSBhc3NvY2lhdGVkIHdpdGggdGhpcyB1cGRhdGVcbiAgICAgKiBjaGVjay5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3ZlcnNpb249JyddIFRoZSB2ZXJzaW9uIG9mIHRoaXMgdXBkYXRlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdXBkYXRlVXJsPScnXSBUaGUgVVJMIHRvIHRoZSB1cGRhdGUgaW5zdGFsbGVyLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3JlY29tbWVuZGVkPWZhbHNlXSBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIHR5cGUgb2YgdXBkYXRlIGlzIHJlY29tbWVuZGVkIG9yIG5vdC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3RvdGFsRmlsZVNpemU9MF0gVGhlIHRvdGFsIGZpbGUgc2l6ZSBvZiB0aGUgZG93bmxvYWQsIGluIGJ5dGVzLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZpY2VVcGRhdGUgPSBmdW5jdGlvbihzZXJ2aWNlLCB2ZXJzaW9uLCB1cGRhdGVVcmwsIHJlY29tbWVuZGVkLCB0b3RhbEZpbGVTaXplKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmljZSBhc3NvY2lhdGVkIHdpdGggdGhlIHVwZGF0ZSBpbnN0YW5jZS5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZpY2VcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmljZSA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2ZXJzaW9uIG9mIHRoZSB1cGRhdGUuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52ZXJzaW9uID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBVUkwgb2YgdGhlIHVwZGF0ZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZVVybCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIHR5cGUgb2YgdXBkYXRlIGlzIHJlY29tbWVuZGVkIG9yIG5vdC5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZWNvbW1lbmRlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdG90YWwgZmlsZSBzaXplIG9mIHRoZSBkb3dubG9hZCwgaW4gYnl0ZXMuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3RhbEZpbGVTaXplID0gMDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2aWNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdmVyc2lvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHVwZGF0ZVVybCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVXJsID0gdXBkYXRlVXJsO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiByZWNvbW1lbmRlZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucmVjb21tZW5kZWQgPSByZWNvbW1lbmRlZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdG90YWxGaWxlU2l6ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWxGaWxlU2l6ZSA9IHRvdGFsRmlsZVNpemU7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5zdHJ1Y3RzIHRoZSBzZXJ2aWNlIHRvIHN0YXJ0IGRvd25sb2FkaW5nIHRoZSBzcGVjaWZpZWQgdXBkYXRlLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBhdXRoVG9rZW4gVGhlIGF1dGhvcml6YXRpb24gdG9rZW4gcmV0cmlldmVkIHVzaW5nXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZS5jb25maWcuZ2V0QXV0aG9yaXphdGlvbn1cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbdXNlR2V0UmVxdWVzdD1mYWxzZV0gQm9vbGVhbiBhcyB0byB3aGV0aGVyIHRvIGZvcmNlIHRoZSB1c2Ugb2YgYSBHRVQgcmVxdWVzdCBpbnN0ZWFkIG9mXG4gICAgICAgICAqIHRoZSBkZWZhdWx0IFBPU1QgcmVxdWVzdCAobm90IHJlY29tbWVuZGVkKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZG93bmxvYWRVcGRhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgYXV0aFRva2VuLCB1c2VHZXRSZXF1ZXN0KSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgdXNlR2V0UmVxdWVzdCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB1c2VHZXRSZXF1ZXN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgb25Eb3dubG9hZFVwZGF0ZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRG93bmxvYWRVcGRhdGVTdWNjZXNzID0gZnVuY3Rpb24gKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZighdXNlR2V0UmVxdWVzdCAmJiB0aGlzLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclRleHQgPSAnVGhpcyBjYWxsIGNhbiBub3QgYmUgcGVyZm9ybWVkIHZpYSBQT1NUIGluIFhTUyBzaXR1YXRpb25zLic7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBlcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uRG93bmxvYWRVcGRhdGVTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkRvd25sb2FkVXBkYXRlRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHR5cGU6IHVzZUdldFJlcXVlc3QgPyAnR0VUJyA6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZG93bmxvYWR1cGRhdGUnLFxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUXVlcmllcyBmb3IgdGhlIGN1cnJlbnQgc3RhdHVzIG9mIGRvd25sb2FkaW5nIHRoZSB1cGRhdGUuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLlxuICAgICAgICAgKiBDYWxsYmFjayBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2VVcGRhdGVEb3dubG9hZFN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBhdXRoVG9rZW4gVGhlIGF1dGhvcml6YXRpb24gdG9rZW4gcmV0cmlldmVkIHVzaW5nXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZS5jb25maWcuZ2V0QXV0aG9yaXphdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZG93bmxvYWRVcGRhdGVTdGF0dXMgPSBmdW5jdGlvbihjYWxsYmFjaywgYXV0aFRva2VuKSB7XG5cbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXBkYXRlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRG93bmxvYWRVcGRhdGVTdGF0dXNTdWNjZXNzID0gZnVuY3Rpb24gKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkVXBkYXRlU3RhdHVzID0gbmV3IEVWV0VCMi5TZXJ2aWNlVXBkYXRlRG93bmxvYWRTdGF0dXMoZGF0YS5zdGF0dXMsIGRhdGEuY3VycmVudF9maWxlX3NpemUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEudG90YWxfZmlsZV9zaXplLCBzZXJ2aWNlVXBkYXRlKTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZG93bmxvYWRVcGRhdGVTdGF0dXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRG93bmxvYWRVcGRhdGVTdGF0dXNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkRvd25sb2FkVXBkYXRlU3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25Eb3dubG9hZFVwZGF0ZVN0YXR1c0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGg6IGF1dGhUb2tlbixcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAnZG93bmxvYWR1cGRhdGVzdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgKiBBcHBsaWVzIHRoZSB1cGRhdGUgdG8gdGhlIHNlcnZpY2UuICBJZiB0aGUgdXBkYXRlIGluc3RhbGxlciBoYXMgYmVlbiBkb3dubG9hZGVkXG4gICAgICAgICogKGkuZS4ge0BsaW5rIEVWV0VCMi5TZXJ2aWNlVXBkYXRlLmRvd25sb2FkVXBkYXRlfSBoYXMgYmVlbiBjYWxsZWQgYW5kIGhhcyBmaW5pc2hlZClcbiAgICAgICAgKiB0aGUgd2ViIHNlcnZpY2Ugd2lsbCBpbW1lZGlhdGVseSBzdG9wIGFuZCBiZWdpbiB0byBpbnN0YWxsIHRoZSB1cGRhdGUuXG4gICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGF1dGhUb2tlbiBUaGUgYXV0aG9yaXphdGlvbiB0b2tlbiByZXRyaWV2ZWQgdXNpbmdcbiAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZpY2UuY29uZmlnLmdldEF1dGhvcml6YXRpb259XG4gICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbdXNlR2V0UmVxdWVzdD1mYWxzZV0gQm9vbGVhbiBhcyB0byB3aGV0aGVyIHRvIGZvcmNlIHRoZSB1c2Ugb2YgYSBHRVQgcmVxdWVzdCBpbnN0ZWFkIG9mXG4gICAgICAgICogdGhlIGRlZmF1bHQgUE9TVCByZXF1ZXN0IChub3QgcmVjb21tZW5kZWQpLlxuICAgICAgICAqL1xuICAgICAgICB0aGlzLmFwcGx5VXBkYXRlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGF1dGhUb2tlbiwgdXNlR2V0UmVxdWVzdCkge1xuICAgICAgICAgICAgaWYodHlwZW9mIHVzZUdldFJlcXVlc3QgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdXNlR2V0UmVxdWVzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25BcHBseVVwZGF0ZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uQXBwbHlVcGRhdGVTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHJlc3RhcnRQb2xsaW5nQ29uZmlybWF0aW9uc1JlcXVpcmVkID0gMTA7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3RhcnRQb2xsaW5nTWF4UmV0cmllcyA9IDEyMDtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdGFydFBvbGxpbmdJbnRlcnZhbCA9IDMwMDA7XG5cbiAgICAgICAgICAgICAgICAvLyBTdGFydCBwb2xsaW5nIHRvIHNlZSB3aGVuIHRoZSBzZXJ2aWNlIGlzIGJhY2sgdXBcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5ub3RpZnlPblNlcnZpY2VSZXN0YXJ0KGNhbGxiYWNrLCBzZXJ2aWNlLCByZXN0YXJ0UG9sbGluZ0ludGVydmFsLCByZXN0YXJ0UG9sbGluZ01heFJldHJpZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdGFydFBvbGxpbmdDb25maXJtYXRpb25zUmVxdWlyZWQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoIXVzZUdldFJlcXVlc3QgJiYgdGhpcy5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JUZXh0ID0gJ1RoaXMgY2FsbCBjYW4gbm90IGJlIHBlcmZvcm1lZCB2aWEgUE9TVCBpbiBYU1Mgc2l0dWF0aW9ucy4nO1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkFwcGx5VXBkYXRlU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25BcHBseVVwZGF0ZUVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmljZSxcbiAgICAgICAgICAgICAgICB0eXBlOiB1c2VHZXRSZXF1ZXN0ID8gJ0dFVCcgOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBhdXRoOiBhdXRoVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3VwZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246IHRoaXMudmVyc2lvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIHBvc3NpYmxlIGRvd25sb2FkIHVwZGF0ZSBzdGF0dXMgdHlwZXMgYXZhaWxhYmxlLlxuICAgICAqIEBlbnVtIHtzdHJpbmd9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuc2VydmljZUF1dGhUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246ICcnLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogJ25vbmUnLFxuICAgICAgICAvKipcbiAgICAgICAgICogRW50ZXJwcmlzZSBNYW5hZ2VyXG4gICAgICAgICAqL1xuICAgICAgICBlc206ICdlc20nXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTZXJ2aWNlQXV0aCBvYmplY3QgY29udGFpbnMgaW5mb3JtYXRpb24gYW5kIG1ldGhvZHMgYXJvdW5kIGF1dGhlbnRpY2F0aW9uIGluIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBJZiBlbmFibGVkLCBhbiBhdXRoZW50aWNhdGlvbiB0b2tlbiBtdXN0IGJlIHJldHJpZXZlZCBiZWZvcmUgYW55IGNhbGxzIHRvIHRoZSBzZXJ2aWNlIGNhbiBiZVxuICAgICAqIG1hZGUuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZX0gW3NlcnZpY2U9bnVsbF0gVGhlIHNlcnZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYXV0aCBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZXJ2aWNlQXV0aFR5cGVzfSBbdHlwZT1FVldFQjIuc2VydmljZUF1dGhUeXBlcy51bmtub3duXSBUaGUgdHlwZSBvZiB0aGUgYXV0aGVudGljYXRpb24gdXNlZFxuICAgICAqIGJ5IHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW2luZm89e31dIEFkZGl0aW9uYWwgaW5mbyBhc3NvY2lhdGVkIHdpdGggdGhpcyBhdXRoZW50aWNhdGlvbiB0eXBlLiAgR2VuZXJhbGx5LCB0aGlzXG4gICAgICogcHJvdmlkZXMgYSBVUkwgZm9yIHRoZSBlbmRwb2ludCBvZiBhdXRoZW50aWNhdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Rva2VuPScnXSBUaGUgYXV0aG9yaXphdGlvbiB0b2tlbiBmb3IgdXNlIGluIGFsbCByZXF1ZXN0cy5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtleHBpcmF0aW9uRGF0ZT1udWxsXSBUaGUgZGF0ZSBhdCB3aGljaCB0aGUgdG9rZW4gZXhwaXJlcy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2aWNlQXV0aCA9IGZ1bmN0aW9uKHNlcnZpY2UsIHR5cGUsIGluZm8sIHRva2VuLCBleHBpcmF0aW9uRGF0ZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSB1cGRhdGUgaW5zdGFuY2UuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiB0aGUgYXV0aGVudGljYXRpb24gdXNlZCBieSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5zZXJ2aWNlQXV0aFR5cGVzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIuc2VydmljZUF1dGhUeXBlcy51bmtub3duO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGRpdGlvbmFsIGluZm8gYXNzb2NpYXRlZCB3aXRoIHRoaXMgYXV0aGVudGljYXRpb24gdHlwZS4gIEdlbmVyYWxseSwgdGhpcyBwcm92aWRlc1xuICAgICAgICAgKiBhIFVSTCBmb3IgdGhlIGVuZHBvaW50IG9mIGF1dGhlbnRpY2F0aW9uLlxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbmZvID0ge307XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhdXRob3JpemF0aW9uIHRva2VuIGZvciB1c2UgaW4gYWxsIHJlcXVlc3RzLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9rZW4gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRhdGUgYXQgd2hpY2ggdGhlIHRva2VuIGV4cGlyZXMuXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXhwaXJhdGlvbkRhdGUgPSBudWxsO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihpbmZvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5mbyA9IGluZm87XG4gICAgICAgIH1cbiAgICAgICAgaWYodG9rZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4cGlyYXRpb25EYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXhwaXJhdGlvbkRhdGUgPSBleHBpcmF0aW9uRGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICAgIC8vIExvYWQgdGhlIGF1dGggZGF0YSBmcm9tIHRoZSBjb29raWUgKGlmIHRoZSB0b2tlbiBpcyBub3QgYWxyZWFkeSBzZXQpXG4gICAgICAgIGlmKGRvY3VtZW50ICE9PSB1bmRlZmluZWQgJiYgZG9jdW1lbnQuY29va2llICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHZhciBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gICAgICAgICAgICAkLmVhY2goY29va2llcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgY29va2llUGFpciA9ICQudHJpbShlbGVtZW50KS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgICAgIGlmKGNvb2tpZVBhaXJbMF0gPT09ICd0b2tlbicpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UudG9rZW4gPSBjb29raWVQYWlyWzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgdHlwZSBvZiBhdXRoZW50aWNhdGlvbiB1c2VkIGJ5IHRoaXMgc2VydmljZS4gIFRoZSByZXN1bHQgb2YgdGhpcyBjYWxsXG4gICAgICAgICAqIGlzIHN0b3JlZCBvbiB0aGUgb2JqZWN0LCBzbyB0aGUgbmV0d29yayByZXF1ZXN0IGlzIG9ubHkgbWFkZSBhdCB0eXBlcyB3aGVuXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VydmljZUF1dGgudHlwZX0gaXMgZXF1YWwgdG8ge0BsaW5rIEVWV0VCMi5zZXJ2aWNlQXV0aFR5cGVzLnVua25vd259LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIHRoZSBhdXRob3JpemF0aW9uIHR5cGUsIGFuZFxuICAgICAgICAgKiBhbiBvYmplY3Qgb2YgYWRkaXRpb25hbCBhdXRoLXR5cGUgc3BlY2lmaWMgaW5mby5cbiAgICAgICAgICogTm90ZTogVGhpcyB2YWx1ZSBpcyBzdG9yZWQgaW4gdGhlIG9iamVjdCBhbmQgaXMgb25seSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrIGZvclxuICAgICAgICAgKiBjb252ZW5pZW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VHlwZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihpbnN0YW5jZS50eXBlICE9PSBFVldFQjIuc2VydmljZUF1dGhUeXBlcy51bmtub3duKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSwgaW5zdGFuY2UudHlwZSwgaW5zdGFuY2UuaW5mbyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbnN0YW5jZS50eXBlID0gZGF0YS50eXBlO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmluZm8gPSBkYXRhLmluZm87XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLCBpbnN0YW5jZS50eXBlLCBpbnN0YW5jZS5pbmZvKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBpbnN0YW5jZS5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYXV0aCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dDogJ2pzb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIGluc3RhbmNlLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdXRoZW50aWNhdGVzIHdpdGggdGhlIHdlYiBzZXJ2aWNlIGFuZCBzdG9yZXMgdGhlIHJlcXVlc3RlZCB0b2tlbiBmb3IgdXNlIGluIGFsbFxuICAgICAgICAgKiBmdXR1cmUgY2FsbHMuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLlxuICAgICAgICAgKiBDYWxsYmFjayBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSwgdGhlIHJldHJpZXZlZCB0b2tlbiwgYW5kXG4gICAgICAgICAqIHRoZSBleHBpcmF0aW9uIGRhdGUuICBOb3RlOiBUaGVzZSB2YWx1ZXMgYXJlIHN0b3JlZCBpbiB0aGUgb2JqZWN0IGFuZCBhcmUgb25seSBwYXNzZWRcbiAgICAgICAgICogdG8gdGhlIGNhbGxiYWNrIGZvciBjb252ZW5pZW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lIFRoZSB1c2VybmFtZSBmb3IgYXV0aGVudGljYXRpb24uXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQgZm9yIGF1dGhlbnRpY2F0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGUgPSBmdW5jdGlvbihjYWxsYmFjaywgdXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIGlmKGluc3RhbmNlLnRva2VuICE9PSAnJyAmJiBpbnN0YW5jZS5leHBpcmF0aW9uRGF0ZSAhPT0gbnVsbCAmJiBpbnN0YW5jZS5leHBpcmF0aW9uRGF0ZSA+IG5vdykge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UsIGluc3RhbmNlLnRva2VuLCBpbnN0YW5jZS5leHBpcmF0aW9uRGF0ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbnN0YW5jZS50b2tlbiA9IGRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuZXhwaXJhdGlvbkRhdGUgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUoZGF0YS5leHBpcmF0aW9uKTtcblxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UsIGluc3RhbmNlLnRva2VuLCBpbnN0YW5jZS5leHBpcmF0aW9uRGF0ZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2Uuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmF1dGgsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgaW5zdGFuY2Uuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvZ3Mgb3V0IG9mIHRoZSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIGFuZCBpbnZhbGlkYXRlcyB0aGUgdG9rZW4uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICBpZihjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpbnN0YW5jZS50b2tlbiA9ICcnO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmV4cGlyYXRpb25EYXRlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbmZvID0ge307XG5cbiAgICAgICAgICAgICAgICBpZihjYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2Uuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmF1dGhMb2dvdXQsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgaW5zdGFuY2Uuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhlbHBlciBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIHRoZSBhdXRoZW50aWNhdGlvbiBpcyBjdXJyZW50bHkgdmFsaWQgKGkuZS5cbiAgICAgICAgICogdGhlIGF1dGhlbnRpY2F0aW9uIGlzIHByZXNlbnQgYW5kIGhhcyBub3QgZXhwaXJlZCkuXG4gICAgICAgICAqIEByZXR1cm5zIHtib29sZWFufSBXaGV0aGVyIHRoZSBhdXRoZW50aWNhdGlvbiBpcyB2YWxpZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZih0aGlzLnRva2VuID09PSAnJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIHdheSB0byBnZXQgdGhlIGV4cGlyYXRpb24gZGF0ZSBmcm9tIGEgdG9rZW4gdGhhdCdzXG4gICAgICAgICAgICAvLyByZXRyaWV2ZWQgdmlhIGEgY29va2llLCBzbyBleHBpcmF0aW9uIHdpbGwgYmUgbnVsbCB3aXRoIGEgc2V0XG4gICAgICAgICAgICAvLyB0b2tlbi4gIEluIHRoaXMgc2NlbmFyaW8sIGFzc3VtZSBpdCdzIHZhbGlkLlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwaXJhdGlvbkRhdGUgPT09IG51bGwgfHwgdGhpcy5leHBpcmF0aW9uRGF0ZSA+IG5ldyBEYXRlKCk7XG4gICAgICAgIH07XG4gICAgfTtcbn0oKSk7IiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIEEgY29udGFpbmVyIGZvciBhIGRpc2NvdmVyZWQgc2VydmVyLiAgVGhpcyBpcyBhIHNlcnZlciB0aGF0IGhhcyBiZWVuIGRldGVjdGVkIG9uIHRoZSBsb2NhbCBuZXR3b3JrXG4gICAgICogb2YgdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBhZGRyZXNzIFRoZSBhZGRyZXNzIG9mIHRoZSBkaXNjb3ZlcmVkIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gcG9ydCBUaGUgcG9ydCBudW1iZXIgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT1cIlwiXSBUaGUgbmFtZSBvZiB0aGUgZGlzY292ZXJlZCBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFttYWNBZGRyZXNzPVwiXCJdIFRoZSBNQUMgYWRkcmVzcyBvZiB0aGUgZGlzY292ZXJlZCBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFttb2RlbD1cIlwiXSBUaGUgbW9kZWwgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VyaWFsPVwiXCJdIFRoZSBzZXJpYWwgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLkRpc2NvdmVyeVNlcnZlciA9IGZ1bmN0aW9uKGFkZHJlc3MsIHBvcnQsIG5hbWUsIG1hY0FkZHJlc3MsIG1vZGVsLCBzZXJpYWwpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFkZHJlc3Mgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvcnQgbnVtYmVyIG9mIHRoZSBkaXNjb3ZlcmVkIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkaXNjb3ZlcmVkIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgTUFDIGFkZHJlc3Mgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tYWNBZGRyZXNzID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtb2RlbCBvZiB0aGUgZGlzY292ZXJlZCBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1vZGVsID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJpYWwgb2YgdGhlIGRpc2NvdmVyZWQgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJpYWwgPSAnJztcblxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYobWFjQWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hY0FkZHJlc3MgPSBtYWNBZGRyZXNzO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1vZGVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgfVxuICAgICAgICBpZihzZXJpYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJpYWwgPSBzZXJpYWw7XG4gICAgICAgIH1cbiAgICB9O1xufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBsaWNlbnNlcyBhdmFpbGFibGUgdG8gc2VydmVyc1xuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5zZXJ2ZXJMaWNlbnNlVHlwZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAtMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJhZFxuICAgICAgICAgKi9cbiAgICAgICAgYmFkOiAtMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVubGljZW5zZWRcbiAgICAgICAgICovXG4gICAgICAgIHVubGljZW5zZWQ6IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogRXZhbHVhdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgZXZhbHVhdGlvbjogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpY2Vuc2VkXG4gICAgICAgICAqL1xuICAgICAgICBsaWNlbnNlZDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRyaWFsXG4gICAgICAgICAqL1xuICAgICAgICB0cmlhbDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlc3RyaWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHJlc3RyaWN0ZWQ6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbnRlcnByaXNlXG4gICAgICAgICAqL1xuICAgICAgICBlbnRlcnByaXNlOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogRW50ZXJwcmlzZS1leHRlbmRlZFxuICAgICAgICAgKi9cbiAgICAgICAgZW50ZXJwcmlzZUV4OiA1XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSB0eXBlcyBvZiB1c2VyIGFjY2VzcyBsZXZlbHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLmFjY2Vzc0xldmVsVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IC0yLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlXG4gICAgICAgICAqL1xuICAgICAgICBkZWxldGVUeXBlOiAtMSwgIC8vJ2RlbGV0ZScgaXMgYSByZXNlcnZlZCBrZXl3b3JkXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lIChVc2VyIGJlbG9uZ3MgdG8gYSBncm91cClcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb3dlciBVc2VyXG4gICAgICAgICAqL1xuICAgICAgICBwb3dlclVzZXI6IDQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGdWxsIEFkbWluXG4gICAgICAgICAqL1xuICAgICAgICBmdWxsQWRtaW46IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VyIEFkbWluXG4gICAgICAgICAqL1xuICAgICAgICB1c2VyQWRtaW46IDYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaXZlLW9ubHlcbiAgICAgICAgICovXG4gICAgICAgIGxpdmVPbmx5OiAxMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlYXJjaC1vbmx5XG4gICAgICAgICAqL1xuICAgICAgICBzZWFyY2hPbmx5OiAxMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpdmUgYW5kIFNlYXJjaFxuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZUFuZFNlYXJjaDogMTJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBmZWF0dXJlcyB0aGF0IGNhbiBiZSBtYW5hZ2VkIGV4dGVybmFsbHkgb24gYSBzZXJ2ZXIuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLnNlcnZlck1hbmFnZW1lbnRGZWF0dXJlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVzZXJzXG4gICAgICAgICAqL1xuICAgICAgICB1c2VyczogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZhaWxvdmVyXG4gICAgICAgICAqL1xuICAgICAgICBmYWlsb3ZlcjogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgbGl2ZSBwZXJtaXNzaW9ucyBmb3IgYSBncm91cC5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIudXNlclBlcm1pc3Npb25zTGl2ZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJhc2VcbiAgICAgICAgICovXG4gICAgICAgIGJhc2U6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHcm91cHNcbiAgICAgICAgICovXG4gICAgICAgIGdyb3VwczogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHNcbiAgICAgICAgICovXG4gICAgICAgIG1hcHM6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWV3c1xuICAgICAgICAgKi9cbiAgICAgICAgdmlld3M6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBRdWljayBSZXBsYXlcbiAgICAgICAgICovXG4gICAgICAgIHF1aWNrUmVwbGF5OiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogUFRaXG4gICAgICAgICAqL1xuICAgICAgICBwdHo6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUd28td2F5IEF1ZGlvXG4gICAgICAgICAqL1xuICAgICAgICB0d29XYXlBdWRpbzogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEV2ZW50IE1vbml0b3JpbmdcbiAgICAgICAgICovXG4gICAgICAgIGV2ZW50TW9uaXRvcjogNyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNhdmUgSW1hZ2VcbiAgICAgICAgICovXG4gICAgICAgIHNhdmVJbWFnZTogOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByaW50IEltYWdlXG4gICAgICAgICAqL1xuICAgICAgICBwcmludEltYWdlOiA5LFxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FtZXJhc1xuICAgICAgICAgKi9cbiAgICAgICAgY2FtZXJhczogMTAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWRlbyBQdXNoXG4gICAgICAgICAqL1xuICAgICAgICB2aWRlb1B1c2g6IDExXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBzZWFyY2ggcGVybWlzc2lvbnMgZm9yIGEgZ3JvdXAuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLnVzZXJQZXJtaXNzaW9uc1NlYXJjaCA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJhc2VcbiAgICAgICAgICovXG4gICAgICAgIGJhc2U6IDEyLFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JvdXBzXG4gICAgICAgICAqL1xuICAgICAgICBncm91cHM6IDEzLFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFwc1xuICAgICAgICAgKi9cbiAgICAgICAgbWFwczogMTQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWV3c1xuICAgICAgICAgKi9cbiAgICAgICAgdmlld3M6IDE1LFxuICAgICAgICAvKipcbiAgICAgICAgICogRXZlbnRzXG4gICAgICAgICAqL1xuICAgICAgICBldmVudHM6IDE2LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2F2ZSBJbWFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2F2ZUltYWdlOiAxNyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByaW50IEltYWdlXG4gICAgICAgICAqL1xuICAgICAgICBwcmludEltYWdlOiAxOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJ1cm4gRGlzY1xuICAgICAgICAgKi9cbiAgICAgICAgYnVybkRpc2M6IDE5LFxuICAgICAgICAvKipcbiAgICAgICAgICogRXhwb3J0IFZpZGVvXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnRWaWRlbzogMjAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTbWFydCBTZWFyY2hcbiAgICAgICAgICovXG4gICAgICAgIHNtYXJ0U2VhcmNoOiAyMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhc2VzXG4gICAgICAgICAqL1xuICAgICAgICBjYXNlczogMjIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYW1lcmFzXG4gICAgICAgICAqL1xuICAgICAgICBjYW1lcmFzOiAyM1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY29uZmlnIHBlcm1pc3Npb25zIGZvciBhIGdyb3VwLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi51c2VyUGVybWlzc2lvbnNDb25maWcgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VyIEFkbWluIChVc2VyIGNhbiBlZGl0IG90aGVyIHVzZXJzIG5hbWVzLCBwYXNzd29yZHMsIGV0Yy4pXG4gICAgICAgICAqL1xuICAgICAgICB1c2VyQWRtaW46IDI0LFxuICAgICAgICAvKipcbiAgICAgICAgICogVmlldyBBZG1pbiAoVXNlciBjYW4gY3JlYXRlIGFuZCBzZWUgdmlld3MuKVxuICAgICAgICAgKi9cbiAgICAgICAgdmlld0FkbWluOiAyNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhc2UgQWRtaW4gKFVzZXIgY2FuIGNyZWF0ZSBhbmQgc2VlIGNhc2VzLilcbiAgICAgICAgICovXG4gICAgICAgIGNhc2VBZG1pbjogMjYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VyIFZpZXcgQWRtaW5cbiAgICAgICAgICovXG4gICAgICAgIHVzZXJWaWV3QWRtaW46IDI3XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBncm91cCBwZXJtaXNzaW9ucyBmb3IgYSBncm91cC5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIudXNlclBlcm1pc3Npb25zR3JvdXAgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHcm91cCBWaWRlbyAoVXNlciBpcyBhYmxlIHRvIHNlZSBhbGwgdmlkZW8uKVxuICAgICAgICAgKi9cbiAgICAgICAgZ3JvdXBWaWRlbzogMjgsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHcm91cCBBdWRpbyAoVXNlciBjYW4gYWNjZXNzIGFsbCBhdWRpby4pXG4gICAgICAgICAqL1xuICAgICAgICBncm91cEF1ZGlvOiAyOSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdyb3VwIFNlcmlhbCAoVXNlciBjYW4gYWNjZXNzIGFsbCBzZXJpYWwgcHJvZmlsZXMuKVxuICAgICAgICAgKi9cbiAgICAgICAgZ3JvdXBTZXJpYWw6IDMwLFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JvdXAgU29mdCBUcmlnZ2VyIChVc2VyIGNhbiBjb250cm9sIHNvZnQgdHJpZ2dlcnMuKVxuICAgICAgICAgKi9cbiAgICAgICAgZ3JvdXBTb2Z0VHJpZ2dlcjogMzFcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGF2YWlsYWJsZSBwZXJtaXNzaW9ucyBmb3IgYSBncm91cC5cbiAgICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIudXNlclBlcm1pc3Npb25zID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxpdmUgcGVybWlzc2lvbnMgZm9yIGEgZ3JvdXAuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIudXNlclBlcm1pc3Npb25zTGl2ZX1cbiAgICAgICAgICovXG4gICAgICAgIGxpdmVQZXJtaXNzaW9uczogRVZXRUIyLnVzZXJQZXJtaXNzaW9uc0xpdmUsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZWFyY2ggcGVybWlzc2lvbnMgZm9yIGEgZ3JvdXAuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIudXNlclBlcm1pc3Npb25zU2VhcmNofVxuICAgICAgICAgKi9cbiAgICAgICAgc2VhcmNoUGVybWlzc2lvbnM6IEVWV0VCMi51c2VyUGVybWlzc2lvbnNTZWFyY2gsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb25maWd1cmF0aW9uIHBlcm1pc3Npb25zIGZvciBhIGdyb3VwLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnVzZXJQZXJtaXNzaW9uc0NvbmZpZ31cbiAgICAgICAgICovXG4gICAgICAgIGNvbmZpZ1Blcm1pc3Npb25zOiBFVldFQjIudXNlclBlcm1pc3Npb25zQ29uZmlnLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGdyb3VwIHBlcm1pc3Npb25zIGZvciBhIGdyb3VwLlxuICAgICAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgZ3JvdXBQZXJtaXNzaW9uczogRVZXRUIyLnVzZXJQZXJtaXNzaW9uc0dyb3VwXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEJpdCBtYXNrIHZhbHVlcyBmb3IgdXNlciBncm91cCBwZXJtaXNzaW9uc1xuICAgICAqIEB0eXBlIHtPYmplY3QuPHN0cmluZywgZW51bT59XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5wZXJtaXNzaW9uc0JpdG1hc2sgPSB7XG4gICAgICAgIGxpdmVQZXJtaXNzaW9uczoge1xuICAgICAgICAgICAgYmFzZTogMHgwMDAwMSxcbiAgICAgICAgICAgIGdyb3VwczogMHgwMDAwMixcbiAgICAgICAgICAgIG1hcHM6IDB4MDAwMDQsXG4gICAgICAgICAgICB2aWV3czogMHgwMDAwOCxcbiAgICAgICAgICAgIHF1aWNrUmVwbGF5OiAweDAwMDEwLFxuICAgICAgICAgICAgcHR6OiAweDAwMDIwLFxuICAgICAgICAgICAgdHdvV2F5QXVkaW86IDB4MDAwNDAsXG4gICAgICAgICAgICBldmVudE1vbml0b3I6IDB4MDAwODAsXG4gICAgICAgICAgICBzYXZlSW1hZ2U6IDB4ODAwMDAsXG4gICAgICAgICAgICBwcmludEltYWdlOiAweDEwMDAwMCxcbiAgICAgICAgICAgIGNhbWVyYXM6IDB4MjAwMDAwLFxuICAgICAgICAgICAgdmlkZW9QdXNoOiAweDgwMDAwMFxuICAgICAgICB9LFxuICAgICAgICBzZWFyY2hQZXJtaXNzaW9uczoge1xuICAgICAgICAgICAgYmFzZTogMHgwMDEwMCxcbiAgICAgICAgICAgIGdyb3VwczogMHgwMDIwMCxcbiAgICAgICAgICAgIG1hcHM6IDB4MDA0MDAsXG4gICAgICAgICAgICB2aWV3czogMHgwMDgwMCxcbiAgICAgICAgICAgIGV2ZW50czogMHgwMTAwMCxcbiAgICAgICAgICAgIHNhdmVJbWFnZTogMHgwMjAwMCxcbiAgICAgICAgICAgIHByaW50SW1hZ2U6IDB4MDQwMDAsXG4gICAgICAgICAgICBidXJuRGlzYzogMHgwODAwMCxcbiAgICAgICAgICAgIGV4cG9ydFZpZGVvOiAweDEwMDAwLFxuICAgICAgICAgICAgc21hcnRTZWFyY2g6IDB4MjAwMDAsXG4gICAgICAgICAgICBjYXNlczogMHg0MDAwMCxcbiAgICAgICAgICAgIGNhbWVyYXM6IDB4NDAwMDAwXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZ1Blcm1pc3Npb25zOiB7XG4gICAgICAgICAgICB1c2VyQWRtaW46IDB4MSwgICAgICAgICAgICAgIC8vIFVzZXIgY2FuIGVkaXQgb3RoZXIgdXNlcnMgbmFtZXMsIHBhc3N3b3JkcywgZXRjLlxuICAgICAgICAgICAgdmlld0FkbWluOiAweDIsICAgICAgICAgICAgICAvLyBVc2VyIGNhbiBjcmVhdGUgYW5kIHNlZSB2aWV3cy5cbiAgICAgICAgICAgIGNhc2VBZG1pbjogMHg0LCAgICAgICAgICAgICAgLy8gVXNlciBjYW4gY3JlYXRlIGFuZCBzZWUgY2FzZXMuXG4gICAgICAgICAgICB1c2VyVmlld0FkbWluOiAweDhcbiAgICAgICAgfSxcbiAgICAgICAgZ3JvdXBQZXJtaXNzaW9uczoge1xuICAgICAgICAgICAgZ3JvdXBWaWRlbzogMHgxLCAgICAgICAgICAgICAgLy8gVXNlciBpcyBhYmxlIHRvIHNlZSBhbGwgdmlkZW8uXG4gICAgICAgICAgICBncm91cEF1ZGlvOiAweDIsICAgICAgICAgICAgICAvLyBVc2VyIGNhbiBhY2Nlc3MgYWxsIGF1ZGlvLlxuICAgICAgICAgICAgZ3JvdXBTZXJpYWw6IDB4NCwgICAgICAgICAgICAgLy8gVXNlciBjYW4gYWNjZXNzIGFsbCBzZXJpYWwgcHJvZmlsZXMuXG4gICAgICAgICAgICBncm91cFNvZnRUcmlnZ2VyOiAweDggICAgICAgICAvLyBVc2VyIGNhbiBjb250cm9sIHNvZnQgdHJpZ2dlcnMuXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFNlcnZlckxpY2Vuc2VJbmZvIG9iamVjdCByZXByZXNlbnRzIHRoZSBsaWNlbnNlIGluZm9ybWF0aW9uIG9uIHRoZSBzcGVjaWZpZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbWFjQWRkcmVzcz0nJ10gVGhlIE1BQyBhZGRyZXNzIG9mIHRoZSBzZXJ2ZXIgYXNzaWduZWQgdG8gdGhpcyBsaWNlbnNlLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW2V4cGlyYXRpb249bnVsbF0gVGhlIGV4cGlyYXRpb24gZGF0ZSBmb3IgdGhlIGxpY2Vuc2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNFeHBpcmVkPXRydWVdIFdoZXRoZXIgdGhlIHNlcnZlciBsaWNlbnNlIGlzIGV4cGlyZWQuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNSZXN0cmljdGVkPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgbGljZW5zZSBpcyByZXN0cmljdGVkLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2lzRW50ZXJwcmlzZT1mYWxzZV0gV2hldGhlciB0aGUgc2VydmVyIGxpY2Vuc2UgaXMgZW50ZXJwcmlzZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW21heEFuYWxvZ0NhbWVyYXM9MF0gTnVtYmVyIG9mIGFuYWxvZyBjYW1lcmFzIGNvbm5lY3RlZCB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4SXBDYW1lcmFzPTBdIE51bWJlciBvZiBpcCBjYW1lcmFzIGNvbm5lY3RlZCB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4Qm9hcmRzPTBdIE51bWJlciBvZiBib2FyZHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIuc2VydmVyTGljZW5zZVR5cGVzfSBbbGljZW5zZVR5cGU9RVZXRUIyLnNlcnZlckxpY2Vuc2VUeXBlcy51bmtub3duXSBUaGUgdHlwZSBvZiBsaWNlbnNlXG4gICAgICogYXNzb2NpYXRlZCB3aXRoIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtsaWNlbnNlS2V5PVwiXCJdIFRoZSBsaWNlbnNlIGtleSBhc3NvY2lhdGVkIHdpdGggdGhlIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZlckxpY2Vuc2VJbmZvID0gZnVuY3Rpb24obWFjQWRkcmVzcywgZXhwaXJhdGlvbiwgaXNFeHBpcmVkLCBpc1Jlc3RyaWN0ZWQsIGlzRW50ZXJwcmlzZSwgbWF4QW5hbG9nQ2FtZXJhcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhJcENhbWVyYXMsIG1heEJvYXJkcywgbGljZW5zZVR5cGUsIGxpY2Vuc2VLZXkpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHNlcnZlciBsaWNlbnNlIGlzIGV4cGlyZWQuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXNFeHBpcmVkID0gdHJ1ZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGxpY2Vuc2UgaXMgcmVzdHJpY3RlZC5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc1Jlc3RyaWN0ZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIGxpY2Vuc2UgaXMgZW50ZXJwcmlzZS5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0VudGVycHJpc2UgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV4cGlyYXRpb24gZGF0ZSBmb3IgdGhlIGxpY2Vuc2VcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHBpcmF0aW9uID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIE1BQyBhZGRyZXNzIG9mIHRoZSBzZXJ2ZXIgYXNzaWduZWQgdG8gdGhpcyBsaWNlbnNlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWFjQWRkcmVzcyA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIGFuYWxvZyBjYW1lcmFzIGNvbm5lY3RlZCB0byB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWF4QW5hbG9nQ2FtZXJhcyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgaXAgY2FtZXJhcyBjb25uZWN0ZWQgdG8gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1heElwQ2FtZXJhcyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgYm9hcmRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWF4Qm9hcmRzID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgbGljZW5zZSBhc3NvY2lhdGVkIHdpdGggdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnNlcnZlckxpY2Vuc2VUeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5saWNlbnNlVHlwZSA9IEVWV0VCMi5zZXJ2ZXJMaWNlbnNlVHlwZXMudW5rbm93bjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxpY2Vuc2Uga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGljZW5zZUtleSA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobWFjQWRkcmVzcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hY0FkZHJlc3MgPSBtYWNBZGRyZXNzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4cGlyYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHBpcmF0aW9uID0gZXhwaXJhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihpc0V4cGlyZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pc0V4cGlyZWQgPSBpc0V4cGlyZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaXNSZXN0cmljdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaXNSZXN0cmljdGVkID0gaXNSZXN0cmljdGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGlzRW50ZXJwcmlzZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlzRW50ZXJwcmlzZSA9IGlzRW50ZXJwcmlzZTtcbiAgICAgICAgfVxuICAgICAgICBpZihtYXhBbmFsb2dDYW1lcmFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWF4QW5hbG9nQ2FtZXJhcyA9IG1heEFuYWxvZ0NhbWVyYXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYobWF4SXBDYW1lcmFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWF4SXBDYW1lcmFzID0gbWF4SXBDYW1lcmFzO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1heEJvYXJkcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1heEJvYXJkcyA9IG1heEJvYXJkcztcbiAgICAgICAgfVxuICAgICAgICBpZihsaWNlbnNlVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmxpY2Vuc2VUeXBlID0gbGljZW5zZVR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYobGljZW5zZUtleSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmxpY2Vuc2VLZXkgPSBsaWNlbnNlS2V5O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTZXJ2ZXJEZXRhaWxJbmZvIG9iamVjdCByZXByZXNlbnRzIGRldGFpbGVkIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzcGVjaWZpZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbYWRkcmVzcz0nJ10gVGhlIHdlYiBhZGRyZXNzIGZvciB0aGlzIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MF0gVGhlIHBvcnQgbnVtYmVyIGZvciB0aGlzIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21vZGVsTm89JyddIFRoZSBtb2RlbCBudW1iZXIgZm9yIHRoaXMgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VyaWFsTm89JyddIFRoZSBzZXJpYWwgbnVtYmVyIGZvciB0aGlzIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3ZlcnNpb249JyddIFRoZSBzZXJ2ZXIgc29mdHdhcmUgdmVyc2lvbi5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2RheXNSZWNvcmRlZFZpZGVvPTBdIFRoZSBkYXlzIG9mIHJlY29yZGVkIHZpZGVvIHN0b3JlZCBvbiB0aGUgc2VydmVyLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmVyRGV0YWlsSW5mbyA9IGZ1bmN0aW9uKGFkZHJlc3MsIHBvcnQsIG1vZGVsTm8sIHNlcmlhbE5vLCB2ZXJzaW9uLCBkYXlzUmVjb3JkZWRWaWRlbykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHdlYiBhZGRyZXNzIGZvciB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvcnQgbnVtYmVyIGZvciB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvcnQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbW9kZWwgbnVtYmVyIGZvciB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1vZGVsTm8gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcmlhbCBudW1iZXIgZm9yIHRoaXMgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VyaWFsTm8gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBzb2Z0d2FyZSB2ZXJzaW9uLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmVyc2lvbiA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGF5cyBvZiByZWNvcmRlZCB2aWRlbyBzdG9yZWQgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRheXNSZWNvcmRlZFZpZGVvID0gMDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGFkZHJlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcztcbiAgICAgICAgfVxuICAgICAgICBpZihwb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYobW9kZWxObyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsTm8gPSBtb2RlbE5vO1xuICAgICAgICB9XG4gICAgICAgIGlmKHNlcmlhbE5vICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VyaWFsTm8gPSBzZXJpYWxObztcbiAgICAgICAgfVxuICAgICAgICBpZih2ZXJzaW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYoZGF5c1JlY29yZGVkVmlkZW8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5kYXlzUmVjb3JkZWRWaWRlbyA9IGRheXNSZWNvcmRlZFZpZGVvO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTeXN0ZW1Vc2FnZUluZm8gb2JqZWN0IHJlcHJlc2VudHMgaW5mb3JtYXRpb24gYWJvdXQgZWFjaCB1c2VyIG9uIHRoZSBzcGVjaWZpZWQgc3lzdGVtLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdXNlcm5hbWU9JyddIFRoZSB1c2VybmFtZSBvZiB0aGUgdXNlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5hY2Nlc3NMZXZlbFR5cGV9IFtsZXZlbD1FVldFQjIuYWNjZXNzTGV2ZWxUeXBlLnVua25vd25dIFRoZSBhY2Nlc3MgbGV2ZWwgb2YgdGhlIHVzZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFthZGRyZXNzPScnXSBUaGUgSVAgYWRkcmVzcyBvZiB0aGUgdXNlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3N0cmVhbXM9MF0gVGhlIG51bWJlciBvZiBhY3RpdmUgc3RyZWFtcyB2aWV3ZWQgYnkgdGhlIHVzZXIuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYXVkaXQ9ZmFsc2VdIFdoZXRoZXIgdGhlIHVzZXJzJyBjbGllbnQgaXMgYXVkaXRlZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2luc3RhbmNlTmFtZT0nJ10gVGhlIG5hbWUgb2YgdGhlIGluc3RhbmNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3lzdGVtVXNhZ2VJbmZvID0gZnVuY3Rpb24odXNlcm5hbWUsIGxldmVsLCBhZGRyZXNzLCBzdHJlYW1zLCBhdWRpdCwgaW5zdGFuY2VOYW1lKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgb2YgdGhlIHVzZXIuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51c2VybmFtZSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYWNjZXNzIGxldmVsIG9mIHRoZSB1c2VyLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuYWNjZXNzTGV2ZWxUeXBlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxldmVsID0gRVZXRUIyLmFjY2Vzc0xldmVsVHlwZS51bmtub3duO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSVAgYWRkcmVzcyBvZiB0aGUgdXNlci5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiBhY3RpdmUgc3RyZWFtcyB2aWV3ZWQgYnkgdGhlIHVzZXIuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdHJlYW1zID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlcnMnIGNsaWVudCBpcyBhdWRpdGVkLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGl0ID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbnN0YW5jZSBuYW1lLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluc3RhbmNlTmFtZSA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodXNlcm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKGxldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgICAgfVxuICAgICAgICBpZihhZGRyZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkcmVzcyA9IGFkZHJlc3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3RyZWFtcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0cmVhbXMgPSBzdHJlYW1zO1xuICAgICAgICB9XG4gICAgICAgIGlmKGF1ZGl0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaXQgPSBhdWRpdDtcbiAgICAgICAgfVxuICAgICAgICBpZihpbnN0YW5jZU5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZU5hbWUgPSBpbnN0YW5jZU5hbWU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFN5c3RlbVBsdWdpbkluZm8gb2JqZWN0IHJlcHJlc2VudHMgaW5mb3JtYXRpb24gb2YgZWFjaCBwbHVnaW4vbGlicmFyeSBvbiB0aGUgc3BlY2lmaWVkIHN5c3RlbS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9JyddIFRoZSBuYW1lIG9mIHRoZSBwbHVnaW4uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtmaWxlbmFtZT0nJ10gVGhlIGZpbGUgbmFtZSBvZiB0aGUgcGx1Z2luLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdmVyc2lvbj0nJ10gVGhlIHZlcnNpb24gbnVtYmVyIG9mIHRoZSBwbHVnaW4uXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc3RhdHVzPWZhbHNlXSBXaGV0aGVyIHRoZXJlIHdhcyBhbiBlcnJvciBpbiBhY2Nlc3NpbmcgdGhlIHBsdWdpbi5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2Vycm9yQ29kZT0tMV0gRXJyb3IgY29kZSBvZiB0aGUgcmVzcG9uc2UuIFNldCB0byAwIGlmIHN0YXR1cyBpcyB0cnVlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3lzdGVtUGx1Z2luSW5mbyA9IGZ1bmN0aW9uKG5hbWUsIGZpbGVuYW1lLCB2ZXJzaW9uLCBzdGF0dXMsIGVycm9yQ29kZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBsdWdpbiBuYW1lLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcGx1Z2luIGZpbGUgbmFtZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZpbGVuYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwbHVnaW4gdmVyc2lvbiBudW1iZXIuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52ZXJzaW9uID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwbHVnaW4gc3RhdHVzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXR1cyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZXJyb3IgcmVzcG9uc2UuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcnJvckNvZGUgPSAtMTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihmaWxlbmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGVuYW1lID0gZmlsZW5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodmVyc2lvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKGVycm9yQ29kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVycm9yQ29kZSA9IGVycm9yQ29kZTtcbiAgICAgICAgfVxuICAgICAgICBpZihzdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgICAgICAgICBpZih0aGlzLnN0YXR1cykge1xuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JDb2RlID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cblxuXG4gICAgLyoqXG4gICAgICogVGhlIHNlcnZlciBvYmplY3QgaXMgYSBjb250YWluZXIgZm9yIGVhY2ggc2VydmVyIGF0dGFjaGVkIHRvIHRoZSB3ZWIgc2VydmljZSBiYWNrZW5kLlxuICAgICAqIEl0IGlzIGluaXRpYWxseSBwb3B1bGF0ZWQgZnJvbSB0aGUgaW5mb3JtYXRpb24gcmV0cmlldmVkIGluIHRoZSB7QGxpbmsgRVZXRUIyLlNlcnZpY2UuZ2V0U2VydmVyc30gZnVuY3Rpb25cbiAgICAgKiBhbmQgY2FuIGJlIHVzZWQgZm9yIGZpbmRpbmcgdGhlIGRlc2lyZWQgc2VydmVyIGFuZCBmdXJ0aGVyIHJlcXVlc3RpbmcgZm9yIGEgbG9naW4gdGhyb3VnaFxuICAgICAqIHtAbGluayBFVldFQjIuU2VydmVyLmxvZ2lufSBvciByZXF1ZXN0aW5nIHRoZSBjYW1lcmEgZmVlZCBsaXN0IHRocm91Z2gge0BsaW5rIEVWV0VCMi5TZXJ2ZXIuZ2V0Q2FtZXJhc30uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBUaGUgc2VydmljZSBpbnN0YW5jZSBmb3IgdGhpcyBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPSdVbnNldCddIE5hbWUgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkPScnXSBJRCBvZiB0aGUgc2VydmVyIGFjY29yZGluZyB0byB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbG9naW5SZXF1aXJlZD1mYWxzZV0gV2hldGhlciBsb2dpbiBpcyByZXF1aXJlZCAodHJ1ZSA9IHJlcXVpcmVzIGxvZ2luKSBvciBwYXNzdGhyb3VnaC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc1Jlc3RyaWN0ZWQ9ZmFsc2VdIFdoZXRoZXIgdGhpcyBzZXJ2ZXIgaXMgYSByZXN0cmljdGVkIHNlcnZlciBvciBub3QuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZXNzaW9uSWQ9JyddIFNlc3Npb24gSWQgdG8gYmUgdXNlZCB3aXRoIHRoaXMgc2VydmVyLCB1c2VkIHByaW1hcmlseSBmb3Igc2VhcmNoZXMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtnbXRPZmZzZXQ9MF0gU2VydmVyJ3MgR01UIG9mZnNldCAodGltZXpvbmUpLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29zZD1mYWxzZV0gV2hldGhlciB0aGUgc2VydmVyIGhhcyBPU0QgZW5hYmxlZCBmb3IgaXRzIGNhbWVyYXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyRGV0YWlsSW5mb30gW2RldGFpbEluZm89bnVsbF0gQWRkaXRpb25hbCBkZXRhaWxzIGFib3V0IHRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbi5cbiAgICAgKiBOb3RlOiBTb21lIG9mIHRoZXNlIHZhbHVlcyBhcmUgb25seSBwb3B1bGF0ZWQgYWZ0ZXIgbG9nZ2luZyBpbiB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlckxpY2Vuc2VJbmZvfSBbbGljZW5zZUluZm89bnVsbF0gVGhlIGxpY2Vuc2luZyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VydmVyLiBOb3RlOiBUaGVzZVxuICAgICAqIHZhbHVlcyBhcmUgb25seSBwb3B1bGF0ZWQgYWZ0ZXIgbG9nZ2luZyBpbiB0byB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlVzZXJHcm91cHxFVldFQjIuVXNlclBlcm1pc3Npb25zfSBbdXNlckdyb3VwPW51bGxdIFRoZSBncm91cCBpbmZvcm1hdGlvbiBvZiB0aGUgY3VycmVudGx5IGxvZ2dlZFxuICAgICAqIGluIHVzZXIuIFRoaXMgcGFyYW1ldGVyIGlzIG92ZXJsb2FkZWQgYW5kIGFsc28gc3VwcG9ydHMgdGhlIGRlcHJlY2F0ZWQgYmVoYXZpb3Igb2YgcGFzc2luZyB0aGUgcGVybWlzc2lvbnMgb2JqZWN0XG4gICAgICoge0BsaW5rIEVWV0VCMi5Vc2VyUGVybWlzc2lvbnN9IG9mIHRoZSBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVXNlckdyb3VwfEVWV0VCMi5Vc2VyUGVybWlzc2lvbnN9IFtwYXNzdGhyb3VnaEdyb3VwPW51bGxdIFRoZSBncm91cCBpbmZvcm1hdGlvbiBvZiB0aGVcbiAgICAgKiBwYXNzdGhyb3VnaCB1c2VyLiBUaGlzIHBhcmFtZXRlciBpcyBvdmVybG9hZGVkIGFuZCBhbHNvIHN1cHBvcnRzIHRoZSBkZXByZWNhdGVkIGJlaGF2aW9yIG9mIHBhc3NpbmcgdGhlXG4gICAgICogcGVybWlzc2lvbnMgb2JqZWN0IHtAbGluayBFVldFQjIuVXNlclBlcm1pc3Npb25zfSBvZiB0aGUgcGFzc3Rocm91Z2ggdXNlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZXJ2ZXJNYW5hZ2VtZW50RmVhdHVyZXNbXX0gW21hbmFnZWRGZWF0dXJlcz1bXV0gVGhlIGxpc3Qgb2YgZmVhdHVyZXMgdGhhdCBhcmUgbWFuYWdlZCBieSBhblxuICAgICAqIGV4dGVybmFsIHNlcnZpY2UuICBBbnkgbWFuYWdlZCBmZWF0dXJlcyBhcmUgbm90IGFibGUgdG8gYmUgbW9kaWZpZWQgYnkgdGhlIHdlYiBzZXJ2aWNlLiAgRm9yIGV4YW1wbGUsXG4gICAgICogaWYgRVZXRUIyLnNlcnZlck1hbmFnZWRGZWF0dXJlcy51c2VyIGlzIHNldCwgY3JlYXRpbmcsIG1vZGlmeWluZywgYW5kIGRlbGV0aW5nIHVzZXJzIHdpbGwgZmFpbC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjYW5BdXRvTG9naW49ZmFsc2VdIEZsYWcgZGV0ZXJtaW5pbmcgaWYgdGhlIHNlcnZlciBoYXMgc3RvcmVkIGNyZWRlbnRpYWxzIGZvciB0aGlzIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlNlcnZlciA9IGZ1bmN0aW9uIChzZXJ2aWNlLCBuYW1lLCBpZCwgbG9naW5SZXF1aXJlZCwgaXNSZXN0cmljdGVkLCBzZXNzaW9uSWQsIGdtdE9mZnNldCwgb3NkLCBkZXRhaWxJbmZvLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGljZW5zZUluZm8sIHVzZXJHcm91cCwgcGFzc3Rocm91Z2hHcm91cCwgbWFuYWdlZEZlYXR1cmVzLCBjYW5BdXRvTG9naW4pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2aWNlIGluc3RhbmNlIGZvciB0aGlzIHNlcnZlclxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmljZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZSBvZiB0aGUgc2VydmVyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJ1Vuc2V0JztcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VydmVyIElEIGFjY29yZGluZyB0byB0aGUgd2ViIHNlcnZpY2VcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlc3Npb24gSUQgYWNjb3JkaW5nIHRvIHRoZSB3ZWIgc2VydmljZVxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2Vzc2lvbklkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgbG9naW4gaXMgcmVxdWlyZWQgKHRydWUgPSByZXF1aXJlcyBsb2dpbikgb3IgcGFzc3Rocm91Z2hcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sb2dpblJlcXVpcmVkID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhpcyBzZXJ2ZXIgaXMgYSByZXN0cmljdGVkIHNlcnZlciBvciBub3RcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXN0cmljdGVkID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdNVCBvZmZzZXQgKHRpbWV6b25lKVxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ210T2Zmc2V0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGlzIHNlcnZlciBoYXMgT1NEIGVuYWJsZWRcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vc2QgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXNlcm5hbWUgdXNlZCB0byBsb2cgaW4gdG8gdGhlIHNlcnZlclxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRkaXRpb25hbCBkZXRhaWxzIGFib3V0IHRoZSBzZXJ2ZXIgY29uZmlndXJhdGlvbi4gTm90ZTogU29tZSBvZiB0aGVzZSB2YWx1ZXMgYXJlIG9ubHkgcG9wdWxhdGVkIGFmdGVyXG4gICAgICAgICAqIGxvZ2dpbmcgaW4gdG8gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZlckRldGFpbEluZm9cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGV0YWlsSW5mbyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaWNlbnNpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNlcnZlci4gTm90ZTogVGhlc2UgdmFsdWVzIGFyZSBvbmx5IHBvcHVsYXRlZCBhZnRlciBsb2dnaW5nIGluIHRvIHRoZVxuICAgICAgICAgKiBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJMaWNlbnNlSW5mb1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5saWNlbnNlSW5mbyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBncm91cCBpbmZvcm1hdGlvbiBvZiB0aGUgY3VycmVudGx5IGxvZ2dlZCBpbiB1c2VyLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVXNlckdyb3VwXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJHcm91cCA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBncm91cCBpbmZvcm1hdGlvbiBvZiB0aGUgcGFzc3Rocm91Z2ggdXNlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlVzZXJHcm91cFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzdGhyb3VnaEdyb3VwID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBlcm1pc3Npb25zIG9mIHRoZSBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXIuXG4gICAgICAgICAqIEBkZXByZWNhdGVkIFRoaXMgb2JqZWN0IGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Yge0BsaW5rIEVWV0VCMi5Vc2VyR3JvdXB9IHdoaWNoIGluY2x1ZGVzIGluZm9ybWF0aW9uXG4gICAgICAgICAqIGFib3V0IGEgZ3JvdXAgYW5kIGFsbCBpdHMgcGVybWlzc2lvbnMuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5Vc2VyUGVybWlzc2lvbnNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlclBlcm1pc3Npb25zID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBlcm1pc3Npb25zIG9mIHRoZSBwYXNzdGhyb3VnaCB1c2VyLlxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG9iamVjdCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIuVXNlckdyb3VwfSB3aGljaCBpbmNsdWRlcyBpbmZvcm1hdGlvblxuICAgICAgICAgKiBhYm91dCBhIGdyb3VwIGFuZCBhbGwgaXRzIHBlcm1pc3Npb25zLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVXNlclBlcm1pc3Npb25zXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhc3N0aHJvdWdoUGVybWlzc2lvbnMgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXcmFwcGluZyBvYmplY3QgZm9yIGFsbCBkZXZpY2VzIGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJDb25maWd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24gPSBuZXcgRVZXRUIyLlNlcnZlckNvbmZpZyh0aGlzKTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIG9yIG5vdCB0aGUgc2VydmVyIGhhcyBzdG9yZWQgY3JlZGVudGlhbHMgdGhhdCBjYW4gYmUgdXNlZCB0byBsb2dpbiB0byB0aGlzIHNlcnZlci5cbiAgICAgICAgICogRWZmZWN0aXZlbHkgcGFzc3Rocm91Z2ggY3JlZGVudGlhbHMgYnV0IHNlcnZlcnMgYXJlIHNwYXduZWQgb24gZGVtYW5kIGluc3RlYWQgb2YgcGVyc2lzdGVudC5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbkF1dG9Mb2dpbiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGlzdCBvZiBmZWF0dXJlcyB0aGF0IGFyZSBtYW5hZ2VkIGJ5IGFuIGV4dGVybmFsIHNlcnZpY2UuICBBbnkgbWFuYWdlZCBmZWF0dXJlcyBhcmVcbiAgICAgICAgICogbm90IGFibGUgdG8gYmUgbW9kaWZpZWQgYnkgdGhlIHdlYiBzZXJ2aWNlLiAgRm9yIGV4YW1wbGUsIGlmXG4gICAgICAgICAqIEVWV0VCMi5zZXJ2ZXJNYW5hZ2VkRmVhdHVyZXMudXNlciBpcyBzZXQsIGNyZWF0aW5nLCBtb2RpZnlpbmcsIGFuZCBkZWxldGluZyB1c2VycyB3aWxsXG4gICAgICAgICAqIGZhaWwuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuc2VydmVyTWFuYWdlbWVudEZlYXR1cmVzW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hbmFnZWRGZWF0dXJlcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLCB1c2VkIGJ5IGNsb3N1cmUtY29udGFpbmVkIHV0aWxpdHkgZnVuY3Rpb25zLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcn1cbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYobG9naW5SZXF1aXJlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2luUmVxdWlyZWQgPSBsb2dpblJlcXVpcmVkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGlzUmVzdHJpY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3RyaWN0ZWQgPSBpc1Jlc3RyaWN0ZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2Vzc2lvbklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbklkID0gc2Vzc2lvbklkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYoIXRoaXMubG9naW5SZXF1aXJlZCkge1xuICAgICAgICAgICAgLy9TZXNzaW9uIElEIGRlZmF1bHRzIHRvIHRoZSBzZXJ2ZXIgSUQgZm9yIHBhc3N0aHJvdWdoIHNlcnZlcnMuXG4gICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHRoaXMuaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZ210T2Zmc2V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZ210T2Zmc2V0ID0gZ210T2Zmc2V0O1xuICAgICAgICB9XG4gICAgICAgIGlmKG9zZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm9zZCA9IG9zZDtcbiAgICAgICAgfVxuICAgICAgICBpZihkZXRhaWxJbmZvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZGV0YWlsSW5mbyA9IGRldGFpbEluZm87XG4gICAgICAgIH1cbiAgICAgICAgaWYobGljZW5zZUluZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5saWNlbnNlSW5mbyA9IGxpY2Vuc2VJbmZvO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYodXNlckdyb3VwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKHVzZXJHcm91cCBpbnN0YW5jZW9mIEVWV0VCMi5Vc2VyUGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVzZXJQZXJtaXNzaW9ucyA9IHVzZXJHcm91cDtcblxuICAgICAgICAgICAgICAgIHZhciB1c2VyR3JvdXBQZXJtaXNzaW9ucyA9IEVWV0VCMi51dGlsLmludGVybmFsLmdlbmVyYXRlR3JvdXBQZXJtaXNzaW9ucyh0aGlzLnVzZXJQZXJtaXNzaW9ucyk7XG4gICAgICAgICAgICAgICAgdGhpcy51c2VyR3JvdXAgPSBuZXcgRVZXRUIyLlVzZXJHcm91cCgnJywgdW5kZWZpbmVkLCB1c2VyR3JvdXBQZXJtaXNzaW9ucywgdW5kZWZpbmVkLCAnJywgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodXNlckdyb3VwIGluc3RhbmNlb2YgRVZXRUIyLlVzZXJHcm91cCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlckdyb3VwID0gdXNlckdyb3VwO1xuICAgICAgICAgICAgICAgIHRoaXMudXNlclBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwuaW50ZXJuYWxcbiAgICAgICAgICAgICAgICAgICAgLmdlbmVyYXRlVXNlclBlcm1pc3Npb25zKHRoaXMudXNlckdyb3VwLnBlcm1pc3Npb25zLCB0aGlzLnVzZXJHcm91cC5hY2Nlc3NMZXZlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYocGFzc3Rocm91Z2hHcm91cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZihwYXNzdGhyb3VnaEdyb3VwIGluc3RhbmNlb2YgRVZXRUIyLlVzZXJQZXJtaXNzaW9ucykge1xuICAgICAgICAgICAgICAgIHRoaXMucGFzc3Rocm91Z2hQZXJtaXNzaW9ucyA9IHBhc3N0aHJvdWdoR3JvdXA7XG5cbiAgICAgICAgICAgICAgICB2YXIgcGFzc3Rocm91Z2hHcm91cFBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwuaW50ZXJuYWxcbiAgICAgICAgICAgICAgICAgICAgLmdlbmVyYXRlR3JvdXBQZXJtaXNzaW9ucyh0aGlzLnBhc3N0aHJvdWdoUGVybWlzc2lvbnMpO1xuICAgICAgICAgICAgICAgIHRoaXMucGFzc3Rocm91Z2hHcm91cCA9IG5ldyBFVldFQjIuVXNlckdyb3VwKCcnLCB1bmRlZmluZWQsIHBhc3N0aHJvdWdoR3JvdXBQZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsICcnLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihwYXNzdGhyb3VnaEdyb3VwIGluc3RhbmNlb2YgRVZXRUIyLlVzZXJHcm91cCkge1xuICAgICAgICAgICAgICAgIHRoaXMucGFzc3Rocm91Z2hHcm91cCA9IHBhc3N0aHJvdWdoR3JvdXA7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXNzdGhyb3VnaFBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwuaW50ZXJuYWxcbiAgICAgICAgICAgICAgICAgICAgLmdlbmVyYXRlVXNlclBlcm1pc3Npb25zKHRoaXMucGFzc3Rocm91Z2hHcm91cC5wZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBhc3N0aHJvdWdoR3JvdXAuYWNjZXNzTGV2ZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKG1hbmFnZWRGZWF0dXJlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hbmFnZWRGZWF0dXJlcyA9IG1hbmFnZWRGZWF0dXJlcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYW5BdXRvTG9naW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jYW5BdXRvTG9naW4gPSBjYW5BdXRvTG9naW47XG4gICAgICAgIH1cblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIHNlcnZlciBjb25uZWN0aW9uIGlzIGNvbm5lY3RlZCBhcyBhIHBhc3N0aHJvdWdoIHNlcnZlciBvciB0aHJvdWdoIGxvZ2luIGFuZCBwYXNzd29yZC5cbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0gV2hldGhlciB0aGUgc2VydmVyIGNvbm5lY3Rpb24gaXMgYSBwYXNzdGhyb3VnaFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc1Bhc3N0aHJvdWdoU2VydmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gIXRoaXMubG9naW5SZXF1aXJlZCAmJiB0aGlzLmlkID09PSB0aGlzLnNlc3Npb25JZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBzZXJ2ZXIgY29ubmVjdGlvbiBpcyBsb2dnZWQgaW4sIHJlZ2FyZGxlc3Mgb2YgdGhlIHBhc3N0aHJvdWdoIHNldHRpbmcuXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFdoZXRoZXIgdGhlIHNlcnZlciBjb25uZWN0aW9uIGlzIGxvZ2dlZCBpblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0xvZ2dlZEluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pZCAhPT0gdGhpcy5zZXNzaW9uSWQgJiYgdGhpcy5zZXNzaW9uSWQgIT09ICcnO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIuZ2V0Q3VycmVudEdyb3VwUGVybWlzc2lvbnN9IHdoaWNoIHJldHVybnMgdGhlXG4gICAgICAgICAqIHBlcm1pc3Npb25zIGFzc29jaWF0ZWQgd2l0aCBhIGdyb3VwLlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcGVybWlzc2lvbnMgZm9yIHRoZSBzZXJ2ZXIsIHdoZXRoZXIgbG9nZ2VkIGluIG9yIHBhc3N0aHJvdWdoLlxuICAgICAgICAgKiBAcmV0dXJuIHtFVldFQjIuVXNlclBlcm1pc3Npb25zfSBUaGUgY3VycmVudCBwZXJtaXNzaW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRDdXJyZW50UGVybWlzc2lvbnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuaXNMb2dnZWRJbigpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudXNlclBlcm1pc3Npb25zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFzc3Rocm91Z2hQZXJtaXNzaW9ucztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHBlcm1pc3Npb25zIGFzc29jaWF0ZWQgd2l0aCBhIGdyb3VwLCB3aGV0aGVyIGxvZ2dlZCBpbiBvciBwYXNzdGhyb3VnaC5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLlVzZXJHcm91cFBlcm1pc3Npb25zfSBUaGUgY3VycmVudCBncm91cCBwZXJtaXNzaW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRDdXJyZW50R3JvdXBQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYodGhpcy5pc0xvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51c2VyR3JvdXAucGVybWlzc2lvbnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXNzdGhyb3VnaEdyb3VwLnBlcm1pc3Npb25zO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgZ3JvdXAgb2JqZWN0LCB3aGV0aGVyIGxvZ2dlZCBpbiBvciBwYXNzdGhyb3VnaC5cbiAgICAgICAgICogQHJldHVybiB7RVZXRUIyLlVzZXJHcm91cH0gVGhlIGN1cnJlbnQgZ3JvdXBcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudEdyb3VwID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZih0aGlzLmlzTG9nZ2VkSW4oKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVzZXJHcm91cDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhc3N0aHJvdWdoR3JvdXA7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByb2Nlc3NlcyB0aGUgSlNPTiBvdXRwdXQgZnJvbSBhIGxvZ2luIHJlc3BvbnNlLCB1cGRhdGluZyB0aGUgY3VycmVudCBzZXJ2ZXIgaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBsb2dpbiByZXNwb25zZSBkYXRhXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1c2VybmFtZSBUaGUgdXNlcm5hbWVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBwcm9jZXNzTG9naW5SZXNwb25zZSA9IGZ1bmN0aW9uKGRhdGEsIHVzZXJuYW1lKSB7XG4gICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHNlc3Npb24gSUQgYW5kIHVzZXJuYW1lXG4gICAgICAgICAgICBpbnN0YW5jZS5zZXNzaW9uSWQgPSBkYXRhLnNlc3Npb25JZDtcbiAgICAgICAgICAgIGluc3RhbmNlLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgICAgICBpZihkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLm5hbWUgPSBkYXRhLm5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgZGV0YWlsc0luZm9cbiAgICAgICAgICAgIGluc3RhbmNlLmRldGFpbEluZm8gPSAgbmV3IEVWV0VCMi5TZXJ2ZXJEZXRhaWxJbmZvKGRhdGEuYWRkcmVzcywgZGF0YS5wb3J0LCBkYXRhLm1vZGVsLCBkYXRhLnNlcmlhbCxcbiAgICAgICAgICAgICAgICBkYXRhLnZlcnNpb24sIGRhdGEuZGF5c1JlY29yZGVkVmlkZW8pO1xuXG4gICAgICAgICAgICB2YXIgbGljZW5zZSA9IGRhdGEubGljZW5zZUluZm87XG4gICAgICAgICAgICBpZihsaWNlbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBBZGRpdGlvbmFsIHNlcnZlciBpbmZvcm1hdGlvbiBpcyBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICB2YXIgZXhwaXJhdGlvbkRhdGUgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUobGljZW5zZS5leHBpcmF0aW9uRGF0ZSk7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UubGljZW5zZUluZm8gPSBuZXcgRVZXRUIyLlNlcnZlckxpY2Vuc2VJbmZvKGxpY2Vuc2UubWFjQWRkcmVzcywgZXhwaXJhdGlvbkRhdGUsIGxpY2Vuc2UuZXhwaXJlZCxcbiAgICAgICAgICAgICAgICAgICAgbGljZW5zZS5yZXN0cmljdGVkLCBsaWNlbnNlLmVudGVycHJpc2UsIGxpY2Vuc2UubWF4QW5hbG9nQ2FtZXJhcywgbGljZW5zZS5tYXhJcENhbWVyYXMsXG4gICAgICAgICAgICAgICAgICAgIGxpY2Vuc2UubWF4Qm9hcmRzLCBsaWNlbnNlLmxpY2Vuc2VUeXBlLCBsaWNlbnNlLmxpY2Vuc2VLZXkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdXNlclBlcm1pc3Npb25zO1xuICAgICAgICAgICAgdmFyIGN1c3RvbUdyb3VwUGVybWlzc2lvbnM7XG5cbiAgICAgICAgICAgIGlmKGRhdGEuZ3JvdXAgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmdyb3VwICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdmFyIGdyb3VwID0gZGF0YS5ncm91cDtcblxuICAgICAgICAgICAgICAgIHVzZXJQZXJtaXNzaW9ucyA9IEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NVc2VyR3JvdXBQZXJtaXNzaW9ucyhncm91cC5wZXJtaXNzaW9ucyk7XG4gICAgICAgICAgICAgICAgY3VzdG9tR3JvdXBQZXJtaXNzaW9ucyA9IG5ldyBFVldFQjIuQ3VzdG9tR3JvdXBQZXJtaXNzaW9ucyhncm91cC5jYW1lcmFzLCBncm91cC5hdWRpb3MsIGdyb3VwLnNlcmlhbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLnNvZnRUcmlnZ2Vycyk7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UudXNlckdyb3VwID0gbmV3IEVWV0VCMi5Vc2VyR3JvdXAoZ3JvdXAubmFtZSwgZ3JvdXAucm9sZSwgdXNlclBlcm1pc3Npb25zLCBncm91cC5wcmlvcml0aWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwLmd1aWQsIGN1c3RvbUdyb3VwUGVybWlzc2lvbnMpO1xuXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UudXNlclBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwuZ2VuZXJhdGVVc2VyUGVybWlzc2lvbnMoaW5zdGFuY2UudXNlckdyb3VwLnBlcm1pc3Npb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS51c2VyR3JvdXAuYWNjZXNzTGV2ZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdXNlclBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwucHJvY2Vzc1NlcnZlclBlcm1pc3Npb25zKGRhdGEpO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLnVzZXJQZXJtaXNzaW9ucyA9IHVzZXJQZXJtaXNzaW9ucztcblxuICAgICAgICAgICAgICAgIHZhciB1c2VyR3JvdXBQZXJtaXNzaW9ucyA9IEVWV0VCMi51dGlsLmludGVybmFsLmdlbmVyYXRlR3JvdXBQZXJtaXNzaW9ucyhpbnN0YW5jZS51c2VyUGVybWlzc2lvbnMpO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLnVzZXJHcm91cCA9IG5ldyBFVldFQjIuVXNlckdyb3VwKCcnLCB1bmRlZmluZWQsIHVzZXJHcm91cFBlcm1pc3Npb25zLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsICcnLCB1bmRlZmluZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbG9naW4gZnVuY3Rpb24gaXMgYSBoYW5kbGVyIGFuZCBwYXJzZXIgZm9yIHRoZSBhdXRoZW50aWNhdGVkIHNlcnZlciBzZXNzaW9uIGZ1bmN0aW9uYWxpdHlcbiAgICAgICAgICogb2YgdGhlIGV4YWNxVmlzaW9uIHdlYiBzZXJ2aWNlLiAgVGhpcyBmdW5jdGlvbiBpcyB0byBiZSB1dGlsaXplZCBhcyBhIG1ldGhvZCBmb3IgYWNjZXNzaW5nIHRoZSB0YXJnZXRlZFxuICAgICAgICAgKiBzZXJ2ZXIgdXNpbmcgY3JlZGVudGlhbHMtYmFzZWQgYWNjZXNzIChpbnN0ZWFkIG9mIGEgcHJlLWNvbmZpZ3VyZWQgcGFzc3Rocm91Z2gpLiAgSXQgdGFrZXMgdGhlIGRlc2lyZWRcbiAgICAgICAgICogdXNlcm5hbWUvcGFzc3dvcmQgY29tYmluYXRpb24gYW5kIHJlcXVlc3RzIHRoZSBzZXJ2ZXIgZm9yIGFuIGF1dGhlbnRpY2F0ZWQgc2Vzc2lvbi4gIElmIHRoZSByZXF1ZXN0IGlzXG4gICAgICAgICAqIGdyYW50ZWQsIGEgdW5pcXVlIHNlc3Npb24gSUQgaXMgYXBwbGllZCB0byB0aGUgc2VydmVyIGluc3RhbmNlIHRvIGFsbG93IGZvciBmdXJ0aGVyIGNvbW11bmljYXRpb25cbiAgICAgICAgICogd2l0aCB0aGUgc2VydmVyXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSwgdGhlIGluc3RhbmNlIG9mIHRoZVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZlcn0sIGFuZCwgaWYgcmVxdWVzdGVkLCB0aGUgbG9naW4gc2Vzc2lvbiB0b2tlbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lIFRoZSB1c2VybmFtZSBjcmVkZW50aWFsIGZvciBsb2dnaW5nIGludG8gdGhlIHNlcnZlclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcGFzc3dvcmQgVGhlIHBhc3N3b3JkIGNyZWRlbnRpYWwgZm9yIGxvZ2dpbmcgaW50byB0aGUgc2VydmVyXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NhdmVDcmVkZW50aWFscz1mYWxzZV0gV2hldGhlciB0byBzYXZlIHRoZSBjcmVkZW50aWFscyBhbmQgZ2VuZXJhdGUgYSBsb2dpbiB0b2tlbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9naW4gPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHVzZXJuYW1lLCBwYXNzd29yZCwgc2F2ZUNyZWRlbnRpYWxzKSB7XG5cbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZihzYXZlQ3JlZGVudGlhbHMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHNhdmVDcmVkZW50aWFscyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGb3J3YXJkLWRlY2xhcmluZyBkdWUgdG8gY2lyY3VsYXIgZGVwZW5kZW5jaWVzXG4gICAgICAgICAgICB2YXIgcHJvY2Vzc0xlZ2FjeVJlc3BvbnNlMzA7XG5cbiAgICAgICAgICAgIHZhciBvbkxvZ2luU2VydmVyRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZUlzSnNvbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlSXNKc29uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VJc0pzb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZih4aHIuc3RhdHVzID09PSAyMDAgJiYgIXJlc3BvbnNlSXNKc29uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHhoci5yZXNwb25zZVRleHQgIT09IEVWV0VCMi5lcnJvcnMubG9naW4gJiYgeGhyLnJlc3BvbnNlVGV4dC5zZWFyY2goJzxib2R5PicpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0xlZ2FjeVJlc3BvbnNlMzAoeGhyLnJlc3BvbnNlVGV4dCwgeGhyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih4aHIuc3RhdHVzID09PSAyMDAgfHwgeGhyLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yUmVzcG9uc2UuZXJyb3JUZXh0ID0gJ0luY29ycmVjdCBVc2VybmFtZS9QYXNzd29yZC4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHhoci5zdGF0dXMgPT09IDQwOSkge1xuICAgICAgICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlLmVycm9yVGV4dCA9ICdSZXN0cmljdGVkIHNlcnZlciBsaW1pdCByZWFjaGVkLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UsIHNlcnZlcik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFByb2Nlc3NlcyBsZWdhY3kgcmVzcG9uc2VzIGZyb20gMy4wIGFuZCBwcmlvciB3ZWIgc2VydmljZXMuICBUaGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAqIGlzIGluIHRoZSBmb3JtIG9mIGEgc3RyaW5nIG9mIHRoZSBzZXNzaW9uIElEIGRhdGEsIGEgSFRUUCBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICogb24gdGhlIFhIUiBvYmplY3QsIG9yIHRoZSBsb2dpbiBwYWdlIHRlbXBsYXRlIEhUTUwuXG4gICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2Vzc2lvbklkIFRoZSBzZXNzaW9uIElEIG9mIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB4aHIgVGhlIFhIUiBvYmplY3Qgb2YgdGhlIHJlcXVlc3QuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHByb2Nlc3NMZWdhY3lSZXNwb25zZTMwID0gZnVuY3Rpb24oc2Vzc2lvbklkLCB4aHIpIHtcbiAgICAgICAgICAgICAgICBpZihzZXNzaW9uSWQgPT09IEVWV0VCMi5lcnJvcnMubG9naW4gfHwgc2Vzc2lvbklkLnNlYXJjaCgnPGJvZHk+JykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uTG9naW5TZXJ2ZXJFcnJvcih4aHIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNlcnZlci5zZXNzaW9uSWQgPSBzZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgc2VydmVyLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXJ2ZXIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBQcm9jZXNzZXMgbGVnYWN5IHJlc3BvbnNlcyBmcm9tIDMuMi0zLjggd2ViIHNlcnZpY2VzLiBUaGUgcmVzcG9uc2UgaXMgYW4gb2JqZWN0XG4gICAgICAgICAgICAgKiBjb250YWluaW5nIHRoZSBzZXNzaW9uIElELCBidXQgbm8gb3RoZXIgaW5mb3JtYXRpb24sIHN1Y2ggYXMgZGV0YWlsSW5mbyBpc1xuICAgICAgICAgICAgICogcHJvdmlkZWQuXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgcmVzcG9uc2UgZGF0YVxuICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lIFRoZSB1c2VybmFtZSB1c2VkIHRvIGxvZ2luXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBwcm9jZXNzTGVnYWN5UmVzcG9uc2UzMl8zOCA9IGZ1bmN0aW9uKGRhdGEsIHVzZXJuYW1lKSB7XG4gICAgICAgICAgICAgICAgc2VydmVyLnNlc3Npb25JZCA9IGRhdGEuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIHNlcnZlci51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uTG9naW5TZXJ2ZXJTdWNjZXNzID0gZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMZWdhY3lSZXNwb25zZTMwKGRhdGEsIHhocik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3JSZXNwb25zZS5lcnJvclRleHQgPT09IEVWV0VCMi5lcnJvcnMuanNvbkxvZ2luRmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlLmVycm9yVGV4dCA9ICdJbmNvcnJlY3QgVXNlcm5hbWUvUGFzc3dvcmQuJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCBzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGRhdGEuYWRkcmVzcyA9PT0gdW5kZWZpbmVkICYmIGRhdGEubmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMZWdhY3lSZXNwb25zZTMyXzM4KGRhdGEsIHVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMb2dpblJlc3BvbnNlKGRhdGEsIHVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNlcnZlciwgZGF0YS50b2tlbik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25Mb2dpblNlcnZlclN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTG9naW5TZXJ2ZXJFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxvZ2luLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgdTogdXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHA6IHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICBsOiAxLFxuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VWZXJzaW9uOiAyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2F2ZUNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF0YS5zYXZlID0gJzEnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxvZ2luVG9rZW4gZnVuY3Rpb24gaXMgYSBjb252ZW5pZW5jZSBtZXRob2QgZm9yIHNhdmluZyBsb2dpbiBjcmVkZW50aWFscyB3aXRoIGEgdmFsaWQgdG9rZW5cbiAgICAgICAgICogdGFrZXMgdGhlIHBsYWNlIG9mIGEgcGFzc3dvcmQuXG4gICAgICAgICAqIE5vdGU6IFRva2VucyBleHBpcmUgYWZ0ZXIgb25lIHVzZSwgYmUgc3VyZSB0byBhbHdheXMgc3RvcmUgdGhlIG1vc3QgcmVjZW50bHkgZ2VuZXJhdGVkIHRva2VuLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCB0aGUgaW5zdGFuY2Ugb2YgdGhlXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlcnZlcn0sIGFuZCB0aGUgZ2VuZXJhdGVkIHN0b3JlZCBsb2dpbiBjcmVkZW50aWFscyB0b2tlbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVzZXJuYW1lIFRoZSB1c2VybmFtZSBjcmVkZW50aWFsIGZvciBsb2dnaW5nIGludG8gdGhlIHNlcnZlclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9rZW4gVGhlIHN0b3JlZCBsb2dpbiBjcmVkZW50aWFscyB0b2tlbiBmb3IgbG9nZ2luZyBpbnRvIHRoZSBzZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9naW5Ub2tlbiA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB1c2VybmFtZSwgdG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25Mb2dpblRva2VuRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UsIHNlcnZlcik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25Mb2dpblRva2VuU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCBzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0xvZ2luUmVzcG9uc2UoZGF0YSwgdXNlcm5hbWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXJ2ZXIsIGRhdGEudG9rZW4pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uTG9naW5Ub2tlblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTG9naW5Ub2tlbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMubG9naW4sXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICB1OiB1c2VybmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IHRva2VuLFxuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9naW4gd2l0aCBzdG9yZWQgY3JlZGVudGlhbHMgKHRoaXMgY2FuIG9ubHkgYmUgdXNlZCBpZiB0aGUgJ2NhbkF1dG9Mb2dpbicgcHJvcGVydHkgaXMgdHJ1ZSkuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UsIGFuZCB0aGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqICBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9naW5TdG9yZWRDcmVkZW50aWFscyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcztcblxuICAgICAgICAgICAgaWYgKCFzZXJ2ZXIuY2FuQXV0b0xvZ2luKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gc3RvcmVkIGNyZWRlbnRpYWxzIGF2YWlsYWJsZS4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCBzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uTG9naW5TdG9yZWRDcmVkZW50aWFsc0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCBzZXJ2ZXIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uTG9naW5TdG9yZWRDcmVkZW50aWFsc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSwgc2VydmVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHByb2Nlc3NMb2dpblJlc3BvbnNlKGRhdGEsICcnKTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc2VydmVyKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkxvZ2luU3RvcmVkQ3JlZGVudGlhbHNTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkxvZ2luU3RvcmVkQ3JlZGVudGlhbHNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxvZ2luLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAgICAgYXV0b19sb2dpbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0OiAnanNvbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbG9nb3V0IGZ1bmN0aW9uIGlzIGEgc2ltcGxlIGNhbGxpbmcgZnVuY3Rpb24gdGhlIHBlcmZvcm1zIGEgY2FsbCB0byB0aGUgZXhhY3FWaXNpb25cbiAgICAgICAgICogd2ViIHNlcnZpY2UgdG8gbG9nb3V0IG9mIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciByZXNldFNlcnZlckl0ZW1zID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgc2VydmVyLnVzZXJuYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgc2VydmVyLnNlc3Npb25JZCA9IHNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICBpZihzZXJ2ZXIudXNlclBlcm1pc3Npb25zICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlci51c2VyUGVybWlzc2lvbnMgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChzZXJ2ZXIubG9naW5SZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZihzZXJ2ZXIuZGV0YWlsSW5mbyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyLmRldGFpbEluZm8udmVyc2lvbiA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyLmRldGFpbEluZm8uZGF5c1JlY29yZGVkVmlkZW8gPSAwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHNlcnZlci5saWNlbnNlSW5mbyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyLmxpY2Vuc2VJbmZvID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkxvZ291dFNlcnZlckVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICByZXNldFNlcnZlckl0ZW1zKCk7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkxvZ291dFNlcnZlclN1Y2Nlc3MgPSBmdW5jdGlvbigvKmRhdGEsIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgcmVzZXRTZXJ2ZXJJdGVtcygpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkxvZ291dFNlcnZlclN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTG9nb3V0U2VydmVyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5sb2dvdXQsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHJlc3BvbnNlVG9DYW1lcmFJbnN0YW5jZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBzZXJ2ZXIpIHtcbiAgICAgICAgICAgIHZhciBkaXNhYmxlZCA9IHJlc3BvbnNlLmRpc2FibGVkICE9PSAwO1xuICAgICAgICAgICAgdmFyIHZpZGVvID0gcmVzcG9uc2Uuc3RhdGUgPT09IDA7XG4gICAgICAgICAgICAvLyBUaGUgc3RhdGUgcHJvcGVydHkgaXMgbm90IHByb3ZpZGVkIGluIDIuMCBzZXJ2aWNlcywgc28gbWFudWFsbHkgYWRkIGl0LlxuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3RhdGUgPT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kaXNhYmxlZCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHZpZGVvID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHB0eiA9IHJlc3BvbnNlLnB0eiA9PT0gMTtcbiAgICAgICAgICAgIHZhciBwdHpUeXBlID0gRVZXRUIyLnB0elR5cGVzLm5vbmU7XG4gICAgICAgICAgICBpZihwdHopIHtcbiAgICAgICAgICAgICAgICBwdHpUeXBlID0gRVZXRUIyLnB0elR5cGVzLnN0YW5kYXJkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihyZXNwb25zZS5pZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdGhlIElEIGZyb20gdGhlIHBsdWdpbiwgaW50ZXJmYWNlLCBkZXZpY2UsIGFuZCBjb250ZXh0IElEcy5cbiAgICAgICAgICAgICAgICByZXNwb25zZS5pZCA9IEVWV0VCMi51dGlsLnBpZFRvQ2FtZXJhSWQocmVzcG9uc2UucCwgcmVzcG9uc2UuaSwgcmVzcG9uc2UuZCwgcmVzcG9uc2UuY3R4KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHJlc29sdXRpb247XG4gICAgICAgICAgICBpZihyZXNwb25zZS5yZXNvbHV0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXNvbHV0aW9uID0gbmV3IEVWV0VCMi5DYW1lcmFSZXNvbHV0aW9uKHJlc3BvbnNlLnJlc29sdXRpb24ud2lkdGgsIHJlc3BvbnNlLnJlc29sdXRpb24uaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuQ2FtZXJhKHNlcnZlciwgcmVzcG9uc2UuaWQsIHJlc3BvbnNlLmN0eCwgcmVzcG9uc2UubmFtZSwgcHR6LCBkaXNhYmxlZCwgdmlkZW8sXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuT1NELCBwdHpUeXBlLCByZXNwb25zZS5kaWdpdGFsUHR6LCByZXNwb25zZS5mb3JtYXRzLCByZXNvbHV0aW9uLCByZXNwb25zZS5xdWFsaXR5LFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmZyYW1lUmF0ZSwgcmVzcG9uc2UucGFyZW50SWQsIHJlc3BvbnNlLnJvdGF0aW9uKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcdFRoZSBnZXRDYW1lcmFzIGZ1bmN0aW9uIGlzIG1lYW50IHRvIGFjdCBhcyBhIGhhbmRsZXIgYW5kIHBhcnNlciBmb3IgbGlzdCByZXRyaWV2YWwgZnJvbSB0aGUgZXhhY3FWaXNpb25cbiAgICAgICAgICpcdHdlYiBzZXJ2aWNlIGJhY2stZW5kLiAgSXQgdXNlcyBhc3luY2hyb25vdXMgamF2YXNjcmlwdCByZXF1ZXN0cyB0byB0aGUgc2VydmVyIGZvciBpbmZvcm1hdGlvbiBvblxuICAgICAgICAgKlx0dGhlIGF2YWlsYWJsZSBjYW1lcmEgZmVlZHMgYXZhaWxhYmxlIGZyb20gdGhlIHJlcXVlc3RlZCBzZXJ2ZXIuICBUaGUgaW5mb3JtYXRpb24gcmVjZWl2ZWQgZnJvbSB0aGlzIGNhbGxcbiAgICAgICAgICpcdGlzIHRoZW4gcGFyc2VkIGFuZCBwcm9wZXJseSBmb3JtYXR0ZWQgaW50byB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gb2JqZWN0cyB0aGF0IHRoZW4gcHJvdmlkZSB0aGUgcHJvcGVyXG4gICAgICAgICAqXHRtZXRob2RzIGZvciB2aWV3aW5nIHRoZSBjYW1lcmEgZmVlZHMuXG4gICAgICAgICAqXG4gICAgICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gVGhlIGZ1bmN0aW9uIGdldHNcbiAgICAgICAgICogIHBhc3NlZCB0aHJlZSBhcmd1bWVudHM6IHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCBhbiBhcnJheVxuICAgICAgICAgKiAgb2Yge0BsaW5rIEVWV0VCMi5DYW1lcmF9IGluc3RhbmNlcywgYW5kIGEgbW9kaWZpZWQgaW5zdGFuY2Ugb2Yge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9LiAoTm90ZTogVGhlIGluc3RhbmNlXG4gICAgICAgICAqICB1c2VkIGZvciB0aGUgY2FsbCBpcyBtb2RpZmllZCBhcyB3ZWxsLilcbiAgICAgICAgICogIEBwYXJhbSB7Qm9vbGVhbn0gW3Nob3dBbGw9ZmFsc2VdIERpc2FibGUgbGVnYWN5IGZpbHRlcmluZyB0aGF0IHJlbW92ZXMgY2FtZXJhIHN1Yi1jb250ZXh0cyB0aGF0IGFyZVxuICAgICAgICAgKiAgcXVhbGl0eSBzdHJlYW1zLiBTdWItY29udGV4dHMgc2F2ZWQgaW4gdmlld3MgYXJlIHN0aWxsIHJldHVybmVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRDYW1lcmFzID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzaG93QWxsKSB7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2hvd0FsbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBzaG93QWxsID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldENhbWVyYXNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvbkdldENhbWVyYXNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKGRhdGEgPT09IEVWV0VCMi5lcnJvcnMuY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vQ2FsbCB0aGUgZXJyb3IgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgb25HZXRDYW1lcmFzRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHYyLjAgd2ViIHNlcnZpY2VzIGRvbid0IHJldHVybiBhIHByb3BlciBKU09OIG9iamVjdCwgYXMgbm8gY2FsbGJhY2sgd3JhcHMgdGhlIHJlc3BvbnNlLiAgRm9yIHRoZXNlXG4gICAgICAgICAgICAgICAgLy8gcmVzcG9uc2VzLCBhdHRlbXB0IHRvIG1hbnVhbGx5IHBhcnNlIHRoZSBKU09OLlxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2goZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkdldENhbWVyYXNFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdExpc3QgPSBkYXRhLkNhbWVyYXM7XG5cbiAgICAgICAgICAgICAgICB2YXIgY2FtZXJhTGlzdCA9ICQubWFwKHJlc3VsdExpc3QsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlVG9DYW1lcmFJbnN0YW5jZShlbGVtZW50LCBzZXJ2ZXIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9VcGRhdGUgdGhlIHNlcnZlciB3aXRoIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAgICAgICAgICAgICAgICBpZihkYXRhLnRpbWV6b25lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyLmdtdE9mZnNldCA9IGRhdGEudGltZXpvbmU7XG4gICAgICAgICAgICAgICAgICAgIC8vVE9ETzogRmluZCBvdXQgd2h5IHNlcnZlci5vc2QgaXMgc2V0IHRoaXMgd2F5IGFuZCByZW1vdmUsIGlmIHBvc3NpYmxlLlxuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIub3NkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5yZXN0cmljdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyLnJlc3RyaWN0ZWQgPSBkYXRhLnJlc3RyaWN0ZWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBjYW1lcmFMaXN0LCBzZXJ2ZXIpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJyxcbiAgICAgICAgICAgICAgICBzaG93QWxsOiBzaG93QWxsID8gMSA6IDBcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldENhbWVyYXNTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldENhbWVyYXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmdldENhbWVyYUxpc3QsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKlx0VGhlIGdldEF1ZGlvRGV2aWNlcyBmdW5jdGlvbiBpcyBtZWFudCB0byBhY3QgYXMgYSBoYW5kbGVyIGFuZCBwYXJzZXIgZm9yIGxpc3QgcmV0cmlldmFsIGZyb20gdGhlXG4gICAgICAgICAqXHRleGFjcVZpc2lvbiB3ZWIgc2VydmljZSBiYWNrLWVuZC4gIEl0IHVzZXMgYXN5bmNocm9ub3VzIGphdmFzY3JpcHQgcmVxdWVzdHMgdG8gdGhlIHNlcnZlciBmb3IgaW5mb3JtYXRpb25cbiAgICAgICAgICpcdG9uIHRoZSBhdmFpbGFibGUgYXVkaW8gaW5wdXRzIGF2YWlsYWJsZSBmcm9tIHRoZSByZXF1ZXN0ZWQgc2VydmVyLiAgVGhlIGluZm9ybWF0aW9uIHJlY2VpdmVkIGZyb20gdGhpc1xuICAgICAgICAgKlx0Y2FsbCBpcyB0aGVuIHBhcnNlZCBhbmQgcHJvcGVybHkgZm9ybWF0dGVkIGludG8ge0BsaW5rIEVWV0VCMi5BdWRpb0RldmljZX0gb2JqZWN0cyB0aGF0IHRoZW4gcHJvdmlkZSB0aGVcbiAgICAgICAgICpcdHByb3BlciBtZXRob2RzIGZvciB1c2luZyB0aGUgYXVkaW8gaW5wdXQgc3RyZWFtcy5cbiAgICAgICAgICpcbiAgICAgICAgICogIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBUaGUgZnVuY3Rpb24gZ2V0c1xuICAgICAgICAgKiAgcGFzc2VkIHRocmVlIGFyZ3VtZW50czoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuXG4gICAgICAgICAqICBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLkF1ZGlvRGV2aWNlfSBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEF1ZGlvRGV2aWNlcyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXG4gICAgICAgICAgICB2YXIgb25HZXRBdWRpb0lucHV0c0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uR2V0QXVkaW9JbnB1dHNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MgfHwgZGF0YSA9PT0gRVZXRUIyLmVycm9ycy5jb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICBvbkdldEF1ZGlvSW5wdXRzRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRMaXN0ID0gZGF0YS5hdWRpbztcblxuICAgICAgICAgICAgICAgIHZhciBhdWRpb0lucHV0TGlzdCA9ICQubWFwKHJlc3VsdExpc3QsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuQXVkaW9EZXZpY2Uoc2VydmVyLCBlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGVsZW1lbnQuZW5hYmxlZCwgZWxlbWVudC5pbnB1dCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub3V0cHV0LCBlbGVtZW50LmZvcm1hdCwgZWxlbWVudC5mcmVxdWVuY3kpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBhdWRpb0lucHV0TGlzdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIG91dHB1dDogJ2pzb24nXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRBdWRpb0lucHV0c1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0QXVkaW9JbnB1dHNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmF1ZGlvLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RhcnRzIGFuIGV4cG9ydCBvbiB0aGUgc2VsZWN0ZWQgaW5wdXRzIGZvciB0aGUgc2V0IGR1cmF0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsXG4gICAgICAgICAqIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kXG4gICAgICAgICAqIGFuIHtAbGluayBFVldFQjIuVmlkZW9FeHBvcnR9IGluc3RhbmNlLCB3aGljaCBpcyB1c2VkIHRvIG1vbml0b3IgYW5kIHJldHJpZXZlXG4gICAgICAgICAqIHRoZSBleHBvcnQuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYVtdfEVWV0VCMi5BdWRpb0RldmljZVtdfEVWV0VCMi5TZXJpYWxEZXZpY2V9IGlucHV0cyBUaGUgaW5wdXRzIHRvIGV4cG9ydC4gIENhbiBiZSBhXG4gICAgICAgICAqIG1peGVkIGxpc3Qgb2Yge0BsaW5rIEVWV0VCMi5DYW1lcmF9LCB7QGxpbmsgRVZXRUIyLkF1ZGlvRGV2aWNlfSwgYW5kIHtAbGluayBFVldFQjIuU2VyaWFsRGV2aWNlfSBpbnN0YW5jZXMuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLnZpZGVvRXhwb3J0Rm9ybWF0VHlwZXN9IGZvcm1hdCBUaGUgZXhwb3J0IGZvcm1hdCB0eXBlIHJlcXVlc3RlZC5cbiAgICAgICAgICogQHBhcmFtIHtEYXRlfSBzdGFydCBEYXRlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJlZ2lubmluZyBvZiB0aGUgcmVxdWVzdGVkIHBlcmlvZC5cbiAgICAgICAgICogQHBhcmFtIHtEYXRlfSBlbmQgRGF0ZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBlbmQgb2YgdGhlIHJlcXVlc3RlZCBwZXJpb2QuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT1cIkV4cG9ydFwiXSBUaGUgZmlsZSBuYW1lICh3aXRob3V0IGV4dGVuc2lvbikgdG8gYmUgZ2l2ZW4gdG9cbiAgICAgICAgICogdGhlIGRvd25sb2FkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52aWRlb0V4cG9ydCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgaW5wdXRzLCBmb3JtYXQsIHN0YXJ0LCBlbmQsIG5hbWUpIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSGFuZGxlcyB0aGUgc3VjY2VzcyByZXNwb25zZSBmcm9tIHN0YXJ0aW5nIGFuIGV4cG9ydC5cbiAgICAgICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIFRoZSByZXNwb25zZSBkYXRhXG4gICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5leHBvcnRfaWQgVGhlIGdlbmVyYXRlZCBleHBvcnQgSURcbiAgICAgICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gZGF0YS5zdWNjZXNzIFdoZXRoZXIgdGhlIHJlcXVlc3Qgd2FzIHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhLmVycm9yVGV4dCBBbnkgZXJyb3IgdGV4dCBhc3NvY2lhdGVkIHdpdGggYSBmYWlsZWQgcmVxdWVzdC5cbiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nW119IGRhdGEuZmlsZW5hbWVzIFRoZSBmaWxlbmFtZXMgZm9yIHRoZSBleHBvcnQuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgdmlkZW9FeHBvcnQgPSBuZXcgRVZXRUIyLlZpZGVvRXhwb3J0KHNlcnZlciwgZGF0YS5leHBvcnRfaWQsIGlucHV0cywgZm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICBzdGFydCwgZW5kLCBkYXRhLmZpbGVuYW1lcyk7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdmlkZW9FeHBvcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBpbnB1dFF1ZXJ5ID0gJyc7XG4gICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgIGZvcihpPTA7IGk8aW5wdXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYoaW5wdXRzW2ldLmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoaW5wdXRRdWVyeS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UXVlcnkgKz0gJz8nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRRdWVyeSArPSAnJic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5VmFsO1xuICAgICAgICAgICAgICAgICAgICBpZihpbnB1dHNbaV0gaW5zdGFuY2VvZiBFVldFQjIuQ2FtZXJhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVZhbCA9ICdjYW1lcmEnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoaW5wdXRzW2ldIGluc3RhbmNlb2YgRVZXRUIyLkF1ZGlvRGV2aWNlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlWYWwgPSAnYXVkaW8nO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoaW5wdXRzW2ldIGluc3RhbmNlb2YgRVZXRUIyLlNlcmlhbERldmljZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5VmFsID0gJ3NlcmlhbCc7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaW5wdXRRdWVyeSArPSBxdWVyeVZhbCArICc9JysgaW5wdXRzW2ldLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYobmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbmFtZSA9ICdFeHBvcnQnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc3RhcnQ6IEVWV0VCMi51dGlsLkRhdGUySUVURihzdGFydCksXG4gICAgICAgICAgICAgICAgZW5kOiBFVldFQjIudXRpbC5EYXRlMklFVEYoZW5kKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgIGZvcm1hdDogZm9ybWF0XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb2V4cG9ydCArIGlucHV0UXVlcnksXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIGNhbGxzIHRvIHRoaXMgc2VydmVyIHJlcXVpcmUgcmVzb3VyY2Uga2V5cyBhcHBsaWVkIHRvIHN0YXRlLWNoYW5naW5nIG9wZXJhdGlvbnMuXG4gICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFdoZXRoZXIgdGhpcyBzZXJ2ZXIgcmVxdWlyZXMgcmVzb3VyY2Uga2V5c1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXF1aXJlc1Jlc291cmNlS2V5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc1Bhc3N0aHJvdWdoU2VydmVyKCkgJiYgdGhpcy5zZXJ2aWNlLmNzcmY7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgc3RhdHVzIGZvciB0aGUgcmVxdWVzdGVkIGl0ZW1zLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsXG4gICAgICAgICAqIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kXG4gICAgICAgICAqIGEge0BsaW5rIEVWV0VCMi5TdGF0dXN9IGluc3RhbmNlLCB3aGljaCBkZXRhaWxzIHRoZSBzdGF0dXMgb2YgZWFjaCByZXF1ZXN0ZWQgaXRlbS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhW118RVZXRUIyLlRyaWdnZXJbXXxFVldFQjIuTWFwW119IGl0ZW1zIEFuIGFycmF5IG9mIGl0ZW1zIHRvIHJldHJpZXZlIHN0YXR1cy5cbiAgICAgICAgICogVGhpcyBjYW4gYmUgYSBtaXhlZCBhcnJheSBvZiB0aGUgc3BlY2lmaWVkIGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3RhdHVzID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBpdGVtcykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkdldFN0YXR1c0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0U3RhdHVzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciBjYW1lcmFTdGF0dXNlcyA9ICQubWFwKGRhdGEuY2FtZXJhLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9ICQuZ3JlcChpdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBFVldFQjIuQ2FtZXJhICYmIGVsZW1lbnQuaWQudG9TdHJpbmcoKSA9PT0gaXRlbS5pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU3RhdHVzQ2FtZXJhSXRlbShpbnN0YW5jZSwgZWxlbWVudC5zdGF0dXMubW90aW9uLCBlbGVtZW50LnN0YXR1cy5sb3NzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlclN0YXR1c2VzID0gJC5tYXAoZGF0YS50cmlnZ2VyLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9ICQuZ3JlcChpdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBFVldFQjIuVHJpZ2dlciAmJiBlbGVtZW50LmlkLnRvU3RyaW5nKCkgPT09IGl0ZW0uaWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlN0YXR1c1RyaWdnZXJJdGVtKGluc3RhbmNlLCBlbGVtZW50LnN0YXR1cy5zdGF0ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1hcFN0YXR1c2VzID0gJC5tYXAoZGF0YS5tYXAsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gJC5ncmVwKGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSBpbnN0YW5jZW9mIEVWV0VCMi5NYXAgJiYgZWxlbWVudC5pZC50b1N0cmluZygpID09PSBpdGVtLmlkLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TdGF0dXNNYXBJdGVtKGluc3RhbmNlLCBlbGVtZW50LnN0YXR1cy5tb3Rpb24sIGVsZW1lbnQuc3RhdHVzLmxvc3MpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IG5ldyBFVldFQjIuU3RhdHVzKHNlcnZlciwgY2FtZXJhU3RhdHVzZXMsIHRyaWdnZXJTdGF0dXNlcywgbWFwU3RhdHVzZXMpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc3RhdHVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGl0ZW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBubyBpdGVtcywganVzdCBpbW1lZGlhdGVseSBzZW5kIGFuIGVtcHR5IHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogW10sXG4gICAgICAgICAgICAgICAgICAgIG1hcDogW11cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIG9uR2V0U3RhdHVzU3VjY2VzcyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHZhciBxdWVyeVN0cmluZyA9ICQubWFwKGl0ZW1zLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYoZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5DYW1lcmEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdjYW1lcmE9JyArIGVsZW1lbnQuaWQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5UcmlnZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAndHJpZ2dlcj0nICsgZWxlbWVudC5pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihlbGVtZW50IGluc3RhbmNlb2YgRVZXRUIyLk1hcCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ21hcD0nICsgZWxlbWVudC5pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmpvaW4oJyYnKTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRTdGF0dXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnN0YXR1cyArICc/JyArIHF1ZXJ5U3RyaW5nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgb3ZlcmFsbCBzdGF0dXMgZm9yIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGxcbiAgICAgICAgICogY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmRcbiAgICAgICAgICogYSB7QGxpbmsgRVZXRUIyLlNlcnZlclN0YXR1c30gaW5zdGFuY2UsIHdoaWNoIGRldGFpbHMgdGhlIG92ZXJhbGwgc3RhdHVzIG9mIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFNlcnZlclN0YXR1cyA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uU2VydmljZUdldFNlcnZlcnNTdGF0dXMgPSBmdW5jdGlvbihyZXNwb25zZSwgc3RhdHVzZXMpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VydmVySXRlbTtcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlckl0ZW0gPSBzdGF0dXNlc1swXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UsIHNlcnZlckl0ZW0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlLmdldFNlcnZlcnNTdGF0dXMob25TZXJ2aWNlR2V0U2VydmVyc1N0YXR1cywgW3RoaXNdKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTm90aWZpZXMgdGhlIHNlcnZlciB0aGF0IGEgcHJvY2VzcyBpcyBzdGlsbCBpbiB1c2UuICBUaGlzIHByZXZlbnRzIGFuIGluYWN0aXZlIHNlcnZlciBmcm9tIGJlaW5nIGNsb3NlZC5cbiAgICAgICAgICogTm90ZTogVGhpcyBkb2VzIG5vdCBuZWVkIHRvIGJlIGNhbGxlZCBvbiBwYXNzdGhyb3VnaCBzZXJ2ZXJzLCBhcyB0aGV5IHdpbGwgbmV2ZXIgYmUgY2xvc2VkLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tdIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubm90aWZ5VXNlID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgZXhlY3V0ZUNhbGxiYWNrID0gZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgaWYoY2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbk5vdGlmeVVzZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGV4ZWN1dGVDYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbk5vdGlmeVVzZVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZGF0YS5zdWNjZXNzLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgZXhlY3V0ZUNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZighdGhpcy5pc0xvZ2dlZEluKCkgJiYgIXRoaXMuaXNQYXNzdGhyb3VnaFNlcnZlcigpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdOb24tbG9nZ2VkIGluIHNlcnZlcnMgZG8gbm90IG5lZWQgbm90aWZpY2F0aW9uLicpO1xuICAgICAgICAgICAgICAgIGV4ZWN1dGVDYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbk5vdGlmeVVzZVN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTm90aWZ5VXNlRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5sb2dpbixcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdub3RpZnknXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyB3aXRoIHRoZSBzZXJ2ZXIgdG8gdmVyaWZ5IHRoYXQgYSBwcm9jZXNzIGlzIHN0aWxsIGF2YWlsYWJsZS4gVGhpcyBwcmV2ZW50cyBtYWtpbmcgYWNjaWRlbnRhbFxuICAgICAgICAgKiByZXF1ZXN0cyB0byBzZXJ2ZXJzIHRoYXQgaGF2ZSB0aW1lZCBvdXQgZHVlIHRvIGluYWN0aXZpdHkgYW5kIGFyZSBubyBsb25nZXIgcHJlc2VudC5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhIEJvb2xlYW5cbiAgICAgICAgICogaW5kaWNhdGluZyB0aGUgdmFsaWRpdHkgb2YgdGhlIHNlc3Npb24gSUQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoZWNrU2Vzc2lvbiA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkNoZWNrU2Vzc2lvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkNoZWNrU2Vzc2lvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhIC8qLCB0ZXh0U3RhdHVzLCB4aHIqLyl7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZGF0YS5zdWNjZXNzLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLmlzVmFsaWQpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uQ2hlY2tTZXNzaW9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25DaGVja1Nlc3Npb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxvZ2luLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogdGhpcy5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3ZlcmlmeSdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIHVzZXJzIGluZm9ybWF0aW9uIGZvciB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlN5c3RlbVVzYWdlSW5mb30gaW5zdGFuY2VzLFxuICAgICAgICAgKiB3aGljaCByZXByZXNlbnQgdGhlIHVzYWdlIGluZm9ybWF0aW9uIGZvciBlYWNoIHVzZXIgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3lzdGVtVXNhZ2VJbmZvID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXRTeXN0ZW1Vc2FnZUluZm9FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRTeXN0ZW1Vc2FnZUluZm9TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gZGF0YS51c2VycztcblxuICAgICAgICAgICAgICAgdmFyIHVzZXJzTGlzdCA9ICQubWFwKHVzZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlN5c3RlbVVzYWdlSW5mbyhlbGVtZW50LnVzZXJuYW1lLCBlbGVtZW50LmxldmVsLCBlbGVtZW50LmFkZHJlc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3RyZWFtcywgZWxlbWVudC5hdWRpdCwgZWxlbWVudC5pbnN0YW5jZU5hbWUpO1xuICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdXNlcnNMaXN0KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFN5c3RlbVVzYWdlSW5mb1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0U3lzdGVtVXNhZ2VJbmZvRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJ2ZXJVc2VycyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBwbHVnaW4gaW5mb3JtYXRpb24gZnJvbSB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlN5c3RlbVBsdWdpbkluZm99IGluc3RhbmNlcyxcbiAgICAgICAgICogd2hpY2ggcmVwcmVzZW50IHRoZSB2ZXJzaW9uIGluZm9ybWF0aW9uIGFuZCBzdGF0dXMgZm9yIGVhY2ggcGx1Z2luL2xpYnJhcnkgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3lzdGVtUGx1Z2luSW5mbyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcztcbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uR2V0U3lzdGVtUGx1Z2luSW5mb0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkdldFN5c3RlbVBsdWdpbkluZm9TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciBwbHVnaW5zID0gZGF0YS5wbHVnaW5zO1xuXG4gICAgICAgICAgICAgICAgdmFyIHBsdWdpbnNMaXN0ID0gJC5tYXAocGx1Z2lucywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TeXN0ZW1QbHVnaW5JbmZvKGVsZW1lbnQubmFtZSwgZWxlbWVudC5maWxlbmFtZSwgZWxlbWVudC52ZXJzaW9uLCBlbGVtZW50LmlzT3BlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub3BlbkNvZGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgcGx1Z2luc0xpc3QpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3lzdGVtUGx1Z2luSW5mb1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0U3lzdGVtUGx1Z2luSW5mb0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VydmVyUGx1Z2lucyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0IHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gZnJvbSB0aGUgc3lzdGVtLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGEge0BsaW5rIEVWV0VCMi5TeXN0ZW1Db25maWd9IGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTeXN0ZW1JbmZvcm1hdGlvbiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcztcblxuICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXRTeXN0ZW1JbmZvRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0U3lzdGVtSW5mb1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlzVXRmOEVuYWJsZWQgPSBkYXRhLnV0ZjhFbmFibGVkO1xuICAgICAgICAgICAgICAgIHZhciBzeXN0ZW1OYW1lID0gZGF0YS5zeXN0ZW1OYW1lO1xuICAgICAgICAgICAgICAgIHZhciBzeXN0ZW1IYXJkd2FyZUluZm8gPSBuZXcgRVZXRUIyLlN5c3RlbUhhcmR3YXJlSW5mbyhkYXRhLnNlcmlhbE51bWJlciwgZGF0YS5tb2RlbE51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5tb3RoZXJib2FyZCwgZGF0YS5iaW9zLCBkYXRhLnByb2Nlc3NvciwgZGF0YS50b3RhbE1lbW9yeSwgZGF0YS5vcywgZGF0YS5ydW5uaW5nU2luY2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN5c3RlbUNvbmZpZ0luZm8gPSBuZXcgRVZXRUIyLlN5c3RlbUNvbmZpZyhzZXJ2ZXIsIHN5c3RlbU5hbWUsIHN5c3RlbUhhcmR3YXJlSW5mbywgaXNVdGY4RW5hYmxlZCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHN5c3RlbUNvbmZpZ0luZm8pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3lzdGVtSW5mb1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0U3lzdGVtSW5mb0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc3lzdGVtSW5mbyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlIGEgbGlzdCBvZiB0aGUgY3VzdG9tIGdyb3VwcyBhdmFpbGFibGUgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlVzZXJHcm91cH0gaW5zdGFuY2VzIGFuZCB0aGUgYXNzb2NpYXRlZFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlcnZlcn0gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFVzZXJHcm91cHMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldFVzZXJHcm91cHNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRVc2VyR3JvdXBzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBjdXN0b21Hcm91cHNMaXN0ID0gZGF0YS5ncm91cHM7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VzdG9tVXNlckdyb3VwcyA9ICQubWFwKGN1c3RvbUdyb3Vwc0xpc3QsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjY2Vzc0xldmVsID0gZWxlbWVudC5yb2xlO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXJtaXNzaW9ucyA9IEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NVc2VyR3JvdXBQZXJtaXNzaW9ucyhlbGVtZW50LnBlcm1pc3Npb25zKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcHJpb3JpdGllcyA9ICQubWFwKGVsZW1lbnQucHJpb3JpdGllcywgZnVuY3Rpb24oZWxlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVXNlckdyb3VwUHJpb3JpdHkoZWxlbS5wcmlvcml0eSwgZWxlbS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXN0b21Hcm91cFBlcm1pc3Npb25zID0gbmV3IEVWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zKGVsZW1lbnQuY2FtZXJhcywgZWxlbWVudC5hdWRpb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VyaWFscywgZWxlbWVudC5zb2Z0VHJpZ2dlcnMpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlVzZXJHcm91cChlbGVtZW50Lm5hbWUsIGFjY2Vzc0xldmVsLCBwZXJtaXNzaW9ucywgcHJpb3JpdGllcywgZWxlbWVudC5ndWlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUdyb3VwUGVybWlzc2lvbnMsIGVsZW1lbnQubWFuYWdlZCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGN1c3RvbVVzZXJHcm91cHMsIHNlcnZlcik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRVc2VyR3JvdXBzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRVc2VyR3JvdXBzRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy51c2VyR3JvdXBzLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogdGhpcy5zZXNzaW9uSWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmUgYSBsaXN0IG9mIHVzZXJzIHRoYXQgZXhpc3Qgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLCBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlVzZXJ9IGluc3RhbmNlcyBhbmQgdGhlIGFzc29jaWF0ZWRcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRVc2VycyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcztcbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uR2V0VXNlcnNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRVc2Vyc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHVzZXJzTGlzdCA9IGRhdGEudXNlcnM7XG4gICAgICAgICAgICAgICAgdmFyIHVzZXJzID0gJC5tYXAodXNlcnNMaXN0LCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlVzZXIoc2VydmVyLCBlbGVtZW50Lm5hbWUsIGVsZW1lbnQuZ3JvdXBOYW1lLCBlbGVtZW50LmFjY291bnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5pc09ycGhhbmVkLCBlbGVtZW50Lm1hbmFnZWQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCB1c2Vycywgc2VydmVyKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFVzZXJzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRVc2Vyc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudXNlcnMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGQgYSBuZXcgdXNlciB0byB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkXG4gICAgICAgICAqIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlVzZXJHcm91cH0gdXNlckdyb3VwIFRoZSB1c2VyIGdyb3VwIGluZm9ybWF0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5Vc2VyfSB1c2VyIFRoZSB1c2VyIHRvIGNyZWF0ZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZCBmb3IgdGhlIG5ldyB1c2VyIGFjY291bnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZFVzZXIgPSBmdW5jdGlvbihjYWxsYmFjaywgdXNlckdyb3VwLCB1c2VyLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25BZGRVc2VyRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uQWRkVXNlclN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCB1c2VyLCB1c2VyR3JvdXAsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBiaXRtYXNrID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwuZ2VuZXJhdGVQZXJtaXNzaW9uc0JpdG1hc2sodXNlckdyb3VwLnBlcm1pc3Npb25zKTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBuYW1lOiB1c2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgICAgICByb2xlOiB1c2VyR3JvdXAuYWNjZXNzTGV2ZWwsXG4gICAgICAgICAgICAgICAgYWNjb3VudFR5cGU6IHVzZXIuYWNjb3VudFR5cGUsXG4gICAgICAgICAgICAgICAgZ3VpZDogdXNlckdyb3VwLmd1aWQsXG4gICAgICAgICAgICAgICAgZ3JwTmFtZTogdXNlckdyb3VwLm5hbWUsXG4gICAgICAgICAgICAgICAgZ3JwR3JvdXBQZXJtaXNzaW9uOiBiaXRtYXNrLmdyb3VwLFxuICAgICAgICAgICAgICAgIGdycFVzZXJQZXJtaXNzaW9uOiBiaXRtYXNrLnVzZXIsXG4gICAgICAgICAgICAgICAgZ3JwQWRtaW5QZXJtaXNzaW9uOiBiaXRtYXNrLmFkbWluLFxuICAgICAgICAgICAgICAgIGdycENhbWVyYXM6IHVzZXJHcm91cC5jdXN0b21Hcm91cFBlcm1pc3Npb25zLmNhbWVyYXMuam9pbihcIixcIiksXG4gICAgICAgICAgICAgICAgZ3JwQXVkaW9zOiB1c2VyR3JvdXAuY3VzdG9tR3JvdXBQZXJtaXNzaW9ucy5hdWRpb3Muam9pbihcIixcIiksXG4gICAgICAgICAgICAgICAgZ3JwU2VyaWFsczogdXNlckdyb3VwLmN1c3RvbUdyb3VwUGVybWlzc2lvbnMuc2VyaWFscy5qb2luKFwiLFwiKSxcbiAgICAgICAgICAgICAgICBncnBTb2Z0VHJpZ2dlcnM6IHVzZXJHcm91cC5jdXN0b21Hcm91cFBlcm1pc3Npb25zLnNvZnRUcmlnZ2Vycy5qb2luKFwiLFwiKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHByaW9yaXR5ID0gdXNlckdyb3VwLmdldFByaW9yaXR5KEVWV0VCMi5ncm91cFByaW9yaXR5VHlwZXMucHR6KTtcbiAgICAgICAgICAgIGlmIChwcmlvcml0eSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ2dycFB0elByaW9yaXR5J10gPSBwcmlvcml0eS52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJpb3JpdHkgPSB1c2VyR3JvdXAuZ2V0UHJpb3JpdHkoRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlcy50d29XYXlBdWRpbyk7XG4gICAgICAgICAgICBpZiAocHJpb3JpdHkgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBBdWRpb1ByaW9yaXR5J10gPSBwcmlvcml0eS52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJpb3JpdHkgPSB1c2VyR3JvdXAuZ2V0UHJpb3JpdHkoRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlcy5jbGllbnQpO1xuICAgICAgICAgICAgaWYgKHByaW9yaXR5ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHBhcmFtc1snZ3JwUmVtb3RlUHJpb3JpdHknXSA9IHByaW9yaXR5LnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25BZGRVc2VyU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25BZGRVc2VyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy51c2VycyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlcyBmb3IgdGhpcyBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlfSBvYmplY3RzIGRldGFpbGluZyBhbGwgb2YgdGhlIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2VzXG4gICAgICAgICAqICAgYXNzb2NpYXRlZCB3aXRoIHRoZVxuICAgICAgICAgKiAgc2VydmVyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTZWN1cml0eUludGVncmF0aW9uc0RldmljZXMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2VuZCB0aGUgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBkZXZpY2VzXG4gICAgICAgICAgICAgICAgdmFyIGRldmljZXMgPSAkLm1hcChkYXRhLmRldmljZXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2Uoc2VydmVyLCBlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGVsZW1lbnQuaG9zdCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucG9ydCwgZWxlbWVudC50eXBlLCBlbGVtZW50LmVuYWJsZWQsIGVsZW1lbnQuY29ubmVjdGlvblN0YXR1cywgZWxlbWVudC5maXJtd2FyZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VyaWFsLCBlbGVtZW50LnVzZXIsIGVsZW1lbnQuYXV0aCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRldmljZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VjdXJpdHlJbnRlZ3JhdGlvbkRldmljZXMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBiYXNpYyBzZXJpYWwgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW5cbiAgICAgICAgICogIHtAbGluayBFVldFQjIuU2VydmVyU2VyaWFsU3VwcG9ydH0gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFNlcmlhbEluZm8gPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2VuZCB0aGUgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YVN1cHBvcnRzID0gZGF0YS5zZXJpYWwuc3VwcG9ydHM7XG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbFN1cHBvcnRzID0gbmV3IEVWV0VCMi5TZXJ2ZXJTZXJpYWxGdW5jdGlvbmFsaXR5KGRhdGFTdXBwb3J0cy5hZHZhbmNlZExpbmVFbmRpbmcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTdXBwb3J0cy5zb3RNYXJrZXJzLCBkYXRhU3VwcG9ydHMueG1sRm9ybWF0dGluZywgZGF0YVN1cHBvcnRzLnJlcGxhY2UsIGRhdGFTdXBwb3J0cy5ydWxlcyk7XG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbEluZm8gPSBuZXcgRVZXRUIyLlNlcnZlclNlcmlhbFN1cHBvcnQoc2VydmVyLCBzZXJpYWxTdXBwb3J0cywgZGF0YS5zZXJpYWwudWFydCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZXJpYWwuaXAsIGRhdGEuc2VyaWFsLnVzZXMsIGRhdGEuc2VyaWFsLmlwVHlwZXMpO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZXJpYWxJbmZvKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcnZlclNlcmlhbEluZm8sXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgYSBsaXN0IG9mIHNlcmlhbCBkZXZpY2VzIG9uIHRoaXMgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5TZXJpYWxEZXZpY2V9IG9iamVjdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFNlcmlhbERldmljZXMgID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIE1hcHMgc2VyaWFsIGRldmljZSBkYXRhIHJlY2VpdmVkIGZyb20gdGhlIHdlYiBzZXJ2aWNlIHRvIGEge0BsaW5rIEVWV0VCMi5TZXJpYWxEZXZpY2V9IGluc3RhbmNlLlxuICAgICAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGRhdGEgQXJyYXkgb2YgZGF0YSBvYmplY3RzIHRvIGNvbnZlcnRcbiAgICAgICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbERldmljZVR5cGVzfSB0eXBlIFRoZSB0eXBlIG9mIGRhdGEgcmVwcmVzZW50ZWQuXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtFVldFQjIuU2VyaWFsRGV2aWNlfSBUaGUgc2VyaWFsIGRldmljZVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB2YXIgZGF0YVRvU2VyaWFsRGV2aWNlID0gZnVuY3Rpb24oZGF0YSwgdHlwZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAkLm1hcChkYXRhLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb25uZWN0aW9uSW5mbztcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZSA9PT0gRVZXRUIyLlNlcmlhbERldmljZVR5cGVzLlVhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvID0gbmV3IEVWV0VCMi5VYXJ0U2VyaWFsRGV2aWNlQ29ubmVjdGlvbkluZm8oZWxlbWVudC5wb3J0LCBlbGVtZW50LmJhdWRSYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGF0YUJpdHMsIGVsZW1lbnQuc3RvcEJpdHMsIGVsZW1lbnQucGFyaXR5LCBlbGVtZW50LmZsb3dDb250cm9sKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKHR5cGUgPT09IEVWV0VCMi5TZXJpYWxEZXZpY2VUeXBlcy5JcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbkluZm8gPSBuZXcgRVZXRUIyLklwU2VyaWFsRGV2aWNlQ29ubmVjdGlvbkluZm8oZWxlbWVudC5hZGRyZXNzLCBlbGVtZW50LnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5pcFBvcnQsIGVsZW1lbnQucmVtb3RlUG9ydCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgbGluZUluZm8gPSBuZXcgRVZXRUIyLlNlcmlhbERldmljZUxpbmVJbmZvKGVsZW1lbnQubWF4TGluZUxlbmd0aCwgZWxlbWVudC5saW5lRW5kaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50aW1lb3V0KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJpYWxEZXZpY2Uoc2VydmVyLCBlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGNvbm5lY3Rpb25JbmZvLCBsaW5lSW5mbyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudXNlLCB0eXBlLCBlbGVtZW50LnByb2ZpbGUpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRldmljZXMgPSBkYXRhVG9TZXJpYWxEZXZpY2UoZGF0YS51YXJ0LCBFVldFQjIuU2VyaWFsRGV2aWNlVHlwZXMuVWFydCk7XG5cbiAgICAgICAgICAgICAgICBkZXZpY2VzID0gZGV2aWNlcy5jb25jYXQoZGF0YVRvU2VyaWFsRGV2aWNlKGRhdGEuaXAsIEVWV0VCMi5TZXJpYWxEZXZpY2VUeXBlcy5JcCkpO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkZXZpY2VzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcmlhbERldmljZXMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgYSBsaXN0IG9mIHNlcmlhbCBwcm9maWxlcyBvbiB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW4gYXJyYXkgb2ZcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuU2VyaWFsUHJvZmlsZX0gb2JqZWN0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U2VyaWFsUHJvZmlsZXMgID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGRldmljZXMgPSAkLm1hcChkYXRhLnByb2ZpbGVzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXNwbGF5ID0gZWxlbWVudC5kaXNwbGF5O1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm9udEluZm8gPSBuZXcgRVZXRUIyLkZvbnRJbmZvKGRpc3BsYXkuZm9udE5hbWUsIGRpc3BsYXkuZm9udFNpemUsIGRpc3BsYXkuZm9udFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheS5mb250Q29sb3IsIGRpc3BsYXkuZm9udEZhbWlseSwgZGlzcGxheS5mb250V2VpZ2h0LCBkaXNwbGF5LnVuZGVybGluZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXNlU2VucyA9IGVsZW1lbnQuY2FzZVNlbnNpdGl2aXR5O1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2FzZVNlbnNpdGl2aXR5ID0gbmV3IEVWV0VCMi5TZXJpYWxDYXNlU2Vuc2l0aXZpdHkoY2FzZVNlbnMudHJhbnNtaXNzaW9uTWFya2VycyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2VTZW5zLmtleXdvcmRzLCBjYXNlU2Vucy5tYXNrcywgY2FzZVNlbnMucmVwbGFjZW1lbnRzLCBjYXNlU2Vucy5ydWxlcyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJrID0gZWxlbWVudC5tYXJrZXJzO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VycyA9IG5ldyBFVldFQjIuU2VyaWFsUHJvZmlsZU1hcmtlcnMobWFyay50eXBlLCBtYXJrLnN0YXJ0LCBtYXJrLmVuZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlcmlhbFByb2ZpbGUoc2VydmVyLCBlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGZvbnRJbmZvLCBjYXNlU2Vuc2l0aXZpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLCBlbGVtZW50LnJldGVudGlvbik7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRldmljZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VyaWFsUHJvZmlsZXMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIGEgbGlzdCBvZiBhY3RpdmUgZXZlbnRzIG9uIHRoaXMgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5FdmVudH0gb2JqZWN0cy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuRXZlbnRUeXBlW119IFtmaWx0ZXI9W11dIEFuIGFycmF5IG9mIGV2ZW50IHR5cGVzIHRvIGZpbHRlciB3aXRoLiAgSWYgbm9uZSBhcmUgc3BlY2lmaWVkLFxuICAgICAgICAgKiAgYWxsIGV2ZW50cyBhcmUgcmV0dXJuZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEV2ZW50cyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50cyA9ICQubWFwKGRhdGEuZXZlbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHRyYUluZm87XG4gICAgICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQuZXh0cmEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXh0cmFJbmZvID0gbmV3IEVWV0VCMi5FdmVudEV4dHJhSW5mbyhzZXJ2ZXIsIGVsZW1lbnQuZXh0cmEuaXRlbSwgZWxlbWVudC5leHRyYS50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5FdmVudChzZXJ2ZXIsIGVsZW1lbnQuZXZlbnQsIEVWV0VCMi51dGlsLklFVEYyRGF0ZShlbGVtZW50LnRpbWUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kZXZpY2UsIGV4dHJhSW5mbyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGV2ZW50cyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYoZmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmZpbHRlciA9IGZpbHRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZXZlbnRzLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHNlcnZlci5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxiYWNrIGludm9rZWQgYnlcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2ZXIjZ2V0QW5hbHl0aWNSdWxlc3xnZXRBbmFseXRpY1J1bGVzKCl9LlxuICAgICAgICAgKiBAY2FsbGJhY2sgRVZXRUIyLlNlcnZlcn5vbkdldEFuYWx5dGljUnVsZXNcbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuUmVzcG9uc2VTdGF0dXN9IHJlc3BvbnNlIFN1Y2Nlc3Mgc3RhdGUgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5BbmFseXRpY1J1bGVbXX0gcnVsZXMgVGhlIGFuYWx5dGljIHJ1bGVzIGNvbmZpZ3VyZWQgb24gdGhpcyBzZXJ2ZXIuXG4gICAgICAgICAqL1xuICAgICAgICAvKipcbiAgICAgICAgICogTGlzdCBhbmFseXRpYyBydWxlcyBvbiB0aGlzIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfm9uR2V0QW5hbHl0aWNSdWxlc30gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCBvbiBjb21wbGV0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRBbmFseXRpY1J1bGVzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmICghZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcnVsZXMgPSBkYXRhLnJ1bGVzLm1hcChmdW5jdGlvbihydWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvc2RDb25maWcgPSBuZXcgRVZXRUIyLkFuYWx5dGljUnVsZU9TRENvbmZpZyhcbiAgICAgICAgICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLlJHQkEocnVsZS5vc2RJbmZvLmJhY2tncm91bmRDb2xvciwgcnVsZS5vc2RJbmZvLmJhY2tncm91bmRPcGFjaXR5KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLlJHQkEocnVsZS5vc2RJbmZvLmJvcmRlckNvbG9yLCBydWxlLm9zZEluZm8uYm9yZGVyT3BhY2l0eSlcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGVuZHBvaW50IGV4aXN0ZWQgZm9yIG9uZSBxdWFydGVyICgxOS4wNiByZWxlYXNlKSB3aXRob3V0IHRoZSB0ZW1wbGF0ZXMgbGlzdCxcbiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgY2hva2Ugb24gbWFwcGluZyBpZiBpdCBpc24ndCBwcmVzZW50XG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXRhZGF0YVRlbXBsYXRlcztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGUubWV0YWRhdGFUZW1wbGF0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhVGVtcGxhdGVzID0gcnVsZS5tZXRhZGF0YVRlbXBsYXRlcy5tYXAoZnVuY3Rpb24odGVtcGxhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5FdmVudE1ldGFkYXRhVGVtcGxhdGUodGVtcGxhdGUua2V5LCB0ZW1wbGF0ZS52YWx1ZVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc291cmNlO1xuICAgICAgICAgICAgICAgICAgICBpZiAocnVsZS5zb3VyY2VUeXBlID09PSBFVldFQjIuYW5hbHl0aWNSdWxlU291cmNlVHlwZS5jYW1lcmEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZSA9IG5ldyBFVldFQjIuQXNzb2NpYXRlZENhbWVyYVNvdXJjZShydWxlLnNvdXJjZUlkLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChydWxlLnNvdXJjZVR5cGUgPT09IEVWV0VCMi5hbmFseXRpY1J1bGVTb3VyY2VUeXBlLmF1ZGlvKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UgPSBuZXcgRVZXRUIyLkFzc29jaWF0ZWRBdWRpb1NvdXJjZShydWxlLnNvdXJjZUlkLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5BbmFseXRpY1J1bGUoc2VydmVyLCBydWxlLnJ1bGVJZCwgcnVsZS5kZXZpY2VJZCwgc291cmNlLCBydWxlLm5hbWUsIG9zZENvbmZpZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUubWV0YWRhdGFFbmFibGVkLCBtZXRhZGF0YVRlbXBsYXRlcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKSwgcnVsZXMpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBFVldFQjIuYWpheCh7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmFuYWx5dGljUnVsZXMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yXG4gICAgICAgICAgICB9LCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIHRyaWdnZXIgc3RhdGVzIChPbi9PZmYpIHVzZWQgYnkge0BsaW5rIEVWV0VCMi5UcmlnZ2VyLnRvZ2dsZX1cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTb2Z0IFRyaWdnZXJzXG4gICAgICovXG4gICAgRVZXRUIyLnRyaWdnZXJTdGF0ZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9mZlxuICAgICAgICAgKi9cbiAgICAgICAgb2ZmOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogT25cbiAgICAgICAgICovXG4gICAgICAgIG9uOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogVW5rbm93blxuICAgICAgICAgKi9cbiAgICAgICAgdW5rbm93bjogLTFcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFRyaWdnZXIgb2JqZWN0IGlzIGEgd3JhcHBlZCBvYmplY3QgdGhhdCBoYW5kbGVzIHRoZSBjb250cm9sIG9mIGEgc29mdCB0cmlnZ2VyIG9uIGEgc2VydmVyLiBUaGUgb2JqZWN0cyBhcmVcbiAgICAgKiBnZW5lcmF0ZWQgaW4gYW4gYXJyYXkgZnJvbSB7QGxpbmsgRVZXRUIyLmdldFRyaWdnZXJzfSB0aGF0IHdpbGwgcmV0cmlldmUgdGhlIHNvZnQgdHJpZ2dlcnMgYXZhaWxhYmxlIG9uIGFcbiAgICAgKiBzZXJ2ZXIuICBUaGUgb2JqZWN0IGhvbGRzIHRoZSBwb2xsaW5nIHRpbWVyIGZvciBrZWVwaW5nIGEgdHJpZ2dlciBoZWxkIHRvIFwib25cIiAoYXMgdHJpZ2dlcnMgYXV0b21hdGljYWxseVxuICAgICAqIHR1cm4gb2ZmIGFmdGVyIDUgc2Vjb25kcykuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSBzZXJ2ZXIgaW5zdGFuY2Ugb2YgdGhlIHRyaWdnZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gVGhlIElEIG9mIHRoZSB0cmlnZ2VyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nVW5uYW1lZCBUcmlnZ2VyJ10gVGhlIG5hbWUgb2YgdGhlIHRyaWdnZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIudHJpZ2dlclN0YXRlfSBbc3RhdGU9RVZXRUIyLnRyaWdnZXJTdGF0ZS51bmtub3duXSBUaGUgc3RhdGUgb2YgdGhlIHNvZnQgdHJpZ2dlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU29mdCBUcmlnZ2Vyc1xuICAgICAqL1xuICAgIEVWV0VCMi5UcmlnZ2VyID0gZnVuY3Rpb24gKHNlcnZlciwgaWQsIG5hbWUsIHN0YXRlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJ2ZXIgdGhlIHNvZnQgdHJpZ2dlciBiZWxvbmdzIHRvXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSUQgb2YgdGhlIHNvZnQgdHJpZ2dlciBvbiB0aGUgc2VydmVyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOYW1lIG9mIHRoZSBzb2Z0IHRyaWdnZXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW5uYW1lZCBUcmlnZ2VyJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RhdGUgb2YgdGhlIHNvZnQgdHJpZ2dlclxuICAgICAgICAgKiBAdHlwZSBFVldFQjIudHJpZ2dlclN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXRlID0gRVZXRUIyLnRyaWdnZXJTdGF0ZS51bmtub3duO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW50ZXJ2YWwga2V5IGZvciBwb2xsaW5nIGEgdHJpZ2dlci5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgdHJpZ2dlckNoZWNrSW50ZXJ2YWwgPSAtMTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gaW50ZXJuYWxseS1zY29wZWQgcmVmZXJlbmNlIHRvIHRoaXMuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIHNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBpZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbmFtZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHN0YXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBpZ25vcmVcbiAgICAgICAgICovXG4gICAgICAgIHZhciB0cmlnZ2VyQ2hlY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNlbGYudG9nZ2xlKEVWV0VCMi50cmlnZ2VyU3RhdGUub24pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiAgVGhlIHRvZ2dsZSBtZXRob2QgaXMgdXNlZCB0byB0b2dnbGUgdGhlIHRyaWdnZXIgb24gb3Igb2ZmLiAgSWYgaXQgaXMgYmVpbmcgdHVybmVkIG9uLFxuICAgICAgICAgKiAgYSB0aW1lciB3aWxsIGJlIHNldCB0byBjb250aW51ZSBwb2xsaW5nIHRoZSBzZXJ2ZXIgdGhhdCB0aGUgdHJpZ2dlciBpcyBvbiB0byBwcmVzZXJ2ZSB0aGUgc3RhdGVcbiAgICAgICAgICogIHVudGlsIHRoZSBzd2l0Y2ggaXMgc2V0IHRvIG9mZi4gIElmIG5vIHN0YXRlIHBhcmFtZXRlciBpcyBnaXZlbiwgdGhlIHN0YXRlIHdpbGwgdG9nZ2xlLlxuICAgICAgICAgKiAgQHBhcmFtIHtFVldFQjIudHJpZ2dlclN0YXRlfSBbc3RhdGVdIFRoZSBuZXcgc3RhdGUgb2YgdGhlIHRyaWdnZXJcbiAgICAgICAgICogIEByZXR1cm4ge0VWV0VCMi50cmlnZ2VyU3RhdGV9IFRoZSB1cGRhdGVkIHN0YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvZ2dsZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgLy9VcGRhdGUgdGhlIHN0YXRlXG4gICAgICAgICAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgLy9Ub2dnbGUgdGhlIHN0YXRlXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGUgPT09IEVWV0VCMi50cmlnZ2VyU3RhdGUub2ZmKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBFVldFQjIudHJpZ2dlclN0YXRlLm9uO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IEVWV0VCMi50cmlnZ2VyU3RhdGUub2ZmO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5zdGF0ZSA9PT0gRVZXRUIyLnRyaWdnZXJTdGF0ZS5vZmYpIHtcbiAgICAgICAgICAgICAgICAvLyB0dXJuIG9mZiB0aW1lclxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodHJpZ2dlckNoZWNrSW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIHRyaWdnZXJDaGVja0ludGVydmFsID0gLTE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBlc3RhYmxpc2ggdGltZXJcbiAgICAgICAgICAgICAgICBpZih0cmlnZ2VyQ2hlY2tJbnRlcnZhbCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckNoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0cmlnZ2VyQ2hlY2ssIEVWV0VCMi5jb25maWcudHJpZ2dlclBvbGxpbmdSYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIHRpZDogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZSA9PT0gRVZXRUIyLnRyaWdnZXJTdGF0ZS5vZmYgPyAnb2ZmJyA6ICdvbidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlci5yZXF1aXJlc1Jlc291cmNlS2V5KCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZXJ2ZXIuc2VydmljZS5yZXNvdXJjZUtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0cmlnZ2VyQ2hlY2tJbnRlcnZhbCk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNTUkYgZW5mb3JjZWQsIHBhc3N0aHJvdWdoIHdpbGwgbm90IHdvcmsuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYXJhbXMua2V5ID0gdGhpcy5zZXJ2ZXIuc2VydmljZS5yZXNvdXJjZUtleTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnRyaWdnZXIsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UsIHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBnZXRUcmlnZ2VycyBmdW5jdGlvbiBpcyBhIHJldHJpZXZhbCBmdW5jdGlvbiB0aGF0IHdpbGwgbWFrZSBhIGNhbGwgZm9yIGRhdGEgZnJvbSB0aGUgZXhhY3FWaXNpb24gd2ViXG4gICAgICogc2VydmljZSBiYWNrLWVuZCBmb3IgYSBsaXN0IG9mIHRoZSBzb2Z0IHRyaWdnZXJzIGF2YWlsYWJsZSBvbiB0aGUgZGVzaWduYXRlZCBzZXJ2ZXIuICBUaGUgZnVuY3Rpb24gd2lsbFxuICAgICAqIG1ha2UgdGhlIHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIGFuZCBwYXJzZSB0aGUgZGF0YSByZXR1cm5lZCB0byBnZW5lcmF0ZSBhbiBhcnJheSBvZiB0aGUge0BsaW5rIEVWV0VCMi5UcmlnZ2VyfVxuICAgICAqIGluc3RhbmNlcyB0aGF0IHdpbGwgaGFuZGxlIHRoZSBjYWxscyB0byBzZXQgdGhlIHRyaWdnZXJzIGFzIG5lZWRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW4gYXJyYXkgb2ZcbiAgICAgKiAge0BsaW5rIEVWV0VCMi5UcmlnZ2VyfSBpbnN0YW5jZXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgVGhlIHRhcmdldCBzZXJ2ZXIuXG4gICAgICogQGNhdGVnb3J5IFNvZnQgVHJpZ2dlcnNcbiAgICAgKi9cbiAgICBFVldFQjIuZ2V0VHJpZ2dlcnMgPSBmdW5jdGlvbiAoY2FsbGJhY2ssIHNlcnZlcikge1xuICAgICAgICB2YXIgb25HZXRUcmlnZ2Vyc0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25HZXRUcmlnZ2Vyc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICBpZihkYXRhID09PSBFVldFQjIuZXJyb3JzLnRyaWdnZXJzKSB7XG4gICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgIG9uR2V0VHJpZ2dlcnNFcnJvcigpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXN1bHRMaXN0ID0gZGF0YS5UcmlnZ2VycztcblxuICAgICAgICAgICAgdmFyIHRyaWdnZXJMaXN0ID0gJC5tYXAocmVzdWx0TGlzdCwgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlRyaWdnZXIoc2VydmVyLCBlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGVsZW1lbnQuc3RhdGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBzZXJ2ZXIgbGlzdFxuICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCB0cmlnZ2VyTGlzdCwgc2VydmVyKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICBzdWNjZXNzOiBvbkdldFRyaWdnZXJzU3VjY2VzcyxcbiAgICAgICAgICAgIGVycm9yOiBvbkdldFRyaWdnZXJzRXJyb3IsXG4gICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudHJpZ2dlcixcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICB9O1xuXG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0eXBlcyBvZiBWaWV3IHNsb3QgaXRlbXMgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFZpZXdzXG4gICAgICovXG4gICAgRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbWVyYVxuICAgICAgICAgKi9cbiAgICAgICAgY2FtZXJhOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXVkaW9cbiAgICAgICAgICovXG4gICAgICAgIGF1ZGlvOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VyaWFsXG4gICAgICAgICAqL1xuICAgICAgICBzZXJpYWw6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHcm91cFxuICAgICAgICAgKi9cbiAgICAgICAgZ3JvdXA6IDQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTb2Z0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIHNvZnRUcmlnZ2VyOiA1LFxuICAgICAgICAvKipcbiAgICAgICAgICogSS9PIFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIGlvVHJpZ2dlcjogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRpbWUgVHJpZ2dlclxuICAgICAgICAgKi9cbiAgICAgICAgdGltZVRyaWdnZXI6IDdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZXdGb2xkZXIgb2JqZWN0IGlzIGEgd3JhcHBlZCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgZm9sZGVyIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgdmlld3Mgb3IgZm9sZGVycy5cbiAgICAgKiBUaGUgb2JqZWN0cyBhcmUgZ2VuZXJhdGVkIGluIGFuIGFycmF5IGZyb20ge0BsaW5rIEVWV0VCMi5nZXRWaWV3c30uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gVGhlIElEIG9mIHRoZSBWaWV3IEZvbGRlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9JyddIFRoZSBuYW1lIG9mIHRoZSBWaWV3IEZvbGRlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3BhcmVudElkPScnXSBUaGUgcGFyZW50IElEIG9mIHRoZSBWaWV3IEZvbGRlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgVmlld3NcbiAgICAgKi9cbiAgICBFVldFQjIuVmlld0ZvbGRlciA9IGZ1bmN0aW9uKGlkLCBuYW1lLCBwYXJlbnRJZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSB2aWV3IGZvbGRlclxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZSBvZiB0aGUgdmlldyBmb2xkZXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSB2aWV3IGZvbGRlcidzIHBhcmVudCBmb2xkZXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhcmVudElkID0gJyc7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBwYXJlbnRJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50SWQgPSBwYXJlbnRJZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgVmlld1Nsb3RJdGVtIG9iamVjdCBpcyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhbiBpdGVtIGFzc29jaWF0ZWQgd2l0aCBhIHZpZXcuIFRoZSBvYmplY3RzIGFyZVxuICAgICAqIGdlbmVyYXRlZCBpbiBhbiBhcnJheSBmcm9tIHtAbGluayBFVldFQjIuU2VydmljZS5nZXRWaWV3c30uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gVGhlIElEIG9mIHRoZSBhc3NvY2lhdGVkIGl0ZW0uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSBzZXJ2ZXIgaW5zdGFuY2Ugb2YgdGhlIGFzc29jaWF0ZWQgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFt0eXBlPW51bGxdIFRoZSB0eXBlIHJlZmVyZW5jZSBvZiB0aGUgaXRlbS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3Nsb3RJbmRleD0wXSBUaGUgbGF5b3V0IHNsb3QgaW5kZXggdGhhdCB0aGlzIHZpZXcgaXRlbSBjb3JyZXNwb25kcyB0by5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5kaWdpdGFsUHR6VHlwZXN9IFtkaWdpdGFsUHR6VHlwZT1udWxsXSBUaGUgZGlnaXRhbCBQVFogSUQgb2YgdGhlIGFzc29jaWF0ZWQgY2FtZXJhLCBpZiBwcmVzZW50LlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBWaWV3c1xuICAgICAqL1xuICAgIEVWV0VCMi5WaWV3U2xvdEl0ZW0gPSBmdW5jdGlvbihpZCwgc2VydmVyLCB0eXBlLCBzbG90SW5kZXgsIGRpZ2l0YWxQdHpUeXBlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIGl0ZW1cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgc2VydmVyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBpbnN0YW5jZSBvZiB0aGUgYXNzb2NpYXRlZCBjYW1lcmFcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXJJbnN0YW5jZSA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHRoZSBpdGVtIChhIHJlZmVyZW5jZSB0byBhbiBFVldFQjIgY2xhc3MpXG4gICAgICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNsb3QgaW5kZXggZm9yIHRoaXMgaXRlbS5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNsb3RJbmRleCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgZGlnaXRhbCBQVFogY2FtZXJhXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5kaWdpdGFsUHR6VHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGlnaXRhbFB0elR5cGUgPSBudWxsO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlci5pZDtcbiAgICAgICAgICAgIHRoaXMuc2VydmVySW5zdGFuY2UgPSBzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHR5cGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzbG90SW5kZXggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNsb3RJbmRleCA9IHNsb3RJbmRleDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZGlnaXRhbFB0elR5cGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmRpZ2l0YWxQdHpUeXBlID0gZGlnaXRhbFB0elR5cGU7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBUaGUgVmlld0NhbWVyYUluZm8gb2JqZWN0IGlzIGEgd3JhcHBlZCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgY2FtZXJhIGFzc29jaWF0ZWQgd2l0aCBhIHZpZXcuIFRoZSBvYmplY3RzIGFyZVxuICAgICAqIGdlbmVyYXRlZCBpbiBhbiBhcnJheSBmcm9tIHtAbGluayBFVldFQjIuZ2V0Vmlld3N9LlxuICAgICAqIE5vdGU6IFRoaXMgY2xhc3MgaXMgb25seSB1c2VkIGluIGFzc29jaWF0aW9uIHdpdGgge0BsaW5rIEVWV0VCMi5WaWV3LmNhbWVyYXN9IGFuZCBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yXG4gICAgICogb2Yge0BsaW5rIEVWV0VCMi5WaWV3U2xvdEl0ZW19LlxuICAgICAqIEBkZXByZWNhdGVkIFNlZSB7QGxpbmsgRVZXRUIyLlZpZXdTbG90SXRlbX0gZm9yIG5vbi1kZXByZWNhdGVkIHVzYWdlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY2FtZXJhPScnXSBUaGUgY2FtZXJhIElEIG9mIHRoZSBhc3NvY2lhdGVkIGNhbWVyYS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IFtzZXJ2ZXI9bnVsbF0gVGhlIHNlcnZlciBpbnN0YW5jZSBvZiB0aGUgYXNzb2NpYXRlZCBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtFVldFQjIuZGlnaXRhbFB0elR5cGVzfSBbZGlnaXRhbFB0elR5cGU9bnVsbF0gVGhlIGRpZ2l0YWwgUFRaIElEIG9mIHRoZSBhc3NvY2lhdGVkIGNhbWVyYSwgaWYgcHJlc2VudC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgVmlld3NcbiAgICAgKi9cbiAgICBFVldFQjIuVmlld0NhbWVyYUluZm8gPSBmdW5jdGlvbihjYW1lcmEsIHNlcnZlciwgZGlnaXRhbFB0elR5cGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgY2FtZXJhXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmEgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBzZXJ2ZXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGluc3RhbmNlIG9mIHRoZSBhc3NvY2lhdGVkIGNhbWVyYVxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlckluc3RhbmNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBkaWdpdGFsIFBUWiBjYW1lcmFcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmRpZ2l0YWxQdHpUeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kaWdpdGFsUHR6VHlwZSA9IG51bGw7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgY2FtZXJhICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyLmlkO1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJJbnN0YW5jZSA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZGlnaXRhbFB0elR5cGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmRpZ2l0YWxQdHpUeXBlID0gZGlnaXRhbFB0elR5cGU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZXdDYW1lcmFJbmZvIG9iamVjdCBpcyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhIGNhbWVyYSBhc3NvY2lhdGVkIHdpdGggYSB2aWV3LiBUaGUgb2JqZWN0cyBhcmVcbiAgICAgKiBnZW5lcmF0ZWQgaW4gYW4gYXJyYXkgZnJvbSB7QGxpbmsgRVZXRUIyLmdldFZpZXdzfS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkPScnXSBUaGUgSUQgb2YgdGhlIGFzc29jaWF0ZWQgYXVkaW8gaW5wdXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSBzZXJ2ZXIgaW5zdGFuY2Ugb2YgdGhlIGFzc29jaWF0ZWQgY2FtZXJhLlxuICAgICAqIEBkZXByZWNhdGVkIFNlZSB7QGxpbmsgRVZXRUIyLlZpZXdTbG90SXRlbX0gZm9yIG5vbi1kZXByZWNhdGVkIHVzYWdlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBWaWV3c1xuICAgICAqL1xuICAgIEVWV0VCMi5WaWV3QXVkaW9JbnB1dEluZm8gPSBmdW5jdGlvbihpZCwgc2VydmVyKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIGFzc29jaWF0ZWQgYXVkaW8gaW5wdXQuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIHNlcnZlclxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgaW5zdGFuY2Ugb2YgdGhlIGFzc29jaWF0ZWQgY2FtZXJhXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVySW5zdGFuY2UgPSBudWxsO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlci5pZDtcbiAgICAgICAgICAgIHRoaXMuc2VydmVySW5zdGFuY2UgPSBzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZXcgb2JqZWN0IGlzIGEgd3JhcHBlZCBzZXQgb2YgaW5mb3JtYXRpb24gZm9yIGEgc2VydmVyIHNpZGUgdmlldy4gIEl0IGp1c3QgaG9sZHMgdGhlIHByb3BlcnRpZXMgb2YgYW5cbiAgICAgKiBpbmRpdmlkdWFsIHZpZXcuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPSdVbm5hbWVkJ10gTmFtZSBvZiB0aGUgdmlldy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWV3Rm9sZGVyfSBbZm9sZGVyPW51bGxdIFRoZSB2aWV3J3MgY29udGFpbmVyIGZvbGRlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWV3U2xvdEl0ZW1bXX0gW2l0ZW1zPVtdXSBBcnJheSBvZiB0aGUgaXRlbXMgaW4gdGhlIHZpZXcuICBOb3RlOiBUaGlzIGNsYXNzIGFsc28gc3VwcG9ydHMgYW5cbiAgICAgKiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlZpZXdDYW1lcmFJbmZvfSBmb3IgdGhpcyBwcm9wZXJ0eSB0byByZXRhaW4gbGVnYWN5IHN1cHBvcnQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtsYXlvdXQ9LTFdIE51bWJlciBvZiB2aWRlbyBwYW5lbHMgaW4gdGhpcyB2aWV3LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkxheW91dH0gW2xheW91dEluZm89bnVsbF0gQ3VzdG9tIGxheW91dCBpbmZvcm1hdGlvbiBmb3IgdGhlIHZpZXcuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvcmRlcj0tMV0gT3JkZXIgdmFsdWUgZm9yIHRoZSB2aWV3LCB1c2VkIGluIHNvcnRpbmcgdGhlIHZpZXcgbGlzdC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWV3QXVkaW9JbnB1dEluZm99IFthdWRpb0lucHV0PW51bGxdIFRoZSBhdWRpbyBpbnB1dCBpbiB0aGUgdmlldy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Rlc2NyaXB0aW9uPScnXSBEZXNjcmlwdGlvbiBvZiB0aGUgdmlldy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgVmlld3NcbiAgICAgKi9cbiAgICBFVldFQjIuVmlldyA9IGZ1bmN0aW9uIChuYW1lLCBmb2xkZXIsIGl0ZW1zLCBsYXlvdXQsIGxheW91dEluZm8sIG9yZGVyLCBhdWRpb0lucHV0LCBkZXNjcmlwdGlvbikge1xuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZSBvZiB0aGUgdmlld1xuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9IFwiVW5uYW1lZFwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIFZpZXcncyBjb250YWluZXIgZm9sZGVyXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5WaWV3Rm9sZGVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZvbGRlciA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFycmF5IG9mIHRoZSBvYmplY3RzIGluIHRoZSB2aWV3XG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5WaWV3U2xvdEl0ZW1bXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcnJheSBvZiB0aGUgY2FtZXJhcyBpbiB0aGUgdmlld1xuICAgICAgICAgKiBAZGVwcmVjYXRlZCBTZWUge0BsaW5rIEVWV0VCMi5WaWV3Lml0ZW1zfVxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVmlld0NhbWVyYUluZm9bXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmFzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE51bWJlciBvZiB2aWRlbyBwYW5lbHMgaW4gdGhpcyB2aWV3XG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sYXlvdXQgPSAtMTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTGF5b3V0IGluZm9ybWF0aW9uIGZvciB0aGUgdmlld1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuTGF5b3V0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxheW91dEluZm8gPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcmRlciB2YWx1ZSBmb3IgdGhlIHZpZXcsIHVzZWQgaW4gc29ydGluZyB0aGUgdmlldyBsaXN0XG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vcmRlciA9IC0xO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdWRpbyBpbnB1dCBhcHBsaWVkIHRvIHRoaXMgdmlld1xuICAgICAgICAgKiBAZGVwcmVjYXRlZCBTZWUge0BsaW5rIEVWV0VCMi5WaWV3Lml0ZW1zfVxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVmlld0F1ZGlvSW5wdXRJbmZvXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGlvSW5wdXQgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXNjcmlwdGlvbiBvZiB0aGUgdmlld1xuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBcIlwiO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKGZvbGRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IGZvbGRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiggbGF5b3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGF5b3V0ID0gbGF5b3V0O1xuICAgICAgICB9XG4gICAgICAgIGlmKGxheW91dEluZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5sYXlvdXRJbmZvID0gbGF5b3V0SW5mbztcbiAgICAgICAgfVxuICAgICAgICBpZihpdGVtcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXNBcmVDYW1lcmFJbmZvID0gJC5ncmVwKGl0ZW1zLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQgaW5zdGFuY2VvZiBFVldFQjIuVmlld0NhbWVyYUluZm87XG4gICAgICAgICAgICB9KS5sZW5ndGggPiAwO1xuXG4gICAgICAgICAgICBpZihpdGVtc0FyZUNhbWVyYUluZm8pIHtcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBsZWdhY3kgZm9ybWF0c1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMgPSAkLm1hcChpdGVtcywgZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVmlld1Nsb3RJdGVtKGVsZW1lbnQuY2FtZXJhLCBlbGVtZW50LnNlcnZlckluc3RhbmNlLCBFVldFQjIuQ2FtZXJhLCBpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmRpZ2l0YWxQdHpUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhcyA9IGl0ZW1zO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtcyA9IGl0ZW1zO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhcyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNhbWVyYUl0ZW1zID0gJC5ncmVwKHRoaXMuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQudHlwZSA9PT0gRVZXRUIyLkNhbWVyYTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhbiBhcnJheSBvZiBudWxsIGl0ZW1zIHRoYXQgaXMgdGhlIHNpemUgb2YgdGhlIGxheW91dFxuICAgICAgICAgICAgICAgIHZhciBjYW1lcmFzU2l6ZSA9IGNhbWVyYUl0ZW1zLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxheW91dCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhc1NpemUgPSB0aGlzLmxheW91dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICAgICAgZm9yKGk9MDsgaTxjYW1lcmFzU2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FtZXJhc1tpXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEFkZCBpbiB0aGUgdmlldyBjYW1lcmEgaW5mb3NcbiAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgICAgICAgICAgICAgICQuZWFjaChjYW1lcmFJdGVtcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuY2FtZXJhc1tlbGVtZW50LnNsb3RJbmRleF0gPSBuZXcgRVZXRUIyLlZpZXdDYW1lcmFJbmZvKHBhcnNlSW50KGVsZW1lbnQuaWQsIDEwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VydmVySW5zdGFuY2UsIGVsZW1lbnQuZGlnaXRhbFB0elR5cGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgYXVkaW8gaW5wdXQgdmFsdWVcbiAgICAgICAgICAgICAgICB2YXIgYXVkaW9JdGVtID0gJC5ncmVwKHRoaXMuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQudHlwZSA9PT0gRVZXRUIyLkF1ZGlvRGV2aWNlO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmKGF1ZGlvSXRlbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW9JbnB1dCA9IG5ldyBFVldFQjIuVmlld0F1ZGlvSW5wdXRJbmZvKGF1ZGlvSXRlbS5pZCwgYXVkaW9JdGVtLnNlcnZlckluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYob3JkZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5vcmRlciA9IG9yZGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKGF1ZGlvSW5wdXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gU2V0IHRoZSBkZXByZWNhdGVkIHZhbHVlXG4gICAgICAgICAgICB0aGlzLmF1ZGlvSW5wdXQgPSBhdWRpb0lucHV0O1xuXG4gICAgICAgICAgICAvLyBBZGQgaXQgdG8gdGhlIGl0ZW1zIGxpc3QuXG4gICAgICAgICAgICB2YXIgYXVkaW8gPSAkLmdyZXAodGhpcy5pdGVtcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnR5cGUgPT09IEVWV0VCMi5BdWRpb0RldmljZTtcbiAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgaWYoYXVkaW8gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgbmV3IEVWV0VCMi5WaWV3U2xvdEl0ZW0oYXVkaW9JbnB1dC5pZCwgYXVkaW9JbnB1dC5zZXJ2ZXJJbnN0YW5jZSwgRVZXRUIyLkF1ZGlvRGV2aWNlLCAwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFwcGxpZXMgdGhlIGN1cnJlbnQgZGlnaXRhbCBQVFogc2V0dGluZ3MgZm9yIHRoZSBzZWxlY3RlZCBzbG90IGluIHRoZSB2aWV3LiAgVGhlIHByb3ZpZGVkIGNhbWVyYSBtdXN0IGJlIGFcbiAgICAgICAgICogY3JlYXRlZCBkaWdpdGFsIFBUWiBjYW1lcmEgZnJvbSB0aGUgY2FtZXJhIGZvciB0aGUgc2xvdCBpZGVudGlmaWVkIGluIHtAbGluayBFVldFQjIuVmlldyNjYW1lcmFzfS5cbiAgICAgICAgICogVGhpcyBtZXRob2QgaXMgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiB7QGxpbmsgRVZXRUIyLkNhbWVyYS5jcmVhdGVEaWdpdGFsUHR6Q2FtZXJhfSwgd2hpY2ggd2lsbCBhbHNvIGFwcGx5XG4gICAgICAgICAqIGFueSB2aWV3LXNwZWNpZmljIGRpZ2l0YWwgUFRaIHNldHRpbmdzLiAgQWRkaXRpb25hbGx5LCB0aGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IGFwcGx5aW5nIGRpZ2l0YWwgUFRaXG4gICAgICAgICAqIHNldHRpbmdzIGZvciB2aWV3cyByZWNlaXZlZCBhcyBhIHtAbGluayBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZX0uXG4gICAgICAgICAqIEBkZXByZWNhdGVkXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIHRoZSBwYXNzZWQgZGlnaXRhbCBQVFogY2FtZXJhXG4gICAgICAgICAqICBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHNsb3QgVGhlIHNsb3QgaW4gdGhlIHZpZXcuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gY2FtZXJhIFRoZSBkaWdpdGFsIFBUWiBjYW1lcmEgdG8gYXBwbHkgdGhlIHNldHRpbmdzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hcHBseURpZ2l0YWxQdHpTZXR0aW5nc0ZvclNsb3QgPSBmdW5jdGlvbihjYWxsYmFjaywgc2xvdCwgY2FtZXJhKSB7XG4gICAgICAgICAgICB2YXIgc2xvdEluZm8gPSB0aGlzLmNhbWVyYXNbc2xvdF07XG5cbiAgICAgICAgICAgIHZhciBlcnJvclRleHQ7XG4gICAgICAgICAgICBpZihcbiAgICAgICAgICAgICAgICB0eXBlb2Ygc2xvdEluZm8gPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgICAgICAgICAgc2xvdEluZm8gPT09IG51bGwgfHxcbiAgICAgICAgICAgICAgICBzbG90SW5mby5kaWdpdGFsUHR6VHlwZSA9PT0gbnVsbFxuICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gJ1RoaXMgdmlldyBzbG90IGRvZXMgbm90IHN1cHBvcnQgZGlnaXRhbCBQVFouJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoY2FtZXJhLnB0elR5cGUgIT09IEVWV0VCMi5wdHpUeXBlcy5kaWdpdGFsKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gJ1RoZSBwcm92aWRlZCBjYW1lcmEgaXMgbm90IGEgZGlnaXRhbCBQVFogY2FtZXJhLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGNhbWVyYS5zb3VyY2VDYW1lcmEuaWQgIT09IHNsb3RJbmZvLmNhbWVyYSkge1xuICAgICAgICAgICAgICAgIGVycm9yVGV4dCA9ICdUaGUgcHJvdmlkZWQgZGlnaXRhbCBQVFogY2FtZXJhIGlzIG5vdCBkZXJpdmVkIGZyb20gdGhlIGNhbWVyYSBmb3IgdGhpcyBzbG90Lic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGNhbWVyYS5kaWdpdGFsUHR6VHlwZSAhPT0gc2xvdEluZm8uZGlnaXRhbFB0elR5cGUpIHtcbiAgICAgICAgICAgICAgICBlcnJvclRleHQgPSAnVGhlIHByb3ZpZGVkIGRpZ2l0YWwgUFRaIGNhbWVyYSBpcyBub3QgdGhlIGNvcnJlY3QgdHlwZSBmb3IgdGhpcyBzbG90Lic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0eXBlb2YgZXJyb3JUZXh0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSxlcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uQXBwbHlEaWdpdGFsUHR6U2V0dGluZ3NFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkFwcGx5RGlnaXRhbFB0elNldHRpbmdzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICAvL1JldHVybiB0aGUgZGlnaXRhbCBQVFogY2FtZXJhXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSwgY2FtZXJhKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkFwcGx5RGlnaXRhbFB0elNldHRpbmdzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25BcHBseURpZ2l0YWxQdHpTZXR0aW5nc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc2xvdEluZm8uc2VydmVySW5zdGFuY2Uuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmRpZ2l0YWxQdHosXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzbG90SW5mby5zZXJ2ZXJJbnN0YW5jZS5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHB0ejogY2FtZXJhLmlkLFxuICAgICAgICAgICAgICAgICAgICB2aWV3OiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcjogdGhpcy5mb2xkZXIubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc2xvdDogc2xvdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzbG90SW5mby5zZXJ2ZXJJbnN0YW5jZS5zZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogIFRoZSBnZXRWaWV3cyBmdW5jdGlvbiByZXRyaWV2ZXMgdGhlIHNlcnZlciBzaWRlIHZpZXdzIGZyb20gdGhlIGV4YWNxVmlzaW9uIHNlcnZlcnMuXG4gICAgICogIEBkZXByZWNhdGVkIFRoaXMgbWV0aG9kIGlzIHN1cGVyY2VkZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2aWNlLmdldFZpZXdzfS5cbiAgICAgKiAgQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICogICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSwgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5WaWV3fVxuICAgICAqICAgaW5zdGFuY2VzLCBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5WaWV3Rm9sZGVyfSBpbnN0YW5jZXMuXG4gICAgICogIEBwYXJhbSB7RVZXRUIyLlNlcnZlcnxFVldFQjIuU2VydmVyW119IHNlcnZlcnMgQSBzaW5nbGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIG9yIGFuIGFycmF5IG9mXG4gICAgICogIHtAbGluayBFVldFQjIuU2VydmVyfSBpbnN0YW5jZXNcbiAgICAgKiAgQGNhdGVnb3J5IFZpZXdzXG4gICAgICovXG4gICAgRVZXRUIyLmdldFZpZXdzID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgIGlmKCEkLmlzQXJyYXkoc2VydmVycykpIHtcbiAgICAgICAgICAgIHNlcnZlcnMgPSBbc2VydmVyc107XG4gICAgICAgIH1cblxuICAgICAgICBpZihzZXJ2ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdObyBzZXJ2ZXJzIGRlZmluZWQnKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2VydmVyc1swXS5zZXJ2aWNlLmdldFZpZXdzKGNhbGxiYWNrLCBzZXJ2ZXJzKTtcbiAgIH07XG5cbn0oKSk7IiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIG1ldGFkYXRhIGZsYWdzIHJldHVybmVkIGZvciBhIGdpdmVuIG1ldGFkYXRhIGl0ZW0uXG4gICAgICogQGVudW0ge3N0cmluZ31cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLm1ldGFkYXRhRmxhZ3MgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGcmVlIHJ1blxuICAgICAgICAgKi9cbiAgICAgICAgZnJlZVJ1bjogJ2ZyZWVSdW4nLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWxhcm1cbiAgICAgICAgICovXG4gICAgICAgIGFsYXJtOiAnYWxhcm0nLFxuICAgICAgICAvKipcbiAgICAgICAgICogTW90aW9uXG4gICAgICAgICAqL1xuICAgICAgICBtb3Rpb246ICdtb3Rpb24nXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEJpdCBmaWVsZCB2YWx1ZXMgZm9yIGZsYWdzLlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIHZhciBGTEFHX0ZSRUVfUlVOID0gMHgwMDtcbiAgICB2YXIgRkxBR19BTEFSTSA9IDB4NDA7XG4gICAgdmFyIEZMQUdfTU9USU9OID0gMHg4MDtcblxuICAgIC8qKlxuICAgICAqIEEgbWV0YWRhdGEgaXRlbSwgcmVwcmVzZW50aW5nIGEgZHVyYXRpb24gb2YgYSBnaXZlbiBtZXRhZGF0YSBldmVudC5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtzdGFydD1uZXcgRGF0ZSgpXSBUaGUgc3RhcnQgZGF0ZSB0aW1lIG9mIHRoZSBtZXRhZGF0YSBpdGVtLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW2VuZD1uZXcgRGF0ZSgpXSBUaGUgZW5kIGRhdGUgdGltZSBvZiB0aGUgbWV0YWRhdGEgaXRlbS5cbiAgICAgKiBAcGFyYW0ge051bWJlcnxFVldFQjIubWV0YWRhdGFGbGFnc1tdfSBmbGFncyBUaGUgZmxhZ3MgYXNzb2NpYXRlZCB3aXRoIHRoZSBtZXRhZGF0YSBldmVudC4gSWYgdGhlIHZhbHVlIGlzIGFcbiAgICAgKiBudW1iZXIsIGl0IGlzIHRyZWF0ZWQgYXMgYSBiaXQgZmllbGQgcmV0dXJuZWQgZnJvbSB0aGUgc2VydmVyXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIEVWV0VCMi5NZXRhZGF0YUl0ZW0gPSBmdW5jdGlvbihzdGFydCwgZW5kLCBmbGFncykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGFydCBkYXRlIG9mIHRoZSBtZXRhZGF0YSBpdGVtXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhcnQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmQgZGF0ZSBvZiB0aGUgbWV0YWRhdGEgaXRlbVxuICAgICAgICAgKiBAdHlwZSBEYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuZCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmbGFncyBhc3NvY2lhdGVkIHdpdGggdGhpcyBtZXRhZGF0YSBpdGVtXG4gICAgICAgICAqIEB0eXBlIEFycmF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZsYWdzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhY3RpdmUgZmxhZyBhc3NvY2lhdGVkIHdpdGggdGhlIGdyb3VwIG9mIGZsYWdzXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFjdGl2ZUZsYWcgPSAnJztcblxuICAgICAgICBpZih0eXBlb2Ygc3RhcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGVuZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kID0gZW5kO1xuICAgICAgICB9XG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgaWYodHlwZW9mIGZsYWdzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgaWYodHlwZW9mIGZsYWdzID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIGlmKGZsYWdzID09PSBGTEFHX0ZSRUVfUlVOKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZm9yIEZyZWUgUnVuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZmxhZ3MucHVzaChFVldFQjIubWV0YWRhdGFGbGFncy5mcmVlUnVuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoKGZsYWdzJihGTEFHX0FMQVJNKSkgPT09IEZMQUdfQUxBUk0pIHtcbiAgICAgICAgICAgICAgICAgICAgLy9mb3IgQWxhcm1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFncy5wdXNoKEVWV0VCMi5tZXRhZGF0YUZsYWdzLmFsYXJtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoKGZsYWdzJihGTEFHX01PVElPTikpID09PSBGTEFHX01PVElPTikge1xuICAgICAgICAgICAgICAgICAgICAvL2ZvciBNb3Rpb25cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mbGFncy5wdXNoKEVWV0VCMi5tZXRhZGF0YUZsYWdzLm1vdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFncyA9IGZsYWdzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgdGhlIGFjdGl2ZSBmbGFnXG4gICAgICAgICAgICBpZigkLmluQXJyYXkoRVZXRUIyLm1ldGFkYXRhRmxhZ3MuYWxhcm0sIHRoaXMuZmxhZ3MpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlRmxhZyA9IEVWV0VCMi5tZXRhZGF0YUZsYWdzLmFsYXJtO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbHNlIGlmKCQuaW5BcnJheShFVldFQjIubWV0YWRhdGFGbGFncy5tb3Rpb24sIHRoaXMuZmxhZ3MpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlRmxhZyA9IEVWV0VCMi5tZXRhZGF0YUZsYWdzLm1vdGlvbjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZSBpZigkLmluQXJyYXkoRVZXRUIyLm1ldGFkYXRhRmxhZ3MuZnJlZVJ1biwgdGhpcy5mbGFncykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVGbGFnID0gRVZXRUIyLm1ldGFkYXRhRmxhZ3MuZnJlZVJ1bjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWJpdHdpc2UgKi9cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQSBjb250YWluZXIgZm9yIGFsbCBtZXRhZGF0YSBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggYW4gaW5wdXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhfEVWV0VCMi5BdWRpb0RldmljZX0gW2luc3RhbmNlPW51bGxdIFRoZSBpbnB1dCBpbnN0YW5jZSBhc3NvY2lhdGVkIHd0aWggdGhlIG1ldGFkYXRhLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLk1ldGFkYXRhSXRlbVtdfSBbbWV0YWRhdGE9W11dIEFuIGFycmF5IG9mIGFsbCBtZXRhZGF0YSBpdGVtcyBhc3NvY2lhdGVkIHdpdGggdGhlIGlucHV0IGZvciB0aGVcbiAgICAgKiBnaXZlbiB0aW1lIHJhbmdlXG4gICAgICogQHBhcmFtIHtEYXRlfSBbc3RhcnQ9bmV3IERhdGUoKV0gVGhlIHN0YXJ0IGRhdGUgdGltZSBvZiB0aGUgbWV0YWRhdGEgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtEYXRlfSBbZW5kPW5ldyBEYXRlKCldIFRoZSBlbmQgZGF0ZSB0aW1lIG9mIHRoZSBtZXRhZGF0YSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLk1ldGFkYXRhSW5mb3JtYXRpb24gPSBmdW5jdGlvbihpbnN0YW5jZSwgbWV0YWRhdGEsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBtZXRhZGF0YVxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuQ2FtZXJhfEVWV0VCMi5BdWRpb0RldmljZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbnN0YW5jZSA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtZXRhZGF0YSBpdGVtcyBmb3IgdGhpcyB0aW1lIHJhbmdlXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5NZXRhZGF0YUl0ZW1bXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGFydCBkYXRlIG9mIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVuZCBkYXRlIG9mIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIGlmKHR5cGVvZiBpbnN0YW5jZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbWV0YWRhdGEgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm1ldGFkYXRhID0gbWV0YWRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHN0YXJ0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBlbmQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmVuZCA9IGVuZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBIGNvbnRhaW5lciBmb3IgYWxsIG1ldGFkYXRhIGluZm9ybWF0aW9uIHJlcXVlc3RlZCBieSBhIGNhbGwgdG8ge0BsaW5rIEVWV0VCMi5nZXRNZXRhZGF0YX0uXG4gICAgICogQHBhcmFtIHtFVldFQjIuTWV0YWRhdGFJbmZvcm1hdGlvbltdfSBbY2FtZXJhTWV0YWRhdGE9W11dIFRoZSBtZXRhZGF0YSBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIHJlcXVlc3RlZFxuICAgICAqIHtAbGluayBFVldFQjIuQ2FtZXJhfSBpbnN0YW5jZXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuTWV0YWRhdGFJbmZvcm1hdGlvbltdfSBbYXVkaW9NZXRhZGF0YT1bXV0gVGhlIG1ldGFkYXRhIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVxdWVzdGVkXG4gICAgICoge0BsaW5rIEVWV0VCMi5BdWRpb0RldmljZX0gaW5zdGFuY2VzLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW3N0YXJ0PW5ldyBEYXRlKCldIFRoZSBzdGFydCBkYXRlIHRpbWUgb2YgdGhlIHJlcXVlc3RlZCBtZXRhZGF0YSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtlbmQ9bmV3IERhdGUoKV0gVGhlIGVuZCBkYXRlIHRpbWUgb2YgdGhlIHJlcXVlc3RlZCBtZXRhZGF0YSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Nlc3Npb25JZD0nJ10gVGhlIGdlbmVyYXRlZCBzZXNzaW9uIElEIGZvciB0aGUgbWV0YWRhdGEgaW5zdGFuY2UuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIEVWV0VCMi5NZXRhZGF0YSA9IGZ1bmN0aW9uKGNhbWVyYU1ldGFkYXRhLCBhdWRpb01ldGFkYXRhLCBzdGFydCwgZW5kLCBzZXNzaW9uSWQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcnZlciB0aGlzIFNlYXJjaCBpcyBhdHRhY2hlZCB0b1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXNzaW9uIElEIGZvciB0aGUgbWV0YWRhdGEgaW5zdGFuY2UuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogTWV0YWRhdGEgaW5mb3JtYXRpb24gZm9yIHRoZSBhc3NvY2lhdGVkIGNhbWVyYXNcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLk1ldGFkYXRhSW5mb3JtYXRpb25bXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmFzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1ldGFkYXRhIGluZm9ybWF0aW9uIGZvciB0aGUgYXNzb2NpYXRlZCBhdWRpbyBpbnB1dCBzdHJlYW1zXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5NZXRhZGF0YUluZm9ybWF0aW9uW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXVkaW9JbnB1dHMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RhcnQgZGF0ZSBvZiB0aGUgc2VhcmNoXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhcnQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmQgZGF0ZSBvZiB0aGUgc2VhcmNoXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5kID0gbmV3IERhdGUoKTtcblxuICAgICAgICBpZih0eXBlb2YgY2FtZXJhTWV0YWRhdGEgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmNhbWVyYXMgPSBjYW1lcmFNZXRhZGF0YTtcbiAgICAgICAgICAgIGlmKGNhbWVyYU1ldGFkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlciA9IGNhbWVyYU1ldGFkYXRhWzBdLmluc3RhbmNlLnNlcnZlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgYXVkaW9NZXRhZGF0YSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9JbnB1dHMgPSBhdWRpb01ldGFkYXRhO1xuICAgICAgICAgICAgaWYoYXVkaW9NZXRhZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXIgPSBhdWRpb01ldGFkYXRhWzBdLmluc3RhbmNlLnNlcnZlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygc3RhcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGVuZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kID0gZW5kO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZXNzaW9uSWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZW5lcmF0ZXMgYSBVUkwgZm9yIHJldHJpZXZpbmcgYSBmcmFtZSBmcm9tIHRoZSBzcGVjaWZpZWQgY2FtZXJhIGF0IGEgZ2l2ZW4gdGltZS5cbiAgICAgICAgICogTk9URTogVGhpcyBtZXRob2Qgc2hvdWxkIG5vdCBiZSB1c2VkIGZvciBub3JtYWwgdmlkZW8gcGxheWJhY2ssIGFzIHBlcmZvcm1hbmNlIHdpbGwgYmUgdmVyeSBwb29yIGluIHRoYXRcbiAgICAgICAgICogYXBwbGljYXRpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gY2FtZXJhIFRhcmdldCBjYW1lcmEgZm9yIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHBhcmFtIHtEYXRlfSB0aW1lc3RhbXAgVGhlIHRpbWVzdGFtcCBvZiB0aGUgcmVxdWlyZWQgZnJhbWVcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgaW1hZ2UgaW4gcGl4ZWxzXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gcGl4ZWxzXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBxdWFsaXR5IFF1YWxpdHkgb2YgdGhlIHJlcXVlc3RlZCBpbWFnZSBiZXR3ZWVuIDEgYW5kIDEwICgxIGxvd2VzdCwgMTAgaGlnaGVzdClcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgdXJsIHRvIGFjY2VzcyB0aGUgZnJhbWVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RnJhbWVBdFRpbWUgPSBmdW5jdGlvbiAoY2FtZXJhLCB0aW1lc3RhbXAsIHdpZHRoLCBoZWlnaHQsIHF1YWxpdHkpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuc2Vzc2lvbklkID09PSAnJyB8fCAhY2FtZXJhLnN1cHBvcnRzR2V0RnJhbWUoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMubWV0YWRhdGE7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gW1xuICAgICAgICAgICAgICAgICdzPScgKyB0aGlzLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnYWN0aW9uPWZyYW1lJyxcbiAgICAgICAgICAgICAgICAndGltZT0nICsgRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKHRpbWVzdGFtcClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHZhciB1c2VOYXRpdmVKcGVnID0gZmFsc2U7XG4gICAgICAgICAgICBpZihjYW1lcmEucHR6VHlwZSA9PT0gRVZXRUIyLnB0elR5cGVzLmRpZ2l0YWwpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnY2FtZXJhPScgKyBjYW1lcmEuc291cmNlQ2FtZXJhLmlkKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnc2Vzc2lvbj0nICsgY2FtZXJhLnNlcnZlci5zZXNzaW9uSWQpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdkaWdpdGFscHR6PScgKyBjYW1lcmEuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2NhbWVyYT0nICsgY2FtZXJhLmlkKTtcbiAgICAgICAgICAgICAgICB2YXIgZm9yd2FyZGluZ1NldHRpbmdzID0gdGhpcy5zZXJ2ZXIuc2VydmljZS5qcGVnRm9yd2FyZGluZztcbiAgICAgICAgICAgICAgICBpZihmb3J3YXJkaW5nU2V0dGluZ3MuZW5hYmxlZCAmJiAkLmluQXJyYXkoRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZywgY2FtZXJhLmZvcm1hdHMpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB1c2VOYXRpdmVKcGVnID0gY2FtZXJhLnF1YWxpdHkgKiAoZm9yd2FyZGluZ1NldHRpbmdzLnF1YWxpdHlUaHJlc2hvbGQvMTAwKSA8IHF1YWxpdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIChjYW1lcmEucmVzb2x1dGlvbi53aWR0aCAqIChmb3J3YXJkaW5nU2V0dGluZ3Muc2l6ZVRocmVzaG9sZC8xMDApIDwgd2lkdGggfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVzb2x1dGlvbi5oZWlnaHQgKiAoZm9yd2FyZGluZ1NldHRpbmdzLnNpemVUaHJlc2hvbGQvMTAwKSA8IGhlaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZvcm1hdCA9IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnO1xuICAgICAgICAgICAgaWYodXNlTmF0aXZlSnBlZyB8fCAkLmluQXJyYXkoRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWcsIGNhbWVyYS5mb3JtYXRzKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBmb3JtYXQgPSBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZm9ybWF0ICE9PSBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3c9Jyt3aWR0aCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2g9JytoZWlnaHQpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdxPScrcXVhbGl0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgnZm9ybWF0PScrZm9ybWF0KTtcbiAgICAgICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignOycpICsgJzsnO1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB1cmwgKz0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3RpZmllcyB0aGUgc2VydmljZSB0aGF0IGEgcHJvY2VzcyBpcyBzdGlsbCBpbiB1c2UuICBUaGlzIHByZXZlbnRzIGFuIGFjdGl2ZSBpbnN0YW5jZSBmcm9tIGJlaW5nIGNsb3NlZC5cbiAgICAgICAgICogQHBhcmFtIHtmdW5jdGlvbn0gW2NhbGxiYWNrXSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5vdGlmeVVzZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYodGhpcy5zZXNzaW9uSWQgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ01ldGFkYXRhIGluc3RhbmNlIGlzIG5vdCBhdmFpYWxibGUuJyk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbWV0YWRhdGFTZXJ2ZXIgPSBuZXcgRVZXRUIyLlNlcnZlcih0aGlzLnNlcnZlci5zZXJ2aWNlLCAnJywgdGhpcy5zZXJ2ZXIuaWQsIHRydWUsIGZhbHNlLFxuICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbklkKTtcbiAgICAgICAgICAgIG1ldGFkYXRhU2VydmVyLm5vdGlmeVVzZShjYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvZ3Mgb3V0IHRoZSBjdXJyZW50IG1ldGFkYXRhIGluc3RhbmNlLiAgVGhpcyBkZXN0cm95cyBhbGwgcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWV0YWRhdGEgYW5kIHNob3VsZFxuICAgICAgICAgKiBiZSBjYWxsZWQgZm9yIGVhY2ggbWV0YWRhdGEgaW5zdGFuY2UgYXMgaXQgaXMgbm8gbG9uZ2VyIG5lZWRlZC5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZih0aGlzLnNlc3Npb25JZCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTWV0YWRhdGEgaW5zdGFuY2UgaXMgbm90IGF2YWlhbGJsZS4nKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uTG9nb3V0U2VydmVyRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25Mb2dvdXRTZXJ2ZXJTdWNjZXNzID0gZnVuY3Rpb24oLypkYXRhLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkxvZ291dFNlcnZlclN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTG9nb3V0U2VydmVyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMubG9nb3V0LFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogdGhpcy5zZXNzaW9uSWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIG1ldGFkYXRhIGZ1bmN0aW9uIGhhbmRsZXMgcmV0cmlldmluZyBtZXRhZGF0YSBpbmZvcm1hdGlvbiBmb3IgYSBzZXQgb2YgY2FtZXJhcyBvdmVyIGEgZHVyYXRpb24uICBJdFxuICAgICAqIHF1ZXJpZXMgdGhlIHNlcnZlciBmb3IgdGhlIG1ldGFkYXRhIGluZm9ybWF0aW9uIG9uIHRoZSBzZXQgb2YgY2FtZXJhcy5cbiAgICAgKlxuICAgICAqIEZvciBiYWNrd2FyZHMgY29tcGF0YWJpbGl0eSwgd2hlbiBjb21tdW5pY2F0aW5nIHdpdGggc2VydmljZXMgcnVubmluZyB2ZXJzaW9uIDIuMTAuMSBvciBlYXJsaWVyLCBhdWRpbyBpbnB1dHNcbiAgICAgKiBhcmUgbm90IHN1cHBvcnRlZC4gIFJlcXVlc3RpbmcgYXVkaW8gaW5wdXQgbWV0YWRhdGEgaW5mb3JtYXRpb24gd2lsbCBub3QgY2F1c2UgYSBmYWlsdXJlLCBidXQgbm8gcmVzdWx0cyB3aWxsIGJlXG4gICAgICogcmV0dXJuZWQgZm9yIHRoZSBhdWRpbyBpbnB1dHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gVGhlIGZ1bmN0aW9uIGdldHMgcGFzc2VkXG4gICAgICogIHR3byBhcmd1bWVudHM6IHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhXG4gICAgICogIHtAbGluayBFVldFQjIuTWV0YWRhdGF9IGluc3RhbmNlIGRlc2NyaWJpbmcgYWxsIG9mIHRoZSBtZXRhZGF0YSBpbmZvcm1hdGlvbiBmb3IgdGhlIGFzc29jaWF0ZWQgaW5wdXRzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYVtdfEVWV0VCMi5BdWRpb0RldmljZVtdfSBpbnB1dHMgQXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5DYW1lcmF9IGFuZFxuICAgICAqIHtAbGluayBFVldFQjIuQXVkaW9EZXZpY2V9IG9iamVjdHMgdGhhdCBhcmUgdGhlIHRhcmdldHMgZm9yIHRoZSBtZXRhZGF0YSBzZWFyY2guXG4gICAgICogQHBhcmFtIHtEYXRlfSBzdGFydCBUaGUgc3RhcnQgdGltZSBvZiB0aGUgbWV0YWRhdGEgc2VhcmNoXG4gICAgICogQHBhcmFtIHtEYXRlfSBlbmQgVGhlIGVuZCB0aW1lIG9mIHRoZSBtZXRhZGF0YSBzZWFyY2hcbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLmdldE1ldGFkYXRhID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBpbnB1dHMsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGRpZmZlcmVudCBpbnB1dCBsaXN0c1xuICAgICAgICB2YXIgY2FtZXJhcyA9ICQuZ3JlcChpbnB1dHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgRVZXRUIyLkNhbWVyYTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBhdWRpb0lucHV0cyA9ICQuZ3JlcChpbnB1dHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgRVZXRUIyLkF1ZGlvRGV2aWNlO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgb25HZXRNZXRhZGF0YUVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICBpZih4aHIuc3RhdHVzID09PSA0MDggfHwgeGhyLnN0YXR1cyA9PT0gNTA0KSB7XG4gICAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZS5lcnJvclRleHQgPSAnQSB0aW1lb3V0IGhhcyBvY2N1cnJlZCByZXF1ZXN0aW5nIG1ldGFkYXRhLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih4aHIuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlLmVycm9yVGV4dCA9IFwiTm8gcGVybWlzc2lvbiB0byBzZWFyY2guXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgbWV0YWRhdGFJdGVtRnJvbVJlc3BvbnNlID0gZnVuY3Rpb24ocmVzcG9uc2VJdGVtKSB7XG4gICAgICAgICAgICB2YXIgaXRlbVN0YXJ0ID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKHJlc3BvbnNlSXRlbS5zdGFydCk7XG4gICAgICAgICAgICB2YXIgaXRlbUVuZCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShyZXNwb25zZUl0ZW0uZW5kKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLk1ldGFkYXRhSXRlbShpdGVtU3RhcnQsIGl0ZW1FbmQsIHJlc3BvbnNlSXRlbS5mbGFncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHByb2Nlc3NDYW1lcmFNZXRhZGF0YVJlc3BvbnNlcyA9IGZ1bmN0aW9uKHJlc3BvbnNlQ2FtZXJhcykge1xuICAgICAgICAgICAgcmV0dXJuICQubWFwKHJlc3BvbnNlQ2FtZXJhcywgZnVuY3Rpb24oZWxlbWVudCwga2V5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1ldGFkYXRhSXRlbXMgPSAkLm1hcChlbGVtZW50Lm1ldGFkYXRhLCBtZXRhZGF0YUl0ZW1Gcm9tUmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNhbWVyYSA9ICQuZ3JlcChjYW1lcmFzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmlkLnRvU3RyaW5nKCkgPT09IGtleTtcbiAgICAgICAgICAgICAgICB9KVswXTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLk1ldGFkYXRhSW5mb3JtYXRpb24oY2FtZXJhLCBtZXRhZGF0YUl0ZW1zLCBlbGVtZW50LnN0YXJ0LCBlbGVtZW50LmVuZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgcHJvY2Vzc0F1ZGlvSW5wdXRzTWV0YWRhdGFSZXNwb25zZXMgPSBmdW5jdGlvbihyZXNwb25zZUF1ZGlvSW5wdXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5tYXAocmVzcG9uc2VBdWRpb0lucHV0cywgZnVuY3Rpb24oZWxlbWVudCwga2V5KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1ldGFkYXRhSXRlbXMgPSAkLm1hcChlbGVtZW50Lm1ldGFkYXRhLCBtZXRhZGF0YUl0ZW1Gcm9tUmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGF1ZGlvSW5wdXQgPSAkLmdyZXAoYXVkaW9JbnB1dHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuaWQudG9TdHJpbmcoKSA9PT0ga2V5O1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuTWV0YWRhdGFJbmZvcm1hdGlvbihhdWRpb0lucHV0LCBtZXRhZGF0YUl0ZW1zLCBlbGVtZW50LnN0YXJ0LCBlbGVtZW50LmVuZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25PbGRHZXRNZXRhZGF0YVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICBpZihkYXRhID09PSBFVldFQjIuZXJyb3JzLnNlcnZlcnMpIHtcbiAgICAgICAgICAgICAgICAvL0NhbGwgdGhlIGVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgb25HZXRNZXRhZGF0YUVycm9yKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjYW1lcmFNZXRhZGF0YSA9IHByb2Nlc3NDYW1lcmFNZXRhZGF0YVJlc3BvbnNlcyhkYXRhKTtcbiAgICAgICAgICAgIHZhciBtZXRhZGF0YVJlc3BvbnNlID0gbmV3IEVWV0VCMi5NZXRhZGF0YShjYW1lcmFNZXRhZGF0YSwgdW5kZWZpbmVkLCBzdGFydCwgZW5kKTtcblxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgbWV0YWRhdGFSZXNwb25zZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG9uR2V0TWV0YWRhdGFTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgaWYoZGF0YSA9PT0gRVZXRUIyLmVycm9ycy5zZXJ2ZXJzKSB7XG4gICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgIG9uR2V0TWV0YWRhdGFFcnJvcigpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY2FtZXJhTWV0YWRhdGEgPSBwcm9jZXNzQ2FtZXJhTWV0YWRhdGFSZXNwb25zZXMoZGF0YS5jYW1lcmFzKTtcbiAgICAgICAgICAgIHZhciBhdWRpb0lucHV0c01ldGFkYXRhID0gcHJvY2Vzc0F1ZGlvSW5wdXRzTWV0YWRhdGFSZXNwb25zZXMoZGF0YS5hdWRpbyk7XG4gICAgICAgICAgICB2YXIgbWV0YWRhdGFSZXNwb25zZSA9IG5ldyBFVldFQjIuTWV0YWRhdGEoY2FtZXJhTWV0YWRhdGEsIGF1ZGlvSW5wdXRzTWV0YWRhdGEsIHN0YXJ0LCBlbmQsIGRhdGEuc2Vzc2lvbklkKTtcblxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAvL1JldHVybiB0aGUgc2VydmVyIGxpc3RcbiAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgbWV0YWRhdGFSZXNwb25zZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIHNlcnZlcjtcbiAgICAgICAgaWYoY2FtZXJhcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXJ2ZXIgPSBjYW1lcmFzWzBdLnNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhdWRpb0lucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBzZXJ2ZXIgPSBhdWRpb0lucHV0c1swXS5zZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdObyBpdGVtcyB0byBzZWFyY2guJyk7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBvblZlcnNpb25OdW1iZXJSZXNwb25zZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCB2ZXJzaW9uTnVtYmVyKSB7XG4gICAgICAgICAgICB2YXIgdXNlTmV3UmVxdWVzdCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uTnVtYmVyID09PSAnMC4wLjAuMCcpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQWx3YXlzIHVzZSB0aGUgbmV3IG1ldGhvZCBpbnRlcm5hbGx5XG4gICAgICAgICAgICAgICAgICAgIHVzZU5ld1JlcXVlc3QgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb25WYWx1ZXMgPSB2ZXJzaW9uTnVtYmVyLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgbmV3IHJlcXVlc3QgaWYgaXQncyBhIHZlcnNpb24gZ3JlYXRlciB0aGFuIDIuMTBcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1ham9yVmVyc2lvbiA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5vclZlcnNpb24gPSAwO1xuICAgICAgICAgICAgICAgICAgICBpZih2ZXJzaW9uVmFsdWVzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ham9yVmVyc2lvbiA9IHBhcnNlSW50KHZlcnNpb25WYWx1ZXNbMF0sIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbm9yVmVyc2lvbiA9IHBhcnNlSW50KHZlcnNpb25WYWx1ZXNbMV0sIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHVzZU5ld1JlcXVlc3QgPSBtYWpvclZlcnNpb24gPiAyIHx8IChtYWpvclZlcnNpb24gPT09IDIgJiYgbWlub3JWZXJzaW9uID4gMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVybCA9IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMubWV0YWRhdGEgKyAnP3M9JyArIHNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICBpZih1c2VOZXdSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgdXJsICs9ICc7cmVzcG9uc2VWZXJzaW9uPTInO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICBmb3IoaT0wOyBpPGNhbWVyYXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FtZXJhc1tpXS5pZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICc7Y2FtZXJhPScrIGNhbWVyYXNbaV0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yKGk9MDsgaTxhdWRpb0lucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBhdWRpb0lucHV0c1tpXS5pZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICc7YXVkaW89JysgYXVkaW9JbnB1dHNbaV0uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXJsICs9ICc7c3RhcnQ9JytFVldFQjIudXRpbC5EYXRlMklFVEYoc3RhcnQpICsgXCI7ZW5kPVwiICsgRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKGVuZCk7XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbk9sZEdldE1ldGFkYXRhU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRNZXRhZGF0YUVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHVzZU5ld1JlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5zdWNjZXNzID0gb25HZXRNZXRhZGF0YVN1Y2Nlc3M7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gR2V0IHRoZSB2ZXJzaW9uIG51bWJlciBvZiB0aGUgc2VydmljZSB0byBkZXRlcm1pbmUgd2hpY2ggSFRUUCByZXF1ZXN0IHRvIG1ha2VcbiAgICAgICAgc2VydmVyLnNlcnZpY2UudmVyc2lvbihvblZlcnNpb25OdW1iZXJSZXNwb25zZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBtZXRhZGF0YSBmdW5jdGlvbiBoYW5kbGVzIHJldHJpZXZpbmcgbWV0YWRhdGEgaW5mb3JtYXRpb24gZm9yIGEgc2V0IG9mIGNhbWVyYXMgb3ZlciBhIGR1cmF0aW9uLiAgSXRcbiAgICAgKiBxdWVyaWVzIHRoZSBzZXJ2ZXIgZm9yIHRoZSBtZXRhZGF0YSBpbmZvcm1hdGlvbiBvbiB0aGUgc2V0IG9mIGNhbWVyYXMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIFRoZSBmdW5jdGlvbiBnZXRzIHBhc3NlZFxuICAgICAqICB0d28gYXJndW1lbnRzOiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW4gb2JqZWN0IG9mIHRoZVxuICAgICAqICBtZXRhZGF0YSBmb3IgZWFjaCBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhW119IGNhbWVyYXMgQXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5DYW1lcmF9IGluc3RhbmNlcyBmb3IgcmV0cmlldmluZyBtZXRhZGF0YS5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IHN0YXJ0IFRoZSBzdGFydCB0aW1lIG9mIHRoZSBtZXRhZGF0YSBzZWFyY2hcbiAgICAgKiBAcGFyYW0ge0RhdGV9IGVuZCBUaGUgZW5kIHRpbWUgb2YgdGhlIG1ldGFkYXRhIHNlYXJjaFxuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgZnVuY3Rpb24gaGFzIGJlZW4gZGVwcmVjYXRlZCBpbiBwbGFjZSBvZiBFVldFQjIuZ2V0TWV0YWRhdGEgdG8gc3VwcG9ydCBhIG1vcmUgY29uc2lzdGVudCBuYW1pbmcgc3RydWN0dXJlLFxuICAgICAqIGEgZGVmaW5lZCByZXN1bHQgb2JqZWN0LCBhcyB3ZWxsIGFzIHRvIHByb3ZpZGUgc2VhcmNoaW5nIG9uIGF1ZGlvIGlucHV0cy5cbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLm1ldGFkYXRhID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBjYW1lcmFzLCBzdGFydCwgZW5kKSB7XG4gICAgICAgIHZhciBvbkdldE1ldGFkYXRhID0gZnVuY3Rpb24ocmVzcG9uc2UsIG1ldGFkYXRhKSB7XG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBFVldFQjIuTWV0YWRhdGEgb2JqZWN0cyBiYWNrIHRvIHRoZSBvcmlnaW5hbCBmb3JtYXQsIGlnbm9yaW5nIGF1ZGlvIGlucHV0cy5cbiAgICAgICAgICAgIHZhciBjYW1lcmFzTWV0YWRhdGEgPSB7fTtcblxuICAgICAgICAgICAgJC5lYWNoKG1ldGFkYXRhLmNhbWVyYXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhbWVyYU1ldGFkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogZWxlbWVudC5zdGFydCxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBlbGVtZW50LmVuZCxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IHt9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlbGVtZW50Lm1ldGFkYXRhLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBNYXAgdGhlIGZsYWdzIGJhY2sgdG8gdGhlIGJpdGZpZWxkXG4gICAgICAgICAgICAgICAgICAgIHZhciBmbGFncyA9IDB4MDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgICAgICAgICAgICAgZm9yKGk9MDsgaTxlbGVtZW50LmZsYWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LmZsYWdzW2ldID09PSBFVldFQjIubWV0YWRhdGFGbGFncy5mcmVlUnVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyB8IEZMQUdfRlJFRV9SVU47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGVsZW1lbnQuZmxhZ3NbaV0gPT09IEVWV0VCMi5tZXRhZGF0YUZsYWdzLm1vdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzID0gZmxhZ3MgfCBGTEFHX01PVElPTjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoZWxlbWVudC5mbGFnc1tpXSA9PT0gRVZXRUIyLm1ldGFkYXRhRmxhZ3MuYWxhcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFncyA9IGZsYWdzIHwgRkxBR19BTEFSTTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhTWV0YWRhdGEubWV0YWRhdGFbaW5kZXhdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IEVWV0VCMi51dGlsLkRhdGUySUVURihlbGVtZW50LnN0YXJ0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKGVsZW1lbnQuZW5kKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZsYWdzOiBmbGFnc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNhbWVyYXNNZXRhZGF0YVtlbGVtZW50Lmluc3RhbmNlLmlkXSA9IGNhbWVyYU1ldGFkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSwgY2FtZXJhc01ldGFkYXRhKTtcbiAgICAgICAgfTtcblxuICAgICAgICBFVldFQjIuZ2V0TWV0YWRhdGEob25HZXRNZXRhZGF0YSwgY2FtZXJhcywgc3RhcnQsIGVuZCk7XG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUsICQ6ZmFsc2UqL1xuKGZ1bmN0aW9uKCkge1xuICAgIC8qKlxuICAgICAqIFRoZSBTZWFyY2ggQXVkaW8gQ2xpcCBJbmZvIG9iamVjdCBpcyBhIGNvbnRhaW5lciByZXByZXNlbnRpbmcgdGhlIGluZm9ybWF0aW9uIHN1cnJvdW5kaW5nXG4gICAgICogYSBzaW5nbGUgYXVkaW8gY2xpcCBpbiBhIHNlYXJjaC4gIFRoaXMgb2JqZWN0IGlzIGdlbmVyYWxseSBub3QgdXNlZCwgYXMgaXQgaXNcbiAgICAgKiBvbmx5IHJlbGV2YW50IGluIHNpdHVhdGlvbnMgd2hlcmUgdGhlIHNhbXBsZSByYXRlIG9yIGZvcm1hdCBvZiBhIGdpdmVuIGF1ZGlvIHN0cmVhbSBjaGFuZ2VkXG4gICAgICogb3ZlciB0aW1lLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBwYXJhbSB7RGF0ZX0gW3N0YXJ0PW5ldyBEYXRlKCldIFN0YXJ0IGRhdGUgb2YgdGhlIGNsaXBcbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtlbmQ9bmV3IERhdGUoKV0gRW5kIGRhdGUgb2YgdGhlIGNsaXBcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5hdWRpb0RldmljZU5hdGl2ZUZvcm1hdFR5cGVzfSBbbmF0aXZlRm9ybWF0PUVWV0VCMi5hdWRpb0RldmljZU5hdGl2ZUZvcm1hdFR5cGVzLm5vbmVdIFRoZSBuYXRpdmVcbiAgICAgKiBmb3JtYXQgZm9yIHRoZSBhdWRpbyBkZXZpY2UgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgY2xpcC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2ZyZXF1ZW5jeT0wXSBUaGUgc2FtcGxlcyBwZXIgc2Vjb25kIG9mIHRoZSByZXR1cm5lZCBhdWRpbyBmb3IgdGhlIGR1cmF0aW9uXG4gICAgICogb2YgdGhlIGNsaXAuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcmFtZXM9MF0gVGhlIG51bWJlciBvZiBmcmFtZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2xpcC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3NhbXBsZXNQZXJGcmFtZT0wXSBUaGUgbnVtYmVyIG9mIHNhbXBsZXMgaW4gYSBnaXZlbiBmcmFtZSBmb3IgdGhpcyBjbGlwLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoQXVkaW9DbGlwSW5mbyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kLCBuYXRpdmVGb3JtYXQsIGZyZXF1ZW5jeSwgZnJhbWVzLCBzYW1wbGVzUGVyRnJhbWUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0YXJ0IGRhdGUgb2YgdGhlIGNsaXBcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVuZCBkYXRlIG9mIHRoZSBjbGlwXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5kID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hdGl2ZSBmb3JtYXQgZm9yIHRoZSBhdWRpbyBkZXZpY2UgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgY2xpcC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmF1ZGlvRGV2aWNlTmF0aXZlRm9ybWF0VHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmF0aXZlRm9ybWF0ID0gRVZXRUIyLmF1ZGlvRGV2aWNlTmF0aXZlRm9ybWF0VHlwZXMubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNhbXBsZXMgcGVyIHNlY29uZCBvZiB0aGUgcmV0dXJuZWQgYXVkaW8gZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgY2xpcC5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZyZXF1ZW5jeSA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgZnJhbWVzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGNsaXAuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZyYW1lcyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2Ygc2FtcGxlcyBpbiBhIGdpdmVuIGZyYW1lIGZvciB0aGlzIGNsaXAuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNhbXBsZXNQZXJGcmFtZSA9IDA7XG5cbiAgICAgICAgaWYoc3RhcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIGlmKGVuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVuZCA9IGVuZDtcbiAgICAgICAgfVxuICAgICAgICBpZihuYXRpdmVGb3JtYXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYXRpdmVGb3JtYXQgPSBuYXRpdmVGb3JtYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZnJlcXVlbmN5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZnJlcXVlbmN5ID0gZnJlcXVlbmN5O1xuICAgICAgICB9XG4gICAgICAgIGlmKGZyYW1lcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZyYW1lcyA9IGZyYW1lcztcbiAgICAgICAgfVxuICAgICAgICBpZihzYW1wbGVzUGVyRnJhbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zYW1wbGVzUGVyRnJhbWUgPSBzYW1wbGVzUGVyRnJhbWU7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgU2VhcmNoIEF1ZGlvIEluZm8gb2JqZWN0IGlzIGEgY29udGFpbmVyIHJlcHJlc2VudGluZyB0aGUgYXVkaW8gY2xpcCBpbmZvcm1hdGlvblxuICAgICAqIGZvciBhIGdpdmVuIGF1ZGlvIGRldmljZSBpbiBhIHNlYXJjaC4gIFRoaXMgb2JqZWN0IGlzIGdlbmVyYWxseSBub3QgdXNlZCwgYXMgaXQgaXNcbiAgICAgKiBvbmx5IHJlbGV2YW50IGluIHNpdHVhdGlvbnMgd2hlcmUgdGhlIHNhbXBsZSByYXRlIG9yIGZvcm1hdCBvZiBhIGdpdmVuIGF1ZGlvIHN0cmVhbVxuICAgICAqIGNoYW5nZWQgb3ZlciB0aW1lLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBwYXJhbSB7RVZXRUIyLkF1ZGlvRGV2aWNlfSBbYXVkaW9JbnB1dF0gVGhlIGF1ZGlvIGRldmljZSBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpc1xuICAgICAqIGNsaXAgaW5mb3JtYXRpb25cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZWFyY2hBdWRpb0NsaXBJbmZvW119IFthdWRpb0NsaXBzSW5mb3JtYXRpb25dIFRoZSBpbmRpdmlkdWFsIGF1ZGlvIGNsaXBcbiAgICAgKiBpbmZvcm1hdGlvbiBmb3IgYWxsIGNsaXBzIGluIHRoZSBzZWFyY2hlZCBzdHJlYW0uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtmcmFtZXNdIFRoZSB0b3RhbCBudW1iZXIgb2YgZnJhbWVzIGFzc29jaWF0ZWQgd2l0aCBhbGwgb2YgdGhlIGNsaXBzIGZvclxuICAgICAqIHRoaXMgZGV2aWNlLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoQXVkaW9JbmZvID0gZnVuY3Rpb24gKGF1ZGlvSW5wdXQsIGF1ZGlvQ2xpcHNJbmZvcm1hdGlvbiwgZnJhbWVzKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhdWRpbyBkZXZpY2UgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2xpcCBpbmZvcm1hdGlvblxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuQXVkaW9EZXZpY2VcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXVkaW9JbnB1dCA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbmRpdmlkdWFsIGF1ZGlvIGNsaXAgaW5mb3JtYXRpb24gZm9yIGFsbCBjbGlwcyBpbiB0aGUgc2VhcmNoZWQgc3RyZWFtLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VhcmNoQXVkaW9DbGlwSW5mb1tdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGlvQ2xpcHNJbmZvcm1hdGlvbiA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdG90YWwgbnVtYmVyIG9mIGZyYW1lcyBhc3NvY2lhdGVkIHdpdGggYWxsIG9mIHRoZSBjbGlwcyBmb3IgdGhpcyBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZyYW1lcyA9IDA7XG5cbiAgICAgICAgaWYoYXVkaW9JbnB1dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvSW5wdXQgPSBhdWRpb0lucHV0O1xuICAgICAgICB9XG4gICAgICAgIGlmKGF1ZGlvQ2xpcHNJbmZvcm1hdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvQ2xpcHNJbmZvcm1hdGlvbiA9IGF1ZGlvQ2xpcHNJbmZvcm1hdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihmcmFtZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mcmFtZXMgPSBmcmFtZXM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2VhcmNoVmlkZW9DbGlwSW5mbyByZXByZXNlbnRzIGEgc2luZ2xlIHRpbWUgcmFuZ2UgaW4gYSBzZWFyY2ggd2hlcmUgc3RvcmVkIHZpZGVvIGV4aXN0cy5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAcGFyYW0ge0RhdGV9IHN0YXJ0IFRoZSBzdGFydCBvZiB0aGUgY2xpcC5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IGVuZCBUaGUgZW5kIG9mIHRoZSBjbGlwLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoVmlkZW9DbGlwSW5mbyA9IGZ1bmN0aW9uKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdGFydCBvZiB0aGUgY2xpcC5cbiAgICAgICAgICogQHR5cGUge0RhdGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXJ0ID0gc3RhcnQgfHwgbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVuZCBvZiB0aGUgY2xpcC5cbiAgICAgICAgICogQHR5cGUge0RhdGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuZCA9IGVuZCB8fCBudWxsO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2hWaWRlb0luZm8gcmVwcmVzZW50cyB0aGUgdmlkZW8gY2xpcCBpbmZvcm1hdGlvbiBmb3IgYSBnaXZlbiBzZWFyY2hlZCBjYW1lcmEuXG4gICAgICogQGNsYXNzXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhfSBjYW1lcmEgVGhlIGFzc29jaWF0ZWQgY2FtZXJhIGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlYXJjaFZpZGVvQ2xpcEluZm9bXX0gY2xpcHMgVGhlIGluZGl2aWR1YWwgY2xpcCByYW5nZXMgcHJlc2VudCBpbiB0aGUgc2VhcmNoIGZvciB0aGUgY2FtZXJhLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoVmlkZW9JbmZvID0gZnVuY3Rpb24oY2FtZXJhLCBjbGlwcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFzc29jaWF0ZWQgY2FtZXJhIGluc3RhbmNlLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuQ2FtZXJhXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYSB8fCBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW5kaXZpZHVhbCBjbGlwIHJhbmdlcyBwcmVzZW50IGluIHRoZSBzZWFyY2ggZm9yIHRoZSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZWFyY2hWaWRlb0NsaXBJbmZvW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2xpcHMgPSBjbGlwcyB8fCBbXTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRW51bSBvZiBzZWFyY2ggc3RhdHVzZXNcbiAgICAgKiBAZW51bSB7TnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoU3RhdHVzVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3Qgc3RhcnRlZFxuICAgICAgICAgKi9cbiAgICAgICAgbm90U3RhcnRlZDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN0YXJ0ZWRcbiAgICAgICAgICovXG4gICAgICAgIHN0YXJ0ZWQ6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb21wbGV0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNvbXBsZXRlOiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogRXJyb3IgZHVlIHRvIGRpc2sgc3BhY2UgcmVzdHJpY3Rpb25zXG4gICAgICAgICAqL1xuICAgICAgICBlcnJvclNwYWNlOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogVW5rbm93biBlcnJvclxuICAgICAgICAgKi9cbiAgICAgICAgZXJyb3JVbmtub3duOiA1XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3Igb3ZlcmFsbCBzZWFyY2ggc3RhdHVzIGluZm9ybWF0aW9uLiAgVGhpcyBpbmZvcm1hdGlvbiByZXByZXNlbnRzXG4gICAgICogdGhlIHN0YXR1cyBvZiB0aGUgc2VhcmNoIHByb2Nlc3MgaXRzZWxmLCBpbiB0ZXJtcyBvZiByZXRyaWV2aW5nIGFuZCBwcm9jZXNzaW5nXG4gICAgICogZnJhbWVzIGZvciBwbGF5YmFja1xuICAgICAqIEBjbGFzc1xuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlYXJjaFN0YXR1c1R5cGV9IHN0YXR1cyBUaGUgc3RhdHVzIG9mIHRoZSBzZWFyY2guXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGZyYW1lcyBUaGUgbnVtYmVyIG9mIGZyYW1lcyByZXRyaWV2ZWQgYnkgdGhlIHNlYXJjaCBwcm9jZXNzLiAgTm90ZTogVGhpc1xuICAgICAqICAgdmFsdWUgcmVwcmVzZW50cyB0aGUgdG90YWwgbnVtYmVyIG9mIFwicGxheWFibGVcIiBmcmFtZXMgYXZhaWxhYmxlLiAgUGxheWJhY2sgb2YgZnJhbWVzXG4gICAgICogICBwYXN0IHRoaXMgdmFsdWUgaXMgbm90IHBvc3NpYmxlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0b3RhbEZyYW1lcyBUaGUgdG90YWwgbnVtYmVyIG9mIGZyYW1lcyBmb3IgdGhlIHNlYXJjaC5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLlNlYXJjaFN0YXR1cyA9IGZ1bmN0aW9uKHN0YXR1cywgZnJhbWVzLCB0b3RhbEZyYW1lcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHN0YXR1cyBvZiB0aGUgc2VhcmNoLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlYXJjaFN0YXR1c1R5cGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1cztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiBmcmFtZXMgcmV0cmlldmVkIGJ5IHRoZSBzZWFyY2ggcHJvY2Vzcy4gIE5vdGU6IFRoaXMgdmFsdWUgcmVwcmVzZW50c1xuICAgICAgICAgKiB0aGUgdG90YWwgbnVtYmVyIG9mIFwicGxheWFibGVcIiBmcmFtZXMgYXZhaWxhYmxlLiAgUGxheWJhY2sgb2YgZnJhbWVzIHBhc3QgdGhpc1xuICAgICAgICAgKiB2YWx1ZSBpcyBub3QgcG9zc2libGUuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZyYW1lcyA9IGZyYW1lcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIG51bWJlciBvZiBmcmFtZXMgZm9yIHRoZSBzZWFyY2guXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvdGFsRnJhbWVzID0gdG90YWxGcmFtZXM7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgdGhlIG92ZXJhbGwgc2VhcmNoIGZyYW1lIGNvdW50IGluZm9ybWF0aW9uLiAgVGhpcyBpbmZvcm1hdGlvbiByZXByZXNlbnRzIHRoZSBicmVha2Rvd25cbiAgICAgKiBvZiBmcmFtZXMgYnkgdmlkZW8gYW5kIGF1ZGlvLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2aWRlbyBUaGUgbnVtYmVyIG9mIHZpZGVvIGZyYW1lcyBpbiB0aGUgc2VhcmNoLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBhdWRpbyBUaGUgbnVtYmVyIG9mIGF1ZGlvIGZyYW1lcyBpbiB0aGUgc2VhcmNoLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoRnJhbWVDb3VudHMgPSBmdW5jdGlvbih2aWRlbywgYXVkaW8pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgdmlkZW8gZnJhbWVzIGluIHRoZSBzZWFyY2guXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZpZGVvID0gdmlkZW87XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgYXVkaW8gZnJhbWVzIGluIHRoZSBzZWFyY2guXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGlvID0gYXVkaW87XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTZWFyY2ggb2JqZWN0IGlzIGEgY29udGFpbmVyIHJlcHJlc2VudGluZyBhIHJlcXVlc3RlZCBzZWFyY2guXG4gICAgICogQGNsYXNzXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHNlYXJjaElkIFNlYXJjaCBJRCB1c2VkIHRvIGlkZW50aWZ5IHRoZSBzZWFyY2ggb24gdGhlIHdlYiBzZXJ2aWNlLlxuICAgICAqIEBwYXJhbSB7QXJyYXkuPChFVldFQjIuQ2FtZXJhfEVWV0VCMi5BdWRpb0RldmljZSk+fSBpbnB1dHMgVGhlIGlucHV0cyBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaC4gIENhbiBiZSBhIG1peGVkXG4gICAgICogbGlzdCBvZiB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gYW5kIHtAbGluayBFVldFQjIuQXVkaW9EZXZpY2V9IGluc3RhbmNlcy5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IHN0YXJ0IFN0YXJ0IGRhdGUgb2YgdGhlIHNlYXJjaFxuICAgICAqIEBwYXJhbSB7RGF0ZX0gZW5kIEVuZCBkYXRlIG9mIHRoZSBzZWFyY2hcbiAgICAgKiBAcGFyYW0ge051bWJlcnxFVldFQjIuU2VhcmNoRnJhbWVDb3VudHN9IGZyYW1lcyBUaGUgZnJhbWUgaW5mb3JtYXRpb24gZm9yIHRoZSBzZWFyY2gsIGJyb2tlbiBkb3duIGJ5IHZpZGVvIGFuZFxuICAgICAqIGF1ZGlvIG9yIChsZWdhY3kpIHRoZSB0b3RhbCBudW1iZXIgb2YgZnJhbWVzIGluIHRoZSBzZWFyY2guXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VhcmNoQXVkaW9JbmZvW119IFthdWRpb0luZm9ybWF0aW9uXSBJbmZvcm1hdGlvbiBhYm91dCBlYWNoIGF1ZGlvIGNsaXAgZm9yIGVhY2ggYXVkaW8gaW5wdXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VhcmNoVmlkZW9JbmZvW119IFt2aWRlb0luZm9ybWF0aW9uXSBJbmZvcm1hdGlvbiBhYm91dCBlYWNoIGNsaXAgcmFuZ2UgZm9yIHRoZSBzZWFyY2hlZCBjYW1lcmFzLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoID0gZnVuY3Rpb24gKHNlYXJjaElkLCBpbnB1dHMsIHN0YXJ0LCBlbmQsIGZyYW1lcywgYXVkaW9JbmZvcm1hdGlvbiwgdmlkZW9JbmZvcm1hdGlvbikge1xuICAgICAgICAvKipcbiAgICAgICAgICogU2VhcmNoIElEIHVzZWQgdG8gaWRlbnRpZnkgdGhlIHNlYXJjaFxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VhcmNoSWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLkNhbWVyYVtdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbWVyYXMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF1ZGlvIGlucHV0cyBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaFxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuQXVkaW9EZXZpY2VbXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdWRpb0lucHV0cyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VyaWFsIGRldmljZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxEZXZpY2VbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VyaWFsRGV2aWNlcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJ2ZXIgdGhpcyBTZWFyY2ggaXMgYXR0YWNoZWQgdG9cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGFydCBkYXRlIG9mIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGFydCA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVuZCBkYXRlIG9mIHRoZSBzZWFyY2hcbiAgICAgICAgICogQHR5cGUgRGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOdW1iZXIgb2YgZnJhbWVzIGluIHRoZSBzZWFyY2hcbiAgICAgICAgICogQGRlcHJlY2F0ZWQgVGhpcyBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIuU2VhcmNoLmZyYW1lSW5mb30sIHdoaWNoIHByb3ZpZGVzXG4gICAgICAgICAqIG1vcmUgZ3JhbnVsYXJpdHkgaW4gdGhlIGJyZWFrZG93biBvZiB2aWRlbyBhbmQgYXVkaW8gZnJhbWVzLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZnJhbWVzID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZyYW1lIGNvdW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaC4gIE5vdGU6IFdoZW4gcGVyZm9ybWluZyBmcmFtZS1yZWxhdGVkIGFjdGlvbnNcbiAgICAgICAgICogKGUuZy4ge0BsaW5rIEVWV0VCMi5TZWFyY2guc3RlcH19LCB2aWRlbyBhbmQgYXVkaW8gZnJhbWVzIGFyZSBpbmRleGVkIHNlcGFyYXRlbHkuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VhcmNoRnJhbWVDb3VudHN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZyYW1lSW5mbyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluZm9ybWF0aW9uIGFib3V0IGVhY2ggYXVkaW8gY2xpcCBmb3IgZWFjaCBhdWRpbyBpbnB1dC5cbiAgICAgICAgICogTm90ZTogVGhpcyBwcm9wZXJ0eSBpcyBnZW5lcmFsbHkgdW51c2VkLCBhcyBpdCBpcyBvbmx5IHJlbGV2YW50IGluIHNpdHVhdGlvbnMgd2hlcmUgdGhlIHNhbXBsZSByYXRlIG9yXG4gICAgICAgICAqIGZvcm1hdCBvZiBhIGdpdmVuIGF1ZGlvIHN0cmVhbSBjaGFuZ2VkIG92ZXIgdGltZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZWFyY2hBdWRpb0luZm9bXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXVkaW9JbmZvcm1hdGlvbiA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbmZvcm1hdGlvbiBhYm91dCBlYWNoIGNsaXAgcmFuZ2UgZm9yIHRoZSBzZWFyY2hlZCBjYW1lcmFzLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIHByb3BlcnR5IGlzIG5vdCBuZWVkZWQgZm9yIGJhc2ljIHNlYXJjaCBwbGF5YmFjay4gVGhlIHdlYiBzZXJ2aWNlIHdpbGwganVtcCBmcmFtZSBnYXBzIGZvciB5b3VcbiAgICAgICAgICogaWYgeW91IGFsbG93IGl0IHRvIGFkdmFuY2UgaXRzIG93biBwbGF5aGVhZC4gWW91IHdpbGwgb25seSBuZWVkIHRoaXMgaW5mb3JtYXRpb24gaWYgeW91IGludGVuZFxuICAgICAgICAgKiB0byByZXF1ZXN0IGZyYW1lcyBmcm9tIGEgc2VhcmNoIGF0IHNwZWNpZmljIHRpbWVzIChpZS4ga2VlcCB0cmFjayBvZiB5b3VyIG93biBwbGF5aGVhZCkuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VhcmNoVmlkZW9JbmZvW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZpZGVvSW5mb3JtYXRpb24gPSBbXTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHNlYXJjaElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSWQgPSBzZWFyY2hJZDtcbiAgICAgICAgfVxuICAgICAgICBpZihpbnB1dHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgdGhlIGRpZmZlcmVudCBpbnB1dCBsaXN0c1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzID0gJC5ncmVwKGlucHV0cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgRVZXRUIyLkNhbWVyYTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5hdWRpb0lucHV0cyA9ICQuZ3JlcChpbnB1dHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5BdWRpb0RldmljZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXJpYWxEZXZpY2VzID0gJC5ncmVwKGlucHV0cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50IGluc3RhbmNlb2YgRVZXRUIyLlNlcmlhbERldmljZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYoaW5wdXRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlcnZlciA9IGlucHV0c1swXS5zZXJ2ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3RhcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuICAgICAgICB9XG4gICAgICAgIGlmKGVuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVuZCA9IGVuZDtcbiAgICAgICAgfVxuICAgICAgICBpZihmcmFtZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoZnJhbWVzIGluc3RhbmNlb2YgRVZXRUIyLlNlYXJjaEZyYW1lQ291bnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZXMgPSBmcmFtZXMudmlkZW8gKyBmcmFtZXMuYXVkaW87XG4gICAgICAgICAgICAgICAgdGhpcy5mcmFtZUluZm8gPSBmcmFtZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBMZWdhY3kgbW9kZSwgdHJlYXQgYWxsIGZyYW1lcyBhcyB2aWRlb1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVzID0gZnJhbWVzO1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhbWVJbmZvID0gbmV3IEVWV0VCMi5TZWFyY2hGcmFtZUNvdW50cyhmcmFtZXMsIDApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgaWYoYXVkaW9JbmZvcm1hdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvSW5mb3JtYXRpb24gPSBhdWRpb0luZm9ybWF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKHZpZGVvSW5mb3JtYXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52aWRlb0luZm9ybWF0aW9uID0gdmlkZW9JbmZvcm1hdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2V0U3BlZWQgZnVuY3Rpb24gaGFuZGxlcyBtb2RpZnlpbmcgdGhlIHBsYXliYWNrIHNwZWVkIGZvciBzZWFyY2hlcyBpbml0aWF0ZWQgd2l0aCB0aGVcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5nZXRTZWFyY2h9IGZ1bmN0aW9uLiAgRWFjaCBzZWFyY2ggZmVlZCBjYW4gYmUgc3BlZCB1cCwgc2xvd2VkIGRvd24sIG9yIHJld291bmQuICBUbyBjb250cm9sXG4gICAgICAgICAqIHRoaXMsIHRoZSBzZXRTcGVlZCB0YWtlcyB0aGUgbmV3IHNwZWVkICgxMDAgYmVpbmcgcmVhbCB0aW1lLCAwIGJlaW5nIHBhdXNlZCwgYW5kIG5lZ2F0aXZlcyBiZWluZyByZXdpbmRpbmcpXG4gICAgICAgICAqIGFuZCBzZXRzIHRoZSByYXRlIGF0IHdoaWNoIGltYWdlcyBhcmUgcmV0cmlldmVkIHRvIGJlIG9uIHRoYXQgcGxheXNwZWVkIGZvciB0aGUgdGltZWxpbmUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIHRoZSB1cGRhdGVkIHNwZWVkLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gc3BlZWQgVGhlIG5ldyBzcGVlZCBkZXNpcmVkIGZvciB0aGlzIHNlYXJjaFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXRTcGVlZCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgc3BlZWQpIHtcbiAgICAgICAgICAgIHZhciBvblNlYXJjaFBsYXlTcGVlZEVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblNlYXJjaFBsYXlTcGVlZFN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBsYXlTcGVlZCA9IHBhcnNlSW50KGRhdGEsIDEwKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHBsYXlTcGVlZCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TZWFyY2hQbGF5U3BlZWRTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvblNlYXJjaFBsYXlTcGVlZEVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNwZWVkICsgJy8nICsgc3BlZWQsXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaF9pZDogdGhpcy5zZWFyY2hJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBsYXlpbmcgZnVuY3Rpb24gaXMgYW4gQUpBWCBjYWxsIHRvIGNoZWNrIHRoZSBzdGF0dXMgb2YgYSBzZWFyY2ggZmVlZC4gIEl0IGlzIHVzZWQgdG8gdmFsaWRhdGVcbiAgICAgICAgICogd2hldGhlciBhIHNlYXJjaCBpcyBzdGlsbCBjb250aW51aW5nIG9yIHdoZXRoZXIgaXQgaGFzIGV4cGlyZWQgYW5kIG5vIG5ldyBpbWFnZXMgYXJlIGF2YWlsYWJsZS4gIFRoaXNcbiAgICAgICAgICogZnVuY3Rpb24gY2FsbHMgdG8gdGhlIHdlYiBzZXJ2aWNlIHdlYiBzZXJ2ZXIgdG8gY2hlY2sgd2hldGhlciB0aGUgZmVlZCBpcyBzdGlsbCBiZWluZyBwbGF5ZWQgb3Igd2hldGhlclxuICAgICAgICAgKiBpdCBpcyBzdG9wcGVkLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhIEJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyXG4gICAgICAgICAqICB0aGUgc2VhcmNoIGlzIGN1cnJlbnRseSBwbGF5aW5nLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wbGF5aW5nID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgb25TZWFyY2hQbGF5aW5nRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU2VhcmNoUGxheWluZ1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBsYXlTcGVlZCA9IHBhcnNlSW50KGRhdGEsIDEwKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgaXNQbGF5aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAocGxheVNwZWVkID09PSAtMSB8fCBwbGF5U3BlZWQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaXNQbGF5aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgaXNQbGF5aW5nKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblNlYXJjaFBsYXlpbmdTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvblNlYXJjaFBsYXlpbmdFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zcGVlZCxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX2lkOiB0aGlzLnNlYXJjaElkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3RlcCBmdW5jdGlvbiBoYW5kbGVzIHNtYWxsIGp1bXBzIGluIHRoZSBwbGF5YmFjayBvZiBhIHNlYXJjaC4gIEl0IGNhbiBiZSB1c2VkIGZvciB3YWxraW5nIHRocm91Z2ggYVxuICAgICAgICAgKiBmZWVkIHRvIGxvb2sgZm9yIHNvbWV0aGluZyBzcGVjaWZpYyBhbmQgZGV0YWlsZWQuICBUaGUgaW50ZW5kZWQgdXNlIG9mIHRoaXMgaXMgdG8gYmUgY291cGxlZCB3aXRoIGFcbiAgICAgICAgICogcGxheXNwZWVkIG9mIDAgKGkuZS4gdGhlIGZlZWQgaXMgcGF1c2VkKS4gIFdpdGggdGhlIHN0ZXAgZnVuY3Rpb24sIG5vIGltYWdlIHdpbGwgYmUgZ3JhYmJlZCwgYnV0IHRoZVxuICAgICAgICAgKiBuZXh0IHRpbWUgeW91IHB1bGwgYW4gaW1hZ2UgZnJvbSB0aGlzIHNlYXJjaCwgaXQgd2lsbCBiZSBhdCB0aGUgbmV3IGxvY2F0aW9uIGluIHRoZSB0aW1lbGluZS4gIFRoZSBzdGVwXG4gICAgICAgICAqIHNpemUgY2FuIGJlIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIGFuZCByZWZlcnMgdG8gdGhlIG51bWJlciBvZiBmcmFtZXMgZWl0aGVyIGZvcndhcmQgb3IgYmFja3dhcmQgZnJvbSB0aGVcbiAgICAgICAgICogY3VycmVudCBmcmFtZS4gSWYgbm8gc3RlcCBzaXplIGlzIHByb3ZpZGVkLCB0aGUgY3VycmVudCBmcmFtZSBvZiB0aGUgc2VhcmNoIHdpbGwgYmUgcmV0dXJuZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYSBOdW1iZXIgaW5kaWNhdGluZyB0aGUgY3VycmVudFxuICAgICAgICAgKiBwbGF5YmFjayBmcmFtZS5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSBbc3RlcFNpemVdIFRoZSBmcmFtZSB0byBzdGVwIHRvIG9yIHRoZSBvZmZzZXQgYW1vdW50IHRvIHN0ZXAgKGUuZy4gJys1JyBpcyBzdGVwIDVcbiAgICAgICAgICogZnJhbWVzIGZvcndhcmQpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGVwID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzdGVwU2l6ZSkge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV3RnJhbWU7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBsZWdhY3kgcmVzcG9uc2VzXG4gICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lID0gcGFyc2VJbnQoZGF0YSwgMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUgPSBwYXJzZUludChkYXRhLmZyYW1lLCAxMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgbmV3RnJhbWUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zdGVwICsgJy8nLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoX2lkOiB0aGlzLnNlYXJjaElkLFxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZih0eXBlb2Ygc3RlcFNpemUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MudXJsICs9IHN0ZXBTaXplLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGdldFRpbWUgZnVuY3Rpb24gaGFuZGxlcyByZXRyaWV2aW5nIHRoZSBjdXJyZW50IGRhdGUvdGltZSBmcm9tIGEgY2FtZXJhIGZlZWQgYXR0YWNoZWQgdG8gYSBzZWFyY2guXG4gICAgICAgICAqIEl0IHF1ZXJpZXMgdGhlIHNlcnZlciBhbmQgcGFyc2VzIHRoZSByZXR1cm5lZCBzdHJpbmcgdG8gYSBwcm9wZXIgamF2YXNjcmlwdCBkYXRlL3RpbWUgb2JqZWN0LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhIERhdGUgb2JqZWN0IG9mIHRoZSBjdXJyZW50XG4gICAgICAgICAqICB0aW1lIG9mIHRoZSBzZWFyY2guXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFRpbWUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBvblNlYXJjaFRpbWVFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TZWFyY2hUaW1lU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocikge1xuICAgICAgICAgICAgICAgIHZhciBzZWFyY2hUaW1lO1xuICAgICAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFRpbWUgPSBkYXRhLnRpbWVXaXRoTXMgfHwgZGF0YS50aW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaChlKXtcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoVGltZSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHhEdXJhdGlvblRleHQgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ1gtRHVyYXRpb24nKTtcbiAgICAgICAgICAgICAgICB2YXIgeFNlcnZlclRleHQgPSB4aHIuZ2V0UmVzcG9uc2VIZWFkZXIoJ1gtU2VydmVyLVRpbWUnKTtcbiAgICAgICAgICAgICAgICB2YXIgeER1cmF0aW9uID0geER1cmF0aW9uVGV4dCAhPT0gbnVsbCA/IHBhcnNlSW50KHhEdXJhdGlvblRleHQsIDEwKSA6IDA7XG4gICAgICAgICAgICAgICAgdmFyIHNlcnZlclRpbWVEaWZmZXJlbmNlID0geFNlcnZlclRleHQgIT09IG51bGwgPyBNYXRoLmFicyhEYXRlLm5vdygpIC0gRGF0ZS5wYXJzZSh4U2VydmVyVGV4dCkpIDogMDtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRpbWUgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUoc2VhcmNoVGltZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGN1cnJlbnRUaW1lLCB4RHVyYXRpb24sIHNlcnZlclRpbWVEaWZmZXJlbmNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblNlYXJjaFRpbWVTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvblNlYXJjaFRpbWVFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy50aW1lLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzZWFyY2hfaWQ6IHRoaXMuc2VhcmNoSWQsXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dDogJ2pzb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2dzIG91dCB0aGUgY3VycmVudCBzZWFyY2guICBUaGlzIGRlc3Ryb3lzIGFsbCByZXNvdXJjZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZWFyY2ggYW5kIHNob3VsZCBiZSBjYWxsZWRcbiAgICAgICAgICogZm9yIGVhY2ggc2VhcmNoIGFzIHRoZSBzZWFyY2ggaXMgZmluaXNoZWQuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXMuc2VydmVyO1xuICAgICAgICAgICAgdmFyIG9uTG9nb3V0U2VydmVyRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25Mb2dvdXRTZXJ2ZXJTdWNjZXNzID0gZnVuY3Rpb24oLypkYXRhLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkxvZ291dFNlcnZlclN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uTG9nb3V0U2VydmVyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxvZ291dCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VhcmNoSWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3RpZmllcyB0aGUgc2VydmljZSB0aGF0IGEgcHJvY2VzcyBpcyBzdGlsbCBpbiB1c2UuICBUaGlzIHByZXZlbnRzIGFuIGluYWN0aXZlIHNlYXJjaCBmcm9tIGJlaW5nIGNsb3NlZC5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5vdGlmeVVzZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlYXJjaFNlcnZlciA9IG5ldyBFVldFQjIuU2VydmVyKHRoaXMuc2VydmVyLnNlcnZpY2UsICcnLCB0aGlzLnNlcnZlci5pZCwgdHJ1ZSwgZmFsc2UsIHRoaXMuc2VhcmNoSWQpO1xuICAgICAgICAgICAgc2VhcmNoU2VydmVyLm5vdGlmeVVzZShjYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgc3RhdHVzIG9mIHRoZSBzZWFyY2guXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGEge0BsaW5rIEVWV0VCMi5TZWFyY2hTdGF0dXN9XG4gICAgICAgICAqICBvYmplY3QgZGV0YWlsaW5nIHRoZSBzdGF0dXMgb2YgdGhlIHNlYXJjaC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3RhdHVzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IG5ldyBFVldFQjIuU2VhcmNoU3RhdHVzKGRhdGEuc3RhdHVzLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0dXMuZnJhbWVzLnJldHJpZXZlZCwgZGF0YS5zdGF0dXMuZnJhbWVzLnRvdGFsKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHN0YXR1cyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlYXJjaFN0YXR1cyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VhcmNoSWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyBhIHN0cmVhbSBJRCBmb3IgYSB2aWRlby53ZWIgb3IgcHVsbC53ZWIgcmVxdWVzdCBiYXNlZCBvZmYgb2YgdGhlIHByb3ZpZGVkIElELlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyZWFtSWQgVGhlIHN0cmVhbSBJRCB0byBwcm9jZXNzLlxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IEEgc3RyZWFtIElEXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgZ2VuZXJhdGVTdHJlYW1JZCA9IGZ1bmN0aW9uKHN0cmVhbUlkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHN0cmVhbUlkID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkID0gRVZXRUIyLnV0aWwuZ2VuZXJhdGVTdHJlYW1JZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHJlYW1JZCA9IEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbUlkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIGEgZnJhbWUgZnJvbSB0aGUgc2VhcmNoZWQgY2FtZXJhIGF0IHRoZSBzcGVjaWZpZWQgdGltZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhfSBjYW1lcmEgVGhlIGNhbWVyYSBmb3IgdGhlIGZyYW1lLlxuICAgICAgICAgKiBAcGFyYW0ge0RhdGV9IHRpbWUgVGhlIHRpbWUgb2YgdGhlIGZyYW1lLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSBpbWFnZSBpbiBwaXhlbHNcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBpbWFnZSBpbiBwaXhlbHNcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHF1YWxpdHkgUXVhbGl0eSBiZXR3ZWVuIDEgYW5kIDEwIHdpdGggdGhlIGxldmVsIG9mIHF1YWxpdHkgb2YgdGhlIGltYWdlICgxIGxvd2VzdCwgMTBcbiAgICAgICAgICogaGlnaGVzdClcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtzdHJlYW1JZF0gVGhlIHVuaXF1ZSBzdHJlYW0gSUQgZm9yIHRoZSBmZWVkXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIFVSTCB0byByZXF1ZXN0IHRoZSBkZXNpcmVkIGZyYW1lIGZyb20gdGhpcyBzZWFyY2guXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24oY2FtZXJhLCB0aW1lLCB3aWR0aCwgaGVpZ2h0LCBxdWFsaXR5LCBzdHJlYW1JZCkge1xuICAgICAgICAgICAgaWYoIWNhbWVyYS5zdXBwb3J0c0dldEZyYW1lKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VhcmNoVmlkZW87XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gW1xuICAgICAgICAgICAgICAgICdzPScgKyB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgJ3NlYXJjaF9pZD0nICsgdGhpcy5zZWFyY2hJZCxcbiAgICAgICAgICAgICAgICAnY2FtZXJhPScgKyBjYW1lcmEuaWQsXG4gICAgICAgICAgICAgICAgJ3RpbWU9JyArIEVWV0VCMi51dGlsLkRhdGUySUVURih0aW1lLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAnc3RyZWFtPScgKyBnZW5lcmF0ZVN0cmVhbUlkKHN0cmVhbUlkKVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgdmFyIHVzZU5hdGl2ZUpwZWcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBmb3J3YXJkaW5nU2V0dGluZ3MgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLmpwZWdGb3J3YXJkaW5nO1xuICAgICAgICAgICAgaWYoZm9yd2FyZGluZ1NldHRpbmdzLmVuYWJsZWQgJiYgJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWcsIGNhbWVyYS5mb3JtYXRzKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB1c2VOYXRpdmVKcGVnID0gY2FtZXJhLnF1YWxpdHkgKiAoZm9yd2FyZGluZ1NldHRpbmdzLnF1YWxpdHlUaHJlc2hvbGQvMTAwKSA8IHF1YWxpdHkgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhbWVyYS5yZXNvbHV0aW9uLndpZHRoICogKGZvcndhcmRpbmdTZXR0aW5ncy5zaXplVGhyZXNob2xkLzEwMCkgPCB3aWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVzb2x1dGlvbi5oZWlnaHQgKiAoZm9yd2FyZGluZ1NldHRpbmdzLnNpemVUaHJlc2hvbGQvMTAwKSA8IGhlaWdodCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBmb3JtYXQgPSBFVldFQjIuY2FtZXJhRm9ybWF0cy50cmFuc2NvZGVkSnBlZztcbiAgICAgICAgICAgIGlmKHVzZU5hdGl2ZUpwZWcgfHwgJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnLCBjYW1lcmEuZm9ybWF0cykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGZvcm1hdCAhPT0gRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCd3PScrd2lkdGgpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdoPScraGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgncT0nK3F1YWxpdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2Zvcm1hdD0nK2Zvcm1hdCk7XG5cbiAgICAgICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignOycpICsgJzsnO1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB1cmwgKz0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBnZXRTZWFyY2ggZnVuY3Rpb24gbWFrZXMgdGhlIGluaXRpYWxpemluZyBjYWxsIGZvciBhIHNlYXJjaCBvbiBhIHNlcmllcyBvZiB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gaW5zdGFuY2VzXG4gICAgICogb24gYSBnaXZlbiBwZXJpb2QuICBJdCByZXF1ZXN0cyB0aGUgcGVyaW9kIGZlZWQgZm9yIHRoZSBnaXZlbiB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gaW5zdGFuY2VzIGFuZFxuICAgICAqIHJldHJpZXZlcyB0aGUgaW5mb3JtYXRpb24gdG8gbGF0ZXIgbWFuaXB1bGF0ZSB0aGUgc2VhcmNoLiAgVGhlIGltYWdlIGZlZWQgdmFsdWVzIGFyZSB0aW1lZCBvbiB0aGUgd2ViIHNlcnZlclxuICAgICAqIGFuZCB3aWxsIHBhc3MgaW4gcmVhbCB0aW1lIHdpdGhvdXQgcmVxdWlyaW5nIGFueSB0aW1lIGRldGVjdGlvbiBvbiB0aGUgZnJvbnQtZW5kLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYSB7QGxpbmsgRVZXRUIyLlNlYXJjaH0gaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhW118RVZXRUIyLkF1ZGlvRGV2aWNlW118RVZXRUIyLlNlcmlhbERldmljZX0gaW5wdXRzIEFycmF5IG9mIHtAbGluayBFVldFQjIuQ2FtZXJhfSxcbiAgICAgKiB7QGxpbmsgRVZXRUIyLkF1ZGlvRGV2aWNlfSwgYW5kIHtAbGluayBFVldFQjIuU2VyaWFsRGV2aWNlfSBvYmplY3RzIHRoYXQgYXJlIHRoZSB0YXJnZXRzIGZvciB0aGUgc2VhcmNoXG4gICAgICogIHJlcXVlc3RlZC5cbiAgICAgKiBAcGFyYW0ge0RhdGV8TnVtYmVyfFN0cmluZ30gc3RhcnQgRGF0ZSBvYmplY3Qgb3IgaW50ZWdlci9zdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHNpbmNlXG4gICAgICogZXBvY2gsIHRoaXMgaXMgdG8gYmUgdGhlIGJlZ2lubmluZyBvZiB0aGUgcmVxdWVzdGVkIHBlcmlvZC5cbiAgICAgKiBAcGFyYW0ge0RhdGV8TnVtYmVyfFN0cmluZ30gZW5kIERhdGUgb2JqZWN0IG9yIGludGVnZXIvc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZVxuICAgICAqIGVwb2NoLCB0aGlzIGlzIHRvIGJlIHRoZSBlbmQgb2YgdGhlIHJlcXVlc3RlZCBwZXJpb2QuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc3RhcnRQYXVzZWQ9ZmFsc2VdIFdoZXRoZXIgdGhlIHNlYXJjaCBzaG91bGQgc3RhcnQgcGF1c2VkIG9yIG5vdC5cbiAgICAgKiBAY2F0ZWdvcnkgU2VhcmNoXG4gICAgICovXG4gICAgRVZXRUIyLmdldFNlYXJjaCA9IGZ1bmN0aW9uIChjYWxsYmFjaywgaW5wdXRzLCBzdGFydCwgZW5kLCBzdGFydFBhdXNlZCkge1xuICAgICAgICAvL0ZvcndhcmQtZGVjbGFyaW5nIG9uU2VhcmNoU3VjY2VzcyBkdWUgdG8gY2lyY3VsYXIgcmVmZXJlbmNlcy5cbiAgICAgICAgdmFyIG9uU2VhcmNoU3VjY2VzcztcblxuICAgICAgICB2YXIgb25TZWFyY2hFcnJvciA9IGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cy8qLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICBpZigoeGhyLnN0YXR1cyA9PT0gMjAwKSAmJiAodGV4dFN0YXR1cyA9PT0gJ3BhcnNlcmVycm9yJykpe1xuICAgICAgICAgICAgICAgIG9uU2VhcmNoU3VjY2Vzcyh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgIGlmKHhoci5zdGF0dXMgPT09IDQwOCkge1xuICAgICAgICAgICAgICAgIGVycm9yUmVzcG9uc2UuZXJyb3JUZXh0ID0gJ0EgdGltZW91dCBoYXMgb2NjdXJyZWQgcmVxdWVzdGluZyB0aGUgc2VhcmNoLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICBvblNlYXJjaFN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpIHtcbiAgICAgICAgICAgIGlmKGRhdGEgPT09IEVWV0VCMi5lcnJvcnMuc2VhcmNoKSB7XG4gICAgICAgICAgICAgICAgb25TZWFyY2hFcnJvcih4aHIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZih0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSByZWNlaXZlZCBhIHN0cmluZyByYXRoZXIgdGhhbiBqc29uXG4gICAgICAgICAgICAgICAgLy8gYnVpbGQgYSBqc29uIG9iamVjdFxuICAgICAgICAgICAgICAgIHZhciBkYXRhU3RyaW5nID0gZGF0YTtcbiAgICAgICAgICAgICAgICBkYXRhID0ge307XG5cbiAgICAgICAgICAgICAgICB2YXIgZGF0YVN0cmluZ0FycmF5ID0gZGF0YVN0cmluZy5zcGxpdCgnJicpO1xuICAgICAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgICAgIGZvcihpPTA7IGk8ZGF0YVN0cmluZ0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aGlzS2V5VmFsdWVBcnJheSA9IGRhdGFTdHJpbmdBcnJheVtpXS5zcGxpdCgnPScpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXNLZXlWYWx1ZUFycmF5Lmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpc0tleVZhbHVlQXJyYXlbMF0gPT09ICdmcmFtZXMnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5mcmFtZXMgPSBwYXJzZUludCh0aGlzS2V5VmFsdWVBcnJheVsxXSwgMTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXNLZXlWYWx1ZUFycmF5WzBdID09PSAnc3RhcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGFydF90aW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHRoaXNLZXlWYWx1ZUFycmF5WzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzS2V5VmFsdWVBcnJheVswXSA9PT0gJ2VuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLmVuZF90aW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHRoaXNLZXlWYWx1ZUFycmF5WzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzS2V5VmFsdWVBcnJheVswXSA9PT0gJ3NlYXJjaF9pZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLnNlYXJjaF9pZCA9IHRoaXNLZXlWYWx1ZUFycmF5WzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHN0YXJ0RGF0ZTtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhLnN0YXJ0X3RpbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgc3RhcnREYXRlID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGRhdGEuc3RhcnRfdGltZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZW5kRGF0ZTtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhLmVuZF90aW1lICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGVuZERhdGUgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUoZGF0YS5lbmRfdGltZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGF1ZGlvIGNsaXAgaW5mb3JtYXRpb24gKGlmIHByZXNlbnQpXG4gICAgICAgICAgICB2YXIgYXVkaW9JbmZvTGlzdDtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhLmF1ZGlvSW5mbyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBhdWRpb0luZm9MaXN0ID0gJC5tYXAoZGF0YS5hdWRpb0luZm8sIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBlYWNoIG9mIHRoZSBjbGlwc1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXVkaW9DbGlwcyA9ICQubWFwKGVsZW1lbnQuYXVkaW9DbGlwcywgZnVuY3Rpb24oY2xpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNsaXBTdGFydCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShjbGlwLnN0YXJ0VGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xpcEVuZCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShjbGlwLmVuZFRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VhcmNoQXVkaW9DbGlwSW5mbyhjbGlwU3RhcnQsIGNsaXBFbmQsIGNsaXAuZm9ybWF0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXAuZnJlcXVlbmN5LCBjbGlwLmZyYW1lcywgY2xpcC5zYW1wbGVzUGVyRnJhbWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgYXNzb2NpYXRlZCBpbnB1dC5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGF1ZGlvSW5wdXQgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihkZXZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXZpY2UuaWQgPT09IGVsZW1lbnQuZGV2aWNlSWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlYXJjaEF1ZGlvSW5mbyhhdWRpb0lucHV0LCBhdWRpb0NsaXBzLCBlbGVtZW50LmZyYW1lcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBmcmFtZUluZm8gPSBkYXRhLmZyYW1lcztcbiAgICAgICAgICAgIGlmKGRhdGEuZnJhbWVDb3VudHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZyYW1lSW5mbyA9IG5ldyBFVldFQjIuU2VhcmNoRnJhbWVDb3VudHMoZGF0YS5mcmFtZUNvdW50cy52aWRlbywgZGF0YS5mcmFtZUNvdW50cy5hdWRpbyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB2aWRlb0luZm87XG4gICAgICAgICAgICBpZiAoZGF0YS52aWRlb0luZm8pIHtcbiAgICAgICAgICAgICAgICB2aWRlb0luZm8gPSAkLm1hcChkYXRhLnZpZGVvSW5mbywgZnVuY3Rpb24oaW5mbykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2VzID0gJC5tYXAoaW5mby5jbGlwcywgZnVuY3Rpb24oY2xpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VhcmNoVmlkZW9DbGlwSW5mbyhFVldFQjIudXRpbC5JRVRGMkRhdGUoY2xpcC5zdGFydFRpbWUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLklFVEYyRGF0ZShjbGlwLmVuZFRpbWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYW1lcmEgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihpbnB1dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0LmlkLnRvU3RyaW5nKCkgPT09IGluZm8uZGV2aWNlSWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZWFyY2hWaWRlb0luZm8oY2FtZXJhLCByYW5nZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2VhcmNoID0gbmV3IEVWV0VCMi5TZWFyY2goZGF0YS5zZWFyY2hfaWQsIGlucHV0cywgc3RhcnREYXRlLCBlbmREYXRlLCBmcmFtZUluZm8sIGF1ZGlvSW5mb0xpc3QsXG4gICAgICAgICAgICAgICAgdmlkZW9JbmZvKTtcblxuICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHNlYXJjaCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYodHlwZW9mIHN0YXJ0UGF1c2VkID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgc3RhcnRQYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGlucHV0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vIHNlYXJjaCBpbnB1dHMgcHJvdmlkZWQuJyk7XG4gICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHRoZSBkaWZmZXJlbnQgaW5wdXQgbGlzdHNcbiAgICAgICAgdmFyIGNhbWVyYXMgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5DYW1lcmE7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgYXVkaW9JbnB1dHMgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5BdWRpb0RldmljZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBzZXJpYWxJbnB1dHMgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudCBpbnN0YW5jZW9mIEVWV0VCMi5TZXJpYWxEZXZpY2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBzZXJ2ZXIgPSBpbnB1dHNbMF0uc2VydmVyO1xuICAgICAgICB2YXIgdXJsID0gc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZWFyY2ggKyAnP3M9JyArIHNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IoaT0wOyBpPGNhbWVyYXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYW1lcmFzW2ldLmlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHVybCArPSAnJmNhbWVyYT0nKyBjYW1lcmFzW2ldLmlkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvcihpPTA7IGk8YXVkaW9JbnB1dHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBhdWRpb0lucHV0c1tpXS5pZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB1cmwgKz0gJyZhdWRpbz0nKyBhdWRpb0lucHV0c1tpXS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IoaT0wOyBpPHNlcmlhbElucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYodHlwZW9mIHNlcmlhbElucHV0c1tpXS5pZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB1cmwgKz0gJyZzZXJpYWw9Jysgc2VyaWFsSW5wdXRzW2ldLmlkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdXJsICs9ICcmc3RhcnQ9JytFVldFQjIudXRpbC5EYXRlMklFVEYoc3RhcnQpICsgXCImZW5kPVwiICsgRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKGVuZCkgKyAnJm91dHB1dD1qc29uJztcblxuICAgICAgICBpZihzdGFydFBhdXNlZCkge1xuICAgICAgICAgICAgdXJsICs9ICcmc3RhcnRfcGF1c2VkPTEnO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlcnZlci5yZXF1aXJlc1Jlc291cmNlS2V5KCkpIHtcbiAgICAgICAgICAgIGlmIChzZXJ2ZXIuc2VydmljZS5yZXNvdXJjZUtleSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDU1JGIGVuZm9yY2VkLCBwYXNzdGhyb3VnaCB3aWxsIG5vdCB3b3JrLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVybCArPSAnJmtleT0nK3NlcnZlci5zZXJ2aWNlLnJlc291cmNlS2V5O1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgc3VjY2Vzczogb25TZWFyY2hTdWNjZXNzLFxuICAgICAgICAgICAgZXJyb3I6IG9uU2VhcmNoRXJyb3IsXG4gICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgfTtcblxuICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBMYXlvdXQgc2xvdHMgcmVwcmVzZW50IHRoZSBwb3NpdGlvbmluZyBhbmQgc2l6aW5nIG9mIGEgZ2l2ZW4gY2FtZXJhIHBhbmVsIGluIGEgbGF5b3V0LlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbdG9wPTBdIFRoZSB0b3AgcG9zaXRpb24gb2YgdGhlIGxheW91dCBzbG90LCBpbiB0ZXJtcyBvZiB0aGUge0BsaW5rIEVWV0VCMi5MYXlvdXR9IGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbGVmdD0wXSBUaGUgbGVmdCBwb3NpdGlvbiBvZiB0aGUgbGF5b3V0IHNsb3QsIGluIHRlcm1zIG9mIHRoZSB7QGxpbmsgRVZXRUIyLkxheW91dH0gaW5zdGFuY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wXSBUaGUgd2lkdGggb2YgdGhlIGxheW91dCBzbG90LCBpbiB0ZXJtcyBvZiB0aGUge0BsaW5rIEVWV0VCMi5MYXlvdXR9IGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0PTBdIFRoZSBoZWlnaHQgb2YgdGhlIGxheW91dCBzbG90LCBpbiB0ZXJtcyBvZiB0aGUge0BsaW5rIEVWV0VCMi5MYXlvdXR9IGluc3RhbmNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBVdGlsXG4gICAgICovXG4gICAgRVZXRUIyLkxheW91dFNsb3QgPSBmdW5jdGlvbih0b3AsIGxlZnQsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvcCBsb2NhdGlvbiBvZiB0aGUgbGF5b3V0IHNsb3RcbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvcCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExlZnQgbG9jYXRpb24gb2YgdGhlIGxheW91dCBzbG90XG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sZWZ0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2lkdGggb2YgdGhlIGxheW91dCBzbG90XG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53aWR0aCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhlaWdodCBvZiB0aGUgbGF5b3V0IHNsb3RcbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhlaWdodCA9IDA7XG5cbiAgICAgICAgaWYodHlwZW9mIHRvcCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudG9wID0gdG9wO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBsZWZ0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygd2lkdGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGhlaWdodCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgbGF5b3V0IGlzIHRoZSBkZWZpbml0aW9uIG9mIGEgbGF5b3V0LS10aGUgdmlzdWFsIGxheW91dCBvZiBhIHNlcmllcyBvZiBjYW1lcmFzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfHVuZGVmaW5lZH0gW25hbWU9XCJVbm5hbWVkXCJdIFRoZSBuYW1lIG9mIHRoZSBsYXlvdXQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wXSBUaGUgd2lkdGggb2YgdGhlIGxheW91dC4gIGkuZS4gdGhlIG51bWJlciBvZiBjb2x1bW5zIHRoYXQgY29tcG9zZSB0aGUgbGF5b3V0LlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0PTBdIFRoZSBoZWlnaHQgb2YgdGhlIGxheW91dC4gIGkuZS4gdGhlIG51bWJlciBvZiByb3dzIHRoYXQgY29tcG9zZSB0aGUgbGF5b3V0LlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbGVuZ3RoPTBdIFRoZSBudW1iZXIgb2YgY2FtZXJhcyB0aGlzIGxheW91dCBzdXBwb3J0cy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5MYXlvdXRTbG90W119IFtzbG90cz1bXV0gVGhlIHNsb3QgZGVmaW5pdGlvbnMgZm9yIGVhY2ggY2FtZXJhIHNsb3QgaW4gdGhlIGxheW91dC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2FzcGVjdFJhdGlvPTQvM10gVGhlIGFzcGVjdCByYXRpbyBvZiB0aGUgbGF5b3V0LlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3dzPWZhbHNlXSBCb29sZWFuIGZsYWcgYXMgdG8gd2hldGhlciB0aGUgbGF5b3V0IGlzIHdpZGVzY3JlZW4uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFV0aWxcbiAgICAgKi9cbiAgICBFVldFQjIuTGF5b3V0ID0gZnVuY3Rpb24obmFtZSwgd2lkdGgsIGhlaWdodCwgbGVuZ3RoLCBzbG90cywgYXNwZWN0UmF0aW8sIHdzKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOYW1lIG9mIHRoZSBsYXlvdXRcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBcIlVubmFtZWRcIjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2lkdGggb2YgdGhlIGxheW91dFxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud2lkdGggPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIZWlnaHQgb2YgdGhlIGxheW91dFxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTnVtYmVyIG9mIHBhbmVscyBpbiB0aGUgbGF5b3V0XG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sZW5ndGggPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcnJheSBvZiBzbG90cyBpbiB0aGUgbGF5b3V0XG4gICAgICAgICAqIEB0eXBlIEFycmF5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNsb3RzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICogQXNwZWN0IHJhdGlvIG9mIHRoZSBsYXlvdXRcbiAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hc3BlY3RSYXRpbyA9IDQvMztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBsYXlvdXQgaXMgd2lkZXNjcmVlbiBvciBub3RcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53cyA9IGZhbHNlO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB3aWR0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaGVpZ2h0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGxlbmd0aCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzbG90cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2xvdHMgPSBzbG90cztcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgYXNwZWN0UmF0aW8gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmFzcGVjdFJhdGlvID0gYXNwZWN0UmF0aW87XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHdzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy53cyA9IHdzO1xuICAgICAgICB9XG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSBmb3JtYXRzIHN1cHBvcnRlZCBmb3IgcmVjZWl2aW5nIGF1ZGlvIGlucHV0LlxuICAgICAqIEBlbnVtIHtzdHJpbmd9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IEF1ZGlvXG4gICAgICovXG4gICAgRVZXRUIyLmF1ZGlvSW5wdXRTdHJlYW1Gb3JtYXRUeXBlcyA9IHtcbi8vICAgICAgICBtcDM6ICdtcDMnLFxuLy8gICAgICAgIG9nZzogJ29nZycsXG4vLyAgICAgICAgb3B1czogJ29wdXMnLFxuICAgICAgICAvKipcbiAgICAgICAgICogVW5jb21wcmVzc2VkIDE2LWJpdCBQQ00gYXQgdGhlIGZyYW1lIHJhdGUgb2YgdGhlIGRldmljZVxuICAgICAgICAgKi9cbiAgICAgICAgcmF3OiAncmF3JyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYXRpdmUgZm9ybWF0IG9mIHRoZSBhdWRpbyBpbnB1dFxuICAgICAgICAgKi9cbiAgICAgICAgJ25hdGl2ZSc6ICduYXRpdmUnICAvL25hdGl2ZSBpcyBhIHJlc2VydmVkIGtleXdvcmQgaW4gSmF2YVNjcmlwdDogaXQgbXVzdCBiZSBxdW90ZWQgYXMgYSBwcm9wZXJ0eSBuYW1lLlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIGZvcm1hdHMgc3VwcG9ydGVkIGZvciBzZW5kaW5nIGF1ZGlvIG91dHB1dC4gIE5vdGU6IFJBVyBpcyBkZWZpbmVkIGFzIHVuY29tcHJlc3NlZCAxNmJpdCBhdFxuICAgICAqIHRoZSBmcmFtZSByYXRlIG9mIHRoZSBkZXZpY2UuXG4gICAgICogQGVudW0ge3N0cmluZ31cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXVkaW9cbiAgICAgKi9cbiAgICBFVldFQjIuYXVkaW9PdXRwdXRTdHJlYW1Gb3JtYXRUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuY29tcHJlc3NlZCAxNi1iaXQgUENNIGF0IHRoZSBmcmFtZSByYXRlIG9mIHRoZSBkZXZpY2VcbiAgICAgICAgICovXG4gICAgICAgIHJhdzogJ3JhdycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmF0aXZlIGZvcm1hdCBvZiB0aGUgYXVkaW8gb3V0cHV0XG4gICAgICAgICAqL1xuICAgICAgICAnbmF0aXZlJzogJ25hdGl2ZScgIC8vbmF0aXZlIGlzIGEgcmVzZXJ2ZWQga2V5d29yZCBpbiBKYXZhU2NyaXB0OiBpdCBtdXN0IGJlIHF1b3RlZCBhcyBhIHByb3BlcnR5IG5hbWUuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgbmF0aXZlIGZvcm1hdHMgYXZhaWxhYmxlIHRvIGF1ZGlvIGRldmljZXMuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXVkaW9cbiAgICAgKi9cbiAgICBFVldFQjIuYXVkaW9EZXZpY2VOYXRpdmVGb3JtYXRUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogUENNIChnLjcxMSBtdS1sYXcgZW5jb2RlZCBhdCB0aGUgZnJhbWUgcmF0ZSBvZiB0aGUgZGV2aWNlKVxuICAgICAgICAgKi9cbiAgICAgICAgcGNtOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQURQQ01cbiAgICAgICAgICovXG4gICAgICAgIGFkcGNtOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTVAyXG4gICAgICAgICAqL1xuICAgICAgICBtcDI6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNUDNcbiAgICAgICAgICovXG4gICAgICAgIG1wMzogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFBQ1xuICAgICAgICAgKi9cbiAgICAgICAgYWFjOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogZzcyNlxuICAgICAgICAgKi9cbiAgICAgICAgZzcyNjogNVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgQXVkaW9EZXZpY2Ugb2JqZWN0IGFjdHMgYXMgYSBsYXJnZSBjb250YWluZXIgZm9yIGFsbCB0aGUgYXVkaW8gZGV2aWNlIG9wZXJhdGlvbnMgYW5kIGluZm9ybWF0aW9uLlxuICAgICAqIEl0IGlzIGluaXRpYWxseSBwb3B1bGF0ZWQgZnJvbSB0aGUgaW5mb3JtYXRpb24gcmV0cmlldmVkIGluIHRoZSB7QGxpbmsgRVZXRUIyLlNlcnZlci5nZXRBdWRpb0RldmljZXN9XG4gICAgICogZnVuY3Rpb24gYW5kIGhvbGRzIHRoZSB1bmlxdWUgaW5mb3JtYXRpb24gZm9yIGFuIGluZGl2aWR1YWwgYXVkaW8gc3RyZWFtIG9uIGFuIGV4YWNxVmlzaW9uIHNlcnZlci4gIFRoZVxuICAgICAqIGluZm9ybWF0aW9uIGNhbiBiZSB1c2VkIHRvIHRoZW4gcGxheWJhY2sgYXVkaW8gb24gdGhlIHN0cmVhbS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IFtzZXJ2ZXI9bnVsbF0gU2VydmVyIGluc3RhbmNlIHRoaXMgYXVkaW8gc3RyZWFtIGlzIGFzc29jaWF0ZWQgd2l0aC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkPScnXSBJRCBvZiB0aGUgYXVkaW8gc3RyZWFtIGFjY29yZGluZyB0byB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPSdVbmRlZmluZWQnXSBOYW1lIG9mIHRoaXMgYXVkaW8gc3RyZWFtLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2VuYWJsZWQ9ZmFsc2VdIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgYXVkaW8gZGV2aWNlIGlzIGVuYWJsZWRcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzdXBwb3J0c0lucHV0PWZhbHNlXSBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIGF1ZGlvIGRldmljZSBzdXBwb3J0cyBpbnB1dC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzdXBwb3J0c091dHB1dD1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBhdWRpbyBkZXZpY2Ugc3VwcG9ydHMgb3V0cHV0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmF1ZGlvRGV2aWNlTmF0aXZlRm9ybWF0VHlwZXN9IFtuYXRpdmVGb3JtYXQ9RVZXRUIyLmF1ZGlvRGV2aWNlTmF0aXZlRm9ybWF0VHlwZXMubm9uZV0gVGhlIG5hdGl2ZVxuICAgICAqICAgZm9ybWF0IGZvciB0aGUgYXVkaW8gZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbZnJlcXVlbmN5PTBdIFRoZSBzYW1wbGVzIHBlciBzZWNvbmQgb2YgdGhlIHJldHVybmVkIGF1ZGlvLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBBdWRpb1xuICAgICAqL1xuICAgIEVWV0VCMi5BdWRpb0RldmljZSA9IGZ1bmN0aW9uIChzZXJ2ZXIsIGlkLCBuYW1lLCBlbmFibGVkLCBzdXBwb3J0c0lucHV0LCBzdXBwb3J0c091dHB1dCwgbmF0aXZlRm9ybWF0LCBmcmVxdWVuY3kpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuaXF1ZSBJRCBmb3IgdGhpcyBhdWRpbyBzdHJlYW1cbiAgICAgICAgICogQHR5cGUgc3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhpcyBhdWRpbyBzdHJlYW1cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW5kZWZpbmVkJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VydmVyIGluc3RhbmNlIHRoaXMgYXVkaW8gc3RyZWFtIGlzIGF0dGFjaGVkIHRvXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBhdWRpbyBkZXZpY2UgaXMgZW5hYmxlZFxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBhdWRpbyBkZXZpY2Ugc3VwcG9ydHMgaW5wdXQuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3VwcG9ydHNJbnB1dCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIGF1ZGlvIGRldmljZSBzdXBwb3J0cyBvdXRwdXQuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3VwcG9ydHNPdXRwdXQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hdGl2ZSBmb3JtYXQgZm9yIHRoZSBhdWRpbyBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5hdWRpb0RldmljZU5hdGl2ZUZvcm1hdFR5cGVzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hdGl2ZUZvcm1hdCA9IEVWV0VCMi5hdWRpb0RldmljZU5hdGl2ZUZvcm1hdFR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzYW1wbGVzIHBlciBzZWNvbmQgb2YgdGhlIHJldHVybmVkIGF1ZGlvLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZnJlcXVlbmN5ID0gMDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBlbmFibGVkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5lbmFibGVkID0gZW5hYmxlZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygc3VwcG9ydHNJbnB1dCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc3VwcG9ydHNJbnB1dCA9IHN1cHBvcnRzSW5wdXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHN1cHBvcnRzT3V0cHV0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zdXBwb3J0c091dHB1dCA9IHN1cHBvcnRzT3V0cHV0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBuYXRpdmVGb3JtYXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hdGl2ZUZvcm1hdCA9IG5hdGl2ZUZvcm1hdDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZnJlcXVlbmN5ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5mcmVxdWVuY3kgPSBmcmVxdWVuY3k7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF1ZGlvIGlucHV0IG9iamVjdCwgb25jZSBzZXQsIGhhcyBhbGwgdGhlIGluZm9ybWF0aW9uIG5lZWRlZCB0byByZXRyaWV2ZSBhdWRpbyBkYXRhIGZyb20gdGhlIHdlYlxuICAgICAgICAgKiBzZXJ2aWNlIGZvciBpdC4gU2luY2Ugc3RyZWFtaW5nIGF1ZGlvIGRhdGEgcmVxdWlyZXMgYSBzcGVjaWZpYyBVUkwsIGVhY2ggQXVkaW9JbnB1dCBpbnN0YW5jZSBjb250YWlucyBhXG4gICAgICAgICAqIG1ldGhvZCB0byBnZW5lcmF0ZSB0aGUgVVJMIGZvciByZXRyaWV2aW5nIHRoZSBhdWRpbyBzdHJlYW0uIElmIHRoZSBzZWFyY2ggSUQgcGFyYW1ldGVyIGlzIHNldCwgdGhlIHJldHVybmVkXG4gICAgICAgICAqIFVSTCB3aWxsIGJlIHB1bGxpbmcgZnJvbSBhbiBhbHJlYWR5IGluaXRpYWxpemVkIHNlYXJjaCBzZXNzaW9uLiBUaGlzIElEIHdpbGwgcG9pbnQgdG8gdGhlIHJlcXVlc3RlZCBoaXN0b3J5XG4gICAgICAgICAqIGF1ZGlvIHN0cmVhbSBmb3IgdGhlIGF1ZGlvIGlucHV0LlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5hdWRpb0lucHV0U3RyZWFtRm9ybWF0VHlwZXN9IHR5cGUgVGhlIHR5cGUgb2YgYXVkaW8gc3RyZWFtIHRvIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VhcmNoSWRdIFRoZSB1bmlxdWUgc2VhcmNoIElEIGZvciB0aGUgZmVlZC5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtzdGFydF0gKFNlYXJjaCBPbmx5KSBUaGUgc3RhcnRpbmcgZnJhbWUgdG8gcmV0cmlldmUuIElmIG5vdCBzcGVjaWZpZWQsIGFsbCBmcmFtZXMgZm9yIHRoZVxuICAgICAgICAgKiBzZWFyY2ggd2lsbCBiZSBzdHJlYW1lZC4gTm90ZTogVmlkZW8gYW5kIGF1ZGlvIGZyYW1lcyBhcmUgaW5kZXhlZCBzZXBhcmF0ZWx5LiBCZSBzdXJlIHRvIHJlZmVyZW5jZVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlYXJjaC5mcmFtZUluZm8uYXVkaW99IGZvciB0aGUgcHJvcGVyIGZyYW1lIGNvdW50cy5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtlbmRdIChTZWFyY2ggT25seSkgVGhlIGVuZGluZyBmcmFtZSB0byByZXRyaWV2ZS4gSWYgbm90IHNwZWNpZmllZCwgYWxsIGZyYW1lcyBmcm9tIHRoZSBzdGFydFxuICAgICAgICAgKiBmcmFtZSBvbndhcmQgd2lsbCBiZSBzdHJlYW1lZC4gTm90ZTogVmlkZW8gYW5kIGF1ZGlvIGZyYW1lcyBhcmUgaW5kZXhlZCBzZXBhcmF0ZWx5LiBCZSBzdXJlIHRvIHJlZmVyZW5jZVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlNlYXJjaC5mcmFtZUluZm8uYXVkaW99IGZvciB0aGUgcHJvcGVyIGZyYW1lIGNvdW50cy5cbiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgVVJMIHRvIHJlcXVlc3QgdGhlIGRlc2lyZWQgYXVkaW8gc3RyZWFtIGZvciB0aGlzIGF1ZGlvIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEF1ZGlvID0gZnVuY3Rpb24gKHR5cGUsIHNlYXJjaElkLCBzdGFydCwgZW5kKSB7XG4gICAgICAgICAgICBpZighdGhpcy5lbmFibGVkIHx8ICF0aGlzLnN1cHBvcnRzSW5wdXQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdWRpbyBkZXZpY2UgaXMgbm90IGVuYWJsZWQgb3IgZG9lcyBub3Qgc3VwcG9ydCBhdWRpbyBpbnB1dC5cIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYXVkaW87XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gW107XG5cbiAgICAgICAgICAgIGlmIChzZWFyY2hJZCAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdzPScgKyBzZWFyY2hJZCk7XG4gICAgICAgICAgICAgICAgaWYoc3RhcnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnc3RhcnRGcmFtZT0nICsgc3RhcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihlbmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnZW5kRnJhbWU9JyArIGVuZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3M9JyArIHRoaXMuc2VydmVyLnNlc3Npb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgnYT0nICsgdGhpcy5pZCk7XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgndHlwZT0nK3R5cGUpO1xuXG4gICAgICAgICAgICB1cmwgKz0gJz8nICsgcGFyYW1zLmpvaW4oJzsnKSArICc7JztcblxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdXJsICs9IGRhdGUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGdldEF1ZGlvT3V0cHV0IG1ldGhvZCByZXR1cm5zIGEgVVJMIHRvIHVzZSB0byBzZW5kIGF1ZGlvIGRhdGEgdG8gYSBkZXZpY2UuIFlvdSB3aWxsIG5lZWQgdG8gdXNlIHRoaXMgbWV0aG9kXG4gICAgICAgICAqIGFzIG9wcG9zZWQgdG8gRVZXRUIyLkF1ZGlvRGV2aWNlLnNlbmRBdWRpbyBpZiB5b3Ugd2lzaCB0byBoYXZlIGNvbnRyb2wgb3ZlciBhbnkgYXVkaW8gUE9TVCByZXF1ZXN0cy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuYXVkaW9PdXRwdXRTdHJlYW1Gb3JtYXRUeXBlc30gW3R5cGU9RVZXRUIyLmF1ZGlvT3V0cHV0U3RyZWFtRm9ybWF0VHlwZXMubmF0aXZlXSBUaGUgdHlwZSBvZlxuICAgICAgICAgKiBhdWRpbyBzdHJlYW0gdG8gc2VuZCwgaWYgRVZXRUIyLmF1ZGlvT3V0cHV0U3RyZWFtRm9ybWF0VHlwZXMucmF3IGlzIHVzZWQsIHRoZSBkYXRhIG11c3QgYmUgZ2l2ZW4gaW4gdGhlXG4gICAgICAgICAqIGZvcm0gb2Ygc2luZ2xlLWNoYW5uZWwsIHVuY29tcHJlc3NlZCAxNi1iaXQgUENNLlxuICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgVVJMIHRvIHVzZSB0byBzZW5kIGF1ZGlvIG9mIHRoZSBnaXZlbiB0eXBlIHRvIHRoZSBkZXZpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEF1ZGlvT3V0cHV0ID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHR5cGUgPSBFVldFQjIuYXVkaW9PdXRwdXRTdHJlYW1Gb3JtYXRUeXBlcy5uYXRpdmU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBbXG4gICAgICAgICAgICAgICAgJ3M9JyArIHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnYT0nICsgdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAndHlwZT0nICsgdHlwZVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYXVkaW8gKyAnPycgKyBwYXJhbXMuam9pbignJicpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VuZEF1ZGlvIG1ldGhvZCBzZW5kcyBhdWRpbyBkYXRhIHRvIHRoZSBhdWRpbyBkZXZpY2UgYXMgaXQgaXMgcmVjZWl2ZWQuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBUaGUgZnVuY3Rpb24gaXNcbiAgICAgICAgICogcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIHRoZSBhdWRpbyBkZXZpY2VcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5BdWRpb0RldmljZX0gaW5zdGFuY2UgaXQgYmVsb25ncyB0by5cbiAgICAgICAgICogQHBhcmFtIHtJbnQxNkFycmF5fEJsb2J9IGRhdGEgVGhlIGF1ZGlvIGRhdGEgdG8gc2VuZC5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuYXVkaW9PdXRwdXRTdHJlYW1Gb3JtYXRUeXBlc30gW3R5cGU9RVZXRUIyLmF1ZGlvT3V0cHV0U3RyZWFtRm9ybWF0VHlwZXMubmF0aXZlXSBUaGUgdHlwZSBvZlxuICAgICAgICAgKiBhdWRpbyBzdHJlYW0gdG8gc2VuZCwgaWYgRVZXRUIyLmF1ZGlvT3V0cHV0U3RyZWFtRm9ybWF0VHlwZXMucmF3IGlzIHVzZWQgdGhlIGRhdGEgbXVzdCBjb250YWluXG4gICAgICAgICAqIFJhdy11bmNvbXByZXNzZWQgMTYgYml0IHJhdGUgUENNIGRhdGEgd2l0aCAxIGNoYW5uZWwgb2YgYXVkaW8uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlbmRBdWRpbyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBkYXRhLCB0eXBlKSB7XG4gICAgICAgICAgICBpZighdGhpcy5lbmFibGVkIHx8ICF0aGlzLnN1cHBvcnRzT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXVkaW8gZGV2aWNlIGlzIG5vdCBlbmFibGVkIG9yIGRvZXMgbm90IHN1cHBvcnQgYXVkaW8gb3V0cHV0LlwiKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5hdWRpbztcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBbXG4gICAgICAgICAgICAgICAgJ3M9JyArIHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnYT0nICsgdGhpcy5pZFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3R5cGU9JyArIHR5cGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cmwgKz0gJz8nICsgcGFyYW1zLmpvaW4oJzsnKSArICc7JztcblxuICAgICAgICAgICAgdmFyIGF1ZGlvRGV2aWNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uU2VuZEF1ZGlvU3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UsIGF1ZGlvRGV2aWNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblNlbmRBdWRpb0Vycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSwgYXVkaW9EZXZpY2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU2VuZEF1ZGlvU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25TZW5kQXVkaW9FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHVybCxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIHBvc3NpYmxlIHZpZGVvIGV4cG9ydCBmb3JtYXRzIGF2YWlsYWJsZS5cbiAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWFyY2hcbiAgICAgKi9cbiAgICBFVldFQjIudmlkZW9FeHBvcnRGb3JtYXRUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBTXG4gICAgICAgICAqL1xuICAgICAgICBwczogJ3BzJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFWSVxuICAgICAgICAgKi9cbiAgICAgICAgYXZpOiAnYXZpJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVtYmVkZGVkIGVQbGF5ZXJcbiAgICAgICAgICovXG4gICAgICAgIGVwbGF5ZXI6ICdlcGxheWVyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFppcHBlZCBQU1xuICAgICAgICAgKi9cbiAgICAgICAgcHNaaXA6ICdwc196aXAnLFxuICAgICAgICAvKipcbiAgICAgICAgICogTVA0XG4gICAgICAgICAqL1xuICAgICAgICBtcDQ6ICdtcDQnLFxuICAgICAgICAvKipcbiAgICAgICAgICogUFNYXG4gICAgICAgICAqL1xuICAgICAgICBwc3g6ICdwc3gnLFxuICAgICAgICAvKipcbiAgICAgICAgICogTU9WXG4gICAgICAgICAqL1xuICAgICAgICBtb3Y6ICdtb3YnXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgcG9zc2libGUgdmlkZW8gZXhwb3J0IGZvcm1hdHMgYXZhaWxhYmxlLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIEVWV0VCMi52aWRlb0V4cG9ydFN0YXR1c1R5cGVzPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3Qgc3RhcnRlZFxuICAgICAgICAgKi9cbiAgICAgICAgbm90U3RhcnRlZDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBlbmRpbmdcbiAgICAgICAgICovXG4gICAgICAgIHBlbmRpbmc6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFeHBvcnRpbmdcbiAgICAgICAgICovXG4gICAgICAgIGV4cG9ydGluZzogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbXBsZXRlZFxuICAgICAgICAgKi9cbiAgICAgICAgY29tcGxldGVkOiAzXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBWaWRlb0V4cG9ydFN0YXR1cyBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgdGhlIGN1cnJlbnQgc3RhdHVzIG9mIGFcbiAgICAgKiB2aWRlbyBleHBvcnQuICBJdCBpcyBpbml0aWFsbHkgcG9wdWxhdGVkIGZyb20gdGhlIGluZm9ybWF0aW9uIHJldHJpZXZlZCBieVxuICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9FeHBvcnR9IGFuZCBob2xkcyB0aGUgY3VycmVudCBzdGF0dXMgYW5kLCBpZlxuICAgICAqIGFwcGxpY2FibGUsIHRoZSBkb3dubG9hZCBsaW5rIGZvciB0aGUgZXhwb3J0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlZpZGVvRXhwb3J0fSBbdmlkZW9FeHBvcnQ9bnVsbF0gVGhlIHZpZGVvIGV4cG9ydCBpbnN0YW5jZSB0aGlzXG4gICAgICogc3RhdHVzIGlzIGFzc29jaWF0ZWQgd2l0aFxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnZpZGVvRXhwb3J0U3RhdHVzVHlwZXN9IFtzdGF0dXM9RVZXRUIyLnZpZGVvRXhwb3J0U3RhdHVzVHlwZXMubm90U3RhcnRlZF1cbiAgICAgKiBUaGUgc3RhdHVzIG9mIHRoZSB2aWRlbyBleHBvcnQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtwZXJjZW50Q29tcGxldGU9MF0gVGhlIHBlcmNlbnQgb2YgZXhwb3J0IGNvbXBsZXRlZC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3RvdGFsU2l6ZT0wXSBUaGUgY3VycmVudCB0b3RhbCBmaWxlIHNpemUgb2YgdGhlIGV4cG9ydCwgaW4gYnl0ZXMuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIEVWV0VCMi5WaWRlb0V4cG9ydFN0YXR1cyA9IGZ1bmN0aW9uICh2aWRlb0V4cG9ydCwgc3RhdHVzLCBwZXJjZW50Q29tcGxldGUsIHRvdGFsU2l6ZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHZpZGVvIGV4cG9ydCBpbnN0YW5jZSB0aGlzIHN0YXR1cyBpcyBhc3NvY2lhdGVkIHdpdGhcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlZpZGVvRXhwb3J0XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZpZGVvRXhwb3J0ID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RhdHVzIG9mIHRoZSB2aWRlbyBleHBvcnRcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnZpZGVvRXhwb3J0U3RhdHVzVHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzID0gRVZXRUIyLnZpZGVvRXhwb3J0U3RhdHVzVHlwZXMubm90U3RhcnRlZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBlcmNlbnQgb2YgZXhwb3J0IGNvbXBsZXRlZC5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBlcmNlbnRDb21wbGV0ZSA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjdXJyZW50IHRvdGFsIGZpbGUgc2l6ZSBvZiB0aGUgZXhwb3J0LCBpbiBieXRlcy5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvdGFsU2l6ZSA9IDA7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgdmlkZW9FeHBvcnQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvRXhwb3J0ID0gdmlkZW9FeHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHN0YXR1cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBwZXJjZW50Q29tcGxldGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnBlcmNlbnRDb21wbGV0ZSA9IHBlcmNlbnRDb21wbGV0ZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdG90YWxTaXplICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy50b3RhbFNpemUgPSB0b3RhbFNpemU7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZGVvRXhwb3J0IG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhIHZpZGVvIGV4cG9ydC4gIEl0IGlzIGluaXRpYWxseVxuICAgICAqIHBvcHVsYXRlZCBmcm9tIHRoZSBpbmZvcm1hdGlvbiByZXRyaWV2ZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2ZXIudmlkZW9FeHBvcnR9IGFuZFxuICAgICAqIGhvbGRzIHRoZSBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRoZSBleHBvcnQsIGFzIHdlbGwgYXMgbWV0aG9kcyBmb3IgcmV0cmlldmluZ1xuICAgICAqIHRoZSBleHBvcnQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IFtzZXJ2ZXI9bnVsbF0ge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIHRoaXMgdmlkZW8gZXhwb3J0XG4gICAgICogaXMgYXNzb2NpYXRlZCB3aXRoLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIElEIG9mIHRoZSBleHBvcnQsIHJldHVybmVkIGJ5IHtAbGluayBFVldFQjIuU2VydmVyLnZpZGVvRXhwb3J0fS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5DYW1lcmFbXXxFVldFQjIuQXVkaW9EZXZpY2VbXXxFVldFQjIuU2VyaWFsRGV2aWNlfSBpbnB1dHMgVGhlIGlucHV0cyBhc3NvY2lhdGVkXG4gICAgICogIHdpdGggdGhlIGV4cG9ydC4gIENhbiBiZSBhIG1peGVkIGxpc3Qgb2Yge0BsaW5rIEVWV0VCMi5DYW1lcmF9LCB7QGxpbmsgRVZXRUIyLkF1ZGlvRGV2aWNlfSwgYW5kXG4gICAgICogIHtAbGluayBFVldFQjIuU2VyaWFsRGV2aWNlfSBpbnN0YW5jZXMuXG4gICAgICogQHBhcmFtIHtFVldFQjIudmlkZW9FeHBvcnRGb3JtYXRUeXBlc30gW2Zvcm1hdD1FVldFQjIudmlkZW9FeHBvcnRGb3JtYXRUeXBlcy5wc11cbiAgICAgKiBUaGUgZm9ybWF0IHR5cGUgb2YgdGhlIGV4cG9ydC5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtzdGFydD1udWxsXSBEYXRlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJlZ2lubmluZyBvZiB0aGUgZXhwb3J0XG4gICAgICogcGVyaW9kLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW2VuZD1udWxsXSBEYXRlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGVuZCBvZiB0aGUgZXhwb3J0IHBlcmlvZC5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge1N0cmluZ1tdfSBbZmlsZW5hbWVzPVtdXSBUaGUgZmlsZSBuYW1lcyBvZiB0aGUgZmlsZXMgZ2VuZXJhdGVkIGJ5IHRoZSBleHBvcnQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFNlYXJjaFxuICAgICAqL1xuICAgIEVWV0VCMi5WaWRlb0V4cG9ydCA9IGZ1bmN0aW9uIChzZXJ2ZXIsIGlkLCBpbnB1dHMsIGZvcm1hdCwgc3RhcnQsIGVuZCwgZmlsZW5hbWVzKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJ2ZXIgaW5zdGFuY2UgdGhpcyBleHBvcnQgc3RhdHVzIGlzIGFzc29jaWF0ZWQgd2l0aFxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVuaXF1ZSBJRCBmb3IgdGhlIGV4cG9ydFxuICAgICAgICAgKiBAdHlwZSBzdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSBmZWVkcyBhc3NvY2lhdGVkIHdpdGggdGhlIGV4cG9ydC4gIFRoZSBwcm9wZXJ0eSBpcyBkZXByZWNhdGVkLCB1c2UgdGhlXG4gICAgICAgICAqIHVwZGF0ZWQge0BsaW5rIEVWV0VCMi5WaWRlb0V4cG9ydC5pbnB1dHN9IHByb3BlcnR5IGluc3RlYWQuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5DYW1lcmFbXVxuICAgICAgICAgKiBAZGVwcmVjYXRlZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmFzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpbnB1dHMgYXNzb2NpYXRlZCB3aXRoIHRoZSBleHBvcnQuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5DYW1lcmFbXXxFVldFQjIuQXVkaW9EZXZpY2VbXXxFVldFQjIuU2VyaWFsRGV2aWNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlucHV0cyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9ybWF0IHR5cGUgb2YgdGhlIGV4cG9ydC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnZpZGVvRXhwb3J0Rm9ybWF0VHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZm9ybWF0ID0gRVZXRUIyLnZpZGVvRXhwb3J0Rm9ybWF0VHlwZXMucHM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERhdGUgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBleHBvcnQgcGVyaW9kLlxuICAgICAgICAgKiBAdHlwZSBEYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXJ0ID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGF0ZSBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBlbmQgb2YgdGhlIGV4cG9ydCBwZXJpb2QuXG4gICAgICAgICAqIEB0eXBlIERhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5kID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZpbGUgbmFtZXMgb2YgdGhlIGZpbGVzIGdlbmVyYXRlZCBieSB0aGUgZXhwb3J0LlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdbXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5maWxlbmFtZXMgPSBbXTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGlucHV0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuXG4gICAgICAgICAgICB0aGlzLmNhbWVyYXMgPSAkLmdyZXAoaW5wdXRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQgaW5zdGFuY2VvZiBFVldFQjIuQ2FtZXJhO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGZvcm1hdCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzdGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZW5kICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5lbmQgPSBlbmQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGZpbGVuYW1lcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZW5hbWVzID0gZmlsZW5hbWVzO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgc3RhdHVzIG9mIHRoZSBleHBvcnQuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLlxuICAgICAgICAgKiBDYWxsYmFjayBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvRXhwb3J0U3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3RhdHVzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgdmlkZW9FeHBvcnQgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uR2V0U3RhdHVzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRTdGF0dXNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICBvbkdldFN0YXR1c0Vycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gbmV3IEVWV0VCMi5WaWRlb0V4cG9ydFN0YXR1cyh2aWRlb0V4cG9ydCwgZGF0YS5zdGF0dXMsIGRhdGEucHJvZ3Jlc3MsIGRhdGEuc2l6ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzdGF0dXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRTdGF0dXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb2V4cG9ydCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICdleHBvcnQnOiB0aGlzLmlkLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZW5lcmF0ZXMgYSBVUkkgZm9yIGRvd25sb2FkaW5nIGEgZmlsZSBnZW5lcmF0ZWQgYnkgdGhlIGV4cG9ydC5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGZpbGVJbmRleCBUaGUgaW5kZXggb2YgdGhlIGdlbmVyYXRlZCBmaWxlIG5hbWUgaW4ge0BsaW5rIEVWV0VCMi5WaWRlb0V4cG9ydC5maWxlbmFtZXN9LlxuICAgICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBVUkkgZm9yIGRvd25sb2FkaW5nIHRoZSBzcGVjaWZpZWQgZmlsZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RG93bmxvYWRVcmkgPSBmdW5jdGlvbihmaWxlSW5kZXgpIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLmZpbGVuYW1lc1tmaWxlSW5kZXhdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZpbGUgaW5kZXggaXMgbm90IGdlbmVyYXRlZCBmb3IgdGhpcyBleHBvcnQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb2V4cG9ydDtcbiAgICAgICAgICAgIHVybCArPSAnP2V4cG9ydD0nICsgdGhpcy5pZC50b1N0cmluZygpICsgJyZhY3Rpb249ZG93bmxvYWQmZmlsZT0nICsgZmlsZUluZGV4O1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRW5kcyBhbiBleHBvcnQsIHN0b3BwaW5nIGFsbCBleHBvcnQgcHJvY2Vzc2luZyBhbmQgcmVtb3ZpbmcgdGhlIGRvd25sb2FkIGxpbmsuXG4gICAgICAgICAqIE5vdGU6IEV4cG9ydHMgd2lsbCB0aW1lb3V0IGF1dG9tYXRpY2FsbHkgYWZ0ZXIgMTUgbWludXRlcywgaG93ZXZlciwgaXQgaXNcbiAgICAgICAgICogaGlnaGx5IHJlY29tbWVuZGVkIHRoYXQgeW91IG1hbnVhbGx5IGVuZCBhbiBleHBvcnQgd2hlbiBmaW5pc2hlZCB0byByZWR1Y2VcbiAgICAgICAgICogbG9hZCBvbiB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsXG4gICAgICAgICAqIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuZEV4cG9ydCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uVmlkZW9FeHBvcnRFbmRFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblZpZGVvRXhwb3J0RW5kU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vQ2FsbCB0aGUgZXJyb3IgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgb25WaWRlb0V4cG9ydEVuZEVycm9yKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25WaWRlb0V4cG9ydEVuZFN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uVmlkZW9FeHBvcnRFbmRFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb2V4cG9ydCxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICdleHBvcnQnOiB0aGlzLmlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2ZpbmlzaCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgIH07XG5cblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuXG4oZnVuY3Rpb24oKSB7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2Ygc3VwcG9ydGVkIG1hcCBpdGVtIHNoYXBlcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBNYXBzXG4gICAgICovXG4gICAgRVZXRUIyLm1hcEl0ZW1TaGFwZVR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCYWxsb29uXG4gICAgICAgICAqL1xuICAgICAgICBiYWxsb29uOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3F1YXJlXG4gICAgICAgICAqL1xuICAgICAgICBzcXVhcmU6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQaW5cbiAgICAgICAgICovXG4gICAgICAgIHBpbjogNFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2Ygc3VwcG9ydGVkIG1hcCBpdGVtcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBNYXBzXG4gICAgICovXG4gICAgRVZXRUIyLm1hcEl0ZW1DYXB0aW9uUG9zaXRpb25UeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSaWdodFxuICAgICAgICAgKi9cbiAgICAgICAgcmlnaHQ6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMZWZ0XG4gICAgICAgICAqL1xuICAgICAgICBsZWZ0OiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogVG9wXG4gICAgICAgICAqL1xuICAgICAgICB0b3A6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb3R0b21cbiAgICAgICAgICovXG4gICAgICAgIGJvdHRvbTogNFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2Ygc3VwcG9ydGVkIG1hcCBpdGVtcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBNYXBzXG4gICAgICovXG4gICAgRVZXRUIyLm1hcEl0ZW1UeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYW1lcmFcbiAgICAgICAgICovXG4gICAgICAgIGNhbWVyYTogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1ZGlvXG4gICAgICAgICAqL1xuICAgICAgICBhdWRpbzogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbFxuICAgICAgICAgKi9cbiAgICAgICAgc2VyaWFsOiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JvdXBcbiAgICAgICAgICovXG4gICAgICAgIGdyb3VwOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogU29mdCBUcmlnZ2VyXG4gICAgICAgICAqL1xuICAgICAgICBzb2Z0VHJpZ2dlcjogNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElucHV0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0VHJpZ2dlcjogNlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2Ygc3VwcG9ydGVkIG1hcCBpdGVtIHNoYXBlcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBNYXBzXG4gICAgICovXG4gICAgRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdXRvLWNvbnRleHRcbiAgICAgICAgICovXG4gICAgICAgIGF1dG9jb250ZXh0OiAweDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNaXJyb3JcbiAgICAgICAgICovXG4gICAgICAgIG1pcnJvcjogMHgyLFxuICAgICAgICAvKipcbiAgICAgICAgICogT3V0cHV0IEhpbnRcbiAgICAgICAgICovXG4gICAgICAgIG91dHB1dEhpbnQ6IDB4NFxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFRoZSBNYXBJdGVtQ2FwdGlvbkluZm8gb2JqZWN0IHJlcHJlc2VudHMgY2FwdGlvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggYSBtYXBcbiAgICAgKiBpdGVtLiBUaGUgb2JqZWN0cyBhcmUgZ2VuZXJhdGVkIGluIHtAbGluayBFVldFQjIuZ2V0TWFwc30uXG4gICAgICogQHBhcmFtIHtFVldFQjIubWFwSXRlbUNhcHRpb25Qb3NpdGlvblR5cGVzfSBbcG9zaXRpb249RVZXRUIyLm1hcEl0ZW1DYXB0aW9uUG9zaXRpb25UeXBlcy5ub25lXSBUaGUgdHlwZSBvZiBpdGVtLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbY29sb3I9JyNGRkZGRkYnXSBUaGUgaGV4IHZhbHVlIG9mIHRoZSBjb2xvciBmb3IgdGhlIGNhcHRpb24uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IE1hcHNcbiAgICAgKi9cbiAgICBFVldFQjIuTWFwSXRlbUNhcHRpb25JbmZvID0gZnVuY3Rpb24ocG9zaXRpb24sIGNvbG9yKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQb3NpdGlvbiBvZiB0aGUgbWFwXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5tYXBJdGVtQ2FwdGlvblBvc2l0aW9uVHlwZXNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBFVldFQjIubWFwSXRlbUNhcHRpb25Qb3NpdGlvblR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhleCB2YWx1ZSBvZiB0aGUgY29sb3IgZm9yIHRoZSBjYXB0aW9uXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb2xvciA9ICcjRkZGRkZGJztcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBwb3NpdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgY29sb3IgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIE1hcEl0ZW1JbmZvIG9iamVjdCByZXByZXNlbnRzIGFuIGl0ZW0gYXNzb2NpYXRlZCB3aXRoIGEgbWFwLiBUaGVcbiAgICAgKiBvYmplY3RzIGFyZSBnZW5lcmF0ZWQgaW4gYW4gYXJyYXkgZnJvbSB7QGxpbmsgRVZXRUIyLmdldE1hcHN9LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIFRoZSBpZCBvZiB0aGUgbWFwIGl0ZW0uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZXJ2ZXJJZD0nJ10gVGhlIHNlcnZlciBpZCBvZiB0aGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgbWFwIGl0ZW0uXG4gICAgICogQHBhcmFtIHtFVldFQjIubWFwSXRlbVR5cGVzfSBbdHlwZT1FVldFQjIubWFwSXRlbVR5cGVzLm5vbmVdIFRoZSB0eXBlIG9mIHRoZSBtYXAgaXRlbS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5tYXBJdGVtU2hhcGVUeXBlc30gW3NoYXBlPUVWV0VCMi5tYXBJdGVtU2hhcGVUeXBlcy5ub25lXSBUaGUgc2hhcGVcbiAgICAgKiBvZiB0aGUgbWFwIGl0ZW0uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt4PTBdIFRoZSB4IGNvb3JkaW5hdGUgb2YgdGhlIGl0ZW0gKHJlbGF0aXZlIHRvIHRoZSBjb250YWluaW5nXG4gICAgICoge0BsaW5rIEVWV0VCMi5NYXB9J3Mgd2lkdGggcHJvcGVydHkpLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbeT0wXSBUaGUgeSBjb29yZGluYXRlIG9mIHRoZSBpdGVtIChyZWxhdGl2ZSB0byB0aGUgY29udGFpbmluZ1xuICAgICAqIHtAbGluayBFVldFQjIuTWFwfSdzIGhlaWdodCBwcm9wZXJ0eSkuXG4gICAgICogQHBhcmFtIHtFVldFQjIuTWFwSXRlbUNhcHRpb25JbmZvfSBbY2FwdGlvbj1udWxsXSBUaGUgY2FwdGlvbiBpbmZvIGZvciB0aGVcbiAgICAgKiBtYXAgaXRlbS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3JvdGF0aW9uPTBdIFRoZSByb3RhdGlvbiBvZiB0aGUgaXRlbS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2ZsYWdzPTBdIEFuIE9SJ2QgbGlzdCBvZiBmbGFncyBhc3NvY2lhdGVkIHdpdGggdGhpcyBtYXAgaXRlbS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgTWFwc1xuICAgICAqL1xuICAgIEVWV0VCMi5NYXBJdGVtSW5mbyA9IGZ1bmN0aW9uKGlkLCBzZXJ2ZXJJZCwgdHlwZSwgc2hhcGUsIHgsIHksIGNhcHRpb24sIHJvdGF0aW9uLCBmbGFncykge1xuICAgICAgICAvKipcbiAgICAgICAgKiBUaGUgaWQgb2YgdGhlIG1hcCBpdGVtLlxuICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgaWQgb2YgdGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIG1hcCBpdGVtLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVySWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgdGhlIG1hcCBpdGVtLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIubWFwSXRlbVR5cGVzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIubWFwSXRlbVR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhleCB2YWx1ZSBvZiB0aGUgY29sb3IgZm9yIHRoZSBjYXB0aW9uXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5tYXBJdGVtU2hhcGVUeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaGFwZSA9IEVWV0VCMi5tYXBJdGVtU2hhcGVUeXBlcy5ub25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgeCBjb29yZGluYXRlIG9mIHRoZSBpdGVtXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy54ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHkgY29vcmRpbmF0ZSBvZiB0aGUgaXRlbVxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMueSA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhcHRpb24gaW5mbyBmb3IgbWFwIGl0ZW1cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLk1hcEl0ZW1DYXB0aW9uSW5mb1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYXB0aW9uID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHJvdGF0aW9uIG9mIHRoZSBtYXAgaXRlbVxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucm90YXRpb24gPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBhcnJheSBvZiBhbGwgZmxhZ3MgYXNzb2NpYXRlZCB3aXRoIHRoZSBtYXAgaXRlbS5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXNbXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mbGFncyA9IFtdO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXJJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVySWQgPSBzZXJ2ZXJJZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdHlwZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHNoYXBlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy54ID0geDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgeSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMueSA9IHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGNhcHRpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmNhcHRpb24gPSBjYXB0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiByb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucm90YXRpb24gPSByb3RhdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgZmxhZ3MgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICBpZigoZmxhZ3MmRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMuYXV0b2NvbnRleHQpID09PSBFVldFQjIubWFwSXRlbUZsYWdUeXBlcy5hdXRvY29udGV4dCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmxhZ3MucHVzaChFVldFQjIubWFwSXRlbUZsYWdUeXBlcy5hdXRvY29udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoZmxhZ3MmRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMubWlycm9yKSA9PT0gRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMubWlycm9yKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mbGFncy5wdXNoKEVWV0VCMi5tYXBJdGVtRmxhZ1R5cGVzLm1pcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigoZmxhZ3MmRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMub3V0cHV0SGludCkgPT09IEVWV0VCMi5tYXBJdGVtRmxhZ1R5cGVzLm91dHB1dEhpbnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsYWdzLnB1c2goRVZXRUIyLm1hcEl0ZW1GbGFnVHlwZXMub3V0cHV0SGludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgTWFwIG9iamVjdCBpcyBhIHdyYXBwZWQgc2V0IG9mIGluZm9ybWF0aW9uIGZvciBhIHNlcnZlciBzaWRlIG1hcC4gIEl0XG4gICAgICogYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgdGhlIHByb3BlcnRpZXMgb2YgYW4gaW5kaXZpZHVhbCBtYXAuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZX0gW3NlcnZpY2U9bnVsbF0gVGhlIHNlcnZpY2UgaW5zdGFuY2UgZm9yIHRoaXMgbWFwLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIElEIG9mIHRoZSBtYXAuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSByb290IHNlcnZlciBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBtYXAuIEl0ZW1zIG1heSBiZSBmcm9tXG4gICAgICogbXVsdGlwbGUgc2VydmVycywgYnV0IGFsbCBtYXAtbGV2ZWwgcmVxdWVzdHMgYXJlIHRhcmdldGVkIHRvIHRoaXMgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFyZW50SWQ9JzAnXSBJRCBvZiB0aGUgcGFyZW50IG1hcC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9J1VubmFtZWQnXSBOYW1lIG9mIHRoZSBtYXAuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkZXNjcmlwdGlvbj0nJ10gRGVzY3JpcHRpb24gb2YgdGhlIG1hcC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5NYXBJdGVtSW5mb1tdfSBbaXRlbXM9W11dIEFycmF5IG9mIHRoZSBtYXAgaXRlbXNcbiAgICAgKiBhc3NvY2lhdGVkIHdpdGggdGhlIG1hcC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgTWFwc1xuICAgICAqL1xuICAgIEVWV0VCMi5NYXAgPSBmdW5jdGlvbiAoc2VydmljZSwgaWQsIHNlcnZlciwgcGFyZW50SWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpdGVtcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZpY2UgaW5zdGFuY2UgZm9yIHRoaXMgc2VydmVyXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJRCBvZiB0aGUgbWFwXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcm9vdCBzZXJ2ZXIgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgbWFwLiBJdGVtcyBtYXkgYmUgZnJvbSBtdWx0aXBsZSBzZXJ2ZXJzLCBidXQgYWxsIG1hcC1sZXZlbFxuICAgICAgICAgKiByZXF1ZXN0cyBhcmUgdGFyZ2V0ZWQgdG8gdGhpcyBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSUQgb2YgdGhlIHBhcmVudCBtYXAuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXJlbnRJZCA9ICcwJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZSBvZiB0aGUgbWFwXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJ1VubmFtZWQnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXNjcmlwdGlvbiBvZiB0aGUgbWFwXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcnJheSBvZiBtYXAgaXRlbXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBtYXBcbiAgICAgICAgICogQHR5cGUgQXJyYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2aWNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBwYXJlbnRJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50SWQgPSBwYXJlbnRJZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbmFtZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBpdGVtcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIFVSTCBmb3IgdGhlIG1hcCdzIGJhY2tncm91bmQgaW1hZ2UuXG4gICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVSTCBmb3IgdGhlIG1hcCdzIGJhY2tncm91bmQgaW1hZ2VcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0SW1hZ2VVcmwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLmlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5tYXA7XG4gICAgICAgICAgICAgICAgdXJsICs9ICc/bWFwPScgKyB0aGlzLmlkO1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcblxufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIEVWV0VCMi5zZXJ2ZXJTdGF0dXMgPSB7XG4gICAgICAgIG5vcm1hbDogMCxcbiAgICAgICAgYWxhcm06IDEsXG4gICAgICAgIG1vdGlvbjogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBIHN0YXR1cyBpbnN0YW5jZSBmb3IgYW4gaW5kaXZpZHVhbCBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhfSBbaW5zdGFuY2U9bnVsbF0gVGhlIGNhbWVyYSBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBzdGF0dXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbW90aW9uPWZhbHNlXSBXaGV0aGVyIG1vdGlvbiBpcyBkZXRlY3RlZCBvbiB0aGUgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2xvc3M9ZmFsc2VdIFdoZXRoZXIgdmlkZW8gbG9zcyBpcyBkZXRlY3RlZCBvbiB0aGUgY2FtZXJhLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3RhdHVzQ2FtZXJhSXRlbSA9IGZ1bmN0aW9uKGluc3RhbmNlLCBtb3Rpb24sIGxvc3MpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqICBUaGUgY2FtZXJhIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHN0YXR1c1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuQ2FtZXJhXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluc3RhbmNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBtb3Rpb24gaXMgZGV0ZWN0ZWQgb24gdGhlIGNhbWVyYVxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1vdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHZpZGVvIGxvc3MgaXMgZGV0ZWN0ZWQgb24gdGhlIGNhbWVyYVxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvc3MgPSBmYWxzZTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBpbnN0YW5jZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbW90aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5tb3Rpb24gPSBtb3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGxvc3MgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmxvc3MgPSBsb3NzO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgc3RhdHVzIGluc3RhbmNlIGZvciBhbiBpbmRpdmlkdWFsIHRyaWdnZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVHJpZ2dlcn0gW2luc3RhbmNlPW51bGxdIFRoZSB0cmlnZ2VyIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHN0YXR1cy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi50cmlnZ2VyU3RhdGV9IFt0cmlnZ2VyU3RhdGU9RVZXRUIyLnRyaWdnZXJTdGF0ZS51bmtub3duXSBUaGUgc3RhdGUgb2YgdGhlIHRyaWdnZXIuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5TdGF0dXNUcmlnZ2VySXRlbSA9IGZ1bmN0aW9uKGluc3RhbmNlLCB0cmlnZ2VyU3RhdGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqICBUaGUgdHJpZ2dlciBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBzdGF0dXNcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaW5zdGFuY2UgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3RhdGUgb2YgdGhlIHRyaWdnZXJcbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnRyaWdnZXJTdGF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmlnZ2VyU3RhdGUgPSBFVldFQjIudHJpZ2dlclN0YXRlLnVua25vd247XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgaW5zdGFuY2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHRyaWdnZXJTdGF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlclN0YXRlID0gdHJpZ2dlclN0YXRlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgc3RhdHVzIGluc3RhbmNlIGZvciBhbiBpbmRpdmlkdWFsIG1hcC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5NYXB9IFtpbnN0YW5jZT1udWxsXSBUaGUgbWFwIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHN0YXR1cy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFttb3Rpb249ZmFsc2VdIFdoZXRoZXIgbW90aW9uIGlzIGRldGVjdGVkIG9uIGFueSBvZiBjYW1lcmFzIGluY2x1ZGVkIGluXG4gICAgICogdGhlIG1hcC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtsb3NzPWZhbHNlXSBXaGV0aGVyIHZpZGVvIGxvc3MgaXMgZGV0ZWN0ZWQgb24gb24gYW55IG9mIGNhbWVyYXMgaW5jbHVkZWRcbiAgICAgKiBpbiB0aGUgbWFwLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3RhdHVzTWFwSXRlbSA9IGZ1bmN0aW9uKGluc3RhbmNlLCBtb3Rpb24sIGxvc3MpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqICBUaGUgbWFwIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHN0YXR1c1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuTWFwXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluc3RhbmNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBtb3Rpb24gaXMgZGV0ZWN0ZWQgb24gYW55IG9mIGNhbWVyYXMgaW5jbHVkZWQgaW4gdGhlIG1hcFxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1vdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHZpZGVvIGxvc3MgaXMgZGV0ZWN0ZWQgb24gYW55IG9mIGNhbWVyYXMgaW5jbHVkZWQgaW4gdGhlIG1hcFxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvc3MgPSBmYWxzZTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBpbnN0YW5jZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbW90aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5tb3Rpb24gPSBtb3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGxvc3MgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmxvc3MgPSBsb3NzO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgY29sbGVjdGlvbiBvZiBzdGF0dXMgaW5mb3JtYXRpb24gcmV0dXJuZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2ZXIuZ2V0U3RhdHVzfS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IFtzZXJ2ZXI9bnVsbF0gVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIHN0YXR1c2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlN0YXR1c0NhbWVyYUl0ZW1bXX0gW2NhbWVyYXM9W11dIEFuIGFycmF5IG9mIGFsbCByZXF1ZXN0ZWQgY2FtZXJhIHN0YXR1c2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlN0YXR1c1RyaWdnZXJJdGVtW119IFt0cmlnZ2Vycz1bXV0gQW4gYXJyYXkgb2YgYWxsIHJlcXVlc3RlZCB0cmlnZ2VyIHN0YXR1c2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlN0YXR1c01hcEl0ZW1bXX0gW21hcHM9W11dIEFuIGFycmF5IG9mIGFsbCByZXF1ZXN0ZWQgbWFwIHN0YXR1c2VzLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3RhdHVzID0gZnVuY3Rpb24oc2VydmVyLCBjYW1lcmFzLCB0cmlnZ2VycywgbWFwcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIHN0YXR1c2VzXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FtZXJhIHN0YXR1c2VzXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TdGF0dXNDYW1lcmFJdGVtW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FtZXJhcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHJpZ2dlciBzdGF0dXNlc1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU3RhdHVzVHJpZ2dlckl0ZW1bXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmlnZ2VycyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWFwIHN0YXR1c2VzXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TdGF0dXNNYXBJdGVtW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWFwcyA9IFtdO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIHNlcnZlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBjYW1lcmFzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzID0gY2FtZXJhcztcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdHJpZ2dlcnMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnRyaWdnZXJzID0gdHJpZ2dlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIG1hcHMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm1hcHMgPSBtYXBzO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgY29sbGVjdGlvbiBvZiBzdGF0dXMgaW5mb3JtYXRpb24gcmV0dXJuZWQgYnkge0BsaW5rIEVWV0VCMi5TZXJ2ZXIuZ2V0U3RhdHVzfS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IFtzZXJ2ZXI9bnVsbF0gVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIHN0YXR1c2VzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nW119IFtsb3NzQ2FtZXJhcz1bXV0gQW4gYXJyYXkgb2YgY2FtZXJhIElEcyBmb3IgYWxsIGNhbWVyYXMgaW4gYSBsb3NzIHN0YXRlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nW119IFttb3Rpb25DYW1lcmFzPVtdXSBBbiBhcnJheSBvZiBjYW1lcmEgSURzIGZvciBhbGwgY2FtZXJhcyBpbiBhIGxvc3Mgc3RhdGUuXG4gICAgICogQHBhcmFtIHtTdHJpbmdbXX0gW2FsYXJtVHJpZ2dlcnM9W11dIEFuIGFycmF5IG9mIHRyaWdnZXIgSURzIGZvciBhbGwgc29mdCB0cmlnZ2VycyBpbiBhbiBhbGFybSBzdGF0ZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZXJ2ZXJTdGF0dXN9IFtzZXJ2ZXJTdGF0dXM9RVZXRUIyLnNlcnZlclN0YXR1cy5ub3JtYWxdIFRoZSBzZXJ2ZXIgc3RhdHVzIGVudW0gdmFsdWU7XG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2ZXJTdGF0dXMgPSBmdW5jdGlvbihzZXJ2ZXIsIGxvc3NDYW1lcmFzLCBtb3Rpb25DYW1lcmFzLCBhbGFybVRyaWdnZXJzLCBzZXJ2ZXJTdGF0dXMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdGF0dXNlc1xuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSBJRHMgZm9yIGFsbCBjYW1lcmFzIGluIGEgbG9zcyBzdGF0ZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9zc0NhbWVyYXMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSBJRHMgZm9yIGFsbCBjYW1lcmFzIGluIGEgbW90aW9uIHN0YXRlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdbXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tb3Rpb25DYW1lcmFzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0cmlnZ2VyIElEcyBmb3IgYWxsIHNvZnQgdHJpZ2dlcnMgaW4gYW4gYWxhcm0gc3RhdGUuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1tdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFsYXJtVHJpZ2dlcnMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBzdGF0dXMgZW51bSB2YWx1ZS5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnNlcnZlclN0YXR1c1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXJTdGF0dXMgPSBFVldFQjIuc2VydmVyU3RhdHVzLm5vcm1hbDtcblxuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKGxvc3NDYW1lcmFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9zc0NhbWVyYXMgPSBsb3NzQ2FtZXJhcztcbiAgICAgICAgfVxuICAgICAgICBpZihtb3Rpb25DYW1lcmFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW90aW9uQ2FtZXJhcyA9IG1vdGlvbkNhbWVyYXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYWxhcm1UcmlnZ2VycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmFsYXJtVHJpZ2dlcnMgPSBhbGFybVRyaWdnZXJzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHNlcnZlclN0YXR1cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlclN0YXR1cyA9IHNlcnZlclN0YXR1cztcbiAgICAgICAgfVxuICAgIH07XG5cbn0oKSk7IiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cblxuKGZ1bmN0aW9uKCkge1xuXG4gICAgLyoqXG4gICAgICogVGhlIHR5cGVzIG9mIHN1cHBvcnRlZCBncm91cCBpY29ucy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBHcm91cHNcbiAgICAgKi9cbiAgICBFVldFQjIuZ3JvdXBJY29uVHlwZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogRmFjdG9yeVxuICAgICAgICAgKi9cbiAgICAgICAgZmFjdG9yeTogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvdXJ0XG4gICAgICAgICAqL1xuICAgICAgICBjb3VydDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhvdXNlXG4gICAgICAgICAqL1xuICAgICAgICBob3VzZTogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNreXNjcmFwZXJcbiAgICAgICAgICovXG4gICAgICAgIHNreXNjcmFwZXI6IDQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdGF0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBzdGF0aW9uOiA1LFxuICAgICAgICAvKipcbiAgICAgICAgICogT2ZmaWNlXG4gICAgICAgICAqL1xuICAgICAgICBvZmZpY2U6IDZcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2Ygc3VwcG9ydGVkIGdyb3VwIGl0ZW1zLiBUaGlzIGlzIGEgcGxhY2Vob2xkZXIgY29weSBvZiB7QGxpbmsgRVZXRUIyLm1hcEl0ZW1UeXBlc31cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBHcm91cHNcbiAgICAgKi9cbiAgICBFVldFQjIuZ3JvdXBJdGVtVHlwZXMgPSBFVldFQjIubWFwSXRlbVR5cGVzO1xuXG4gICAgLyoqXG4gICAgICogVGhlIEdyb3VwSXRlbUluZm8gb2JqZWN0IHJlcHJlc2VudHMgYW4gaXRlbSBhc3NvY2lhdGVkIHdpdGggYSBncm91cC4gVGhlXG4gICAgICogb2JqZWN0cyBhcmUgZ2VuZXJhdGVkIGluIGFuIGFycmF5IGZyb20ge0BsaW5rIEVWV0VCMi5nZXRHcm91cHN9LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIFRoZSBpZCBvZiB0aGUgZ3JvdXAgaXRlbS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlcnZlcklkPScnXSBUaGUgc2VydmVyIGlkIG9mIHRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBncm91cCBpdGVtLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmdyb3VwSXRlbVR5cGVzfSBbdHlwZT1FVldFQjIuZ3JvdXBJdGVtVHlwZXMubm9uZV0gVGhlIHR5cGUgb2YgdGhlIGdyb3VwIGl0ZW0uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IEdyb3Vwc1xuICAgICAqL1xuICAgIEVWV0VCMi5Hcm91cEl0ZW1JbmZvID0gZnVuY3Rpb24oaWQsIHNlcnZlcklkLCB0eXBlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaWQgb2YgdGhlIGdyb3VwIGl0ZW0uXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGlkIG9mIHRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBncm91cCBpdGVtLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVySWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgdGhlIGdyb3VwIGl0ZW0uXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5ncm91cEl0ZW1UeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLmdyb3VwSXRlbVR5cGVzLm5vbmU7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHNlcnZlcklkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJJZCA9IHNlcnZlcklkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB0eXBlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgR3JvdXAgb2JqZWN0IGlzIGEgd3JhcHBlZCBzZXQgb2YgaW5mb3JtYXRpb24gZm9yIGEgc2VydmVyIHNpZGUgZ3JvdXAuICBJdFxuICAgICAqIGFjdHMgYXMgYSBjb250YWluZXIgZm9yIHRoZSBwcm9wZXJ0aWVzIG9mIGFuIGluZGl2aWR1YWwgZ3JvdXAuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gSUQgb2YgdGhlIGdyb3VwLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nVW5uYW1lZCddIE5hbWUgb2YgdGhlIGdyb3VwLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGVzY3JpcHRpb249JyddIERlc2NyaXB0aW9uIG9mIHRoZSBncm91cC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5ncm91cEljb25UeXBlc30gW2ljb249RVZXRUIyLmdyb3VwSWNvblR5cGVzLm5vbmVdIFRoZSBpY29uIGFzc29jaWF0ZWRcbiAgICAgKiB3aXRoIHRoZSBncm91cC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Hcm91cEl0ZW1JbmZvW119IFtpdGVtcz1bXV0gQXJyYXkgb2YgdGhlIGl0ZW1zXG4gICAgICogYXNzb2NpYXRlZCB3aXRoIHRoZSBncm91cC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgR3JvdXBzXG4gICAgICovXG4gICAgRVZXRUIyLkdyb3VwID0gZnVuY3Rpb24gKGlkLCBuYW1lLCBkZXNjcmlwdGlvbiwgaWNvbiwgaXRlbXMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElEIG9mIHRoZSBncm91cFxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZSBvZiB0aGUgZ3JvdXBcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW5uYW1lZCc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlc2NyaXB0aW9uIG9mIHRoZSBncm91cFxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVHlwZSBvZiBncm91cCBpY29uXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5ncm91cEljb25UeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pY29uID0gRVZXRUIyLmdyb3VwSWNvblR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFycmF5IG9mIGl0ZW1zIGFzc29jaWF0ZWQgd2l0aCB0aGUgZ3JvdXBcbiAgICAgICAgICogQHR5cGUgQXJyYXlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBpZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgbmFtZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBpY29uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pY29uID0gaWNvbjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaXRlbXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gaXRlbXM7XG4gICAgICAgIH1cbiAgICB9O1xuXG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG5cbi8qKlxuICogVGhlIFRodW1ibmFpbFNlYXJjaEluZm8gb2JqZWN0IHJlcHJlc2VudHMgaW5mb3JtYXRpb24gZm9yIGEgZnJhbWUuXG4gKiBAcGFyYW0ge1N0cmluZ30gW3Nlc3Npb25JZD0nJ10gU2Vzc2lvbiBJRCBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaC5cbiAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gW2NhbWVyYT1udWxsXSBDYW1lcmEgYXNzb2NpYXRlZCB3aXRoIHRoZSB0aHVtYm5haWwgc2VhcmNoLlxuICogQHBhcmFtIHtEYXRlfSBbZnJhbWVUaW1lc3RhbXA9bmV3IERhdGUoKV0gVGltZXN0YW1wIGFzc29jaWF0ZWQgd2l0aCB0aGUgZnJhbWUuXG4gKiBAcGFyYW0ge051bWJlcn0gW2ZyYW1lSW5kZXg9LTFdIEluZGV4IG9mIHRoZSBmcmFtZSB0byByZXRyaWV2ZS5cbiAqIEBjbGFzc1xuICogQGNhdGVnb3J5IFNlYXJjaFxuICovXG5cbkVWV0VCMi5UaHVtYm5haWxTZWFyY2hJbmZvID0gZnVuY3Rpb24gKHNlc3Npb25JZCwgY2FtZXJhLCBmcmFtZVRpbWVzdGFtcCwgZnJhbWVJbmRleCkge1xuICAgIC8qKlxuICAgICAqIFNlc3Npb24gSUQgYXNzb2NpYXRlZCB3aXRoIHRoZSB0aHVtYm5haWwgc2VhcmNoXG4gICAgICogQHR5cGUgU3RyaW5nXG4gICAgICovXG4gICAgdGhpcy5zZXNzaW9uSWQgPSAnJztcblxuICAgIC8qKlxuICAgICAqIENhbWVyYSBhc3NvY2lhdGVkIHdpdGggdGhlIHRodW1ibmFpbCBzZWFyY2hcbiAgICAgKiBAdHlwZSBFVldFQjIuQ2FtZXJhXG4gICAgICovXG4gICAgdGhpcy5jYW1lcmEgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogVGltZXN0YW1wIG9mIHRoZSByZXF1aXJlZCBmcmFtZVxuICAgICAqIEB0eXBlIERhdGVcbiAgICAgKi9cbiAgICB0aGlzLmZyYW1lVGltZXN0YW1wID0gbmV3IERhdGUoKTtcblxuICAgIC8qKlxuICAgICAqIEluZGV4IG9mIHRoZSByZXF1aXJlZCBmcmFtZVxuICAgICAqIEB0eXBlIE51bWJlclxuICAgICAqL1xuICAgIHRoaXMuZnJhbWVJbmRleCA9IC0xO1xuXG4gICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgIGlmKHR5cGVvZiBzZXNzaW9uSWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMuc2Vzc2lvbklkID0gc2Vzc2lvbklkO1xuICAgIH1cbiAgICBpZih0eXBlb2YgY2FtZXJhICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTtcbiAgICB9XG4gICAgaWYodHlwZW9mIGZyYW1lVGltZXN0YW1wICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLmZyYW1lVGltZXN0YW1wID0gZnJhbWVUaW1lc3RhbXA7XG4gICAgfVxuICAgIGlmKHR5cGVvZiBmcmFtZUluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLmZyYW1lSW5kZXggPSBmcmFtZUluZGV4O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoZSBnZXRUaHVtYm5haWxJbWFnZVVybCBvYmplY3QgaXMgdXNlZCB0byByZXRyaWV2ZSB0aGUgdGh1bWJuYWlsIGltYWdlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHRodW1ibmFpbCBpbWFnZSBpbiBwaXhlbHMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSB0aHVtYm5haWwgaW1hZ2UgaW4gcGl4ZWxzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBxdWFsaXR5IFRoZSBxdWFsaXR5IG9mIHRoZSB0aHVtYm5haWwgaW1hZ2UgcmFuZ2luZyBmcm9tIDEgLTEwLlxuICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIFVSTCB0byByZXF1ZXN0IHRoZSByZXF1aXJlZCB0aHVtYm5haWwgaW1hZ2UuXG4gICAgICovXG4gICAgdGhpcy5nZXRUaHVtYm5haWxJbWFnZVVybCA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHF1YWxpdHkpIHtcbiAgICAgICAgaWYoIXRoaXMuY2FtZXJhLnN1cHBvcnRzR2V0RnJhbWUoKSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjYW1lcmEgPSB0aGlzLmNhbWVyYTtcbiAgICAgICAgdmFyIHNlcnZlciA9IGNhbWVyYS5zZXJ2ZXI7XG4gICAgICAgIHZhciB1cmwgPSBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnRodW1ibmFpbDtcblxuICAgICAgICB2YXIgcGFyYW1zID0gW1xuICAgICAgICAgICAgJ3M9JyArIHNlc3Npb25JZCxcbiAgICAgICAgICAgICdmcmFtZT0nICsgdGhpcy5mcmFtZUluZGV4XG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIHVzZU5hdGl2ZUpwZWcgPSBmYWxzZTtcbiAgICAgICAgdmFyIGZvcndhcmRpbmdTZXR0aW5ncyA9IHNlcnZlci5zZXJ2aWNlLmpwZWdGb3J3YXJkaW5nO1xuICAgICAgICBpZihmb3J3YXJkaW5nU2V0dGluZ3MuZW5hYmxlZCAmJiAkLmluQXJyYXkoRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZywgY2FtZXJhLmZvcm1hdHMpICE9PSAtMSkge1xuICAgICAgICAgICAgdXNlTmF0aXZlSnBlZyA9IGNhbWVyYS5xdWFsaXR5ICogKGZvcndhcmRpbmdTZXR0aW5ncy5xdWFsaXR5VGhyZXNob2xkLzEwMCkgPCBxdWFsaXR5ICYmXG4gICAgICAgICAgICAgICAgKGNhbWVyYS5yZXNvbHV0aW9uLndpZHRoICogKGZvcndhcmRpbmdTZXR0aW5ncy5zaXplVGhyZXNob2xkLzEwMCkgPCB3aWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICBjYW1lcmEucmVzb2x1dGlvbi5oZWlnaHQgKiAoZm9yd2FyZGluZ1NldHRpbmdzLnNpemVUaHJlc2hvbGQvMTAwKSA8IGhlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZm9ybWF0ID0gRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWc7XG4gICAgICAgIGlmKHVzZU5hdGl2ZUpwZWcgfHwgJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnLCBjYW1lcmEuZm9ybWF0cykgPT09IC0xKSB7XG4gICAgICAgICAgICBmb3JtYXQgPSBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnO1xuICAgICAgICB9XG4gICAgICAgIGlmKGZvcm1hdCAhPT0gRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZykge1xuICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3c9Jyt3aWR0aCk7XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgnaD0nK2hlaWdodCk7XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgncT0nK3F1YWxpdHkpO1xuICAgICAgICB9XG4gICAgICAgIHBhcmFtcy5wdXNoKCdmb3JtYXQ9Jytmb3JtYXQpO1xuXG4gICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignOycpO1xuXG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgfTtcbn07XG5cbi8qKlxuICogVGhlIFRodW1ibmFpbFNlYXJjaCBvYmplY3QgcmVwcmVzZW50cyBhIHRodW1ibmFpbCBzZWFyY2guIFRoZVxuICogb2JqZWN0cyBhcmUgZ2VuZXJhdGVkIGZyb20ge0BsaW5rIEVWV0VCMi5DYW1lcmEuZ2V0VGh1bWJuYWlsU2VhcmNofS5cbiAqIEBwYXJhbSB7U3RyaW5nfSBbc2Vzc2lvbklkPScnXSBUaGUgc2Vzc2lvbiBpZCBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaC5cbiAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gW2NhbWVyYT1udWxsXSBUaGUgY2FtZXJhIGFzc29jaWF0ZWQgd2l0aCB0aGUgdGh1bWJuYWlsIHNlYXJjaC5cbiAqIEBwYXJhbSB7RGF0ZX0gW3N0YXJ0PW5ldyBEYXRlKCldIFN0YXJ0IHRpbWUgb2YgdGhlIHNlYXJjaC5cbiAqIEBwYXJhbSB7RGF0ZX0gW2VuZD1uZXcgRGF0ZSgpXSBFbmQgdGltZSBvZiB0aGUgc2VhcmNoLlxuICogQHBhcmFtIHtFVldFQjIuVGh1bWJuYWlsU2VhcmNoSW5mb1tdfSBbZnJhbWVzSW5mbz1bXV0gQW4gYXJyYXkgb2YgVGh1bWJuYWlsU2VhcmNoSW5mbyBvYmplY3RzLlxuICogQGNsYXNzXG4gKiBAY2F0ZWdvcnkgU2VhcmNoXG4gKi9cbkVWV0VCMi5UaHVtYm5haWxTZWFyY2ggPSBmdW5jdGlvbihzZXNzaW9uSWQsIGNhbWVyYSwgc3RhcnQsIGVuZCwgZnJhbWVzSW5mbykge1xuICAgIC8qKlxuICAgICAqIFNlc3Npb24gSUQgYWNjb3JkaW5nIHRvIHRoZSB3ZWJzZXJ2aWNlXG4gICAgICogQHR5cGUgU3RyaW5nXG4gICAgICovXG4gICAgdGhpcy5zZXNzaW9uSWQgPSAnJztcblxuICAgIC8qKlxuICAgICogQ2FtZXJhIGFzc29jaWF0ZWQgd2l0aCB0aGUgdGh1bWJuYWlsIHNlYXJjaFxuICAgICogQHR5cGUgRVZXRUIyLkNhbWVyYVxuICAgICovXG4gICAgdGhpcy5jYW1lcmEgPSBudWxsO1xuXG4gICAgLyoqXG4gICAgICogU3RhcnQgdGltZSBvZiB0aGUgc2VhcmNoXG4gICAgICogQHR5cGUgRGF0ZVxuICAgICAqL1xuICAgIHRoaXMuc3RhcnQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgLyoqXG4gICAgICogRW5kIHRpbWUgb2YgdGhlIHNlYXJjaFxuICAgICAqIEB0eXBlIERhdGVcbiAgICAgKi9cbiAgICB0aGlzLmVuZCA9IG5ldyBEYXRlKCk7XG5cbiAgICAvKipcbiAgICAqIEFycmF5IG9mIGZyYW1lIGluZm9ybWF0aW9uIGFzc29jaWF0ZWQgd2l0aCB0aGUgc2VhcmNoXG4gICAgKiBAdHlwZSBFVldFQjIuVGh1bWJuYWlsU2VhcmNoSW5mb1tdXG4gICAgKi9cbiAgICB0aGlzLmZyYW1lc0luZm8gPSBbXTtcblxuICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICBpZih0eXBlb2Ygc2Vzc2lvbklkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLnNlc3Npb25JZCA9IHNlc3Npb25JZDtcbiAgICB9XG4gICAgaWYodHlwZW9mIGNhbWVyYSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgfVxuICAgIGlmKHR5cGVvZiBzdGFydCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xuICAgIH1cbiAgICBpZih0eXBlb2YgZW5kICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICB0aGlzLmVuZCA9IGVuZDtcbiAgICB9XG4gICAgaWYodHlwZW9mIGZyYW1lc0luZm8gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHRoaXMuZnJhbWVzSW5mbyA9IGZyYW1lc0luZm87XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9ncyBvdXQgdGhlIGN1cnJlbnQgdGh1bWJuYWlsIHNlYXJjaC4gIFRoaXMgZGVzdHJveXMgYWxsIHJlc291cmNlcyBhc3NvY2lhdGVkIHdpdGggdGhlIHNlYXJjaCBhbmQgc2hvdWxkIGJlXG4gICAgICogY2FsbGVkIGZvciBlYWNoIHRodW1ibmFpbCBzZWFyY2ggYXMgdGhlIHNlYXJjaCBpcyBmaW5pc2hlZC5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICovXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHNlcnZlciA9IHRoaXMuY2FtZXJhLnNlcnZlcjtcbiAgICAgICAgdmFyIG9uTG9nb3V0U2VydmVyRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25Mb2dvdXRTZXJ2ZXJTdWNjZXNzID0gZnVuY3Rpb24oLypkYXRhLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IG9uTG9nb3V0U2VydmVyU3VjY2VzcyxcbiAgICAgICAgICAgIGVycm9yOiBvbkxvZ291dFNlcnZlckVycm9yLFxuICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxvZ291dCxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlc3Npb25JZFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIHRoZSBzZXJ2aWNlIHRoYXQgYSBwcm9jZXNzIGlzIHN0aWxsIGluIHVzZS4gIFRoaXMgcHJldmVudHMgYW4gaW5hY3RpdmUgdGh1bWJuYWlsIHNlYXJjaCBmcm9tIGJlaW5nXG4gICAgICogY2xvc2VkLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICovXG4gICAgdGhpcy5ub3RpZnlVc2UgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdmFyIHNlYXJjaFNlcnZlciA9IG5ldyBFVldFQjIuU2VydmVyKHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlLCAnJywgdGhpcy5jYW1lcmEuc2VydmVyLmlkLCB0cnVlLCBmYWxzZSwgdGhpcy5zZXNzaW9uSWQpO1xuICAgICAgICBzZWFyY2hTZXJ2ZXIubm90aWZ5VXNlKGNhbGxiYWNrKTtcbiAgICB9O1xuXG59OyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgVG91ckZvbGRlciBvYmplY3QgaXMgYSB3cmFwcGVkIG9iamVjdCB0aGF0IHJlcHJlc2VudHMgYSBmb2xkZXIgY29udGFpbmluZyBvbmUgb3IgbW9yZSB0b3VycyBvciBmb2xkZXJzLlxuICAgICAqIFRoZSBvYmplY3RzIGFyZSBnZW5lcmF0ZWQgaW4gYW4gYXJyYXkgZnJvbSB7QGxpbmsgRVZXRUIyLlNlcnZpY2UuZ2V0VG91cnN9LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIFRoZSBJRCBvZiB0aGUgdG91ciBmb2xkZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPScnXSBUaGUgbmFtZSBvZiB0aGUgdG91ciBmb2xkZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtwYXJlbnRJZD0nJ10gVGhlIHBhcmVudCBJRCBvZiB0aGUgdG91ciBmb2xkZXIuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFRvdXJzXG4gICAgICovXG4gICAgRVZXRUIyLlRvdXJGb2xkZXIgPSBmdW5jdGlvbihpZCwgbmFtZSwgcGFyZW50SWQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgdG91ciBmb2xkZXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhlIHRvdXIgZm9sZGVyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgdG91ciBmb2xkZXIncyBwYXJlbnQgZm9sZGVyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXJlbnRJZCA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBuYW1lICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgcGFyZW50SWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudElkID0gcGFyZW50SWQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFRvdXJJdGVtIG9iamVjdCBpcyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhIHNlY3Rpb24gb2YgdGhlIHRvdXIuIFRoZSBvYmplY3RzIGFyZSBnZW5lcmF0ZWQgaW5cbiAgICAgKiBhbiBhcnJheSBmcm9tIHtAbGluayBFVldFQjIuU2VydmljZS5nZXRUb3Vyc30uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpbmRleD0wXSBUaGUgaW5kZXggaW4gdGhlIHRvdXIuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtkd2VsbD0wXSBUaGUgZHdlbGwgdGltZSwgaW4gc2Vjb25kcywgZm9yIHRoZSB0b3VyIGl0ZW0uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt2aWV3PScnXSBUaGUgbmFtZSBvZiB0aGUgdmlldyB0byBiZSBkaXNwbGF5ZWQgZm9yIHRoaXMgdG91ciBpdGVtLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBUb3Vyc1xuICAgICAqL1xuICAgIEVWV0VCMi5Ub3VySXRlbSA9IGZ1bmN0aW9uKGluZGV4LCBkd2VsbCwgdmlldykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGluZGV4IGluIHRoZSB0b3VyLlxuICAgICAgICAgKiBOb3RlOiBOb3QgYWxsIGluZGV4ZXMgYXJlIGNvbnRpZ3VvdXMuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbmRleCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkd2VsbCB0aW1lLCBpbiBzZWNvbmRzIGZvciB0aGUgdG91ciBpdGVtLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZHdlbGwgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmFtZSBvZiB0aGUgdmlldyB0byBiZSBkaXNwbGF5ZWQgZm9yIHRoaXMgdG91ciBpdGVtLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmlldyA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIGluZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBkd2VsbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuZHdlbGwgPSBkd2VsbDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgdmlldyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHZpZXc7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFRvdXIgb2JqZWN0IGlzIGEgd3JhcHBlZCBzZXQgb2YgaW5mb3JtYXRpb24gZm9yIGEgdmlldyB0b3VyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gTmFtZSBvZiB0aGUgdG91ci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Ub3VyRm9sZGVyfSBbZm9sZGVyPW51bGxdIFRoZSB0b3VyJ3MgY29udGFpbmVyIGZvbGRlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Ub3VySXRlbVtdfSBbaXRlbXM9W11dIEFycmF5IG9mIHRoZSBpdGVtcyBpbiB0aGUgdG91ci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Rlc2NyaXB0aW9uPScnXSBEZXNjcmlwdGlvbiBvZiB0aGUgdG91ci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBTZXJ2aWNlIHRoZSB0b3VyIGJlbG9uZ3MgdG8uXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IFRvdXJzXG4gICAgICovXG4gICAgRVZXRUIyLlRvdXIgPSBmdW5jdGlvbiAobmFtZSwgZm9sZGVyLCBpdGVtcywgZGVzY3JpcHRpb24sIHNlcnZpY2UpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhlIHRvdXJcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSB0b3VyJ3MgY29udGFpbmVyIGZvbGRlclxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVG91ckZvbGRlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb2xkZXIgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcnJheSBvZiB0aGUgaXRlbXMgaW4gdGhlIHRvdXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5Ub3VySXRlbVtdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLml0ZW1zID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlc2NyaXB0aW9uIG9mIHRoZSB0b3VyXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJ2aWNlIHRoZSB0b3VyIGJlbG9uZ3MgdG8uXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBmb2xkZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmZvbGRlciA9IGZvbGRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgaXRlbXMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gaXRlbXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGRlc2NyaXB0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2aWNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgfVxuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZSBvZiBsYWJlbCB0byBkaXNwbGF5IGZvciBhc3NvY2lhdGlvbnMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXNzb2NpYXRpb25zXG4gICAgICovXG4gICAgRVZXRUIyLmFzc29jaWF0aW9uTGFiZWwgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAtMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDdXN0b20gRm9udFxuICAgICAgICAgKi9cbiAgICAgICAgY3VzdG9tRm9udDogMVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZSBvZiBvdmVybGF5IHN0eWxlIGZvciBhc3NvY2lhdGlvbnMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXNzb2NpYXRpb25zXG4gICAgICovXG4gICAgRVZXRUIyLm92ZXJsYXlTdHlsZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogUGVyc2lzdGVudFxuICAgICAgICAgKi9cbiAgICAgICAgcGVyc2lzdGVudDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhvdmVyXG4gICAgICAgICAqL1xuICAgICAgICBob3ZlcjogMVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYXZhaWxhYmxlIGRpc3BsYXkgcG9zaXRpb25zIGZvciBhc3NvY2lhdGlvbnMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXNzb2NpYXRpb25zXG4gICAgICovXG4gICAgRVZXRUIyLm92ZXJsYXlQb3NpdGlvbiA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJpZ2h0XG4gICAgICAgICAqL1xuICAgICAgICByaWdodDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExlZnRcbiAgICAgICAgICovXG4gICAgICAgIGxlZnQ6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb3BcbiAgICAgICAgICovXG4gICAgICAgIHRvcDogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvdHRvbVxuICAgICAgICAgKi9cbiAgICAgICAgYm90dG9tOiA0XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSB0eXBlcyBvZiBhc3NvY2lhdGlvbiBpdGVtcyBhdmFpbGFibGUuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQXNzb2NpYXRpb25zXG4gICAgICovXG4gICAgRVZXRUIyLmFzc29jaWF0aW9uVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWNvcmQgdmlkZW9cbiAgICAgICAgICovXG4gICAgICAgIHJlY29yZFZpZGVvOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogVmlkZW8gb3V0cHV0XG4gICAgICAgICAqL1xuICAgICAgICB2aWRlb091dHB1dDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1ZGlvIGlucHV0XG4gICAgICAgICAqL1xuICAgICAgICBhdWRpb0lucHV0OiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXVkaW8gb3V0cHV0XG4gICAgICAgICAqL1xuICAgICAgICBhdWRpb091dHB1dDogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbCBwb3J0XG4gICAgICAgICAqL1xuICAgICAgICBzZXJpYWxQb3J0OiA1LFxuICAgICAgICAvKipcbiAgICAgICAgICogSW5wdXQgdHJpZ2dlclxuICAgICAgICAgKi9cbiAgICAgICAgaW5wdXRUcmlnZ2VyOiA2LFxuICAgICAgICAvKipcbiAgICAgICAgICogT3V0cHV0IHRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIG91dHB1dFRyaWdnZXI6IDcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTb2Z0IHRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIHNvZnRUcmlnZ2VyOiA4LFxuICAgICAgICAvKipcbiAgICAgICAgICogQW5hbHl0aWNzXG4gICAgICAgICAqL1xuICAgICAgICBhbmFseXRpY3M6IDksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgICAgICovXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25zOiAxMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpZ2l0YWwgUFRaXG4gICAgICAgICAqL1xuICAgICAgICBkaWdpdGFsUHR6OiAxMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlcGxheVxuICAgICAgICAgKi9cbiAgICAgICAgcmVwbGF5OiAxMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1dG8tZXhwb3J0XG4gICAgICAgICAqL1xuICAgICAgICBhdXRvRXhwb3J0OiAxMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1dG8tZm9jdXNcbiAgICAgICAgICovXG4gICAgICAgIGF1dG9Gb2N1czogMTQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdXNwZWN0IHRyYWNraW5nXG4gICAgICAgICAqL1xuICAgICAgICBzdXNwZWN0VHJhY2tpbmc6IDE1XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBkaWZmZXJlbnQgdHlwZXMgb2YgUFRaIGFzc29jaWF0aW9ucy4gUmV0dXJuZWQgYXMge0BsaW5rIEVWV0VCMi5Bc3NvY2lhdGlvbkl0ZW0uZXh0cmF9IHdoZW5cbiAgICAgKiB0aGUgdHlwZSBvZiB0aGUgYXNzb2NpYXRpb24gaXRlbSBpcyB7QGxpbmsgRVZXRUIyLmFzc29jaWF0aW9uVHlwZS5kaWdpdGFsUHR6fS5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBBc3NvY2lhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuYXNzb2NpYXRpb25QdHpUeXBlID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTWVjaGFuaWNhbCBQVFogcHJlc2V0XG4gICAgICAgICAqL1xuICAgICAgICBtZWNoYW5pY2FsUHJlc2V0OiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlnaXRhbCBQVFogcHJlc2V0XG4gICAgICAgICAqL1xuICAgICAgICBkaWdpdGFsUHJlc2V0OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTGlzdCBtZWNoYW5pY2FsIFBUWiBwcmVzZXRzXG4gICAgICAgICAqL1xuICAgICAgICBsaXN0TWVjaGFuaWNhbFByZXNldHM6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaXN0IGRpZ2l0YWwgUFRaIHByZXNldHNcbiAgICAgICAgICovXG4gICAgICAgIGxpc3REaWdpdGFsUHJlc2V0czogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvZ2dsZSBkaWdpdGFsIFBUWlxuICAgICAgICAgKi9cbiAgICAgICAgdG9nZ2xlRGlnaXRhbFB0ejogNFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGFuIGFzc29jaWF0aW9uIGl0ZW0uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBpZCBvZiB0aGUgaXRlbSAoZS5nLiBjYW1lcmEgaWQsIGF1ZGlvIGlkLCBzb2Z0LXRyaWdnZXIgaWQsIGV0YykuXG4gICAgICogQHBhcmFtIHtFVldFQjIuYXNzb2NpYXRpb25UeXBlfSBbdHlwZT1FVldFQjIuYXNzb2NpYXRpb25UeXBlLm5vbmVdIFRoZSB0eXBlIG9mIHRoZSBpdGVtIGluIHRoZSBhc3NvY2lhdGlvbi5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3Bvc2l0aW9uPTBdIFplcm8tYmFzZWQgaW5kZXggdG8gZXhwbGljaXRseSBzcGVjaWZ5IHRoZSBpdGVtIGluIGFuIGFzc29jaWF0aW9uXG4gICAgICogcmVsYXRpdmUgdG8gb3RoZXIgaXRlbXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc3RhdHVzT25seT10cnVlXSBXaGV0aGVyIHRoZSBhc3NvY2lhdGlvbiBpdGVtIGlzIGZvciByZXBvcnRpbmcgc3RhdHVzIG9ubHkgb3JcbiAgICAgKiB3aGV0aGVyIGl0IHJlcHJlc2VudHMgYSB0b2dnbGUgaXRlbS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2V4dHJhPW51bGxdIElmIHRoZSBpZCBpcyBub3QgZW5vdWdoIHRvIHNwZWNpZnkgdGhlIHNwZWNpZmljIGFzc29jaWF0aW9uIGl0ZW0uXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IEFzc29jaWF0aW9uc1xuICAgICAqL1xuICAgIEVWV0VCMi5Bc3NvY2lhdGlvbkl0ZW0gPSBmdW5jdGlvbihpZCwgdHlwZSwgcG9zaXRpb24sIHN0YXR1c09ubHksIGV4dHJhKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBpZCBvZiB0aGUgaXRlbSAoZS5nLiBjYW1lcmEgaWQsIGF1ZGlvIGlkLCBzb2Z0LXRyaWdnZXIgaWQsIGV0YykuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHRoZSBpdGVtIGluIHRoZSBhc3NvY2lhdGlvbi5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5hc3NvY2lhdGlvblR5cGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIuYXNzb2NpYXRpb25UeXBlLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFplcm8tYmFzZWQgaW5kZXggdG8gZXhwbGljaXRseSBzcGVjaWZ5IHRoZSBpdGVtIGluIGFuIGFzc29jaWF0aW9uIHJlbGF0aXZlIHRvIG90aGVyIGl0ZW1zLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGFzc29jaWF0aW9uIGl0ZW0gaXMgZm9yIHJlcG9ydGluZyBzdGF0dXMgb25seSBvciB3aGV0aGVyIGl0IHJlcHJlc2VudHMgYSB0b2dnbGUgaXRlbS5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN0YXR1c09ubHkgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSWYgdGhlIGlkIGlzIG5vdCBlbm91Z2ggdG8gc3BlY2lmeSB0aGUgc3BlY2lmaWMgYXNzb2NpYXRpb24gaXRlbS5cbiAgICAgICAgICogQHR5cGUge251bWJlcnxudWxsfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHRyYSA9IG51bGw7XG5cbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBvc2l0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihzdGF0dXNPbmx5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzT25seSA9IHN0YXR1c09ubHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZXh0cmEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHRyYSA9IGV4dHJhO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgY2FtZXJhIGFzc29jaWF0aW9uIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgaW5zdGFuY2UgdGhlIGFzc29jaWF0aW9uIGJlbG9uZ3MgdG8uXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhfSBjYW1lcmEgVGhlIGNhbWVyYSB0byB3aGljaCB0aGUgYXNzb2NpYXRpb24gYmVsb25ncyB0by5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2d1aWQ9JyddIFRoZSB1bmlxdWUgYXNzb2NpYXRpb24gSUQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQXNzb2NpYXRpb25JdGVtW119IFtpdGVtcz1bXV0gVGhlIGxpc3Qgb2YgaXRlbXMgaW4gdGhpcyBhc3NvY2lhdGlvbi5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5hc3NvY2lhdGlvbkxhYmVsfSBbbGFiZWw9RVZXRUIyLmFzc29jaWF0aW9uTGFiZWwudW5rbm93bl0gVGhlIGFzc29jaWF0aW9uIGxhYmVsIHR5cGUuXG4gICAgICogQHBhcmFtIHtFVldFQjIub3ZlcmxheVN0eWxlfSBbc3R5bGU9RVZXRUIyLm92ZXJsYXlTdHlsZS51bmtub3duXSBUaGUgb3ZlcmxheSBzdHlsZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5vdmVybGF5UG9zaXRpb259IFtwb3NpdGlvbj1FVldFQjIub3ZlcmxheVBvc2l0aW9uLnVua25vd25dIFRoZSBwb3NpdGlvbiBvZiB0aGUgb3ZlcmxheS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5mb250Q29sb3J9IFtiZ0NvbG9yPUVWV0VCMi5mb250Q29sb3IudW5rbm93bl0gVGhlIG92ZXJsYXkgYmFja2dyb3VuZCBjb2xvci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW29wYWNpdHk9NTBdIFRoZSBvcGFjaXR5IG9mIHRoZSBvdmVybGF5LCBmcm9tIDAgLSAxMDAgd2l0aCAwIGJlaW5nIHRyYW5zcGFyZW50LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkZvbnRJbmZvfSBbZm9udEluZm89bmV3IEVWV0VCMi5Gb250SW5mbygpXSBUaGUgZm9udCBpbmZvcm1hdGlvbiBmb3IgdGhlIG92ZXJsYXkuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IEFzc29jaWF0aW9uc1xuICAgICAqL1xuICAgIEVWV0VCMi5Bc3NvY2lhdGlvbiA9IGZ1bmN0aW9uKHNlcnZlciwgY2FtZXJhLCBndWlkLCBpdGVtcywgbGFiZWwsIHN0eWxlLCBwb3NpdGlvbiwgYmdDb2xvciwgb3BhY2l0eSwgZm9udEluZm8pIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBpbnN0YW5jZSB0aGUgYXNzb2NpYXRpb24gYmVsb25ncyB0by5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSB0byB3aGljaCB0aGUgYXNzb2NpYXRpb24gYmVsb25ncyB0by5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5DYW1lcmF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbWVyYSA9IGNhbWVyYTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVuaXF1ZSBhc3NvY2lhdGlvbiBJRC5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3VpZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGlzdCBvZiBpdGVtcyBpbiB0aGlzIGFzc29jaWF0aW9uLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkFzc29jaWF0aW9uSXRlbVtdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXNzb2NpYXRpb24gbGFiZWwgdHlwZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5hc3NvY2lhdGlvbkxhYmVsfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5sYWJlbCA9IEVWV0VCMi5hc3NvY2lhdGlvbkxhYmVsLnVua25vd247XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBvdmVybGF5IHN0eWxlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLm92ZXJsYXlTdHlsZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3R5bGUgPSBFVldFQjIub3ZlcmxheVN0eWxlLnVua25vd247XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwb3NpdGlvbiBvZiB0aGUgb3ZlcmxheS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5vdmVybGF5UG9zaXRpb259XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gRVZXRUIyLm92ZXJsYXlQb3NpdGlvbi51bmtub3duO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgb3ZlcmxheSBiYWNrZ3JvdW5kIGNvbG9yLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmZvbnRDb2xvcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYmdDb2xvciA9IEVWV0VCMi5mb250Q29sb3IudW5rbm93bjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG9wYWNpdHkgb2YgdGhlIG92ZXJsYXksIGZyb20gMCAtIDEwMCB3aXRoIDAgYmVpbmcgdHJhbnNwYXJlbnQuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9wYWNpdHkgPSA1MDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgaW5mb3JtYXRpb24gZm9yIHRoZSBvdmVybGF5LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkZvbnRJbmZvfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250SW5mbyA9IG5ldyBFVldFQjIuRm9udEluZm8oKTtcblxuICAgICAgICBpZihndWlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZ3VpZCA9IGd1aWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaXRlbXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pdGVtcyA9IGl0ZW1zO1xuICAgICAgICB9XG4gICAgICAgIGlmKGxhYmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDtcbiAgICAgICAgfVxuICAgICAgICBpZihzdHlsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0eWxlID0gc3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYocG9zaXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmKGJnQ29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5iZ0NvbG9yID0gYmdDb2xvcjtcbiAgICAgICAgfVxuICAgICAgICBpZihvcGFjaXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMub3BhY2l0eSA9IG9wYWNpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZm9udEluZm8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mb250SW5mbyA9IGZvbnRJbmZvO1xuICAgICAgICB9XG4gICAgfTtcblxufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY29ubmVjdGlvbiBzdGF0dXMgb2YgYW4gc2VjdXJpdHkgaW50ZWdyYXRpb25zIGRldmljZVxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlY3VyaXR5IEludGVncmF0aW9uc1xuICAgICAqL1xuICAgIEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0RldmljZUNvbm5lY3Rpb25TdGF0dXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCYWQgbWVzc2FnZSBmb3JtYXRcbiAgICAgICAgICovXG4gICAgICAgIGJhZE1lc3NhZ2VGb3JtYXQ6IC0xMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbW1hbmQgbm90IHN1cHBvcnRlZFxuICAgICAgICAgKi9cbiAgICAgICAgY29tbWFuZE5vdFN1cHBvcnRlZDogLTEyLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgZXJyb3JcbiAgICAgICAgICovXG4gICAgICAgIGludGVybmFsRXJyb3I6IC0xMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZXJhdG9yIGVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBvcGVyYXRvckVycm9yOiAtNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbW1hbmQgZmFpbGVkXG4gICAgICAgICAqL1xuICAgICAgICBjb21tYW5kRmFpbGVkOiAtNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1dGhlbnRpY2F0aW9uIGVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBhdXRoZW50aWNhdGlvbkVycm9yOiAtNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbm5lY3Rpb24gZXJyb3JcbiAgICAgICAgICovXG4gICAgICAgIGNvbm5lY3Rpb25FcnJvcjogLTMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmluaXRpYWxpemVkXG4gICAgICAgICAqL1xuICAgICAgICB1bmluaXRpYWxpemVkOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm90IGNvbm5lY3RlZFxuICAgICAgICAgKi9cbiAgICAgICAgbm90Q29ubmVjdGVkOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ29ubmVjdGluZ1xuICAgICAgICAgKi9cbiAgICAgICAgY29ubmVjdGluZzogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbm5lY3Rpb24gc3VjY2Vzc2Z1bFxuICAgICAgICAgKi9cbiAgICAgICAgY29ubmVjdGlvblN1Y2Nlc3NmdWw6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdXRoZW50aWNhdGluZ1xuICAgICAgICAgKi9cbiAgICAgICAgYXV0aGVudGljYXRpbmc6IDQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb21tYW5kIHJlcXVlc3RcbiAgICAgICAgICovXG4gICAgICAgIGNvbW1hbmRSZXF1ZXN0OiA1XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVGhlIGFjdGlvbnMgdGhhdCBjYW4gYmUgYXBwbGllZCB0byBhbiBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlIHNlbnNvci5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JBY3Rpb24gPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTG9ja1xuICAgICAgICAgKi9cbiAgICAgICAgbG9jazogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVubG9ja1xuICAgICAgICAgKi9cbiAgICAgICAgdW5sb2NrOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXJtXG4gICAgICAgICAqL1xuICAgICAgICBhcm06IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNhcm1cbiAgICAgICAgICovXG4gICAgICAgIGRpc2FybTogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFjdGl2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBhY3RpdmF0ZTogNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlYWN0aXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIGRlYWN0aXZhdGU6IDYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmFibGUgcmVhZGVyXG4gICAgICAgICAqL1xuICAgICAgICBlbmFibGVSZWFkZXI6IDcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNhYmxlIHJlYWRlclxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYWJsZVJlYWRlcjogOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhcmQgcHJlc2VudGVkXG4gICAgICAgICAqL1xuICAgICAgICBjYXJkUHJlc2VudGVkOiA5LFxuICAgICAgICAvKipcbiAgICAgICAgICogSW5wdXQgc3VwZXJ2aXNlZFxuICAgICAgICAgKi9cbiAgICAgICAgaW5wdXRTdXBlcnZpc2VkOiAxMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElucHV0IHVuc3VwZXJ2aXNlZFxuICAgICAgICAgKi9cbiAgICAgICAgaW5wdXRVbnN1cGVydmlzZWQ6IDExLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW5wdXQgbm9ybWFsXG4gICAgICAgICAqL1xuICAgICAgICBpbnB1dE5vcm1hbDogMTIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcm0gQXdheVxuICAgICAgICAgKi9cbiAgICAgICAgYXJtQXdheTogMTMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcm0gU3RheVxuICAgICAgICAgKi9cbiAgICAgICAgYXJtU3RheTogMTQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcm0gTm8gZW50cnkgZGVsYXlcbiAgICAgICAgICovXG4gICAgICAgIGFybU5vRW50cnlEZWxheTogMTVcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIHR5cGVzIG9mIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2Ugc2Vuc29ycy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JUeXBlID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogLTEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWxheVxuICAgICAgICAgKi9cbiAgICAgICAgcmVsYXk6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnB1dFxuICAgICAgICAgKi9cbiAgICAgICAgaW5wdXQ6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2NrXG4gICAgICAgICAqL1xuICAgICAgICBsb2NrOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogUmV4XG4gICAgICAgICAqL1xuICAgICAgICByZXg6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWFkZXJcbiAgICAgICAgICovXG4gICAgICAgIHJlYWRlcjogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERvb3JcbiAgICAgICAgICovXG4gICAgICAgIGRvb3I6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYXJ0aXRpb25cbiAgICAgICAgICovXG4gICAgICAgIHBhcnRpdGlvbjogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFpvbmVcbiAgICAgICAgICovXG4gICAgICAgIHpvbmU6IDdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGF2YWlsYWJsZSBkaXJlY3Rpb25zIG9mIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2Ugc2Vuc29ycy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JEaXJlY3Rpb24gPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAtMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluXG4gICAgICAgICAqL1xuICAgICAgICBkaXJlY3Rpb25JbjogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE91dFxuICAgICAgICAgKi9cbiAgICAgICAgZGlyZWN0aW9uT3V0OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW4tT3V0XG4gICAgICAgICAqL1xuICAgICAgICBkaXJlY3Rpb25Jbk91dDogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYXZhaWxhYmxlIHN0YXRlcyBvZiBhbiBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlIHNlbnNvci5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JTdGF0ZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludmFsaWRcbiAgICAgICAgICovXG4gICAgICAgIGludmFsaWQ6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnB1dCBub3JtYWxcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0Tm9ybWFsOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW5wdXQgQWxhcm1lZFxuICAgICAgICAgKi9cbiAgICAgICAgaW5wdXRBbGFybWVkOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogTG9ja2VkXG4gICAgICAgICAqL1xuICAgICAgICBsb2NrZWQ6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmxvY2tlZFxuICAgICAgICAgKi9cbiAgICAgICAgdW5sb2NrZWQ6IDQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcm1lZFxuICAgICAgICAgKi9cbiAgICAgICAgYXJtZWQ6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNhcm1lZFxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYXJtZWQ6IDYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBY3RpdmF0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGFjdGl2YXRlZDogNyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlYWN0aXZhdGVkXG4gICAgICAgICAqL1xuICAgICAgICBkZWFjdGl2YXRlZDogOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlYWRlciBlbmFibGVkXG4gICAgICAgICAqL1xuICAgICAgICByZWFkZXJFbmFibGVkOiA5LFxuICAgICAgICAvKipcbiAgICAgICAgICogUmVhZGVyIGRpc2FibGVkXG4gICAgICAgICAqL1xuICAgICAgICByZWFkZXJEaXNhYmxlZDogMTAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVuXG4gICAgICAgICAqL1xuICAgICAgICBvcGVuOiAxMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW4gdG9vIGxvbmdcbiAgICAgICAgICovXG4gICAgICAgIG9wZW5Ub29Mb25nOiAxMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsb3NlZFxuICAgICAgICAgKi9cbiAgICAgICAgY2xvc2VkOiAxMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERvb3IgZm9yY2VkIG9wZW5cbiAgICAgICAgICovXG4gICAgICAgIGRvb3JGb3JjZWRPcGVuOiAxNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFjY2VzcyBHcmFudGVkXG4gICAgICAgICAqL1xuICAgICAgICBhY2Nlc3NHcmFudGVkOiAxNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFjY2VzcyBEZW5pZWRcbiAgICAgICAgICovXG4gICAgICAgIGFjY2Vzc0RlbmllZDogMTYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXggR3JhbnRlZFxuICAgICAgICAgKi9cbiAgICAgICAgcmV4R3JhbnRlZDogMTcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXggRGVuaWVkXG4gICAgICAgICAqL1xuICAgICAgICByZXhEZW5pZWQ6IDE4LFxuICAgICAgICAvKipcbiAgICAgICAgICogTG9jayBmYWlsdXJlXG4gICAgICAgICAqL1xuICAgICAgICBsb2NrRmFpbHVyZTogMTksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnB1dCBzdXBlcnZpc2VkXG4gICAgICAgICAqL1xuICAgICAgICBpbnB1dFN1cGVydmlzZWQ6IDIwLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW5wdXQgbm90IHN1cGVydmlzZWRcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0Tm90U3VwZXJ2aXNlZDogMjEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYXJ0aXRpb24gcHJlLWFsYXJtXG4gICAgICAgICAqL1xuICAgICAgICBwYXJ0aXRpb25QcmVBbGFybTogMjIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYXJ0aXRpb24gcHJlLWRpc2FybVxuICAgICAgICAgKi9cbiAgICAgICAgcGFydGl0aW9uUHJlRGlzYXJtOiAyMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnRpdGlvbiBhbGFybVxuICAgICAgICAgKi9cbiAgICAgICAgcGFydGl0aW9uQWxhcm06IDI0LFxuICAgICAgICAvKipcbiAgICAgICAgICogUGFydGl0aW9uIGFybWVkIHN0YXlcbiAgICAgICAgICovXG4gICAgICAgIHBhcnRpdGlvbkFybWVkU3RheTogMjUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQYXJ0aXRpb24gYXJtZWQgYXdheVxuICAgICAgICAgKi9cbiAgICAgICAgcGFydGl0aW9uQXJtZWRBd2F5OiAyNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnRpdGlvbiBhcm1lZCBubyBlbnRyeSBkZWxheVxuICAgICAgICAgKi9cbiAgICAgICAgcGFydGl0aW9uQXJtZWROb0VudHJ5RGVsYXk6IDI3LFxuICAgICAgICAvKipcbiAgICAgICAgICogUGFydGl0aW9uIG5vdCByZWFkeVxuICAgICAgICAgKi9cbiAgICAgICAgcGFydGl0aW9uTm90UmVhZHk6IDI4LFxuICAgICAgICAvKipcbiAgICAgICAgICogWm9uZSBvcGVuXG4gICAgICAgICAqL1xuICAgICAgICB6b25lT3BlbjogMjksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBab25lIGFsYXJtXG4gICAgICAgICAqL1xuICAgICAgICB6b25lQWxhcm06IDMwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm90IG1vbml0b3JpbmdcbiAgICAgICAgICovXG4gICAgICAgIG5vdE1vbml0b3Jpbmc6IDk5OCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVycm9yXG4gICAgICAgICAqL1xuICAgICAgICBlcnJvcjogOTk5XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBhdmFpbGFibGUgYWxhcm0gc3RhdGVzIGZvciBhbiBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlIHNlbnNvci5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JBbGFybSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFsZXJ0XG4gICAgICAgICAqL1xuICAgICAgICBhbGVydDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFsYXJtXG4gICAgICAgICAqL1xuICAgICAgICBhbGFybTogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYXZhaWxhYmxlIGF1dGhlbnRpY2F0aW9uIHR5cGVzIGZvciBhIHNlY3VyaXR5IGludGVncmF0aW9uIGRldmljZS5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNBdXRoVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVc2VybmFtZSBhbmQgcGFzc3dvcmRcbiAgICAgICAgICovXG4gICAgICAgIHVzZXJQYXNzOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogQWNjZXNzIGNvZGVcbiAgICAgICAgICovXG4gICAgICAgIGFjY2Vzc0NvZGU6IDJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGVycm9yIGNvZGVzIGZvciBmYWlsaW5nIHNlbnNvciBhY3Rpb25zLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlY3VyaXR5IEludGVncmF0aW9uc1xuICAgICAqL1xuICAgIEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc1NlbnNvckVycm9yVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBlcm1pc3Npb24gZXJyb3JcbiAgICAgICAgICovXG4gICAgICAgIHBlcm1pc3Npb25FcnJvcjogLTEwLFxuICAgICAgICAvKipcbiAgICAgICAgICogSW52YWxpZCBjb21tYW5kXG4gICAgICAgICAqL1xuICAgICAgICBpbnZhbGlkQ29tbWFuZDogLTksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb21tYW5kIHRpbWVvdXRcbiAgICAgICAgICovXG4gICAgICAgIGNvbW1hbmRUaW1lb3V0OiAtOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludmFsaWQgc2Vzc2lvblxuICAgICAgICAgKi9cbiAgICAgICAgaW52YWxpZFNlc3Npb246IC03LFxuICAgICAgICAvKipcbiAgICAgICAgICogT3RoZXJcbiAgICAgICAgICovXG4gICAgICAgIG90aGVyOiAtNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbW1hbmQgT0tcbiAgICAgICAgICovXG4gICAgICAgIGNvbW1hbmRPazogMFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIHRyYWRpdGlvbmFsIHR5cGUgY3JlZGVudGlhbHMgZm9yIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2VzLiAgU2VlXG4gICAgICoge0BsaW5rIEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZS5sb2dpbn0gZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdXNlcm5hbWUgVGhlIHVzZXJuYW1lIGZvciB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFzc3dvcmQ9bnVsbF0gVGhlIHBhc3N3b3JkIGZvciB0aGUgZGV2aWNlLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VDcmVkc1RyYWRpdGlvbmFsID0gZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXV0aCB0eXBlIGltcGxlbWVudGVkIGJ5IHRoaXMgY3JlZGVudGlhbHMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNBdXRoVHlwZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXV0aFR5cGUgPSBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNBdXRoVHlwZS51c2VyUGFzcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVzZXJuYW1lIGZvciB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcGFzc3dvcmQgZm9yIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd8bnVsbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGFzc3dvcmQgPSBudWxsO1xuXG4gICAgICAgIGlmKHBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGFjY2VzcyBjb2RlIHR5cGUgY3JlZGVudGlhbHMgZm9yIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2VzLiAgU2VlXG4gICAgICoge0BsaW5rIEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZS5sb2dpbn0gZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYWNjZXNzQ29kZSBUaGUgYWNjZXNzIGNvZGUgZm9yIHRoZSBkZXZpY2UuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlY3VyaXR5IEludGVncmF0aW9uc1xuICAgICAqL1xuICAgIEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZUNyZWRzQWNjZXNzQ29kZSA9IGZ1bmN0aW9uKGFjY2Vzc0NvZGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhdXRoIHR5cGUgaW1wbGVtZW50ZWQgYnkgdGhpcyBjcmVkZW50aWFscy5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRoVHlwZSA9IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlLmFjY2Vzc0NvZGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhY2Nlc3MgY29kZSBmb3IgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWNjZXNzQ29kZSA9IGFjY2Vzc0NvZGU7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgYW4gc2VjdXJpdHkgaW50ZWdyYXRpb25zIGRldmljZVxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBUaGUgSUQgb2YgdGhlIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPVwiXCJdIFRoZSBuYW1lIG9mIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtob3N0PVwiXCJdIFRoZSBob3N0IG9mIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtwb3J0PTBdIFRoZSBwb3J0IG9mIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt0eXBlPVwiXCJdIFRoZSBtYW51ZmFjdHVyZXIgb2YgdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtlbmFibGVkPWZhbHNlXSBXaGV0aGVyIHRoZSBkZXZpY2UgaXMgZW5hYmxlZC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0RldmljZUNvbm5lY3Rpb25TdGF0dXN9IFtjb25uZWN0aW9uU3RhdHVzPUVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0RldmljZUNvbm5lY3Rpb25TdGF0dXMudW5pbml0aWFsaXplZF1cbiAgICAgKiBUaGUgY29ubmVjdGlvbiBzdGF0dXMgb2YgdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Zpcm13YXJlPVwiXCJdIFRoZSBmaXJtd2FyZSB2ZXJzaW9uIG9mIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZXJpYWw9XCJcIl0gVGhlIHNlcmlhbCBvZiB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdXNlcj1cIlwiXSBUaGUgdXNlcm5hbWUgdXNlZCB0byBjb25maWd1cmUgdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlfSBbYXV0aFR5cGU9RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zQXV0aFR5cGUudXNlclBhc3NdIFRoZVxuICAgICAqIGF1dGhlbnRpY2F0aW9uIHR5cGUgdXNlZCBieSB0aGUgZGV2aWNlLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2UgPSBmdW5jdGlvbihzZXJ2ZXIsIGlkLCBuYW1lLCBob3N0LCBwb3J0LCB0eXBlLCBlbmFibGVkLCBjb25uZWN0aW9uU3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcm13YXJlLCBzZXJpYWwsIHVzZXIsIGF1dGhUeXBlKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZWN1cml0eSBpbnRlZ3JhdGlvbnMgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIHNlY3VyaXR5IGludGVncmF0aW9ucyBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBob3N0IG9mIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBcIlwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaG9zdCBvZiB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ob3N0ID0gXCJcIjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvcnQgb2YgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtYW51ZmFjdHVyZXIgb2YgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwiXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGRldmljZSBpcyBlbmFibGVkLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY29ubmVjdGlvbiBzdGF0dXMgb2YgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0RldmljZUNvbm5lY3Rpb25TdGF0dXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMgPSBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VDb25uZWN0aW9uU3RhdHVzLnVuaW5pdGlhbGl6ZWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmaXJtd2FyZSB2ZXJzaW9uIG9mIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZpcm13YXJlID0gXCJcIjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcmlhbCBvZiB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJpYWwgPSBcIlwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgdXNlZCB0byBjb25maWd1cmUgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlciA9IFwiXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0b2tlbiB1c2VkIHRvIHBlcmZvcm0gc2Vuc29yIGFjdGlvbnMsIHVzZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yLnBlcmZvcm1BY3Rpb259LlxuICAgICAgICAgKiBUaGlzIHRva2VuIGlzIGdlbmVyYXRlZCBieSB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlLmxvZ2lufSBhbmQgc2hvdWxkIG5vdCBiZSBzZXQgbWFudWFsbHkuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd8bnVsbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9rZW4gPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZXhwaXJhdGlvbiBkYXRlIG9mIHRoZSB0b2tlbi5cbiAgICAgICAgICogQHR5cGUge0RhdGV8bnVsbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9rZW5FeHBpcmF0aW9uID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF1dGhlbnRpY2F0aW9uIHR5cGUgdXNlZCBieSB0aGlzIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hdXRoVHlwZSA9IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlLnVzZXJQYXNzO1xuXG4gICAgICAgIGlmKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihob3N0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdCA9IGhvc3Q7XG4gICAgICAgIH1cbiAgICAgICAgaWYocG9ydCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihlbmFibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZW5hYmxlZCA9IGVuYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29ubmVjdGlvblN0YXR1cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMgPSBjb25uZWN0aW9uU3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGZpcm13YXJlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmlybXdhcmUgPSBmaXJtd2FyZTtcbiAgICAgICAgfVxuICAgICAgICBpZihzZXJpYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJpYWwgPSBzZXJpYWw7XG4gICAgICAgIH1cbiAgICAgICAgaWYodXNlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgICB9XG4gICAgICAgIGlmKGF1dGhUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXV0aFR5cGUgPSBhdXRoVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGxpc3Qgb2Ygc2Vuc29ycyBmb3IgdGhpcyBkZXZpY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yfSBvYmplY3RzIGRldGFpbGluZyBhbGwgb2YgdGhlIHNlbnNvcnMgYXNzb2NpYXRlZCB3aXRoIHRoZVxuICAgICAgICAgKiAgZGV2aWNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTZW5zb3JzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZW5kIHRoZSBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcblxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgdGhlIGRldmljZXNcbiAgICAgICAgICAgICAgICB2YXIgc2Vuc29ycyA9ICQubWFwKGRhdGEuc2Vuc29ycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gZWxlbWVudC5zdGF0dXNUaW1lc3RhbXAgP1xuICAgICAgICAgICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwuSUVURjJEYXRlKGVsZW1lbnQuc3RhdHVzVGltZXN0YW1wKSA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyc2lzdGVkU3RhdHVzZXMgPSBlbGVtZW50LnBlcnNpc3RlZFN0YXR1cyA/IGVsZW1lbnQucGVyc2lzdGVkU3RhdHVzLm1hcChmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnN0YXR1c1RpbWVzdGFtcCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShvYmouc3RhdHVzVGltZXN0YW1wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICAgICAgICAgIH0pIDogdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yKGRldmljZSwgZWxlbWVudC5zZW5zb3JJZCwgZWxlbWVudC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC50eXBlLCBlbGVtZW50LmRpcmVjdGlvbiwgZWxlbWVudC5hdmFpbGFibGVBY3Rpb25zLCBlbGVtZW50LmlucHV0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZGVmYXVsdEFjdGlvblRpbWVvdXQsIGVsZW1lbnQubWF4QWN0aW9uVGltZW91dCwgZWxlbWVudC5zdGF0dXMsIGVsZW1lbnQuYWxhcm0sXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXAsIGVsZW1lbnQuc3RhdHVzTWVzc2FnZSwgcGVyc2lzdGVkU3RhdHVzZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzZW5zb3JzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBkZXZpY2Uuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZWN1cml0eUludGVncmF0aW9uc0RldmljZVNlbnNvcnMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBkZXZpY2Uuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlOiBkZXZpY2UuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihkZXZpY2Uuc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogTG9ncyBpbnRvIHRoZSBkZXZpY2UsIHJldHJpZXZpbmcgYSB0b2tlbiBmb3IgdXNlIGluXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VTZW5zb3IucGVyZm9ybUFjdGlvbn0uIE5vdGU6IFRoZSB3ZWIgc2VydmljZSB3aWxsIHN0b3JlIHRoZVxuICAgICAgICAgKiBwcm92aWRlZCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgYW5kIGFzc29jaWF0ZSB0aG9zZSB3aXRoIHRoZSByZXR1cm5lZCB0b2tlbiBmb3IgdGhlIGR1cmF0aW9uIG9mIHRoZVxuICAgICAgICAgKiBleHBpcmF0aW9uIHBlcmlvZCBwcm92aWRlZCBvciB1bnRpbCBhIHtAbGluayBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2V9IGlzIHBlcmZvcm1lZC4gIEFzIHN1Y2gsXG4gICAgICAgICAqIHRoaXMgdG9rZW4gc2hvdWxkIGJlIHByb3RlY3RlZCBmcm9tIHVuYXV0aG9yaXplZCB1c2UuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UsIHRoZSBnZW5lcmF0ZWQgdG9rZW4gZm9yIHVzZVxuICAgICAgICAgKiAgd2l0aCB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yLnBlcmZvcm1BY3Rpb259LCB0aGUgZXhwaXJhdGlvbiBkYXRlIG9mIHRoZSB0b2tlbiwgYW5kXG4gICAgICAgICAqICBhbiBhcnJheSBvZiB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yfSBJRHMgdGhhdCB0aGUgbG9nZ2VkIGluIHVzZXIgY2FuIGFjY2Vzcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VDcmVkc1RyYWRpdGlvbmFsfEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZUNyZWRzQWNjZXNzQ29kZX0gY3JlZGVudGlhbHMgVGhlIGNyZWRlbnRpYWxzIHRvIGxvZyBpbnRvIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RGF0ZX0gZXhwaXJhdGlvbiBUaGUgZGF0ZSBhdCB3aGljaCB0aGUgZ2VuZXJhdGVkIHRva2VuIHNob3VsZCBleHBpcmUuICBOb3RlOiB2YWx1ZXMgbW9yZVxuICAgICAgICAgKiB0aGFuIDMwIGRheXMgaW4gdGhlIGZ1dHVyZSB3aWxsIGJlIG5vcm1hbGl6ZWQgdG8gMzAgZGF5cy4gIEJlIHN1cmUgdG8gY2hlY2sgdGhlIHJlc3BvbnNlIHZhbHVlXG4gICAgICAgICAqIGZvciB0aGUgYWN0dWFsIGV4cGlyYXRpb24gZGF0ZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubG9naW4gPSBmdW5jdGlvbihjYWxsYmFjaywgY3JlZGVudGlhbHMsIGV4cGlyYXRpb24pIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZW5kIHRoZSBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcblxuICAgICAgICAgICAgICAgIGRldmljZS50b2tlbiA9IGRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgZGV2aWNlLnRva2VuRXhwaXJhdGlvbiA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShkYXRhLmV4cGlyYXRpb24pO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkZXZpY2UudG9rZW4sIGRldmljZS50b2tlbkV4cGlyYXRpb24sIGRhdGEuc2Vuc29ycyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBkZXZpY2Uuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBkZXZpY2U6IGRldmljZS5pZCxcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogY3JlZGVudGlhbHMudXNlcm5hbWUsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGNyZWRlbnRpYWxzLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIGV4cGlyYXRpb246IEVWV0VCMi51dGlsLkRhdGUySUVURihleHBpcmF0aW9uKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoY3JlZGVudGlhbHMuYXV0aFR5cGUgPT09IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlLnVzZXJQYXNzKSB7XG4gICAgICAgICAgICAgICAgZGF0YS51c2VybmFtZSA9IGNyZWRlbnRpYWxzLnVzZXJuYW1lO1xuICAgICAgICAgICAgICAgIGRhdGEucGFzc3dvcmQgPSBjcmVkZW50aWFscy5wYXNzd29yZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoY3JlZGVudGlhbHMuYXV0aFR5cGUgPT09IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlLmFjY2Vzc0NvZGUpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmFjY2Vzc0NvZGUgPSBjcmVkZW50aWFscy5hY2Nlc3NDb2RlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogZGV2aWNlLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VMb2dpbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoZGV2aWNlLnNlcnZlci5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyB3aGV0aGVyIHRoZSBkZXZpY2UgaXMgY3VycmVudGx5IGxvZ2dlZCBpbi5cbiAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZGV2aWNlIGlzIGN1cnJlbnRseSBsb2dnZWQgaW4uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuYXV0aFR5cGUgPT09IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc0F1dGhUeXBlLm5vbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMudG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50b2tlbkV4cGlyYXRpb24gPiBuZXcgRGF0ZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2dzIG91dCBvZiB0aGUgZGV2aWNlLiAgTm90ZTogYWZ0ZXIgcGVyZm9ybWluZyB0aGlzIGFjdGlvbiwgdGhlIHRva2VuIGlzIGRlc3Ryb3llZCBhbmQgY2Fubm90IGJlIHVzZWRcbiAgICAgICAgICogYWdhaW4uICBBZGRpdGlvbmFsbHksIGFueSBjYWxscyB0byB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yLnBlcmZvcm1BY3Rpb259IGZvciBzZW5zb3JzXG4gICAgICAgICAqIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRldmljZSB3aWxsIGZhaWwgdW50aWwgYW5vdGhlciBsb2dpbiBjYWxsIGlzIG1hZGUuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgZGV2aWNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2VuZCB0aGUgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGV2aWNlLnRva2VuID0gbnVsbDtcbiAgICAgICAgICAgICAgICBkZXZpY2UudG9rZW5FeHBpcmF0aW9uID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihkZXZpY2UudG9rZW4gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIFwiTm90IGxvZ2dlZCBpbi5cIik7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogZGV2aWNlLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VMb2dpbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IGRldmljZS5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2U6IGRldmljZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgdG9rZW46IGRldmljZS50b2tlblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGRldmljZS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgYW4gc2VjdXJpdHkgaW50ZWdyYXRpb25zIGRldmljZSBzZW5zb3IuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2V9IGRldmljZSBUaGUgc2VjdXJpdHkgaW50ZWdyYXRpb25zIGRldmljZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBzZW5zb3IuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBJRCBvZiB0aGUgc2Vuc29yLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT1cIlwiXSBUaGUgbmFtZSBvZiB0aGUgc2Vuc29yLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yVHlwZX0gW3R5cGU9RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yVHlwZS5ub25lXSBUaGUgdHlwZSBvZiBzZW5zb3IuXG4gICAgICogQHBhcmFtIHtFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JEaXJlY3Rpb259IFtkaXJlY3Rpb249RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yRGlyZWN0aW9uLm5vbmVdIFRoZSBkaXJlY3Rpb25cbiAgICAgKiBvZiB0aGUgc2Vuc29yLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yQWN0aW9uW119IFthdmFpbGFibGVBY3Rpb25zPVtdXSBUaGUgYWN0aW9ucyBhdmFpbGFibGUgdG8gcGVyZm9ybSBieSB0aGUgc2Vuc29yLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyW119IFtpbnB1dHM9W11dIEFzc29jaWF0ZWQge0BsaW5rIEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZVNlbnNvcn0gSURzIGNvbnRhaW5lZCBieSB0aGlzIHNlbnNvci5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2RlZmF1bHRBY3Rpb25UaW1lb3V0PTBdIFRoZSBkZWZhdWx0IHRpbWVvdXQsIGluIHNlY29uZHMsIG9mIHBlcmZvcm1pbmcgYW4gYWN0aW9uLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4QWN0aW9uVGltZW91dD0wXSBUaGUgbWF4aW11bSB0aW1lb3V0LCBpbiBzZWNvbmRzLCBvZiBwZXJmb3JtaW5nIGFuIGFjdGlvbi5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc1NlbnNvclN0YXRlW119IFtzdGF0dXM9W11dIFRoZSBjdXJyZW50IHN0YXRlcyBvZiB0aGUgc2Vuc29yLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yQWxhcm1bXX0gW2FsYXJtPVtdXSBUaGUgY3VycmVudCBhbGFybXMgb2YgdGhlIHNlbnNvci5cbiAgICAgKiBAcGFyYW0ge0RhdGV9IFtzdGF0dXNUaW1lc3RhbXA9bnVsbF0gVGhlIHRpbWVzdGFtcCBvZiB0aGUgbGFzdCBzdGF0dXMgZXZlbnRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0YXR1c01lc3NhZ2U9JyddIFRoZSBzdGF0dXMgbWVzc2FnZSBpZiBhdmFpbGFibGUgKHNwZWNpZmljIHRvIHRoZSBzZW5zb3IgdHlwZSlcbiAgICAgKiBAcGFyYW0ge09iamVjdFtdfSBbcGVyc2lzdGVkU3RhdHVzPVtdXSBUaGUgcGVyc2lzdGVkIHN0YXR1cyBvZiB0aGUgc2Vuc29yLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZWN1cml0eSBJbnRlZ3JhdGlvbnNcbiAgICAgKi9cbiAgICBFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VTZW5zb3IgPSBmdW5jdGlvbihkZXZpY2UsIGlkLCBuYW1lLCB0eXBlLCBkaXJlY3Rpb24sIGF2YWlsYWJsZUFjdGlvbnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRzLCBkZWZhdWx0QWN0aW9uVGltZW91dCwgbWF4QWN0aW9uVGltZW91dCwgc3RhdHVzLCBhbGFybSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUaW1lc3RhbXAsIHN0YXR1c01lc3NhZ2UsIHBlcnNpc3RlZFN0YXR1cykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VjdXJpdHkgaW50ZWdyYXRpb25zIGRldmljZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBzZW5zb3IuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2V9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRldmljZSA9IGRldmljZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBzZW5zb3IuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBzZW5zb3IuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBcIlwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiBzZW5zb3IuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yVHlwZS5ub25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGlyZWN0aW9uIG9mIHRoZSBzZW5zb3IuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JEaXJlY3Rpb259XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IEVWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc1NlbnNvckRpcmVjdGlvbi5ub25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYWN0aW9ucyBhdmFpbGFibGUgdG8gcGVyZm9ybSBieSB0aGUgc2Vuc29yLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yQWN0aW9uW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF2YWlsYWJsZUFjdGlvbnMgPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQXNzb2NpYXRlZCB7QGxpbmsgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlU2Vuc29yfSBJRHMgY29udGFpbmVkIGJ5IHRoaXMgc2Vuc29yLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlucHV0cyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGVmYXVsdCB0aW1lb3V0LCBpbiBzZWNvbmRzLCBvZiBwZXJmb3JtaW5nIGFuIGFjdGlvbi5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVmYXVsdEFjdGlvblRpbWVvdXQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWF4aW11bSB0aW1lb3V0LCBpbiBzZWNvbmRzLCBvZiBwZXJmb3JtaW5nIGFuIGFjdGlvbi5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWF4QWN0aW9uVGltZW91dCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjdXJyZW50IHN0YXRlcyBvZiB0aGUgc2Vuc29yLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yU3RhdGVbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjdXJyZW50IGFsYXJtcyBvZiB0aGUgc2Vuc29yLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnNlY3VyaXR5SW50ZWdyYXRpb25zU2Vuc29yQWxhcm1bXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWxhcm0gPSBbXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRpbWVzdGFtcCBvZiB0aGUgbGFzdCBzdGF0dXMgaW5mb3JtYXRpb24gaWYgYXZhaWxhYmxlLlxuICAgICAgICAgKiBAdHlwZSB7RGF0ZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzVGltZXN0YW1wID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGN1cnJlbnQgc3RhdHVzIG1lc3NhZ2Ugb2YgdGhlIHNlbnNvci5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzTWVzc2FnZSA9ICcnO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IFBlcnNpc3RlZFN0YXR1c1xuICAgICAgICAgKiBAcHJvcGVydHkge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc1NlbnNvclN0YXRlW119IHN0YXR1c1xuICAgICAgICAgKiBAcHJvcGVydHkge0RhdGV9IHN0YXR1c1RpbWVTdGFtcFxuICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gc3RhdHVzTWVzc2FnZVxuICAgICAgICAgKi9cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwZXJzaXN0ZWQgc3RhdHVzIG9mIHRoZSBzZW5zb3IsIGUuZy4gZm9yIGEgcmVhZGVyIHRoaXMgd291bGQgaG9sZCB0aGUgbGFzdCBjYXJkXG4gICAgICAgICAqIHVzZWQsIHRoZSB0aW1lLCBhbmQgYWNjZXNzIGdyYW50ZWQvZGVuaWVkIHN0YXR1cy5cbiAgICAgICAgICogQHR5cGUge1BlcnNpc3RlZFN0YXR1c1tdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wZXJzaXN0ZWRTdGF0dXMgPSBbXTtcblxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGRpcmVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihhdmFpbGFibGVBY3Rpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXZhaWxhYmxlQWN0aW9ucyA9IGF2YWlsYWJsZUFjdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaW5wdXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRzID0gaW5wdXRzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGRlZmF1bHRBY3Rpb25UaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdEFjdGlvblRpbWVvdXQgPSBkZWZhdWx0QWN0aW9uVGltZW91dDtcbiAgICAgICAgfVxuICAgICAgICBpZihtYXhBY3Rpb25UaW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWF4QWN0aW9uVGltZW91dCA9IG1heEFjdGlvblRpbWVvdXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3RhdHVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFsYXJtICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWxhcm0gPSBhbGFybTtcbiAgICAgICAgfVxuICAgICAgICBpZihzdGF0dXNUaW1lc3RhbXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNUaW1lc3RhbXAgPSBzdGF0dXNUaW1lc3RhbXA7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3RhdHVzTWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c01lc3NhZ2UgPSBzdGF0dXNNZXNzYWdlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYocGVyc2lzdGVkU3RhdHVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGVyc2lzdGVkU3RhdHVzID0gcGVyc2lzdGVkU3RhdHVzO1xuICAgICAgICB9XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogUGVyZm9ybSBhbiBhY3Rpb24gd2l0aCB0aGlzIHNlbnNvci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSwgYSBib29sZWFuIGlmIHRoZSBhY3Rpb24gd2FzXG4gICAgICAgICAqICBzdWNjZXNzZnVsLCBhbmQgYSBFVldFQjIuc2VjdXJpdHlJbnRlZ3JhdGlvbnNTZW5zb3JFcnJvclR5cGUgdmFsdWUgaW5kaWNhdGluZyB0aGUgc3RhdHVzIG9mIHRoZVxuICAgICAgICAgKiAgb3BlcmF0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5zZWN1cml0eUludGVncmF0aW9uc1NlbnNvckFjdGlvbn0gYWN0aW9uIFRoZSBhY3Rpb24gdG8gcGVyZm9ybS5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFt0aW1lb3V0PTBdIFRoZSB0aW1lb3V0IGZvciB0aGUgYWN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBlcmZvcm1BY3Rpb24gPSBmdW5jdGlvbihjYWxsYmFjaywgYWN0aW9uLCB0aW1lb3V0KSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICBpZiAoIWluc3RhbmNlLmRldmljZS5pc0xvZ2dlZEluKCkpe1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ05vdCBsb2dnZWQgaW4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aW1lb3V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0ID0gaW5zdGFuY2UuZGVmYXVsdEFjdGlvblRpbWVvdXQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlLCBmYWxzZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZW5kIHRoZSBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLmFjdGlvblN1Y2Nlc3NmdWwsIGRhdGEub3BlcmF0aW9uU3RhdHVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBpbnN0YW5jZS5kZXZpY2Uuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZWN1cml0eUludGVncmF0aW9uc0RldmljZVNlbnNvcnMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogaW5zdGFuY2UuZGV2aWNlLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHRva2VuOiBpbnN0YW5jZS5kZXZpY2UudG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGRldmljZTogaW5zdGFuY2UuZGV2aWNlLmlkLFxuICAgICAgICAgICAgICAgICAgICBzZW5zb3I6IGluc3RhbmNlLmlkLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogdGltZW91dFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGluc3RhbmNlLmRldmljZS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4vKipcbiAqIEBuYW1lc3BhY2UgRVZXRUIyXG4gKi9cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwb3NpdGlvbnMgYXZhaWxhYmxlIGZvciBjYW1lcmEgT1NEIHRleHQuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQ2FtZXJhXG4gICAgICovXG4gICAgRVZXRUIyLm9zZFBvc2l0aW9uID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvcC1MZWZ0XG4gICAgICAgICAqL1xuICAgICAgICB0b3BMZWZ0OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogVG9wLUNlbnRlclxuICAgICAgICAgKi9cbiAgICAgICAgdG9wQ2VudGVyOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogVG9wLVJpZ2h0XG4gICAgICAgICAqL1xuICAgICAgICB0b3BSaWdodDogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvdHRvbS1MZWZ0XG4gICAgICAgICAqL1xuICAgICAgICBib3R0b21MZWZ0OiA3LFxuICAgICAgICAvKipcbiAgICAgICAgICogQm90dG9tLUNlbnRlclxuICAgICAgICAgKi9cbiAgICAgICAgYm90dG9tQ2VudGVyOiA4LFxuICAgICAgICAvKipcbiAgICAgICAgICogQm90dG9tLVJpZ2h0XG4gICAgICAgICAqL1xuICAgICAgICBib3R0b21SaWdodDogOVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgT1NEIHRleHQgYXZhaWxhYmxlIGZvciBkaXNwbGF5LlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IENhbWVyYVxuICAgICAqL1xuICAgIEVWV0VCMi5vc2REaXNwbGF5ID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTmFtZVxuICAgICAgICAgKi9cbiAgICAgICAgbmFtZTogMHg4LFxuICAgICAgICAvKipcbiAgICAgICAgICogVGltZVxuICAgICAgICAgKi9cbiAgICAgICAgdGltZTogMHg0LFxuICAgICAgICAvKipcbiAgICAgICAgICogVGltZXpvbmVcbiAgICAgICAgICovXG4gICAgICAgIHRpbWV6b25lOiAweDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEYXRlXG4gICAgICAgICAqL1xuICAgICAgICBkYXRlOiAweDFcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIENhbWVyYU9zZEluZm8gb2JqZWN0IGlzIGEgY29udGFpbmVyIGZvciB0aGUgT1NEIGluZm9ybWF0aW9uIGZvciBhIGNhbWVyYS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5vc2RQb3NpdGlvbn0gW3Bvc2l0aW9uPUVWV0VCMi5vc2RQb3NpdGlvbi5ub25lXSBUaGUgcG9zaXRpb24gb2YgdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtuYW1lPWZhbHNlXSBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIGNhbWVyYSBuYW1lIHNob3VsZCBiZSBkaXNwbGF5ZWQgb24gdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt0aW1lPXRydWVdIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgdGltZSBzaG91bGQgYmUgZGlzcGxheWVkIG9uIHRoZSBPU0QuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbZGF0ZT1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBkYXRlIHNob3VsZCBiZSBkaXNwbGF5ZWQgb24gdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt0aW1lem9uZT1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSB0aW1lem9uZSBzaG91bGQgYmUgZGlzcGxheWVkIG9uIHRoZSBPU0QuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtmb250PSdTYW5zJ10gVGhlIGZvbnQgdXNlZCBmb3IgZGlzcGxheWluZyB0aGUgT1NELlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbZm9udFNpemU9MTBdIFRoZSBmb250IHNpemUgdXNlZCBmb3IgZGlzcGxheWluZyB0aGUgT1NELlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmZvbnRDb2xvcn0gW2ZvbnRDb2xvcj1FVldFQjIuZm9udENvbG9yLndoaXRlXSBUaGUgZm9udCBjb2xvciB1c2VkIGZvciBkaXNwbGF5aW5nIHRoZSBPU0QuXG4gICAgICogQHBhcmFtIHtFVldFQjIuZm9udFN0eWxlfSBbZm9udFN0eWxlPUVWV0VCMi5mb250U3R5bGUubm9ybWFsXSBUaGUgZm9udCBzdHlsZSB1c2VkIGZvciBkaXNwbGF5aW5nIHRoZSBPU0QuXG4gICAgICogQHBhcmFtIHtFVldFQjIuZm9udEZhbWlseX0gW2ZvbnRGYW1pbHk9RVZXRUIyLmZvbnRGYW1pbHkuZGVmYXVsdF0gVGhlIGZvbnQgZmFtaWx5IHVzZWQgZm9yIGRpc3BsYXlpbmcgdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5mb250V2VpZ2h0fSBbZm9udFdlaWdodD1FVldFQjIuZm9udFdlaWdodC5saWdodF0gVGhlIGZvbnQgd2VpZ2h0IHVzZWQgZm9yIGRpc3BsYXlpbmcgdGhlIE9TRC5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgQ2FtZXJhXG4gICAgICovXG4gICAgRVZXRUIyLkNhbWVyYU9zZEluZm8gPSBmdW5jdGlvbihwb3NpdGlvbiwgbmFtZSwgdGltZSwgZGF0ZSwgdGltZXpvbmUsIGZvbnQsIGZvbnRTaXplLCBmb250Q29sb3IsIGZvbnRTdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHksIGZvbnRXZWlnaHQpe1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcG9zaXRpb24gb2YgdGhlIE9TRCBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5vc2RQb3NpdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBFVldFQjIub3NkUG9zaXRpb24ubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBjYW1lcmEgbmFtZSBzaG91bGQgYmUgZGlzcGxheWVkIG9uIHRoZSBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgdGltZSBzaG91bGQgYmUgZGlzcGxheWVkIG9uIHRoZSBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aW1lID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgZGF0ZSBzaG91bGQgYmUgZGlzcGxheWVkIG9uIHRoZSBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYXRlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgdGltZXpvbmUgc2hvdWxkIGJlIGRpc3BsYXllZCBvbiB0aGUgT1NELlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGltZXpvbmUgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgdXNlZCBmb3IgZGlzcGxheWluZyBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZvbnQgPSAnU2Fucyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmb250IHNpemUgZm9yIGRpc3BsYXlpbmcgT1NELlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250U2l6ZSA9IDEwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9udCBjb2xvciBmb3IgZGlzcGxheWluZyBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuZm9udENvbG9yfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250Q29sb3IgPSBFVldFQjIuZm9udENvbG9yLndoaXRlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9udCBzdHlsZSBmb3IgZGlzcGxheWluZyBPU0QuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuZm9udFN0eWxlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250U3R5bGUgPSBFVldFQjIuZm9udFN0eWxlLm5vcm1hbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgZmFtaWx5IGZvciBkaXNwbGF5aW5nIE9TRC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5mb250U3R5bGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZvbnRGYW1pbHkgPSBFVldFQjIuZm9udEZhbWlseS5kZWZhdWx0Rm9udDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZvbnQgd2VpZ2h0IGZvciBkaXNwbGF5aW5nIE9TRC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5mb250V2VpZ2h0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250V2VpZ2h0ID0gRVZXRUIyLmZvbnRXZWlnaHQubGlnaHQ7XG5cblxuICAgICAgICBpZihwb3NpdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIH1cblxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IHRpbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZihkYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0ZSA9IGRhdGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aW1lem9uZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWV6b25lID0gdGltZXpvbmU7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9udCA9IGZvbnQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250U2l6ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZvbnRTaXplID0gZm9udFNpemU7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250Q29sb3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mb250Q29sb3IgPSBmb250Q29sb3I7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250U3R5bGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5mb250U3R5bGUgPSBmb250U3R5bGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250RmFtaWx5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9udEZhbWlseSA9IGZvbnRGYW1pbHk7XG4gICAgICAgIH1cblxuICAgICAgICBpZihmb250V2VpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9udFdlaWdodCA9IGZvbnRXZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmUgdGhlIGJpdG1hc2sgdmFsdWUgdXNlZCBmb3Igc2V0dGluZyB0aGUgT1NEIGRpc3BsYXlcbiAgICAgICAgICogQHJldHVybnMge251bWJlcn0gVGhlIGJpdG1hc2sgT1NEIHZhbHVlXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXREaXNwbGF5Qml0bWFzayA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICB2YXIgYml0bWFzayA9IDA7XG5cbiAgICAgICAgICAgIGlmKHRoaXMubmFtZSkge1xuICAgICAgICAgICAgICAgIGJpdG1hc2sgfD0gRVZXRUIyLm9zZERpc3BsYXkubmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYodGhpcy5kYXRlKXtcbiAgICAgICAgICAgICAgICBiaXRtYXNrIHw9IEVWV0VCMi5vc2REaXNwbGF5LmRhdGU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMudGltZSl7XG4gICAgICAgICAgICAgICAgYml0bWFzayB8PSBFVldFQjIub3NkRGlzcGxheS50aW1lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZih0aGlzLnRpbWV6b25lKXtcbiAgICAgICAgICAgICAgICBiaXRtYXNrIHw9IEVWV0VCMi5vc2REaXNwbGF5LnRpbWV6b25lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG5cbiAgICAgICAgICAgIHJldHVybiBiaXRtYXNrO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDYW1lcmEgQ29uZmlndXJhdGlvbiBjb250YWluZXJcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5DYW1lcmF9IGNhbWVyYSB0aGUgY2FtZXJhIGluc3RhbmNlIHRoZSBjb25maWcgYmVsb25ncyB0b1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIuQ2FtZXJhQ29uZmlnID0gZnVuY3Rpb24oY2FtZXJhKSB7XG4gICAgICAgIGlmKGNhbWVyYSA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIHJlcXVpcmVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSBpbnN0YW5jZSB0aGlzIGNvbmZpZyBiZWxvbmdzIHRvXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuQ2FtZXJhfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhY2hlZCBPU0QgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuQ2FtZXJhT3NkSW5mb31cbiAgICAgICAgICovXG4gICAgICAgIHZhciBvc2RJbmZvID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF2ZXJhZ2UgZnJhbWUgc2l6ZSByZWNlaXZlZCBmcm9tIHRoZSBjYW1lcmFcbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBhdmVyYWdlRnJhbWVTaXplID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogVGhlIHNldE9zZEluZm8gaXMgYSBtZXRob2QgdGhhdCBzZXRzIHRoZSBPU0QgZGlzcGxheSBpbmZvcm1hdGlvbiBmb3IgYSBjYW1lcmEgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5DYW1lcmFPc2RJbmZvfSBjYW1lcmFPc2RJbmZvIFRoZSBuZXcgT1NEIGluZm8gdG8gYXBwbHkgdG8gdGhlIGNhbWVyYS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0T3NkSW5mbyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjYW1lcmFPc2RJbmZvKXtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoY2FtZXJhT3NkSW5mbyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW1lcmFPc2RJbmZvIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvblNldENhbWVyYU9zZEVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblNldENhbWVyYU9zZFN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLmNhbWVyYS5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIGNhbWVyYTogdGhpcy5jYW1lcmEuaWQsXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGNhbWVyYU9zZEluZm8ucG9zaXRpb24sXG4gICAgICAgICAgICAgICAgZGlzcGxheTogY2FtZXJhT3NkSW5mby5nZXREaXNwbGF5Qml0bWFzaygpLFxuICAgICAgICAgICAgICAgIGZvbnROYW1lOiBjYW1lcmFPc2RJbmZvLmZvbnQsXG4gICAgICAgICAgICAgICAgZm9udFNpemU6IGNhbWVyYU9zZEluZm8uZm9udFNpemUsXG4gICAgICAgICAgICAgICAgZXZGb250Q29sb3I6IGNhbWVyYU9zZEluZm8uZm9udENvbG9yLFxuICAgICAgICAgICAgICAgIGV2Rm9udEZhbWlseTogY2FtZXJhT3NkSW5mby5mb250RmFtaWx5LFxuICAgICAgICAgICAgICAgIGV2Rm9udFN0eWxlOiBjYW1lcmFPc2RJbmZvLmZvbnRTdHlsZSxcbiAgICAgICAgICAgICAgICBldkZvbnRXZWlnaHQ6IGNhbWVyYU9zZEluZm8uZm9udFdlaWdodFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU2V0Q2FtZXJhT3NkU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25TZXRDYW1lcmFPc2RFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuY2FtZXJhLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5jYW1lcmEuc2VydmVyLnNlcnZpY2UsIHRydWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGdlbmVyYXRlIHRoZSBsZWdhY3kgT1NEIHBvc2l0aW9uIHN0cmluZ3Mgc3RpbGwgaW4gdXNlXG4gICAgICAgICAqIGZyb20gdGhlIG5ldyB7QGxpbmsgRVZXRUIyLm9zZFBvc2l0aW9ufSBlbnVtZXJhdGlvbnMuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLm9zZFBvc2l0aW9ufSBuZXdQb3NpdGlvbiBUaGUgbmV3IE9TRCBwb3NpdGlvbiB2YWx1ZS5cbiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIGNvcnJlc3BvbmRpbmcgbGVnYWN5IHN0cmluZyB0aGF0IG1hdGNoZXMgdGhlIG5ldyBwb3NpdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZW5lcmF0ZURlcHJlY2F0ZWRPc2RQb3NpdGlvbiA9IGZ1bmN0aW9uKG5ld1Bvc2l0aW9uKXtcbiAgICAgICAgICAgIHZhciBvbGRQb3NpdGlvbjtcbiAgICAgICAgICAgIHN3aXRjaChuZXdQb3NpdGlvbil7XG4gICAgICAgICAgICAgICAgY2FzZSBFVldFQjIub3NkUG9zaXRpb24uYm90dG9tTGVmdDpcbiAgICAgICAgICAgICAgICAgICAgb2xkUG9zaXRpb24gPSAnYm90dG9tLWxlZnQnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVWV0VCMi5vc2RQb3NpdGlvbi5ib3R0b21DZW50ZXI6XG4gICAgICAgICAgICAgICAgICAgIG9sZFBvc2l0aW9uID0gJ2JvdHRvbS1jZW50ZXInO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVWV0VCMi5vc2RQb3NpdGlvbi5ib3R0b21SaWdodDpcbiAgICAgICAgICAgICAgICAgICAgb2xkUG9zaXRpb24gPSAnYm90dG9tLXJpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBFVldFQjIub3NkUG9zaXRpb24udG9wTGVmdDpcbiAgICAgICAgICAgICAgICAgICAgb2xkUG9zaXRpb24gPSAndG9wLWxlZnQnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVWV0VCMi5vc2RQb3NpdGlvbi50b3BDZW50ZXI6XG4gICAgICAgICAgICAgICAgICAgIG9sZFBvc2l0aW9uID0gJ3RvcC1jZW50ZXInO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEVWV0VCMi5vc2RQb3NpdGlvbi50b3BSaWdodDpcbiAgICAgICAgICAgICAgICAgICAgb2xkUG9zaXRpb24gPSAndG9wLXJpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgb2xkUG9zaXRpb24gPSAnbm9uZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2xkUG9zaXRpb247XG4gICAgICAgIH07XG5cbiAgICAgICAgLyogVE9ETyBUaGUgY2FtZXJhLndlYiBlbmRwb2ludCBleHBvc2VzIGEgbG90IG9mIHRoaXMgaW5mb3JtYXRpb24gZnJvbSBhIHNpbmdsZSBlbmRwb2ludFxuICAgICAgICAgKiB0aGVyZSBzaG91bGQgYmUgYSBoaWdoZXIgbGV2ZWwgZnVuY3Rpb24gdGhhdCBjYW4gYmUgY2FsbGVkIHRvIHVwZGF0ZSBhbGwgb2YgdGhlIGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICogc3RhdGUgYXQgb25jZSAob3NkIGluZm8sIGF2ZXJhZ2UgZnJhbWUgc2l6ZSwgZXRjKS4gRWFjaCBnZXQgbWV0aG9kIHNob3VsZCBjYWxsIHRoYXQgaGlnaGVyIGxldmVsXG4gICAgICAgICAqIGZ1bmN0aW9uIHdoaWNoIHVwZGF0ZXMgYWxsIG9mIHRoZSBjb25maWd1cmF0aW9uIHN0YXRlIGF0IG9uY2UgaW5zdGVhZCBvZiBlYWNoIGZ1bmN0aW9uIHJlLXF1ZXJ5aW5nXG4gICAgICAgICAqIHRoZSBzZXJ2ZXJcbiAgICAgICAgICovXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgT1NEIGluZm9ybWF0aW9uIGZvciBhIGNhbWVyYSBmcm9tIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIFRoZSBmdW5jdGlvbiBnZXRzXG4gICAgICAgICAqIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCBhbiBpbnN0YW5jZSBvZlxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLkNhbWVyYU9zZEluZm99LCBhbmQgdGhlIGNhbWVyYSB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gaW5zdGFuY2UgaXQgYmVsb25ncyB0by5cbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbZm9yY2VVcGRhdGU9ZmFsc2VdIEZsYWcgdG8gdXNlIGNhY2hlZCBPU0QgaW5mb3JtYXRpb24gb3Igbm90LiBCeSBkZWZhdWx0IGlmIE9TRCBpbmZvcm1hdGlvblxuICAgICAgICAgKiBoYXMgYWxyZWFkeSBiZWVuIGZldGNoZWQgYW5kIGlzIGF2YWlsYWJsZSB0aGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHRoYXQuIFdoZW4gdHJ1ZSB0aGlzIGZ1bmN0aW9uIHdpbGwgYWx3YXlzXG4gICAgICAgICAqIHF1ZXJ5IHRoZSBzZXJ2ZXIgZm9yIHRoZSBsYXRlc3QgT1NEIGluZm9ybWF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRPc2RJbmZvID0gZnVuY3Rpb24oY2FsbGJhY2ssIGZvcmNlVXBkYXRlKSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKGZvcmNlVXBkYXRlID09PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKG9zZEluZm8gIT09IG51bGwgJiYgIWZvcmNlVXBkYXRlKXtcbiAgICAgICAgICAgICAgICAvLyB1c2UgY2FjaGVkIHZhbHVlXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBvc2RJbmZvLCBpbnN0YW5jZS5jYW1lcmEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uR2V0Q2FtZXJhT3NkRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0Q2FtZXJhT3NkU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKG9zZEluZm8gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgb3NkSW5mbyA9IG5ldyBFVldFQjIuQ2FtZXJhT3NkSW5mbygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9zZEluZm8ucG9zaXRpb24gPSBkYXRhLmNhbWVyYS5vc2RJbmZvLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLWJpdHdpc2UgKi9cbiAgICAgICAgICAgICAgICBvc2RJbmZvLm5hbWUgPSBCb29sZWFuKGRhdGEuY2FtZXJhLm9zZEluZm8uZGlzcGxheSAmIEVWV0VCMi5vc2REaXNwbGF5Lm5hbWUpO1xuICAgICAgICAgICAgICAgIG9zZEluZm8udGltZSA9IEJvb2xlYW4oZGF0YS5jYW1lcmEub3NkSW5mby5kaXNwbGF5ICYgRVZXRUIyLm9zZERpc3BsYXkudGltZSk7XG4gICAgICAgICAgICAgICAgb3NkSW5mby5kYXRlID0gQm9vbGVhbihkYXRhLmNhbWVyYS5vc2RJbmZvLmRpc3BsYXkgJiBFVldFQjIub3NkRGlzcGxheS5kYXRlKTtcbiAgICAgICAgICAgICAgICBvc2RJbmZvLnRpbWV6b25lID0gQm9vbGVhbihkYXRhLmNhbWVyYS5vc2RJbmZvLmRpc3BsYXkgJiBFVldFQjIub3NkRGlzcGxheS50aW1lem9uZSk7XG4gICAgICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICAgICAgb3NkSW5mby5mb250ID0gZGF0YS5jYW1lcmEub3NkSW5mby5mb250TmFtZTtcbiAgICAgICAgICAgICAgICBvc2RJbmZvLmZvbnRTaXplID0gZGF0YS5jYW1lcmEub3NkSW5mby5mb250U2l6ZTtcbiAgICAgICAgICAgICAgICBvc2RJbmZvLmZvbnRDb2xvciA9IGRhdGEuY2FtZXJhLm9zZEluZm8uZXZGb250Q29sb3I7XG4gICAgICAgICAgICAgICAgb3NkSW5mby5mb250U3R5bGUgPSBkYXRhLmNhbWVyYS5vc2RJbmZvLmV2Rm9udFN0eWxlO1xuICAgICAgICAgICAgICAgIG9zZEluZm8uZm9udEZhbWlseSA9IGRhdGEuY2FtZXJhLm9zZEluZm8uZXZGb250RmFtaWx5O1xuICAgICAgICAgICAgICAgIG9zZEluZm8uZm9udFdlaWdodCA9IGRhdGEuY2FtZXJhLm9zZEluZm8uZXZGb250V2VpZ2h0O1xuXG5cbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgZGVwcmVjYXRlZCBvc2QgaW5mb3JtYXRpb25cbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5jYW1lcmEub3NkLnBvc2l0aW9uID0gZ2VuZXJhdGVEZXByZWNhdGVkT3NkUG9zaXRpb24ob3NkSW5mby5wb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuY2FtZXJhLm9zZC5uYW1lID0gb3NkSW5mby5uYW1lO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmNhbWVyYS5vc2QudGltZSA9IG9zZEluZm8udGltZTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5jYW1lcmEub3NkLmRhdGUgPSBvc2RJbmZvLmRhdGU7XG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuY2FtZXJhLm9zZC50aW1lem9uZSA9IG9zZEluZm8udGltZXpvbmU7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIG9zZEluZm8sIGluc3RhbmNlLmNhbWVyYSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuY2FtZXJhLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB0aGlzLmNhbWVyYS5pZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0Q2FtZXJhT3NkU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRDYW1lcmFPc2RFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuY2FtZXJhLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGF2ZXJhZ2UgZnJhbWUgc2l6ZSByZWNlaXZlZCBmb3IgYSBjYW1lcmEgZnJvbSB0aGUgd2ViIHNlcnZpY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBUaGUgZnVuY3Rpb24gZ2V0c1xuICAgICAgICAgKiBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSwgdGhlIGF2ZXJhZ2UgZnJhbWUgc2l6ZSxcbiAgICAgICAgICogYW5kIHRoZSB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gaW5zdGFuY2VcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0QXZlcmFnZUZyYW1lU2l6ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uR2V0QXZnRnJhbWVTaXplRXJyb3I9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRBdmdGcmFtZVNpemVTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXZlcmFnZUZyYW1lU2l6ZSA9IGRhdGEuY2FtZXJhLmF2ZXJhZ2VGcmFtZVNpemU7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGF2ZXJhZ2VGcmFtZVNpemUsIGluc3RhbmNlLmNhbWVyYSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuY2FtZXJhLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB0aGlzLmNhbWVyYS5pZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0QXZnRnJhbWVTaXplU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRBdmdGcmFtZVNpemVFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuY2FtZXJhLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuY2FtZXJhLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBkaWdpdGFsIFBUWiBhdmFpbGFibGUgdG8gY2FtZXJhcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKi9cbiAgICBFVldFQjIuZGlnaXRhbFB0elR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9ybWFsXG4gICAgICAgICAqL1xuICAgICAgICBub3JtYWw6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXdhcnBcbiAgICAgICAgICovXG4gICAgICAgIGRld2FycDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhbm9yYW1hXG4gICAgICAgICAqL1xuICAgICAgICBwYW5vcmFtYTogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIER1YWwtVmlld1xuICAgICAgICAgKi9cbiAgICAgICAgZHVhbFZpZXc6IDhcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSBiYXNpYyB0eXBlcyBvZiBQVFogYXZhaWxhYmxlIHRvIGNhbWVyYXMuXG4gICAgICogQGVudW0ge3N0cmluZ31cbiAgICAgKiBAY2F0ZWdvcnkgQ2FtZXJhXG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgRVZXRUIyLnB0elR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogTm9uZVxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogJ25vbmUnLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RhbmRhcmQgKE1lY2hhbmljYWwpXG4gICAgICAgICAqL1xuICAgICAgICBzdGFuZGFyZDogJ3N0YW5kYXJkJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpZ2l0YWxcbiAgICAgICAgICovXG4gICAgICAgIGRpZ2l0YWw6ICdkaWdpdGFsJ1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIHB0eiBkaXJlY3Rpb25zIHVzZWQgYnkge0BsaW5rIEVWV0VCMi5DYW1lcmEucHR6TW92ZX1cbiAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIucHR6RGlyZWN0aW9ucyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwLUxlZnRcbiAgICAgICAgICovXG4gICAgICAgIHVwTGVmdDogJ3VsJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwXG4gICAgICAgICAqL1xuICAgICAgICB1cDogJ3UnLFxuICAgICAgICAvKipcbiAgICAgICAgICogVXAtUmlnaHRcbiAgICAgICAgICovXG4gICAgICAgIHVwUmlnaHQ6ICd1cicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMZWZ0XG4gICAgICAgICAqL1xuICAgICAgICBsZWZ0OiAnbCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAnbicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSaWdodFxuICAgICAgICAgKi9cbiAgICAgICAgcmlnaHQ6ICdyJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERvd24tTGVmdFxuICAgICAgICAgKi9cbiAgICAgICAgZG93bkxlZnQ6ICdkbCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEb3duXG4gICAgICAgICAqL1xuICAgICAgICBkb3duOiAnZCcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEb3duLVJpZ2h0XG4gICAgICAgICAqL1xuICAgICAgICBkb3duUmlnaHQ6ICdkcicsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBab29tLUluXG4gICAgICAgICAqL1xuICAgICAgICB6b29tSW46ICdpJyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFpvb20tT3V0XG4gICAgICAgICAqL1xuICAgICAgICB6b29tT3V0OiAnbydcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdGhlIGF2YWlsYWJsZSBjYW1lcmEgZm9ybWF0cy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIuY2FtZXJhRm9ybWF0cyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEpQRUdcbiAgICAgICAgICovXG4gICAgICAgIGpwZWc6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNUEVHIDFcbiAgICAgICAgICovXG4gICAgICAgIG1wZWcxOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTVBFRyAyXG4gICAgICAgICAqL1xuICAgICAgICBtcGVnMjogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGguMjYzXG4gICAgICAgICAqL1xuICAgICAgICBoMjYzOiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogTVBFRyA0XG4gICAgICAgICAqL1xuICAgICAgICBtcGVnNDogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIGguMjY0XG4gICAgICAgICAqL1xuICAgICAgICBoMjY0OiA1LFxuICAgICAgICAvKipcbiAgICAgICAgICogVHJhbnNjb2RlZCBKUEVHXG4gICAgICAgICAqL1xuICAgICAgICB0cmFuc2NvZGVkSnBlZzogNlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBvZiB0aGUgYXZhaWxhYmxlIHRodW1ibmFpbCBzaXplcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIuY2FtZXJhVGh1bWJuYWlsU2l6ZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiA4MHg4MCB0aHVtYm5haWxcbiAgICAgICAgICovXG4gICAgICAgIHNpemU4MHg4MDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIDEyOHgxMjggdGh1bWJuYWlsXG4gICAgICAgICAqL1xuICAgICAgICBzaXplMTI4eDEyODogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIDIwMHgyMDAgdGh1bWJuYWlsXG4gICAgICAgICAqL1xuICAgICAgICBzaXplMjAweDIwMDogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBBIGRpZ2l0YWwgUFRaIHJlY3RhbmdsZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3g9MF0gVGhlIHgtY29vcmRpbmF0ZSBvZiB0aGUgcmVjdGFuZ2xlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbeT0wXSBUaGUgeS1jb29yZGluYXRlIG9mIHRoZSByZWN0YW5nbGUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wXSBUaGUgd2lkdGggb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2hlaWdodD0wXSBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IENhbWVyYVxuICAgICAqL1xuICAgIEVWV0VCMi5EaWdpdGFsUHR6UmVjdGFuZ2xlID0gZnVuY3Rpb24oeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHgtY29vcmRpbmF0ZSBvZiB0aGUgcmVjdGFuZ2xlLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMueCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB5LWNvb3JkaW5hdGUgb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnkgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgd2lkdGggb2YgdGhlIHJlY3RhbmdsZS5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuXG4gICAgICAgIHRoaXMud2lkdGggPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIHggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB5ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy55ID0geTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygd2lkdGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGhlaWdodCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICB9XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogQSBQVFogcHJlc2V0IHJldHJpZXZlZCBmcm9tIHtAbGluayBFVldFQjIuQ2FtZXJhLmdldFB0elByZXNldHN9XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gVGhlIElEIG9mIHRoZSBQVFogcHJlc2V0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nVW5kZWZpbmVkJ10gVGhlIG5hbWUgb2YgdGhlIFBUWiBwcmVzZXQuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IENhbWVyYVxuICAgICAqL1xuICAgIEVWV0VCMi5QdHpQcmVzZXQgPSBmdW5jdGlvbihpZCwgbmFtZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVW5pcXVlIElEIGZvciB0aGlzIFBUWiBwcmVzZXRcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhpcyBQVFogcHJlc2V0XG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJ1VuZGVmaW5lZCc7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIG5hbWUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEEgY2FtZXJhIHJlc29sdXRpb24uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aD0wXSBUaGUgd2lkdGgsIGluIHBpeGVscywgb2YgdGhlIHJlc29sdXRpb24uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtoZWlnaHQ9MF0gVGhlIGhlaWdodCwgaW4gcGl4ZWxzLCBvZiB0aGUgcmVzb2x1dGlvbi5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgQ2FtZXJhXG4gICAgICovXG4gICAgRVZXRUIyLkNhbWVyYVJlc29sdXRpb24gPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgd2lkdGgsIGluIHBpeGVscywgb2YgdGhlIHJlc29sdXRpb24uXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy53aWR0aCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBoZWlnaHQsIGluIHBpeGVscywgb2YgdGhlIHJlc29sdXRpb24uXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZW9mIHdpZHRoICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBoZWlnaHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgY2FtZXJhIG9iamVjdCBhY3RzIGFzIGEgbGFyZ2UgY29udGFpbmVyIGZvciBhbGwgdGhlIGNhbWVyYSBmZWVkIG9wZXJhdGlvbnMgYW5kIGluZm9ybWF0aW9uLlxuICAgICAqIEl0IGlzIGluaXRpYWxseSBwb3B1bGF0ZWQgZnJvbSB0aGUgaW5mb3JtYXRpb24gcmV0cmlldmVkIGluIHRoZSB7QGxpbmsgRVZXRUIyLlNlcnZlci5nZXRDYW1lcmFzfSBmdW5jdGlvbiBhbmRcbiAgICAgKiBob2xkcyB0aGUgdW5pcXVlIGluZm9ybWF0aW9uIGZvciBhbiBpbmRpdmlkdWFsIGNhbWVyYSBvbiBhbiBleGFjcVZpc2lvbiBzZXJ2ZXIuICBUaGUgaW5mb3JtYXRpb25cbiAgICAgKiBjYW4gYmUgdXNlZCB0byB0aGVuIHJldHJpZXZlIGltYWdlcyBvciBzZWFyY2hpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2VydmVyIHNwZWNpZmljIHRvIHRoaXMgY2FtZXJhXG4gICAgICogZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gW3NlcnZlcj1udWxsXSBTZXJ2ZXIgaW5zdGFuY2UgdGhpcyBjYW1lcmEgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIElEIG9mIHRoZSBjYW1lcmEgYWNjb3JkaW5nIHRvIHRoZSB3ZWIgc2VydmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2N0eD0nJ10gQ29udGV4dCBJRCBmb3IgdGhpcyBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPSdVbmRlZmluZWQnXSBOYW1lIG9mIHRoaXMgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3B0ej1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIFBUWiBpcyBhdHRhY2hlZCB0byB0aGlzIGNhbWVyYS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtkaXNhYmxlZD10cnVlXSBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIGNhbWVyYSBpcyBkaXNhYmxlZC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtoYXNWaWRlbz1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBjYW1lcmEgZ2V0cyB2aWRlby5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gW29zZD17fV0gT2JqZWN0IGNvbnRhaW5pbmcgYWxsIE9TRCBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW29zZC5wb3NpdGlvbj0nbm9uZSddIFRoZSBwb3NpdGlvbiBvZiB0aGUgT1NELlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW29zZC5uYW1lPWZhbHNlXSBCb29sZWFuIGZsYWcgZm9yIHdoZXRoZXIgdGhlIGNhbWVyYSBuYW1lIHNob3VsZCBiZSBkaXNwbGF5ZWQgb24gdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvc2QudGltZT1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSB0aW1lIHNob3VsZCBiZSBkaXNwbGF5ZWQgb24gdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvc2QuZGF0ZT1mYWxzZV0gQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBkYXRlIHNob3VsZCBiZSBkaXNwbGF5ZWQgb24gdGhlIE9TRC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvc2QudGltZXpvbmU9ZmFsc2VdIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgdGltZXpvbmUgc2hvdWxkIGJlIGRpc3BsYXllZCBvbiB0aGUgT1NELlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLnB0elR5cGVzfSBbcHR6VHlwZT1FVldFQjIucHR6VHlwZXMubm9uZV0gVGhlIHR5cGUgb2YgUFRaIG9mIHRoaXMgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmRpZ2l0YWxQdHpUeXBlc1tdfSBbZGlnaXRhbFB0elR5cGVzPVtdXSBBcnJheSBvZiB7QGxpbmsgRVZXRUIyLmRpZ2l0YWxQdHpUeXBlc30gZGV0YWlsaW5nIHRoZVxuICAgICAqIGRpZ2l0YWwgcHR6IHR5cGVzIHRoZSBjYW1lcmEgc3VwcG9ydHMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuY2FtZXJhRm9ybWF0c1tdfSBbZm9ybWF0cz1bRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWddXSBUaGUgZm9ybWF0cyBhdmFpbGFibGUgZm9yXG4gICAgICogcmV0cmllaXZpbmcgdmlkZW8gZm9yIHRoZSBjYW1lcmEuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQ2FtZXJhUmVzb2x1dGlvbn0gW3Jlc29sdXRpb249bnVsbF0gVGhlIHJlc29sdXRpb24gb2YgdGhlIGNhbWVyYS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3F1YWxpdHk9LTFdIFRoZSBxdWFsaXR5IG9mIHRoZSBjYW1lcmEsIHJhbmdpbmcgZnJvbSAwLTEwLiAgRm9yIGNhbWVyYXMgd2l0aCBubyBxdWFsaXR5XG4gICAgICogc2V0dGluZywgdGhpcyB2YWx1ZSB3aWxsIGJlIC0xLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbZnJhbWVSYXRlPS0xXSBUaGUgZnJhbWUgcmF0ZSBvZiB0aGUgY2FtZXJhLiAgRm9yIGNhbWVyYXMgd2l0aCBubyBmcmFtZSByYXRlIHNldHRpbmcsIHRoaXNcbiAgICAgKiB2YWx1ZSB3aWxsIGJlIC0xLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFyZW50SWQ9aWRdIElmIGNhbWVyYSBpcyBhIHN1Yi1jb250ZXh0LCB0aGUgSUQgb2YgdGhlIHBhcmVudCBjYW1lcmEuIEVxdWFsIHRvIGl0cyBvd24gSUQgaWZcbiAgICAgKiBvdGhlcndpc2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtyb3RhdGlvbj0wXSBUaGUgcm90YXRpb24sIGluIGRlZ3JlZXMsIG9mIHRoZSBjYW1lcmEuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IENhbWVyYVxuICAgICAqL1xuICAgIEVWV0VCMi5DYW1lcmEgPSBmdW5jdGlvbiAoc2VydmVyLCBpZCwgY3R4LCBuYW1lLCBwdHosIGRpc2FibGVkLCBoYXNWaWRlbywgb3NkLCBwdHpUeXBlLCBkaWdpdGFsUHR6VHlwZXMsXG4gICAgICAgIGZvcm1hdHMsIHJlc29sdXRpb24sIHF1YWxpdHksIGZyYW1lUmF0ZSwgcGFyZW50SWQsIHJvdGF0aW9uKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmlxdWUgSUQgZm9yIHRoaXMgY2FtZXJhXG4gICAgICAgICAqIEB0eXBlIHN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBpbnN0YW5jZSBvZiB0aGUgc291cmNlIGNhbWVyYSBmb3IgdGhpcyBjYW1lcmEuICBVc2VkIG9ubHkgZm9yIGRpZ2l0YWwgUFRaXG4gICAgICAgICAqIGNhbWVyYXMsIHdoaWNoIGFyZSBiYXNlZCBvZmYgYW5vdGhlciBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuQ2FtZXJhfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zb3VyY2VDYW1lcmEgPSB0aGlzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb250ZXh0IElEIGZvciB0aGlzIGNhbWVyYVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY3R4ID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5hbWUgb2YgdGhpcyBjYW1lcmFcbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnVW5kZWZpbmVkJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VydmVyIGluc3RhbmNlIHRoaXMgY2FtZXJhIGlzIGF0dGFjaGVkIHRvXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIFBUWiBpcyBhdHRhY2hlZCB0byB0aGlzIGNhbWVyYVxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnB0eiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiBQVFogdGhhdCBpcyBhdHRhY2hlZCB0byB0aGlzIGNhbWVyYVxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLnB0elR5cGVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wdHpUeXBlID0gRVZXRUIyLnB0elR5cGVzLm5vbmU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkaWdpdGFsIFBUWiB0eXBlcyB0aGUgY2FtZXJhIHN1cHBvcnRzXG4gICAgICAgICAqIEB0eXBlIHtBcnJheX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGlnaXRhbFB0elR5cGVzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjdXJyZW50IGRpZ2l0YWwgUFRaIHR5cGUgb2YgdGhpcyBjYW1lcmFcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5kaWdpdGFsUHR6VHlwZXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRpZ2l0YWxQdHpUeXBlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQm9vbGVhbiBmbGFnIGZvciB3aGV0aGVyIHRoZSBjYW1lcmEgaXMgZGlzYWJsZWRcbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJvb2xlYW4gZmxhZyBmb3Igd2hldGhlciB0aGUgY2FtZXJhIGdldHMgdmlkZW9cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52aWRlbyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPYmplY3QgY29udGFpbmluZyBhbGwgT1NEIGluZm9ybWF0aW9uLlxuICAgICAgICAgKiBEZXByZWNhdGVkIGluIGZhdm9yIG9mIG5ldyB7QGxpbmsgRVZXRUIyLkNhbWVyYUNvbmZpZ30gQVBJIHdoaWNoIGluY2x1ZGVzXG4gICAgICAgICAqIG1vcmUgZXhoYXVzdGl2ZSBPU0QgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAgICAgKiBAZGVwcmVjYXRlZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vc2QgPSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFN0cmluZyBmb3IgT1NEIHBvc2l0aW9uXG4gICAgICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcG9zaXRpb246ICdub25lJyxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHRoZSBPU0QgZGlzcGxheSBmb3IgbmFtZVxuICAgICAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBuYW1lOiBmYWxzZSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHRoZSBPU0QgZGlzcGxheSBmb3IgdGltZVxuICAgICAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aW1lOiBmYWxzZSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHRoZSBPU0QgZGlzcGxheSBmb3IgZGF0ZVxuICAgICAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBkYXRlOiBmYWxzZSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBCb29sZWFuIGZsYWcgZm9yIHRoZSBPU0QgZGlzcGxheSBmb3IgdGltZXpvbmVcbiAgICAgICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGltZXpvbmU6IGZhbHNlXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmb3JtYXRzIGF2YWlsYWJsZSBmb3IgcmV0cmllaXZpbmcgdmlkZW8gZm9yIHRoZSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuY2FtZXJhRm9ybWF0c1tdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb3JtYXRzID0gW1xuICAgICAgICAgICAgRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWdcbiAgICAgICAgXTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHJlc29sdXRpb24gb2YgdGhlIGNhbWVyYS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5DYW1lcmFSZXNvbHV0aW9ufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXNvbHV0aW9uID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHF1YWxpdHkgb2YgdGhlIGNhbWVyYSwgcmFuZ2luZyBmcm9tIDAtMTAuICBGb3IgY2FtZXJhcyB3aXRoIG5vIHF1YWxpdHkgc2V0dGluZywgdGhpcyB2YWx1ZSB3aWxsIGJlIC0xLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5xdWFsaXR5ID0gLTE7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmcmFtZSByYXRlIG9mIHRoZSBjYW1lcmEuICBGb3IgY2FtZXJhcyB3aXRoIG5vIGZyYW1lIHJhdGUgc2V0dGluZywgdGhpcyB2YWx1ZSB3aWxsIGJlIC0xLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mcmFtZVJhdGUgPSAtMTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY29uZmlndXJhdGlvbiBzZXR0aW5ncyBmb3IgdGhlIGNhbWVyYS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5DYW1lcmFDb25maWd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNvbmZpZyA9IG5ldyBFVldFQjIuQ2FtZXJhQ29uZmlnKHRoaXMpO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZsYWcgdXNlZCBpbnRlcm5hbGx5IGJ5IHBhbmVsIHRvIGRlY2lkZSBpZiBpdCBzaG91bGQgdHJ5IHRvIGluc3RhbnRpYXRlIGEgbmF0aXZlIChIMjY0KSBkZWNvZGVyLlxuICAgICAgICAgKiBJZiBhIGRlY29kZXIgd2FzIGluc3RhbnRpYXRlZCBmb3IgdGhpcyBjYW1lcmEgcHJldmlvdXNseSBpdCBjYW4gJ21hcmsnIHRoZSBjYW1lcmEgc28gdGhlIHBhbmVsXG4gICAgICAgICAqIGtub3dzIHRvIG5vdCB0cnkgYWdhaW4gZHVyaW5nIHRoZSBjdXJyZW50IHNlc3Npb24uXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmF0aXZlRGVjb2RpbmdGYWlsZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVW5pcXVlIElEIG9mIHRoZSBwYXJlbnQgY2FtZXJhXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhcmVudElkID0gdHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJyA/IGlkIDogJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSByb3RhdGlvbiwgaW4gZGVncmVlcywgb2YgdGhlIGNhbWVyYS5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucm90YXRpb24gPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcm5hbCB2YWx1ZSBvZiB0aGUgUFRaIGNhbWVyYSdzIHNwZWVkLiAgRGVmYXVsdHMgdG8gNTAuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHB0elNwZWVkID0gNTA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIHZhbHVlIHNwZWNpZml5aW5nIHdoZXRoZXIgdGhlIGZvcm1hdHMgb2YgdGhlIGNhbWVyYSBzdXBwb3J0IGdldEZyYW1lIHJlcXVlc3RzLiAgVGhpcyBpcyB1c2VkXG4gICAgICAgICAqIHRvIGNhY2hlIHRoZSB2YWx1ZSBvZiB7QGxpbmsgRVZXRUIyLkNhbWVyYS5zdXBwb3J0c0dldEZyYW1lfS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGZvcm1hdHNTdXBwb3J0R2V0RnJhbWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludGVybmFsIHZhbHVlIHNwZWNpZml5aW5nIHdoZXRoZXIgdGhlIGZvcm1hdHMgb2YgdGhlIGNhbWVyYSBzdXBwb3J0IGdldFZpZGVvIHJlcXVlc3RzLiAgVGhpcyBpcyB1c2VkXG4gICAgICAgICAqIHRvIGNhY2hlIHRoZSB2YWx1ZSBvZiB7QGxpbmsgRVZXRUIyLkNhbWVyYS5zdXBwb3J0c0dldFZpZGVvfS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGZvcm1hdHNTdXBwb3J0R2V0VmlkZW87XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihzZXJ2ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGN0eCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmN0eCA9IGN0eDtcbiAgICAgICAgfVxuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYocHR6ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHR6ID0gcHR6O1xuICAgICAgICB9XG4gICAgICAgIGlmKHB0elR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wdHpUeXBlID0gcHR6VHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihkaXNhYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmRpc2FibGVkID0gZGlzYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaGFzVmlkZW8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52aWRlbyA9IGhhc1ZpZGVvO1xuICAgICAgICB9XG4gICAgICAgIGlmKG9zZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZihvc2QucG9zaXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3NkLnBvc2l0aW9uID0gb3NkLnBvc2l0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYob3NkLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3NkLm5hbWUgPSBvc2QubmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG9zZC50aW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9zZC50aW1lID0gb3NkLnRpbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihvc2QuZGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vc2QuZGF0ZSA9IG9zZC5kYXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYob3NkLnRpbWV6b25lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9zZC50aW1lem9uZSA9IG9zZC50aW1lem9uZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihkaWdpdGFsUHR6VHlwZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5kaWdpdGFsUHR6VHlwZXMgPSBkaWdpdGFsUHR6VHlwZXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZm9ybWF0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZvcm1hdHMgPSBmb3JtYXRzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJlc29sdXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHV0aW9uID0gcmVzb2x1dGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihxdWFsaXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucXVhbGl0eSA9IHF1YWxpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZnJhbWVSYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWVSYXRlID0gZnJhbWVSYXRlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFyZW50SWQgPSBwYXJlbnRJZDtcbiAgICAgICAgfVxuICAgICAgICBpZihyb3RhdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gcm90YXRpb247XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgdGhlIGRpZ2l0YWwgUFRaIGluZm8gaWYgdHJhbnNjb2RpbmcgaXMgbm90IGF2YWlsYWJsZS5cbiAgICAgICAgaWYoJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnLCB0aGlzLmZvcm1hdHMpID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5kaWdpdGFsUHR6VHlwZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmRpZ2l0YWxQdHpUeXBlcyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyBhIHN0cmVhbSBJRCBmb3IgYSB2aWRlby53ZWIgb3IgcHVsbC53ZWIgcmVxdWVzdCBiYXNlZCBvZmYgb2YgdGhlIHByb3ZpZGVkIElELlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyZWFtSWQgVGhlIHN0cmVhbSBJRCB0byBwcm9jZXNzLlxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IEEgc3RyZWFtIElEXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgZ2VuZXJhdGVTdHJlYW1JZCA9IGZ1bmN0aW9uKHN0cmVhbUlkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHN0cmVhbUlkID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkID0gRVZXRUIyLnV0aWwuZ2VuZXJhdGVTdHJlYW1JZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHJlYW1JZCA9IEVWV0VCMi5jb25maWcuZGVmYXVsdFN0cmVhbUlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0cmVhbUlkO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIGZvcm1hdHMgb2YgdGhlIGNhbWVyYSBzdXBwb3J0IGdldEZyYW1lIHJlcXVlc3RzLlxuICAgICAgICAgKiBAcmV0dXJuIHtCb29sZWFufSBXaGV0aGVyIHRoZSBmb3JtYXRzIG9mIHRoZSBjYW1lcmEgc3VwcG9ydCBnZXRGcmFtZSByZXF1ZXN0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3VwcG9ydHNHZXRGcmFtZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYodHlwZW9mIGZvcm1hdHNTdXBwb3J0R2V0RnJhbWUgPT09ICd1bmRlZmluZWQnKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VwcG9ydHNKcGVnID0gJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWcsIHRoaXMuZm9ybWF0cykgIT09IC0xO1xuICAgICAgICAgICAgICAgIHZhciBzdXBwb3J0c1RyYW5zY29kZWRKcGVnID0gJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnLCB0aGlzLmZvcm1hdHMpICE9PSAtMTtcbiAgICAgICAgICAgICAgICBmb3JtYXRzU3VwcG9ydEdldEZyYW1lID0gc3VwcG9ydHNKcGVnIHx8IHN1cHBvcnRzVHJhbnNjb2RlZEpwZWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZm9ybWF0c1N1cHBvcnRHZXRGcmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBmb3JtYXRzIG9mIHRoZSBjYW1lcmEgc3VwcG9ydCBnZXRWaWRlbyByZXF1ZXN0cy5cbiAgICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0gV2hldGhlciB0aGUgZm9ybWF0cyBvZiB0aGUgY2FtZXJhIHN1cHBvcnQgZ2V0VmlkZW8gcmVxdWVzdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1cHBvcnRzR2V0VmlkZW8gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBmb3JtYXRzU3VwcG9ydEdldFZpZGVvID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZhciBzdHJlYW1hYmxlRm9ybWF0cyA9IFtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmNhbWVyYUZvcm1hdHMubXBlZzEsXG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5jYW1lcmFGb3JtYXRzLm1wZWcyLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIuY2FtZXJhRm9ybWF0cy5oMjYzLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIuY2FtZXJhRm9ybWF0cy5tcGVnNCxcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmNhbWVyYUZvcm1hdHMuaDI2NFxuICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgZm9ybWF0c1N1cHBvcnRHZXRWaWRlbyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBpLCBsZW47XG4gICAgICAgICAgICAgICAgZm9yKGk9MCwgbGVuPXN0cmVhbWFibGVGb3JtYXRzLmxlbmd0aDsgaTxsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZigkLmluQXJyYXkoc3RyZWFtYWJsZUZvcm1hdHNbaV0sIHRoaXMuZm9ybWF0cykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXRzU3VwcG9ydEdldFZpZGVvID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JtYXRzU3VwcG9ydEdldFZpZGVvO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHNTdXBwb3J0R2V0VmlkZW87XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyB0aGUgbGVnYWN5IHB1bGwud2ViIHJlcXVlc3QgZm9yIGEgZnJhbWUuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gaW5zdGFuY2UgVGhlIGNhbWVyYSBpbnN0YW5jZSBmb3IgdGhlIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIGltYWdlIGluIHBpeGVsc1xuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIGltYWdlIGluIHBpeGVsc1xuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gcXVhbGl0eSBRdWFsaXR5IGJldHdlZW4gMSBhbmQgMTAgd2l0aCB0aGUgbGV2ZWwgb2YgcXVhbGl0eSBvZiB0aGUgaW1hZ2UgKDEgbG93ZXN0LCAxMFxuICAgICAgICAgKiBoaWdoZXN0KVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlYXJjaElkXSBUaGUgdW5pcXVlIHNlYXJjaCBJRCBmb3IgdGhlIGZlZWRcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtzdHJlYW1JZF0gVGhlIHVuaXF1ZSBzdHJlYW0gSUQgZm9yIHRoZSBmZWVkXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIHB1bGwud2ViIFVSTCB0byByZXF1ZXN0IHRoZSBkZXNpcmVkIGZyYW1lIGZyb20gdGhpcyBDYW1lcmFcbiAgICAgICAgICovXG4gICAgICAgIHZhciBsZWdhY3lHZXRGcmFtZSA9IGZ1bmN0aW9uKGluc3RhbmNlLCB3aWR0aCwgaGVpZ2h0LCBxdWFsaXR5LCBzZWFyY2hJZCwgc3RyZWFtSWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBpbnN0YW5jZS5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxlZ2FjeUdldEZyYW1lO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAncz0nICsgaW5zdGFuY2Uuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnY2FtZXJhPScgKyBpbnN0YW5jZS5pZCxcbiAgICAgICAgICAgICAgICAncT0nICsgcXVhbGl0eSxcbiAgICAgICAgICAgICAgICAndz0nICsgd2lkdGgsXG4gICAgICAgICAgICAgICAgJ2g9JyArIGhlaWdodFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWFyY2hJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnc2VhcmNoX2lkPScgKyBzZWFyY2hJZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RyZWFtSWQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAoRVZXRUIyLmNvbmZpZy5kZWZhdWx0U3RyZWFtSWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmNvbmZpZy5kZWZhdWx0U3RyZWFtSWQgPSBFVldFQjIudXRpbC5nZW5lcmF0ZVN0cmVhbUlkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0cmVhbUlkID0gRVZXRUIyLmNvbmZpZy5kZWZhdWx0U3RyZWFtSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgnc3RyZWFtPScrc3RyZWFtSWQpO1xuXG4gICAgICAgICAgICB1cmwgKz0gJz8nICsgcGFyYW1zLmpvaW4oJzsnKSArICc7JztcblxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdXJsICs9IGRhdGUuZ2V0VGltZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcdFRoZSBjYW1lcmEgb2JqZWN0LCBvbmNlIHNldCwgaGFzIGFsbCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHJldHJpZXZlIGEgZnJhbWUgKGFuIGltYWdlKSBmcm9tIHRoZSB3ZWJcbiAgICAgICAgICpcdHNlcnZpY2UgZm9yIGl0LiAgU2luY2UgdGhpcyBpbWFnZSByZXF1aXJlcyBhIHNwZWNpZmljIFVSTCwgZWFjaCBDYW1lcmEgaW5zdGFuY2UgY29udGFpbnMgYSBtZXRob2RcbiAgICAgICAgICpcdHRvIGdlbmVyYXRlIHRoZSBVUkwgZm9yIHJldHJpZXZpbmcgZnJhbWVzLiAgSWYgdGhlIHNlYXJjaCBJRCBwYXJhbWV0ZXIgaXMgc2V0LCB0aGUgcmV0dXJuZWQgVVJMIHdpbGwgYmVcbiAgICAgICAgICpcdHB1bGxpbmcgZnJvbSBhbiBhbHJlYWR5IGluaXRpYWxpemVkIHNlYXJjaCBzZXNzaW9uLiAgVGhpcyBJRCB3aWxsIHBvaW50IHRvIHRoZSByZXF1ZXN0ZWQgaGlzdG9yeSBmZWVkXG4gICAgICAgICAqXHRmcm9tIHRoZSBjYW1lcmEuXG4gICAgICAgICAqXHRAcGFyYW0ge051bWJlcn0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSBpbWFnZSBpbiBwaXhlbHNcbiAgICAgICAgICpcdEBwYXJhbSB7TnVtYmVyfSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gcGl4ZWxzXG4gICAgICAgICAqXHRAcGFyYW0ge051bWJlcn0gcXVhbGl0eSBRdWFsaXR5IGJldHdlZW4gMSBhbmQgMTAgd2l0aCB0aGUgbGV2ZWwgb2YgcXVhbGl0eSBvZiB0aGUgaW1hZ2UgKDEgbG93ZXN0LCAxMFxuICAgICAgICAgKlx0aGlnaGVzdClcbiAgICAgICAgICpcdEBwYXJhbSB7U3RyaW5nfSBbc2VhcmNoSWRdIFRoZSB1bmlxdWUgc2VhcmNoIElEIGZvciB0aGUgZmVlZFxuICAgICAgICAgKlx0QHBhcmFtIHtTdHJpbmd9IFtzdHJlYW1JZF0gVGhlIHVuaXF1ZSBzdHJlYW0gSUQgZm9yIHRoZSBmZWVkXG4gICAgICAgICAqXG4gICAgICAgICAqXHRAcmV0dXJuIHtTdHJpbmd9IFRoZSBVUkwgdG8gcmVxdWVzdCB0aGUgZGVzaXJlZCBmcmFtZSBmcm9tIHRoaXMgQ2FtZXJhXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHF1YWxpdHksIHNlYXJjaElkLCBzdHJlYW1JZCkge1xuICAgICAgICAgICAgdmFyIHRlc3RDYW1lcmEgPSB0aGlzO1xuICAgICAgICAgICAgaWYodGhpcy5zb3VyY2VDYW1lcmEgIT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICB0ZXN0Q2FtZXJhID0gdGhpcy5zb3VyY2VDYW1lcmE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0ZXN0Q2FtZXJhLmZvcm1hdHMubGVuZ3RoID09PSAxICYmIHRlc3RDYW1lcmEuZm9ybWF0c1swXSA9PT0gRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWcpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBvbmx5IHRyYW5zY29kZWQgSlBFRyBpcyBhdmFpbGFibGUsIHRoaXMgc2VydmljZSBkb2Vzbid0IHByb3ZpZGUgdmlkZW8ud2ViLlxuICAgICAgICAgICAgICAgIHJldHVybiBsZWdhY3lHZXRGcmFtZSh0aGlzLCB3aWR0aCwgaGVpZ2h0LCBxdWFsaXR5LCBzZWFyY2hJZCwgc3RyZWFtSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIXRlc3RDYW1lcmEuc3VwcG9ydHNHZXRGcmFtZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdXJsID0gdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnZpZGVvO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAncz0nICsgdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICdjYW1lcmE9JyArIHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgJ3N0cmVhbT0nICsgZ2VuZXJhdGVTdHJlYW1JZChzdHJlYW1JZClcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlYXJjaElkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdzZWFyY2hfaWQ9JyArIHNlYXJjaElkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVzZU5hdGl2ZUpwZWcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBmb3J3YXJkaW5nU2V0dGluZ3MgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLmpwZWdGb3J3YXJkaW5nO1xuICAgICAgICAgICAgaWYoZm9yd2FyZGluZ1NldHRpbmdzLmVuYWJsZWQgJiYgJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWcsIHRoaXMuZm9ybWF0cykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdXNlTmF0aXZlSnBlZyA9IHRoaXMucXVhbGl0eSAqIChmb3J3YXJkaW5nU2V0dGluZ3MucXVhbGl0eVRocmVzaG9sZC8xMDApIDwgcXVhbGl0eSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5yZXNvbHV0aW9uLndpZHRoICogKGZvcndhcmRpbmdTZXR0aW5ncy5zaXplVGhyZXNob2xkLzEwMCkgPCB3aWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc29sdXRpb24uaGVpZ2h0ICogKGZvcndhcmRpbmdTZXR0aW5ncy5zaXplVGhyZXNob2xkLzEwMCkgPCBoZWlnaHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZm9ybWF0ID0gRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWc7XG4gICAgICAgICAgICBpZih1c2VOYXRpdmVKcGVnIHx8ICQuaW5BcnJheShFVldFQjIuY2FtZXJhRm9ybWF0cy50cmFuc2NvZGVkSnBlZywgdGhpcy5mb3JtYXRzKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICBmb3JtYXQgPSBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZm9ybWF0ICE9PSBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3c9Jyt3aWR0aCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2g9JytoZWlnaHQpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdxPScrcXVhbGl0eSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbXMucHVzaCgnZm9ybWF0PScrZm9ybWF0KTtcblxuICAgICAgICAgICAgdXJsICs9ICc/JyArIHBhcmFtcy5qb2luKCc7JykgKyAnOyc7XG5cbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHVybCArPSBkYXRlLmdldFRpbWUoKTtcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyB0aGUgbGVnYWN5IHB1bGwud2ViIHJlcXVlc3QgZm9yIGEgZnJhbWUgZG93bmxvYWQuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkNhbWVyYX0gaW5zdGFuY2UgVGhlIGNhbWVyYSBpbnN0YW5jZSBmb3IgdGhlIHJlcXVlc3QuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBmaWxlTmFtZSBUaGUgcmVxdWVzdGVkIG5hbWUgZm9yIHRoZSBmaWxlIGRvd25sb2FkLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gcXVhbGl0eSBRdWFsaXR5IGJldHdlZW4gMSBhbmQgMTAgd2l0aCB0aGUgbGV2ZWwgb2YgcXVhbGl0eSBvZiB0aGUgaW1hZ2UgKDEgbG93ZXN0LCAxMFxuICAgICAgICAgKiBoaWdoZXN0KVxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlYXJjaElkXSBUaGUgdW5pcXVlIHNlYXJjaCBJRCBmb3IgdGhlIGZlZWRcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtzdHJlYW1JZF0gVGhlIHVuaXF1ZSBzdHJlYW0gSUQgZm9yIHRoZSBmZWVkXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIHB1bGwud2ViIFVSTCB0byByZXF1ZXN0IHRoZSBkZXNpcmVkIGZyYW1lIGZyb20gdGhpcyBDYW1lcmFcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBsZWdhY3lHZXREb3dubG9hZEZyYW1lID0gZnVuY3Rpb24oaW5zdGFuY2UsIGZpbGVOYW1lLCBxdWFsaXR5LCBzZWFyY2hJZCwgc3RyZWFtSWQpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSBpbnN0YW5jZS5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxlZ2FjeUdldEZyYW1lO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAncz0nICsgaW5zdGFuY2Uuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnY2FtZXJhPScgKyBpbnN0YW5jZS5pZCxcbiAgICAgICAgICAgICAgICAncT0nICsgcXVhbGl0eSxcbiAgICAgICAgICAgICAgICAnZG93bmxvYWQ9JyArIGZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICdzdHJlYW09JyArIGdlbmVyYXRlU3RyZWFtSWQoc3RyZWFtSWQpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlYXJjaElkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdzZWFyY2hfaWQ9JyArIHNlYXJjaElkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXJsICs9ICc/JyArIHBhcmFtcy5qb2luKCc7JykgKyAnOyc7XG5cbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHVybCArPSBkYXRlLmdldFRpbWUoKTtcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdlbmVyYXRlcyBhIFVSTCB0byBkb3dubG9hZCB0aGUgY3VycmVudCBmcmFtZS5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGZpbGVOYW1lIE5hbWUgb2YgdGhlIGZpbGUgdG8gYmUgZG93bmxvYWRlZFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW3F1YWxpdHldIFF1YWxpdHkgYmV0d2VlbiAxIGFuZCAxMCB3aXRoIHRoZSBsZXZlbCBvZiBxdWFsaXR5IG9mIHRoZSBpbWFnZSAoMSBsb3dlc3QsXG4gICAgICAgICAqIDEwIGhpZ2hlc3QpXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VhcmNoSWRdIFRoZSB1bmlxdWUgc2VhcmNoIElEIGZvciB0aGUgZmVlZFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0cmVhbUlkXSBUaGUgdW5pcXVlIHN0cmVhbSBJRCBmb3IgdGhlIGZlZWRcbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgVVJMIHRvIHJlcXVlc3QgdGhlIGRlc2lyZWQgZnJhbWUgZnJvbSB0aGlzIENhbWVyYVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXREb3dubG9hZEZyYW1lID0gZnVuY3Rpb24gKGZpbGVOYW1lLCBxdWFsaXR5LCBzZWFyY2hJZCwgc3RyZWFtSWQpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZm9ybWF0cy5sZW5ndGggPT09IDEgJiYgdGhpcy5mb3JtYXRzWzBdID09PSBFVldFQjIuY2FtZXJhRm9ybWF0cy50cmFuc2NvZGVkSnBlZykge1xuICAgICAgICAgICAgICAgIC8vIElmIG9ubHkgdHJhbnNjb2RlZCBKUEVHIGlzIGF2YWlsYWJsZSwgdGhpcyBzZXJ2aWNlIGRvZXNuJ3QgcHJvdmlkZSB2aWRlby53ZWIuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlZ2FjeUdldERvd25sb2FkRnJhbWUodGhpcywgZmlsZU5hbWUsIHF1YWxpdHksIHNlYXJjaElkLCBzdHJlYW1JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZighdGhpcy5zdXBwb3J0c0dldEZyYW1lKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudmlkZW87XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gW1xuICAgICAgICAgICAgICAgICdzPScgKyB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgJ2NhbWVyYT0nICsgdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAnZG93bmxvYWQ9JyArIGZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICdzdHJlYW09JyArIGdlbmVyYXRlU3RyZWFtSWQoc3RyZWFtSWQpXG4gICAgICAgICAgICBdO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlYXJjaElkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdzZWFyY2hfaWQ9JyArIHNlYXJjaElkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHVzZU5hdGl2ZUpwZWcgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBmb3J3YXJkaW5nU2V0dGluZ3MgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLmpwZWdGb3J3YXJkaW5nO1xuICAgICAgICAgICAgaWYoZm9yd2FyZGluZ1NldHRpbmdzLmVuYWJsZWQgJiYgJC5pbkFycmF5KEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWcsIHRoaXMuZm9ybWF0cykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdXNlTmF0aXZlSnBlZyA9IHRoaXMucXVhbGl0eSAqIChmb3J3YXJkaW5nU2V0dGluZ3MucXVhbGl0eVRocmVzaG9sZC8xMDApIDwgcXVhbGl0eTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGZvcm1hdCA9IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnO1xuICAgICAgICAgICAgaWYodXNlTmF0aXZlSnBlZykge1xuICAgICAgICAgICAgICAgIGZvcm1hdCA9IEVWV0VCMi5jYW1lcmFGb3JtYXRzLmpwZWc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgncT0nK3F1YWxpdHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2Zvcm1hdD0nK2Zvcm1hdCk7XG5cbiAgICAgICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignOycpICsgJzsnO1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB1cmwgKz0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBERVBSRUNBVEVEOiBUaGlzIG1ldGhvZCBpcyBkZXByZWNhdGVkIGJ5IHtAbGluayBFVldFQjIuQ2FtZXJhLmdldFZpZGVvU3RyZWFtfS5cbiAgICAgICAgICpcbiAgICAgICAgICogR2VuZXJhdGVzIGEgVVJMIHRvIHJldHJpZXZlIGEgdmlkZW8gc3RyZWFtIGZvciB0aGUgY2FtZXJhLiAgRm9yIHRoZSBmb3JtYXRzXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnfSBhbmQge0BsaW5rIEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnfSwgdGhlIGdlbmVyYXRlZCBVUkwgd2lsbFxuICAgICAgICAgKiBwcm92aWRlIHRoZSBjdXJyZW50IGZyYW1lIChmdW5jdGlvbmFsbHkgdGhlIHNhbWUgYXMge0BsaW5rIEVWV0VCMi5DYW1lcmEuZ2V0RnJhbWV9KS4gIEZvciBhbGwgb3RoZXIgZm9ybWF0cyxcbiAgICAgICAgICogYSBzdHJlYW0gd2lsbCBiZSBvcGVuZWQuXG4gICAgICAgICAqIElmIHRoZSByZXF1ZXN0ZWQgZm9ybWF0IGlzIG5vdCBhdmFpbGFibGUsIGFuIGVtcHR5IHN0cmluZyB3aWxsIGJlIHJldHVybmVkLlxuICAgICAgICAgKiBAZGVwcmVjYXRlZFxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5jYW1lcmFGb3JtYXR9IGZvcm1hdCBUaGUgdmlkZW8gZm9ybWF0IHRvIGJlIHJlcXVlc3RlZC5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZWFyY2hJZF0gVGhlIHVuaXF1ZSBzZWFyY2ggSUQgZm9yIHRoZSBmZWVkXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc3RyZWFtSWRdIFRoZSB1bmlxdWUgc3RyZWFtIElEIGZvciB0aGUgZmVlZFxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Rvd25sb2FkRmlsZU5hbWVdIFRoZSBmaWxlIG5hbWUgdG8gc2V0IGZvciB0aGUgSFRUUCBDb250ZW50LURpc3Bvc2l0b246IEF0dGFjaG1lbnQgaGVhZGVyLlxuICAgICAgICAgKiBOb3RlOiBJZiB0aGlzIHZhbHVlIGlzIG5vdCBzZXQsIHRoZSBjb250ZW50IGRpc3Bvc2l0aW9uIHdpbGwgbm90IGJlIHNldC5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aF0gVGhlIHdpZHRoIG9mIHRoZSBpbWFnZSBpbiBwaXhlbHMuIFRoaXMgdmFsdWUgaXMgb25seSBwcm9jZXNzZWQgZm9yIHRoZSBmb3JtYXRcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnfVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW2hlaWdodF0gVGhlIGhlaWdodCBvZiB0aGUgaW1hZ2UgaW4gcGl4ZWxzLiBUaGlzIHZhbHVlIGlzIG9ubHkgcHJvY2Vzc2VkIGZvciB0aGUgZm9ybWF0XG4gICAgICAgICAqIHtAbGluayBFVldFQjIuY2FtZXJhRm9ybWF0cy50cmFuc2NvZGVkSnBlZ31cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtxdWFsaXR5XSBRdWFsaXR5IGJldHdlZW4gMSBhbmQgMTAgd2l0aCB0aGUgbGV2ZWwgb2YgcXVhbGl0eSBvZiB0aGUgaW1hZ2UgKDEgbG93ZXN0LCAxMFxuICAgICAgICAgKiBoaWdoZXN0KS4gVGhpcyB2YWx1ZSBpcyBvbmx5IHByb2Nlc3NlZCBmb3IgdGhlIGZvcm1hdCB7QGxpbmsgRVZXRUIyLmNhbWVyYUZvcm1hdHMudHJhbnNjb2RlZEpwZWd9XG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW211bHRpcGFydEVuY29kaW5nPWZhbHNlXSBVc2UgbXVsdGktcGFydCBlbmNvZGluZyBpbiB0aGUgcmVzcG9uc2Ugc3RyZWFtLiAgVGhlIG11bHRpLXBhcnRcbiAgICAgICAgICogZW5jb2Rpbmcgd2lsbCBtYXJrIGEgYm91bmRhcnkgYXQgZWFjaCBmcmFtZSwgcHJvdmlkaW5nIGZyYW1lLXNwZWNpZmljIGluZm9ybWF0aW9uOlxuICAgICAgICAgKiAgICAgQ29udGVudC1UeXBlOiBUaGUgY29udGVudC10eXBlIG9mIHRoZSBmcmFtZSBkYXRhXG4gICAgICAgICAqICAgICBEYXRhTGVuOiBUaGUgbGVuZ3RoIG9mIHRoZSBjdXJyZW50IGZyYW1lXG4gICAgICAgICAqICAgICBJZnJhbWU6IFdoZXRoZXIgdGhlIGZyYW1lIGlzIGFuIGlmcmFtZS4gIFByZXNlbnQgb25seSBpZiB0aGUgZnJhbWUgaXMgYW4gaWZyYW1lLlxuICAgICAgICAgKiAgICAgRnJhbWU6IChTZWFyY2ggb25seSkgVGhlIGZyYW1lIG51bWJlciBpbiB0aGUgY29udGV4dCBvZiB0aGUgZW50aXJlIHNlYXJjaFxuICAgICAgICAgKiAgICAgVGltZU9mZnNldDogKFNlYXJjaCBvbmx5KSBUaGUgdGltZSBvZmZzZXQsIGluIG1zLCBpbiB0aGUgY29udGV4dCBvZiB0aGUgZW50aXJlIHNlYXJjaC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgVVJMIHRvIHJlcXVlc3QgdGhlIHZpZGVvIGZyYW1lIGZvciB0aGlzIGNhbWVyYS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VmlkZW8gPSBmdW5jdGlvbiAoZm9ybWF0LCBzZWFyY2hJZCwgc3RyZWFtSWQsIGRvd25sb2FkRmlsZU5hbWUsIHdpZHRoLCBoZWlnaHQsIHF1YWxpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlwYXJ0RW5jb2RpbmcpIHtcbiAgICAgICAgICAgIGlmKCQuaW5BcnJheShmb3JtYXQsIHRoaXMuZm9ybWF0cykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5mb3JtYXRzLmxlbmd0aCA9PT0gMSAmJiB0aGlzLmZvcm1hdHNbMF0gPT09IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgb25seSB0cmFuc2NvZGVkIEpQRUcgaXMgYXZhaWxhYmxlLCB0aGlzIHNlcnZpY2UgZG9lc24ndCBwcm92aWRlIHZpZGVvLndlYi5cbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBtdWx0aXBhcnRFbmNvZGluZyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBtdWx0aXBhcnRFbmNvZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgdXJsID0gdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnZpZGVvO1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAncz0nICsgdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICdjYW1lcmE9JyArIHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgJ2Zvcm1hdD0nICsgZm9ybWF0LFxuICAgICAgICAgICAgICAgICdzdHJlYW09JyArIGdlbmVyYXRlU3RyZWFtSWQoc3RyZWFtSWQpXG4gICAgICAgICAgICBdO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWFyY2hJZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnc2VhcmNoX2lkPScgKyBzZWFyY2hJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihmb3JtYXQgPT09IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3c9Jyt3aWR0aCk7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2g9JytoZWlnaHQpO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdxPScrcXVhbGl0eSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBkb3dubG9hZEZpbGVOYW1lICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdkb3dubG9hZD0nK2Rvd25sb2FkRmlsZU5hbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihtdWx0aXBhcnRFbmNvZGluZykge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdtdWx0aXBhcnRfZW5jb2RlPTEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignOycpICsgJzsnO1xuXG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB1cmwgKz0gZGF0ZS5nZXRUaW1lKCk7XG4gICAgICAgICAgICByZXR1cm4gdXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZ2V0VmlkZW9TdHJlYW0gZnVuY3Rpb24gZ2VuZXJhdGVzIGEgY29uZmlndXJlZCBzdHJlYW0gaW5zdGFuY2UgZm9yIHRoaXMgY2FtZXJhLiBPbmNlIHJldHVybmVkLCBjb25zdW1lcnNcbiAgICAgICAgICogY2FsbCB7QGxpbmsgRVZXRUIyLlZpZGVvU3RyZWFtI3N0YXJ0fEVWV0VCMi5WaWRlb1N0cmVhbS5zdGFydCgpfSB0byBiZWdpbiByZWNlaXZpbmcgZnJhbWVzLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gZm9ybWF0IFRoZSB2aWRlbyBmb3JtYXQuIE9uZSBvZiB0aGUgY2FtZXJhJ3Mgc3VwcG9ydGVkIHtAbGluayBFVldFQjIuY2FtZXJhRm9ybWF0c30uXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbc3RyZWFtSWQ9Z2VuZXJhdGVTdHJlYW1JZCgpXSBBIHN0cmVhbSBpZC5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFt3aWR0aF0gVHJhbnNjb2RlZCBpbWFnZSB3aWR0aC4gSWdub3JlZCBmb3IgbmF0aXZlIGZvcm1hdHMuXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0XSBUcmFuc2NvZGVkIGltYWdlIGhlaWdodC4gSWdub3JlZCBmb3IgbmF0aXZlIGZvcm1hdHMuXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbcXVhbGl0eV0gVHJhbnNjb2RlZCBpbWFnZSBxdWFsaXR5IG9uIHRoZSBpbnRlcnZhbCBbMSwxMF0uIElnbm9yZWQgZm9yIG5hdGl2ZSBmb3JtYXRzLlxuICAgICAgICAgKiBAcmV0dXJuIHtFVldFQjIuVmlkZW9TdHJlYW19IEEgc3RyZWFtIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRWaWRlb1N0cmVhbSA9IGZ1bmN0aW9uKGZvcm1hdCwgc3RyZWFtSWQsIHdpZHRoLCBoZWlnaHQsIHF1YWxpdHkpIHtcbiAgICAgICAgICAgIHZhciB1cmwgPSB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpO1xuICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCdodHRwOi8vJykgPT09IDApIHtcbiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnaHR0cDovLycsICd3czovLycpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnaHR0cHM6Ly8nLCAnd3NzOi8vJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVybCArPSBFVldFQjIudXJscy52aWRlbztcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBbXG4gICAgICAgICAgICAgICAgJ3M9JyArIHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAnY2FtZXJhPScgKyB0aGlzLmlkLFxuICAgICAgICAgICAgICAgICdmb3JtYXQ9JyArIGZvcm1hdCxcbiAgICAgICAgICAgICAgICAnc3RyZWFtPScgKyBnZW5lcmF0ZVN0cmVhbUlkKHN0cmVhbUlkKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ3c9JyArIHdpZHRoKTtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgnaD0nICsgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaCgncT0nICsgcXVhbGl0eSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVybCArPSAnPycgKyBwYXJhbXMuam9pbignJicpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVmlkZW9TdHJlYW0odXJsLCBmb3JtYXQpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZ2V0U2VhcmNoU25hcHNob3QgbWV0aG9kIGFsbG93cyB0aGUgY2FsbGVyIHRvIHJldHJpZXZlIGEgc2luZ2xlLCBwcmV2aW91c2x5LXJlY29yZGVkIGZyYW1lIGZyb20gYSBjYW1lcmEuXG4gICAgICAgICAqIE5vdGUgdGhhdCBkdWUgdG8gdGhlIG92ZXJoZWFkIGludm9sdmVkIHdpdGggcmV0cmlldmluZyBhIHNpbmdsZSBmcmFtZSBmcm9tIHRoZSBzZXJ2ZXIsIHRoaXMgbWV0aG9kIHNob3VsZCBOT1RcbiAgICAgICAgICogYmUgdXNlZCB0byBwZXJmb3JtIHN0b3JlZCB2aWRlbyBwbGF5YmFjay4gSWYgeW91IHdpc2ggdG8gY29uZHVjdCBwbGF5YmFjayBvZiByZWNvcmRlZCB2aWRlbywgZG8gc28gYnlcbiAgICAgICAgICogY3JlYXRpbmcgYSB7QGxpbmsgRVZXRUIyLmdldFNlYXJjaHxzZWFyY2h9LlxuICAgICAgICAgKiBAcGFyYW0ge0RhdGV9IHRpbWUgVGhlIHRpbWUgZm9yIHdoaWNoIHRvIHJldHJpZXZlIGEgZnJhbWUuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLmNhbWVyYUZvcm1hdHN9IGZvcm1hdCBUaGUgZGVzaXJlZCBmcmFtZSBmb3JtYXQuIE5vdGUgdGhhdCBzaW5jZSB0aGlzIG1ldGhvZCByZXRyaWV2ZXMgYSBzaW5nbGVcbiAgICAgICAgICogZnJhbWUsIHlvdSBNVVNUIHJlcXVlc3QgZWl0aGVyIHtAbGluayBFVldFQjIuY2FtZXJhRm9ybWF0cy5qcGVnfG5hdGl2ZX0gb3JcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnfHRyYW5zY29kZWQgSlBFR30uXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbd2lkdGhdIFRyYW5zY29kZWQgaW1hZ2Ugd2lkdGggaWYgcmVxdWVzdGluZyB0cmFuc2NvZGVkIEpQRUcuXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaGVpZ2h0XSBUcmFuc2NvZGVkIGltYWdlIGhlaWdodCBpZiByZXF1ZXN0aW5nIHRyYW5zY29kZWQgSlBFRy5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtxdWFsaXR5XSBUcmFuc2NvZGVkIGltYWdlIHF1YWxpdHkgb24gdGhlIGludGVydmFsIFsxLDEwXSBpZiByZXF1ZXN0aW5nIHRyYW5zY29kZWQgSlBFRy5cbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBBIFVSTCB0aGF0IHBvaW50cyB0byBhIGZyYW1lIGZvciB0aGUgY2FtZXJhIGF0IHRoZSBnaXZlbiB0aW1lLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTZWFyY2hTbmFwc2hvdCA9IGZ1bmN0aW9uKHRpbWUsIGZvcm1hdCwgd2lkdGgsIGhlaWdodCwgcXVhbGl0eSkge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IFtcbiAgICAgICAgICAgICAgICAncz0nICsgdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICdjYW1lcmE9JyArIHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgJ3RpbWU9JyArIEVWV0VCMi51dGlsLkRhdGUySUVURih0aW1lLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAnZm9ybWF0PScgKyBmb3JtYXRcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXIuc2VydmljZS5qcGVnRm9yd2FyZGluZy5lbmFibGVkICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJ2ZXIuc2VydmljZS5qcGVnRm9yd2FyZGluZy5zaG91bGRGb3J3YXJkKHRoaXMsIHdpZHRoLCBoZWlnaHQsIHF1YWxpdHkpKSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0ID0gRVZXRUIyLmNhbWVyYUZvcm1hdHMuanBlZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmb3JtYXQgPT09IEVWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCd3PScgKyB3aWR0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChoZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goJ2g9JyArIGhlaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChxdWFsaXR5KSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5wdXNoKCdxPScgKyBxdWFsaXR5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlYXJjaFNuYXBzaG90ICsgJz8nICsgcGFyYW1zLmpvaW4oJyYnKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHRoZSBQVFogcHJlc2V0cyBmb3IgdGhpcyBjYW1lcmFcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgYW4gYXJyYXkgb2ZcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUHR6UHJlc2V0fSBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFB0elByZXNldHMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYoIXRoaXMucHR6KSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdDYW1lcmEgZG9lcyBub3Qgc3VwcG9ydCBQVFouJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uR2V0UHR6UHJlc2V0c0Vycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0UHR6UHJlc2V0c1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoZGF0YSA9PT0gRVZXRUIyLmVycm9ycy5wdHopIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICBvbkdldFB0elByZXNldHNFcnJvcigpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIHYyLjAgd2ViIHNlcnZpY2VzIGRvbid0IHJldHVybiBhIHByb3BlciBKU09OIG9iamVjdCwgYXMgbm8gY2FsbGJhY2sgd3JhcHMgdGhlIHJlc3BvbnNlLiAgRm9yIHRoZXNlXG4gICAgICAgICAgICAgICAgLy8gcmVzcG9uc2VzLCBhdHRlbXB0IHRvIG1hbnVhbGx5IHBhcnNlIHRoZSBKU09OLlxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2goZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkdldFB0elByZXNldHNFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJlc2V0cyA9ICQubWFwKGRhdGEuUHJlc2V0cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5QdHpQcmVzZXQoZWxlbWVudC5pZCwgZWxlbWVudC5uYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgY2FtZXJhLCBwcmVzZXRzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFB0elByZXNldHNTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldFB0elByZXNldHNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMucHR6LFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICBjYW1lcmE6IHRoaXMuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHRoZSBjYW1lcmEgdG8gYSBQVFogcHJlc2V0XG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcmVzZXRJZCBUaGUgSUQgb2YgdGhlIHByZXNldC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVjYWxsUHR6UHJlc2V0ID0gZnVuY3Rpb24ocHJlc2V0SWQpIHtcbiAgICAgICAgICAgIGlmKCF0aGlzLnB0eikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIGRvZXMgbm90IHN1cHBvcnQgUFRaLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBjYW1lcmE6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgcHJlc2V0OiBwcmVzZXRJZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVyLnJlcXVpcmVzUmVzb3VyY2VLZXkoKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlci5zZXJ2aWNlLnJlc291cmNlS2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDU1JGIGVuZm9yY2VkLCBwYXNzdGhyb3VnaCB3aWxsIG5vdCB3b3JrLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFyYW1zLmtleSA9IHRoaXMuc2VydmVyLnNlcnZpY2UucmVzb3VyY2VLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gdGhpcy5zZXJ2ZXIuc2VydmljZTtcblxuICAgICAgICAgICAgdmFyIG9uVmVyc2lvbkNhbGxiYWNrID0gZnVuY3Rpb24ocmVzcG9uc2UsIHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBWZXJzaW9uIDIuMCBkaWQgbm90IHN1cHBvcnQgUE9TVCBQVFogcmVxdWVzdHMuICBBcyBzdWNoLCBvbmx5IHBlcmZvcm0gYVxuICAgICAgICAgICAgICAgIC8vIFBPU1QgYWN0aW9uIG9uIG5ld2VyIG1ldGhvZHMuXG4gICAgICAgICAgICAgICAgdmFyIGlzR2V0TWV0aG9kID0gdmVyc2lvbiA9PT0gJzIuMC4wJztcblxuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMucHR6LFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBpc0dldE1ldGhvZCA/ICdHRVQnIDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZpY2UsIHRydWUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyLnNlcnZpY2UudmVyc2lvbihvblZlcnNpb25DYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1vdmVzIHRoZSBjYW1lcmEgaW4gYSBkaXJlY3Rpb24uXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLnB0ekRpcmVjdGlvbnN9IGRpcmVjdGlvbiBUaGUgZGlyZWN0aW9uIHRvIG1vdmUgdGhlIGNhbWVyYS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHR6TW92ZSA9IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgaWYoIXRoaXMucHR6KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW1lcmEgZG9lcyBub3Qgc3VwcG9ydCBQVFouJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIGNhbWVyYTogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICBkaXI6IGRpcmVjdGlvblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVyLnJlcXVpcmVzUmVzb3VyY2VLZXkoKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlci5zZXJ2aWNlLnJlc291cmNlS2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDU1JGIGVuZm9yY2VkLCBwYXNzdGhyb3VnaCB3aWxsIG5vdCB3b3JrLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFyYW1zLmtleSA9IHRoaXMuc2VydmVyLnNlcnZpY2UucmVzb3VyY2VLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gdGhpcy5zZXJ2ZXIuc2VydmljZTtcblxuICAgICAgICAgICAgdmFyIG9uVmVyc2lvbkNhbGxiYWNrID0gZnVuY3Rpb24ocmVzcG9uc2UsIHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICAvLyBWZXJzaW9uIDIuMCBkaWQgbm90IHN1cHBvcnQgUE9TVCBQVFogcmVxdWVzdHMuICBBcyBzdWNoLCBvbmx5IHBlcmZvcm0gYVxuICAgICAgICAgICAgICAgIC8vIFBPU1QgYWN0aW9uIG9uIG5ld2VyIG1ldGhvZHMuXG4gICAgICAgICAgICAgICAgdmFyIGlzR2V0TWV0aG9kID0gdmVyc2lvbiA9PT0gJzIuMC4wJztcblxuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMucHR6LFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBpc0dldE1ldGhvZCA/ICdHRVQnIDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZpY2UsIHRydWUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyLnNlcnZpY2UudmVyc2lvbihvblZlcnNpb25DYWxsYmFjayk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIFBUWiBzcGVlZCBvZiB0aGUgY2FtZXJhXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzcGVlZCBUaGUgUFRaIHNwZWVkIGZvciB0aGUgY2FtZXJhICgwLTEwMCkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNldFB0elNwZWVkID0gZnVuY3Rpb24oc3BlZWQpIHtcbiAgICAgICAgICAgIGlmKCF0aGlzLnB0eikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIGRvZXMgbm90IHN1cHBvcnQgUFRaLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBwdHpTcGVlZCA9IHNwZWVkO1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBjYW1lcmE6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgenBlZWQ6IHNwZWVkLFxuICAgICAgICAgICAgICAgIHRzcGVlZDogc3BlZWQsXG4gICAgICAgICAgICAgICAgcHNwZWVkOiBzcGVlZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVyLnJlcXVpcmVzUmVzb3VyY2VLZXkoKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlci5zZXJ2aWNlLnJlc291cmNlS2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDU1JGIGVuZm9yY2VkLCBwYXNzdGhyb3VnaCB3aWxsIG5vdCB3b3JrLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFyYW1zLmtleSA9IHRoaXMuc2VydmVyLnNlcnZpY2UucmVzb3VyY2VLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5wdHosXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UsIHRydWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIHRoZSBQVFogc3BlZWQgb2YgdGhlIGNhbWVyYVxuICAgICAgICAgKiBAcmV0dXJuIHtOdW1iZXJ9IFRoZSBQVFogc3BlZWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0UHR6U3BlZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCF0aGlzLnB0eikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIGRvZXMgbm90IHN1cHBvcnQgUFRaLicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcHR6U3BlZWQ7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2hlY2tzIHRvIHNlZSBpZiBkaWdpdGFsIFBUWiBvZiB0aGUgY2FtZXJhIGNhbiBtb3ZlIGluIGEgZGlyZWN0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCB0aGUgZGlnaXRhbCBQVFogSUQsIGFuZCBhXG4gICAgICAgICAqICBCb29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgbW92ZSBjYW4gYmUgbWFkZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIucHR6RGlyZWN0aW9uc30gZGlyZWN0aW9uIFRoZSBkaXJlY3Rpb24gdG8gbW92ZSB0aGUgY2FtZXJhLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wdHpDYW5Nb3ZlID0gZnVuY3Rpb24oY2FsbGJhY2ssIGRpcmVjdGlvbikge1xuICAgICAgICAgICAgaWYoIXRoaXMucHR6KSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdDYW1lcmEgZG9lcyBub3Qgc3VwcG9ydCBQVFouJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMucHR6VHlwZSA9PT0gRVZXRUIyLnB0elR5cGVzLnN0YW5kYXJkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkRpZ2l0YWxQdHpDYW5Nb3ZlRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25EaWdpdGFsUHR6Q2FuTW92ZVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL0NhbGwgdGhlIGVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIG9uRGlnaXRhbFB0ekNhbk1vdmVFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBkYXRhLmNhbk1vdmUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uRGlnaXRhbFB0ekNhbk1vdmVTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkRpZ2l0YWxQdHpDYW5Nb3ZlRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmRpZ2l0YWxQdHosXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHB0ejogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICAgICAgZGlyOiBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9uZXMgYSBjYW1lcmFcbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqIEByZXR1cm4ge0VWV0VCMi5DYW1lcmF9IFRoZSBjbG9uZWQgaW5zdGFuY2VcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2xvbmVDYW1lcmEgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBwdHpUeXBlcyA9IHRoaXMuZGlnaXRhbFB0elR5cGVzLnNsaWNlKDApO1xuICAgICAgICAgICAgdmFyIGZvcm1hdHMgPSB0aGlzLmZvcm1hdHMuc2xpY2UoMCk7XG4gICAgICAgICAgICB2YXIgcmVzb2x1dGlvbjtcbiAgICAgICAgICAgIGlmKHRoaXMucmVzb2x1dGlvbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJlc29sdXRpb24gPSBuZXcgRVZXRUIyLkNhbWVyYVJlc29sdXRpb24odGhpcy5yZXNvbHV0aW9uLndpZHRoLCB0aGlzLnJlc29sdXRpb24uaGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjbG9uZWRDYW1lcmEgPSBuZXcgRVZXRUIyLkNhbWVyYSh0aGlzLnNlcnZlciwgdGhpcy5pZCwgdGhpcy5jdHgsIHRoaXMubmFtZSwgdGhpcy5wdHosIHRoaXMuZGlzYWJsZWQsXG4gICAgICAgICAgICAgICAgdGhpcy52aWRlbywgdGhpcy5vc2QsIHRoaXMucHR6VHlwZSwgcHR6VHlwZXMsIGZvcm1hdHMsIHJlc29sdXRpb24sIHRoaXMucXVhbGl0eSk7XG4gICAgICAgICAgICBjbG9uZWRDYW1lcmEuc291cmNlQ2FtZXJhID0gdGhpcy5zb3VyY2VDYW1lcmE7XG4gICAgICAgICAgICBjbG9uZWRDYW1lcmEuZGlnaXRhbFB0elR5cGUgPSB0aGlzLmRpZ2l0YWxQdHpUeXBlO1xuICAgICAgICAgICAgcmV0dXJuIGNsb25lZENhbWVyYTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxhc3QgdXNlZCBjYWNoZSBicmVhayB0aW1lLCB1c2VkIHRvIGF2b2lkIHNlbmRpbmcgdGhlIHNhbWUgY2FjaGUgYnJlYWsgcGFyYW1ldGVyIHR3aWNlLiAgU2VlXG4gICAgICAgICAqIHtAbGluayBnZW5lcmF0ZUNhY2hlQnJlYWtQYXJhbWV0ZXJ9IGZvciBtb3JlIGRldGFpbHMuXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGxhc3RDYWNoZUJyZWFrVGltZSA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb3VudCBvZiB0aGUgbnVtYmVyIG9mIHRpbWVzIHRoZSBsYXN0Q2FjaGVCcmVha1RpbWUgaGFzIGJlZW4gdXNlZC4gIFVzZWQgdG8gYXZvaWQgc2VuZGluZyB0aGUgc2FtZSBjYWNoZVxuICAgICAgICAgKiBicmVhayBwYXJhbWV0ZXIgdHdpY2UuICBTZWUge0BsaW5rIGdlbmVyYXRlQ2FjaGVCcmVha1BhcmFtZXRlcn0gZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgbGFzdENhY2hlQnJlYWtDb3VudCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENocm9tZSBoYXMgYSB0ZW5kZW5jeSB0byBjYWNoZSByZXF1ZXN0cywgZXZlbiBpZiB0aGUgY2FjaGUtY29udHJvbCBoZWFkZXJzIGFyZSBzZXQgdG8gbm8tc3RvcmUsIG5vLWNhY2hlLlxuICAgICAgICAgKiBUaGlzIGNvbWVzIGludG8gcGxheSBwcmltYXJpbHkgd2hlbiBjcmVhdGluZyBtdWx0aXBsZSBkaWdpdGFsIFBUWiBjYW1lcmFzIGZyb20gdGhlIHNhbWUgc291cmNlIGNhbWVyYSBpbiBhXG4gICAgICAgICAqIHNob3J0IGludGVydmFsIChzdWNoIGFzIHdoZW4gbG9hZGluZyBhIGN1c3RvbSB2aWV3KS4gIEluIHRoaXMgc2l0dWF0aW9uLCBvbmx5IG9uZSByZXF1ZXN0IGlzIG1hZGUsIHN1Y2ggdGhhdFxuICAgICAgICAgKiB0aGUgbXVsdGlwbGUgZGlnaXRhbCBQVFogY2FtZXJhcyBhbGwgc2hhcmUgdGhlIHNhbWUgSUQuICBUbyBnZXQgYXJvdW5kIHRoaXMsIHdlJ3JlIGFwcGVuZGluZyBhIHRpbWVzdGFtcCBhc1xuICAgICAgICAgKiBhIGNhY2hlIGJyZWFrZXIgb24gY3JlYXRlIGRpZ2l0YWwgUFRaIHJlcXVlc3RzLiAgSG93ZXZlciwgcmVxdWVzdHMgY2FuIGJlIHRyaWdnZXIgbW9yZSB0aGFuIG9uY2UgcGVyIG1zLCBzb1xuICAgICAgICAgKiBzdG9yZSB0aGUgcHJldmlvdXMgcmVxdWVzdHMsIGFuZCBpZiBhbiBpZGVudGljYWwgcmVxdWVzdCBpcyBwcmVzZW50LCBpbmNyZW1lbnQgaXQgYnkgb25lLlxuICAgICAgICAgKiBAaW50ZXJuYWxcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfSBUaGUgY2FjaGUgYnJlYWsgcGFyYW1ldGVyXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgZ2VuZXJhdGVDYWNoZUJyZWFrUGFyYW1ldGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgY2FjaGVCcmVhayA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICBpZihsYXN0Q2FjaGVCcmVha1RpbWUgPT09IGNhY2hlQnJlYWspIHtcbiAgICAgICAgICAgICAgICBsYXN0Q2FjaGVCcmVha0NvdW50Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsYXN0Q2FjaGVCcmVha1RpbWUgPSBjYWNoZUJyZWFrO1xuICAgICAgICAgICAgICAgIGxhc3RDYWNoZUJyZWFrQ291bnQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGxhc3RDYWNoZUJyZWFrVGltZS50b1N0cmluZygpICsgbGFzdENhY2hlQnJlYWtDb3VudC50b1N0cmluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDcmVhdGVzIGEgZGlnaXRhbCBQVFogcmVjdGFuZ2xlXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UsIHRoZSB7QGxpbmsgRVZXRUIyLkNhbWVyYX0gaW5zdGFuY2UsIHRoZSBnZW5lcmF0ZWQgZGlnaXRhbCBQVFogSUQsXG4gICAgICAgICAqICBhbmQgYSB7QGxpbmsgRVZXRUIyLkRpZ2l0YWxQdHpSZWN0YW5nbGV9IGluc3RhbmNlIGRlc2NyaWJpbmcgdGhlIGN1cnJlbnQgcmVjdGFuZ2xlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5kaWdpdGFsUHR6VHlwZXN9IGRpZ2l0YWxQdHpUeXBlIFRoZSB0eXBlIG9mIGRpZ2l0YWwgUFRaIHJlY3RhbmdsZSB0byBjcmVhdGUuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VhcmNoSWRdIFRoZSBzZWFyY2ggSUQgZm9yIHRoaXMgY2FtZXJhLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWV3fSBbdmlld10gQSB2aWV3IGZvciB0aGlzIGNhbWVyYSB0byBhcHBseSBhbnkgdmlldy1zcGVjaWZpYyBkaWdpdGFsIFBUWi4gIHtAbGluayBzbG90SW5kZXh9XG4gICAgICAgICAqICBpcyByZXF1aXJlZCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwcmVzZW50LlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW3Nsb3RJbmRleF0gVGhlIHNsb3QgaW5kZXggZm9yIHRoZSB2aWV3LiAge0BsaW5rIHZpZXd9IGlzIHJlcXVpcmVkIGlmIHRoaXMgcGFyYW1ldGVyIGlzXG4gICAgICAgICAqICBwcmVzZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jcmVhdGVEaWdpdGFsUHR6Q2FtZXJhID0gZnVuY3Rpb24oY2FsbGJhY2ssIGRpZ2l0YWxQdHpUeXBlLCBzZWFyY2hJZCwgdmlldywgc2xvdEluZGV4KSB7XG4gICAgICAgICAgICBpZih0aGlzLmRpZ2l0YWxQdHpUeXBlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbWVyYSBkb2VzIG5vdCBzdXBwb3J0IGRpZ2l0YWwgUFRaLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJC5pbkFycmF5KGRpZ2l0YWxQdHpUeXBlLCB0aGlzLmRpZ2l0YWxQdHpUeXBlcykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW1lcmEgZG9lcyBub3Qgc3VwcG9ydCB0aGlzIHR5cGUgb2YgZGlnaXRhbCBQVFouJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXNzaW9uSWQgPSB0aGlzLnNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICBpZihzZWFyY2hJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbklkID0gc2VhcmNoSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uQ3JlYXRlRGlnaXRhbFB0elJlY3RhbmdsZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uQ3JlYXRlRGlnaXRhbFB0elJlY3RhbmdsZVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL0NhbGwgdGhlIGVycm9yIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgIG9uQ3JlYXRlRGlnaXRhbFB0elJlY3RhbmdsZUVycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvL0Fzc2lnbiB0aGUgZGlnaXRhbCBQVFogSURcbiAgICAgICAgICAgICAgICB2YXIgZGlnaXRhbFB0eklkID0gZGF0YS5wdHpJZDtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgLy9DcmVhdGUgdGhlIGRpZ2l0YWwgUFRaIGNhbWVyYVxuICAgICAgICAgICAgICAgIHZhciBkaWdpdGFsUHR6Q2FtID0gY2FtZXJhLmNsb25lQ2FtZXJhKCk7XG4gICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5pZCA9IGRpZ2l0YWxQdHpJZDtcbiAgICAgICAgICAgICAgICBkaWdpdGFsUHR6Q2FtLnB0eiA9IHRydWU7XG4gICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5zb3VyY2VDYW1lcmEgPSBjYW1lcmE7XG4gICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5kaWdpdGFsUHR6VHlwZSA9IGRpZ2l0YWxQdHpUeXBlO1xuICAgICAgICAgICAgICAgIGRpZ2l0YWxQdHpDYW0ucHR6VHlwZSA9IEVWV0VCMi5wdHpUeXBlcy5kaWdpdGFsO1xuXG4gICAgICAgICAgICAgICAgLy8gRGlnaXRhbCBQVFogaXMgb25seSBhdmFpbGFibGUgYXMgdHJhbnNjb2RlZCBKUEVHXG4gICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5mb3JtYXRzID0gW0VWV0VCMi5jYW1lcmFGb3JtYXRzLnRyYW5zY29kZWRKcGVnXTtcblxuICAgICAgICAgICAgICAgIGlmKHNlYXJjaElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IHNlcnZlciB3aXRoIHRoZSBzZXNzaW9uIElEIHNldCB0byB0aGUgc291cmNlIGNhbWVyYVxuICAgICAgICAgICAgICAgICAgICAvLyB2YXIgcyA9IGNhbWVyYS5zZXJ2ZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vIGRpZ2l0YWxQdHpDYW0uc2VydmVyID0gbmV3IEVWV0VCMi5TZXJ2ZXIocy5zZXJ2aWNlLCBzLm5hbWUsIHMuaWQsIHMubG9naW4sIHMucmVzdHJpY3RlZCxcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHNlc3Npb25JZCwgcy5nbXRPZmZzZXQsIHMub3NkKTtcbiAgICAgICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5zZXJ2ZXIgPSAkLmV4dGVuZCh7fSwgY2FtZXJhLnNlcnZlciwge3Nlc3Npb25JZDogc2Vzc2lvbklkfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGlnaXRhbFB0ekNhbS5zZXRQdHpTcGVlZCg1MCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHJlY3RhbmdsZSBpbnN0YW5jZVxuICAgICAgICAgICAgICAgIHZhciByZWN0YW5nbGUgPSBuZXcgRVZXRUIyLkRpZ2l0YWxQdHpSZWN0YW5nbGUoZGF0YS54LCBkYXRhLnksIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGlnaXRhbFB0ekNhbSwgcmVjdGFuZ2xlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkNyZWF0ZURpZ2l0YWxQdHpSZWN0YW5nbGVTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkNyZWF0ZURpZ2l0YWxQdHpSZWN0YW5nbGVFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZGlnaXRhbFB0eixcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBkaWdpdGFsUHR6VHlwZSxcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVCcmVhazogZ2VuZXJhdGVDYWNoZUJyZWFrUGFyYW1ldGVyKClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZih2aWV3ICE9PSB1bmRlZmluZWQgJiYgc2xvdEluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5kYXRhLnZpZXcgPSB2aWV3Lm5hbWU7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF0YS5zbG90ID0gc2xvdEluZGV4O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgY3VycmVudCBkaWdpdGFsIFBUWiByZWN0YW5nbGVcbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSwgdGhlIHRoZSB7QGxpbmsgRVZXRUIyLkNhbWVyYX1cbiAgICAgICAgICogIGluc3RhbmNlLCB0aGUgZGlnaXRhbCBQVFogSUQsIGFuZCBhIHtAbGluayBFVldFQjIuRGlnaXRhbFB0elJlY3RhbmdsZX0gaW5zdGFuY2UgZGVzY3JpYmluZyB0aGUgY3VycmVudFxuICAgICAgICAgKiAgcmVjdGFuZ2xlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXREaWdpdGFsUHR6UmVjdGFuZ2xlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZGlnaXRhbFB0elR5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIGRvZXMgbm90IHN1cHBvcnQgZGlnaXRhbCBQVFouJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLnNvdXJjZUNhbWVyYSA9PT0gdGhpcykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnVGhpcyBjYW1lcmEgaXMgbm90IGEgZGlnaXRhbCBQVFogY2FtZXJhLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNhbWVyYSA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgb25HZXREaWdpdGFsUHR6UmVjdGFuZ2xlRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXREaWdpdGFsUHR6UmVjdGFuZ2xlU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vQ2FsbCB0aGUgZXJyb3IgY2FsbGJhY2tcbiAgICAgICAgICAgICAgICAgICAgb25HZXREaWdpdGFsUHR6UmVjdGFuZ2xlRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vUmV0dXJuIHRoZSBzZXJ2ZXIgbGlzdFxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlY3RhbmdsZSA9IG5ldyBFVldFQjIuRGlnaXRhbFB0elJlY3RhbmdsZShkYXRhLngsIGRhdGEueSwgZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQpO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBjYW1lcmEsIHJlY3RhbmdsZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXREaWdpdGFsUHR6UmVjdGFuZ2xlU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXREaWdpdGFsUHR6UmVjdGFuZ2xlRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmRpZ2l0YWxQdHosXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHB0ejogdGhpcy5pZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldHMgdGhlIGN1cnJlbnQgZGlnaXRhbCBQVFogcmVjdGFuZ2xlLlxuICAgICAgICAgKiBEdWUgdG8gWFNTIHJlc3RyaWN0aW9ucywgdGhlIFBPU1QgcmVxdWVzdCBjYW4gbm90IGRlbGl2ZXIgYSByZXNwb25zZS4gIEFzIHN1Y2gsIHRoaXMgd2lsbCBpbnRlcm5hbGx5IGNhbGxcbiAgICAgICAgICogZ2V0UHR6UmVjdGFuZ2xlKCkgYmVmb3JlIHJldHVybmluZyB0aGUgcmVzcG9uc2UgaW4gdGhlc2Ugc2l0dWF0aW9ucyB3aGljaCB3aWxsIGluY3JlYXNlIGxhdGVuY3kuICBJZiB0aGlzXG4gICAgICAgICAqIGJlaGF2aW9yIGlzIG5vdCBkZXNpcmVkLCBsZWF2ZSBjYWxsYmFjayB1bmRlZmluZWQgYW5kIHRoZSBjYWxsIHdpbGwgbm90IGJlIG1hZGUuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCB0aGUge0BsaW5rIEVWV0VCMi5DYW1lcmF9XG4gICAgICAgICAqIGluc3RhbmNlLCB0aGUgZGlnaXRhbCBQVFogSUQsIGFuZCBhIHtAbGluayBFVldFQjIuRGlnaXRhbFB0elJlY3RhbmdsZX0gaW5zdGFuY2UgZGVzY3JpYmluZyB0aGUgcmVzdWx0YW50XG4gICAgICAgICAqIHJlY3RhbmdsZS5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHggTnVtYmVyIHgtY29vcmRpbmF0ZSBvZiB0aGUgcmVjdGFuZ2xlXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSB5IE51bWJlciB5LWNvb3JkaW5hdGUgb2YgdGhlIHJlY3RhbmdsZVxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gd2lkdGggTnVtYmVyIHdpZHRoIG9mIHRoZSByZWN0YW5nbGVcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGhlaWdodCBOdW1iZXIgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0RGlnaXRhbFB0elJlY3RhbmdsZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICBpZih0aGlzLmRpZ2l0YWxQdHpUeXBlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbWVyYSBkb2VzIG5vdCBzdXBwb3J0IGRpZ2l0YWwgUFRaLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5zb3VyY2VDYW1lcmEgPT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnVGhpcyBjYW1lcmEgaXMgbm90IGEgZGlnaXRhbCBQVFogY2FtZXJhLicpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgY2FtZXJhID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvblNldERpZ2l0YWxQdHpSZWN0YW5nbGVFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TZXREaWdpdGFsUHR6UmVjdGFuZ2xlU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9DYWxsIHRoZSBlcnJvciBjYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICBvblNldERpZ2l0YWxQdHpSZWN0YW5nbGVFcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoZGF0YS54c3NQb3N0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYS5nZXREaWdpdGFsUHR6UmVjdGFuZ2xlKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVjdGFuZ2xlID0gbmV3IEVWV0VCMi5EaWdpdGFsUHR6UmVjdGFuZ2xlKGRhdGEueCwgZGF0YS55LCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGNhbWVyYSwgcmVjdGFuZ2xlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogdGhpcy5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIHB0ejogdGhpcy5pZCxcbiAgICAgICAgICAgICAgICB4OiB4LFxuICAgICAgICAgICAgICAgIHk6IHksXG4gICAgICAgICAgICAgICAgdzogd2lkdGgsXG4gICAgICAgICAgICAgICAgaDogaGVpZ2h0XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5zZXJ2ZXIucmVxdWlyZXNSZXNvdXJjZUtleSgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVyLnNlcnZpY2UucmVzb3VyY2VLZXkgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNTUkYgZW5mb3JjZWQsIHBhc3N0aHJvdWdoIHdpbGwgbm90IHdvcmsuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwYXJhbXMua2V5ID0gdGhpcy5zZXJ2ZXIuc2VydmljZS5yZXNvdXJjZUtleTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmRpZ2l0YWxQdHosXG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TZXREaWdpdGFsUHR6UmVjdGFuZ2xlU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25TZXREaWdpdGFsUHR6UmVjdGFuZ2xlRXJyb3IsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZlci5zZXJ2aWNlLCB0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlcyB0aGUgY3VycmVudCBkaWdpdGFsIFBUWiBjYW1lcmEuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzXG4gICAgICAgICAqIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCB0aGUgb3JpZ2luYWxcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5DYW1lcmF9IGluc3RhbmNlIHRoZSBkaWdpdGFsIFBUWiBjYW1lcmEgd2FzIGdlbmVyYXRlZCBmcm9tLlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZWxldGVEaWdpdGFsUHR6Q2FtZXJhID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZGlnaXRhbFB0elR5cGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FtZXJhIGRvZXMgbm90IHN1cHBvcnQgZGlnaXRhbCBQVFouJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRoaXMuc291cmNlQ2FtZXJhID09PSB0aGlzKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnVGhpcyBjYW1lcmEgaXMgbm90IGEgZGlnaXRhbCBQVFogY2FtZXJhLicpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBwdHo6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnZGVsZXRlJ1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuc2VydmVyLnJlcXVpcmVzUmVzb3VyY2VLZXkoKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlcnZlci5zZXJ2aWNlLnJlc291cmNlS2V5ID09PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDU1JGIGVuZm9yY2VkLCBwYXNzdGhyb3VnaCB3aWxsIG5vdCB3b3JrLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcGFyYW1zLmtleSA9IHRoaXMuc2VydmVyLnNlcnZpY2UucmVzb3VyY2VLZXk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBpbnN0YW5jZS5zb3VyY2VDYW1lcmEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZGlnaXRhbFB0eixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmVyLnNlcnZpY2UsIHRydWUpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplcyB0aHVtYm5haWwgc2VhcmNoIGFuZCByZXRyaWV2ZXMgdGhlIHRvdGFsIGZyYW1lIGNvdW50IGFuZCBmcmFtZSB0aW1lc3RhbXBzIGZvciBhIGdpdmVuXG4gICAgICAgICAqIHNlYXJjaCBkdXJhdGlvbiBhbmQgc3BlY2lmaWVkIGludGVydmFsLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsXG4gICAgICAgICAqIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aFxuICAgICAgICAgKiB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIHtAbGluayBFVldFQjIuVGh1bWJuYWlsU2VhcmNofSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtEYXRlfSBzdGFydCBUaGUgc3RhcnQgdGltZSBvZiB0aGUgdGh1bWJuYWlsIHNlYXJjaC5cbiAgICAgICAgICogQHBhcmFtIHtEYXRlfSBlbmQgVGhlIGVuZCB0aW1lIG9mIHRoZSB0aHVtYm5haWwgc2VhcmNoLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gaW50ZXJ2YWwgVGhlIGludGVydmFsIGluIHNlY29uZHMgYmV0d2VlbiBmcmFtZXMgZm9yIHNlYXJjaGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VGh1bWJuYWlsU2VhcmNoID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzdGFydCwgZW5kLCBpbnRlcnZhbCkge1xuICAgICAgICAgICAgdmFyIGNhbWVyYSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkdldFRodW1ibmFpbFNlYXJjaEVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0VGh1bWJuYWlsU2VhcmNoU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSxkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICBpZihkYXRhLmZyYW1lcyA9PT0gXCIwXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBmcmFtZXNJbmZvTGlzdCA9ICQubWFwKGRhdGEuZnJhbWVzX3RpbWVzdGFtcHMsIGZ1bmN0aW9uKGVsZW1lbnQsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVGh1bWJuYWlsU2VhcmNoSW5mbyhkYXRhLnNlc3Npb25faWQsIGNhbWVyYSwgZWxlbWVudCwgaSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgIHZhciB0aHVtYm5haWxTZWFyY2ggPSBuZXcgRVZXRUIyLlRodW1ibmFpbFNlYXJjaChkYXRhLnNlc3Npb25faWQsIGNhbWVyYSwgZGF0YS5zdGFydCwgZGF0YS5lbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWVzSW5mb0xpc3QpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdGh1bWJuYWlsU2VhcmNoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSBjYW1lcmEuc2VydmVyO1xuICAgICAgICAgICAgdmFyIHVybCA9IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudGh1bWJuYWlsO1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gW1xuICAgICAgICAgICAgICAgICdzPScgKyBzZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICdjYW1lcmE9JyArIGNhbWVyYS5pZCxcbiAgICAgICAgICAgICAgICAnc3RhcnQ9JyArIEVWV0VCMi51dGlsLkRhdGUySUVURihzdGFydCksXG4gICAgICAgICAgICAgICAgJ2VuZD0nICsgRVZXRUIyLnV0aWwuRGF0ZTJJRVRGKGVuZCksXG4gICAgICAgICAgICAgICAgJ2ludGVydmFsPScgKyBpbnRlcnZhbFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgdXJsICs9ICc/JyArIHBhcmFtcy5qb2luKCc7Jyk7XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFRodW1ibmFpbFNlYXJjaFN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0VGh1bWJuYWlsU2VhcmNoRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6ICdqc29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBmdW5jdGlvbiBzZXRzIGEgbmV3IG5hbWUgZm9yIHRoZSBjYW1lcmEgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIFRoZSBmdW5jdGlvbiBnZXRzXG4gICAgICAgICAqIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCB0aGUgdXBkYXRlZCBjYW1lcmFcbiAgICAgICAgICoge0VWV0VCMi5DYW1lcmF9IGluc3RhbmNlIGFzIGEgY29udmVuaWVuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNldE5hbWUgPSBmdW5jdGlvbihjYWxsYmFjaywgbmFtZSl7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBuYW1lID09PSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTmV3IG5hbWUgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvblNldENhbWVyYU5hbWVFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TZXRDYW1lcmFOYW1lU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnhzc1Bvc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBjYW1lcmEgaW5zdGFuY2VcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgaW5zdGFuY2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgY2FtZXJhOiB0aGlzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IG5hbWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblNldENhbWVyYU5hbWVTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvblNldENhbWVyYU5hbWVFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5jYW1lcmEsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZlci5zZXJ2aWNlLCB0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGVzIGEgVVJMIGZvciByZXRyaWV2aW5nIGEgdGh1bWJuYWlsIGltYWdlIG9mIHRoZSBjYW1lcmEncyBmZWVkLiBUaGlzIHRodW1ibmFpbFxuICAgICAgICAgKiBkb2VzIG5vdCByZXByZXNlbnQgYSBsaXZlIHNuYXBzaG90LCBidXQgbWVyZWx5IGEgcmVwcmVzZW50YXRpdmUgdmFsdWUgb2YgdGhlIGNhbWVyYSdzIGZlZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLmNhbWVyYVRodW1ibmFpbFNpemVzfSBbc2l6ZT1FVldFQjIuY2FtZXJhVGh1bWJuYWlsU2l6ZXMuc2l6ZTgweDgwXSBUaGUgc2l6ZVxuICAgICAgICAgKiBvZiB0aGUgdGh1bWJuYWlsIHRvIHJlcXVlc3QuXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ30gVGhlIFVSTCB0byByZXF1ZXN0IHRoZSBkZXNpcmVkIHRodW1ibmFpbCBpbWFnZSBmcmFtZSBmb3IgdGhpcyBjYW1lcmFcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VGh1bWJuYWlsVXJsID0gZnVuY3Rpb24oc2l6ZSkge1xuICAgICAgICAgICAgaWYgKHNpemUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IEVWV0VCMi5jYW1lcmFUaHVtYm5haWxTaXplcy5zaXplODB4ODA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIGJhc2VVcmwgPSBjYW1lcmEuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5jYWNoZWRUaHVtYm5haWw7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBjYW1lcmEuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBjYW1lcmE6IGNhbWVyYS5pZCxcbiAgICAgICAgICAgICAgICBzaXplOiBzaXplXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIga2V5LCBxdWVyeV9zdHJpbmcgPSAnJztcbiAgICAgICAgICAgIGZvciAoa2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKXtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnlfc3RyaW5nICs9IChxdWVyeV9zdHJpbmcgPT09ICcnPyAnJyA6ICcmJykgKyBrZXkgKyAnPScgKyBkYXRhW2tleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYmFzZVVybCArICc/JyArIHF1ZXJ5X3N0cmluZztcbiAgICAgICAgfTtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgdGhlIGFzc29jaWF0aW9uIGluZm8gZm9yIHRoaXMgY2FtZXJhXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIHtAbGluayBFVldFQjIuQXNzb2NpYXRpb259XG4gICAgICAgICAqICBvYmplY3QgZGV0YWlsaW5nIGFsbCBvZiB0aGUgYXNzb2NhdGlvbiBpdGVtcyBhc3NvY2lhdGVkIHdpdGggdGhlIGNhbWVyYSBvciBudWxsLCBpZiBubyBhc3NvY2lhdGlvbiBpc1xuICAgICAgICAgKiAgcHJlc2VudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0QXNzb2NpYXRpb25zID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgaWYoZGF0YS5hc3NvY2lhdGlvbiA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDYWxsIGJhY2sgaW1tZWRpYXRlbHkgYXMgdGhlcmUgaXMgbm8gYXNzb2NpYXRpb24gdG8gcmV0dXJuLlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciByYXcgPSBkYXRhLmFzc29jaWF0aW9uO1xuXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgYXNzb2NpYXRpb25zXG4gICAgICAgICAgICAgICAgdmFyIGFzc29jaWF0aW9uSXRlbXMgPSAkLm1hcChyYXcuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuQXNzb2NpYXRpb25JdGVtKGVsZW1lbnQuaWQsIGVsZW1lbnQudHlwZSwgZWxlbWVudC5wb3NpdGlvbiwgZWxlbWVudC5zdGF0dXNPbmx5LFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRyYSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgZm9udEluZm8gPSBuZXcgRVZXRUIyLkZvbnRJbmZvKHJhdy5mb250TmFtZSwgcmF3LmZvbnRTaXplLCByYXcuZm9udFN0eWxlLFxuICAgICAgICAgICAgICAgICAgICByYXcuZm9udENvbG9yLCByYXcuZm9udEZhbWlseSwgcmF3LmZvbnRXZWlnaHQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFzc29jaWF0aW9uID0gbmV3IEVWV0VCMi5Bc3NvY2lhdGlvbihjYW1lcmEuc2VydmVyLCBjYW1lcmEsIHJhdy5ndWlkLCBhc3NvY2lhdGlvbkl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICByYXcubGFiZWwsIHJhdy5vdmVybGF5U3R5bGUsIHJhdy5wb3NpdGlvbiwgcmF3LmJhY2tncm91bmRDb2xvcixcbiAgICAgICAgICAgICAgICAgICAgcmF3Lm9wYWNpdHksIGZvbnRJbmZvKTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgYXNzb2NpYXRpb24pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGNhbWVyYS5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmFzc29jaWF0aW9uc0NhbWVyYSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IGNhbWVyYS5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICBjYW1lcmE6IGNhbWVyYS5wYXJlbnRJZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGNhbWVyYS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKlx0VGhlIGdldENhbWVyYXMgZnVuY3Rpb24gaXMgbWVhbnQgdG8gYWN0IGFzIGEgaGFuZGxlciBhbmQgcGFyc2VyIGZvciBsaXN0IHJldHJpZXZhbCBmcm9tIHRoZSBleGFjcVZpc2lvblxuICAgICAqXHR3ZWIgc2VydmljZSBiYWNrLWVuZC4gIEl0IHVzZXMgYXN5bmNocm9ub3VzIGphdmFzY3JpcHQgcmVxdWVzdHMgdG8gdGhlIHNlcnZlciBmb3IgaW5mb3JtYXRpb24gb25cbiAgICAgKlx0dGhlIGF2YWlsYWJsZSBjYW1lcmEgZmVlZHMgYXZhaWxhYmxlIGZyb20gdGhlIHJlcXVlc3RlZCBzZXJ2ZXIuICBUaGUgaW5mb3JtYXRpb24gcmVjZWl2ZWQgZnJvbSB0aGlzIGNhbGxcbiAgICAgKlx0aXMgdGhlbiBwYXJzZWQgYW5kIHByb3Blcmx5IGZvcm1hdHRlZCBpbnRvIHtAbGluayBFVldFQjIuQ2FtZXJhfSBvYmplY3RzIHRoYXQgdGhlbiBwcm92aWRlIHRoZSBwcm9wZXJcbiAgICAgKlx0bWV0aG9kcyBmb3Igdmlld2luZyB0aGUgY2FtZXJhIGZlZWRzLlxuICAgICAqICBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gVGhlIGZ1bmN0aW9uIGdldHMgcGFzc2VkXG4gICAgICogIHRocmVlIGFyZ3VtZW50czoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UsIGFuIGFycmF5IG9mXG4gICAgICogIHtAbGluayBFVldFQjIuQ2FtZXJhfSBpbnN0YW5jZXMsIGFuZCBhIG1vZGlmaWVkIGluc3RhbmNlIG9mIHtAbGluayBFVldFQjIuU2VydmVyfS4gKE5vdGU6IFRoZSBpbnN0YW5jZSBwYXNzZWRcbiAgICAgKiAgaW50byB0aGUgY2FsbCBpcyBtb2RpZmllZCBhcyB3ZWxsLilcbiAgICAgKlx0QHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgU2VydmVyIG9iamVjdCB0byByZXRyaWV2ZSBjYW1lcmFzIGZyb21cbiAgICAgKiAgQGRlcHJlY2F0ZWQgVGhpcyBtZXRob2QgaXMgc3VwZXJjZWRlZCBieSB7QGxpbmsgRVZXRUIyLlNlcnZlci5nZXRDYW1lcmFzfS5cbiAgICAgKiAgQGNhdGVnb3J5IENhbWVyYVxuICAgICAqL1xuICAgIEVWV0VCMi5nZXRDYW1lcmFzID0gZnVuY3Rpb24gKGNhbGxiYWNrLCBzZXJ2ZXIpIHtcbiAgICAgICAgc2VydmVyLmdldENhbWVyYXMoY2FsbGJhY2spO1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcblxuICAgIC8qKlxuICAgICAqIEBjbGFzc1xuICAgICAqIFRoZSBTeXN0ZW1IYXJkd2FyZUluZm8gb2JqZWN0IHJlcHJlc2VudHMgdGhlIGJhc2ljIGhhcmR3YXJlIGluZm9ybWF0aW9uIG9mIHRoZSBzeXN0ZW0uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzZXJpYWxOdW1iZXI9JyddIFRoZSBzZXJpYWwgbnVtYmVyIG9mIHRoZSBzeXN0ZW0uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFttb2RlbE51bWJlcj0nJ10gVGhlIG1vZGVsIG51bWJlciBvZiB0aGUgc3lzdGVtLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbW90aGVyYm9hcmQ9JyddIFRoZSBzeXN0ZW0gbW90aGVyYm9hcmQgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtiaW9zPScnXSBUaGUgc3lzdGVtIEJJT1MgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtwcm9jZXNzb3I9JyddIFRoZSBwcm9jZXNzb3IgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt0b3RhbE1lbW9yeT0nJ10gVGhlIHRvdGFsIG1lbW9yeSBvZiB0aGUgc3lzdGVtIGluIGJ5dGVzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbb3M9JyddIFRoZSBzeXN0ZW0gT1MgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtEYXRlfSBbcnVubmluZ1NpbmNlPW51bGxdIFRoZSB0aW1lc3RhbXAgc2luY2UgdGhlIHN5c3RlbSBoYXMgYmVlbiBydW5uaW5nLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU3lzdGVtSGFyZHdhcmVJbmZvID0gZnVuY3Rpb24oc2VyaWFsTnVtYmVyLCBtb2RlbE51bWJlciwgbW90aGVyYm9hcmQsIGJpb3MsIHByb2Nlc3NvciwgdG90YWxNZW1vcnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcywgcnVubmluZ1NpbmNlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VyaWFsIG51bWJlciBvZiB0aGUgc3lzdGVtLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VyaWFsTnVtYmVyID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtb2RlbCBudW1iZXIgb2YgdGhlIHN5c3RlbS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1vZGVsTnVtYmVyID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzeXN0ZW0gbW90aGVyYm9hcmQgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tb3RoZXJib2FyZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3lzdGVtIEJJT1MgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5iaW9zID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwcm9jZXNzb3IgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm9jZXNzb3IgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvdGFsIG1lbW9yeSBvZiB0aGUgc3lzdGVtIGluIGJ5dGVzLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG90YWxNZW1vcnkgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHN5c3RlbSBPUyBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9zID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0aW1lc3RhbXAgc2luY2UgdGhlIHN5c3RlbSBoYXMgYmVlbiBydW5uaW5nLlxuICAgICAgICAgKiBAdHlwZSBEYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJ1bm5pbmdTaW5jZSA9IG51bGw7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih0eXBlb2Ygc2VyaWFsTnVtYmVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5zZXJpYWxOdW1iZXIgPSBzZXJpYWxOdW1iZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIG1vZGVsTnVtYmVyICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5tb2RlbE51bWJlciA9IG1vZGVsTnVtYmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBtb3RoZXJib2FyZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMubW90aGVyYm9hcmQgPSBtb3RoZXJib2FyZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgYmlvcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuYmlvcyA9IGJpb3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHByb2Nlc3NvciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB0b3RhbE1lbW9yeSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudG90YWxNZW1vcnkgPSB0b3RhbE1lbW9yeTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygb3MgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm9zID0gb3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHJ1bm5pbmdTaW5jZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMucnVubmluZ1NpbmNlID0gcnVubmluZ1NpbmNlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBTeXN0ZW1Db25maWcgb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIHN5c3RlbSBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gW3NlcnZlcj1udWxsXSBUaGUgYXNzb2NpYXRlZCBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtzeXN0ZW1OYW1lPScnXSBUaGUgbmFtZSBvZiB0aGUgc3lzdGVtLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlN5c3RlbUhhcmR3YXJlSW5mb30gW2hhcmR3YXJlSW5mbz1udWxsXSBUaGUgaGFyZHdhcmUgaW5mb3JtYXRpb24gb2YgdGhlIHN5c3RlbS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc1V0Zjg9ZmFsc2VdIFdoZXRoZXIgdGhlIHN5c3RlbSBoYXMgdXRmLTggc3VwcG9ydCBlbmFibGVkIG9yIG5vdC5cbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlN5c3RlbUNvbmZpZyA9IGZ1bmN0aW9uKHNlcnZlciwgc3lzdGVtTmFtZSwgaGFyZHdhcmVJbmZvLCBpc1V0ZjgpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhc3NvY2lhdGVkIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLlNlcnZlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3lzdGVtIG5hbWUuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zeXN0ZW1OYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzeXN0ZW0gaGFyZHdhcmUgaW5mb3JtYXRpb24uXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TeXN0ZW1IYXJkd2FyZUluZm9cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGFyZHdhcmVJbmZvID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc3lzdGVtIGhhcyB1dGYtOCBzdXBwb3J0IGVuYWJsZWQgb3Igbm90LlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzVXRmOCA9IGZhbHNlO1xuXG4gICAgICAgIC8vIEFzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHR5cGVvZiBzZXJ2ZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygc3lzdGVtTmFtZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc3lzdGVtTmFtZSA9IHN5c3RlbU5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGhhcmR3YXJlSW5mbyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuaGFyZHdhcmVJbmZvID0gaGFyZHdhcmVJbmZvO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBpc1V0ZjggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLmlzVXRmOCA9IGlzVXRmODtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgdGhlIG5ldyBzeXN0ZW0gbmFtZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCB0aGUgbmV3IHN5c3RlbSBuYW1lLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3lzdGVtTmFtZSBUaGUgbmV3IHN5c3RlbSBuYW1lIHRvIHNldC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0U3lzdGVtTmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzeXN0ZW1OYW1lKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcy5zZXJ2ZXI7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHNlcnZlci5uYW1lID0gc3lzdGVtTmFtZTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc3lzdGVtTmFtZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc3lzdGVtTmFtZTogc3lzdGVtTmFtZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zeXN0ZW1JbmZvLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlLCB0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2QgYWxsb3dzIHRvIGVuYWJsZSBVVEYtOCBzdXBwb3J0IG9uIHRoZSBzeXN0ZW0uIE5vdGU6IE9uY2UgVVRGLTggc3VwcG9ydCBpcyBlbmFibGVkIG9uIGEgc3lzdGVtLFxuICAgICAgICAgKiBpdCBjYW5ub3QgYmUgcmV2ZXJzZWQuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlU3lzdGVtVXRmOCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKHRoaXMuaXNVdGY4KSB7XG4gICAgICAgICAgICAgICAgLy8gVVRGLTggaXMgYWxyZWFkeSBlbmFibGVkXG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnVVRGLTggaXMgYWxyZWFkeSBlbmFibGVkIG9uIHRoaXMgc3lzdGVtLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgdXRmOEVuYWJsZWQ6IHRydWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zeXN0ZW1JbmZvLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2ZXIuc2VydmljZSwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIGNhcGFiaWxpdGllcyBmb3IgVmlkZW9QdXNoIGNsaWVudHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlZpZGVvUHVzaENhcGFiaWxpdGllcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpdmUgVmlkZW9cbiAgICAgICAgICovXG4gICAgICAgIGxpdmVWaWRlbyA6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaXZlIEF1ZGlvXG4gICAgICAgICAqL1xuICAgICAgICBsaXZlQXVkaW86IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaXZlIFNlcmlhbFxuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZVNlcmlhbDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpdmUgRGlnaXRhbCBQVFpcbiAgICAgICAgICovXG4gICAgICAgIGxpdmVEaWdpdGFsUHR6OiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogTGl2ZSBUb3Vyc1xuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZVRvdXJzOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogTGl2ZSBDdXN0b20gTGF5b3V0c1xuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZUN1c3RvbUxheW91dHM6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMaXZlIEZ1bGwgU2NyZWVuXG4gICAgICAgICAqL1xuICAgICAgICBsaXZlRnVsbFNjcmVlbjogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpdmUgTWFwc1xuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZU1hcHM6IDdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBWaWRlb1B1c2ggYXBwbGljYXRpb25zXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlZpZGVvUHVzaEFwcGxpY2F0aW9ucyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdlYlxuICAgICAgICAgKi9cbiAgICAgICAgd2ViOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTW9iaWxlXG4gICAgICAgICAqL1xuICAgICAgICBtb2JpbGU6IDFcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBWaWRlb1B1c2ggZGlzcGxheSBzZXR0aW5nc1xuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5WaWRlb1B1c2hEaXNwbGF5U2V0dGluZ3MgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGdWxsIHNjcmVlblxuICAgICAgICAgKi9cbiAgICAgICAgZnVsbFNjcmVlbjogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGUgdG9vbGJhclxuICAgICAgICAgKi9cbiAgICAgICAgaGlkZVRvb2xiYXI6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIaWRlIG5hdmlnYXRpb24gYmFyXG4gICAgICAgICAqL1xuICAgICAgICBoaWRlTmF2YmFyOiAyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgdHlwZXMgb2YgVmlkZW9QdXNoIG1lc3NhZ2VzXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEludmFsaWRcbiAgICAgICAgICovXG4gICAgICAgIGludmFsaWQ6IC0xLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzcGxheSBTZXR0aW5nc1xuICAgICAgICAgKi9cbiAgICAgICAgZGlzcGxheVNldHRpbmdzOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTGl2ZSBWaWV3c1xuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZVZpZXdzOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTGl2ZSBUb3Vyc1xuICAgICAgICAgKi9cbiAgICAgICAgbGl2ZVRvdXJzOiAyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0aGUgc3RhdHVzZXMgZm9yIFZpZGVvUHVzaCBtZXNzYWdlcy5cbiAgICAgKiBAZW51bSB7c3RyaW5nfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuVmlkZW9QdXNoU3RhdHVzZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3Qgc2VudFxuICAgICAgICAgKi9cbiAgICAgICAgbm90U2VudDogJycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQZW5kaW5nXG4gICAgICAgICAqL1xuICAgICAgICBwZW5kaW5nOiAnUGVuZGluZycsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZW50XG4gICAgICAgICAqL1xuICAgICAgICBzZW50OiAnU2VudCdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZGVvUHVzaFRhcmdldCBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsIGluZm9ybWF0aW9uIGFib3V0IGEgVmlkZW9QdXNoIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2lkPScnXSBUaGUgSUQgb2YgdGhpcyBWaWRlb1B1c2ggdGFyZ2V0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGlzIFZpZGVvUHVzaCB0YXJnZXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IFtzZXJ2ZXJzPVtdXSBUaGUgc2VydmVyIGluc3RhbmNlcyBhc3NvY2lhdGVkIHdpdGggdGhpcyB0YXJnZXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVmlkZW9QdXNoQ2FwYWJpbGl0aWVzW119IFtjYXBhYmlsaXRpZXM9W11dIFRoZSBjYXBhYmlsaXRpZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgdGFyZ2V0LiAgVGhlXG4gICAgICogdGFyZ2V0IHdpbGwgb25seSByZXNwb25kIHRvIFZpZGVvUHVzaCBtZXNzYWdlcyBmYWxsaW5nIGludG8gdGhlc2UgY2FwYWJpbGl0aWVzLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4UGFuZWxzPTBdIFRoZSBtYXhpbXVtIG51bWJlciBvZiB2aWRlbyBwYW5lbHMgdGhpcyB0YXJnZXQgc3VwcG9ydHMuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5WaWRlb1B1c2hUYXJnZXQgPSBmdW5jdGlvbihpZCwgbmFtZSwgc2VydmVycywgY2FwYWJpbGl0aWVzLCBtYXhQYW5lbHMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoaXMgVmlkZW9QdXNoIHRhcmdldC5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGlzIFZpZGVvUHVzaCB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBpbnN0YW5jZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgdGFyZ2V0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcltdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXJzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjYXBhYmlsaXRpZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgdGFyZ2V0LiAgVGhlIHRhcmdldCB3aWxsIG9ubHkgcmVzcG9uZCB0byBWaWRlb1B1c2ggbWVzc2FnZXMgZmFsbGluZ1xuICAgICAgICAgKiBpbnRvIHRoZXNlIGNhcGFiaWxpdGllcy5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5WaWRlb1B1c2hDYXBhYmlsaXRpZXNbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FwYWJpbGl0aWVzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB2aWRlbyBwYW5lbHMgdGhpcyB0YXJnZXQgc3VwcG9ydHMuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1heFBhbmVscyA9IDA7XG5cbiAgICAgICAgaWYodHlwZW9mIGlkICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBuYW1lICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2Ygc2VydmVycyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVycyA9IHNlcnZlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIGNhcGFiaWxpdGllcyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuY2FwYWJpbGl0aWVzID0gY2FwYWJpbGl0aWVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBtYXhQYW5lbHMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLm1heFBhbmVscyA9IG1heFBhbmVscztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgVmlkZW9QdXNoTWVzc2FnZVN0YXR1cyBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3Igc3RhdHVzIGluZm9ybWF0aW9uIGFib3V0IGFcbiAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2V9IGluc3RhbmNlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlZpZGVvUHVzaFN0YXR1c2VzfSBbc3RhdHVzPUVWV0VCMi5WaWRlb1B1c2hTdGF0dXNlcy5ub3RTZW50XSBUaGUgY3VycmVudCBzdGF0dXMgb2YgdGhlIG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IFthcHBsaWVkU2VydmVycz1bXV0gVGhlIHNlcnZlcnMgdGhhdCB0aGUgbWVzc2FnZSBoYXMgYmVlbiBhcHBsaWVkIHRvLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZVN0YXR1cyA9IGZ1bmN0aW9uKHN0YXR1cywgYXBwbGllZFNlcnZlcnMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoaXMgVmlkZW9QdXNoIHRhcmdldC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5WaWRlb1B1c2hTdGF0dXNlc31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhdHVzID0gRVZXRUIyLlZpZGVvUHVzaFN0YXR1c2VzLm5vdFNlbnQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXJzIHRoYXQgdGhpcyBtZXNzYWdlIGhhcyBiZWVuIGFwcGxpZWQgdG8uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmVyW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFwcGxpZWRTZXJ2ZXJzID0gW107XG5cbiAgICAgICAgaWYodHlwZW9mIHN0YXR1cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBhcHBsaWVkU2VydmVycyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuYXBwbGllZFNlcnZlcnMgPSBhcHBsaWVkU2VydmVycztcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFRoZSBWaWRlb1B1c2hNZXNzYWdlIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBhbGwgaW5mb3JtYXRpb24gYWJvdXQgYSBWaWRlb1B1c2ggbWVzc2FnZS4gIFRoaXNcbiAgICAgKiBvYmplY3QgZXhwb3NlcyB0aGUgdGhlIGFiaWxpdHkgdG8gcG9sbCBmb3IgdGhlIHN0YXR1cyBvZiB0aGUgc2VudCBtZXNzYWdlIHRvIHRoaXMgdGFyZ2V0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlZpZGVvUHVzaFRhcmdldH0gW3RhcmdldD1udWxsXSBUaGUgVmlkZW9QdXNoIHRhcmdldCBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3NlbmRlcj0nJ10gVGhlIG5hbWUgb2YgdGhlIGNsaWVudCB0aGF0IHNlbnQgdGhlIG1lc3NhZ2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVmlkZW9QdXNoRGlzcGxheVNldHRpbmdzW118RVZXRUIyLlZpZXd8RVZXRUIyLlRvdXJ9IFtjb250ZW50PScnXSBUaGUgY29udGVudCBvZiB0aGUgbWVzc2FnZS4gIFRoaXMgY2FuXG4gICAgICogYmUgYW55IG9uZSBvZiB0aGUgdGhyZWUgc3BlY2lmaWVkIHR5cGVzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlRvdXJGb2xkZXJbXX0gW3RvdXJDb250ZW50Rm9sZGVyc10gVGhlIHRvdXIgZm9sZGVycyBhc3NvY2lhdGVkIHdpdGggdGhlIHNwZWNpZmllZFxuICAgICAqIHtAbGluayBFVldFQjIuVG91cn0uIE5vdGU6IFRoaXMgcGFyYW1ldGVyIGlzIG9ubHkgbmVjZXNzYXJ5IHdoZW4gc2VuZGluZyBhIHRvdXIuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5WaWRlb1B1c2hNZXNzYWdlID0gZnVuY3Rpb24odGFyZ2V0LCBzZW5kZXIsIGNvbnRlbnQsIHRvdXJDb250ZW50Rm9sZGVycykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiBWaWRlb1B1c2ggbWVzc2FnZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5WaWRlb1B1c2hNZXNzYWdlVHlwZXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZVR5cGVzLmludmFsaWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBWaWRlb1B1c2ggdGFyZ2V0IGluc3RhbmNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlZpZGVvUHVzaFRhcmdldH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hbWUgb2YgdGhlIGNsaWVudCB0aGF0IHNlbnQgdGhlIG1lc3NhZ2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlbmRlciA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY29udGVudCBvZiB0aGUgbWVzc2FnZS4gIFRoaXMgY2FuIGJlIGFueSBvbmUgb2YgdGhlIHRocmVlIHNwZWNpZmllZCB0eXBlcy5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5WaWRlb1B1c2hEaXNwbGF5U2V0dGluZ3NbXXxFVldFQjIuVmlld3xFVldFQjIuVG91cn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29udGVudCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWVzc2FnZSBJRCBhc3NvY2lhdGVkIHdpdGggdGhpcyBtZXNzYWdlLiAgVGhpcyB2YWx1ZSBpcyBnZW5lcmF0ZWQgYW5kIGFwcGxpZWQgYnlcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5WaWRlb1B1c2guc2VuZE1lc3NhZ2UoKX0gYW5kIGlzIHVzZWQgdG8gY2hlY2sgdGhlIHN0YXR1cyBvZiBhIG1lc3NhZ2UgaW5cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5WaWRlb1B1c2hNZXNzYWdlLmdldFN0YXR1c30uXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1lc3NhZ2VJZCA9ICcnO1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXJzIGFzc29jaWF0ZWQgd2l0aCB0aGlzIG1lc3NhZ2UuICBUaGlzIHZhbHVlIGlzIGdlbmVyYXRlZCBhbmQgYXBwbGllZCBieVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaC5zZW5kTWVzc2FnZSgpfSBhbmQgaXMgdXNlZCB0byBjaGVjayB0aGUgc3RhdHVzIG9mIGEgbWVzc2FnZSBpblxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2UuZ2V0U3RhdHVzfS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVycyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGlzdCBvZiB7RVZXRUIyLlRvdXJGb2xkZXJ9IGluc3RhbmNlcyBhc3NvY2lhdGVkIHdpdGggdGhlIHRvdXIgY29udGVudCBzcGVjaWZpZWQgZm9yIHRoaXMgbWVzc2FnZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5Ub3VyRm9sZGVyW119XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvdXJGb2xkZXJzID0gW107XG5cbiAgICAgICAgaWYodHlwZW9mIHRhcmdldCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiBzZW5kZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRlciA9IHNlbmRlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlb2YgY29udGVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgICAgICBpZihjb250ZW50IGluc3RhbmNlb2YgRVZXRUIyLlZpZXcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnR5cGUgPSBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZVR5cGVzLmxpdmVWaWV3cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoY29udGVudCBpbnN0YW5jZW9mIEVWV0VCMi5Ub3VyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcy5saXZlVG91cnM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGNvbnRlbnQgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHlwZSA9IEVWV0VCMi5WaWRlb1B1c2hNZXNzYWdlVHlwZXMuZGlzcGxheVNldHRpbmdzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB0b3VyQ29udGVudEZvbGRlcnMgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLnRvdXJGb2xkZXJzID0gdG91ckNvbnRlbnRGb2xkZXJzO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERldGVybWlubWVzIHRoZSB7QGxpbmsgRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzfSBmb3IgYSBnaXZlbiB7QGxpbmsgRVZXRUIyLlZpZXdTbG90SXRlbX0gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlZpZXdTbG90SXRlbX0gdmlld1Nsb3RJdGVtIFRoZSB2aWV3IHNsb3QgaXRlbSB0byBwcm9jZXNzXG4gICAgICAgICAqIEByZXR1cm5zIHtFVldFQjIuVmlld1Nsb3RJdGVtVHlwZXN9IFRoZSB2aWV3IHNsb3QgaXRlbSB0eXBlLlxuICAgICAgICAgKiBAaW50ZXJuYWxcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZXRWaWV3U2xvdEl0ZW1UeXBlID0gZnVuY3Rpb24odmlld1Nsb3RJdGVtKSB7XG4gICAgICAgICAgICB2YXIgdHlwZSA9IEVWV0VCMi5WaWV3U2xvdEl0ZW1UeXBlcy5ub25lO1xuICAgICAgICAgICAgaWYodmlld1Nsb3RJdGVtLnR5cGUgPT09IEVWV0VCMi5DYW1lcmEpIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzLmNhbWVyYTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodmlld1Nsb3RJdGVtLnR5cGUgPT09IEVWV0VCMi5NYXApIHtcbiAgICAgICAgICAgICAgICB0eXBlID0gRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzLmdyb3VwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih2aWV3U2xvdEl0ZW0udHlwZSA9PT0gRVZXRUIyLkF1ZGlvRGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgdHlwZSA9IEVWV0VCMi5WaWV3U2xvdEl0ZW1UeXBlcy5hdWRpbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0eXBlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIHRoZSB0b3VyIGZvbGRlciBpbnN0YW5jZSBmcm9tIHRvdXJGb2xkZXJzIG1hdGNoaW5nIHRoZSBwcm92aWRlZCBJRC5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlkIFRoZSB0b3VyIGZvbGRlciBJRCB0byBmaW5kLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5Ub3VyRm9sZGVyW119IHRvdXJGb2xkZXJzIFRoZSBsaXN0IG9mIHRvdXIgZm9sZGVycyB0byBzZWFyY2guXG4gICAgICAgICAqIEByZXR1cm5zIHtFVldFQjIuVG91ckZvbGRlcn0gVGhlIHRvdXIgZm9sZGVyIHdpdGggdGhlIHNwZWNpZmllZCBJRC5cbiAgICAgICAgICogQGludGVybmFsXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgZ2V0VG91ckZvbGRlckJ5SWQgPSBmdW5jdGlvbihpZCwgdG91ckZvbGRlcnMpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmdyZXAodG91ckZvbGRlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5pZCA9PT0gaWQ7XG4gICAgICAgICAgICB9KVswXTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGVzIHRoZSBKU09OLWVuY29kZWQgc3RyaW5nIG9mIHRoZSBtZXNzYWdlIGNvbnRlbnQgZm9yIHVzZSBpbiBzZW5kaW5nIHRoZSBtZXNzYWdlLlxuICAgICAgICAgKiBAaW50ZXJuYWxcbiAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIEpTT04tZW5jb2RlZCBzdHJpbmcgb2YgdGhlIG1lc3NhZ2UgY29udGVudCBmb3IgdGhlIHNlcnZlci5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVDb250ZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc3VibWlzc2lvbkNvbnRlbnQgPSAnJztcblxuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgICAgICAgIGlmKHRoaXMudHlwZSA9PT0gRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcy5kaXNwbGF5U2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICBzdWJtaXNzaW9uQ29udGVudCA9IGluc3RhbmNlLmNvbnRlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHRoaXMudHlwZSA9PT0gRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcy5saXZlVmlld3MpIHtcbiAgICAgICAgICAgICAgICBzdWJtaXNzaW9uQ29udGVudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbGF5b3V0OiBpbnN0YW5jZS5jb250ZW50LmxheW91dCxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6ICQubWFwKGluc3RhbmNlLmNvbnRlbnQuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xvdDogZWxlbWVudC5zbG90SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBlbGVtZW50LnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBnZXRWaWV3U2xvdEl0ZW1UeXBlKGVsZW1lbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHRoaXMudHlwZSA9PT0gRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcy5saXZlVG91cnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9sZGVycyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgdmFyIHRvdXJGb2xkZXI7XG5cblxuICAgICAgICAgICAgICAgIGlmKHRoaXMuY29udGVudC5mb2xkZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgdG91ckZvbGRlciA9IGdldFRvdXJGb2xkZXJCeUlkKGluc3RhbmNlLmNvbnRlbnQuZm9sZGVyLmlkLCBpbnN0YW5jZS50b3VyRm9sZGVycyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYodG91ckZvbGRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvbGRlcnMucHVzaCh0b3VyRm9sZGVyLm5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB3aGlsZSh0b3VyRm9sZGVyICE9PSB1bmRlZmluZWQgJiYgdG91ckZvbGRlci5pZCAhPT0gdG91ckZvbGRlci5wYXJlbnRJZCkge1xuICAgICAgICAgICAgICAgICAgICB0b3VyRm9sZGVyID0gZ2V0VG91ckZvbGRlckJ5SWQodG91ckZvbGRlci5wYXJlbnRJZCwgaW5zdGFuY2UudG91ckZvbGRlcnMpO1xuICAgICAgICAgICAgICAgICAgICBmb2xkZXJzLnVuc2hpZnQodG91ckZvbGRlci5uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBzdWJtaXNzaW9uQ29udGVudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogaW5zdGFuY2UuY29udGVudC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBmb2xkZXJzOiBmb2xkZXJzXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzdWJtaXNzaW9uQ29udGVudCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFF1ZXJpZXMgdGhlIHN0YXR1cyBvZiB0aGUgbWVzc2FnZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZVN0YXR1c30gaW5zdGFuY2UgZGVzY3JpYmluZyB0aGUgc3RhdHVzIG9mIHRoZSBtZXNzYWdlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRTdGF0dXMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0aGlzO1xuICAgICAgICAgICAgdmFyIG9uR2V0U3RhdHVzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0U3RhdHVzU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgdmFyIGFwcGxpZWRTZXJ2ZXJzID0gJC5tYXAoZGF0YS5hcHBsaWVkLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmdyZXAobWVzc2FnZS50YXJnZXQuc2VydmVycywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5pZC50b1N0cmluZygpID09PSBlbGVtZW50LnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IG5ldyBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZVN0YXR1cyhkYXRhLnN0YXR1cywgYXBwbGllZFNlcnZlcnMpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBzdGF0dXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSB0aGlzLnRhcmdldC5zZXJ2ZXJzWzBdLnNlcnZpY2U7XG4gICAgICAgICAgICB2YXIgc2VydmVySWRzID0gJC5tYXAodGhpcy50YXJnZXQuc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRTdGF0dXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb3B1c2hNZXNzYWdlICsgJy8nICsgdGhpcy5tZXNzYWdlSWQsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXJJZHNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgc2VydmljZSk7XG4gICAgICAgIH07XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVGhlIFZpZGVvUHVzaCBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsIHZpZGVvIHB1c2ggYWN0aW9uc1xuICAgICAqIHBlcmZvcm1lZCBvbiB0aGUgc2VydmVyLiAgSXQgZXhwb3NlcyBtZXRob2RzIGZvciBib3RoIHNlbmRpbmcgYW5kIHJlY2VpdmluZ1xuICAgICAqIFZpZGVvUHVzaCBldmVudHMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtjbGllbnRHdWlkPScnXSBUaGUgR1VJRCBvZiB0aGlzIFZpZGVvUHVzaCB0YXJnZXQuICBXaGVuIGluaXRpYWxseSBjcmVhdGluZyBhIFZpZGVvUHVzaFxuICAgICAqIGNsaWVudCwgdGhpcyB2YWx1ZSB3aWxsIGJlIGdlbmVyYXRlZCBhbmQgc2hvdWxkIGJlIHN0b3JlZCBhbmQgcmUtdXNlZCBmb3IgdGhlIGxpZmV0aW1lIG9mIHRoZVxuICAgICAqIGNsaWVudC4gIEZvciBleGFtcGxlLCBhIHdlYiBjbGllbnQgdXNlciBzaG91bGQgZ2VuZXJhdGUgdGhpcyBHVUlEIG9uY2UsIHN0b3JlIGl0IGluIExvY2FsIFN0b3JhZ2UgYW5kLFxuICAgICAqIG9uIGVhY2ggcmVsb2FkLCBzaG91bGQgcHJvdmlkZSB0aGlzIHZhbHVlIHRvIHRoZSBjb25zdHJ1Y3Rvci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlZpZGVvUHVzaCA9IGZ1bmN0aW9uKGNsaWVudEd1aWQpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIEdVSUQgb2YgdGhpcyBWaWRlb1B1c2ggdGFyZ2V0LiAgVGhpcyB2YWx1ZSBpcyBpbml0aWFsbHkgY3JlYXRlZCBieSBhIGNhbGwgdG9cbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5WaWRlb1B1c2gudXBkYXRlQ2xpZW50fS4gIEFsbCB1c2VzIGFmdGVyd2FyZCBzaG91bGQgaGF2ZSB0aGlzIHZhbHVlXG4gICAgICAgICAqIGFwcGxpZWQgYXMgcGFydCBvZiB0aGUgY29uc3RydWN0b3IuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGd1aWQgPSAnJztcblxuICAgICAgICBpZih0eXBlb2YgY2xpZW50R3VpZCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIGd1aWQgPSBjbGllbnRHdWlkO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkaXNwbGF5IG5hbWUgb2YgdGhlIFZpZGVvUHVzaCBjbGllbnQgdG8gYmUgc2hvd24gdG8gb3RoZXIgVmlkZW9QdXNoIGNsaWVudHMuICBXaGVuIG5vIGNhcGFiaWxpdGllcyBhcmVcbiAgICAgICAgICogcHJlc2VudCwgdGhpcyB2YWx1ZSBpcyBub3QgdXNlZCBhbmQgY2FuIGJlIGFuIGVtcHR5IHN0cmluZy4gIFRoaXMgdmFsdWUgaXMgc2V0IGJ5XG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnVwZGF0ZUNsaWVudH0uXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGNsaWVudE5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBpbnN0YW5jZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2xpZW50LiBUaGlzIHZhbHVlIGlzIHNldCBieSB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaC51cGRhdGVDbGllbnR9LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcltdfVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAaW50ZXJuYWxcbiAgICAgICAgICovXG4gICAgICAgIHZhciBjbGllbnRTZXJ2ZXJzID0gW107XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhcGFiaWxpdGllcyBvZiB0aGUgVmlkZW9QdXNoIGNsaWVudC4gIFRoaXMgdmFsdWUgaXMgc2V0IGJ5IHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnVwZGF0ZUNsaWVudH0uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuVmlkZW9QdXNoQ2FwYWJpbGl0aWVzW119XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGNsaWVudENhcGFiaWxpdGllcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWF4aW11bSBudW1iZXIgb2YgdmlkZW8gcGFuZWxzIGF2YWlsYWJsZSB0byB0aGlzIGNsaWVudC4gIFRoaXMgdmFsdWUgaXMgc2V0IGJ5XG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnVwZGF0ZUNsaWVudH0uXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGNsaWVudE1heFBhbmVscyA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIFZpZGVvUHVzaCBhcHBsaWNhdGlvbiB0aGlzIGNsaWVudCBpcy4gIFRoaXMgdmFsdWUgaXMgc2V0IGJ5XG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9QdXNoLnVwZGF0ZUNsaWVudH0uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuVmlkZW9QdXNoQXBwbGljYXRpb25zfVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAaW50ZXJuYWxcbiAgICAgICAgICovXG4gICAgICAgIHZhciBjbGllbnRBcHBsaWNhdGlvblR5cGUgPSBFVldFQjIuVmlkZW9QdXNoQXBwbGljYXRpb25zLndlYjtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgYSBsaXN0IG9mIGFsbCBvZiB0aGUgYXZhaWxhYmxlIFZpZGVvUHVzaCB0YXJnZXRzIG9uIHRoZSBwcm92aWRlZCBzZXJ2ZXJzLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIGFycmF5IG9mXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuVmlkZW9QdXNoVGFyZ2V0fSBpbnN0YW5jZXMuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcltdfSBzZXJ2ZXJzIEFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuU2VydmVyfSBpbnN0YW5jZXMgdG8gcXVlcnkgdGhlIHZpZGVvIHB1c2ggdGFyZ2V0cy5cbiAgICAgICAgICogZnJvbSB3aGljaCB0byBnZXQgdGFyZ2V0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VGFyZ2V0cyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgb25HZXRUYXJnZXRzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0VGFyZ2V0c1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0cyA9ICQubWFwKGRhdGEudGFyZ2V0cywgZnVuY3Rpb24odGFyZ2V0RGF0YSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbklkcyA9ICQubWFwKHRhcmdldERhdGEuc2Vzc2lvbklkcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFNlcnZlcnMgPSAkLmdyZXAoc2VydmVycywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoZWwuaWQsIHNlc3Npb25JZHMpICE9PSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlZpZGVvUHVzaFRhcmdldCh0YXJnZXREYXRhLmlkLCB0YXJnZXREYXRhLm5hbWUsIHRhcmdldFNlcnZlcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXREYXRhLmNhcGFiaWxpdGllcywgdGFyZ2V0RGF0YS5tYXhQYW5lbHMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgdGFyZ2V0cyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2VydmljZSA9IHNlcnZlcnNbMF0uc2VydmljZTtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXJJZHMgPSAkLm1hcChzZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2Vzc2lvbklkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRUYXJnZXRzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRUYXJnZXRzRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudmlkZW9wdXNoLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogc2VydmVySWRzXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZpY2UpO1xuICAgICAgICB9O1xuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZSBhIGNsaWVudCdzIFZpZGVvUHVzaCBzdGF0dXMsIGluY2x1ZGluZyB0aGUgaW5pdGlhbCBjcmVhdGlvbiBvZiBhIFZpZGVvUHVzaCB0YXJnZXQuICBUaGlzXG4gICAgICAgICAqIG1ldGhvZCBpcyB1c2VkIHRvIHJlZ2lzdGVyIGEgY2xpZW50IHdpdGggdGhlIHNlcnZlciBhcyBiZWluZyBhIHNlbmRlciBhbmQvb3IgcmVjZWl2ZXIgb2YgVmlkZW9QdXNoXG4gICAgICAgICAqIGV2ZW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQXQgdGhlIGJhc2UgbGV2ZWwsIGEgc2VuZGVyIG9mIFZpZGVvUHVzaCBldmVudHMgaXMgYSBjbGllbnQgd2l0aCBubyBjYXBhYmlsaXRpZXMuICBUbyByZWNlaXZlIGV2ZW50cyxcbiAgICAgICAgICogY2FwYWJpbGl0aWVzIG11c3QgYmUgZGVmaW5lZCwgZWFjaCBsaXN0aW5nIHRoZSB0eXBlcyBvZiBjb250ZW50IHRoZSBjbGllbnQgY2FuIHJlY2VpdmUuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW4gaW5pdGlhbGx5IGNyZWF0aW5nIGEgVmlkZW9QdXNoIHRhcmdldCwgYSBjbGllbnQgR1VJRCB3aWxsIGJlIGdlbmVyYXRlZCBhbmQgcmV0dXJuZWQgaW4gdGhlIGNhbGxiYWNrLlxuICAgICAgICAgKiBUaGlzIEdVSUQgc2hvdWxkIGJlIHN0b3JlZCBleHRlcm5hbGx5IGFuZCB1c2VkIGluIHRoZSBjb25zdHJ1Y3RvciBmb3IgYWxsIGZ1dHVyZSBpbnN0YW5jZXMgb2YgdGhpcyBjbGllbnQsXG4gICAgICAgICAqIHByZXNlcnZpbmcgdGhlIHVuaXF1ZSBjbGllbnQgY29ubmVjdGlvbi5cbiAgICAgICAgICpcbiAgICAgICAgICogTm90ZTogV2hlbiByZWdpc3RlcmluZyBhIGNsaWVudCBmb3IgcmVjZWl2aW5nIChpLmUuIHNldHRpbmcgYW55IGNhcGFiaWxpdGllcyksIGl0IGlzIGltcG9ydGFudCB0byB1bnJlZ2lzdGVyXG4gICAgICAgICAqIHRob3NlIGNhcGFiaWxpdGllcyB3aGVuIGZpbmlzaGVkIGxpc3RlbmluZy4gIFRoaXMgaXMgZG9uZSBhdXRvbWF0aWNhbGx5IGFmdGVyIGEgc2V0IHRpbWVvdXQgcGVyaW9kLCBidXQgaXQgaXNcbiAgICAgICAgICogaGlnaGx5IHJlY29tbWVuZGVkIHRoYXQgYSBjYWxsIHRvIHVwZGF0ZUNsaWVudCBpcyBtYWRlIHdoZW4gZmluaXNoZWQgbGlzdGVuaW5nIHRvIHJlbW92ZSBhbGwgY2FwYWJpbGl0aWVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBOb3RlOiBEdWUgdG8gaG93IHRoZSBFViBTZXJ2ZXIgbWFuYWdlcyBWaWRlb1B1c2ggY29ubmVjdGlvbnMsIHRoZSBzYW1lIEdVSUQgY2Fubm90IGJlIHVzZWQgd2l0aCBtdWx0aXBsZVxuICAgICAgICAgKiBzZXBhcmF0ZSBsb2dpbnMgb24gdGhlIHNhbWUgc2VydmVyLiAgSW4gdGhpcyBzaXR1YXRpb24sIGl0IGlzIHJlY29tbWVuZGVkIHRoYXQgdGhlIG9yaWdpbmFsIEdVSUQgaXMgdXBkYXRlZCB0b1xuICAgICAgICAgKiBubyBjYXBhYmlsaXRpZXMgYW5kIGEgbmV3IEdVSUQgaXMgZ2VuZXJhdGVkIGZvciB0aGUgbmV3IGxvZ2luLiAgRm9yIGV4YW1wbGU6IEEgdXNlciBoYXMgYSBjbGllbnQgR1VJRCBpc1xuICAgICAgICAgKiBnZW5lcmF0ZWQgZm9yIGEgdXNlciB1c2luZyB0aGUgcGFzc3Rocm91Z2ggY29ubmVjdGlvbiBvbiB0aGUgc2VydmVyLiBMYXRlciwgdGhhdCB1c2VyIHJlY2VpdmVzIHBlcnNvbmFsXG4gICAgICAgICAqIGNyZWRlbnRpYWxzIHRvIHRoYXQgc2FtZSBzZXJ2ZXIgYW5kIGxvZ3MgaW4uICBJbiB0aGlzIHNpdHVhdGlvbiwgdGhlIG9yaWdpbmFsIEdVSUQgbXVzdCBiZSBzZXQgdG8gbm9cbiAgICAgICAgICogY2FwYWJpbGl0aWVzIGFuZCBhIG5ldyBHVUlEIG11c3QgYmUgZ2VuZXJhdGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhIHN0cmluZyBvZiB0aGUgY2xpZW50J3MgR1VJRC5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgVGhlIHNlcnZlciBpbnN0YW5jZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgY2xpZW50LiAgSW4gZ2VuZXJhbCwgdGhpcyB2YWx1ZVxuICAgICAgICAgKiBzaG91bGQgYmUgYWxsIG9mIHRoZSBjb25uZWN0ZWQgc2VydmVycy5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGUgVmlkZW9QdXNoIGNsaWVudCB0byBiZSBzaG93biB0byBvdGhlciBWaWRlb1B1c2ggY2xpZW50cy4gIFdoZW5cbiAgICAgICAgICogbm8gY2FwYWJpbGl0aWVzIGFyZSBwcmVzZW50LCB0aGlzIHZhbHVlIGlzIG5vdCB1c2VkIGFuZCBjYW4gYmUgYW4gZW1wdHkgc3RyaW5nLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWRlb1B1c2hDYXBhYmlsaXRpZXNbXX0gY2FwYWJpbGl0aWVzIFRoZSBjYXBhYmlsaXRpZXMgdGhpcyBWaWRlb1B1c2ggY2xpZW50IHN1cHBvcnRzLiAgV2hlblxuICAgICAgICAgKiBubyBjYXBhYmlsaXRpZXMgYXJlIHByZXNlbnQsIHRoaXMgY2xpZW50IGlzIGNvbnNpZGVyZWQgXCJzZW5kIG9ubHlcIiBhbmQgd2lsbCBub3QgYmUgZGlzcGxheWVkIHRvIHJlY2VpdmVcbiAgICAgICAgICogYW55IGV2ZW50cy5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IG1heFBhbmVscyBUaGUgbWF4aW11bSBudW1iZXIgb2YgdmlkZW8gcGFuZWxzIGF2YWlsYWJsZSB0byB0aGlzIGNsaWVudC5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuVmlkZW9QdXNoQXBwbGljYXRpb25zfSBbYXBwbGljYXRpb25UeXBlPUVWV0VCMi5WaWRlb1B1c2hBcHBsaWNhdGlvbnMud2ViXSBUaGUgdHlwZSBvZlxuICAgICAgICAgKiBWaWRlb1B1c2ggYXBwbGljYXRpb24gdGhpcyBjbGllbnQgaXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZUNsaWVudCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzLCBuYW1lLCBjYXBhYmlsaXRpZXMsIG1heFBhbmVscywgYXBwbGljYXRpb25UeXBlKSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgYXBwbGljYXRpb25UeXBlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uVHlwZSA9IEVWV0VCMi5WaWRlb1B1c2hBcHBsaWNhdGlvbnMud2ViO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25VcGRhdGVDbGllbnRFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25VcGRhdGVDbGllbnRTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBpbnRlcm5hbCBpbmZvcm1hdGlvblxuICAgICAgICAgICAgICAgIGd1aWQgPSBkYXRhLnRhcmdldC5ndWlkO1xuICAgICAgICAgICAgICAgIGNsaWVudFNlcnZlcnMgPSBzZXJ2ZXJzO1xuICAgICAgICAgICAgICAgIGNsaWVudE5hbWUgPSBuYW1lO1xuICAgICAgICAgICAgICAgIGNsaWVudENhcGFiaWxpdGllcyA9IGNhcGFiaWxpdGllcztcbiAgICAgICAgICAgICAgICBjbGllbnRNYXhQYW5lbHMgPSBtYXhQYW5lbHM7XG4gICAgICAgICAgICAgICAgY2xpZW50QXBwbGljYXRpb25UeXBlID0gYXBwbGljYXRpb25UeXBlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgLy9SZXR1cm4gdGhlIHNlcnZlciBsaXN0XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBndWlkKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gc2VydmVyc1swXS5zZXJ2aWNlO1xuICAgICAgICAgICAgdmFyIHNlcnZlcklkcyA9ICQubWFwKHNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uVXBkYXRlQ2xpZW50U3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25VcGRhdGVDbGllbnRFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy52aWRlb3B1c2gsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogc2VydmVySWRzLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgICAgICAgICBtYXhQYW5lbHM6IG1heFBhbmVscyxcbiAgICAgICAgICAgICAgICAgICAgY2FwYWJpbGl0aWVzOiBjYXBhYmlsaXRpZXNcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihhcHBsaWNhdGlvblR5cGUgPT09IEVWV0VCMi5WaWRlb1B1c2hBcHBsaWNhdGlvbnMubW9iaWxlKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MuZGF0YS5tb2JpbGUgPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihndWlkICE9PSAnJykge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLmRhdGEuZ3VpZCA9IGd1aWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VuZHMgYSBWaWRlb1B1c2ggbWVzc2FnZSB0byB0aGUgc3BlY2lmaWVkIHRhcmdldC5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhIHtAbGluayBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZX1cbiAgICAgICAgICogaW5zdGFuY2UgZGVzY3JpYmluZyB0aGUgc2VudCBtZXNzYWdlLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5WaWRlb1B1c2hNZXNzYWdlfSBtZXNzYWdlIFRoZSBWaWRlb1B1c2ggbWVzc2FnZSB0byBzZW5kLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZW5kTWVzc2FnZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXIgb25TZW5kTWVzc2FnZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblNlbmRNZXNzYWdlU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgbWVzc2FnZSBpbmZvXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5tZXNzYWdlSWQgPSBkYXRhLm1lc3NhZ2VJZDtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgbWVzc2FnZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihndWlkID09PSAnJykge1xuICAgICAgICAgICAgICAgIHZhciBndWlkRXJyb3IgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnR1VJRCBub3Qgc3BlY2lmaWVkIGZvciBjbGllbnQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZ3VpZEVycm9yKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG1lc3NhZ2UudGFyZ2V0LnNlcnZlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnTm8gc2VydmVycyBtYXRjaCB0aGUgcHVzaCB0YXJnZXQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXJ2aWNlID0gbWVzc2FnZS50YXJnZXQuc2VydmVyc1swXS5zZXJ2aWNlO1xuICAgICAgICAgICAgdmFyIHNlcnZlcklkcyA9ICQubWFwKG1lc3NhZ2UudGFyZ2V0LnNlcnZlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU2VuZE1lc3NhZ2VTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvblNlbmRNZXNzYWdlRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudmlkZW9wdXNoICsgJy8nICsgZ3VpZCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBzZXJ2ZXJJZHMsXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldElkOiBtZXNzYWdlLnRhcmdldC5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogbWVzc2FnZS50eXBlLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBtZXNzYWdlLmdlbmVyYXRlQ29udGVudCgpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVja3MgZm9yIGluY29taW5nIG1lc3NhZ2VzIGZvciB0aGlzIGNsaWVudC5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2V9IGluc3RhbmNlcyBkZXNjcmliaW5nIHRoZSByZWNlaXZlZCBtZXNzYWdlcy5cbiAgICAgICAgICogTm90ZTogVGhlIHtAbGluayBFVldFQjIuVmlld30gYW5kIHtAbGluayBFVldFQjIuVG91cn0gaW5zdGFuY2VzIHJldHVybmVkIGFyZSBub3QgdGhlIHNhbWUgaW5zdGFuY2VzIHByb3ZpZGVkXG4gICAgICAgICAqIGJ5IHtAbGluayBFVldFQjIuU2VydmljZS5nZXRWaWV3c30gYW5kIHtAbGluayBFVldFQjIuU2VydmljZS5nZXRUb3Vyc30gYW5kIGFyZSBub3QgbmVjZXNzYXJpbHkgY29tcGxldGUuXG4gICAgICAgICAqIFRoZXkgb25seSBwcm92aWRlIHRoZSBtaW5pbXVtIGluZm9ybWF0aW9uIHRvIGFwcGx5IHRoZSBtZXNzYWdlIGNvbnRlbnQuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcltdfSBzZXJ2ZXJzIFRoZSBzZXJ2ZXIgaW5zdGFuY2VzIHRvIGNoZWNrIGZvciBtZXNzYWdlcy4gIE1lc3NhZ2VzIHNwYW5uaW5nIHNlcnZlcnMgd2lsbFxuICAgICAgICAgKiBiZSBtZXJnZWQgaW50byBvbmUgbWVzc2FnZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2hlY2tNZXNzYWdlcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgb25DaGVja01lc3NhZ2VzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uQ2hlY2tNZXNzYWdlc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gbmV3IEVWV0VCMi5WaWRlb1B1c2hUYXJnZXQoJycsIGNsaWVudE5hbWUsIGNsaWVudFNlcnZlcnMsIGNsaWVudENhcGFiaWxpdGllcyxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50TWF4UGFuZWxzKTtcblxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9ICQubWFwKGRhdGEuZXZlbnRzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50O1xuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbUNvbnRlbnQgPSBlbGVtZW50LmNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3VyRm9sZGVycztcblxuICAgICAgICAgICAgICAgICAgICBpZihlbGVtZW50LnR5cGUgPT09IEVWV0VCMi5WaWRlb1B1c2hNZXNzYWdlVHlwZXMuZGlzcGxheVNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gaXRlbUNvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihlbGVtZW50LnR5cGUgPT09IEVWV0VCMi5WaWRlb1B1c2hNZXNzYWdlVHlwZXMubGl2ZVZpZXdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSAkLm1hcChpdGVtQ29udGVudC5pdGVtcywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSAkLmdyZXAoc2VydmVycywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmlkLnRvU3RyaW5nKCkgPT09IGl0ZW0uc2VydmVyLnRvU3RyaW5nKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGl0ZW0udHlwZSA9PT0gRVZXRUIyLlZpZXdTbG90SXRlbVR5cGVzLmNhbWVyYSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gRVZXRUIyLkNhbWVyYTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihpdGVtLnR5cGUgPT09IEVWV0VCMi5WaWV3U2xvdEl0ZW1UeXBlcy5ncm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gRVZXRUIyLk1hcDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihpdGVtLnR5cGUgPT09IEVWV0VCMi5WaWV3U2xvdEl0ZW1UeXBlcy5hdWRpbykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gRVZXRUIyLkF1ZGlvRGV2aWNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5WaWV3U2xvdEl0ZW0oaXRlbS5pZCwgc2VydmVyLCB0eXBlLCBpdGVtLnNsb3QsIGl0ZW0uZGlnaXRhbFB0elR5cGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYXlvdXRTbG90cyA9ICQubWFwKGl0ZW1Db250ZW50LmxheW91dF9pbmZvLnNsb3RzLCBmdW5jdGlvbihzbG90KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuTGF5b3V0U2xvdChzbG90LnksIHNsb3QueCwgc2xvdC53aWR0aCwgc2xvdC5oZWlnaHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYXlvdXRJbmZvID0gbmV3IEVWV0VCMi5MYXlvdXQodW5kZWZpbmVkLCBpdGVtQ29udGVudC5sYXlvdXRfaW5mby53aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtQ29udGVudC5sYXlvdXRfaW5mby5oZWlnaHQsIGl0ZW1Db250ZW50LmxheW91dF9pbmZvLmxlbmd0aCwgbGF5b3V0U2xvdHMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZm9sZGVyIGZvciBpbmNvbWluZyB2aWV3cyBpcyBhbHdheXMgdHJlYXRlZCBhcyB0aGUgcm9vdCBmb2xkZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZm9sZGVyID0gbmV3IEVWV0VCMi5WaWV3Rm9sZGVyKCcwJywgJycsICcwJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBuZXcgRVZXRUIyLlZpZXcoaXRlbUNvbnRlbnQubmFtZSwgZm9sZGVyLCBpdGVtcywgaXRlbUNvbnRlbnQubGF5b3V0LCBsYXlvdXRJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGVsZW1lbnQudHlwZSA9PT0gRVZXRUIyLlZpZGVvUHVzaE1lc3NhZ2VUeXBlcy5saXZlVG91cnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdXJGb2xkZXJzID0gJC5tYXAoaXRlbUNvbnRlbnQuZm9sZGVycywgZnVuY3Rpb24oZm9sZGVyLCBpbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJlbnRJbmRleCA9IGluZGV4IC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwYXJlbnRJbmRleCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SW5kZXggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Ub3VyRm9sZGVyKGluZGV4LnRvU3RyaW5nKCksIGZvbGRlciwgcGFyZW50SW5kZXgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b3VyRm9sZGVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodG91ckZvbGRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdXJGb2xkZXIgPSB0b3VyRm9sZGVyc1t0b3VyRm9sZGVycy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aWV3cyA9ICQubWFwKGl0ZW1Db250ZW50LnZpZXdzLCBmdW5jdGlvbih2aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuVG91ckl0ZW0odmlldy5pbmRleCwgdmlldy5kd2VsbCwgdmlldy52aWV3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gbmV3IEVWV0VCMi5Ub3VyKGl0ZW1Db250ZW50Lm5hbWUsIHRvdXJGb2xkZXIsIHZpZXdzLCBpdGVtQ29udGVudC5kZXNjcmlwdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IG5ldyBFVldFQjIuVmlkZW9QdXNoTWVzc2FnZSh0YXJnZXQsIGVsZW1lbnQuc2VuZGVyLCBjb250ZW50LCB0b3VyRm9sZGVycyk7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UudHlwZSA9IGVsZW1lbnQudHlwZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgbWVzc2FnZXMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoZ3VpZCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdHVUlEIG5vdCBzcGVjaWZpZWQgZm9yIGNsaWVudC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNlcnZpY2UgPSBzZXJ2ZXJzWzBdLnNlcnZpY2U7XG4gICAgICAgICAgICB2YXIgc2VydmVySWRzID0gJC5tYXAoc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25DaGVja01lc3NhZ2VzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25DaGVja01lc3NhZ2VzRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMudmlkZW9wdXNoICsgJy8nICsgZ3VpZCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHNlcnZlcklkc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgU2VydmVyQ29uZmlnIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uIGZvciBhbGwgZGV2aWNlcyBvbiB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IFtzZXJ2ZXI9bnVsbF0gVGhlIGFzc29jaWF0ZWQgc2VydmVyLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmVyQ29uZmlnID0gZnVuY3Rpb24oc2VydmVyKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXNzb2NpYXRlZCBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvLyBBc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihzZXJ2ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmUgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBvZiBhbGwgZGV2aWNlcyBvbiB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuRGV2aWNlQ29uZmlnfSBvYmplY3RzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXREZXZpY2VzQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVySW5zdGFuY2UgPSB0aGlzLnNlcnZlcjtcblxuICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXREZXZpY2VzQ29uZmlnRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0RGV2aWNlc0NvbmZpZ1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRldmljZXMgPSBkYXRhLmRldmljZXM7XG5cbiAgICAgICAgICAgICAgICB2YXIgZGV2aWNlc0xpc3QgPSAkLm1hcChkZXZpY2VzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYW1lcmFJbmZvID0gJC5tYXAoZWxlbWVudC5jYW1lcmFzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5EZXZpY2VDb25maWdDYW1lcmFJbmZvKGVsZW1lbnQuY2FtZXJhSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudENhbWVyYUlkLnRvU3RyaW5nKCksIGVsZW1lbnQubmFtZSwgZWxlbWVudC5pc1ByaW1hcnkpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5EZXZpY2VDb25maWcoZWxlbWVudC5pZCwgZWxlbWVudC5uYW1lLCBlbGVtZW50Lmhvc3QsIGVsZW1lbnQucG9ydCwgZWxlbWVudC50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5tb2RlbCwgZWxlbWVudC5tYWNBZGRyZXNzLCBlbGVtZW50LmZpcm13YXJlLCBlbGVtZW50LmVuYWJsZWQsIGVsZW1lbnQuaXNDb25uZWN0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmFJbmZvLCBlbGVtZW50LnVzZXIsIHNlcnZlckluc3RhbmNlLCBlbGVtZW50LnNlcmlhbCwgZWxlbWVudC52aWRlb1N0YW5kYXJkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGV2aWNlc0xpc3QsIHNlcnZlckluc3RhbmNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldERldmljZXNDb25maWdTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldERldmljZXNDb25maWdFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlckluc3RhbmNlLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5kZXZpY2VzLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogc2VydmVySW5zdGFuY2Uuc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlckluc3RhbmNlLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZSB0aGUgbGlzdCBvZiBzdXBwb3J0ZWQgZGV2aWNlIHR5cGVzIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5EZXZpY2VUeXBlSW5mb30gb2JqZWN0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0RGV2aWNlVHlwZXMgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlckluc3RhbmNlID0gdGhpcy5zZXJ2ZXI7XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uR2V0RGV2aWNlVHlwZXNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXREZXZpY2VUeXBlc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRldmljZVR5cGVzID0gZGF0YS5kZXZpY2VUeXBlcztcblxuICAgICAgICAgICAgICAgIHZhciBkZXZpY2VUeXBlc0xpc3QgPSAkLm1hcChkZXZpY2VUeXBlcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5EZXZpY2VUeXBlSW5mbyhlbGVtZW50Lm5hbWUsIGVsZW1lbnQuZGVmYXVsdFVzZXIsIGVsZW1lbnQuZGVmYXVsdFBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5kZWZhdWx0UG9ydCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGRldmljZVR5cGVzTGlzdCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXREZXZpY2VUeXBlc1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0RGV2aWNlVHlwZXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlckluc3RhbmNlLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5kZXZpY2VUeXBlcyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHNlcnZlckluc3RhbmNlLnNlc3Npb25JZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXJJbnN0YW5jZS5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKiBUaGUgYWRkRGV2aWNlIGlzIGEgbWV0aG9kIHRoYXQgYWRkcyBhIGRldmljZSB0byB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkRldmljZUNvbmZpZ30gZGV2aWNlQ29uZmlndXJhdGlvbiBUaGUgbmV3IGRldmljZSBjb25maWd1cmF0aW9uIHRvIGFwcGx5LlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bhc3N3b3JkXSBUaGUgcGFzc3dvcmQgZm9yIGNvbm5lY3Rpb25zIHRvIHRoZSBkZXZpY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZERldmljZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBkZXZpY2VDb25maWd1cmF0aW9uLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgdmFyIHNlcnZlckluc3RhbmNlID0gdGhpcy5zZXJ2ZXI7XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHNlcnZlckluc3RhbmNlLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBob3N0OiBkZXZpY2VDb25maWd1cmF0aW9uLmhvc3ROYW1lLFxuICAgICAgICAgICAgICAgIHBvcnQ6IGRldmljZUNvbmZpZ3VyYXRpb24ucG9ydCxcbiAgICAgICAgICAgICAgICB1c2VyOiBkZXZpY2VDb25maWd1cmF0aW9uLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGRldmljZUNvbmZpZ3VyYXRpb24uZW5hYmxlZCxcbiAgICAgICAgICAgICAgICBkZXZpY2VUeXBlOiBkZXZpY2VDb25maWd1cmF0aW9uLnR5cGVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogc2VydmVySW5zdGFuY2Uuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmRldmljZXMsXG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXJJbnN0YW5jZS5zZXJ2aWNlLCB0cnVlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGdldEFyY2hpdmVUYXJnZXRzIG1ldGhvZCBsaXN0cyB0aGUgYXJjaGl2ZSB0YXJnZXRzIGNvbmZpZ3VyZWQgb24gdGhlIHNlcnZlci5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhblxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5BcmNoaXZlVGFyZ2V0fSBvYmplY3RzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRBcmNoaXZlVGFyZ2V0cyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcy5zZXJ2ZXI7XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGFyY2hpdmVUYXJnZXRzID0gW107XG4gICAgICAgICAgICAgICAgZGF0YS5hcmNoaXZlVGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uKHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkID0gbmV3IEVWV0VCMi5BcmNoaXZlVXBsb2FkQ29uZmlnKHRhcmdldC51cGxvYWQuYWRkcmVzcywgdGFyZ2V0LnVwbG9hZC5oYXNCb29rbWFya3MsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQudXBsb2FkLnBlcmNlbnRUb1VzZSwgdGFyZ2V0LnVwbG9hZC51c2VybmFtZSwgdGFyZ2V0LnVwbG9hZC5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC51cGxvYWQubW91bnRQb2ludCwgdGFyZ2V0LnVwbG9hZC5kZXNpcmVkQ29udGVudEFnZSwgdGFyZ2V0LnVwbG9hZC5leHBpcmF0aW9uVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC51cGxvYWQuZXhwaXJhdGlvbkR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaCA9IG5ldyBFVldFQjIuQXJjaGl2ZVNlYXJjaENvbmZpZyh0YXJnZXQuc2VhcmNoLmVuYWJsZWQsIHRhcmdldC5zZWFyY2guYWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldC5zZWFyY2gudXNlcm5hbWUsIHRhcmdldC5zZWFyY2gucGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgYXJjaGl2ZVRhcmdldCA9IG5ldyBFVldFQjIuQXJjaGl2ZVRhcmdldChzZXJ2ZXIsIHRhcmdldC5pZCwgdGFyZ2V0LmVuYWJsZWQsIHRhcmdldC50eXBlLCB1cGxvYWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2gpO1xuICAgICAgICAgICAgICAgICAgICBhcmNoaXZlVGFyZ2V0cy5wdXNoKGFyY2hpdmVUYXJnZXQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGFyY2hpdmVUYXJnZXRzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJykpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHVybDogc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5hcmNoaXZlVGFyZ2V0cyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHNlcnZlci5zZXNzaW9uSWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvclxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSwgdHJ1ZSk7XG4gICAgICAgIH07XG4gICAgfTtcblxufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBBdmFpbGFibGUgdmlkZW8gc3RhbmRhcmRzIGEgZGV2aWNlIGNvdWxkIHBvc3NpYmx5IGJlIHJlcG9ydGVkIGFzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IERldmljZVxuICAgICAqL1xuICAgIEVWV0VCMi52aWRlb1N0YW5kYXJkcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOVFNDXG4gICAgICAgICAqL1xuICAgICAgICBudHNjOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogUEFMXG4gICAgICAgICAqL1xuICAgICAgICBwYWw6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAzXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBEZXZpY2VDb25maWdDYW1lcmFJbmZvIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBjYW1lcmEgaW5mb3JtYXRpb24gb2YgYSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtpZD0nJ10gVGhlIElEIG9mIHRoZSBjYW1lcmFcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3BhcmVudElkPScnXSBUaGUgSUQgb2YgdGhlIHBhcmVudCBjYW1lcmEuICBUaGlzIHdpbGwgYmUgZXF1YWwgdG9cbiAgICAgKiB7QGxpbmsgRVZXRUIyLkRldmljZUNvbmZpZ0NhbWVyYUluZm8uaWR9IGlmIHRoZSBjYW1lcmEgaXMgdGhlIHByaW1hcnkgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIGRpc3BsYXkgbmFtZSBvZiB0aGUgY2FtZXJhLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2lzUHJpbWFyeT1mYWxzZV0gV2hldGhlciB0aGUgY2FtZXJhIGlzIHRoZSBwcmltYXJ5IGNhbWVyYS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgRGV2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLkRldmljZUNvbmZpZ0NhbWVyYUluZm8gPSBmdW5jdGlvbihpZCwgcGFyZW50SWQsIG5hbWUsIGlzUHJpbWFyeSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIHBhcmVudCBjYW1lcmEuICBUaGlzIHdpbGwgYmUgZXF1YWwgdG8gIHtAbGluayBFVldFQjIuRGV2aWNlQ29uZmlnQ2FtZXJhSW5mby5pZH0gaWYgdGhlIGNhbWVyYVxuICAgICAgICAgKiBpcyB0aGUgcHJpbWFyeSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXJlbnRJZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGlzcGxheSBuYW1lIG9mIHRoZSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGNhbWVyYSBpcyB0aGUgcHJpbWFyeSBjYW1lcmEuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXNQcmltYXJ5ID0gZmFsc2U7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYocGFyZW50SWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRJZCA9IHBhcmVudElkO1xuICAgICAgICB9XG4gICAgICAgIGlmKG5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihpc1ByaW1hcnkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgPSBpc1ByaW1hcnk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIERldmljZVR5cGVJbmZvIG9iamVjdCBhY3RzIGFzIGEgY29udGFpbmVyIGZvciBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gc3VwcG9ydGVkIGRldmljZSB0eXBlcy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9JyddIFRoZSBuYW1lIG9mIHRoZSBkZXZpY2UgdHlwZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJuYW1lPScnXSBUaGUgZGVmYXVsdCB1c2VybmFtZSBmb3IgY29ubmVjdGlvbnMgdG8gdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bhc3N3b3JkPScnXSBUaGUgZGVmYXVsdCBwYXNzd29yZCBmb3IgY29ubmVjdGlvbnMgdG8gdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MF0gVGhlIGRlZmF1bHQgcG9ydCBmb3IgdGhlIGRldmljZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgRGV2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLkRldmljZVR5cGVJbmZvID0gZnVuY3Rpb24obmFtZSwgdXNlcm5hbWUsIHBhc3N3b3JkLCBwb3J0KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmFtZSBvZiB0aGUgZGV2aWNlIHR5cGUuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZWZhdWx0IHVzZXJuYW1lIGZvciBjb25uZWN0aW9ucyB0byB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRlZmF1bHQgcGFzc3dvcmQgZm9yIGNvbm5lY3Rpb25zIHRvIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzd29yZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGVmYXVsdCBwb3J0IGZvciB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydCA9IDA7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodXNlcm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICAgICAgfVxuICAgICAgICBpZihwb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIERldmljZUNvbmZpZyBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBvZiBhIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2lkPTBdIFRoZSBkZXZpY2UgSUQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtuYW1lPScnXSBUaGUgbmFtZSBvZiB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaG9zdE5hbWU9JyddIFRoZSBob3N0IG5hbWUgb2YgdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MF0gVGhlIHBvcnQgZm9yIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt0eXBlPScnXSBUaGUgdHlwZSBvZiBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFttb2RlbD0nJ10gVGhlIGRldmljZSBtb2RlbC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21hY0FkZHJlc3M9JyddIFRoZSBNQUMgYWRkcmVzcyBvZiB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZmlybXdhcmU9JyddIFRoZSBmaXJtd2FyZSBpbmZvcm1hdGlvbiBvZiB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2VuYWJsZWQ9ZmFsc2VdIFdoZXRoZXIgdGhlIGRldmljZSBpcyBlbmFibGVkIG9yIG5vdC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjb25uZWN0aW9uU3RhdHVzPWZhbHNlXSBUaGUgY29ubmVjdGlvbiBzdGF0dXMgb2YgdGhlIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5EZXZpY2VDb25maWdDYW1lcmFJbmZvW119IFtjYW1lcmFJbmZvPVtdXSBJbmZvcm1hdGlvbiBhYm91dCB0aGUgY2FtZXJhcyBhc3NvY2lhdGVkIHdpdGggdGhpc1xuICAgICAqIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJuYW1lPScnXSBUaGUgdXNlcm5hbWUgZm9yIGNvbm5lY3Rpb25zIHRvIHRoZSBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBkZXZpY2UuXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBbc2VyaWFsPScnXSBUaGUgc2VyaWFsIG51bWJlciBvZiB0aGUgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbdmlkZW9TdGFuZGFyZD1FVldFQjIudmlkZW9TdGFuZGFyZHMubm9uZV0gVGhlIGRldmljZSB2aWRlbyBzdGFuZGFyZC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgRGV2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLkRldmljZUNvbmZpZyA9IGZ1bmN0aW9uKGlkLCBuYW1lLCBob3N0TmFtZSwgcG9ydCwgdHlwZSwgbW9kZWwsIG1hY0FkZHJlc3MsIGZpcm13YXJlLCBlbmFibGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uU3RhdHVzLCBjYW1lcmFJbmZvLCB1c2VybmFtZSwgc2VydmVyLCBzZXJpYWwsIHZpZGVvU3RhbmRhcmQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBob3N0IG5hbWUgb2YgdGhlIGRldmljZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhvc3ROYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZXZpY2UgcG9ydC5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvcnQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgZm9yIGNvbm5lY3Rpb25zIHRvIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51c2VybmFtZSA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGV2aWNlIHR5cGUuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZXZpY2UgSUQuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIGRldmljZSBpcyBlbmFibGVkIG9yIG5vdC5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZXZpY2UgbW9kZWwuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tb2RlbCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGV2aWNlIE1BQyBhZGRyZXNzLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWFjQWRkcmVzcyA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGV2aWNlIHNlcmlhbCBudW1iZXIgLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VyaWFsID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBmaXJtd2FyZSBpbmZvcm1hdGlvbiBvZiB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZmlybXdhcmUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNvbm5lY3Rpb24gc3RhdHVzIG9mIHRoZSBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbmZvcm1hdGlvbiBhYm91dCB0aGUgY2FtZXJhcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5EZXZpY2VDb25maWdDYW1lcmFJbmZvW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FtZXJhSW5mbyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VydmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2aWRlbyBzdGFuZGFyZCBvZiB0aGUgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIudmlkZW9TdGFuZGFyZHNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmlkZW9TdGFuZGFyZCA9IEVWV0VCMi52aWRlb1N0YW5kYXJkcy5ub25lO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKGhvc3ROYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaG9zdE5hbWUgPSBob3N0TmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYodXNlcm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSBCb29sZWFuKGVuYWJsZWQpO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1vZGVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgfVxuICAgICAgICBpZihtYWNBZGRyZXNzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWFjQWRkcmVzcyA9IG1hY0FkZHJlc3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZmlybXdhcmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5maXJtd2FyZSA9IGZpcm13YXJlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGNvbm5lY3Rpb25TdGF0dXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzID0gY29ubmVjdGlvblN0YXR1cztcbiAgICAgICAgfVxuICAgICAgICBpZihjYW1lcmFJbmZvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhSW5mbyA9IGNhbWVyYUluZm87XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2VydmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoc2VyaWFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VyaWFsID0gc2VyaWFsO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYodmlkZW9TdGFuZGFyZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnZpZGVvU3RhbmRhcmQgPSB2aWRlb1N0YW5kYXJkO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZWxldGVEZXZpY2UgaXMgYSBtZXRob2QgdGhhdCBkZWxldGVzIGEgZGV2aWNlIGZyb20gdGhlIHNlcnZlci4gTm90ZTogRGVsZXRpbmcgYSBkZXZpY2Ugd2lsbCBtYWtlXG4gICAgICAgICAqIGFueSByZWNvcmRlZCB2aWRlbyBub24tc2VhcmNoYWJsZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZWxldGVEZXZpY2UgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHNlcnZlciA9IHRoaXMuc2VydmVyO1xuXG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkRlbGV0ZURldmljZUVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkRlbGV0ZURldmljZVN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiBzZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgIGlkOiB0aGlzLmlkXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25EZWxldGVEZXZpY2VTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkRlbGV0ZURldmljZUVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5kZXZpY2VzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXBkYXRlRGV2aWNlIGlzIGEgbWV0aG9kIHRoYXQgaGVscHMgdG8gdXBkYXRlIHRoZSBkZXZpY2UgY29uZmlndXJhdGlvbiBvbiB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFzc3dvcmRdIFRoZSBwYXNzd29yZCBmb3IgY29ubmVjdGlvbnMgdG8gdGhlIGRldmljZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXBkYXRlRGV2aWNlID0gZnVuY3Rpb24oY2FsbGJhY2ssIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcy5zZXJ2ZXI7XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uVXBkYXRlRGV2aWNlRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uVXBkYXRlRGV2aWNlU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICAgICAgaG9zdDogdGhpcy5ob3N0TmFtZSxcbiAgICAgICAgICAgICAgICBwb3J0OiB0aGlzLnBvcnQsXG4gICAgICAgICAgICAgICAgdXNlcjogdGhpcy51c2VybmFtZSxcbiAgICAgICAgICAgICAgICBlbmFibGVkOiB0aGlzLmVuYWJsZWRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHBhc3N3b3JkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uVXBkYXRlRGV2aWNlU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25VcGRhdGVEZXZpY2VFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZGV2aWNlcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCBzZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgIH07XG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgTGl2ZVVzZXJQZXJtaXNzaW9ucyBvYmplY3QgcmVwcmVzZW50cyB0aGUgcGVybWlzc2lvbnMgZm9yIGxpdmUgcGxheWJhY2sgb24gdGhlIHNwZWNpZmllZCBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYmFzZT1mYWxzZV0gUGVybWlzc2lvbiB0byB2aWV3IHRoZSBsaXZlIHRhYi4gIE5vdGU6IElmIHRoaXMgcGFyYW1ldGVyIGlzIGZhbHNlLFxuICAgICAqIGFsbCBvdGhlciBwYXJhbWV0ZXJzIHdpbGwgYmUgaWdub3JlZCBhbmQgc2V0IHRvIGZhbHNlLlxuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgb2JqZWN0IGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Yge0BsaW5rIEVWV0VCMi5Vc2VyR3JvdXB9IHdoaWNoIGluY2x1ZGVzIGluZm9ybWF0aW9uXG4gICAgICogYWJvdXQgYSBncm91cCBhbmQgYWxsIGl0cyBwZXJtaXNzaW9ucy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtncm91cHM9ZmFsc2VdIFBlcm1pc3Npb24gdG8gdmlldyBncm91cHMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbWFwcz1mYWxzZV0gUGVybWlzc2lvbiB0byB2aWV3IG1hcHMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbdmlld3M9ZmFsc2VdIFBlcm1pc3Npb24gdG8gdmlldyB2aWV3cy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtxdWlja1JlcGxheT1mYWxzZV0gUGVybWlzc2lvbiB0byB2aWV3IHF1aWNrUmVwbGF5LlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3B0ej1mYWxzZV0gUGVybWlzc2lvbiB0byBwZXJmb3JtIFBUWiBhY3Rpb25zLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3R3b1dheUF1ZGlvPWZhbHNlXSBQZXJtaXNzaW9uIHRvIGludGVyYWN0IHdpdGggdHdvLXdheSBhdWRpby5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtldmVudE1vbml0b3I9ZmFsc2VdIFBlcm1pc3Npb24gdG8gdmlldyBldmVudCBtb25pdG9yLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NhdmVJbWFnZT1mYWxzZV0gUGVybWlzc2lvbiB0byBzYXZlIGltYWdlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtwcmludEltYWdlPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHByaW50IGltYWdlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjYW1lcmFzPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHZpZXcgY2FtZXJhcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt2aWRlb1B1c2g9ZmFsc2VdIFBlcm1pc3Npb24gdG8gcGVyZm9ybSB2aWRlbyBwdXNoLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuTGl2ZVVzZXJQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKGJhc2UsIGdyb3VwcywgbWFwcywgdmlld3MsIHF1aWNrUmVwbGF5LCBwdHosIHR3b1dheUF1ZGlvLCBldmVudE1vbml0b3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlSW1hZ2UsIHByaW50SW1hZ2UsIGNhbWVyYXMsIHZpZGVvUHVzaCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogUGVybWlzc2lvbiB0byB2aWV3IHRoZSBsaXZlIHRhYi4gIE5vdGU6IElmIHRoaXMgcGFyYW1ldGVyIGlzIGZhbHNlLCBhbGwgb3RoZXIgcGFyYW1ldGVycyB3aWxsIGJlIGlnbm9yZWRcbiAgICAgICAgICogYW5kIHNldCB0byBmYWxzZS5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5iYXNlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyBncm91cHMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JvdXBzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyBtYXBzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hcHMgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiB0byB2aWV3IHZpZXdzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZpZXdzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyBxdWlja1JlcGxheS5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5xdWlja1JlcGxheSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHBlcmZvcm0gcHR6IGFjdGlvbnMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHR6ID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gaW50ZXJhY3Qgd2l0aCB0d28td2F5IGF1ZGlvLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR3b1dheUF1ZGlvID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyBldmVudCBtb25pdG9yLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50TW9uaXRvciA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNhdmUgaW1hZ2VzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNhdmVJbWFnZSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHByaW50IGltYWdlcy5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcmludEltYWdlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyBjYW1lcmFzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbWVyYXMgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiB0byBwZXJmb3JtIHZpZGVvIHB1c2guXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudmlkZW9QdXNoID0gZmFsc2U7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihiYXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYmFzZSA9IGJhc2U7XG4gICAgICAgICAgICBpZighdGhpcy5iYXNlKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJhc2UgbGV2ZWwgaXNuJ3Qgc3VwcG9ydGVkLCBhbGwgdGhlIG90aGVycyB3aWxsIHN0YXkgYXQgdGhlIGRlZmF1bHQgZmFsc2UuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGdyb3VwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmdyb3VwcyA9IGdyb3VwcztcbiAgICAgICAgfVxuICAgICAgICBpZihtYXBzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWFwcyA9IG1hcHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYodmlld3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52aWV3cyA9IHZpZXdzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHF1aWNrUmVwbGF5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucXVpY2tSZXBsYXkgPSBxdWlja1JlcGxheTtcbiAgICAgICAgfVxuICAgICAgICBpZihwdHogIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wdHogPSBwdHo7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHdvV2F5QXVkaW8gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50d29XYXlBdWRpbyA9IHR3b1dheUF1ZGlvO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV2ZW50TW9uaXRvciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50TW9uaXRvciA9IGV2ZW50TW9uaXRvcjtcbiAgICAgICAgfVxuICAgICAgICBpZihzYXZlSW1hZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zYXZlSW1hZ2UgPSBzYXZlSW1hZ2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYocHJpbnRJbWFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnByaW50SW1hZ2UgPSBwcmludEltYWdlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGNhbWVyYXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzID0gY2FtZXJhcztcbiAgICAgICAgfVxuICAgICAgICBpZih2aWRlb1B1c2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52aWRlb1B1c2ggPSB2aWRlb1B1c2g7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFNlYXJjaFVzZXJQZXJtaXNzaW9ucyBvYmplY3QgcmVwcmVzZW50cyB0aGUgcGVybWlzc2lvbnMgZm9yIHNlYXJjaCBwbGF5YmFjayBvbiB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtiYXNlPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHZpZXcgdGhlIHNlYXJjaCB0YWIuICBOb3RlOiBJZiB0aGlzIHBhcmFtZXRlciBpcyBmYWxzZSxcbiAgICAgKiBhbGwgb3RoZXIgcGFyYW1ldGVycyB3aWxsIGJlIGlnbm9yZWQgYW5kIHNldCB0byBmYWxzZS5cbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG9iamVjdCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIuVXNlckdyb3VwfSB3aGljaCBpbmNsdWRlcyBpbmZvcm1hdGlvblxuICAgICAqIGFib3V0IGEgZ3JvdXAgYW5kIGFsbCBpdHMgcGVybWlzc2lvbnMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbZ3JvdXBzPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHNlYXJjaCBncm91cHMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbWFwcz1mYWxzZV0gUGVybWlzc2lvbiB0byBzZWFyY2ggbWFwcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt2aWV3cz1mYWxzZV0gUGVybWlzc2lvbiB0byBzZWFyY2ggdmlld3MuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbZXZlbnRzPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHNlYXJjaCBldmVudHMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbc2F2ZUltYWdlPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHNhdmUgaW1hZ2VzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3ByaW50SW1hZ2U9ZmFsc2VdIFBlcm1pc3Npb24gdG8gcHJpbnQgaW1hZ2VzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2J1cm5EaXNjPWZhbHNlXSBQZXJtaXNzaW9uIHRvIGJ1cm4gZGlzY3MuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbZXhwb3J0VmlkZW89ZmFsc2VdIFBlcm1pc3Npb24gdG8gZXhwb3J0IHZpZGVvLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NtYXJ0U2VhcmNoPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHBlcmZvcm0gc21hcnQgc2VhcmNoLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2Nhc2VzPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHNlYXJjaCBjYXNlcy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjYW1lcmFzPWZhbHNlXSBQZXJtaXNzaW9uIHRvIHNlYXJjaCBjYW1lcmFzLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuU2VhcmNoVXNlclBlcm1pc3Npb25zID0gZnVuY3Rpb24oYmFzZSwgZ3JvdXBzLCBtYXBzLCB2aWV3cywgZXZlbnRzLCBzYXZlSW1hZ2UsIHByaW50SW1hZ2UsIGJ1cm5EaXNjLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBvcnRWaWRlbywgc21hcnRTZWFyY2gsIGNhc2VzLCBjYW1lcmFzKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQZXJtaXNzaW9uIHRvIHZpZXcgdGhlIHNlYXJjaCB0YWIuICBOb3RlOiBJZiB0aGlzIHBhcmFtZXRlciBpcyBmYWxzZSwgYWxsIG90aGVyIHBhcmFtZXRlcnMgd2lsbCBiZSBpZ25vcmVkXG4gICAgICAgICAqIGFuZCBzZXQgdG8gZmFsc2UuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYmFzZSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNlYXJjaCBncm91cHMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JvdXBzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gc2VhcmNoIG1hcHMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWFwcyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNlYXJjaCB2aWV3cy5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52aWV3cyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNlYXJjaCBldmVudHMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gc2F2ZSBpbWFnZXMuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2F2ZUltYWdlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gcHJpbnQgaW1hZ2VzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnByaW50SW1hZ2UgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiB0byB2aWV3IGJ1cm4gZGlzY3MuXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnVybkRpc2MgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiB0byBleHBvcnQgdmlkZW8uXG4gICAgICAgICAqIEB0eXBlIEJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXhwb3J0VmlkZW8gPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdXNlciBoYXMgcGVybWlzc2lvbiB0byBwZXJmb3JtIHNtYXJ0IHNlYXJjaC5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zbWFydFNlYXJjaCA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNlYXJjaCBjYXNlcy5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYXNlcyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIHNlYXJjaCBjYW1lcmFzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbWVyYXMgPSBmYWxzZTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGJhc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5iYXNlID0gYmFzZTtcbiAgICAgICAgICAgIGlmKCF0aGlzLmJhc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgYmFzZSBsZXZlbCBpc24ndCBzdXBwb3J0ZWQsIGFsbCB0aGUgb3RoZXJzIHdpbGwgc3RheSBhdCB0aGUgZGVmYXVsdCBmYWxzZS5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoZ3JvdXBzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzO1xuICAgICAgICB9XG4gICAgICAgIGlmKG1hcHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tYXBzID0gbWFwcztcbiAgICAgICAgfVxuICAgICAgICBpZih2aWV3cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdzID0gdmlld3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZXZlbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHNhdmVJbWFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNhdmVJbWFnZSA9IHNhdmVJbWFnZTtcbiAgICAgICAgfVxuICAgICAgICBpZihwcmludEltYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJpbnRJbWFnZSA9IHByaW50SW1hZ2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYnVybkRpc2MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5idXJuRGlzYyA9IGJ1cm5EaXNjO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4cG9ydFZpZGVvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZXhwb3J0VmlkZW8gPSBleHBvcnRWaWRlbztcbiAgICAgICAgfVxuICAgICAgICBpZihzbWFydFNlYXJjaCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNtYXJ0U2VhcmNoID0gc21hcnRTZWFyY2g7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY2FzZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jYXNlcyA9IGNhc2VzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGNhbWVyYXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzID0gY2FtZXJhcztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgQ29uZmlnVXNlclBlcm1pc3Npb25zIG9iamVjdCByZXByZXNlbnRzIHRoZSB1c2VyIHBlcm1pc3Npb25zIGZvciBjb25maWd1cmluZyB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgKiBAZGVwcmVjYXRlZCBUaGlzIG9iamVjdCBpcyBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHtAbGluayBFVldFQjIuVXNlckdyb3VwfSB3aGljaCBpbmNsdWRlcyBpbmZvcm1hdGlvblxuICAgICAqIGFib3V0IGEgZ3JvdXAgYW5kIGFsbCBpdHMgcGVybWlzc2lvbnMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbdXNlckFkbWluPWZhbHNlXSBQZXJtaXNzaW9uIHRvIGFkbWluaXN0cmF0ZSB1c2Vycy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt2aWV3QWRtaW49ZmFsc2VdIFBlcm1pc3Npb24gdG8gYWRtaW5pc3RyYXRlIHZpZXdzLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuQ29uZmlnVXNlclBlcm1pc3Npb25zID0gZnVuY3Rpb24odXNlckFkbWluLCB2aWV3QWRtaW4pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBlcm1pc3Npb24gdG8gYWRtaW5pc3RyYXRlIHVzZXJzLlxuICAgICAgICAgKiBAdHlwZSBCb29sZWFuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJBZG1pbiA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQZXJtaXNzaW9uIHRvIGFkbWluaXN0cmF0ZSB2aWV3cy5cbiAgICAgICAgICogQHR5cGUgQm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52aWV3QWRtaW4gPSBmYWxzZTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHVzZXJBZG1pbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnVzZXJBZG1pbiA9IHVzZXJBZG1pbjtcbiAgICAgICAgfVxuICAgICAgICBpZih2aWV3QWRtaW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy52aWV3QWRtaW4gPSB2aWV3QWRtaW47XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFVzZXJQZXJtaXNzaW9ucyBvYmplY3QgcmVwcmVzZW50cyB0aGUgdXNlciBwZXJtaXNzaW9ucyBmb3IgdGhlIGxvZ2dlZCBpbiB1c2VyIG9uIHRoZSBzcGVjaWZpZWQgc2VydmVyLlxuICAgICAqIEBkZXByZWNhdGVkIFRoaXMgb2JqZWN0IGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2Yge0BsaW5rIEVWV0VCMi5Vc2VyR3JvdXB9IHdoaWNoIGluY2x1ZGVzIGluZm9ybWF0aW9uXG4gICAgICogYWJvdXQgYSBncm91cCBhbmQgYWxsIGl0cyBwZXJtaXNzaW9ucy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5MaXZlVXNlclBlcm1pc3Npb25zfSBbbGl2ZVBlcm1pc3Npb25zPW51bGxdIFRoZSBsaXZlIHBlcm1pc3Npb25zIGZvciB0aGUgdXNlciBvbiB0aGUgcHJvdmlkZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlYXJjaFVzZXJQZXJtaXNzaW9uc30gW3NlYXJjaFBlcm1pc3Npb25zPW51bGxdIFRoZSBzZWFyY2ggcGVybWlzc2lvbnMgZm9yIHRoZSB1c2VyIG9uIHRoZVxuICAgICAqIHByb3ZpZGVkIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Db25maWdVc2VyUGVybWlzc2lvbnN9IFtjb25maWdQZXJtaXNzaW9ucz1udWxsXSBUaGUgY29uZmlndXJhdGlvbiBwZXJtaXNzaW9ucyBmb3IgdGhlIHVzZXIgb24gdGhlXG4gICAgICogcHJvdmlkZWQgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmFjY2Vzc0xldmVsVHlwZX0gW2FjY2Vzc0xldmVsPUVWV0VCMi5hY2Nlc3NMZXZlbFR5cGUudW5rbm93bl0gVGhlIGFjY2VzcyBsZXZlbCBvZiB0aGUgdXNlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlVzZXJQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uKGxpdmVQZXJtaXNzaW9ucywgc2VhcmNoUGVybWlzc2lvbnMsIGNvbmZpZ1Blcm1pc3Npb25zLCBhY2Nlc3NMZXZlbCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxpdmUgcGVybWlzc2lvbnMgZm9yIHRoZSB1c2VyIG9uIHRoZSBwcm92aWRlZCBzZXJ2ZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5MaXZlVXNlclBlcm1pc3Npb25zXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxpdmVQZXJtaXNzaW9ucyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsaXZlIHBlcm1pc3Npb25zIGZvciB0aGUgdXNlciBvbiB0aGUgcHJvdmlkZWQgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuU2VhcmNoVXNlclBlcm1pc3Npb25zXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlYXJjaFBlcm1pc3Npb25zID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBlcm1pc3Npb25zIGZvciB0aGUgdXNlciB0byBjb25maWd1cmUgdGhlIHByb3ZpZGVkIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLkNvbmZpZ1VzZXJQZXJtaXNzaW9uc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb25maWdQZXJtaXNzaW9ucyA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhY2Nlc3MgbGV2ZWwgb2YgdGhlIHVzZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5hY2Nlc3NMZXZlbFR5cGVcbiAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY2Nlc3NMZXZlbCA9IEVWV0VCMi5hY2Nlc3NMZXZlbFR5cGUudW5rbm93bjtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGxpdmVQZXJtaXNzaW9ucyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmxpdmVQZXJtaXNzaW9ucyA9IGxpdmVQZXJtaXNzaW9ucztcbiAgICAgICAgfVxuICAgICAgICBpZihzZWFyY2hQZXJtaXNzaW9ucyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlYXJjaFBlcm1pc3Npb25zID0gc2VhcmNoUGVybWlzc2lvbnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29uZmlnUGVybWlzc2lvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jb25maWdQZXJtaXNzaW9ucyA9IGNvbmZpZ1Blcm1pc3Npb25zO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFjY2Vzc0xldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWNjZXNzTGV2ZWwgPSBhY2Nlc3NMZXZlbDtcbiAgICAgICAgfVxuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG5cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBhY2NvdW50IHR5cGUgb2YgdGhlIHVzZXIuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLmFjY291bnRUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvY2FsIFVzZXJcbiAgICAgICAgICovXG4gICAgICAgIGxvY2FsOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTERBUCBVc2VyXG4gICAgICAgICAqL1xuICAgICAgICBsZGFwOiAxXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBVc2VyIG9iamVjdCByZXByZXNlbnRzIGEgc2luZ2xlIHVzZXIgYWNjb3VudCBvbiB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gW3NlcnZlcj1udWxsXSBUaGUgc2VydmVyIHRoZSB1c2VyIGlzIGFzc29jaWF0ZWQgd2l0aC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJuYW1lPScnXSBUaGUgdXNlcidzIGxvZ2luIHVzZXJuYW1lLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZ3JvdXBOYW1lPScnXSBUaGUgbmFtZSBvZiB0aGUgZ3JvdXAgdGhlIHVzZXIgYmVsb25ncyB0by5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5hY2NvdW50VHlwZXN9IFthY2NvdW50VHlwZT1FVldFQjIuYWNjb3VudFR5cGVzLmxvY2FsXSBUaGUgdHlwZSBvZiB1c2VyIGFjY291bnQuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNPcnBoYW5lZD1mYWxzZV0gV2hldGhlciB0aGUgYWNjb3VudCBpcyBvcnBoYW5lZCBvciBub3QuIFRoaXMgZmxhZyBpcyBzZXQgb25seSBmb3IgTERBUCBhY2NvdW50cy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtpc01hbmFnZWQ9ZmFsc2VdIFdoZXRoZXIgdGhlIGFjY291bnQgaXMgbWFuYWdlZCBvciBub3QuIElmIHRoaXMgZmxhZyBpcyBzZXQsIHRoZSB1c2VyIGlzXG4gICAgICogbWFuYWdlZCBieSBhbiBleHRlcm5hbCB0aGlyZC1wYXJ0eSBhbmQgY2FuIG5vdCBiZSBlZGl0ZWQgYnkgdXNlcnMgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlVzZXIgPSBmdW5jdGlvbihzZXJ2ZXIsIHVzZXJuYW1lLCBncm91cE5hbWUsIGFjY291bnRUeXBlLCBpc09ycGhhbmVkLCBpc01hbmFnZWQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIHVzZXIuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5TZXJ2ZXJcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVzZXIncyBsb2dpbiB1c2VybmFtZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZXJuYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBncm91cCBuYW1lIHRoZSB1c2VyIGJlbG9uZ3MgdG8uXG4gICAgICAgICAqIEB0eXBlICcnXG4gICAgICAgICovXG4gICAgICAgIHRoaXMuZ3JvdXBOYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHVzZXIgYWNjb3VudC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmFjY291bnRUeXBlc1xuICAgICAgICAqL1xuICAgICAgICB0aGlzLmFjY291bnRUeXBlID0gRVZXRUIyLmFjY291bnRUeXBlcy5sb2NhbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgYWNjb3VudCBpcyBtYW5hZ2VkIG9yIG5vdC4gSWYgdGhpcyBmbGFnIGlzIHNldCwgdGhlIHVzZXIgaXMgbWFuYWdlZCBieSBhblxuICAgICAgICAgKiBleHRlcm5hbCB0aGlyZC1wYXJ0eSBhbmQgY2FuIG5vdCBiZSBlZGl0ZWQgYnkgdXNlcnMgb2YgdGhlIHNlcnZlci5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzTWFuYWdlZCA9IGZhbHNlO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKHVzZXJuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZihncm91cE5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5ncm91cE5hbWUgPSBncm91cE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY291bnRUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYWNjb3VudFR5cGUgPSBhY2NvdW50VHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihhY2NvdW50VHlwZSA9PT0gRVZXRUIyLmFjY291bnRUeXBlcy5sZGFwICYmIGlzT3JwaGFuZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pc09ycGhhbmVkID0gaXNPcnBoYW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZihpc01hbmFnZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pc01hbmFnZWQgPSBpc01hbmFnZWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmUgdGhlIG9yaWdpbmFsIHVzZXJuYW1lIHRvIGRldGVjdCBuYW1lIGNoYW5nZXNcbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHZhciBvcmlnaW5hbFVzZXJuYW1lID0gdGhpcy51c2VybmFtZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlIGEgdXNlciBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWRcbiAgICAgICAgICogYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZWxldGVVc2VyID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSB0aGlzLnNlcnZlcjtcblxuICAgICAgICAgICAgaWYodHlwZW9mIGNhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYWxsYmFjayByZXF1aXJlZCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25EZWxldGVVc2VyRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRGVsZXRlVXNlclN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICB1c2VyOiB0aGlzLnVzZXJuYW1lXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25EZWxldGVVc2VyU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25EZWxldGVVc2VyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnVzZXJzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhpcyBtZXRob2QgdXBkYXRlcyBhbiBleGlzdGluZyB1c2VyIG9uIHRoZSBzZXJ2ZXIuIFRoaXMgZnVuY3Rpb24gaXMgYWxzbyB1c2VkIHRvIHVwZGF0ZSBhIGdyb3VwIGJ5IG1ha2luZ1xuICAgICAgICAgKiBjaGFuZ2VzIHRvIHRoZSB1c2VyJ3MgZ3JvdXAuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWRcbiAgICAgICAgICogYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuVXNlckdyb3VwfSBbdXNlckdyb3VwXSBUaGUgdXNlciBncm91cCBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtwYXNzd29yZD0nJ10gVGhlIHBhc3N3b3JkIGZvciB0aGUgdXNlciBhY2NvdW50LCBwYXNzd29yZCBsZWZ0IHVudG91Y2hlZCBpZiBub3QgZ2l2ZW4uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB1c2VyR3JvdXAsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICB2YXIgc2VydmVyID0gdGhpcy5zZXJ2ZXI7XG4gICAgICAgICAgICB2YXIgdXNlciA9IHRoaXM7XG5cbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uVXBkYXRlVXNlckVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblVwZGF0ZVVzZXJTdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHVzZXIudXNlcm5hbWUgIT09IG9yaWdpbmFsVXNlcm5hbWUpe1xuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBvcmlnaW5hbCBuYW1lIGZvciBzdWJzZXF1ZW50IHVwZGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxVc2VybmFtZSA9IHVzZXIudXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBuYW1lOiB0aGlzLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHJvbGU6IHVzZXJHcm91cC5hY2Nlc3NMZXZlbCxcbiAgICAgICAgICAgICAgICBhY2NvdW50VHlwZTogdGhpcy5hY2NvdW50VHlwZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKHVzZXJHcm91cCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGJpdG1hc2sgPSBFVldFQjIudXRpbC5pbnRlcm5hbC5nZW5lcmF0ZVBlcm1pc3Npb25zQml0bWFzayh1c2VyR3JvdXAucGVybWlzc2lvbnMpO1xuICAgICAgICAgICAgICAgIHBhcmFtc1snZ3VpZCddID0gdXNlckdyb3VwLmd1aWQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBOYW1lJ10gPSB1c2VyR3JvdXAubmFtZTtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ2dycEdyb3VwUGVybWlzc2lvbiddID0gYml0bWFzay5ncm91cDtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ2dycFVzZXJQZXJtaXNzaW9uJ10gPSBiaXRtYXNrLnVzZXI7XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBBZG1pblBlcm1pc3Npb24nXSA9IGJpdG1hc2suYWRtaW47XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBDYW1lcmFzJ10gPSB1c2VyR3JvdXAuY3VzdG9tR3JvdXBQZXJtaXNzaW9ucy5jYW1lcmFzLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgICAgIHBhcmFtc1snZ3JwQXVkaW9zJ10gPSB1c2VyR3JvdXAuY3VzdG9tR3JvdXBQZXJtaXNzaW9ucy5hdWRpb3Muam9pbihcIixcIik7XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBTZXJpYWxzJ10gPSB1c2VyR3JvdXAuY3VzdG9tR3JvdXBQZXJtaXNzaW9ucy5zZXJpYWxzLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgICAgIHBhcmFtc1snZ3JwU29mdFRyaWdnZXJzJ10gPSB1c2VyR3JvdXAuY3VzdG9tR3JvdXBQZXJtaXNzaW9ucy5zb2Z0VHJpZ2dlcnMuam9pbihcIixcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcmlnaW5hbFVzZXJuYW1lICE9PSAnJyAmJiBvcmlnaW5hbFVzZXJuYW1lICE9PSB0aGlzLnVzZXJuYW1lKXtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ29yaWdpbmFsTmFtZSddID0gb3JpZ2luYWxVc2VybmFtZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhc3N3b3JkICE9PSB1bmRlZmluZWQgJiYgcGFzc3dvcmQgIT09ICcnKXtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ3Bhc3N3b3JkJ10gPSBwYXNzd29yZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHByaW9yaXR5ID0gdXNlckdyb3VwLmdldFByaW9yaXR5KEVWV0VCMi5ncm91cFByaW9yaXR5VHlwZXMucHR6KTtcbiAgICAgICAgICAgIGlmIChwcmlvcml0eSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICBwYXJhbXNbJ2dycFB0elByaW9yaXR5J10gPSBwcmlvcml0eS52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJpb3JpdHkgPSB1c2VyR3JvdXAuZ2V0UHJpb3JpdHkoRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlcy50d29XYXlBdWRpbyk7XG4gICAgICAgICAgICBpZiAocHJpb3JpdHkgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgcGFyYW1zWydncnBBdWRpb1ByaW9yaXR5J10gPSBwcmlvcml0eS52YWx1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcHJpb3JpdHkgPSB1c2VyR3JvdXAuZ2V0UHJpb3JpdHkoRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlcy5jbGllbnQpO1xuICAgICAgICAgICAgaWYgKHByaW9yaXR5ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHBhcmFtc1snZ3JwUmVtb3RlUHJpb3JpdHknXSA9IHByaW9yaXR5LnZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25VcGRhdGVVc2VyU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25VcGRhdGVVc2VyRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnVzZXJzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xufSgpKTsiLCIvKiBnbG9iYWxzIEVWV0VCMjp0cnVlICovXG5cbihmdW5jdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBJbiBzZXJ2ZXIgYXJiaXRyYXRpb24gY2FzZXMsIGEgdXNlciB3aXRoIHByaW9yaXR5IGNhbiBvdmVycmlkZSB0aG9zZSB3aXRob3V0XG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmUuICBVc2VyIGFsd2F5cyBsb3NlcyBhcmJpdHJhdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgbm9uZTogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBUWi4gVXNlciBjYW4gdGFrZSBvdmVyIFBUWiBjb250cm9scyBmcm9tIHRob3NlIHdpdGggbG93ZXIgcHJpb3JpdHlcbiAgICAgICAgICovXG4gICAgICAgIHB0ejogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFR3by13YXkgQXVkaW8uIFVzZXIgY2FuIHRha2Ugb3ZlciBzb3VuZCBzZW50IG91dCBvZiBhIGRldmljZSBmcm9tIHRob3NlIHdpdGggbG93ZXIgcHJpb3JpdHlcbiAgICAgICAgICovXG4gICAgICAgIHR3b1dheUF1ZGlvOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xpZW50LiBVc2VyIGNhbiBvdmVycmlkZSBvdGhlciBwdXNoZWQgdmlkZW8gZnJvbSB0aG9zZSB3aXRoIGxvd2VyIHByaW9yaXR5XG4gICAgICAgICAqL1xuICAgICAgICBjbGllbnQ6IDNcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFVzZXJHcm91cFBlcm1pc3Npb25zIG9iamVjdCByZXByZXNlbnRzIHRoZSBwZXJtaXNzaW9ucyBhc3NvY2lhdGVkIHdpdGggYSBwYXJ0aWN1bGFyIGdyb3VwIG9uXG4gICAgICogdGhlIHNwZWNpZmllZCBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIudXNlclBlcm1pc3Npb25zW119IFtwZXJtaXNzaW9ucz1bXV0gQW4gYXJyYXkgb2YgdGhlIGF2YWlsYWJsZSBuYW1lZCBwZXJtaXNzaW9ucyBmb3JcbiAgICAgKiBhIGdyb3VwLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJ2ZXJcbiAgICAgKi9cbiAgICBFVldFQjIuVXNlckdyb3VwUGVybWlzc2lvbnMgPSBmdW5jdGlvbihwZXJtaXNzaW9ucykge1xuICAgICAgICAvKipcbiAgICAgICAgICogQW4gYXJyYXkgb2YgdGhlIGF2YWlsYWJsZSBwZXJtaXNzaW9ucyBmb3IgYSBncm91cC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLnVzZXJQZXJtaXNzaW9uc1tdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBlcm1pc3Npb25zID0gW107XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZiAocGVybWlzc2lvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25zO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERldGVybWluZXMgd2hldGhlciB0aGUgRVZXRUIyLlVzZXJHcm91cFBlcm1pc3Npb25zIG9iamVjdCBoYXMgYSBzcGVjaWZpYyBwZXJtaXNzaW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi51c2VyUGVybWlzc2lvbnN9IHBlcm1pc3Npb24gVGhlIHVzZXIgcGVybWlzc2lvbiB0byBjaGVjay5cbiAgICAgICAgICogQHJldHVybnMge0Jvb2xlYW59IFdoZXRoZXIgdGhlIG9iamVjdCBoYXMgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oYXNQZXJtaXNzaW9uID0gZnVuY3Rpb24gKHBlcm1pc3Npb24pIHtcbiAgICAgICAgICAgIGlmKCQuaW5BcnJheShwZXJtaXNzaW9uLCB0aGlzLnBlcm1pc3Npb25zKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIG9iamVjdCBoYXMgQU5ZIG9mIHRoZSBwZXJtaXNzaW9ucyBnaXZlbi5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIudXNlclBlcm1pc3Npb25zW119IHBlcm1pc3Npb25zIEFycmF5IG9mIHBlcm1pc3Npb25zIHRvIGNoZWNrLlxuICAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gV2hldGhlciB0aGUgb2JqZWN0IGhhcyBhdCBsZWFzdCBvbmUgb2YgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGFzQW55UGVybWlzc2lvbnMgPSBmdW5jdGlvbiAocGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uc0FycmF5ID0gdGhpcy5wZXJtaXNzaW9ucztcbiAgICAgICAgICAgIHZhciBpO1xuXG4gICAgICAgICAgICBmb3IoaT0wOyBpPHBlcm1pc3Npb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYoJC5pbkFycmF5KHBlcm1pc3Npb25zW2ldLCBwZXJtaXNzaW9uc0FycmF5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIG9iamVjdCBoYXMgQUxMIG9mIHRoZSBwZXJtaXNzaW9ucyBnaXZlbi5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIudXNlclBlcm1pc3Npb25zW119IHBlcm1pc3Npb25zIEFycmF5IG9mIHBlcm1pc3Npb25zIHRvIGNoZWNrLlxuICAgICAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn0gV2hldGhlciB0aGUgb2JqZWN0IGhhcyBBTEwgb2YgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaGFzQWxsUGVybWlzc2lvbnMgPSBmdW5jdGlvbiAocGVybWlzc2lvbnMpIHtcbiAgICAgICAgICAgIHZhciBwZXJtaXNzaW9uc0FycmF5ID0gdGhpcy5wZXJtaXNzaW9ucztcbiAgICAgICAgICAgIHZhciBoYXNBbGxQZXJtaXNzaW9ucyA9IHRydWU7XG5cbiAgICAgICAgICAgICQuZWFjaChwZXJtaXNzaW9ucywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBoYXNBbGxQZXJtaXNzaW9ucyA9ICQuaW5BcnJheShlbGVtZW50LCBwZXJtaXNzaW9uc0FycmF5KSAhPT0gLTEgJiYgaGFzQWxsUGVybWlzc2lvbnM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBoYXNBbGxQZXJtaXNzaW9ucztcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIEN1c3RvbUdyb3VwUGVybWlzc2lvbnMgb2JqZWN0IHJlcHJlc2VudHMgdGhlIGFkZGl0aW9uYWwgZ3JvdXAgcGVybWlzc2lvbnMvcmVzdHJpY3Rpb25zIGZvciBhXG4gICAgICogcGFydGljdWxhciBncm91cCBvbiB0aGUgc3BlY2lmaWVkIHNlcnZlci5cbiAgICAgKiBAcGFyYW0ge051bWJlcltdfSBbY2FtZXJhcz1bXV0gQW4gYXJyYXkgb2YgY2FtZXJhIGlkJ3MgdGhlIGdyb3VwIGhhcyBwZXJtaXNzaW9ucyBmb3IuXG4gICAgICogQHBhcmFtIHtOdW1iZXJbXX0gW2F1ZGlvcz1bXV0gQW4gYXJyYXkgb2YgYXVkaW8gaWQncyB0aGUgZ3JvdXAgaGFzIHBlcm1pc3Npb25zIGZvci5cbiAgICAgKiBAcGFyYW0ge051bWJlcltdfSBbc2VyaWFscz1bXV0gQW4gYXJyYXkgb2Ygc2VyaWFsIGlkJ3MgdGhlIGdyb3VwIGhhcyBwZXJtaXNzaW9ucyBmb3IuXG4gICAgICogQHBhcmFtIHtOdW1iZXJbXX0gW3NvZnRUcmlnZ2Vycz1bXV0gQW4gYXJyYXkgb2Ygc29mdCB0cmlnZ2VyIGlkJ3MgdGhlIGdyb3VwIGhhcyBwZXJtaXNzaW9ucyBmb3IuXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZlclxuICAgICAqL1xuICAgIEVWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zID0gZnVuY3Rpb24oY2FtZXJhcywgYXVkaW9zLCBzZXJpYWxzLCBzb2Z0VHJpZ2dlcnMpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGFycmF5IG9mIGNhbWVyYSBpZCdzIHRoZSBncm91cCBoYXMgcGVybWlzc2lvbnMgZm9yLlxuICAgICAgICAgKiBAdHlwZSBOdW1iZXJbXVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYW1lcmFzID0gW107XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGFycmF5IG9mIGF1ZGlvIGlkJ3MgdGhlIGdyb3VwIGhhcyBwZXJtaXNzaW9ucyBmb3IuXG4gICAgICAgICAqIEB0eXBlIE51bWJlcltdXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmF1ZGlvcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBhcnJheSBvZiBzZXJpYWwgaWQncyB0aGUgZ3JvdXAgaGFzIHBlcm1pc3Npb25zIGZvci5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VyaWFscyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBhcnJheSBvZiBzb2Z0IHRyaWdnZXIgaWQncyB0aGUgZ3JvdXAgaGFzIHBlcm1pc3Npb25zIGZvci5cbiAgICAgICAgICogQHR5cGUgTnVtYmVyW11cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc29mdFRyaWdnZXJzID0gW107XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihjYW1lcmFzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhcyA9IGNhbWVyYXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYXVkaW9zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuYXVkaW9zID0gYXVkaW9zO1xuICAgICAgICB9XG4gICAgICAgIGlmKHNlcmlhbHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJpYWxzID0gc2VyaWFscztcbiAgICAgICAgfVxuICAgICAgICBpZihzb2Z0VHJpZ2dlcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zb2Z0VHJpZ2dlcnMgPSBzb2Z0VHJpZ2dlcnM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgIC8qKlxuICAgICAqIFRoZSBVc2VyR3JvdXBQcmlvcml0eSByZXByZXNlbnRzIGEgc2luZ2xlIHByaW9yaXR5IGZvciBhIGdyb3VwLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlc30gW3ByaW9yaXR5PUVWV0VCMi5ncm91cFByaW9yaXR5VHlwZXMubm9uZV0gVGhlIHR5cGUgb2YgcHJpb3JpdHkuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIFRoZSB2YWx1ZSB0byBhc3NpZ24gdG8gdGhlIHByaW9yaXR5LlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlVzZXJHcm91cFByaW9yaXR5ID0gZnVuY3Rpb24ocHJpb3JpdHksIHZhbHVlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHJpb3JpdHkgdHlwZS5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcmlvcml0eSA9IEVWV0VCMi5ncm91cFByaW9yaXR5VHlwZXMubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHZhbHVlIHRvIGFzc2lnbiB0byB0aGUgcHJpb3JpdHkuXG4gICAgICAgICAqIEB0eXBlIE51bWJlclxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52YWx1ZSA9IC0xO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYocHJpb3JpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICB9XG4gICAgICAgIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgVXNlckdyb3VwIG9iamVjdCByZXByZXNlbnRzIGEgc2VydmVyIHNpZGUgZ3JvdXAgYW5kIGFsbCBvZiBpdCdzIHBlcm1pc3Npb25zLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIG5hbWUgb2YgdGhlIGdyb3VwLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmFjY2Vzc0xldmVsVHlwZX0gW2FjY2Vzc0xldmVsPUVWV0VCMi5hY2Nlc3NMZXZlbFR5cGUudW5rbm93bl0gVGhlIGFjY2VzcyBsZXZlbCBvZiB0aGUgdXNlci5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Vc2VyR3JvdXBQZXJtaXNzaW9uc30gW3Blcm1pc3Npb25zPW51bGxdIFRoZSBwZXJtaXNzaW9ucyBhc3NvY2lhdGVkIHdpdGggdGhlIGJ1aWx0LWluIGdyb3VwLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlVzZXJHcm91cFByaW9yaXR5W119IFtwcmlvcml0aWVzPVtdXSBBbiBhcnJheSBvZiB0aGUgcHJpb3JpdGllcyBhc3NpZ25lZCB0byB0aGUgZ3JvdXAuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtndWlkPScnXSBUaGUgZ3VpZCBvZiBhIGN1c3RvbSBncm91cC4gIFRoaXMgdmFsdWUgaXMgbnVsbCBmb3IgYnVpbHQtaW4gZ3JvdXBzIChpLmUuIGFjY2Vzc0xldmVsXG4gICAgICogb3RoZXIgdGhhbiB7QGxpbmsgRVZXRUIyLmFjY2Vzc0xldmVsVHlwZS5ub25lfSlcbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zfSBbY3VzdG9tR3JvdXBQZXJtaXNzaW9ucz1udWxsXSBUaGUgcGVybWlzc2lvbnMgYXNzb2NpYXRlZCB3aXRoIHRoZSBjdXN0b20gZ3JvdXAuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbaXNNYW5hZ2VkPWZhbHNlXSBXaGV0aGVyIHRoZSBncm91cCBpcyBtYW5hZ2VkIG9yIG5vdC4gSWYgdGhpcyBmbGFnIGlzIHNldCwgdGhlIGdyb3VwIGlzXG4gICAgICogbWFuYWdlZCBieSBhbiBleHRlcm5hbCB0aGlyZC1wYXJ0eSBhbmQgY2FuIG5vdCBiZSBlZGl0ZWQgYnkgdXNlcnMgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VydmVyXG4gICAgICovXG4gICAgRVZXRUIyLlVzZXJHcm91cCA9IGZ1bmN0aW9uKG5hbWUsIGFjY2Vzc0xldmVsLCBwZXJtaXNzaW9ucywgcHJpb3JpdGllcywgZ3VpZCwgY3VzdG9tR3JvdXBQZXJtaXNzaW9ucywgaXNNYW5hZ2VkKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZ3JvdXAgbmFtZS5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFjY2VzcyBsZXZlbCBvZiB0aGUgdXNlci5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLmFjY2Vzc0xldmVsVHlwZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hY2Nlc3NMZXZlbCA9IEVWV0VCMi5hY2Nlc3NMZXZlbFR5cGUudW5rbm93bjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGdyb3VwIHBlcm1pc3Npb25zLlxuICAgICAgICAgKiBAdHlwZSBFVldFQjIuVXNlckdyb3VwUGVybWlzc2lvbnNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGVybWlzc2lvbnMgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBhcnJheSBvZiB0aGUgcHJpb3JpdGllcyBhc3NpZ25lZCB0byB0aGUgZ3JvdXAuXG4gICAgICAgICAqIEB0eXBlIEVWV0VCMi5Vc2VyR3JvdXBQcmlvcml0eVtdXG4gICAgICAgICovXG4gICAgICAgIHRoaXMucHJpb3JpdGllcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZ3VpZCBvZiBhIGN1c3RvbSBncm91cC5cbiAgICAgICAgICogQHR5cGUgU3RyaW5nXG4gICAgICAgICovXG4gICAgICAgIHRoaXMuZ3VpZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcGVybWlzc2lvbnMgb2YgdGhlIGN1c3RvbSBncm91cC5cbiAgICAgICAgICogQHR5cGUgRVZXRUIyLkN1c3RvbUdyb3VwUGVybWlzc2lvbnNcbiAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jdXN0b21Hcm91cFBlcm1pc3Npb25zID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgZ3JvdXAgaXMgbWFuYWdlZCBvciBub3QuIElmIHRoaXMgZmxhZyBpcyBzZXQsIHRoZSBncm91cCBpcyBtYW5hZ2VkIGJ5IGFuXG4gICAgICAgICAqIGV4dGVybmFsIHRoaXJkLXBhcnR5IGFuZCBjYW4gbm90IGJlIGVkaXRlZCBieSB1c2VycyBvZiB0aGUgc2VydmVyLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXNNYW5hZ2VkID0gZmFsc2U7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihuYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYWNjZXNzTGV2ZWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5hY2Nlc3NMZXZlbCA9IGFjY2Vzc0xldmVsO1xuICAgICAgICB9XG4gICAgICAgIGlmKHBlcm1pc3Npb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGVybWlzc2lvbnMgPSBwZXJtaXNzaW9ucztcbiAgICAgICAgfVxuICAgICAgICBpZihwcmlvcml0aWVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdGllcyA9IHByaW9yaXRpZXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZ3VpZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmd1aWQgPSBndWlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGN1c3RvbUdyb3VwUGVybWlzc2lvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21Hcm91cFBlcm1pc3Npb25zID0gY3VzdG9tR3JvdXBQZXJtaXNzaW9ucztcbiAgICAgICAgfVxuICAgICAgICBpZihpc01hbmFnZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5pc01hbmFnZWQgPSBpc01hbmFnZWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmUgYSBzcGVjaWZpYyBwcmlvcml0eSB0eXBlXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlc30gcHJpb3JpdHlUeXBlIFRoZSB0eXBlIG9mIHByaW9yaXR5IHRvIHJldHJpdmVcbiAgICAgICAgICogQHJldHVybnMge0VWV0VCMi5Vc2VyR3JvdXBQcmlvcml0eX0gVGhlIGV4aXN0aW5nIHByaW9yaXR5IG9yIG51bGwgaWYgbm9uZSBleGlzdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldFByaW9yaXR5ID0gZnVuY3Rpb24gKHByaW9yaXR5VHlwZSl7XG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5wcmlvcml0aWVzLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmlvcml0aWVzW2ldLnByaW9yaXR5ID09PSBwcmlvcml0eVR5cGUpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wcmlvcml0aWVzW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCBhIHByaW9yaXR5IG9yIGNyZWF0ZSBpdCBpZiBpdCBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0XG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLmdyb3VwUHJpb3JpdHlUeXBlc30gcHJpb3JpdHlUeXBlIFRoZSB0eXBlIG9mIHByaW9yaXR5IHRvIHNldFxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgdGhlIHZhbHVlIHRvIGFzc2lnbiB0byB0aGUgcHJpb3JpdHlcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0UHJpb3JpdHkgPSBmdW5jdGlvbiAocHJpb3JpdHlUeXBlLCB2YWx1ZSl7XG4gICAgICAgICAgICB2YXIgZXhpc3RpbmdQcmlvcml0eSA9IHRoaXMuZ2V0UHJpb3JpdHkocHJpb3JpdHlUeXBlKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ1ByaW9yaXR5ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nUHJpb3JpdHkudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdGllcy5wdXNoKG5ldyBFVldFQjIuVXNlckdyb3VwUHJpb3JpdHkocHJpb3JpdHlUeXBlLCB2YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdHlwZXMgb2YgZXZlbnQgbW9uaXRvciBwcm9maWxlcy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBFdmVudHNcbiAgICAgKi9cbiAgICBFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZVR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogVW5rbm93blxuICAgICAgICAgKi9cbiAgICAgICAgVW5rbm93bjogLTEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWRlb1xuICAgICAgICAgKi9cbiAgICAgICAgVmlkZW86IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWV3XG4gICAgICAgICAqL1xuICAgICAgICBWaWV3OiAxXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0eXBlcyBvZiBldmVudCBtb25pdG9yIHNvdXJjZSBldmVudHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgRXZlbnRzXG4gICAgICovXG4gICAgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtTb3VyY2VUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIE5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTb2Z0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIFNvZnRUcmlnZ2VyOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGltZSBUcmlnZ2VyXG4gICAgICAgICAqL1xuICAgICAgICBUaW1lVHJpZ2dlcjogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElucHV0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIElucHV0VHJpZ2dlcjogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZpZGVvIExvc3NcbiAgICAgICAgICovXG4gICAgICAgIFZpZGVvTG9zczogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZpZGVvIE1vdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgVmlkZW9Nb3Rpb246IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNjb25uZWN0IERldmljZVxuICAgICAgICAgKi9cbiAgICAgICAgRGlzY29ubmVjdERldmljZTogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbCBQb3J0XG4gICAgICAgICAqL1xuICAgICAgICBTZXJpYWxQb3J0OiA3LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VyaWFsIFByb2ZpbGVcbiAgICAgICAgICovXG4gICAgICAgIFNlcmlhbFByb2ZpbGU6IDgsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIZWFsdGhcbiAgICAgICAgICovXG4gICAgICAgIEhlYWx0aDogOSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJ1dHRvblxuICAgICAgICAgKi9cbiAgICAgICAgQnV0dG9uOiAxMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuYWx5dGljc1xuICAgICAgICAgKi9cbiAgICAgICAgQW5hbHl0aWNzOiAxMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdyb3VwXG4gICAgICAgICAqL1xuICAgICAgICBHcm91cDogMTIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNjb25uZWN0IFZpZGVvXG4gICAgICAgICAqL1xuICAgICAgICBEaXNjb25uZWN0VmlkZW86IDEzLFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlzY29ubmVjdCBBdWRpb1xuICAgICAgICAgKi9cbiAgICAgICAgRGlzY29ubmVjdEF1ZGlvOiAxNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1dG8tY29ubmVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgQXV0b0Nvbm5lY3Rpb246IDE1LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGVmYXVsdFxuICAgICAgICAgKi9cbiAgICAgICAgRGVmYXVsdDogMTYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZWN1cml0eSBJbnRlZ3JhdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgU2VjdXJpdHlJbnRlZ3JhdGlvbjogMTcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZWN1cml0eSBJbnRlZ3JhdGlvbiBDb25uZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIFNlY3VyaXR5SW50ZWdyYXRpb25Db25uZWN0ZWQ6IDE4LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VyaWFsIFBvcnQgQ29ubmVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgU2VyaWFsUG9ydENvbm5lY3Rpb246IDE5XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0eXBlcyBvZiBldmVudCBtb25pdG9yIHRhcmdldCBldmVudHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgRXZlbnRzXG4gICAgICovXG4gICAgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXRUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIE5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWV3XG4gICAgICAgICAqL1xuICAgICAgICBWaWV3OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogU291bmRcbiAgICAgICAgICovXG4gICAgICAgIFNvdW5kOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogVG91clxuICAgICAgICAgKi9cbiAgICAgICAgVG91cjogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZpZGVvXG4gICAgICAgICAqL1xuICAgICAgICBWaWRlbzogNCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExvZ1xuICAgICAgICAgKi9cbiAgICAgICAgTG9nOiA1LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGlnaXRhbCBQVFogUHJlc2V0XG4gICAgICAgICAqL1xuICAgICAgICBEaWdpdGFsUHJlc2V0OiA2LFxuICAgICAgICAvKipcbiAgICAgICAgICogQXVkaW9cbiAgICAgICAgICovXG4gICAgICAgIEF1ZGlvOiA3XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEFuIGV2ZW50IG1vbml0b3IgbGluayBldmVudCB0aGF0IGhhcyBvY2N1cnJlZC4gIENvbnRhaW5zIHRoZSB0cmlnZ2VyZWQgZXZlbnQgbW9uaXRvciBsaW5rLCBhcyB3ZWxsIGFzXG4gICAgICogdGhlIGFzc29jaWF0ZWQgc2VydmVyIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmt9IFtldmVudExpbms9bnVsbF0gVGhlIHRyaWdnZXJlZCBldmVudCBsaW5rLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc291cmNlSWQ9JyddIFRoZSBJRCBvZiB0aGUgaXRlbSB0aGF0IHRyaWdnZXJlZCB0aGUgZXZlbnQgbGluay5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2V4dHJhSWQ9JyddIEFuIGV4dHJhIElEIHRvIGFzc29jaWF0ZSB3aXRoIHRyaWdnZXJpbmcgdGhlIGV2ZW50IGxpbmsuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IEV2ZW50c1xuICAgICAqL1xuICAgIEVWV0VCMi5FdmVudE1vbml0b3JMaW5rRXZlbnQgPSBmdW5jdGlvbihldmVudExpbmssIHNvdXJjZUlkLCBleHRyYUlkKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0cmlnZ2VyZWQgZXZlbnQgbGluay5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmVudExpbmsgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIGl0ZW0gdGhhdCB0cmlnZ2VyZWQgdGhlIGV2ZW50IGxpbmsuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNvdXJjZUlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGV4dHJhIElEIHRvIGFzc29jaWF0ZSB3aXRoIHRyaWdnZXJpbmcgdGhlIGV2ZW50IGxpbmsuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4dHJhSWQgPSAnJztcblxuICAgICAgICBpZihldmVudExpbmsgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5ldmVudExpbmsgPSBldmVudExpbms7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc291cmNlSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zb3VyY2VJZCA9IHNvdXJjZUlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4dHJhSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHRyYUlkID0gZXh0cmFJZDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgRXZlbnRNb25pdG9yTGlua1NvdXJjZSBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsIGluZm9ybWF0aW9uIGFib3V0IGFuIGV2ZW50IG1vbml0b3Igc291cmNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VydmVyPScnXSBUaGUgc2Vzc2lvbiBJRCBvZiB0aGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3Igc291cmNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbaWQ9JyddIFRoZSBJRCBvZiB0aGUgaXRlbS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlVHlwZXN9IFt0eXBlPUVWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlVHlwZXMuTm9uZV0gVGhlIHR5cGUgb2YgZXZlbnRcbiAgICAgKiBtb25pdG9yIHNvdXJjZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2V4dHJhSWQ9JyddIEFuIGV4dHJhIElEIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBldmVudCBtb25pdG9yIHNvdXJjZS4gTm90ZTogVGhpcyB2YWx1ZSBpc1xuICAgICAqIGN1cnJlbnRseSBvbmx5IHVzZWQgZm9yIGFuYWx5dGljcyBydWxlcyBJRHMgYW5kIGZvciBIZWFsdGggdHlwZXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYW55PWZhbHNlXSBXaGV0aGVyIGFueSBpdGVtIHdpbGwgdHJpZ2dlciB0aGlzIHNvdXJjZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgRXZlbnRzXG4gICAgICovXG4gICAgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtTb3VyY2UgPSBmdW5jdGlvbihzZXJ2ZXIsIGlkLCB0eXBlLCBleHRyYUlkLCBhbnkpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlc3Npb24gSUQgb2YgdGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBldmVudCBtb25pdG9yIHNvdXJjZS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgaXRlbS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgZXZlbnQgbW9uaXRvciBzb3VyY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZVR5cGVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtTb3VyY2VUeXBlcy5Ob25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBleHRyYSBJRCB0byBhc3NvY2lhdGUgd2l0aCB0aGUgZXZlbnQgbW9uaXRvciBzb3VyY2UuIE5vdGU6IFRoaXMgdmFsdWUgaXMgY3VycmVudGx5IG9ubHkgdXNlZCBmb3JcbiAgICAgICAgICogYW5hbHl0aWNzIHJ1bGVzIElEcyBhbmQgSGVhbHRoIHR5cGVzLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHRyYUlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgYW55IGl0ZW0gd2lsbCB0cmlnZ2VyIHRoaXMgc291cmNlLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYW55ID0gZmFsc2U7XG5cbiAgICAgICAgaWYoc2VydmVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGlmKGlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgfVxuICAgICAgICBpZih0eXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZXh0cmFJZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmV4dHJhSWQgPSBleHRyYUlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFueSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmFueSA9IGFueTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgRXZlbnRNb25pdG9yTGlua1RhcmdldCBvYmplY3QgYWN0cyBhcyBhIGNvbnRhaW5lciBmb3IgYWxsIGluZm9ybWF0aW9uIGFib3V0IGFuIGV2ZW50IG1vbml0b3IgdGFyZ2V0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbc2VydmVyPScnXSBUaGUgc2Vzc2lvbiBJRCBvZiB0aGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgdGFyZ2V0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbdmFsdWU9JyddIEVpdGhlciB0aGUgSUQgb3IgdGhlIG5hbWUgb2YgdGhlIGl0ZW0uICBUaGlzIGlzIGRlcGVuZGVudCBvbiB0aGVcbiAgICAgKiB7QGxpbmsgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXQudHlwZX0gb2YgdGhlIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0VHlwZXN9IFt0eXBlPUVWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0VHlwZXMuTm9uZV0gVGhlIHR5cGUgb2YgZXZlbnRcbiAgICAgKiBtb25pdG9yIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2V4dHJhSWQ9JyddIEFuIGV4dHJhIElEIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBldmVudCBtb25pdG9yIHRhcmdldC4gTm90ZTogVGhpcyB2YWx1ZSBpc1xuICAgICAqIGN1cnJlbnRseSBvbmx5IHVzZWQgZm9yIHNlbGVjdGluZyBhIGRpZ2l0YWwgcHJlc2V0IElELlxuICAgICAqIEBwYXJhbSB7c3RyaW5nW119IFtmb2xkZXJzPVtdXSBBbiBhcnJheSBvZiB0aGUgZm9sZGVycyBmb3IgdGhlIHZhbHVlLiAgTm90ZTogVGhpcyB2YWx1ZSBpcyB1c2VkIGZvciB0eXBlc1xuICAgICAqIHRoYXQgZG8gbm8gaGF2ZSBJRHMsIHN1Y2ggYXMgdmlld3MuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IEV2ZW50c1xuICAgICAqL1xuICAgIEVWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0ID0gZnVuY3Rpb24oc2VydmVyLCB2YWx1ZSwgdHlwZSwgZXh0cmFJZCwgZm9sZGVycykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2Vzc2lvbiBJRCBvZiB0aGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgdGFyZ2V0LlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogRWl0aGVyIHRoZSBJRCBvciB0aGUgbmFtZSBvZiB0aGUgaXRlbS4gIFRoaXMgaXMgZGVwZW5kZW4ge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0LnR5cGV9IG9mXG4gICAgICAgICAqIHRoZSB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZhbHVlID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIGV2ZW50IG1vbml0b3IgdGFyZ2V0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXRUeXBlc31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0VHlwZXMuTm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gZXh0cmEgSUQgdG8gYXNzb2NpYXRlIHdpdGggdGhlIGV2ZW50IG1vbml0b3IgdGFyZ2V0LiBOb3RlOiBUaGlzIHZhbHVlIGlzIGN1cnJlbnRseSBvbmx5IHVzZWQgZm9yXG4gICAgICAgICAqIHNlbGVjdGluZyBhIGRpZ2l0YWwgcHJlc2V0IElELlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5leHRyYUlkID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGFycmF5IG9mIHRoZSBmb2xkZXJzIGZvciB0aGUgdmFsdWUuICBOb3RlOiBUaGlzIHZhbHVlIGlzIHVzZWQgZm9yIHR5cGVzIHRoYXQgZG8gbm8gaGF2ZSBJRHMsIHN1Y2ggYXNcbiAgICAgICAgICogdmlld3MuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmdbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZm9sZGVycyA9IFtdO1xuXG4gICAgICAgIGlmKHNlcnZlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcbiAgICAgICAgfVxuICAgICAgICBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4dHJhSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHRyYUlkID0gZXh0cmFJZDtcbiAgICAgICAgfVxuICAgICAgICBpZihmb2xkZXJzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9sZGVycyA9IGZvbGRlcnM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIEV2ZW50TW9uaXRvckxpbmsgb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhbiBpbmRpdmlkdWFsIGV2ZW50IG1vbml0b3IuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZX0gW3NlcnZpY2U9bnVsbF0gVGhlIHNlcnZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZXZlbnQgbW9uaXRvciBsaW5rLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGV9IFtwcm9maWxlPW51bGxdIFRoZSBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2d1aWQ9JyddIFRoZSBHVUlEIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlfSBbc291cmNlPW51bGxdIFRoZSBzb3VyY2Ugb2YgdGhlIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rVGFyZ2V0fSBbdGFyZ2V0PW51bGxdIFRoZSB0YXJnZXQgb2YgdGhlIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3ByaW9yaXR5PTFdIFRoZSBwcmlvcml0eSBvZiB0aGUgZXZlbnQgbW9uaXRvciBsaW5rLCBpbiBhIHNjYWxlIGJldHdlZW4gMS0xMC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtjb25maXJtPWZhbHNlXSBXaGV0aGVyIHRoZSB1c2VyIGlzIHJlcXVpcmVkIHRvIG1hbnVhbGx5IGNsZWFyIHRoZSBldmVudCAoZS5nLiB0aGUgZXZlbnQgZG9lc1xuICAgICAqIG5vdCB0aW1lb3V0LCBpbmRlcGVuZGVudCBvZiB0aGUgdmFsdWUgb2YgdGhlIHRpbWVvdXQgcGFyYW1ldGVyKS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3RpbWVvdXQ9MF0gVGhlIHRpbWVvdXQgZHVyYXRpb24gb2YgdGhlIGV2ZW50LCBpbiBzZWNvbmRzLiAgVmFsaWQgdmFsdWVzIGFyZSAwLTYwLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbWVzc2FnZT0nJ10gVGhlIG1lc3NhZ2UgdG8gZGlzcGxheSBmb3IgdGhpcyBldmVudCBtb25pdG9yIGxpbmsuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IEV2ZW50c1xuICAgICAqL1xuICAgIEVWV0VCMi5FdmVudE1vbml0b3JMaW5rID0gZnVuY3Rpb24oc2VydmljZSwgcHJvZmlsZSwgZ3VpZCwgc291cmNlLCB0YXJnZXQsIHByaW9yaXR5LCBjb25maXJtLCB0aW1lb3V0LCBtZXNzYWdlKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcblxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHJvZmlsZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBldmVudCBtb25pdG9yIGxpbmsuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJvZmlsZSA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBHVUlEIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3VpZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc291cmNlIG9mIHRoZSBldmVudCBtb25pdG9yIGxpbmsuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRhcmdldCBvZiB0aGUgZXZlbnQgbW9uaXRvciBsaW5rLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXR9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRhcmdldCA9IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwcmlvcml0eSBvZiB0aGUgZXZlbnQgbW9uaXRvciBsaW5rLCBpbiBhIHNjYWxlIGJldHdlZW4gMS0xMC5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJpb3JpdHkgPSAxO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSB1c2VyIGlzIHJlcXVpcmVkIHRvIG1hbnVhbGx5IGNsZWFyIHRoZSBldmVudCAoZS5nLiB0aGUgZXZlbnQgZG9lcyBub3QgdGltZW91dCwgaW5kZXBlbmRlbnQgb2ZcbiAgICAgICAgICogdGhlIHZhbHVlIG9mIHRoZSB0aW1lb3V0IHBhcmFtZXRlcikuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jb25maXJtID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0aW1lb3V0IGR1cmF0aW9uIG9mIHRoZSBldmVudCwgaW4gc2Vjb25kcy4gIFZhbGlkIHZhbHVlcyBhcmUgMC02MC5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGltZW91dCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtZXNzYWdlIHRvIGRpc3BsYXkgZm9yIHRoaXMgZXZlbnQgbW9uaXRvciBsaW5rLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tZXNzYWdlID0gJyc7XG5cbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHByb2ZpbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcbiAgICAgICAgfVxuICAgICAgICBpZihndWlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZ3VpZCA9IGd1aWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc291cmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRhcmdldCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICAgICAgfVxuICAgICAgICBpZihwcmlvcml0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoY29uZmlybSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvbmZpcm0gPSBjb25maXJtO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRpbWVvdXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gdGltZW91dDtcbiAgICAgICAgfVxuICAgICAgICBpZihtZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlcyB0aGUgdmFsdWVzIG9mIHRoaXMgZXZlbnQgbW9uaXRvciBsaW5rIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYXBwbHlVcGRhdGUgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIHBhcmFtZXRlcnNcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgZ3VpZDogdGhpcy5ndWlkLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiB0aGlzLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGNvbmZpcm06IHRoaXMuY29uZmlybSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0OiB0aGlzLnRpbWVvdXQsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5tZXNzYWdlXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYodGhpcy5zb3VyY2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VJZCA9IHRoaXMuc291cmNlLmlkO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZVNlcnZlciA9IHRoaXMuc291cmNlLnNlcnZlcjtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VUeXBlID0gdGhpcy5zb3VyY2UudHlwZTtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VFeHRyYSA9IHRoaXMuc291cmNlLmV4dHJhSWQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlQW55ID0gdGhpcy5zb3VyY2UuYW55O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlU2VydmVyID0gdGhpcy50YXJnZXQuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZVR5cGUgPSBFVldFQjIuRXZlbnRNb25pdG9yTGlua1NvdXJjZVR5cGVzLk5vbmU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLnRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldElkID0gdGhpcy50YXJnZXQudmFsdWU7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0U2VydmVyID0gdGhpcy50YXJnZXQuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFR5cGUgPSB0aGlzLnRhcmdldC50eXBlO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldEV4dHJhID0gdGhpcy50YXJnZXQuZXh0cmFJZDtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRUYXJnZXRGb2xkZXJOYW1lID0gdGhpcy50YXJnZXQuZm9sZGVycztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFNlcnZlciA9IHRoaXMuc291cmNlLnNlcnZlcjtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRUYXJnZXRUeXBlID0gRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtUYXJnZXRUeXBlcy5Ob25lO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZXZlbnRNb25pdG9yaW5nICsgJy8nICsgdGhpcy5wcm9maWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIEV2ZW50TW9uaXRvclByb2ZpbGUgb2JqZWN0IGFjdHMgYXMgYSBjb250YWluZXIgZm9yIGFsbCBpbmZvcm1hdGlvbiBhYm91dCBhbiBldmVudCBtb25pdG9yaW5nIHByb2ZpbGUuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmljZX0gW3NlcnZpY2U9bnVsbF0gVGhlIHNlcnZpY2UgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZXZlbnQgbW9uaXRvciBsaW5rLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbmFtZT0nJ10gVGhlIG5hbWUgb2YgdGhpcyBwcm9maWxlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGVUeXBlc30gW3R5cGU9RVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGVUeXBlcy51bmtub3duXSBUaGUgdHlwZSBvZiB0aGlzIHByb2ZpbGUuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkZXNjcmlwdGlvbj0nJ10gVGhlIGRlc2NyaXB0aW9uIG9mIHRoaXMgcHJvZmlsZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzaG93RXZlbnRzTGlzdD1mYWxzZV0gV2hldGhlciB0byBzaG93IHRoZSBldmVudHMgbGlzdCBvbiB0cmlnZ2VyaW5nIG9mIGEgbGluay5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzaG93TmV3ZXN0PWZhbHNlXSBXaGV0aGVyIHRvIHNob3cgdGhlIG5ld2VzdCBldmVudHMuXG4gICAgICogQHBhcmFtIHtFVldFQjIuRXZlbnRNb25pdG9yTGlua1tdfSBbZXZlbnRzPVtdXSBUaGUgZXZlbnQgbW9uaXRvcmluZyBsaW5rcyBhc3NvY2lhdGVkIHdpdGggdGhpcyBwcm9maWxlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBFdmVudHNcbiAgICAgKi9cbiAgICBFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZSA9IGZ1bmN0aW9uKHNlcnZpY2UsIG5hbWUsIHR5cGUsIGRlc2NyaXB0aW9uLCBzaG93RXZlbnRzTGlzdCwgc2hvd05ld2VzdCwgZXZlbnRzKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG5hbWUgb2YgdGhpcyBwcm9maWxlLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHRoaXMgcHJvZmlsZVxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGVUeXBlc31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IEVWV0VCMi5FdmVudE1vbml0b3JQcm9maWxlVHlwZXMudW5rbm93bjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGRlc2NyaXB0aW9uIG9mIHRoaXMgcHJvZmlsZS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0byBzaG93IHRoZSBldmVudHMgbGlzdCBvbiB0cmlnZ2VyaW5nIG9mIGEgbGluay5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3dFdmVudHNMaXN0ID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdG8gc2hvdyB0aGUgbmV3ZXN0IGV2ZW50cy5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3dOZXdlc3QgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV2ZW50IG1vbml0b3JpbmcgbGlua3MgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcHJvZmlsZS5cbiAgICAgICAgICogQHR5cGUge0FycmF5fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmVudHMgPSBbXTtcblxuICAgICAgICBpZihzZXJ2aWNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYobmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZihkZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2hvd0V2ZW50c0xpc3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zaG93RXZlbnRzTGlzdCA9IHNob3dFdmVudHNMaXN0O1xuICAgICAgICB9XG4gICAgICAgIGlmKHNob3dOZXdlc3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zaG93TmV3ZXN0ID0gc2hvd05ld2VzdDtcbiAgICAgICAgfVxuICAgICAgICBpZihldmVudHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5ldmVudHMgPSBldmVudHM7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogR2VuZXJhdGVzIGFuIGFycmF5IG9mIGFsbCBhc3NvY2lhdGVkIHNlc3Npb24gSURzIGJ5IGNoZWNraW5nIHRoZSBzb3VyY2UgYW5kIHRhcmdldCBvZiBlYWNoIGV2ZW50IGxpbmsuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmtbXX0gbGlua3MgVGhlIGxpc3Qgb2YgbGlua3MgdG8gdXNlIHRvIGdlbmVyYXRlIHRoZSBzZXNzaW9uIElEcy5cbiAgICAgICAgICogQHJldHVybnMge3N0cmluZ1tdfSBBcnJheSBvZiBzZXNzaW9uIElEcy5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZW5lcmF0ZVNlc3Npb25JZExpc3QgPSBmdW5jdGlvbihsaW5rcykge1xuICAgICAgICAgICAgdmFyIHNlc3Npb25JZHMgPSBbXTtcbiAgICAgICAgICAgICQuZWFjaChsaW5rcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZihlbGVtZW50LnNvdXJjZSAhPT0gbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgZWxlbWVudC5zb3VyY2UudHlwZSAhPT0gRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtTb3VyY2VUeXBlcy5Ob25lXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiAkLmluQXJyYXkoZWxlbWVudC5zb3VyY2Uuc2VydmVyLCBzZXNzaW9uSWRzKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbklkcy5wdXNoKGVsZW1lbnQuc291cmNlLnNlcnZlcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQudGFyZ2V0ICE9PSBudWxsXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBlbGVtZW50LnRhcmdldC50eXBlICE9PSBFVldFQjIuRXZlbnRNb25pdG9yTGlua1RhcmdldFR5cGVzLk5vbmVcbiAgICAgICAgICAgICAgICAgICAgICAgICYmICQuaW5BcnJheShlbGVtZW50LnRhcmdldC5zZXJ2ZXIsIHNlc3Npb25JZHMpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWRzLnB1c2goZWxlbWVudC50YXJnZXQuc2VydmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25JZHM7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrcyBmb3Igd2hldGhlciBhbnkgZXZlbnQgbGlua3MgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcHJvZmlsZSBoYXZlIGJlZW4gdHJpZ2dlcmVkLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIGFuIGFycmF5IG9mIHtAbGluayBFVldFQjIuRXZlbnRNb25pdG9yTGlua0V2ZW50fSBpbnN0YW5jZXNcbiAgICAgICAgICogZGVzY3JpYmluZyB0aGUgdHJpZ2dlcmVkIGV2ZW50IGxpbmtzIHRoYXQgaGF2ZSBiZWVuIHRyaWdnZXJlZCBzaW5jZSB0aGUgbGFzdCByZXF1ZXN0LlxuICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gW2R1cmF0aW9uPTNdIFRoZSBkdXJhdGlvbiBpbiB0aGUgcGFzdCwgaW4gc2Vjb25kcywgdG8gcmV0cmlldmUgZXZlbnRzLiBUcmlnZ2VyZWQgZXZlbnRzIGFyZVxuICAgICAgICAgKiBub3Qgc3RvcmVkIGZvciBtb3JlIHRoYW4gMSBtaW51dGUsIHNvIHZhbHVlcyBncmVhdGVyIHRoYW4gNjAgYXJlIGlnbm9yZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoZWNrRXZlbnRMaW5rcyA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBkdXJhdGlvbikge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgbGlua3MgPSAkLm1hcChkYXRhLnRyaWdnZXJlZEV2ZW50cywgZnVuY3Rpb24odHJpZ2dlcmVkRXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2ZW50TGluayA9ICQuZ3JlcChpbnN0YW5jZS5ldmVudHMsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQuZ3VpZCA9PT0gdHJpZ2dlcmVkRXZlbnQuZ3VpZDtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkV2ZW50TW9uaXRvckxpbmtFdmVudChldmVudExpbmssIHRyaWdnZXJlZEV2ZW50LmlkLCB0cmlnZ2VyZWRFdmVudC5leHRyYUlkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2Vzcyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UsIGxpbmtzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGR1cmF0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IGdlbmVyYXRlU2Vzc2lvbklkTGlzdCh0aGlzLmV2ZW50cyksXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IGR1cmF0aW9uXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZXZlbnRNb25pdG9yaW5nICsgJy8nICsgdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZXMgYW4gZXZlbnQgbW9uaXRvciBwcm9maWxlLiAgTm90ZToge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JQcm9maWxlLmV2ZW50c30gaXMgbm90IG1vZGlmaWVkIGJ5XG4gICAgICAgICAqIHRoaXMgbWV0aG9kLiAgVG8gbW9kaWZ5IHRoZSBldmVudCBtb25pdG9yIGxpbmtzLCBzZWUgdGhlIHtAbGluayBFVldFQjIuRXZlbnRNb25pdG9yTGluay51cGRhdGV9LFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGUuYWRkTGlua30sIGFuZCB7QGxpbmsgRVZXRUIyLkV2ZW50TW9uaXRvclByb2ZpbGUucmVtb3ZlTGlua30uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXBkYXRlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGhpcy5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICAgICAgICAgICAgc2hvd0V2ZW50c0xpc3Q6IHRoaXMuc2hvd0V2ZW50c0xpc3QsXG4gICAgICAgICAgICAgICAgc2hvd05ld2VzdEV2ZW50OiB0aGlzLnNob3dOZXdlc3QsXG4gICAgICAgICAgICAgICAgczogZ2VuZXJhdGVTZXNzaW9uSWRMaXN0KHRoaXMuZXZlbnRzKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmV2ZW50TW9uaXRvcmluZyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZGRzIGFuIGV2ZW50IG1vbml0b3IgbGluay5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrIGlzIHBhc3NlZCBhXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCBhIGNvcHkgb2YgdGhlIHVwZGF0ZWQge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JMaW5rfVxuICAgICAgICAgKiBpbnN0YW5jZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuRXZlbnRNb25pdG9yTGlua30gbGluayBUaGUgZXZlbnQgbW9uaXRvciBsaW5rIHRvIGFkZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWRkTGluayA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBsaW5rKSB7XG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlTGluayA9IGRhdGEuZXZlbnQ7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IHVwZGF0ZUxpbmsuc291cmNlO1xuICAgICAgICAgICAgICAgIGxpbmsuc291cmNlID0gbmV3IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlKCk7XG4gICAgICAgICAgICAgICAgaWYoc291cmNlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmsuc291cmNlID0gbmV3IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlKHNvdXJjZS5zZXJ2ZXIsIHNvdXJjZS5pZCwgc291cmNlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2UuZXh0cmEsIHNvdXJjZS5hbnkpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSB1cGRhdGVMaW5rLnRhcmdldDtcbiAgICAgICAgICAgICAgICBsaW5rLnRhcmdldCA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yTGlua1RhcmdldCgpO1xuICAgICAgICAgICAgICAgIGlmKHRhcmdldCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBsaW5rLnRhcmdldCA9IG5ldyBFVldFQjIuRXZlbnRNb25pdG9yTGlua1RhcmdldCh0YXJnZXQuc2VydmVyLCB0YXJnZXQudmFsdWUsIHRhcmdldC50eXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmV4dHJhLCB0YXJnZXQuZm9sZGVycyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGluay5ndWlkID0gdXBkYXRlTGluay5ndWlkO1xuICAgICAgICAgICAgICAgIGxpbmsucHJpb3JpdHkgPSB1cGRhdGVMaW5rLnByaW9yaXR5O1xuICAgICAgICAgICAgICAgIGxpbmsuY29uZmlybSA9IHVwZGF0ZUxpbmsuY29uZmlybTtcbiAgICAgICAgICAgICAgICBsaW5rLnRpbWVvdXQgPSB1cGRhdGVMaW5rLnRpbWVvdXQ7XG4gICAgICAgICAgICAgICAgbGluay5tZXNzYWdlID0gdXBkYXRlTGluay5tZXNzYWdlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLCBsaW5rKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIGV2ZW50Q29uZmlybTogbGluay5jb25maXJtLFxuICAgICAgICAgICAgICAgIGV2ZW50TWVzc2FnZTogbGluay5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIGV2ZW50VGltZW91dDogbGluay50aW1lb3V0LFxuICAgICAgICAgICAgICAgIGV2ZW50UHJpb3JpdHk6IGxpbmsucHJpb3JpdHlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZihsaW5rLnNvdXJjZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZUlkID0gbGluay5zb3VyY2UuaWQ7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlU2VydmVyID0gbGluay5zb3VyY2Uuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZVR5cGUgPSBsaW5rLnNvdXJjZS50eXBlO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFNvdXJjZUV4dHJhID0gbGluay5zb3VyY2UuZXh0cmFJZDtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VBbnkgPSBsaW5rLnNvdXJjZS5hbnk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRTb3VyY2VTZXJ2ZXIgPSBsaW5rLnRhcmdldC5zZXJ2ZXI7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50U291cmNlVHlwZSA9IEVWV0VCMi5FdmVudE1vbml0b3JMaW5rU291cmNlVHlwZXMuTm9uZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGxpbmsudGFyZ2V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0VmFsdWUgPSBsaW5rLnRhcmdldC52YWx1ZTtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZXZlbnRUYXJnZXRTZXJ2ZXIgPSBsaW5rLnRhcmdldC5zZXJ2ZXI7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0VHlwZSA9IGxpbmsudGFyZ2V0LnR5cGU7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0RXh0cmEgPSBsaW5rLnRhcmdldC5leHRyYUlkO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldEZvbGRlcnMgPSBsaW5rLnRhcmdldC5mb2xkZXJzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmV2ZW50VGFyZ2V0U2VydmVyID0gbGluay5zb3VyY2Uuc2VydmVyO1xuICAgICAgICAgICAgICAgIHBhcmFtcy5ldmVudFRhcmdldFR5cGUgPSBFVldFQjIuRXZlbnRNb25pdG9yTGlua1RhcmdldFR5cGVzLk5vbmU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZXZlbnRNb25pdG9yaW5nICsgJy8nICsgdGhpcy5uYW1lLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoc2V0dGluZ3MsIHRoaXMuc2VydmljZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZXMgYW4gZXZlbnQgbW9uaXRvciBsaW5rLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmt9IGxpbmsgVGhlIGV2ZW50IG1vbml0b3IgbGluayB0byByZW1vdmUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlbW92ZUxpbmsgPSBmdW5jdGlvbihjYWxsYmFjaywgbGluaykge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgLy8gUG9wdWxhdGUgdGhlIHBhcmFtZXRlcnNcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogZ2VuZXJhdGVTZXNzaW9uSWRMaXN0KFtsaW5rXSksXG4gICAgICAgICAgICAgICAgZ3VpZDogbGluay5ndWlkXG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ldmVudE1vbml0b3JpbmcgKyAnLycgKyB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlcyB0aGlzIGV2ZW50IG1vbml0b3IgcHJvZmlsZSBvbiB0aGUgYXNzb2NpYXRlZCBzZXJ2ZXJzLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRlbGV0ZVByb2ZpbGUgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBwYXJhbWV0ZXJzXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IGdlbmVyYXRlU2Vzc2lvbklkTGlzdCh0aGlzLmV2ZW50cyksXG4gICAgICAgICAgICAgICAgbmFtZTogdGhpcy5uYW1lXG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWUsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ldmVudE1vbml0b3JpbmcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVnaXN0ZXJzIGEgcHVzaCBub3RpZmljYXRpb24gY2xpZW50IHRvIHJlY2VpdmUgbm90aWZpY2F0aW9ucyBmb3IgZXZlbnRzIG9uIHRoaXMgcHJvZmlsZS4gIE9uY2VcbiAgICAgICAgICogc3Vic2NyaWJlZCwgcHVzaCBub3RpZmljYXRpb25zIHdpbGwgYmUgc2VudCB0byB0aGUgY2xpZW50IHVudGlsIHRoZSBjbGllbnQgdW5zdWJzY3JpYmVzIHVzaW5nXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuRXZlbnRNb25pdG9yUHJvZmlsZS5wdXNoTm90aWZpY2F0aW9uVW5zdWJzY3JpYmV9IG9yIHVudGlsIHRoZSBjbGllbnQgaXMgdW5yZWdpc3RlcmVkXG4gICAgICAgICAqIHVzaW5nIHtAbGluayBFVldFQjIuUHVzaE5vdGlmaWNhdGlvbi51bnJlZ2lzdGVyQ2xpZW50fS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2xpZW50SWQgVGhlIGNsaWVudCBJRCB0byB1cGRhdGUuICBUaGlzIHZhbHVlIHdhcyBnZW5lcmF0ZWQgaW4gYSBwcmV2aW91cyBjYWxsXG4gICAgICAgICAqIHRvIHtARVZXRUIyLlB1c2hOb3RpZmljYXRpb24ucmVnaXN0ZXJDbGllbnR9LlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudE1vbml0b3JMaW5rfSBsaW5rIFRoZSBsaW5rIHRvIHJlY2VpdmUgbm90aWZpY2F0aW9ucyBvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHVzaE5vdGlmaWNhdGlvblN1YnNjcmliZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjbGllbnRJZCwgbGluaykge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGNsaWVudElkLFxuICAgICAgICAgICAgICAgIHByb2ZpbGU6IHRoaXMubmFtZSxcbiAgICAgICAgICAgICAgICBndWlkOiBsaW5rLmd1aWRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ldmVudE1vbml0b3JpbmdQdXNoLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbnJlZ2lzdGVycyBhIHB1c2ggbm90aWZpY2F0aW9uIGNsaWVudCB0byByZWNlaXZlIG5vdGlmaWNhdGlvbnMgZm9yIGV2ZW50cyBvbiB0aGlzIHByb2ZpbGUuICBPbmNlXG4gICAgICAgICAqIHVuc3Vic2NyaWJlZCwgcHVzaCBub3RpZmljYXRpb25zIHdpbGwgbm8gbG9uZ2VyIGJlIHNlbnQgdG8gdGhlIGNsaWVudCB1bnRpbCB0aGUgY2xpZW50IHJlLXN1YnNjcmliZXMgdXNpbmdcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5FdmVudE1vbml0b3JQcm9maWxlLnB1c2hOb3RpZmljYXRpb25TdWJzY3JpYmV9LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBUaGUgY2xpZW50IElEIHRvIHVwZGF0ZS4gIFRoaXMgdmFsdWUgd2FzIGdlbmVyYXRlZCBpbiBhIHByZXZpb3VzIGNhbGxcbiAgICAgICAgICogdG8ge0BFVldFQjIuUHVzaE5vdGlmaWNhdGlvbi5yZWdpc3RlckNsaWVudH0uXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TW9uaXRvckxpbmt9IGxpbmsgVGhlIGxpbmsgdG8gcmVjZWl2ZSBub3RpZmljYXRpb25zIG9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wdXNoTm90aWZpY2F0aW9uVW5zdWJzY3JpYmUgPSBmdW5jdGlvbihjYWxsYmFjaywgY2xpZW50SWQsIGxpbmspIHtcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIGlkOiBjbGllbnRJZCxcbiAgICAgICAgICAgICAgICBwcm9maWxlOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICAgICAgZ3VpZDogbGluay5ndWlkXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuZXZlbnRNb25pdG9yaW5nUHVzaCxcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBwdXNoIG5vdGlmaWNhdGlvbiBjbGllbnRzLiAgVGhlc2UgdmFsdWVzIGNvcnJlc3BvbmQgdG8gdGhlIGRpZmZlcmVudFxuICAgICAqIHB1c2ggbm90aWZpY2F0aW9uIG5ldHdvcmtzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuUHVzaE5vdGlmaWNhdGlvbkNsaWVudFR5cGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcHBsZSBQdXNoIE5vdGlmaWNhdGlvbiBTZXJ2aWNlXG4gICAgICAgICAqL1xuICAgICAgICBBUE5TOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogR29vZ2xlIENsb3VkIE1lc3NhZ2luZ1xuICAgICAgICAgKi9cbiAgICAgICAgR0NNOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTWljcm9zb2Z0IFB1c2ggTm90aWZpY2F0aW9uIFNlcnZpY2VcbiAgICAgICAgICovXG4gICAgICAgIE1QTlM6IDJcbiAgICAgICAgLy9BRE06IDNcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQmFzZSBjb250YWluZXIgZm9yIFB1c2ggTm90aWZpY2F0aW9uIGFjdGlvbnMgZm9yIG1vYmlsZSBjbGllbnRzLiAgVGhpcyBjbGFzcyBleHBvc2VzXG4gICAgICogdGhlIGRpZmZlcmVudCBtZXRob2RzIHJlcXVpcmVkIHRvIGNvbmZpZ3VyZSBhIG1vYmlsZSBjbGllbnQgdG8gcmVjZWl2ZSBwdXNoXG4gICAgICogbm90aWZpY2F0aW9ucyBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAgICogTm90ZTogRG8gbm90IGluc3RhbnRpYXRlIHRoaXMgY2xhc3MgZGlyZWN0bHkuICBUaGlzIGZ1bmN0aW9uYWxpdHkgaXMgZXhwb3NlZCB0aHJvdWdoXG4gICAgICoge0BsaW5rIEVWV0VCMi5TZXJ2aWNlLnB1c2hOb3RpZmljYXRpb259IGFuZCBzaG91bGQgYmUgdXNlZCB0aGVyZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBBIHJlZmVyZW5jZSB0byB0aGUgcGFyZW50IHNlcnZpY2UgaW5zdGFuY2UuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuUHVzaE5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uKHNlcnZpY2UpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQSByZWZlcmVuY2UgdG8gdGhlIHBhcmVudCBzZXJ2aWNlIGluc3RhbmNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2V9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuXG5cbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyB0aGUgUlNBIFBLQ1MxLU9BRVAgcHVibGljIGtleSBmb3IgZW5jcnlwdGluZyBjbGllbnQgdG9rZW5zIHNlbnQgdG8gdGhlIHdlYlxuICAgICAgICAgKiBzZXJ2aWNlLiBOb3RlOiBUaGlzIGVuY3J5cHRpb24gb25seSBuZWNlc3Nhcnkgd2hlbiBzZW5kaW5nIE1QTlMgKFdpbmRvd3MgUGhvbmUgOClcbiAgICAgICAgICogdG9rZW5zIG92ZXIgdW5lbmNyeXB0ZWQgcHJvdG9jb2xzIGFuZCBpcyBub3QgcmVjb21tZW5kZWQgdG8gYmUgdXNlZCBpbiBhbnkgb3RoZXJcbiAgICAgICAgICogc2l0dWF0aW9ucy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuU2VydmVyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYSBzdHJpbmcgb2ZcbiAgICAgICAgICogdGhlIGVuY3J5cHRpb24ga2V5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRQdWJsaWNLZXkgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZGF0YS5zdWNjZXNzLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSwgZGF0YS5rZXkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnB1c2hOb3RpZmljYXRpb25cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZWdpc3RlcnMgYSBjbGllbnQgdG8gcmVjZWl2ZSBwdXNoIG5vdGlmaWNhdGlvbnMuICBFYWNoIGNsaWVudCBtdXN0IHVzZSB0aGlzIGNhbGwgdG8gcmVnaXN0ZXJcbiAgICAgICAgICogYXMgYSBjbGllbnQgYXQgbGVhc3Qgb25jZSBhbmQgdXNlIHRoZSByZXNwb25zZSBjbGllbnQgSUQgdG8gcmVnaXN0ZXIgZm9yIHJlY2VpdmluZyBpbmRpdmlkdWFsXG4gICAgICAgICAqIHB1c2ggbm90aWZpY2F0aW9ucy5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuXG4gICAgICAgICAqIENhbGxiYWNrIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuU2VydmVyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgdGhlIGdlbmVyYXRlZCBjbGllbnRcbiAgICAgICAgICogSUQgdXNlZCBpbiBzdWJzZXF1ZW50IHB1c2ggbm90aWZpY2F0aW9uIGZ1bmN0aW9ucy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuUHVzaE5vdGlmaWNhdGlvbkNsaWVudFR5cGV9IHR5cGUgVGhlIHR5cGUgb2YgY2xpZW50IGJlaW5nIHJlZ2lzdGVyZWQuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSB0b2tlbiBUaGUgcmVnaXN0cmF0aW9uIHRva2VuIG9mIHRoZSBjbGllbnQuICBUaGUgZm9ybWF0IG9mIGVhY2ggZGVwZW5kcyBvbiB0aGVcbiAgICAgICAgICogZGV2aWNlIHR5cGUuICBSZWZlcmVuY2UgdGhlIHZlbmRvciBkb2N1bWVudGF0aW9uIGZvciB0aGUgcHVzaCBub3RpZmljYXRpb24gbmV0d29yayBvbiBnZW5lcmF0aW5nXG4gICAgICAgICAqIHRoaXMgdmFsdWUuXG4gICAgICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gW2VuY3J5cHRlZD1mYWxzZV0gV2hldGhlciB0aGUgcHJvdmlkZWQgdG9rZW4gaXMgZW5jcnlwdGVkIHVzaW5nIFJTQSBQS0NTMS1PQUVQIGVuY3lycHRpb24uXG4gICAgICAgICAqIE5vdGU6IFRoaXMgaXMgb25seSBuZWNlc3Nhcnkgd2hlbiBzZW5kaW5nIE1QTlMgKFdpbmRvd3MgUGhvbmUgOCkgdG9rZW5zIG92ZXIgdW5lbmNyeXB0ZWQgcHJvdG9jb2xzIGFuZCBpc1xuICAgICAgICAgKiBub3QgcmVjb21tZW5kZWQgdG8gYmUgdXNlZCBpbiBhbnkgb3RoZXIgc2l0dWF0aW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVnaXN0ZXJDbGllbnQgPSBmdW5jdGlvbihjYWxsYmFjaywgdHlwZSwgdG9rZW4sIGVuY3J5cHRlZCkge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZGF0YS5zdWNjZXNzLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZXNwb25zZSwgZGF0YS5pZCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgICAgICAgdG9rZW46IHRva2VuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYoZW5jcnlwdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMuZW5jcnlwdGVkID0gZW5jcnlwdGVkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMucHVzaE5vdGlmaWNhdGlvbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlcyBhbiBleGlzdGluZyBjbGllbnQgSUQgd2l0aCBhIG5ldyB0b2tlbi4gIFNpbWlsYXIgdG8gcmVnaXN0ZXJpbmcgYSBkZXZpY2UsIHNvbWUgcHVzaFxuICAgICAgICAgKiBub3RpZmljYXRpb24gbmV0d29ya3MgcHJvdmlkZSBuZXcgdG9rZW5zIGFmdGVyIGFuIGVycm9yLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5TZXJ2ZXIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIGFuZCB0aGUgZ2VuZXJhdGVkIGNsaWVudFxuICAgICAgICAgKiBJRCB1c2VkIGluIHN1YnNlcXVlbnQgcHVzaCBub3RpZmljYXRpb24gZnVuY3Rpb25zLiAgTm90ZTogVGhlIGNsaWVudCBJRCB3aWxsIGJlIHRoZSBzYW1lIGFzXG4gICAgICAgICAqIHBhc3NlZCBpbiBhcyBhIHBhcmFtZXRlciwgaXQgaXMgcHJvdmlkZWQgaGVyZSBmb3IgY29udmVuaWVuY2UuXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBUaGUgY2xpZW50IElEIHRvIHVwZGF0ZS4gIFRoaXMgdmFsdWUgd2FzIGdlbmVyYXRlZCBpbiBhIHByZXZpb3VzIGNhbGxcbiAgICAgICAgICogdG8ge0BFVldFQjIuUHVzaE5vdGlmaWNhdGlvbi5yZWdpc3RlckNsaWVudH0uXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdUb2tlbiBUaGUgbmV3IHJlZ2lzdHJhdGlvbiB0b2tlbiBvZiB0aGUgY2xpZW50LiAgVGhlIGZvcm1hdCBvZiBlYWNoIGRlcGVuZHMgb24gdGhlXG4gICAgICAgICAqIGRldmljZSB0eXBlLiAgUmVmZXJlbmNlIHRoZSB2ZW5kb3IgZG9jdW1lbnRhdGlvbiBmb3IgdGhlIHB1c2ggbm90aWZpY2F0aW9uIG5ldHdvcmsgb24gZ2VuZXJhdGluZ1xuICAgICAgICAgKiB0aGlzIHZhbHVlLlxuICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtlbmNyeXB0ZWQ9ZmFsc2VdIFdoZXRoZXIgdGhlIHByb3ZpZGVkIHRva2VuIGlzIGVuY3J5cHRlZCB1c2luZyBSU0EgUEtDUzEtT0FFUCBlbmN5cnB0aW9uLlxuICAgICAgICAgKiBOb3RlOiBUaGlzIGlzIG9ubHkgbmVjZXNzYXJ5IHdoZW4gc2VuZGluZyBNUE5TIChXaW5kb3dzIFBob25lIDgpIHRva2VucyBvdmVyIHVuZW5jcnlwdGVkIHByb3RvY29scyBhbmQgaXNcbiAgICAgICAgICogbm90IHJlY29tbWVuZGVkIHRvIGJlIHVzZWQgaW4gYW55IG90aGVyIHNpdHVhdGlvbnMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZUNsaWVudFRva2VuID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNsaWVudElkLCBuZXdUb2tlbiwgZW5jcnlwdGVkKSB7XG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZTtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlLCBkYXRhLmlkKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGNsaWVudElkLFxuICAgICAgICAgICAgICAgIG5ld3Rva2VuOiBuZXdUb2tlblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKGVuY3J5cHRlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmVuY3J5cHRlZCA9IGVuY3J5cHRlZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnB1c2hOb3RpZmljYXRpb24sXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBFVldFQjIuYWpheChzZXR0aW5ncywgdGhpcy5zZXJ2aWNlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVW5yZWdpc3RlcnMgYSBjbGllbnQgZnJvbSByZWNlaXZpbmcgcHVzaCBub3RpZmljYXRpb25zLiAgVGhpcyB3aWxsIHJlbW92ZSBhbGwgcHVzaCBub3RpZmljYXRpb25cbiAgICAgICAgICogc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyBkZXZpY2UsIGFzIHdlbGwgYXMgdW5yZWdpc3RlcmluZyB0aGUgZGV2aWNlLiAgQWZ0ZXIgdGhpcyBjYWxsLCBhIGRldmljZVxuICAgICAgICAgKiBtdXN0IHJlLXJlZ2lzdGVyIHVzaW5nIHtAbGluayBFVldFQjIuUHVzaE5vdGlmaWNhdGlvbi5yZWdpc3RlckNsaWVudH0gYmVmb3JlIGFueSBzdWJzY3JpcHRpb25zXG4gICAgICAgICAqIGNhbiBiZSBtYWRlLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQ2FsbGJhY2sgaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5TZXJ2ZXIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLlxuICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gY2xpZW50SWQgVGhlIGNsaWVudCBJRCB0byB1bnJlZ2lzdGVyLiAgVGhpcyB2YWx1ZSB3YXMgZ2VuZXJhdGVkIGluIGEgcHJldmlvdXMgY2FsbFxuICAgICAgICAgKiB0byB7QEVWV0VCMi5QdXNoTm90aWZpY2F0aW9uLnJlZ2lzdGVyQ2xpZW50fS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudW5yZWdpc3RlckNsaWVudCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjbGllbnRJZCkge1xuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGNsaWVudElkXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMucHVzaE5vdGlmaWNhdGlvbixcbiAgICAgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXNcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHNldHRpbmdzLCB0aGlzLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpOyIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSwgdXVpZDp0cnVlLCBBcnJheUJ1ZmZlcjpmYWxzZSwgRGF0YVZpZXc6dHJ1ZSwgV2ViU29ja2V0OmZhbHNlLCBCbG9iOmZhbHNlKi9cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBwcm90b2NvbCBtZXNzYWdlIHR5cGUuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAZGVwcmVjYXRlZCBXZWIgU29ja2V0IGZ1bmN0aW9uYWxpdHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3ZWIgQVBJIGluIDkuNi4wLlxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgIHZhciBwcm90b2NvbE1lc3NhZ2VUeXBlID0ge1xuICAgICAgICBwdWJsaXNoOiAxLFxuICAgICAgICBwdWJsaXNoZWQ6IDIsXG4gICAgICAgIHN1YnNjcmliZTogMyxcbiAgICAgICAgc3Vic2NyaWJlZDogNCxcbiAgICAgICAgdW5zdWJzY3JpYmU6IDUsXG4gICAgICAgIHVuc3Vic2NyaWJlZDogNlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgcG9zc2libGUgZXJyb3IgZW51bSB2YWx1ZXMgc2V0IG9uIEVWV0VCMi5SZXNwb25zZVN0YXR1cyBvYmplY3RzIGZvciB3ZWJzb2NrZXQgY2FsbHNcbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIud2Vic29ja2V0RXJyb3JDb2RlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd24gVG9waWNcbiAgICAgICAgICovXG4gICAgICAgIHVua25vd25Ub3BpYzogLTEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duIFN1YnNjcmlwdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgdW5rbm93blN1YnNjcmlwdGlvbjogLTIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaXNhYmxlZFxuICAgICAgICAgKi9cbiAgICAgICAgZGlzYWJsZWQ6IC0zLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ29ubmVjdGlvbiBMb3N0XG4gICAgICAgICAqL1xuICAgICAgICBjb25uZWN0aW9uTG9zdDogLTQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZW5kIEZhaWxlZFxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZEZhaWxlZDogLTUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMb2dpbiBSZXF1aXJlZFxuICAgICAgICAgKi9cbiAgICAgICAgbG9naW5SZXF1aXJlZDogLTZcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSGVscGVyIG1ldGhvZCB0byByZXBsYWNlIHRoZSB0aGUgdG9waWMgc3RyaW5nIHdpdGggdGhlIGl0ZW0gaWRzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIHRvcGljIHN0cmluZy5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIGFuIGFycmF5IG9mIGl0ZW0gaWRzLlxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBmb3JtYXR0ZWQgc3RyaW5nXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgdmFyIGZvcm1hdFN0cmluZyA9IGZ1bmN0aW9uKHN0cmluZywgYXJncykge1xuICAgICAgICB2YXIgcmVzdWx0ID0gc3RyaW5nO1xuICAgICAgICB2YXIgaSA9IGFyZ3MubGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFx7JyArIGkgKyAnXFxcXH0nLCAnZ20nKSwgYXJnc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRm9ybWF0IHRoZSBzZXNzaW9uIElkIHRvcGljIHdpdGggdGhlIGl0ZW0gaWRzIHBhc3NlZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9waWMgVGhlIHRvcGljIHN0cmluZy5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBpZHMgQW4gYXJyYXkgb2YgZWl0aGVyIEVWV0VCMiB0eXBlcyBvciBzdHJpbmdzLlxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBmb3JtYXR0ZWQgdG9waWNcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICB2YXIgZm9ybWF0VG9waWMgPSBmdW5jdGlvbih0b3BpYywgaWRzKSB7XG4gICAgICAgIHZhciBmb3JtYXRTdHIgPSB0b3BpYy5yYXdUb3BpY1N0cjtcbiAgICAgICAgdmFyIHJlcXVpcmVkVHlwZXMgPSB0b3BpYy5pZFR5cGVzO1xuICAgICAgICB2YXIgZm9ybWF0dGVkSWRzID0gW107XG5cbiAgICAgICAgdmFyIGluc3RhbmNlT2ZBbnkgPSBmdW5jdGlvbihvYmosIHR5cGVzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7IGkgPCB0eXBlcy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIHR5cGVzW2ldKXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBnZXRJZCA9IGZ1bmN0aW9uKG9iail7XG4gICAgICAgICAgICBpZiAoaW5zdGFuY2VPZkFueShvYmosIFtFVldFQjIuQ2FtZXJhLCBFVldFQjIuRGV2aWNlQ29uZmlnLCBFVldFQjIuVHJpZ2dlcl0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iai5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRlZmF1bHQgY2FzZVxuICAgICAgICAgICAgcmV0dXJuIG9iai50b1N0cmluZygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCByZXF1aXJlZFR5cGVzLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIGZvcm1hdHRlZElkcy5wdXNoKGdldElkKGlkc1tpXSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZvcm1hdFN0cmluZyhmb3JtYXRTdHIsIGZvcm1hdHRlZElkcyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBhdmFpbGFibGUgRVZXRUIyIHB1Ymxpc2gvc3Vic2NyaWJlIHRvcGljc1xuICAgICAqIEB0eXBlIE9iamVjdFxuICAgICAqIEByZWFkb25seVxuICAgICAqL1xuICAgIEVWV0VCMi5wdWJTdWJUb3BpYyA9IHtcbiAgICAgICAgc2VydmVyOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnNlcnZlclwiLFxuICAgICAgICAgICAgaWRUeXBlczogW11cbiAgICAgICAgfSxcbiAgICAgICAgc2VydmVyU3RhdHVzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuc3RhdHVzLnNlcnZlclwiLFxuICAgICAgICAgICAgaWRUeXBlczogW11cbiAgICAgICAgfSxcbiAgICAgICAgZGV2aWNlczoge1xuICAgICAgICAgICAgcmF3VG9waWNTdHI6IFwibnZyLmNvbmZpZy5kZXZpY2VzXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBjYW1lcmFPc2Q6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5jb25maWcuY2FtZXJhcy5zZXR0aW5ncy5vc2RcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXJzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnVzZXJzXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICB1c2VyR3JvdXBzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnVzZXJHcm91cHNcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGNhbWVyYXM6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5jb25maWcuY2FtZXJhc1wiLFxuICAgICAgICAgICAgaWRUeXBlczogW11cbiAgICAgICAgfSxcbiAgICAgICAgYWN0aXZlVXNlcnM6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5jb25maWcudXNlcnMuYWN0aXZlXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICB0cmlnZ2Vyczoge1xuICAgICAgICAgICAgcmF3VG9waWNTdHI6IFwibnZyLnN0YXR1cy5zb2Z0dHJpZ2dlcnNcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIG1vdGlvbjoge1xuICAgICAgICAgICAgcmF3VG9waWNTdHI6IFwibnZyLnN0YXR1cy5jYW1lcmEubW90aW9uXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBsb3NzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuc3RhdHVzLmNhbWVyYS5sb3NzXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBjYW1lcmFDb25uZWN0aW9uOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuc3RhdHVzLmNhbWVyYS5jb25uZWN0aW9uXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBkZXZpY2VDb25uZWN0aW9uOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuc3RhdHVzLmRldmljZS5jb25uZWN0aW9uXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBwbHVnaW5zOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnBsdWdpbnNcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGF2Z0ZyYW1lU2l6ZToge1xuICAgICAgICAgICAgcmF3VG9waWNTdHI6IFwibnZyLnZpZGVvLmNhbWVyYS57MH0uc3RhdHMuYXZnX2ZyYW1lX3NpemVcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtFVldFQjIuQ2FtZXJhXVxuICAgICAgICB9LFxuICAgICAgICB2aWRlb0gyNjQ6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci52aWRlby5jYW1lcmEuezB9Lm5hdGl2ZVwiLFxuICAgICAgICAgICAgaWRUeXBlczogW0VWV0VCMi5DYW1lcmFdXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvSlBFRzoge1xuICAgICAgICAgICAgcmF3VG9waWNTdHI6IFwibnZyLnZpZGVvLmNhbWVyYS57MH0uanBlZ1wiLFxuICAgICAgICAgICAgaWRUeXBlczogW0VWV0VCMi5DYW1lcmFdXG4gICAgICAgIH0sXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25EZXZpY2VzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnNlY3VyaXR5aW50ZWdyYXRpb25zLmRldmljZXNcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25TZW5zb3JzOiB7XG4gICAgICAgICAgICByYXdUb3BpY1N0cjogXCJudnIuY29uZmlnLnNlY3VyaXR5aW50ZWdyYXRpb25zLnNlbnNvcnNcIixcbiAgICAgICAgICAgIGlkVHlwZXM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25TZW5zb3JTdGF0dXM6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5zdGF0dXMuc2VjdXJpdHlpbnRlZ3JhdGlvbnMuc2Vuc29yc1wiLFxuICAgICAgICAgICAgaWRUeXBlczogW11cbiAgICAgICAgfSxcbiAgICAgICAgc2VjdXJpdHlJbnRlZ3JhdGlvbkRldmljZUNvbm5lY3Rpb246IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5zdGF0dXMuc2VjdXJpdHlpbnRlZ3JhdGlvbnMuZGV2aWNlcy5jb25uZWN0aW9uXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9LFxuICAgICAgICBhc3NvY2lhdGlvbnM6IHtcbiAgICAgICAgICAgIHJhd1RvcGljU3RyOiBcIm52ci5jb25maWcuYXNzb2NpYXRpb25zXCIsXG4gICAgICAgICAgICBpZFR5cGVzOiBbXVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFByb3RvY29sIGZsYWcgYml0bWFza3NcbiAgICAgKiBAdHlwZSB7b2JqZWN0fVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHZhciBwcm90b0ZsYWdzID0ge1xuICAgICAgICBhY2tCaXRtYXNrIDogMHgwMDAxLFxuICAgICAgICBiaWdFbmRpYW5CaXRtYXNrOiAweDAwMDIsXG4gICAgICAgIGJpbmFyeUJpdG1hc2sgOiAweDAwMDQsXG4gICAgICAgIHZlcnNpb25CaXRtYXNrOiAweDAwRTBcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIGZvciBwcm90b2NvbCBmbGFnc1xuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2Fjaz1mYWxzZV0gZmxhZyB0byBhY2tub3dsZWRnZSB0aGUgcmVxdWVzdFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2JpbmFyeT1mYWxzZV0gZmxhZyBpZiB0aGUgc2VyaWFsaWF0aW9uIGZvcm1hdCBpcyBiaW5hcnlcbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtiaWdFbmRpYW49ZmFsc2VdIGZsYWcgZm9yIGVuZGlhbmVzc1xuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbdmVyc2lvbj0wXSB0aGUgcHJvdG9jb2wgdmVyc2lvbiBudW1iZXJcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAdGhpcyBQcm90b2NvbEZsYWdzXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgdmFyIFByb3RvY29sRmxhZ3MgPSBmdW5jdGlvbihhY2ssIGJpbmFyeSwgYmlnRW5kaWFuLCB2ZXJzaW9uKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZsYWcgZm9yIGFja25vd2xlZGdlbWVudFxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWNrID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZsYWcgaWYgc2VyaWFsaXphdGlvbiBmb3JtYXQgaXMgYmluYXJ5XG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0JpbmFyeSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGbGFnIGlmIGJpZyBlbmRpYW5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzQmlnRW5kaWFuID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwcm90b2NvbCB2ZXJzaW9uIG51bWJlclxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52ZXJzaW9uID0gMDtcblxuICAgICAgICBpZiAoYWNrICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgdGhpcy5hY2sgPSBhY2s7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJpbmFyeSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHRoaXMuaXNCaW5hcnkgPSBiaW5hcnk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGJpZ0VuZGlhbiAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHRoaXMuaXNCaWdFbmRpYW4gPSBiaWdFbmRpYW47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZlcnNpb24gIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlIHRoZSBiaXRtYXNrIHZhbHVlIGZvciBpbmNsdXNpb24gaW4gaGVhZGVyXG4gICAgICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBiaXRtYXNrIHZhbHVlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJpdG1hc2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBiaXRtYXNrID0gMHgwMDAwO1xuXHRcdFx0LyogZXNsaW50LWRpc2FibGUgbm8tYml0d2lzZSAqL1xuICAgICAgICAgICAgYml0bWFzayB8PSB0aGlzLmFjayA/IHByb3RvRmxhZ3MuYWNrQml0bWFzayA6IDA7XG4gICAgICAgICAgICBiaXRtYXNrIHw9IHRoaXMuaXNCaW5hcnkgPyBwcm90b0ZsYWdzLmJpbmFyeUJpdG1hc2sgOiAwO1xuICAgICAgICAgICAgYml0bWFzayB8PSB0aGlzLmlzQmlnRW5kaWFuID8gcHJvdG9GbGFncy5iaWdFbmRpYW5CaXRtYXNrOiAwO1xuICAgICAgICAgICAgYml0bWFzayB8PSAodGhpcy52ZXJzaW9uICYgMHgwMDA3KSA8PCA1O1xuXHRcdFx0LyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICByZXR1cm4gYml0bWFzaztcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IHRoZSBpbnN0YW5jZSBmbGFncy92YWx1ZXMgZnJvbSBhIGJpdG1hc2tcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGJpdG1hc2sgdGhlIGJpdG1hc2sgdmFsdWUgdG8gc2V0IGZsYWdzIGZyb21cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2V0RnJvbUJpdG1hc2sgPSBmdW5jdGlvbihiaXRtYXNrKSB7XG5cdFx0XHQvKiBlc2xpbnQtZGlzYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICB0aGlzLmFjayA9IEJvb2xlYW4oYml0bWFzayAmIHByb3RvRmxhZ3MuYWNrQml0bWFzayk7XG4gICAgICAgICAgICB0aGlzLmlzQmluYXJ5ID0gQm9vbGVhbihiaXRtYXNrICYgcHJvdG9GbGFncy5iaW5hcnlCaXRtYXNrKTtcbiAgICAgICAgICAgIHRoaXMuaXNCaWdFbmRpYW4gPSBCb29sZWFuKGJpdG1hc2sgJiBwcm90b0ZsYWdzLmJpZ0VuZGlhbkJpdG1hc2spO1xuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gKGJpdG1hc2sgJiBwcm90b0ZsYWdzLnZlcnNpb25CaXRtYXNrKSA+PiA1O1xuXHRcdFx0LyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBmb3IgaGVhZGVyIGluZm9ybWF0aW9uIGZvciBwcm90b2NvbCBtZXNzYWdlc1xuICAgICAqIEBwYXJhbSByZXF1ZXN0SWRcbiAgICAgKiBAcGFyYW0gdG9waWNcbiAgICAgKiBAcGFyYW0gbWVzc2FnZVR5cGVcbiAgICAgKiBAcGFyYW0gZmxhZ3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAdGhpcyBQcm90b2NvbEhlYWRlclxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHZhciBQcm90b2NvbEhlYWRlciA9IGZ1bmN0aW9uKHJlcXVlc3RJZCwgdG9waWMsIG1lc3NhZ2VUeXBlLCBmbGFncyl7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSByZXF1ZXN0IElEIG9mIHRoZSBtZXNzYWdlLlxuICAgICAgICAgKiBAdHlwZSBTdHJpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVxdWVzdElkID0gcmVxdWVzdElkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdG9waWMuXG4gICAgICAgICAqIEB0eXBlIFN0cmluZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3BpYyA9IHRvcGljO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHJvdG9jb2wgbWVzc2FnZSB0eXBlXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1lc3NhZ2VUeXBlID0gbWVzc2FnZVR5cGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwcm90b2NvbCBvcHRpb25zL2ZsYWdzXG4gICAgICAgICAqIEB0eXBlIHtQcm90b2NvbEZsYWdzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mbGFncyA9IGZsYWdzO1xuXG4gICAgICAgIHRoaXMubWFyc2hhbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGhkciA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHJlcXVlc3Q6IGhkci5tZXNzYWdlVHlwZSxcbiAgICAgICAgICAgICAgICByaWQ6IGhkci5yZXF1ZXN0SWQsXG4gICAgICAgICAgICAgICAgdG9waWM6IGhkci50b3BpYyxcbiAgICAgICAgICAgICAgICBmbGFnczogaGRyLmZsYWdzLmJpdG1hc2soKSxcbiAgICAgICAgICAgICAgICAvLyBUT0RPIGFkZCBpbiBKUyBzdXBwb3J0IGZvciBzdWIgcHJvdG9jb2xzXG4gICAgICAgICAgICAgICAgc3ViUHJvdG9jb2w6IDB4MDAsXG4gICAgICAgICAgICAgICAgc3ViUHJvdG9jb2xGbGFnczogMHgwMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUHViU3ViICdVbnN1YnNjcmliZScgcHJvdG9jb2wgbWVzc2FnZSwgc2VudCB0byB0aGUgc2VydmVyIHRvIHVuc3Vic2NyaWJlIGNvbXBsZXRlbHkgZnJvbSBhIHRvcGljLlxuICAgICAqIEBwYXJhbSB7UHJvdG9jb2xIZWFkZXJ9IGhlYWRlciBUaGUgaGVhZGVyIGZvciB0aGlzIHJlcXVlc3QuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHN1YnNjcmlwdGlvbklkIFRoZSBzdWJzY3JpcHRpb24gaWQgdG8gdW5zdWJzY3JpYmUuXG4gICAgICogQGludGVybmFsXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHRoaXMgVW5zdWJzY3JpYmVNZXNzYWdlXG4gICAgICovXG4gICAgdmFyIFVuc3Vic2NyaWJlTWVzc2FnZSA9IGZ1bmN0aW9uKGhlYWRlciwgc3Vic2NyaXB0aW9uSWQpIHtcbiAgICAgICAgLy8gZW5zdXJlIHRoZSBoZWFkZXIgaXMgY29ycmVjdFxuICAgICAgICBoZWFkZXIubWVzc2FnZVR5cGUgPSBwcm90b2NvbE1lc3NhZ2VUeXBlLnVuc3Vic2NyaWJlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWVzc2FnZSBoZWFkZXJcbiAgICAgICAgICogQHR5cGUge1Byb3RvY29sSGVhZGVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oZHIgPSBoZWFkZXI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdWJzY3JpcHRpb24gaWRcbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uSWQgPSBzdWJzY3JpcHRpb25JZDtcblxuICAgICAgICB0aGlzLm1hcnNoYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcztcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAnaGVhZGVyJzogbWVzc2FnZS5oZHIubWFyc2hhbCgpLFxuICAgICAgICAgICAgICAgICdwYXlsb2FkJzoge1xuICAgICAgICAgICAgICAgICAgICAnc3Vic2NyaXB0aW9uSWQnOiBtZXNzYWdlLnN1YnNjcmlwdGlvbklkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUGVuZGluZyB1bi1zdWJzY3JpYmUgcmVxdWVzdCBvYmplY3QsIHVzZWQgdG8gaG9sZCBzdGF0ZSBpbi1iZXR3ZWVuIHVuc3Vic2NyaWJlIGFuZCBzZXJ2ZXIgYWNrbm93bGVkZ2VtZW50XG4gICAgICogQHBhcmFtIHtFVldFQjIuU3Vic2NyaXB0aW9ufSBzdWJzY3JpcHRpb24gVGhlIHN1YnNjcmlwdGlvbiB0byB1bnN1YnNjcmliZVxuICAgICAqIEBwYXJhbSB7JC5EZWZlcnJlZH0gb25BY2tub3dsZWRnZSBUaGUgZGVmZXJyZWQgdG8gcmVzb2x2ZSB3aGVuIHRoZSByZXF1ZXN0IGlzIGNvbXBsZXRlZFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHRoaXMgVW5zdWJzY3JpYmVSZXF1ZXN0XG4gICAgICovXG4gICAgdmFyIFVuc3Vic2NyaWJlUmVxdWVzdCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbiwgb25BY2tub3dsZWRnZSkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3Vic2NyaXB0aW9uIHRvIHVuc3Vic2NyaWJlXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU3Vic2NyaXB0aW9ufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkZWZlcnJlZCBvYmplY3QgdG8gcmVzb2x2ZSB3aGVuIHVuc3Vic2NyaWJlZCBjb21wbGV0ZWx5XG4gICAgICAgICAqIEB0eXBlIHskLkRlZmVycmVkfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkFja25vd2xlZGdlID0gb25BY2tub3dsZWRnZTtcblxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQdWJTdWIgJ1N1YnNjcmliZScgcHJvdG9jb2wgbWVzc2FnZSwgc2VudCB0byB0aGUgc2VydmVyIHRvIHJlcXVlc3QgYSBuZXcgc3Vic2NyaXB0aW9uIGJlIG1hZGVcbiAgICAgKiBAcGFyYW0ge1Byb3RvY29sSGVhZGVyfSBoZWFkZXIgVGhlIGhlYWRlciBmb3IgdGhpcyByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtyZXF1ZXN0ZWRTaWQ9JyddIFJlcXVlc3QgYSBwYXJ0aWN1bGFyIHN1YnNjcmlwdGlvbiBJRCBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgKiBAdGhpcyBTdWJzY3JpYmVNZXNzYWdlXG4gICAgICogQGNsYXNzXG4gICAgICovXG4gICAgdmFyIFN1YnNjcmliZU1lc3NhZ2UgPSBmdW5jdGlvbihoZWFkZXIsIHJlcXVlc3RlZFNpZCkge1xuICAgICAgICAvLyBlbnN1cmUgdGhlIGhlYWRlciBpcyBjb3JyZWN0XG4gICAgICAgIGhlYWRlci5tZXNzYWdlVHlwZSA9IHByb3RvY29sTWVzc2FnZVR5cGUuc3Vic2NyaWJlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWVzc2FnZSBoZWFkZXJcbiAgICAgICAgICogQHR5cGUge1Byb3RvY29sSGVhZGVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5oZHIgPSBoZWFkZXI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgc3BlY2lmaWMgc3Vic2NyaXB0aW9uIGlkIHRvIHJlcXVlc3QgdGhlIHNlcnZlciB1c2VcbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVxdWVzdGVkU2lkID0gJyc7XG5cbiAgICAgICAgaWYocmVxdWVzdGVkU2lkICE9PSB1bmRlZmluZWQgJiYgcmVxdWVzdGVkU2lkICE9PSAnJykge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0ZWRTaWQgPSByZXF1ZXN0ZWRTaWQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1hcnNoYWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYobWVzc2FnZS5yZXF1ZXN0ZWRTaWQgIT09ICcnKXtcbiAgICAgICAgICAgICAgICBvcHRpb25zWydyZXF1ZXN0ZWRTSUQnXSA9IG1lc3NhZ2UucmVxdWVzdGVkU2lkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICdoZWFkZXInOiBtZXNzYWdlLmhkci5tYXJzaGFsKCksXG4gICAgICAgICAgICAgICAgJ3BheWxvYWQnOiB7XG4gICAgICAgICAgICAgICAgICAgICdvcHRpb25zJzogb3B0aW9uc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEpTT04gc2VyaWFsaXplclxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuSnNvblNlcmlhbGl6ZXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyBmb3IgcHJvdG9jb2wgZmxhZ3NcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzQmluYXJ5ID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5zZXJpYWxpemUgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy51bnNlcmlhbGl6ZSA9IGZ1bmN0aW9uKHBheWxvYWQpIHtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKHBheWxvYWQpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb21wb3NpdGUgQmluYXJ5IHNlcmlhbGl6ZXIuIFRoZSBjb21wb3NpdGUgc2VyaWFsaXplciBpbmNsdWRlcyBhIGJpbmFyeSBoZWFkZXIgd2l0aCBhXG4gICAgICogc2VyaWFsaXplZCBwYXlsb2FkIGFuZCBhbiBvcHRpb25hbCBiaW5hcnkgcGF5bG9hZC5cbiAgICAgKlxuICAgICAqIFdpcmUgRm9ybWF0IG9mIGEgY29tcG9zaXRlIHNlcmlhbGl6ZWQgbWVzc2FnZTpcbiAgICAgKlxuICAgICAqICAwLi4uMi4uLi4uLi4uLi4uNy4uLi4uLi4uLi4uLi4uLjE1Li4uLi4uLi4uLi4uLjIzLi4uLi4uLi4uLi4uLi4uMzFcbiAgICAgKiAgKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLSstKy0rLStcbiAgICAgKiAgfCBwcm90b01zZ1R5cGUgIHwgdWludDE2X3QgZmxhZ3MgICAgICAgVlZWU1NCRUEgfCBTdWJQcm90b2NvbCAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICBzcGYgZmxhZ3MgIHwgUmVzZXJ2ZWQgICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgIFVVSUQgIHJlcXVlc3RJZCAgICgxNiBieXRlcykgICAgICAgIHxcbiAgICAgKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgdWludDE2X3QgIHRvcGljIGxlbmd0aCAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgdWludDMyX3QgICAgICBkYXRhTGVuZ3RoICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgdWludDMyX3QgICAgICBibG9iTGVuZ3RoICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgU3RyaW5nICAgICAgICB0b3BpYyAgIChhc2NpaSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgU2VyaWFsaXplZCBQYXlsb2FkICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKiAgfCAgICAgQmluYXJ5IHBheWxvYWQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICAgKiAgKy0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLStcbiAgICAgKlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuQ29tcG9zaXRlU2VyaWFsaXplciA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyBmb3IgcHJvdG9jb2wgZmxhZ3MgLyBzZW5kTWVzc2FnZVxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXNCaW5hcnkgPSB0cnVlO1xuXG4gICAgICAgIHZhciBqc29uU2VyaWFsaXplciA9IG5ldyBFVldFQjIuSnNvblNlcmlhbGl6ZXIoKTtcbiAgICAgICAgdmFyIHNlcmlhbGl6ZXJNYXAgPSB7XG4gICAgICAgICAgICAweDAwOiBqc29uU2VyaWFsaXplclxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXQgdGhlIHNlcmlhbGl6ZXIgZnJvbSB0aGUgZmxhZyBiaXRtYXNrIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG9cbiAgICAgICAgICogZGVjb2RlIGFueSBzZXJpYWxpemVkIGNvbnRlbnRcbiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGZsYWdzIFRoZSBiaXRtYXNrXG4gICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBkZWNvZGVkIG9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHNlcmlhbGl6ZXJfZnJvbV9iaXRtYXNrID0gZnVuY3Rpb24gKGZsYWdzKSB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICB2YXIgc3R5cGUgPSAoZmxhZ3MgJiAweDE4KSA+PiAzO1xuICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1iaXR3aXNlICovXG4gICAgICAgICAgICB2YXIgbWFwcGVkU2VyaWFsaXplciA9IHNlcmlhbGl6ZXJNYXBbc3R5cGVdO1xuICAgICAgICAgICAgcmV0dXJuIG1hcHBlZFNlcmlhbGl6ZXIgPT09IHVuZGVmaW5lZCA/IGpzb25TZXJpYWxpemVyIDogbWFwcGVkU2VyaWFsaXplcjtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRW5jYXBzdWxhdGVzIHRoZSBsb2dpYyB0byBlbmNvZGUgYSBtYXJzaGFsbGVkIG1lc3NhZ2UgdG8gYSBiaW5hcnkgYnVmZmVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgKiBAdGhpcyBNZXNzYWdlRW5jb2RlclxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIE1lc3NhZ2VFbmNvZGVyID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBjdXJyZW50IHZpZXcgb2Zmc2V0XG4gICAgICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLm9mZnNldCA9IDA7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV3JpdGUgdGhlIGJ5dGVzIG9mIGEgc3RyaW5nIHRvIGEgZGF0YSB2aWV3LiBFeHBlY3RlZCB0byBiZSBBU0NJSSBzdHJpbmdzIG9ubHkuIFRoZVxuICAgICAgICAgICAgICogZW5jb2RlciBvZmZzZXQgaXMgYWR2YW5jZWQgYnkgdGhlIHN0cmluZyBsZW5ndGguXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0RhdGFWaWV3fSB2aWV3IFRoZSB2aWV3IG9iamVjdCB0byB3cml0ZSB0aGUgc3RyaW5nIHRvXG4gICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyIFRoZSBzdHJpbmcgdG8gZW5jb2RlIGFzIGJ5dGVzIGludG8gdGhlIHZpZXdcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy53cml0ZVN0cmluZyA9IGZ1bmN0aW9uICh2aWV3LCBzdHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW5jb2RlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IGVuY29kZXIub2Zmc2V0O1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgKytpLCArK29mZnNldCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgICAgICB2aWV3LnNldFVpbnQ4KG9mZnNldCwgYnl0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVuY29kZXIub2Zmc2V0ID0gb2Zmc2V0O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBXcml0ZSB0aGUgYnl0ZXMgb2YgYSBVVUlEIHRvIGEgZGF0YSB2aWV3LiBUaGUgZW5jb2RlciBvZmZzZXQgaXMgYWR2YW5jZWQgYnlcbiAgICAgICAgICAgICAqIDE2ICh0aGUgYnl0ZSBsZW5ndGggb2YgYSBVVUlEKVxuICAgICAgICAgICAgICogQHBhcmFtIHtEYXRhVmlld30gdmlldyB0aGUgdmlldyBvYmplY3QgdG8gd3JpdGUgVVVJRCBieXRlcyB0b1xuICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHV1aWRTdHIgVGhlIGhleCBVVUlEIHN0cmluZyBpbiAneHh4eHh4eHgteHh4eC14eHh4LXh4eHgteHh4eHh4eHh4eHh4JyBmb3JtYXRcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy53cml0ZVVVSUQgPSBmdW5jdGlvbiAodmlldywgdXVpZFN0cikge1xuICAgICAgICAgICAgICAgIHZhciBlbmNvZGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgYnl0ZXMgPSB1dWlkLnBhcnNlKHV1aWRTdHIpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgdmlldy5zZXRVaW50OChlbmNvZGVyLm9mZnNldCwgYnl0ZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBlbmNvZGVyLm9mZnNldCArPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRW5jb2RlIHRoZSBoZWFkZXIgaW5mb3JtYXRpb24gaW50byBhIGRhdGEgdmlldy4gVGhlIGVub2NkZXIgb2Zmc2V0IGlzIGFkdmFuY2VkIGJ5IHRoZVxuICAgICAgICAgICAgICogZml4ZWQgaGVhZGVyIGxlbmd0aCArIHRvcGljIGxlbmd0aFxuICAgICAgICAgICAgICogQHBhcmFtIHtEYXRhVmlld30gdmlldyB0aGUgZGF0YXZpZXcgdG8gZW5jb2RlIHRoZSBoZWFkZXIgdG9cbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkZXIgdGhlIG1hcnNoYWxsZWQgaGVhZGVyIGluZm9ybWF0aW9uXG4gICAgICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gZGF0YUxlbmd0aCBUaGUgbGVuZ3RoIG9mIHRoZSAoc2VyaWFsaXplZCkgZGF0YVxuICAgICAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGJsb2JMZW5ndGggVGhlIGxlbmd0aCBvZiBhbnkgYmluYXJ5IGRhdGFcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy53cml0ZUhlYWRlciA9IGZ1bmN0aW9uICh2aWV3LCBoZWFkZXIsIGRhdGFMZW5ndGgsIGJsb2JMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW5jb2RlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50OChlbmNvZGVyLm9mZnNldCsrLCBoZWFkZXIucmVxdWVzdCk7XG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50MTYoZW5jb2Rlci5vZmZzZXQsIGhlYWRlci5mbGFncyk7XG4gICAgICAgICAgICAgICAgZW5jb2Rlci5vZmZzZXQgKz0gMjtcblxuICAgICAgICAgICAgICAgIC8vIFRPRE8gYWRkIGluIEpTIHN1cHBvcnQgZm9yIHN1YnByb3RvY29sc1xuICAgICAgICAgICAgICAgIHZpZXcuc2V0VWludDgoZW5jb2Rlci5vZmZzZXQrKywgMCk7XG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50OChlbmNvZGVyLm9mZnNldCsrLCAwKTtcblxuICAgICAgICAgICAgICAgIC8vIHJlc2VydmVkIGJ5dGVcbiAgICAgICAgICAgICAgICB2aWV3LnNldFVpbnQ4KGVuY29kZXIub2Zmc2V0KyssIDApO1xuXG4gICAgICAgICAgICAgICAgZW5jb2Rlci53cml0ZVVVSUQodmlldywgaGVhZGVyLnJpZCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgdG9waWNMZW5ndGggPSBoZWFkZXIudG9waWMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHZpZXcuc2V0VWludDE2KGVuY29kZXIub2Zmc2V0LCB0b3BpY0xlbmd0aCk7XG4gICAgICAgICAgICAgICAgZW5jb2Rlci5vZmZzZXQgKz0gMjtcblxuICAgICAgICAgICAgICAgIHZpZXcuc2V0VWludDMyKGVuY29kZXIub2Zmc2V0LCBkYXRhTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBlbmNvZGVyLm9mZnNldCArPSA0O1xuXG4gICAgICAgICAgICAgICAgdmlldy5zZXRVaW50MzIoZW5jb2Rlci5vZmZzZXQsIGJsb2JMZW5ndGgpO1xuICAgICAgICAgICAgICAgIGVuY29kZXIub2Zmc2V0ICs9IDQ7XG5cbiAgICAgICAgICAgICAgICBlbmNvZGVyLndyaXRlU3RyaW5nKHZpZXcsIGhlYWRlci50b3BpYyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEVuY29kZSBhIG1hcnNoYWxsZWQgUHViU3ViIG1lc3NhZ2UgdG8gYW4gYXJyYXkgYnVmZmVyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUgaW5zdGFuY2Ugb2YgYSBtYXJzaGFsbGVkIHB1YnN1YiBtZXNzYWdlXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7QXJyYXlCdWZmZXJ9IFRoZSBlbmNvZGVkIGFycmF5IGJ1ZmZlclxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmVuY29kZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBlbmNvZGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgZml4ZWRIZWFkZXJMZW5ndGggPSAzMjtcbiAgICAgICAgICAgICAgICB2YXIgc2VyaWFsaXplciA9IHNlcmlhbGl6ZXJfZnJvbV9iaXRtYXNrKHZhbHVlLmhlYWRlci5mbGFncyk7XG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWRDb250ZW50ID0gc2VyaWFsaXplci5zZXJpYWxpemUodmFsdWUucGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IHZhbHVlLmhlYWRlcjtcbiAgICAgICAgICAgICAgICB2YXIgYmxvYiA9ICcnO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5ibG9iICE9PSB1bmRlZmluZWQgJiYgdmFsdWUuYmxvYiAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IHZhbHVlLmJsb2I7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFMZW5ndGggPSAwLCBibG9iTGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICBpZiAoc2VyaWFsaXplci5pc0JpbmFyeSl7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFMZW5ndGggPSBzZXJpYWxpemVkQ29udGVudC5ieXRlTGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBibG9iTGVuZ3RoID0gYmxvYi5ieXRlTGVuZ3RoO1xuICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICBkYXRhTGVuZ3RoID0gc2VyaWFsaXplZENvbnRlbnQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBibG9iTGVuZ3RoID0gYmxvYi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZnNpemUgPSBmaXhlZEhlYWRlckxlbmd0aCArIGhlYWRlci50b3BpYy5sZW5ndGggKyBkYXRhTGVuZ3RoICsgYmxvYkxlbmd0aDtcbiAgICAgICAgICAgICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKGJ1ZnNpemUpO1xuICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgZW5jb2Rlci53cml0ZUhlYWRlcih2aWV3LCBoZWFkZXIsIGRhdGFMZW5ndGgsIGJsb2JMZW5ndGgpO1xuXG4gICAgICAgICAgICAgICAgaWYoc2VyaWFsaXplci5pc0JpbmFyeSl7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gam9pbiBhcnJheSBidWZmZXJzIChhc3N1bWVzIGFycmF5YnVmZmVyIGlzIHJldHVybmVkIGJ5IGJpbmFyeSBzZXJpYWxpemVycyAnc2VyaWFsaXplJyBtZXRob2QpXG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGVuY29kZXIud3JpdGVTdHJpbmcodmlldywgc2VyaWFsaXplZENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICBlbmNvZGVyLndyaXRlU3RyaW5nKHZpZXcsIGJsb2IpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBidWZmZXI7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIHRvIGRlY29kZSBhIHNpbmdsZSBwdWJzdWIgbWVzc2FnZSBzZXJpYWxpemVkIGluIHRoZSBleHBlY3RlZCBmb3JtYXQuXG4gICAgICAgICAqIEBwYXJhbSB7RGF0YVZpZXd9IHZpZXcgdGhlIGRhdGF2aWV3IGFyb3VuZCB0aGUgcmVjZWl2ZWQgYXJyYXkgYnVmZmVyIHRvIGJlIGRlY29kZWRcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtvZmZzZXQ9MF0gVGhlIG9mZnNldCBpbnRvIHRoZSB2aWV3IHRvIHN0YXJ0IGRlY29kaW5nXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAgICAgKiBAdGhpcyBNZXNzYWdlRGVjb2RlclxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIE1lc3NhZ2VEZWNvZGVyID0gZnVuY3Rpb24gKHZpZXcsIG9mZnNldCkge1xuICAgICAgICAgICAgdGhpcy52aWV3ID0gdmlldztcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gb2Zmc2V0IHx8IDA7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVhZCBhIHN0cmluZyBmcm9tIHRoZSB2aWV3LiBBU0NJSSBvbmx5LiBUaGUgZGVjb2RlciBvZmZzZXQgaXMgYWR2YW5jZWQgYnkgdGhlXG4gICAgICAgICAgICAgKiBzdHJpbmcgbGVuZ3RoXG4gICAgICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0IHRoZSBvZmZzZXQgaW50byB0aGUgdmlldyB0byBiZWdpbiByZWFkaW5nIGEgc3RyaW5nXG4gICAgICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gbGVuZ3RoIHRoZSBleHBlY3RlZCBzdHJpbmcgbGVuZ3RoIChudW1iZXIgb2YgYnl0ZXMgdG8gcmVhZClcbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSByZWFkIHN0cmluZ1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnJlYWRTdHJpbmcgPSBmdW5jdGlvbiAob2Zmc2V0LCBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVjb2RlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIHN0cmluZyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldCwgZW5kID0gb2Zmc2V0ICsgbGVuZ3RoOyBpIDwgZW5kOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVVRGOD8/XG4gICAgICAgICAgICAgICAgICAgIHZhciBieXRlID0gZGVjb2Rlci52aWV3LmdldFVpbnQ4KGkpO1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlKTtcbiAgICAgICAgICAgICAgICAgICAgZGVjb2Rlci5vZmZzZXQgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogUmVhZCB0aGUgYnl0ZXMgb2YgYSBVVUlEIGFuZCByZWNvbnN0cnVjdCBpbnRvIHRoZSBoZXggc3RyaW5nIGZvcm1hdFxuICAgICAgICAgICAgICogZS5nLiAneHh4eHh4eHgteHh4eC14eHh4LXh4eHgteHh4eHh4eHh4eHh4Jy4gVGhlIGRlY29kZXIgb2Zmc2V0IGlzIGFkdmFuY2VkXG4gICAgICAgICAgICAgKiBieSAxNiBieXRlcy5cbiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgdGhlIG9mZnNldCBpbnRvIHRoZSB2aWV3IHRvIGJlZ2luIHJlYWRpbmcgVVVJRCBieXRlc1xuICAgICAgICAgICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIFVVSURcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5yZWFkVVVJRCA9IGZ1bmN0aW9uIChvZmZzZXQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVjb2RlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIHV1aWRMZW5ndGggPSAxNjtcbiAgICAgICAgICAgICAgICB2YXIgYnVmID0gbmV3IEFycmF5KHV1aWRMZW5ndGgpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBvZmZzZXQsIGVuZCA9IG9mZnNldCArIHV1aWRMZW5ndGg7IGkgPCBlbmQ7ICsraSkge1xuICAgICAgICAgICAgICAgICAgICBidWZbaSAtIG9mZnNldF0gPSBkZWNvZGVyLnZpZXcuZ2V0VWludDgoaSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGVjb2Rlci5vZmZzZXQgKz0gdXVpZExlbmd0aDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXVpZC51bnBhcnNlKGJ1Zik7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFJlYWQgYSBQdWJTdWIgbWVzc2FnZSBoZWFkZXIgYW5kIGNvbnN0cnVjdCBhbiBlcXVpdmFsZW50IG1hcnNoYWxsZWQgaGVhZGVyXG4gICAgICAgICAgICAgKiBvYmplY3QuIFRoZSBkZWNvZGVyIG9mZnNldCBpcyBhZHZhbmNlZCBieSB0aGUgZml4ZWQgaGVhZGVyIGxlbmd0aCArIHRoZVxuICAgICAgICAgICAgICogdG9waWMgc3RyaW5nIGxlbmd0aC5cbiAgICAgICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IEEgbWFyc2hhbGxlZCBQdWJTdWIgbWVzc2FnZSBoZWFkZXIgd2l0aCBhZGRpdGlvbmFsXG4gICAgICAgICAgICAgKiAnZGF0YUxlbmd0aCcgYW5kICdibG9iTGVuZ3RoJyBhdHRyaWJ1dGVzIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMucmVhZEhlYWRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWNvZGVyID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0ge1xuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OiAwLFxuICAgICAgICAgICAgICAgICAgICByaWQ6ICcnLFxuICAgICAgICAgICAgICAgICAgICBmbGFnczogMCxcbiAgICAgICAgICAgICAgICAgICAgdG9waWM6ICcnLFxuICAgICAgICAgICAgICAgICAgICBzdWJQcm90b2NvbDogMCxcbiAgICAgICAgICAgICAgICAgICAgc3ViUHJvdG9jb2xGbGFnczogMCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YUxlbmd0aDogMCwgIC8vIHRoZXNlIGtleXMgYXJlIGFkZGVkIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmdcbiAgICAgICAgICAgICAgICAgICAgYmxvYkxlbmd0aDogMFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBoZWFkZXIucmVxdWVzdCA9IHZpZXcuZ2V0VWludDgoZGVjb2Rlci5vZmZzZXQrKyk7XG4gICAgICAgICAgICAgICAgaGVhZGVyLmZsYWdzID0gdmlldy5nZXRVaW50MTYoZGVjb2Rlci5vZmZzZXQpO1xuICAgICAgICAgICAgICAgIGRlY29kZXIub2Zmc2V0ICs9IDI7XG5cbiAgICAgICAgICAgICAgICBoZWFkZXIuc3ViUHJvdG9jb2wgPSB2aWV3LmdldFVpbnQ4KGRlY29kZXIub2Zmc2V0KyspO1xuICAgICAgICAgICAgICAgIGhlYWRlci5zdWJQcm90b2NvbEZsYWdzID0gdmlldy5nZXRVaW50OChkZWNvZGVyLm9mZnNldCsrKTtcblxuICAgICAgICAgICAgICAgIC8vIHNraXAgdGhlIHJlc2VydmVkIGJ5dGVcbiAgICAgICAgICAgICAgICBkZWNvZGVyLm9mZnNldCsrO1xuXG4gICAgICAgICAgICAgICAgaGVhZGVyLnJpZCA9IGRlY29kZXIucmVhZFVVSUQoZGVjb2Rlci5vZmZzZXQpO1xuICAgICAgICAgICAgICAgIHZhciB0b3BpY0xlbmd0aCA9IHZpZXcuZ2V0VWludDE2KGRlY29kZXIub2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBkZWNvZGVyLm9mZnNldCArPSAyO1xuXG4gICAgICAgICAgICAgICAgaGVhZGVyLmRhdGFMZW5ndGggPSB2aWV3LmdldFVpbnQzMihkZWNvZGVyLm9mZnNldCk7XG4gICAgICAgICAgICAgICAgZGVjb2Rlci5vZmZzZXQgKz0gNDtcblxuICAgICAgICAgICAgICAgIGhlYWRlci5ibG9iTGVuZ3RoID0gdmlldy5nZXRVaW50MzIoZGVjb2Rlci5vZmZzZXQpO1xuICAgICAgICAgICAgICAgIGRlY29kZXIub2Zmc2V0ICs9IDQ7XG5cbiAgICAgICAgICAgICAgICBoZWFkZXIudG9waWMgPSBkZWNvZGVyLnJlYWRTdHJpbmcoZGVjb2Rlci5vZmZzZXQsIHRvcGljTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGVhZGVyO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFBhcnNlIGEgUHViU3ViIG1lc3NhZ2UgaW50byBpdHMgbWFyc2hhbGxlZCBmb3JtXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7e2hlYWRlcjogT2JqZWN0LCBwYXlsb2FkOiBPYmplY3R9fSBUaGUgcHVic3ViIG1lc3NhZ2VcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5wYXJzZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVjb2RlciA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IGRlY29kZXIucmVhZEhlYWRlcigpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyX2Zyb21fYml0bWFzayhoZWFkZXIuZmxhZ3MpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWRDb250ZW50O1xuICAgICAgICAgICAgICAgIGlmIChzZXJpYWxpemVyLmlzQmluYXJ5KXtcbiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZENvbnRlbnQgPSBkZWNvZGVyLnZpZXcuYnVmZmVyLnNsaWNlKGRlY29kZXIub2Zmc2V0LCBkZWNvZGVyLm9mZnNldCArIGhlYWRlci5kYXRhTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgZGVjb2Rlci5vZmZzZXQgKz0gaGVhZGVyLmRhdGFMZW5ndGg7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VyaWFsaXplZENvbnRlbnQgPSBkZWNvZGVyLnJlYWRTdHJpbmcoZGVjb2Rlci5vZmZzZXQsIGhlYWRlci5kYXRhTGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBzZXJpYWxpemVyLnVuc2VyaWFsaXplKHNlcmlhbGl6ZWRDb250ZW50KTtcblxuICAgICAgICAgICAgICAgIHZhciBvYmogPSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcjogaGVhZGVyLFxuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBjb250ZW50XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBibG9iO1xuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIuYmxvYkxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gdmlldy5idWZmZXIuc2xpY2UoZGVjb2Rlci5vZmZzZXQsIGRlY29kZXIub2Zmc2V0ICsgaGVhZGVyLmJsb2JMZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBkZWNvZGVyLm9mZnNldCArPSBoZWFkZXIuYmxvYkxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgb2JqWydwYXlsb2FkJ11bJ2RhdGEnXVsnYmxvYiddID0gYmxvYjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgZXh0cmEgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmouaGVhZGVyWydibG9iTGVuZ3RoJ107XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9iai5oZWFkZXJbJ2RhdGFMZW5ndGgnXTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJpYWxpemUgYSBtYXJzaGFsbGVkIG9iamVjdCB0byBhIGJpbmFyeSBidWZmZXJcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG1hcnNoYWxsZWQgb2JqZWN0XG4gICAgICAgICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gVGhlIHNlcmlhbGl6ZWQgYnVmZmVyXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB2YXIgZW5jb2RlciA9IG5ldyBNZXNzYWdlRW5jb2RlcigpO1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kZXIuZW5jb2RlKGRhdGEpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbnNlcmlhbGl6ZSBhIGJpbmFyeSBidWZmZXIgdG8gYSBtYXJzaGFsbGVkIHB1YnN1YiBvYmplY3RcbiAgICAgICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gYnVmIFRoZSBiaW5hcnkgYnVmZmVyXG4gICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IE1hcnNoYWxsZWQgcHVic3ViIG9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51bnNlcmlhbGl6ZSA9IGZ1bmN0aW9uIChidWYpIHtcbiAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGJ1Zik7XG4gICAgICAgICAgICB2YXIgZGVjb2RlciA9IG5ldyBNZXNzYWdlRGVjb2Rlcih2aWV3KTtcbiAgICAgICAgICAgIHJldHVybiBkZWNvZGVyLnBhcnNlKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICd0cmlnZ2VycydcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBzdWJzY3JpcHRpb25zIFRoZSBsaXN0IG9mIGF2YWlsYWJsZSBzdWJzY3JpcHRpb25zIGZvciB0aGlzIHRvcGljLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHJlY2VpdmVkIGZvciB0aGlzIHRvcGljLlxuICAgICAqL1xuICAgIHZhciBvblNvZnRUcmlnZ2VyVXBkYXRlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIHRyaWdnZXJJZCA9IGFyZ3NbMF07XG4gICAgICAgIHZhciBuYW1lID0gYXJnc1sxXTtcbiAgICAgICAgdmFyIHN0YXRlID0gYXJnc1syXTtcblxuICAgICAgICB2YXIgdHJpZ2dlciA9IG5ldyBFVldFQjIuVHJpZ2dlcihzdWJzY3JpcHRpb25zWzBdLnNlcnZlciwgdHJpZ2dlcklkLCBuYW1lLCBzdGF0ZSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaXB0aW9ucy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zW2ldLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uc1tpXSwgdHJpZ2dlcik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdhY3RpdmVVc2VycydcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBzdWJzY3JpcHRpb25zIFRoZSBsaXN0IG9mIGF2YWlsYWJsZSBzdWJzY3JpcHRpb25zIGZvciB0aGlzIHRvcGljLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHJlY2VpdmVkIGZvciB0aGlzIHRvcGljLlxuICAgICAqL1xuICAgIHZhciBvbkFjdGl2ZVVzZXJzQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIHVzZXJzID0gYXJnc1swXTtcblxuICAgICAgICB2YXIgdXNlcnNMaXN0ID0gJC5tYXAodXNlcnMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlN5c3RlbVVzYWdlSW5mbyhlbGVtZW50LnVzZXJuYW1lLCBlbGVtZW50LmxldmVsLCBlbGVtZW50LmFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHJlYW1zLCBlbGVtZW50LmF1ZGl0LCBlbGVtZW50Lmluc3RhbmNlTmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaXB0aW9ucy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zW2ldLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uc1tpXSwgdXNlcnNMaXN0KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBjYWxsYmFjayBmb3IgdG9waWMgJ3BsdWdpbnMnXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25QbHVnaW5zQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3M7XG4gICAgICAgIHZhciBwbHVnaW5zID0gYXJnc1swXTtcblxuICAgICAgICB2YXIgcGx1Z2luc0xpc3QgPSAkLm1hcChwbHVnaW5zLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TeXN0ZW1QbHVnaW5JbmZvKGVsZW1lbnQubmFtZSwgZWxlbWVudC5maWxlbmFtZSwgZWxlbWVudC52ZXJzaW9uLCBlbGVtZW50LmlzT3BlbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50Lm9wZW5Db2RlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaXB0aW9ucy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zW2ldLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uc1tpXSwgcGx1Z2luc0xpc3QpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGNhbGxiYWNrIGZvciB0b3BpYyAnbW90aW9uJ1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IHN1YnNjcmlwdGlvbnMgVGhlIGxpc3Qgb2YgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbnMgZm9yIHRoaXMgdG9waWMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgcmVjZWl2ZWQgZm9yIHRoaXMgdG9waWMuXG4gICAgICovXG4gICAgdmFyIG9uTW90aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIGNhbWVyYUlkID0gYXJnc1swXTtcbiAgICAgICAgdmFyIGhhc01vdGlvbiA9IGFyZ3NbMV07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBjYW1lcmFJZCwgaGFzTW90aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBjYWxsYmFjayBmb3IgdG9waWMgJ2xvc3MnXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25Mb3NzQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIGNhbWVyYUlkID0gYXJnc1swXTtcbiAgICAgICAgdmFyIHN0YXRlID0gYXJnc1sxXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIGNhbWVyYUlkLCBzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdjYW1lcmFDb25uZWN0aW9uJyBhbmQgJ2RldmljZUNvbm5lY3Rpb24nXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25Db25uZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIHVuaXF1ZUlkID0gYXJnc1swXTtcbiAgICAgICAgdmFyIHN0YXRlID0gYXJnc1sxXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIHVuaXF1ZUlkLCBzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIHJlc3BvbnNlVG9DYW1lcmFJbnN0YW5jZSA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBzZXJ2ZXIpIHtcbiAgICAgICAgdmFyIGRpc2FibGVkID0gcmVzcG9uc2UuZGlzYWJsZWQgIT09IDA7XG4gICAgICAgIHZhciB2aWRlbyA9IHJlc3BvbnNlLnN0YXRlID09PSAwO1xuXG4gICAgICAgIHZhciBwdHogPSByZXNwb25zZS5wdHogPT09IDE7XG4gICAgICAgIHZhciBwdHpUeXBlID0gRVZXRUIyLnB0elR5cGVzLm5vbmU7XG4gICAgICAgIGlmKHB0eikge1xuICAgICAgICAgICAgcHR6VHlwZSA9IEVWV0VCMi5wdHpUeXBlcy5zdGFuZGFyZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHJlc3BvbnNlLmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBJRCBmcm9tIHRoZSBwbHVnaW4sIGludGVyZmFjZSwgZGV2aWNlLCBhbmQgY29udGV4dCBJRHMuXG4gICAgICAgICAgICByZXNwb25zZS5pZCA9IEVWV0VCMi51dGlsLnBpZFRvQ2FtZXJhSWQocmVzcG9uc2UucCwgcmVzcG9uc2UuaSwgcmVzcG9uc2UuZCwgcmVzcG9uc2UuY3R4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciByZXNvbHV0aW9uO1xuICAgICAgICBpZihyZXNwb25zZS5yZXNvbHV0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc29sdXRpb24gPSBuZXcgRVZXRUIyLkNhbWVyYVJlc29sdXRpb24ocmVzcG9uc2UucmVzb2x1dGlvbi53aWR0aCwgcmVzcG9uc2UucmVzb2x1dGlvbi5oZWlnaHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuQ2FtZXJhKHNlcnZlciwgcmVzcG9uc2UuaWQsIHJlc3BvbnNlLmN0eCwgcmVzcG9uc2UubmFtZSwgcHR6LCBkaXNhYmxlZCwgdmlkZW8sXG4gICAgICAgICAgICByZXNwb25zZS5PU0QsIHB0elR5cGUsIHJlc3BvbnNlLmRpZ2l0YWxQdHosIHJlc3BvbnNlLmZvcm1hdHMsIHJlc29sdXRpb24sIHJlc3BvbnNlLnF1YWxpdHksXG4gICAgICAgICAgICByZXNwb25zZS5mcmFtZVJhdGUpO1xuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGNhbGxiYWNrIGZvciB0b3BpYyAnY2FtZXJhcydcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBzdWJzY3JpcHRpb25zIFRoZSBsaXN0IG9mIGF2YWlsYWJsZSBzdWJzY3JpcHRpb25zIGZvciB0aGlzIHRvcGljLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHJlY2VpdmVkIGZvciB0aGlzIHRvcGljLlxuICAgICAqL1xuICAgIHZhciBvbkNhbWVyYUxpc3RDaGFuZ2VkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgICAgICB2YXIgcmVzdWx0TGlzdCA9IGFyZ3NbMF07XG5cbiAgICAgICAgdmFyIHNlcnZlciA9IHN1YnNjcmlwdGlvbnNbMF0uc2VydmVyO1xuICAgICAgICB2YXIgY2FtZXJhTGlzdCA9ICQubWFwKHJlc3VsdExpc3QsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZVRvQ2FtZXJhSW5zdGFuY2UoZWxlbWVudCwgc2VydmVyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBjYW1lcmFMaXN0KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBJbnRlcm5hbCBjYWxsYmFjayBmb3IgdG9waWMgJ3VzZXJzJ1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IHN1YnNjcmlwdGlvbnMgVGhlIGxpc3Qgb2YgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbnMgZm9yIHRoaXMgdG9waWMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgcmVjZWl2ZWQgZm9yIHRoaXMgdG9waWMuXG4gICAgICovXG4gICAgdmFyIG9uVXNlckxpc3RDaGFuZ2VkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgICAgICB2YXIgdXNlcnNMaXN0ID0gYXJnc1swXTtcblxuICAgICAgICB2YXIgc2VydmVyID0gc3Vic2NyaXB0aW9uc1swXS5zZXJ2ZXI7XG5cbiAgICAgICAgdmFyIHVzZXJzID0gJC5tYXAodXNlcnNMaXN0LCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Vc2VyKHNlcnZlciwgZWxlbWVudC5uYW1lLCBlbGVtZW50Lmdyb3VwTmFtZSwgZWxlbWVudC5hY2NvdW50VHlwZSwgZWxlbWVudC5pc09ycGhhbmVkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCB1c2Vycyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICd1c2VyR3JvdXBzJ1xuICAgICAqIEBwYXJhbSB7QXJyYXl9IHN1YnNjcmlwdGlvbnMgVGhlIGxpc3Qgb2YgYXZhaWxhYmxlIHN1YnNjcmlwdGlvbnMgZm9yIHRoaXMgdG9waWMuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgcmVjZWl2ZWQgZm9yIHRoaXMgdG9waWMuXG4gICAgICovXG4gICAgdmFyIG9uVXNlckdyb3VwTGlzdENoYW5nZWQgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3M7XG4gICAgICAgIHZhciBjdXN0b21Hcm91cHNMaXN0ID0gYXJnc1swXTtcblxuICAgICAgICB2YXIgY3VzdG9tVXNlckdyb3VwcyA9ICQubWFwKGN1c3RvbUdyb3Vwc0xpc3QsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBhY2Nlc3NMZXZlbCA9IGVsZW1lbnQucm9sZTtcblxuICAgICAgICAgICAgdmFyIHBlcm1pc3Npb25zID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwucHJvY2Vzc1VzZXJHcm91cFBlcm1pc3Npb25zKGVsZW1lbnQucGVybWlzc2lvbnMpO1xuXG4gICAgICAgICAgICB2YXIgcHJpb3JpdGllcyA9ICQubWFwKGVsZW1lbnQucHJpb3JpdGllcywgZnVuY3Rpb24oZWxlbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlVzZXJHcm91cFByaW9yaXR5KGVsZW0ucHJpb3JpdHksIGVsZW0udmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBjdXN0b21Hcm91cFBlcm1pc3Npb25zID0gbmV3IEVWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zKGVsZW1lbnQuY2FtZXJhcywgZWxlbWVudC5hdWRpb3MsXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXJpYWxzLCBlbGVtZW50LnNvZnRUcmlnZ2Vycyk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlVzZXJHcm91cChlbGVtZW50Lm5hbWUsIGFjY2Vzc0xldmVsLCBwZXJtaXNzaW9ucywgcHJpb3JpdGllcywgZWxlbWVudC5ndWlkLFxuICAgICAgICAgICAgICAgIGN1c3RvbUdyb3VwUGVybWlzc2lvbnMpO1xuICAgICAgICB9KTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIGN1c3RvbVVzZXJHcm91cHMpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGNhbGxiYWNrIGZvciB0b3BpYyAnZGV2aWNlcydcbiAgICAgKiBAcGFyYW0ge0FycmF5fSBzdWJzY3JpcHRpb25zIFRoZSBsaXN0IG9mIGF2YWlsYWJsZSBzdWJzY3JpcHRpb25zIGZvciB0aGlzIHRvcGljLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBkYXRhIHJlY2VpdmVkIGZvciB0aGlzIHRvcGljLlxuICAgICAqL1xuICAgIHZhciBvbkRldmljZUxpc3RDaGFuZ2VkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgICAgICB2YXIgZGV2aWNlcyA9IGFyZ3NbMF07XG5cbiAgICAgICAgdmFyIHNlcnZlciA9IHN1YnNjcmlwdGlvbnNbMF0uc2VydmVyO1xuICAgICAgICB2YXIgZGV2aWNlc0xpc3QgPSAkLm1hcChkZXZpY2VzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgY2FtZXJhSW5mbyA9ICQubWFwKGVsZW1lbnQuY2FtZXJhcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkRldmljZUNvbmZpZ0NhbWVyYUluZm8oZWxlbWVudC5jYW1lcmFJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudENhbWVyYUlkLnRvU3RyaW5nKCksIGVsZW1lbnQubmFtZSwgZWxlbWVudC5pc1ByaW1hcnkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkRldmljZUNvbmZpZyhlbGVtZW50LmlkLCBlbGVtZW50Lm5hbWUsIGVsZW1lbnQuaG9zdCwgZWxlbWVudC5wb3J0LCBlbGVtZW50LnR5cGUsXG4gICAgICAgICAgICAgICAgZWxlbWVudC5tb2RlbCwgZWxlbWVudC5tYWNBZGRyZXNzLCBlbGVtZW50LmZpcm13YXJlLCBlbGVtZW50LmVuYWJsZWQsIGVsZW1lbnQuaXNDb25uZWN0ZWQsXG4gICAgICAgICAgICAgICAgY2FtZXJhSW5mbywgZWxlbWVudC51c2VyLCBzZXJ2ZXIsIGVsZW1lbnQuc2VyaWFsKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBkZXZpY2VzTGlzdCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdjYW1lcmFPc2QnXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25DYW1lcmFPc2RDaGFuZ2VkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgICAgICB2YXIgY2FtZXJhSW5mb3MgPSBhcmdzWzBdO1xuICAgICAgICB2YXIgb3NkSW5mb3MgPSAkLm1hcChjYW1lcmFJbmZvcywgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICB2YXIgb3NkSW5mbyA9IEVWV0VCMi51dGlsLmludGVybmFsLmZvcm1hdE9zZEluZm8oZWxlbWVudC5vc2RJbmZvKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgb3NkSW5mbzogb3NkSW5mbyxcbiAgICAgICAgICAgICAgICBjYW1lcmFJZDogZWxlbWVudC5jYW1lcmFJZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBvc2RJbmZvcyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdzZXJ2ZXInXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25TZXJ2ZXJzVXBkYXRlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBhcmdzWzBdO1xuXG4gICAgICAgIHZhciBzZXJ2ZXJJZCA9IGVsZW1lbnQuaWQ7XG4gICAgICAgIGlmKHNlcnZlcklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNlcnZlcklkID0gc2VydmVySWQudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzZXJ2ZXJJbmZvID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwucHJvY2Vzc1NlcnZlckRldGFpbHMoZWxlbWVudCk7XG4gICAgICAgIHZhciBsaWNlbnNlSW5mbyA9IEVWV0VCMi51dGlsLmludGVybmFsLnByb2Nlc3NTZXJ2ZXJMaWNlbnNlKGVsZW1lbnQpO1xuXG4gICAgICAgIHZhciBjdXN0b21Hcm91cFBlcm1pc3Npb25zO1xuICAgICAgICB2YXIgdXNlckdyb3VwLCBwYXNzdGhyb3VnaEdyb3VwO1xuXG4gICAgICAgIGlmIChlbGVtZW50Lmdyb3VwICE9PSB1bmRlZmluZWQgJiYgZWxlbWVudC5ncm91cCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIGdyb3VwID0gZWxlbWVudC5ncm91cDtcblxuICAgICAgICAgICAgdmFyIGdyb3VwUGVybWlzc2lvbnMgPSBFVldFQjIudXRpbC5pbnRlcm5hbC5wcm9jZXNzVXNlckdyb3VwUGVybWlzc2lvbnMoZ3JvdXAucGVybWlzc2lvbnMpO1xuXG4gICAgICAgICAgICBjdXN0b21Hcm91cFBlcm1pc3Npb25zID0gbmV3IEVWV0VCMi5DdXN0b21Hcm91cFBlcm1pc3Npb25zKGdyb3VwLmNhbWVyYXMsIGdyb3VwLmF1ZGlvcyxcbiAgICAgICAgICAgICAgICBncm91cC5zZXJpYWxzLCBncm91cC5zb2Z0VHJpZ2dlcnMpO1xuICAgICAgICAgICAgdXNlckdyb3VwID0gbmV3IEVWV0VCMi5Vc2VyR3JvdXAoZ3JvdXAubmFtZSwgZ3JvdXAucm9sZSwgZ3JvdXBQZXJtaXNzaW9ucywgZ3JvdXAucHJpb3JpdGllcyxcbiAgICAgICAgICAgICAgICBncm91cC5ndWlkLCBjdXN0b21Hcm91cFBlcm1pc3Npb25zKTtcblxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdXNlckdyb3VwID0gRVZXRUIyLnV0aWwucHJvY2Vzc1NlcnZlclBlcm1pc3Npb25zKGVsZW1lbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFlbGVtZW50LmxvZ2luKXtcbiAgICAgICAgICAgIHBhc3N0aHJvdWdoR3JvdXAgPSB1c2VyR3JvdXA7XG4gICAgICAgICAgICB1c2VyR3JvdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2VydmljZSA9IHN1YnNjcmlwdGlvbnNbMF0uc2VydmVyLnNlcnZpY2U7XG4gICAgICAgIHZhciBzZXNzaW9uSWQgPSBzdWJzY3JpcHRpb25zWzBdLnNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgIHZhciBzZXJ2ZXIgPSBuZXcgRVZXRUIyLlNlcnZlcihzZXJ2aWNlLCBlbGVtZW50Lm5hbWUsIHNlcnZlcklkLCBlbGVtZW50LmxvZ2luLCBlbGVtZW50LnJlc3RyaWN0ZWQsXG4gICAgICAgICAgICBzZXNzaW9uSWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBzZXJ2ZXJJbmZvLCBsaWNlbnNlSW5mbywgdXNlckdyb3VwLCBwYXNzdGhyb3VnaEdyb3VwKTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIHNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdzZXJ2ZXJTdGF0dXMnXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25TZXJ2ZXJTdGF0dXNDaGFuZ2VkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBhcmdzID0gZGF0YS5hcmdzO1xuICAgICAgICB2YXIgc3RhdHVzID0gYXJnc1swXTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIHN0YXR1cyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSW50ZXJuYWwgY2FsbGJhY2sgZm9yIHRvcGljICdhdmdGcmFtZVNpemUnXG4gICAgICogQHBhcmFtIHtBcnJheX0gc3Vic2NyaXB0aW9ucyBUaGUgbGlzdCBvZiBhdmFpbGFibGUgc3Vic2NyaXB0aW9ucyBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSByZWNlaXZlZCBmb3IgdGhpcyB0b3BpYy5cbiAgICAgKi9cbiAgICB2YXIgb25BdmdGcmFtZVNpemUgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3M7XG4gICAgICAgIHZhciBjYW1lcmFJZCA9IGFyZ3NbMF0udG9TdHJpbmcoKTtcbiAgICAgICAgdmFyIGZyYW1lU2l6ZSA9IGFyZ3NbMV07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBjYW1lcmFJZCwgZnJhbWVTaXplKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgb25IMjY0RnJhbWUgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3M7XG4gICAgICAgIHZhciBjYW1lcmFJZCA9IGFyZ3NbMF0udG9TdHJpbmcoKTtcbiAgICAgICAgdmFyIGlzSWZyYW1lID0gYXJnc1sxXTtcbiAgICAgICAgdmFyIHRpbWVzdGFtcCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShhcmdzWzJdKTtcbiAgICAgICAgdmFyIGZsYWdzID0gYXJnc1szXTtcblxuICAgICAgICB2YXIgZnJhbWVEYXRhID0gZGF0YS5ibG9iO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaXB0aW9ucy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zW2ldLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uc1tpXSwgY2FtZXJhSWQsIGZyYW1lRGF0YSwgaXNJZnJhbWUsIHRpbWVzdGFtcCwgZmxhZ3MpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBvbkpQRUdGcmFtZSA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgYXJncyA9IGRhdGEuYXJncztcbiAgICAgICAgdmFyIGNhbWVyYUlkID0gYXJnc1swXS50b1N0cmluZygpO1xuICAgICAgICB2YXIgdGltZXN0YW1wID0gRVZXRUIyLnV0aWwuSUVURjJEYXRlKGFyZ3NbMV0pO1xuICAgICAgICB2YXIgZmxhZ3MgPSBhcmdzWzJdO1xuICAgICAgICB2YXIgZnJhbWVEYXRhID0gZGF0YS5ibG9iO1xuXG4gICAgICAgIC8vdmFyIHZpZXcgPSBuZXcgVWludDhBcnJheShmcmFtZURhdGEpO1xuICAgICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtmcmFtZURhdGFdLCB7dHlwZTogJ2ltYWdlL2pwZWcnfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBjYW1lcmFJZCwgYmxvYiwgdGltZXN0YW1wLCBmbGFncyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIG9uQWNjZXNzQ29udHJvbERldmljZXNVcGRhdGVkID0gZnVuY3Rpb24oc3Vic2NyaXB0aW9ucywgZGF0YSl7XG4gICAgICAgIHZhciBzZXJ2ZXIgPSBzdWJzY3JpcHRpb25zWzBdLnNlcnZlcjtcbiAgICAgICAgdmFyIHJhd0RldmljZXMgPSBkYXRhLmFyZ3NbMF07XG5cbiAgICAgICAgLy8gUHJvY2VzcyB0aGUgZGV2aWNlc1xuICAgICAgICB2YXIgZGV2aWNlcyA9ICQubWFwKHJhd0RldmljZXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlY3VyaXR5SW50ZWdyYXRpb25zRGV2aWNlKHNlcnZlciwgZWxlbWVudC5pZCwgZWxlbWVudC5uYW1lLCBlbGVtZW50Lmhvc3QsIGVsZW1lbnQucG9ydCxcbiAgICAgICAgICAgICAgICBlbGVtZW50LnR5cGUsIGVsZW1lbnQuZW5hYmxlZCwgZWxlbWVudC5jb25uZWN0aW9uU3RhdHVzLCBlbGVtZW50LmZpcm13YXJlLCBlbGVtZW50LnNlcmlhbCxcbiAgICAgICAgICAgICAgICBlbGVtZW50LnVzZXIsIGVsZW1lbnQuYXV0aCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic2NyaXB0aW9ucy5sZW5ndGg7ICsraSl7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb25zW2ldLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uc1tpXSwgZGV2aWNlcyk7XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICB2YXIgb25BY2Nlc3NDb250cm9sU2Vuc29yc1VwZGF0ZWQgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIGRldmljZUlkID0gZGF0YS5hcmdzWzBdO1xuICAgICAgICB2YXIgcmF3U2Vuc29ycyA9IGRhdGEuYXJnc1sxXTtcblxuICAgICAgICAvLyBQcm9jZXNzIHRoZSBzZW5zb3JzXG4gICAgICAgIHZhciBzZW5zb3JzID0gJC5tYXAocmF3U2Vuc29ycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHRpbWVzdGFtcCA9IGVsZW1lbnQuc3RhdHVzVGltZXN0YW1wID9cbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5JRVRGMkRhdGUoZWxlbWVudC5zdGF0dXNUaW1lc3RhbXApIDogdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICB2YXIgcGVyc2lzdGVkU3RhdHVzZXMgPSBlbGVtZW50LnBlcnNpc3RlZFN0YXR1cyA/IGVsZW1lbnQucGVyc2lzdGVkU3RhdHVzLm1hcChmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgICAgIG9iai5zdGF0dXNUaW1lc3RhbXAgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUob2JqLnN0YXR1c1RpbWVzdGFtcCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgICAgIH0pIDogdW5kZWZpbmVkO1xuXG4gICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZWN1cml0eUludGVncmF0aW9uc0RldmljZVNlbnNvcih1bmRlZmluZWQsIGVsZW1lbnQuc2Vuc29ySWQsIGVsZW1lbnQubmFtZSwgZWxlbWVudC50eXBlLFxuICAgICAgICAgICAgICAgIGVsZW1lbnQuZGlyZWN0aW9uLCBlbGVtZW50LmF2YWlsYWJsZUFjdGlvbnMsIGVsZW1lbnQuaW5wdXRzLCBlbGVtZW50LmRlZmF1bHRBY3Rpb25UaW1lb3V0LFxuICAgICAgICAgICAgICAgIGVsZW1lbnQubWF4QWN0aW9uVGltZW91dCwgZWxlbWVudC5zdGF0dXMsIGVsZW1lbnQuYWxhcm0sXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wLCBlbGVtZW50LnN0YXR1c01lc3NhZ2UsIHBlcnNpc3RlZFN0YXR1c2VzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIC8vIFdlIGRvIG5vdCBoYXZlIGEgcmVmZXJlbmNlIHRvIHRoZSBkZXZpY2Ugb2JqZWN0IGZvciBlYWNoIHNlbnNvcixcbiAgICAgICAgICAgIC8vIHVzZXIgaXMgcmVxdWlyZWQgdG8gbG9va3VwIHRoZSBkZXZpY2Ugb2JqZWN0IGFuZCBzZXQgaXQgdGhlbXNlbHZlcy5cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBkZXZpY2VJZCwgc2Vuc29ycyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIG9uQWNjZXNzQ29udHJvbFNlbnNvclN0YXR1c0NoYW5nZWQgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIHNlbnNvclN0YXR1c09iaiA9IGRhdGEuYXJnc1swXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBzZW5zb3JTdGF0dXNPYmopO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBvbkFjY2Vzc0NvbnRyb2xEZXZpY2VDb25uZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMsIGRhdGEpe1xuICAgICAgICB2YXIgZGV2aWNlSWQgPSBkYXRhLmFyZ3NbMF07XG4gICAgICAgIHZhciBkZXZpY2VTdGF0dXMgPSBkYXRhLmFyZ3NbMV07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWJzY3JpcHRpb25zLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbnNbaV0uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb25zW2ldLCBkZXZpY2VJZCwgZGV2aWNlU3RhdHVzKTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIHZhciBvbkFzc29jaWF0aW9uc1VwZGF0ZWQgPSBmdW5jdGlvbihzdWJzY3JpcHRpb25zLCBkYXRhKXtcbiAgICAgICAgdmFyIGFyZ3MgPSBkYXRhLmFyZ3M7XG4gICAgICAgIHZhciBhc3NvY2lhdGlvbnNCeUNhbWVyYUlkID0ge307XG5cbiAgICAgICAgJC5lYWNoKGFyZ3NbMF0sIGZ1bmN0aW9uKGluZGV4LCByYXcpe1xuICAgICAgICAgICAgLy8gUHJvY2VzcyB0aGUgYXNzb2NpYXRpb25zXG4gICAgICAgICAgICB2YXIgYXNzb2NpYXRpb25JdGVtcyA9ICQubWFwKHJhdy5pdGVtcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkFzc29jaWF0aW9uSXRlbShlbGVtZW50LmlkLCBlbGVtZW50LnR5cGUsIGVsZW1lbnQucG9zaXRpb24sIGVsZW1lbnQuc3RhdHVzT25seSxcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHRyYSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIGZvbnRJbmZvID0gbmV3IEVWV0VCMi5Gb250SW5mbyhyYXcuZm9udE5hbWUsIHJhdy5mb250U2l6ZSwgcmF3LmZvbnRTdHlsZSxcbiAgICAgICAgICAgICAgICByYXcuZm9udENvbG9yLCByYXcuZm9udEZhbWlseSwgcmF3LmZvbnRXZWlnaHQpO1xuXG4gICAgICAgICAgICB2YXIgYXNzb2NpYXRpb24gPSBuZXcgRVZXRUIyLkFzc29jaWF0aW9uKHN1YnNjcmlwdGlvbnNbMF0uc2VydmVyLCB1bmRlZmluZWQsIHJhdy5ndWlkLCBhc3NvY2lhdGlvbkl0ZW1zLFxuICAgICAgICAgICAgICAgIHJhdy5sYWJlbCwgcmF3Lm92ZXJsYXlTdHlsZSwgcmF3LnBvc2l0aW9uLCByYXcuYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgIHJhdy5vcGFjaXR5LCBmb250SW5mbyk7XG5cbiAgICAgICAgICAgIGFzc29jaWF0aW9uc0J5Q2FtZXJhSWRbcmF3LmNhbWVyYUlkXSA9IGFzc29jaWF0aW9uO1xuICAgICAgICB9KTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1YnNjcmlwdGlvbnMubGVuZ3RoOyArK2kpe1xuXG4gICAgICAgICAgICBmb3IodmFyIGtleSBpbiBhc3NvY2lhdGlvbnNCeUNhbWVyYUlkKXtcbiAgICAgICAgICAgICAgICBpZiAoYXNzb2NpYXRpb25zQnlDYW1lcmFJZC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYW1lcmFJZCA9IHBhcnNlSW50KGtleSwgMTApO1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBub3QgaGF2ZSBhIHJlZmVyZW5jZSB0byB0aGUgY2FtZXJhIG9iamVjdHMgZm9yIGVhY2ggYXNzb2NpYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZXIgaXMgcmVxdWlyZWQgdG8gbG9va3VwIHRoZSBjYW1lcmEgb2JqZWN0IGFuZCBzZXQgaXQgdGhlbXNlbHZlcy5cbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uc1tpXS5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbnNbaV0sIGNhbWVyYUlkLCBhc3NvY2lhdGlvbnNCeUNhbWVyYUlkW2NhbWVyYUlkXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBpbnRlcm5hbCBjYWxsYmFjayBmdW5jdGlvbnMgYXNzb2NpYXRlZCB3aXRoIGVhY2ggdG9waWMuXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAdHlwZSBPYmplY3RcbiAgICAgKi9cbiAgICB2YXIgaW50ZXJuYWxDYWxsYmFja3MgPSB7XG4gICAgICAgICdudnIuc3RhdHVzLnNvZnR0cmlnZ2Vycyc6IG9uU29mdFRyaWdnZXJVcGRhdGVkLFxuICAgICAgICAnbnZyLnN0YXR1cy5jYW1lcmEubW90aW9uJzogb25Nb3Rpb25DaGFuZ2VkLFxuICAgICAgICAnbnZyLnN0YXR1cy5jYW1lcmEubG9zcyc6IG9uTG9zc0NoYW5nZWQsXG4gICAgICAgICdudnIuY29uZmlnLnVzZXJzLmFjdGl2ZSc6IG9uQWN0aXZlVXNlcnNDaGFuZ2VkLFxuICAgICAgICAnbnZyLnN0YXR1cy5jYW1lcmEuY29ubmVjdGlvbic6IG9uQ29ubmVjdGlvbkNoYW5nZWQsXG4gICAgICAgICdudnIuc3RhdHVzLmRldmljZS5jb25uZWN0aW9uJzogb25Db25uZWN0aW9uQ2hhbmdlZCxcbiAgICAgICAgJ252ci5jb25maWcuY2FtZXJhcyc6IG9uQ2FtZXJhTGlzdENoYW5nZWQsXG4gICAgICAgICdudnIuY29uZmlnLnVzZXJzJzogb25Vc2VyTGlzdENoYW5nZWQsXG4gICAgICAgICdudnIuY29uZmlnLnVzZXJHcm91cHMnOiBvblVzZXJHcm91cExpc3RDaGFuZ2VkLFxuICAgICAgICAnbnZyLmNvbmZpZy5kZXZpY2VzJzogb25EZXZpY2VMaXN0Q2hhbmdlZCxcbiAgICAgICAgJ252ci5jb25maWcuY2FtZXJhcy5zZXR0aW5ncy5vc2QnOiBvbkNhbWVyYU9zZENoYW5nZWQsXG4gICAgICAgICdudnIuY29uZmlnLnBsdWdpbnMnOiBvblBsdWdpbnNDaGFuZ2VkLFxuICAgICAgICAnbnZyLmNvbmZpZy5zZXJ2ZXInOiBvblNlcnZlcnNVcGRhdGVkLFxuICAgICAgICAnbnZyLnN0YXR1cy5zZXJ2ZXInOiBvblNlcnZlclN0YXR1c0NoYW5nZWQsXG4gICAgICAgICdudnIudmlkZW8uY2FtZXJhLnswfS5zdGF0cy5hdmdfZnJhbWVfc2l6ZSc6IG9uQXZnRnJhbWVTaXplLFxuICAgICAgICAnbnZyLnZpZGVvLmNhbWVyYS57MH0ubmF0aXZlJzogb25IMjY0RnJhbWUsXG4gICAgICAgICdudnIudmlkZW8uY2FtZXJhLnswfS5qcGVnJzogb25KUEVHRnJhbWUsXG4gICAgICAgICdudnIuY29uZmlnLnNlY3VyaXR5aW50ZWdyYXRpb25zLmRldmljZXMnOiBvbkFjY2Vzc0NvbnRyb2xEZXZpY2VzVXBkYXRlZCxcbiAgICAgICAgJ252ci5jb25maWcuc2VjdXJpdHlpbnRlZ3JhdGlvbnMuc2Vuc29ycyc6IG9uQWNjZXNzQ29udHJvbFNlbnNvcnNVcGRhdGVkLFxuICAgICAgICAnbnZyLnN0YXR1cy5zZWN1cml0eWludGVncmF0aW9ucy5zZW5zb3JzJzogb25BY2Nlc3NDb250cm9sU2Vuc29yU3RhdHVzQ2hhbmdlZCxcbiAgICAgICAgJ252ci5zdGF0dXMuc2VjdXJpdHlpbnRlZ3JhdGlvbnMuZGV2aWNlcy5jb25uZWN0aW9uJzogb25BY2Nlc3NDb250cm9sRGV2aWNlQ29ubmVjdGlvbkNoYW5nZWQsXG4gICAgICAgICdudnIuY29uZmlnLmFzc29jaWF0aW9ucyc6IG9uQXNzb2NpYXRpb25zVXBkYXRlZFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQZW5kaW5nIHN1YnNjcmliZSByZXF1ZXN0IG9iamVjdCwgdXNlZCB0byBob2xkIHN0YXRlIGluLWJldHdlZW4gc3Vic2NyaWJlIGFuZCBzZXJ2ZXIgYWNrbm93bGVkZ2VtZW50XG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHJlcXVlc3RJZCBUaGUgdW5pcXVlIElEIG9mIHRoZSByZXF1ZXN0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSByZXF1ZXN0LlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0b3BpYyBUaGUgdG9waWMgYXNzb2NpYXRlZCB3aXRoIHRoZSByZXF1ZXN0LlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGludGVybmFsQ2FsbGJhY2sgVGhlIGludGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGV4dGVybmFsQ2FsbGJhY2sgVGhlIGV4dGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgICAqIEBwYXJhbSB7JC5EZWZlcnJlZH0gb25SZXBseSBUaGUgY2FsbGJhY2sgdG8gY2FsbCB3aGVuIGEgc3Vic2NyaXB0aW9uIGlzIGFja25vd2xlZGdlZFxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2Fja25vd2xlZGdlPWZhbHNlXSBGbGFnIGlmIHRoZSB1c2VyIHdhbnRzIHRoZSBzdWJzY3JpYmUgcmVxdWVzdCBhY2tub3dsZWRnZWRcbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAdGhpcyBTdWJzY3JpYmVSZXF1ZXN0XG4gICAgICovXG4gICAgdmFyIFN1YnNjcmliZVJlcXVlc3QgPSBmdW5jdGlvbihyZXF1ZXN0SWQsIHNlcnZlciwgdG9waWMsIGludGVybmFsQ2FsbGJhY2ssIGV4dGVybmFsQ2FsbGJhY2ssIG9uUmVwbHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2tub3dsZWRnZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVW5pcXVlIHJlcXVlc3QgSUQuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlcXVlc3RJZCA9IHJlcXVlc3RJZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2VydmVyIGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcmVxdWVzdC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVG9waWMgb2YgdGhlIHN1YnNjcmlwdGlvbiByZXF1ZXN0LlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3BpYyA9IHRvcGljO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW50ZXJuYWwgY2FsbGJhY2sgZnVuY3Rpb24uXG4gICAgICAgICAqIEBmdW5jdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbnRlcm5hbENhbGxiYWNrID0gaW50ZXJuYWxDYWxsYmFjaztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGV4dGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgICAgICAgKiBAZnVuY3Rpb25cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXh0ZXJuYWxDYWxsYmFjayA9IGV4dGVybmFsQ2FsbGJhY2s7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjYWxsYmFjayB0byBjYWxsIHdoZW4gdGhlIHN1YnNjcmlwdGlvbiBpcyBzdWNjZXNzZnVsbHkgbWFkZS9hY2tub3dsZWRnZWQuXG4gICAgICAgICAqIEB0eXBlIHskLkRlZmVycmVkfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vblJlcGx5ID0gb25SZXBseTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyBmb3IgaWYgdGhlIHN1YnNjcmlwdGlvbiBzaG91bGQgYmUgYWNrbm93bGVkZ2VkIG9uY2UgbWFkZS5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFja25vd2xlZGdlID0gZmFsc2U7XG5cbiAgICAgICAgLy8gQXNzaWduIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihhY2tub3dsZWRnZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHRoaXMuYWNrbm93bGVkZ2UgPSBhY2tub3dsZWRnZTtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIFRoZSBJbnRlcm5hbFN1YnNjcmlwdGlvbiBpcyBhIHBsYWNlaG9sZGVyIGZvciByZWFsIHN1YnNjcmlwdGlvbnMuIEl0IHN0b3JlcyB0aGUgaW50ZXJuYWwgY2FsbGJhY2tzXG4gICAgICogdGhhdCBwcmUtcHJvY2VzcyB0aGUgZGF0YSBiZWZvcmUgZGVsaXZlcmluZyB0aGUgZmluYWwgcHVibGlzaGVkIGV2ZW50IChhcyBFVldFQjIgdHlwZXMpLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIGludGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uIGNhbGxlZCB3aGVuIGFuIGV2ZW50IGlzIHB1Ymxpc2hlZCB0byB0aGUgdG9waWNcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9waWMgVGhlIHRvcGljIG5hbWUgYXNzb2NpYXRlZCB3aXRoIHRoZSBpbnRlcm5hbCBjYWxsYmFja1xuICAgICAqIEBwcml2YXRlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQHRoaXMgSW50ZXJuYWxTdWJzY3JpcHRpb25cbiAgICAgKi9cbiAgICB2YXIgSW50ZXJuYWxTdWJzY3JpcHRpb24gPSBmdW5jdGlvbihoYW5kbGVyLCB0b3BpYyl7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW50ZXJuYWwgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZuID0gaGFuZGxlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRvcGljIHN1YnNjcmliZWQgdG9cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9waWMgPSB0b3BpYztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFycmF5IG9mIGFjdGl2ZSBzdWJzY3JpcHRpb25zIHRoYXQgYXJlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGludGVybmFsIHN1YnNjcmlwdGlvblxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlN1YnNjcmlwdGlvbltdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgfTtcblxuXG4gICAgLyoqXG4gICAgICogVGhlIFN1YnNjcmlwdGlvbiBvYmplY3QgcmVwcmVzZW50cyBhbiBhY3RpdmUgc3Vic2NyaXB0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdWJzY3JpcHRpb25JZCBUaGUgdW5pcXVlIElEIG9mIHRoZSBzdWJzY3JpcHRpb24uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIHN1YnNjcmlwdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdG9waWMgVGhlIHRvcGljIGFzc29jaWF0ZWQgd2l0aCB0aGUgc3Vic2NyaXB0aW9uLlxuICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGV4dGVybmFsQ2FsbGJhY2sgVGhlIGV4dGVybmFsIGNhbGxiYWNrIGZ1bmN0aW9uXG4gICAgICogQGNsYXNzXG4gICAgICogQGRlcHJlY2F0ZWQgV2ViIFNvY2tldCBmdW5jdGlvbmFsaXR5IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgd2ViIEFQSSBpbiA5LjYuMC5cbiAgICAgKiBAY2F0ZWdvcnkgU2VydmljZVxuICAgICAqL1xuICAgIEVWV0VCMi5TdWJzY3JpcHRpb24gPSBmdW5jdGlvbihzdWJzY3JpcHRpb25JZCwgc2VydmVyLCB0b3BpYywgZXh0ZXJuYWxDYWxsYmFjaykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVuaXF1ZSBJRCBvZiB0aGUgc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25JZCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJ2ZXIgaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdWJzY3JpcHRpb24uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb3BpYyBvZiB0aGUgc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50b3BpYyA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZXh0ZXJuYWwgY2FsbGJhY2sgZnVuY3Rpb24uXG4gICAgICAgICAqIEB0eXBlIHtGdW5jdGlvbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXh0ZXJuYWxDYWxsYmFjayA9ICQubm9vcDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmxhZyB0aGF0IGluZGljYXRlcyB0aGUgc3Vic2NyaXB0aW9uIHN0YXRlLCBhbiBhY3RpdmUgc3Vic2NyaXB0aW9uIHdpbGwgcmVjZWl2ZSBwdWJsaWNhdGlvbnNcbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcblxuICAgICAgICAvLyBBc3NpZ24gY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHN1YnNjcmlwdGlvbklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uSWQgPSBzdWJzY3JpcHRpb25JZDtcbiAgICAgICAgfVxuICAgICAgICBpZihzZXJ2ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYodG9waWMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy50b3BpYyA9IHRvcGljO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4dGVybmFsQ2FsbGJhY2sgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5leHRlcm5hbENhbGxiYWNrID0gZXh0ZXJuYWxDYWxsYmFjaztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBhIHVuaXF1ZSByYW5kb20gaWQgZm9yIHByb3RvY29sIHJlcXVlc3RzXG4gICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHVuaXF1ZSBJRFxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgdmFyIGdlbmVyYXRlSWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHV1aWQudjQoKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIGF2YWlsYWJsZSB3ZWJzb2NrZXQgaGFuZGxlciBzdGF0ZXNcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICovXG4gICAgdmFyIHdzU3RhdGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5pdGlhbGl6aW5nXG4gICAgICAgICAqL1xuICAgICAgICBpbml0aWFsaXppbmc6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb25uZWN0ZWRcbiAgICAgICAgICovXG4gICAgICAgIGNvbm5lY3RlZDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlY29ubmVjdGluZ1xuICAgICAgICAgKi9cbiAgICAgICAgcmVjb25uZWN0aW5nOiAyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFRoZSBXZWJzb2NrZXRDb25maWcgb2JqZWN0IGlzIGEgY29udGFpbmVyIGZvciBhbGwgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiByZWxhdGVkIHRvIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2hvc3Q9JyddIFRoZSB3ZWJzb2NrZXQgaG9zdCB1cmxcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvcnQ9MF0gVGhlIHdlYnNvY2tldCBwb3J0XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtzc2xQb3J0PTBdIFRoZSB3ZWJzb2NrZXQgU1NMIHBvcnQgKG9ubHkgdmFsaWQgaWYgdGhlIHNlcnZpY2UgaXMgY29uZmlndXJlZCB0byB1c2UgU1NMKVxuICAgICAqIEBjbGFzc1xuICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuV2Vic29ja2V0Q29uZmlnID0gZnVuY3Rpb24oaG9zdCwgcG9ydCwgc3NsUG9ydCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGhvc3QgdXJsIHRoZSB3ZWJzb2NrZXQgaXMgY29uZmlndXJlZCB0byBjb25uZWN0IHRvXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhvc3QgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvcnQgdGhlIHdlYnNvY2tldCBpcyBjb25maWd1cmVkIHRvIGNvbm5lY3QgdG9cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucG9ydCA9IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBTU0wgcG9ydCB0aGUgd2Vic29ja2V0IGlzIGNvbmZpZ3VyZWQgdG8gY29ubmVjdCB0b1xuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zc2xQb3J0ID0gMDtcblxuICAgICAgICBpZiAoaG9zdCAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIHZhciBiZWdpbklkeCA9IDAsIGVuZElkeCA9IGhvc3QubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGhvc3Quc2xpY2UoMCwgNykgPT09IFwiaHR0cDovL1wiKXtcbiAgICAgICAgICAgICAgICBiZWdpbklkeCA9IDc7XG4gICAgICAgICAgICB9ZWxzZSBpZiAoaG9zdC5zbGljZSgwLCA4KSA9PT0gXCJodHRwczovL1wiKXtcbiAgICAgICAgICAgICAgICBiZWdpbklkeCA9IDg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihob3N0LnNsaWNlKC0xKSA9PT0gXCIvXCIpe1xuICAgICAgICAgICAgICAgIC0tZW5kSWR4O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmhvc3QgPSBob3N0LnNsaWNlKGJlZ2luSWR4LCBlbmRJZHgpO1xuXG4gICAgICAgICAgICBpZih0aGlzLmhvc3QgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3N0ID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBvcnQgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNzbFBvcnQgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICB0aGlzLnNzbFBvcnQgPSBzc2xQb3J0O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBmb3JtYXR0ZWQgVVJMIHVzZWQgdG8gY29ubmVjdCBhIFdlYlNvY2tldCBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0VXJsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09PSBcImh0dHBzOlwiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3NzOi8vXCIgKyB0aGlzLmhvc3QgKyBcIjpcIiArIHRoaXMuc3NsUG9ydDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwid3M6Ly9cIiArIHRoaXMuaG9zdCArIFwiOlwiICsgdGhpcy5wb3J0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBFbnVtIG9mIHR5cGUgb2YgY29ubmVjdGlvbiBldmVudHMgZm9yIHdlYnNvY2tldHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAZGVwcmVjYXRlZCBXZWIgU29ja2V0IGZ1bmN0aW9uYWxpdHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3ZWIgQVBJIGluIDkuNi4wLlxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLmNvbm5lY3Rpb25FdmVudCA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5cbiAgICAgICAgICovXG4gICAgICAgIG9wZW46IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaW1lZCBvdXRcbiAgICAgICAgICovXG4gICAgICAgIHRpbWVkT3V0OiAxXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEVudW0gdmFsdWVzIGRlbm90aW5nIHN0YXRlIG9mIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvblxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICovXG4gICAgdmFyIHJlYWR5U3RhdGVzID0ge1xuICAgICAgICBjb25uZWN0aW5nOiAwLFxuICAgICAgICBvcGVuOiAxLFxuICAgICAgICBjbG9zaW5nOiAyLFxuICAgICAgICBjbG9zZWQ6IDNcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIFdlYlNvY2tldEhhbmRsZXIgb2JqZWN0IHJlY2VpdmVzIGFsbCB3ZWJzb2NrZXQgY29tbXVuaWNhdGlvbiBmcm9tIHRoZSBzZXJ2aWNlIGVuZC4gSXQgaW5pdGlhdGVzIGEgY29ubmVjdGlvblxuICAgICAqIGFuZCBzdWJzY3JpYmVzIHRvIGluY29taW5nIG1lc3NhZ2VzIGZyb20gdGhlIHNlcnZpY2UuIEl0IHRoZW4gcGFyc2VzIHRoZXNlIG1lc3NhZ2VzIHRvIGtub3duXG4gICAgICogRVZXRUIyIHR5cGVzIGFuZCBwdWJsaXNoZXMgdGhlbS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2aWNlfSBbc2VydmljZT1udWxsXSBUaGUgc2VydmljZSBpbnN0YW5jZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAZGVwcmVjYXRlZCBXZWIgU29ja2V0IGZ1bmN0aW9uYWxpdHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3ZWIgQVBJIGluIDkuNi4wLlxuICAgICAqIEBjYXRlZ29yeSBTZXJ2aWNlXG4gICAgICovXG4gICAgRVZXRUIyLldlYlNvY2tldEhhbmRsZXIgPSBmdW5jdGlvbihzZXJ2aWNlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPYmplY3QgdG8gZGV0ZXJtaW5lIGlmIGxlZ2FjeSB3ZWJzb2NrZXRzIGFyZSBiZWluZyB1c2VkLlxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0xlZ2FjeSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgc2VydmljZSBpbnN0YW5jZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2aWNlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHdoZW4gY29tbXVuaWNhdGluZyB3aXRoIHRoZSBzZXJ2aWNlXG4gICAgICAgICAqIEB0eXBlIHtDb21wb3NpdGVTZXJpYWxpemVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gbmV3IEVWV0VCMi5Db21wb3NpdGVTZXJpYWxpemVyKCk7XG5cbiAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGVuZGluZyBzdWJzY3JpcHRpb24gcmVxdWVzdHMsIGluZGV4ZWQgYnkgcmVxdWVzdCBpZFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7U3Vic2NyaWJlUmVxdWVzdH1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBwZW5kaW5nU3Vic2NyaWJlUmVxdWVzdHMgPSB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQWN0aXZlIHN1YnNjcmlwdGlvbnMsIGluZGV4ZWQgYnkgdG9waWNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TdWJzY3JpcHRpb259XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgYWN0aXZlU3Vic2NyaXB0aW9ucyA9IHt9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQZW5kaW5nIHVuLXN1YnNjcmliZSByZXF1ZXN0cywgaW5kZXhlZCBieSByZXF1ZXN0IGlkXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtVbnN1YnNjcmliZVJlcXVlc3R9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcGVuZGluZ1Vuc3Vic2NyaWJlUmVxdWVzdHMgPSB7fTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIFdlYlNvY2tldCBpbnN0YW5jZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7V2ViU29ja2V0fVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHNvY2sgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3RvcmVkIHVzZXIgY2FsbGJhY2sgdG8gY2FsbCB3aGVuIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbiBpcyBvcGVuIG9yIHRpbWVkIG91dC5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICogQGZ1bmN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICB2YXIgb25Db25uZWN0aW9uQ2FsbGJhY2sgPSAkLm5vb3A7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZsYWcgaW5kaWNhdGluZyBpZiB3ZSBoYXZlIGFscmVhZHkgY2FsbGVkIHRoZSBvcGVuIGNhbGxiYWNrIHNvIGl0IGlzbid0IGNhbGxlZCB0d2ljZVxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBvbk9wZW5DYWxsZWQgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHdlYnNvY2tldCBoYW5kbGVyXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHt3c1N0YXRlc31cbiAgICAgICAgICovXG4gICAgICAgIHZhciBzdGF0ZSA9IHdzU3RhdGVzLmluaXRpYWxpemluZztcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FjaGVkIHdlYnNvY2tldCBjb25maWdcbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5XZWJzb2NrZXRDb25maWd9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgd3NDb25maWcgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2xvdCB0aW1lIChkaXNjcmV0ZSBkZWxheSBpbmNyZW1lbnRzKSB0byBmZWVkIGludG8gZXhwb25lbnRpYWwgYmFja29mZiBhbGdvcml0aG1cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHZhciByZWNvbm5lY3RTbG90VGltZSA9IDAuMDEyNTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG51bWJlciBvZiByZWNvbm5lY3QgYXR0ZW1wdHMgdGhhdCBoYXZlIGJlZW4gbWFkZVxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHJlY29ubmVjdEF0dGVtcHRzID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogY29uc3RyYWludCBmb3IgdGhlIGV4cG9uZW50aWF0aW9uIHRlcm0gdG8gZ2l2ZSB0aGUgZGVzaXJlZCBtYXggZGVsYXkgb2YgfjEwIHNlY29uZHNcbiAgICAgICAgICpcbiAgICAgICAgICogRm9sbG93cyB0aGUgZm9sbG93aW5nIGZvcm11bGFcbiAgICAgICAgICogICAgICAoMl5jLTEpKnJlY29ubmVjdFNsb3RUaW1lID0gRGVzaXJlZE1heERlbGF5XG4gICAgICAgICAqICAgICAgYyA9IGxuKChEZXNpcmVkTWF4RGVsYXkgLyByZWNvbm5lY3RTbG90VGltZSkgKyAxKSAvIGxuKDIpXG4gICAgICAgICAqXG4gICAgICAgICAqIE5PVEU6IGRlc2lyZWQgbWF4IGRlbGF5IGV4cHJlc3NlZCBpbiBtcyBmb3IgdXNlIHdpdGggc2V0VGltZW91dFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIG1heFJlY29ubmVjdEF0dGVtcHRzID0gMTkuNztcblxuICAgICAgICB2YXIgdGltZW91dEhhbmRsZSA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCb29sZWFuIGZsYWcgaW5kaWNhdGluZyBpZiB0aGUgc2V0IHRpbWVvdXQgd2FzIHJlYWNoZWQuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGNvbm5lY3Rpb25UaW1lb3V0ID0gZmFsc2U7XG5cbiAgICAgICAgLy8gQXNzaWduIHRoZSB2YWx1ZXNcbiAgICAgICAgaWYoc2VydmljZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNlcnZpY2UgPSBzZXJ2aWNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlLXN1YnNjcmliZS9yZS1pbml0aWFsaXplIHRoZSBjdXJyZW50IHNldCBvZiBzdWJzY3JpcHRpb25zIGFmdGVyIGEgcmVjb25uZWN0LlxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIHJlc3Vic2NyaWJlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBFVldFQjIubG9nKFwiUmUtaW5pdGlhbGl6aW5nIGN1cnJlbnRseSBhY3RpdmUgc3Vic2NyaXB0aW9uc1wiKTtcbiAgICAgICAgICAgIC8vIGNsZWFyIGFjdGl2ZSBzdWJzY3JpcHRpb25zXG4gICAgICAgICAgICB2YXIgY3VycmVudEFjdGl2ZSA9ICQuZXh0ZW5kKHRydWUsIHt9LCBhY3RpdmVTdWJzY3JpcHRpb25zKTtcbiAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnMgPSB7fTtcblxuICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGFjdGl2ZSBzdWJzY3JpcHRpb25zIGFuZCByZS1zdWJzY3JpYmVcbiAgICAgICAgICAgICQuZWFjaChjdXJyZW50QWN0aXZlLCBmdW5jdGlvbih0b3BpYywgaW50ZXJuYWxTdWJzY3JpcHRpb24pe1xuICAgICAgICAgICAgICAgICQuZWFjaChpbnRlcm5hbFN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbihpZHgsIHN1YnNjcmlwdGlvbil7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0SWQgPSBnZW5lcmF0ZUlkKCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvblJlcGx5ID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBwZW5kaW5nIHJlcXVlc3RcbiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1N1YnNjcmliZVJlcXVlc3RzW3JlcXVlc3RJZF0gPSBuZXcgU3Vic2NyaWJlUmVxdWVzdChyZXF1ZXN0SWQsIHN1YnNjcmlwdGlvbi5zZXJ2ZXIsIHRvcGljLFxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJuYWxTdWJzY3JpcHRpb24uZm4sIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrLCBvblJlcGx5LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIGEgc3Vic2NyaWJlIHByb3RvY29sIG1lc3NhZ2UgdG8gdGhlIHNlcnZlciB3aXRoIHRoZSBvcmlnaW5hbCBzdWJzY3JpcHRpb24gaWRcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IG5ldyBQcm90b2NvbEhlYWRlcihyZXF1ZXN0SWQsIHRvcGljLCBwcm90b2NvbE1lc3NhZ2VUeXBlLnN1YnNjcmliZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBQcm90b2NvbEZsYWdzKHRydWUsIGluc3RhbmNlLnNlcmlhbGl6ZXIuaXNCaW5hcnkpKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNjcmliZU1zZyA9IG5ldyBTdWJzY3JpYmVNZXNzYWdlKGhlYWRlciwgc3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbklkKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBheWxvYWQgPSBpbnN0YW5jZS5zZXJpYWxpemVyLnNlcmlhbGl6ZShzdWJzY3JpYmVNc2cubWFyc2hhbCgpKTtcblxuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc29jay5zZW5kKHBheWxvYWQpO1xuICAgICAgICAgICAgICAgICAgICB9Y2F0Y2goZXJyb3Ipe1xuICAgICAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZyhcIkVycm9yIHRyeWluZyB0byByZXN1YnNjcmliZTogXCIgKyBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgcGVuZGluZ1N1YnNjcmliZVJlcXVlc3RzW3JlcXVlc3RJZF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsYmFjayBmb3IgdGhlICdvbm9wZW4nIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbiBpcyBlc3RhYmxpc2hlZFxuICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIHRoZSB3ZWJzb2NrZXQgZXZlbnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBvbk9wZW4gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBFVldFQjIubG9nKFwiV2Vic29ja2V0SGFuZGxlcjo6b25PcGVuXCIpO1xuXG4gICAgICAgICAgICBpZighb25PcGVuQ2FsbGVkKXtcbiAgICAgICAgICAgICAgICBvbkNvbm5lY3Rpb25DYWxsYmFjayhFVldFQjIuY29ubmVjdGlvbkV2ZW50Lm9wZW4pO1xuICAgICAgICAgICAgICAgIG9uT3BlbkNhbGxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHN0YXRlID09PSB3c1N0YXRlcy5yZWNvbm5lY3RpbmcpIHtcbiAgICAgICAgICAgICAgICAvLyByZXNldFxuICAgICAgICAgICAgICAgIHJlY29ubmVjdEF0dGVtcHRzID0gMDtcbiAgICAgICAgICAgICAgICByZXN1YnNjcmliZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzdGF0ZSA9IHdzU3RhdGVzLmNvbm5lY3RlZDtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQ2FsbGJhY2sgZm9yIHRoZSAnb25tZXNzYWdlJyBldmVudCwgZmlyZWQgd2hlbiB0aGUgd2Vic29ja2V0IHJlY2VpdmVzIGEgbWVzc2FnZVxuICAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIHRoZSB3ZWJzb2NrZXQgZXZlbnRcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBvbk1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgcGF5bG9hZCA9IGUuZGF0YTtcbiAgICAgICAgICAgIHZhciBtc2cgPSBpbnN0YW5jZS5zZXJpYWxpemVyLnVuc2VyaWFsaXplKHBheWxvYWQpO1xuXG4gICAgICAgICAgICBzd2l0Y2gobXNnLmhlYWRlci5yZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSBwcm90b2NvbE1lc3NhZ2VUeXBlLnN1YnNjcmliZWQ6XG4gICAgICAgICAgICAgICAgICAgIGlmKHBlbmRpbmdTdWJzY3JpYmVSZXF1ZXN0c1ttc2cuaGVhZGVyLnJpZF0gPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHBlbmRpbmdTdWJzY3JpYmVSZXF1ZXN0c1ttc2cuaGVhZGVyLnJpZF07XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwZW5kaW5nU3Vic2NyaWJlUmVxdWVzdHNbbXNnLmhlYWRlci5yaWRdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChhY3RpdmVTdWJzY3JpcHRpb25zW21zZy5oZWFkZXIudG9waWNdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZVN1YnNjcmlwdGlvbnNbbXNnLmhlYWRlci50b3BpY10gPSBuZXcgSW50ZXJuYWxTdWJzY3JpcHRpb24ocmVxdWVzdC5pbnRlcm5hbENhbGxiYWNrLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cuaGVhZGVyLnRvcGljKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBuZXcgRVZXRUIyLlN1YnNjcmlwdGlvbihtc2cucGF5bG9hZC5zdWJzY3JpcHRpb25JZCwgcmVxdWVzdC5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cuaGVhZGVyLnRvcGljLCByZXF1ZXN0LmV4dGVybmFsQ2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmVTdWJzY3JpcHRpb25zW21zZy5oZWFkZXIudG9waWNdLnN1YnNjcmlwdGlvbnMucHVzaChzdWJzY3JpcHRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhhbmRsZSBhY2tub3dsZWRnZVxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uUmVwbHkucmVzb2x2ZShzdWJzY3JpcHRpb24pO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgcHJvdG9jb2xNZXNzYWdlVHlwZS5wdWJsaXNoOlxuICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZXJuYWxTdWJzY3JpcHRpb24gPSBhY3RpdmVTdWJzY3JpcHRpb25zW21zZy5oZWFkZXIudG9waWNdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnRlcm5hbFN1YnNjcmlwdGlvbiA9PT0gdW5kZWZpbmVkIHx8IGludGVybmFsU3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbnMubGVuZ3RoID09PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGludGVybmFsU3Vic2NyaXB0aW9uLmZuKGludGVybmFsU3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbnMsIG1zZy5wYXlsb2FkLmRhdGEpO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgcHJvdG9jb2xNZXNzYWdlVHlwZS51bnN1YnNjcmliZWQ6XG4gICAgICAgICAgICAgICAgICAgIGlmKHBlbmRpbmdVbnN1YnNjcmliZVJlcXVlc3RzW21zZy5oZWFkZXIucmlkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgdW5zdWJzY3JpYmVSZXF1ZXN0ID0gcGVuZGluZ1Vuc3Vic2NyaWJlUmVxdWVzdHNbbXNnLmhlYWRlci5yaWRdO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcGVuZGluZ1Vuc3Vic2NyaWJlUmVxdWVzdHNbbXNnLmhlYWRlci5yaWRdO1xuXG4gICAgICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlUmVxdWVzdC5zdWJzY3JpcHRpb24uaXNBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdW5zdWJzY3JpYmVSZXF1ZXN0Lm9uQWNrbm93bGVkZ2UucmVzb2x2ZSh1bnN1YnNjcmliZVJlcXVlc3Quc3Vic2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdCA6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGRlbGF5IHRvIHVzZSBiZWZvcmUgYXR0ZW1wdGluZyB0byByZWNvbm5lY3RcbiAgICAgICAgICogQHJldHVybnMge251bWJlcn0gVGhlIGNhbGN1bGF0ZWQgZGVsYXlcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBjYWxjdWxhdGVOZXh0UmVjb25uZWN0RGVsYXkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGV4cG9uZW50aWFsIGJhY2tvZmYgd2l0aCBtYXggdGhyZXNob2xkXG4gICAgICAgICAgICAvLyB3YWl0IGJldHdlZW4gWzAsIDJeYy0xKSBzbG90IHRpbWVzXG4gICAgICAgICAgICAvLyBmaXJzdCBhdHRlbXB0IDAgb3IgMSBzbG90cywgc2Vjb25kIGF0dGVtcHQgMC0zIHNsb3RzLCBldGNcbiAgICAgICAgICAgIHZhciBleHBvbmVudCA9IE1hdGgubWluKHJlY29ubmVjdEF0dGVtcHRzLCBtYXhSZWNvbm5lY3RBdHRlbXB0cyk7XG4gICAgICAgICAgICB2YXIgbWF4U2xvdHMgPSBNYXRoLnBvdygyLCBleHBvbmVudCkgLSAxO1xuXG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIG1heFNsb3RzKSkgKiByZWNvbm5lY3RTbG90VGltZTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vIG5vdCB1c2VkIGJ5IHNvY2tqc1xuICAgICAgICAgICAgRVZXRUIyLmxvZyhcIldlYnNvY2tldEhhbmRsZXI6Om9uRXJyb3I6IFwiICsgZS5yZWFzb24pO1xuICAgICAgICB9O1xuXHRcdFxuXHRcdC8vIEZvcndhcmQgIGRlY2xhcmluZyBkdWUgdG8gY2lyY3VsYXIgZGVwZW5kZW5jaWVzXG5cdFx0dmFyIG9uQ2xvc2U7XG5cdFx0XG5cdFx0LyoqXG4gICAgICAgICAqIEluaXRpYWxpemUgYW5kIGJpbmQgYSBXZWJTb2NrZXQgY29ubmVjdGlvblxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5XZWJzb2NrZXRDb25maWd9IGNvbmZpZyBUaGUgd2Vic29ja2V0IGNvbmZpZ3VyYXRpb25cbiAgICAgICAgICovXG4gICAgICAgIHZhciBpbml0U29jayA9IGZ1bmN0aW9uKGNvbmZpZykge1xuICAgICAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5nZXRVcmwoKTtcbiAgICAgICAgICAgIEVWV0VCMi5sb2coXCJJbml0aWFsaXppbmcgV2ViU29ja2V0OiBcIiArIHVybCk7XG4gICAgICAgICAgICBzb2NrID0gbmV3IFdlYlNvY2tldCh1cmwpO1xuICAgICAgICAgICAgLy8gYmluZCB0aGUgY2FsbGJhY2tzXG4gICAgICAgICAgICBzb2NrLm9ub3BlbiA9IG9uT3BlbjtcbiAgICAgICAgICAgIHNvY2sub25tZXNzYWdlID0gb25NZXNzYWdlO1xuICAgICAgICAgICAgc29jay5vbmNsb3NlID0gb25DbG9zZTtcbiAgICAgICAgICAgIHNvY2sub25lcnJvciA9IG9uRXJyb3I7XG4gICAgICAgICAgICBzb2NrLmJpbmFyeVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XG4gICAgICAgIH07XG5cdFx0XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsYmFjayBmb3IgdGhlICdvbm1jbG9zZScgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHdlYnNvY2tldCBjb25uZWN0aW9uIGlzIGxvc3QgKG9yIGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZClcbiAgICAgICAgICogQHBhcmFtIHtFdmVudH0gZSB0aGUgd2Vic29ja2V0IGV2ZW50XG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICBvbkNsb3NlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgRVZXRUIyLmxvZyhcIldlYnNvY2tldEhhbmRsZXI6Om9uQ2xvc2U6IHJlYXNvbj1cIiArIGUucmVhc29uICsgXCIsIGNvZGU9XCIgKyBlLmNvZGUgK1xuICAgICAgICAgICAgICAgIFwiLCB3YXNDbGVhbj1cIiArIGUud2FzQ2xlYW4pO1xuXG4gICAgICAgICAgICAvLyBzd2l0Y2ggc3RhdGVzIGFuZCBhdHRlbXB0IHJlY29ubmVjdGlvbiB3aXRoIGV4cG9uZW50aWFsIGJhY2tvZmZcbiAgICAgICAgICAgIHN0YXRlID0gd3NTdGF0ZXMucmVjb25uZWN0aW5nO1xuXG4gICAgICAgICAgICBpZihjb25uZWN0aW9uVGltZW91dCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG5leHRSZWNvbm5lY3RBdHRlbXB0ID0gY2FsY3VsYXRlTmV4dFJlY29ubmVjdERlbGF5KCk7XG4gICAgICAgICAgICBFVldFQjIubG9nKFwiUmVjb25uZWN0IGF0dGVtcHRzOiBcIiArIHJlY29ubmVjdEF0dGVtcHRzICsgXCIsIHJlY29ubmVjdGluZyBpbiBcIiArIG5leHRSZWNvbm5lY3RBdHRlbXB0KTtcblxuICAgICAgICAgICAgcmVjb25uZWN0QXR0ZW1wdHMgKz0gMTtcbiAgICAgICAgICAgIHRpbWVvdXRIYW5kbGUgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGluaXRTb2NrKHdzQ29uZmlnKTtcbiAgICAgICAgICAgIH0sIG5leHRSZWNvbm5lY3RBdHRlbXB0KTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmUgdGhlIHdlYnNvY2tldCBjb25maWd1cmF0aW9uIGluZm9ybWF0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0byBjYWxsIHdoZW4gdGhlIHJlc3BvbnNlIGNvbXBsZXRlcy4gVGhlIGNhbGxiYWNrIGlzIHBhc3NlZFxuICAgICAgICAgKiBhbiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aXRoIHRoZSBkZXRhaWxzIG9mIHRoZSByZXNwb25zZSBhbmQgKG9uIHN1Y2Nlc3MpIGFuIGluc3RhbmNlIG9mXG4gICAgICAgICAqIHtAbGluayBFVldFQjIuV2Vic29ja2V0Q29uZmlnfS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0Q29uZmlnID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2sgcmVxdWlyZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB3ZWJzb2NrZXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25HZXRDb25maWdFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCAnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRDb25maWdTdWNjZXNzID0gZnVuY3Rpb24oZGF0YSAvKiwgdGV4dFN0YXR1cywgeGhyKi8pe1xuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcywgZGF0YS5lcnJvclRleHQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGhvc3RVcmwgPSB3ZWJzb2NrZXQuc2VydmljZS5ob3N0VXJsO1xuICAgICAgICAgICAgICAgIGlmKGhvc3RVcmwuc3Vic3RyKGhvc3RVcmwubGVuZ3RoIC0gMSkgIT09IFwiL1wiKXtcbiAgICAgICAgICAgICAgICAgICAgaG9zdFVybCA9IGhvc3RVcmwuc2xpY2UoMCwgaG9zdFVybC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHdlYnNvY2tldENvbmZpZyA9IG5ldyBFVldFQjIuV2Vic29ja2V0Q29uZmlnKGhvc3RVcmwsIGRhdGEucG9ydCwgZGF0YS5zc2xQb3J0KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgd2Vic29ja2V0Q29uZmlnKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldENvbmZpZ1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0Q29uZmlnRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiB3ZWJzb2NrZXQuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmJyb2tlckNvbmZpZyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7fVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYod2Vic29ja2V0LnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIHdlYnNvY2tldC5zZXJ2aWNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb25Db25uZWN0aW9uVGltZW91dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc29jayAhPT0gdW5kZWZpbmVkICYmIHNvY2sucmVhZHlTdGF0ZSA9PT0gcmVhZHlTdGF0ZXMuY29ubmVjdGluZykge1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25UaW1lb3V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZih0aW1lb3V0SGFuZGxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SGFuZGxlKTtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dEhhbmRsZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9uQ29ubmVjdGlvbkNhbGxiYWNrKEVWV0VCMi5jb25uZWN0aW9uRXZlbnQudGltZWRPdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBpbml0aWF0ZXMgYSB3ZWJzb2NrZXQgY29ubmVjdGlvbiB3aXRoIHRoZSBXZWJTb2NrZXQgc2VydmVyLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuV2Vic29ja2V0Q29uZmlnfSBjb25maWcgVGhlIGNvbmZpZ3VyYXRpb24gaW5mb3JtYXRpb24gZm9yIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvblxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW3RpbWVvdXRdIE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3Igd2Vic29ja2V0IGNvbm5lY3Rpb24gdG8gYmUgb3BlbmVkXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbihjYWxsYmFjaywgY29uZmlnLCB0aW1lb3V0KSB7XG4gICAgICAgICAgICBpZih0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvbkNvbm5lY3Rpb25DYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChvbkNvbm5lY3Rpb25UaW1lb3V0LCB0aW1lb3V0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgd3NDb25maWcgPSBjb25maWc7XG4gICAgICAgICAgICBpbml0U29jayh3c0NvbmZpZyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFN1YnNjcmliZXMgdG8gd2Vic29ja2V0IG1lc3NhZ2VzIGFuZCByb3V0ZXMgdGhlIGV2ZW50IHBheWxvYWQgdG8gdGhlIGFwcHJvcHJpYXRlIGNhbGxiYWNrcy5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIucHViU3ViVG9waWN9IHRvcGljIFRoZSB0b3BpYyB0byBzdWJzY3JpYmUgdG8uXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBzdWJzY3JpcHRpb24uXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXIgVGhlIGNhbGxiYWNrIHJlc3BvbnNpYmxlIGZvciBoYW5kbGluZyBldmVudHMgcHVibGlzaGVkIHRvIHRoZSBnaXZlbiB0b3BpY1xuICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIEFkZGl0aW9uYWwgYXZhaWxhYmxlIG9wdGlvbnMuXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFtpZHM9W11dIGlkcyBpcyBhbiBhcnJheSBvZiBlaXRoZXIgRVZXRUIyIHR5cGVzIG9yIHN0cmluZ3MuIFRoZSBpZHMgcmVxdWlyZWQgYnkgYSB0b3BpY1xuICAgICAgICAgKiBhcmUgZG9jdW1lbnRlZCBhcyBwYXJ0IG9mIGVhY2gge0BsaW5rIEVWV0VCMi5wdWJTdWJUb3BpY30gdG9waWMuXG4gICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEVWV0VCMi5TdWJzY3JpcHRpb24sIEVWV0VCMi5SZXNwb25zZVN0YXR1cz59IEEgcHJvbWlzZSB0aGF0IHJldHVybnMgdGhlIG5ldyBzdWJzY3JpcHRpb25cbiAgICAgICAgICogaW5zdGFuY2UgdG8gdGhlIGNhbGxlciB3aGVuIHJlc29sdmVkLCBvciBhbiB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSB3aGVuIHJlamVjdGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdWJzY3JpYmUgPSBmdW5jdGlvbih0b3BpYywgc2VydmVyLCBoYW5kbGVyLCBvcHRpb25zLCBpZHMpIHtcbiAgICAgICAgICAgIHZhciB3ZWJzb2NrZXQgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25SZXBseSA9ICQuRGVmZXJyZWQoKTtcbiAgICAgICAgICAgIHZhciByZXNwb25zZTtcbiAgICAgICAgICAgIGlmIChzb2NrID09PSBudWxsKXtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIFwiV2ViU29ja2V0IHN1cHBvcnQgaXMgbm90IGVuYWJsZWQuXCIsIEVWV0VCMi53ZWJzb2NrZXRFcnJvckNvZGVzLmRpc2FibGVkKTtcbiAgICAgICAgICAgICAgICBvblJlcGx5LnJlamVjdChyZXNwb25zZSwgdG9waWMsIHNlcnZlciwgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9uUmVwbHkucHJvbWlzZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoc3RhdGUgPT09IHdzU3RhdGVzLnJlY29ubmVjdGluZyl7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcIlN1YnNjcmliZSBmYWlsZWQuIENvbm5lY3Rpb24gbG9zdC5cIiwgRVZXRUIyLndlYnNvY2tldEVycm9yQ29kZXMuY29ubmVjdGlvbkxvc3QpO1xuICAgICAgICAgICAgICAgIG9uUmVwbHkucmVqZWN0KHJlc3BvbnNlLCB0b3BpYywgc2VydmVyLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb25SZXBseS5wcm9taXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRvcGljID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIlRyeWluZyB0byBzdWJzY3JpYmUgdG8gdW5rbm93biBFVldFQjIucHViU3ViVG9waWM6IFwiICsgdG9waWMsXG4gICAgICAgICAgICAgICAgICAgICAgICBFVldFQjIud2Vic29ja2V0RXJyb3JDb2Rlcy51bmtub3duVG9waWMpO1xuICAgICAgICAgICAgICAgIG9uUmVwbHkucmVqZWN0KHJlc3BvbnNlLCB0b3BpYywgc2VydmVyLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb25SZXBseS5wcm9taXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghc2VydmVyLmlzUGFzc3Rocm91Z2hTZXJ2ZXIoKSAmJiAhc2VydmVyLmlzTG9nZ2VkSW4oKSl7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcIlN1YnNjcmliZSBmYWlsZWQuIFNlcnZlciBsb2dpbiByZXF1aXJlZC5cIiwgRVZXRUIyLndlYnNvY2tldEVycm9yQ29kZXMubG9naW5SZXF1aXJlZCk7XG4gICAgICAgICAgICAgICAgb25SZXBseS5yZWplY3QocmVzcG9uc2UsIHRvcGljLCBzZXJ2ZXIsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvblJlcGx5LnByb21pc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHRvcGljTmFtZSA9IHRvcGljLnJhd1RvcGljU3RyO1xuICAgICAgICAgICAgdmFyIGludGVybmFsQ2FsbGJhY2sgPSBpbnRlcm5hbENhbGxiYWNrc1t0b3BpY05hbWVdO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRvIGEgcHJvdG9jb2wgbWVzc2FnZVxuICAgICAgICAgICAgdmFyIHJlcXVlc3RJZCA9IGdlbmVyYXRlSWQoKTtcbiAgICAgICAgICAgIHZhciBzZXNzaW9uVG9waWMgPSB0b3BpY05hbWUgKyAnLicgKyBzZXJ2ZXIuc2Vzc2lvbklkO1xuICAgICAgICAgICAgaWYoaWRzICE9PSB1bmRlZmluZWQgJiYgaWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uVG9waWMgPSBmb3JtYXRUb3BpYyh0b3BpYywgaWRzKSArICcuJyArIHNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGFja25vd2xlZGdlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYWNrbm93bGVkZ2UgPSBvcHRpb25zLmFja25vd2xlZGdlID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG9wdGlvbnMuYWNrbm93bGVkZ2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHN0b3JlIHRoZSBzdWJzY3JpYmUgcmVxdWVzdFxuICAgICAgICAgICAgcGVuZGluZ1N1YnNjcmliZVJlcXVlc3RzW3JlcXVlc3RJZF0gPSBuZXcgU3Vic2NyaWJlUmVxdWVzdChyZXF1ZXN0SWQsIHNlcnZlciwgc2Vzc2lvblRvcGljLFxuICAgICAgICAgICAgICAgIGludGVybmFsQ2FsbGJhY2ssIGhhbmRsZXIsIG9uUmVwbHksIGFja25vd2xlZGdlKTtcblxuICAgICAgICAgICAgdmFyIGZsYWdzID0gbmV3IFByb3RvY29sRmxhZ3MoYWNrbm93bGVkZ2UsIHdlYnNvY2tldC5zZXJpYWxpemVyLmlzQmluYXJ5KTtcbiAgICAgICAgICAgIHZhciBoZWFkZXIgPSBuZXcgUHJvdG9jb2xIZWFkZXIocmVxdWVzdElkLCBzZXNzaW9uVG9waWMsIHByb3RvY29sTWVzc2FnZVR5cGUuc3Vic2NyaWJlLCBmbGFncyk7XG4gICAgICAgICAgICB2YXIgc3Vic2NyaWJlTXNnID0gbmV3IFN1YnNjcmliZU1lc3NhZ2UoaGVhZGVyKTtcbiAgICAgICAgICAgIHZhciBwYXlsb2FkID0gd2Vic29ja2V0LnNlcmlhbGl6ZXIuc2VyaWFsaXplKHN1YnNjcmliZU1zZy5tYXJzaGFsKCkpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNvY2suc2VuZChwYXlsb2FkKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAgICAgRVZXRUIyLmxvZyhcInN1YnNjcmliZSBmYWlsZWQ6IFwiICsgZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIFwiU3Vic2NyaWJlIGZhaWxlZC4gVW5hYmxlIHRvIHNlbmQgc2VydmVyIHJlcXVlc3QuXCIsIEVWV0VCMi53ZWJzb2NrZXRFcnJvckNvZGVzLnNlbmRGYWlsZWQpO1xuICAgICAgICAgICAgICAgIG9uUmVwbHkucmVqZWN0KHJlc3BvbnNlLCB0b3BpYywgc2VydmVyLCBoYW5kbGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb25SZXBseS5wcm9taXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBhIGRlZmVycmVkIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aGVuIHRoZSBzdWJzY3JpcHRpb24gaXMgbWFkZVxuICAgICAgICAgICAgcmV0dXJuIG9uUmVwbHkucHJvbWlzZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHVuc3Vic2NyaWJlIGZyb20gYW4gZXhpc3Rpbmcgc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TdWJzY3JpcHRpb259IHN1YnNjcmlwdGlvbiBBbiBleGlzdGluZyBzdWJzY3JpcHRpb24gaW5zdGFuY2VcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbYWNrbm93bGVkZ2U9dHJ1ZV0gQSBmbGFnIGluZGljYXRpbmcgaWYgYWNrbm93bGVkZ2VtZW50IGlzIHJlcXVlc3RlZCB3aGVuXG4gICAgICAgICAqIHRoZSByZXF1ZXN0IGNvbXBsZXRlc1xuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxFVldFQjIuU3Vic2NyaXB0aW9uLCBFVldFQjIuUmVzcG9uc2VTdGF0dXM+fSBBIHByb21pc2UgdGhhdCByZXR1cm5zIHRoZSBzdWJzY3JpcHRpb25cbiAgICAgICAgICogaW5zdGFuY2UgKG5vdyBpbmFjdGl2ZSkgYmFjayB0byB0aGUgY2FsbGVyIHdoZW4gcmVzb2x2ZWQsIG9yIGFuIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlXG4gICAgICAgICAqIGlmIHJlamVjdGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbiwgYWNrbm93bGVkZ2UpIHtcbiAgICAgICAgICAgIGlmKGFja25vd2xlZGdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBhY2tub3dsZWRnZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgb25VbnN1YnNjcmliZWQgPSAkLkRlZmVycmVkKCk7XG5cbiAgICAgICAgICAgIHZhciBpbnRlcm5hbFN1YnNjcmlwdGlvbiA9IGFjdGl2ZVN1YnNjcmlwdGlvbnNbc3Vic2NyaXB0aW9uLnRvcGljXTtcbiAgICAgICAgICAgIHZhciByZXNwb25zZTtcbiAgICAgICAgICAgIGlmIChpbnRlcm5hbFN1YnNjcmlwdGlvbiA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIFwidW5zdWJzY3JpYmUgZmFpbGVkLCBubyBhY3RpdmUgc3Vic2NyaXB0aW9ucyBmb3VuZCBmb3IgdG9waWM6IFwiICsgc3Vic2NyaXB0aW9uLnRvcGljLFxuICAgICAgICAgICAgICAgICAgICBFVldFQjIud2Vic29ja2V0RXJyb3JDb2Rlcy51bmtub3duVG9waWMpO1xuICAgICAgICAgICAgICAgIG9uVW5zdWJzY3JpYmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9uVW5zdWJzY3JpYmVkLnByb21pc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHN0YXRlID09PSB3c1N0YXRlcy5yZWNvbm5lY3Rpbmcpe1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgXCJ1bnN1YnNjcmliZSBmYWlsZWQsIG5vdCBjb25uZWN0ZWRcIiwgRVZXRUIyLndlYnNvY2tldEVycm9yQ29kZXMuY29ubmVjdGlvbkxvc3QpO1xuICAgICAgICAgICAgICAgIG9uVW5zdWJzY3JpYmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9uVW5zdWJzY3JpYmVkLnByb21pc2UoKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAtMTtcblxuICAgICAgICAgICAgdmFyIHN1YiA9ICQuZ3JlcChpbnRlcm5hbFN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbihlbGVtLCBpKXtcbiAgICAgICAgICAgICAgIGlmKGVsZW0uc3Vic2NyaXB0aW9uSWQgPT09IHN1YnNjcmlwdGlvbi5zdWJzY3JpcHRpb25JZCkge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmKHN1Yi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIFwidW5zdWJzY3JpYmUgZmFpbGVkLCB1bmtub3duIHN1YnNjcmlwdGlvbiBJRDogXCIgKyBzdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi53ZWJzb2NrZXRFcnJvckNvZGVzLnVua25vd25TdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIG9uVW5zdWJzY3JpYmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9uVW5zdWJzY3JpYmVkLnByb21pc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBzdWJzY3JpcHRpb24gZnJvbSB0aGUgYWN0aXZlIHN1YnNjcmlwdGlvbnNcbiAgICAgICAgICAgIGludGVybmFsU3Vic2NyaXB0aW9uLnN1YnNjcmlwdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICAgICAgaWYoaW50ZXJuYWxTdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBsYXN0IHN1YnNjcmlwdGlvbiB0byB0aGlzIHRvcGljLCBjb21wbGV0ZWx5IHVuc3Vic2NyaWJlIGZyb20gdGhlIHNlcnZlclxuICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0SWQgPSBnZW5lcmF0ZUlkKCk7XG4gICAgICAgICAgICAgICAgdmFyIGZsYWdzID0gbmV3IFByb3RvY29sRmxhZ3MoYWNrbm93bGVkZ2UsIGluc3RhbmNlLnNlcmlhbGl6ZXIuaXNCaW5hcnkpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkZXIgPSBuZXcgUHJvdG9jb2xIZWFkZXIocmVxdWVzdElkLCBpbnRlcm5hbFN1YnNjcmlwdGlvbi50b3BpYyxcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2xNZXNzYWdlVHlwZS51bnN1YnNjcmliZSwgZmxhZ3MpO1xuICAgICAgICAgICAgICAgIHZhciB1bnN1YnNjcmliZU1zZyA9IG5ldyBVbnN1YnNjcmliZU1lc3NhZ2UoaGVhZGVyLCBzdWJzY3JpcHRpb24uc3Vic2NyaXB0aW9uSWQpO1xuICAgICAgICAgICAgICAgIHZhciBwYXlsb2FkID0gaW5zdGFuY2Uuc2VyaWFsaXplci5zZXJpYWxpemUodW5zdWJzY3JpYmVNc2cubWFyc2hhbCgpKTtcblxuICAgICAgICAgICAgICAgIHRyeXtcbiAgICAgICAgICAgICAgICAgICAgc29jay5zZW5kKHBheWxvYWQpO1xuICAgICAgICAgICAgICAgIH1jYXRjaChlKXtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZyhcInVuc3Vic2NyaWJlIGZhaWxlZDogXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVuc3Vic2NyaWJlIGZhaWxlZCwgdW5hYmxlIHRvIHNlbmQgc2VydmVyIHJlcXVlc3RcIiwgRVZXRUIyLndlYnNvY2tldEVycm9yQ29kZXMuc2VuZEZhaWxlZCk7XG4gICAgICAgICAgICAgICAgICAgIG9uVW5zdWJzY3JpYmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvblVuc3Vic2NyaWJlZC5wcm9taXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZGVsZXRlIGFjdGl2ZVN1YnNjcmlwdGlvbnNbc3Vic2NyaXB0aW9uLnRvcGljXTtcblxuICAgICAgICAgICAgICAgIHBlbmRpbmdVbnN1YnNjcmliZVJlcXVlc3RzW3JlcXVlc3RJZF0gPSBuZXcgVW5zdWJzY3JpYmVSZXF1ZXN0KHN1YnNjcmlwdGlvbiwgb25VbnN1YnNjcmliZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgb25VbnN1YnNjcmliZWQucmVzb2x2ZShzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gb25VbnN1YnNjcmliZWQucHJvbWlzZSgpO1xuICAgICAgICB9O1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlLCB1dWlkOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgb2YgYWxsIGxlZ2FjeSBoYW5kbGluZyBmdW5jdGlvbnMuICBFYWNoIGZ1bmN0aW9uIHBlcmZvcm1zIHRoZSB0cmFkaXRpb25hbCBwb2xsaW5nIG1ldGhvZFxuICAgICAqIGFuZCBmb3JtYXRzIHRoZSByZXNwb25zZSBpbnRvIHRoZSB3ZWIgc29ja2V0cyByZXNwb25zZSBzaWduYXR1cmUuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgdmFyIGxlZ2FjeUhhbmRsZXJzID0ge307XG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlcnZlci5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBzZXJ2ZXJzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPSBzZXJ2ZXJzO1xuXG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldFNlcnZlciA9ICQuZ3JlcChzZXJ2ZXJzLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcblxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRTZXJ2ZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdUYXJnZXQgc2VydmVyIHJlbW92ZWQgZnJvbSBsaXN0OicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCB0YXJnZXRTZXJ2ZXIpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgIG9uQ2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKSwgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuc2VydmljZS5nZXRTZXJ2ZXJzKG9uQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMuc2VydmVyU3RhdHVzLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgZm46IGZ1bmN0aW9uIChjYWxsYmFjaywgc3Vic2NyaXB0aW9uLCB0b3BpYy8qLCBvcHRpb25zLCBpZHMqLykge1xuICAgICAgICAgICAgdmFyIG9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goc3RhdHVzKTtcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIHN0YXR1cy5zZXJ2ZXJTdGF0dXMpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIC8vIFNlZSBpZiB0aGUgY2FjaGVkIGRhdGEgaXMgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIXN1YnNjcmlwdGlvbi5zZXJ2ZXIuaXNMb2dnZWRJbigpICYmICFzdWJzY3JpcHRpb24uc2VydmVyLmlzUGFzc3Rocm91Z2hTZXJ2ZXIoKSkge1xuICAgICAgICAgICAgICAgIC8vIFdlJ2xsIGp1c3QgYmUgbWFraW5nIGFuIGVtcHR5IHJlcXVlc3RcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0U2VydmVyU3RhdHVzKG9uQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMuZGV2aWNlcy5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBkZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGRldmljZXMnIHNlcnZlcnNcbiAgICAgICAgICAgICAgICAkLmVhY2goZGV2aWNlcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXJ2ZXIgPSBzdWJzY3JpcHRpb24uc2VydmVyO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIGRldmljZXM6IGRldmljZXNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZGV2aWNlcyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEuZGV2aWNlcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uc2VydmVyLmNvbmZpZ3VyYXRpb24uZ2V0RGV2aWNlc0NvbmZpZ3VyYXRpb24ob25DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy5jYW1lcmFPc2QucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgY2FtZXJhcykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIG9zZEluZm9zID0gJC5tYXAoY2FtZXJhcywgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvc2RJbmZvID0gRVZXRUIyLnV0aWwuaW50ZXJuYWwuZm9ybWF0T3NkSW5mbyhlbGVtZW50Lm9zZEluZm8pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3NkSW5mbzogb3NkSW5mbyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYUlkOiBlbGVtZW50LmNhbWVyYUlkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgb3NkSW5mb3M6IG9zZEluZm9zXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBvc2RJbmZvcyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhY2hlZERhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZiAoY2FjaGVkRGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGNhY2hlZERhdGEub3NkSW5mb3MpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXRDYW1lcmFzT3NkU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEuY2FtZXJhKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkdldENhbWVyYXNPc2RFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0Q2FtZXJhc09zZFN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0Q2FtZXJhc09zZEVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc3Vic2NyaXB0aW9uLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMubGVnYWN5V2Vic29ja2V0Q2FtZXJhc09zZCxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMudXNlcnMucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgdXNlcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZygnTGVnYWN5IHN1YnNjcmlwdGlvbiBmYWlsZWQ6JywgdG9waWMsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgdXNlcnMnIHNlcnZlcnNcbiAgICAgICAgICAgICAgICAkLmVhY2godXNlcnMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VydmVyID0gc3Vic2NyaXB0aW9uLnNlcnZlcjtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY2FjaGVkIGRhdGFcbiAgICAgICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICB1c2VyczogdXNlcnNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgdXNlcnMpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLnVzZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0VXNlcnMob25DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy51c2VyR3JvdXBzLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgZm46IGZ1bmN0aW9uIChjYWxsYmFjaywgc3Vic2NyaXB0aW9uLCB0b3BpYy8qLCBvcHRpb25zLCBpZHMqLykge1xuICAgICAgICAgICAgdmFyIG9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzcG9uc2UsIGdyb3Vwcykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwczogZ3JvdXBzXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGdyb3Vwcyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEuZ3JvdXBzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0VXNlckdyb3VwcyhvbkNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLmNhbWVyYXMucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgY2FtZXJhcykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBjYW1lcmFzJyBzZXJ2ZXJzXG4gICAgICAgICAgICAgICAgJC5lYWNoKGNhbWVyYXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2VydmVyID0gc3Vic2NyaXB0aW9uLnNlcnZlcjtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY2FjaGVkIGRhdGFcbiAgICAgICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICBjYW1lcmFzOiBjYW1lcmFzXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGNhbWVyYXMpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLmNhbWVyYXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnNlcnZlci5nZXRDYW1lcmFzKG9uQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMuYWN0aXZlVXNlcnMucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgdXNhZ2VJbmZvKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgdXNhZ2VJbmZvOiB1c2FnZUluZm9cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIHVzYWdlSW5mbyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEudXNhZ2VJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0U3lzdGVtVXNhZ2VJbmZvKG9uQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMudHJpZ2dlcnMucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgc3RvcmU6IFtdLFxuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICAvLyBUcmlnZ2VycyBleHBlY3RzIHVwZGF0ZXMgb2YgaW5kaXZpZHVhbCB0cmlnZ2VycyB0aGF0IGhhdmUgY2hhbmdlZCBzdGF0ZS5cbiAgICAgICAgICAgIC8vIEFzIHN1Y2gsIHN0b3JlIHRoZSBlbnRpcmUgdHJpZ2dlciBsaXN0IGFuZCBub3RpZnkgb25seSBvbiB0aG9zZSB0aGF0XG4gICAgICAgICAgICAvLyBoYXZlIGNoYW5nZWQuXG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgbmV3VHJpZ2dlcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZygnTGVnYWN5IHN1YnNjcmlwdGlvbiBmYWlsZWQ6JywgdG9waWMsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSBsZWdhY3lIYW5kbGVyc1t0b3BpY10uc3RvcmU7XG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZVRyaWdnZXJzU3RvcmUgPSAkLmdyZXAoc3RvcmUsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmKHNvdXJjZVRyaWdnZXJzU3RvcmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VUcmlnZ2Vyc1N0b3JlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcnM6IG5ld1RyaWdnZXJzXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLnB1c2goc291cmNlVHJpZ2dlcnNTdG9yZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRUcmlnZ2VycyA9ICQuZ3JlcChuZXdUcmlnZ2VycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ1RyaWdnZXIgPSAkLmdyZXAoc291cmNlVHJpZ2dlcnNTdG9yZS50cmlnZ2VycywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5pZCA9PT0gZWxlbWVudC5pZDtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmKG9yaWdUcmlnZ2VyID09PSB1bmRlZmluZWQgfHwgb3JpZ1RyaWdnZXIuc3RhdGUgIT09IGVsZW1lbnQuc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IG9yaWdUcmlnZ2VyLm5hbWUgIT09IGVsZW1lbnQubmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzb3VyY2VUcmlnZ2Vyc1N0b3JlLnRyaWdnZXJzID0gbmV3VHJpZ2dlcnM7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2godXBkYXRlZFRyaWdnZXJzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJzOiB1cGRhdGVkVHJpZ2dlcnNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICQuZ3JlcChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBjYWNoZWQgZGF0YSBmb3IgdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLnRyaWdnZXJzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBFVldFQjIuZ2V0VHJpZ2dlcnMob25DYWxsYmFjaywgc3Vic2NyaXB0aW9uLnNlcnZlcik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLm1vdGlvbi5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICBzdG9yZTogW10sXG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIC8vIE1vdGlvbiBleHBlY3RzIHVwZGF0ZXMgb2YgaW5kaXZpZHVhbCBjYW1lcmFzIHRoYXQgaGF2ZSBjaGFuZ2VkIHN0YXRlLlxuICAgICAgICAgICAgLy8gQXMgc3VjaCwgc3RvcmUgdGhlIGVudGlyZSBjYW1lcmEgc3RhdHVzIGxpc3QgYW5kIG5vdGlmeSBvbmx5IG9uIHRob3NlIHRoYXRcbiAgICAgICAgICAgIC8vIGhhdmUgY2hhbmdlZC5cbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBuZXdDYW1lcmFzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gbGVnYWN5SGFuZGxlcnNbdG9waWNdLnN0b3JlO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VDYW1lcmFzU3RvcmUgPSAkLmdyZXAoc3RvcmUsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmKHNvdXJjZUNhbWVyYXNTdG9yZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUNhbWVyYXNTdG9yZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYXM6IG5ld0NhbWVyYXNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUucHVzaChzb3VyY2VDYW1lcmFzU3RvcmUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVkQ2FtZXJhcyA9ICQuZ3JlcChuZXdDYW1lcmFzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmlnQ2FtZXJhID0gJC5ncmVwKHNvdXJjZUNhbWVyYXNTdG9yZS5jYW1lcmFzLCBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmlkID09PSBlbGVtZW50LmlkO1xuICAgICAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYob3JpZ0NhbWVyYSA9PT0gdW5kZWZpbmVkIHx8IG9yaWdDYW1lcmEuc3RhdHVzLm1vdGlvbiAhPT0gZWxlbWVudC5zdGF0dXMubW90aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNvdXJjZUNhbWVyYXNTdG9yZS5jYW1lcmFzID0gbmV3Q2FtZXJhcztcblxuICAgICAgICAgICAgICAgICQuZWFjaCh1cGRhdGVkQ2FtZXJhcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBlbGVtZW50LmlkLCBlbGVtZW50LnN0YXR1cy5tb3Rpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYXM6IG5ld0NhbWVyYXNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBjYWNoZWREYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlZERhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGNhY2hlZERhdGEuY2FtZXJhcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZWxlbWVudC5pZCwgZWxlbWVudC5zdGF0dXMubW90aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldFN0YXR1c1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLmNhbWVyYSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRTdGF0dXNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIHM6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuc2Vzc2lvbklkXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uR2V0U3RhdHVzU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25HZXRTdGF0dXNFcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmxlZ2FjeVdlYnNvY2tldFN0YXR1cyxcbiAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0dFVCdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy5sb3NzLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgZGF0YTogW10sXG4gICAgICAgIHN0b3JlOiBbXSxcbiAgICAgICAgZm46IGZ1bmN0aW9uIChjYWxsYmFjaywgc3Vic2NyaXB0aW9uLCB0b3BpYy8qLCBvcHRpb25zLCBpZHMqLykge1xuICAgICAgICAgICAgLy8gTG9zcyBleHBlY3RzIHVwZGF0ZXMgb2YgaW5kaXZpZHVhbCBjYW1lcmFzIHRoYXQgaGF2ZSBjaGFuZ2VkIHN0YXRlLlxuICAgICAgICAgICAgLy8gQXMgc3VjaCwgc3RvcmUgdGhlIGVudGlyZSBjYW1lcmEgc3RhdHVzIGxpc3QgYW5kIG5vdGlmeSBvbmx5IG9uIHRob3NlIHRoYXRcbiAgICAgICAgICAgIC8vIGhhdmUgY2hhbmdlZC5cbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBuZXdDYW1lcmFzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gbGVnYWN5SGFuZGxlcnNbdG9waWNdLnN0b3JlO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VDYW1lcmFzU3RvcmUgPSAkLmdyZXAoc3RvcmUsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmKHNvdXJjZUNhbWVyYXNTdG9yZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZUNhbWVyYXNTdG9yZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbWVyYXM6IG5ld0NhbWVyYXNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUucHVzaChzb3VyY2VDYW1lcmFzU3RvcmUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciB1cGRhdGVkQ2FtZXJhcyA9ICQuZ3JlcChuZXdDYW1lcmFzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvcmlnQ2FtZXJhID0gJC5ncmVwKHNvdXJjZUNhbWVyYXNTdG9yZS5jYW1lcmFzLCBmdW5jdGlvbihlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmlkID09PSBlbGVtZW50LmlkO1xuICAgICAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICAgICAgaWYob3JpZ0NhbWVyYSA9PT0gdW5kZWZpbmVkIHx8IG9yaWdDYW1lcmEuc3RhdHVzLmxvc3MgIT09IGVsZW1lbnQuc3RhdHVzLmxvc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc291cmNlQ2FtZXJhc1N0b3JlLmNhbWVyYXMgPSBuZXdDYW1lcmFzO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKHVwZGF0ZWRDYW1lcmFzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGVsZW1lbnQuaWQsIGVsZW1lbnQuc3RhdHVzLmxvc3MpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYXM6IG5ld0NhbWVyYXNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBjYWNoZWREYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlZERhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGNhY2hlZERhdGEuY2FtZXJhcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZWxlbWVudC5pZCwgZWxlbWVudC5zdGF0dXMubG9zcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgb25HZXRTdGF0dXNTdWNjZXNzID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIG9uQ2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKSwgZGF0YS5jYW1lcmEpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uR2V0U3RhdHVzRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIG9uQ2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICBzOiBzdWJzY3JpcHRpb24uc2VydmVyLnNlc3Npb25JZFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvbkdldFN0YXR1c1N1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uR2V0U3RhdHVzRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBzdWJzY3JpcHRpb24uc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5sZWdhY3lXZWJzb2NrZXRTdGF0dXMsXG4gICAgICAgICAgICAgICAgZGF0YTogcGFyYW1zLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMucGx1Z2lucy5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBwbHVnaW5zTGlzdCkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbnNMaXN0OiBwbHVnaW5zTGlzdFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgcGx1Z2luc0xpc3QpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLnBsdWdpbnNMaXN0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0U3lzdGVtUGx1Z2luSW5mbyhvbkNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMuZGV2aWNlQ29ubmVjdGlvbi5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICBzdG9yZTogW10sXG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIC8vIGRldmljZUNvbm5lY3Rpb24gZXhwZWN0cyB1cGRhdGVzIG9mIGluZGl2aWR1YWwgZGV2aWNlcyB0aGF0IGhhdmUgY2hhbmdlZCBzdGF0ZS5cbiAgICAgICAgICAgIC8vIEFzIHN1Y2gsIHN0b3JlIHRoZSBlbnRpcmUgZGV2aWNlcyBsaXN0IGFuZCBub3RpZnkgb25seSBvbiB0aG9zZSB0aGF0XG4gICAgICAgICAgICAvLyBoYXZlIGNoYW5nZWQuXG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgbmV3RGV2aWNlcykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gbGVnYWN5SGFuZGxlcnNbdG9waWNdLnN0b3JlO1xuICAgICAgICAgICAgICAgIHZhciBzb3VyY2VEZXZpY2VzU3RvcmUgPSAkLmdyZXAoc3RvcmUsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmKHNvdXJjZURldmljZXNTdG9yZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNvdXJjZURldmljZXNTdG9yZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldmljZXM6IG5ld0RldmljZXNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUucHVzaChzb3VyY2VEZXZpY2VzU3RvcmUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgdXBkYXRlZERldmljZXMgPSAkLmdyZXAobmV3RGV2aWNlcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3JpZ0RldmljZSA9ICQuZ3JlcChzb3VyY2VEZXZpY2VzU3RvcmUuZGV2aWNlcywgZnVuY3Rpb24oZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5pZCA9PT0gZWxlbWVudC5pZDtcbiAgICAgICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmKG9yaWdEZXZpY2UgPT09IHVuZGVmaW5lZCB8fCBvcmlnRGV2aWNlLmNvbm5lY3Rpb25TdGF0dXMgIT09IGVsZW1lbnQuY29ubmVjdGlvblN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzb3VyY2VEZXZpY2VzU3RvcmUuZGV2aWNlcyA9IG5ld0RldmljZXM7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2godXBkYXRlZERldmljZXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZWxlbWVudC5pZCwgZWxlbWVudC5jb25uZWN0aW9uU3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY2FjaGVkIGRhdGFcbiAgICAgICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2VzOiB1cGRhdGVkRGV2aWNlc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEuZGV2aWNlcywgZnVuY3Rpb24oaW5kZXgsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZWxlbWVudC5pZCwgZWxlbWVudC5jb25uZWN0aW9uU3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uc2VydmVyLmNvbmZpZ3VyYXRpb24uZ2V0RGV2aWNlc0NvbmZpZ3VyYXRpb24ob25DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLmNhbWVyYUNvbm5lY3Rpb24ucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgc3RvcmU6IFtdLFxuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICAvLyBjYW1lcmFDb25uZWN0aW9uIGV4cGVjdHMgdXBkYXRlcyBvZiBpbmRpdmlkdWFsIGRldmljZXMgdGhhdCBoYXZlIGNoYW5nZWQgc3RhdGUuXG4gICAgICAgICAgICAvLyBBcyBzdWNoLCBzdG9yZSB0aGUgZW50aXJlIGRldmljZXMgbGlzdCBhbmQgbm90aWZ5IG9ubHkgb24gdGhvc2UgdGhhdFxuICAgICAgICAgICAgLy8gaGF2ZSBjaGFuZ2VkLlxuICAgICAgICAgICAgdmFyIG9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzcG9uc2UsIG5ld0NhbWVyYXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZygnTGVnYWN5IHN1YnNjcmlwdGlvbiBmYWlsZWQ6JywgdG9waWMsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdG9yZSA9IGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5zdG9yZTtcbiAgICAgICAgICAgICAgICB2YXIgc291cmNlQ2FtZXJhc1N0b3JlID0gJC5ncmVwKHN0b3JlLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcbiAgICAgICAgICAgICAgICBpZihzb3VyY2VDYW1lcmFzU3RvcmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzb3VyY2VDYW1lcmFzU3RvcmUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW1lcmFzOiBuZXdDYW1lcmFzXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHN0b3JlLnB1c2goc291cmNlQ2FtZXJhc1N0b3JlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRDYW1lcmFzID0gJC5ncmVwKG5ld0NhbWVyYXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWdDYW1lcmEgPSAkLmdyZXAoc291cmNlQ2FtZXJhc1N0b3JlLmNhbWVyYXMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWwuaWQgPT09IGVsZW1lbnQuaWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZihvcmlnQ2FtZXJhID09PSB1bmRlZmluZWQgfHwgb3JpZ0NhbWVyYS5jb25uZWN0aW9uU3RhdHVzICE9PSBlbGVtZW50LmNvbm5lY3Rpb25TdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc291cmNlQ2FtZXJhc1N0b3JlLmNhbWVyYXMgPSBuZXdDYW1lcmFzO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKHVwZGF0ZWRDYW1lcmFzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGVsZW1lbnQuaWQsIGVsZW1lbnQuY29ubmVjdGlvblN0YXR1cyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhczogdXBkYXRlZENhbWVyYXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICQuZ3JlcChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBjYWNoZWQgZGF0YSBmb3IgdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChkYXRhLmNhbWVyYXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGVsZW1lbnQuaWQsIGVsZW1lbnQuY29ubmVjdGlvblN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnNlcnZlci5jb25maWd1cmF0aW9uLmdldERldmljZXNDb25maWd1cmF0aW9uKG9uQ2FsbGJhY2spO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy5hdmdGcmFtZVNpemUucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLCBvcHRpb25zLCBpZHMpIHtcbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSBpZHNbMF07XG5cbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBmcmFtZVNpemUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZygnTGVnYWN5IHN1YnNjcmlwdGlvbiBmYWlsZWQ6JywgdG9waWMsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIGNhbWVyYUlkOiBjYW1lcmEuaWQsXG4gICAgICAgICAgICAgICAgICAgIGZyYW1lU2l6ZTogZnJhbWVTaXplXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBjYW1lcmEuaWQsIGZyYW1lU2l6ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZCAmJiBlbGVtZW50LmNhbWVyYUlkID09PSBjYW1lcmEuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLmZyYW1lU2l6ZSwgZGF0YS5jYW1lcmFJZCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYW1lcmEuY29uZmlnLmdldEF2ZXJhZ2VGcmFtZVNpemUob25DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlY3VyaXR5SW50ZWdyYXRpb25EZXZpY2VzLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgc3RvcmU6IFtdLFxuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgZGV2aWNlcykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN0b3JlID0gbGVnYWN5SGFuZGxlcnNbdG9waWNdLnN0b3JlO1xuICAgICAgICAgICAgICAgIHZhciBkZXZpY2VTdG9yZSA9ICQuZ3JlcChzdG9yZSwgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgICAgICBpZihkZXZpY2VTdG9yZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRldmljZVN0b3JlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlczogZGV2aWNlc1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBzdG9yZS5wdXNoKGRldmljZVN0b3JlKTtcbiAgICAgICAgICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgZGV2aWNlIGxpc3RcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlU3RvcmUuZGV2aWNlcyA9IGRldmljZXM7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlczogZGV2aWNlc1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBkZXZpY2VzKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICQuZ3JlcChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICAgICAgaWYgKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGNhY2hlZCBkYXRhIGZvciB0aGUgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLmRldmljZXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnNlcnZlci5nZXRTZWN1cml0eUludGVncmF0aW9uc0RldmljZXMob25DYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlY3VyaXR5SW50ZWdyYXRpb25TZW5zb3JzLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgZm46IGZ1bmN0aW9uIChjYWxsYmFjaywgc3Vic2NyaXB0aW9uLCB0b3BpYy8qLCBvcHRpb25zLCBpZHMqLykge1xuICAgICAgICAgICAgdmFyIG9uQ2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzcG9uc2UsIHNlbnNvcnMpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLmxvZygnTGVnYWN5IHN1YnNjcmlwdGlvbiBmYWlsZWQ6JywgdG9waWMsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgY2FjaGVkIGRhdGFcbiAgICAgICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXI6IHN1YnNjcmlwdGlvbi5zZXJ2ZXIsXG4gICAgICAgICAgICAgICAgICAgIHNlbnNvcnM6IHNlbnNvcnNcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChzZW5zb3JzLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGV2aWNlSWQgPSBzZW5zb3JzWzBdLmRldmljZS5pZDtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBkZXZpY2VJZCwgc2Vuc29ycyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEuc2Vuc29ycyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldERldmljZXMgPSBmdW5jdGlvbihyZXNwb25zZSwgZGV2aWNlcyl7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKXtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQuZWFjaChkZXZpY2VzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmdldFNlbnNvcnMob25DYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBhdHRlbXB0IHRvIHVzZSBjYWNoZWQgZGV2aWNlc1xuICAgICAgICAgICAgdmFyIGRldmljZVN0b3JlID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy5zZWN1cml0eUludGVncmF0aW9uRGV2aWNlcy5yYXdUb3BpY1N0cl0uc3RvcmUsXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oZWxlbWVudCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcblxuICAgICAgICAgICAgaWYgKGRldmljZVN0b3JlID09PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zZXJ2ZXIuZ2V0U2VjdXJpdHlJbnRlZ3JhdGlvbnNEZXZpY2VzKG9uR2V0RGV2aWNlcyk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIG9uR2V0RGV2aWNlcyhyZXNwb25zZSwgZGV2aWNlU3RvcmUuZGV2aWNlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgbGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlY3VyaXR5SW50ZWdyYXRpb25TZW5zb3JTdGF0dXMucmF3VG9waWNTdHJdID0ge1xuICAgICAgICBmbjogZnVuY3Rpb24gKGNhbGxiYWNrLCBzdWJzY3JpcHRpb24sIHRvcGljLyosIG9wdGlvbnMsIGlkcyovKSB7XG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgc2Vuc29ycykge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICBFVldFQjIubG9nKCdMZWdhY3kgc3Vic2NyaXB0aW9uIGZhaWxlZDonLCB0b3BpYywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgc2Vuc29yczogc2Vuc29yc1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1c09iamVjdHMgPSAkLm1hcChzZW5zb3JzLCBmdW5jdGlvbihvYmope1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQ6IG9iai5kZXZpY2UuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5zb3JJZDogb2JqLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBvYmouc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgYWxhcm06IG9iai5hbGFybSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c01lc3NhZ2U6IG9iai5zdGF0dXNNZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGltZXN0YW1wOiBFVldFQjIudXRpbC5EYXRlMklFVEYob2JqLnN0YXR1c1RpbWVzdGFtcClcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIENhbGwgZXh0ZXJuYWwgY2FsbGJhY2sgd2l0aCBlYWNoIHN0YXR1c09ialxuICAgICAgICAgICAgICAgICQuZWFjaChzdGF0dXNPYmplY3RzLCBmdW5jdGlvbihpbmRleCwgZWxlbWVudCl7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5leHRlcm5hbENhbGxiYWNrKHN1YnNjcmlwdGlvbiwgZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gYXR0ZW1wdCB0byB1c2UgY2FjaGVkIGRhdGFcbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBjYWNoZWQgZGF0YSBmb3IgdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIG9uQ2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKSwgZGF0YS5zZW5zb3JzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbWFrZSB0aGUgcmVxdWVzdChzKVxuICAgICAgICAgICAgdmFyIG9uR2V0RGV2aWNlcyA9IGZ1bmN0aW9uKHJlc3BvbnNlLCBkZXZpY2VzKXtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLnN1Y2Nlc3Mpe1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGRldmljZXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZ2V0U2Vuc29ycyhvbkNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGF0dGVtcHQgdG8gdXNlIGNhY2hlZCBkZXZpY2VzXG4gICAgICAgICAgICB2YXIgZGV2aWNlU3RvcmUgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlY3VyaXR5SW50ZWdyYXRpb25EZXZpY2VzLnJhd1RvcGljU3RyXS5zdG9yZSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlU3RvcmUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnNlcnZlci5nZXRTZWN1cml0eUludGVncmF0aW9uc0RldmljZXMob25HZXREZXZpY2VzKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgb25HZXREZXZpY2VzKHJlc3BvbnNlLCBkZXZpY2VTdG9yZS5kZXZpY2VzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGxlZ2FjeUhhbmRsZXJzW0VWV0VCMi5wdWJTdWJUb3BpYy5zZWN1cml0eUludGVncmF0aW9uRGV2aWNlQ29ubmVjdGlvbi5yYXdUb3BpY1N0cl0gPSB7XG4gICAgICAgIGZuOiBmdW5jdGlvbiAoY2FsbGJhY2ssIHN1YnNjcmlwdGlvbiwgdG9waWMvKiwgb3B0aW9ucywgaWRzKi8pIHtcbiAgICAgICAgICAgIHZhciBvbkNhbGxiYWNrID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBkZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICAgICAgaWYgKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyOiBzdWJzY3JpcHRpb24uc2VydmVyLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2VzOiBkZXZpY2VzXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBDYWxsIGV4dGVybmFsIGNhbGxiYWNrIHdpdGggZWFjaCBkZXZpY2UgY29ubmVjdGlvbnMgc3RhdHVzXG4gICAgICAgICAgICAgICAgJC5lYWNoKGRldmljZXMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KXtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmV4dGVybmFsQ2FsbGJhY2soc3Vic2NyaXB0aW9uLCBlbGVtZW50LmlkLCBlbGVtZW50LmNvbm5lY3Rpb25TdGF0dXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGF0dGVtcHQgdG8gdXNlIGNhY2hlZCBkYXRhXG4gICAgICAgICAgICBpZiAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gJC5ncmVwKGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhLCBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuaWQgPT09IHN1YnNjcmlwdGlvbi5zZXJ2ZXIuaWQ7XG4gICAgICAgICAgICAgICAgfSlbMF07XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgY2FjaGVkIGRhdGEgZm9yIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICBvbkNhbGxiYWNrKG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSksIGRhdGEuZGV2aWNlcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGF0dGVtcHQgdG8gdXNlIGNhY2hlZCBkZXZpY2VzXG4gICAgICAgICAgICB2YXIgZGV2aWNlU3RvcmUgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbRVZXRUIyLnB1YlN1YlRvcGljLnNlY3VyaXR5SW50ZWdyYXRpb25EZXZpY2VzLnJhd1RvcGljU3RyXS5zdG9yZSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihlbGVtZW50KXtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuc2VydmVyLmlkID09PSBzdWJzY3JpcHRpb24uc2VydmVyLmlkO1xuICAgICAgICAgICAgICAgIH0pWzBdO1xuXG4gICAgICAgICAgICBpZiAoZGV2aWNlU3RvcmUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnNlcnZlci5nZXRTZWN1cml0eUludGVncmF0aW9uc0RldmljZXMob25DYWxsYmFjayk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIG9uQ2FsbGJhY2socmVzcG9uc2UsIGRldmljZVN0b3JlLmRldmljZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBsZWdhY3lIYW5kbGVyc1tFVldFQjIucHViU3ViVG9waWMuYXNzb2NpYXRpb25zLnJhd1RvcGljU3RyXSA9IHtcbiAgICAgICAgZm46IGZ1bmN0aW9uIChjYWxsYmFjaywgc3Vic2NyaXB0aW9uLCB0b3BpYy8qLCBvcHRpb25zLCBpZHMqLykge1xuXG4gICAgICAgICAgICB2YXIgdHJpZ2dlckV4dGVybmFsQ2FsbGJhY2sgPSBmdW5jdGlvbihhc3NvY2lhdGlvbnNCeUNhbWVyYUlkKXtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGtleSBpbiBhc3NvY2lhdGlvbnNCeUNhbWVyYUlkKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFzc29jaWF0aW9uc0J5Q2FtZXJhSWQuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbWVyYUlkID0gcGFyc2VJbnQoa2V5LCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZXh0ZXJuYWxDYWxsYmFjayhzdWJzY3JpcHRpb24sIGNhbWVyYUlkLCBhc3NvY2lhdGlvbnNCeUNhbWVyYUlkW2NhbWVyYUlkXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25DYWxsYmFjayA9IGZ1bmN0aW9uIChyZXNwb25zZSwgYXNzb2NpYXRpb25zKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi5sb2coJ0xlZ2FjeSBzdWJzY3JpcHRpb24gZmFpbGVkOicsIHRvcGljLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgYXNzb2NpYXRpb25zQnlDYW1lcmFJZCA9IHt9O1xuICAgICAgICAgICAgICAgICQuZWFjaChhc3NvY2lhdGlvbnMsIGZ1bmN0aW9uKGluZGV4LCByYXcpe1xuICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBhc3NvY2lhdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc29jaWF0aW9uSXRlbXMgPSAkLm1hcChyYXcuaXRlbXMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLkFzc29jaWF0aW9uSXRlbShlbGVtZW50LmlkLCBlbGVtZW50LnR5cGUsIGVsZW1lbnQucG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdGF0dXNPbmx5LCBlbGVtZW50LmV4dHJhKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvbnRJbmZvID0gbmV3IEVWV0VCMi5Gb250SW5mbyhyYXcuZm9udE5hbWUsIHJhdy5mb250U2l6ZSwgcmF3LmZvbnRTdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhdy5mb250Q29sb3IsIHJhdy5mb250RmFtaWx5LCByYXcuZm9udFdlaWdodCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGFzc29jaWF0aW9uID0gbmV3IEVWV0VCMi5Bc3NvY2lhdGlvbihzdWJzY3JpcHRpb24uc2VydmVyLCB1bmRlZmluZWQsIHJhdy5ndWlkLCBhc3NvY2lhdGlvbkl0ZW1zLFxuICAgICAgICAgICAgICAgICAgICAgICAgcmF3LmxhYmVsLCByYXcub3ZlcmxheVN0eWxlLCByYXcucG9zaXRpb24sIHJhdy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICByYXcub3BhY2l0eSwgZm9udEluZm8pO1xuXG4gICAgICAgICAgICAgICAgICAgIGFzc29jaWF0aW9uc0J5Q2FtZXJhSWRbcmF3LmNhbWVyYUlkXSA9IGFzc29jaWF0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjYWNoZWQgZGF0YVxuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGxlZ2FjeUhhbmRsZXJzW3RvcGljXS5kYXRhID0gW107XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlcjogc3Vic2NyaXB0aW9uLnNlcnZlcixcbiAgICAgICAgICAgICAgICAgICAgYXNzb2NpYXRpb25zQnlDYW1lcmFJZDogYXNzb2NpYXRpb25zQnlDYW1lcmFJZFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdHJpZ2dlckV4dGVybmFsQ2FsbGJhY2soYXNzb2NpYXRpb25zQnlDYW1lcmFJZCk7XG5cbiAgICAgICAgICAgICAgICAvLyBjYWxsIGV4dGVybmFsIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVyc1t0b3BpY10uZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAkLmdyZXAobGVnYWN5SGFuZGxlcnNbdG9waWNdLmRhdGEsIGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5pZCA9PT0gc3Vic2NyaXB0aW9uLnNlcnZlci5pZDtcbiAgICAgICAgICAgICAgICB9KVswXTtcblxuICAgICAgICAgICAgICAgIGlmIChkYXRhICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBjYWNoZWQgZGF0YSBmb3IgdGhlIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXJFeHRlcm5hbENhbGxiYWNrKGRhdGEuYXNzb2NpYXRpb25zQnlDYW1lcmFJZCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBvbkdldEFzc29jaWF0aW9uc1N1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpLCBkYXRhLmFzc29jaWF0aW9ucyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25HZXRBc3NvY2lhdGlvbnNFcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgb25DYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlKSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBtYWtlIHJlcXVlc3RcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgczogc3Vic2NyaXB0aW9uLnNlcnZlci5zZXNzaW9uSWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRBc3NvY2lhdGlvbnNTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldEFzc29jaWF0aW9uc0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogc3Vic2NyaXB0aW9uLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYXNzb2NpYXRpb25zLFxuICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogSGVscGVyIG1ldGhvZCB0byByZXBsYWNlIHRoZSB0aGUgdG9waWMgc3RyaW5nIHdpdGggdGhlIGl0ZW0gaWRzLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgVGhlIHRvcGljIHN0cmluZy5cbiAgICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIGFuIGFycmF5IG9mIGl0ZW0gaWRzLlxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSB0b3BpYyBzdHJpbmcgd2l0aCB0aGUgaXRlbSBJRHNcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICB2YXIgZm9ybWF0U3RyaW5nID0gZnVuY3Rpb24oc3RyaW5nLCBhcmdzKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSBzdHJpbmc7XG4gICAgICAgIHZhciBpID0gYXJncy5sZW5ndGg7XG5cbiAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXHsnICsgaSArICdcXFxcfScsICdnbScpLCBhcmdzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBGb3JtYXQgdGhlIHNlc3Npb24gSWQgdG9waWMgd2l0aCB0aGUgaXRlbSBpZHMgcGFzc2VkLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0b3BpYyBUaGUgdG9waWMgc3RyaW5nLlxuICAgICAqIEBwYXJhbSB7QXJyYXl9IGlkcyBBbiBhcnJheSBvZiBlaXRoZXIgRVZXRUIyIHR5cGVzIG9yIHN0cmluZ3MuXG4gICAgICogQHJldHVybnMge1N0cmluZ30gVGhlIHNlc3Npb24gSUQgdG9waWMgd2l0aCBpdGVtIElEc1xuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHZhciBmb3JtYXRUb3BpYyA9IGZ1bmN0aW9uKHRvcGljLCBpZHMpIHtcbiAgICAgICAgdmFyIGZvcm1hdFN0ciA9IHRvcGljLnJhd1RvcGljU3RyO1xuICAgICAgICB2YXIgcmVxdWlyZWRUeXBlcyA9IHRvcGljLmlkVHlwZXM7XG4gICAgICAgIHZhciBmb3JtYXR0ZWRJZHMgPSBbXTtcblxuICAgICAgICB2YXIgaW5zdGFuY2VPZkFueSA9IGZ1bmN0aW9uKG9iaiwgdHlwZXMpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaSA8IHR5cGVzLmxlbmd0aDsgKytpKXtcbiAgICAgICAgICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgdHlwZXNbaV0pe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGdldElkID0gZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZU9mQW55KG9iaiwgW0VWV0VCMi5DYW1lcmEsIEVWV0VCMi5EZXZpY2VDb25maWcsIEVWV0VCMi5UcmlnZ2VyXSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmlkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGVmYXVsdCBjYXNlXG4gICAgICAgICAgICByZXR1cm4gb2JqLnRvU3RyaW5nKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHJlcXVpcmVkVHlwZXMubGVuZ3RoOyArK2kpe1xuICAgICAgICAgICAgZm9ybWF0dGVkSWRzLnB1c2goZ2V0SWQoaWRzW2ldKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZm9ybWF0U3RyaW5nKGZvcm1hdFN0ciwgZm9ybWF0dGVkSWRzKTtcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBUaGUgTGVnYWN5V2ViU29ja2V0SGFuZGxlciBvYmplY3QgbWltaWNzIHRoZSBiZWhhdmlvciBvZiB7QGxpbmsgRVZXRUIyLldlYlNvY2tldEhhbmRsZXJ9XG4gICAgICogdXNpbmcgdGhlIHRyYWRpdGlvbmFsIHBvbGxpbmcgbWVjaGFuaXNtcyBmb3VuZCBpbiB0aGUgQVBJLiAgSXQgaXMgbG9hZGVkIGR5bmFtaWNhbGx5IHRvIG92ZXJyaWRlXG4gICAgICogdGhlIHdlYiBzb2NrZXQgaW1wbGVtZW50YXRpb24gaWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHdlYiBzb2NrZXRzIG9yIGJpbmFyeSBkYXRhIHBhcnNpbmdcbiAgICAgKiBmdW5jdGlvbmFsaXR5LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZpY2V9IFtzZXJ2aWNlPW51bGxdIFRoZSBzZXJ2aWNlIGluc3RhbmNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBkZXByZWNhdGVkIFdlYiBTb2NrZXQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdlYiBBUEkgaW4gOS42LjAuXG4gICAgICogQGNhdGVnb3J5IFNlcnZpY2VcbiAgICAgKi9cbiAgICBFVldFQjIuTGVnYWN5V2ViU29ja2V0SGFuZGxlciA9IGZ1bmN0aW9uIChzZXJ2aWNlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPYmplY3QgdG8gZGV0ZXJtaW5lIGlmIGxlZ2FjeSB3ZWJzb2NrZXRzIGFyZSBiZWluZyB1c2VkLlxuICAgICAgICAgKiBAdHlwZSB7T2JqZWN0fVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0xlZ2FjeSA9IHRydWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgcmVmZXJlbmNlIHRvIHRoZSBzZXJ2aWNlIGluc3RhbmNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZpY2V9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW50ZXJ2YWwgZm9yIGNhbGxpbmcge0BsaW5rIGxlZ2FjeVBvbGx9LlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcG9sbFRpbWVvdXQgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbnRlcnZhbCBkdXJhdGlvbiAoaW4gbXMpIG9mIHRoZSBpbnRlcnZhbCBmb3IgY2FsbGluZyB7QGxpbmsgbGVnYWN5UG9sbH0uXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB2YXIgcG9sbFRpbWVvdXRWYWx1ZSA9IDMwMDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIExpc3Qgb2YgYWN0aXZlIHN1YnNjcmlwdGlvbnMuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEB0eXBlIHtBcnJheX1cbiAgICAgICAgICovXG4gICAgICAgIHZhciBzdWJzY3JpcHRpb25zID0gW107XG5cbiAgICAgICAgLy8gQXNzaWduIHRoZSB2YWx1ZXNcbiAgICAgICAgaWYgKHNlcnZpY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZW5lcmF0ZSBhIHVuaXF1ZSByYW5kb20gaWQgZm9yIHByb3RvY29sIHJlcXVlc3RzXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IFVuaXF1ZSByYW5kb20gSURcbiAgICAgICAgICovXG4gICAgICAgIHZhciBnZW5lcmF0ZUlkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdXVpZC52NCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxscyB0aGUgbGVnYWN5IGhhbmRsZXIgZnVuY3Rpb24gZm9yIGVhY2ggc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGxlZ2FjeVBvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvLyBSZXNldCBhbnkgbGVnYWN5SGFuZGxlcnMgZGF0YVxuICAgICAgICAgICAgdmFyIHRvcGljU3RyO1xuICAgICAgICAgICAgZm9yICh0b3BpY1N0ciBpbiBsZWdhY3lIYW5kbGVycykge1xuICAgICAgICAgICAgICAgIGlmIChsZWdhY3lIYW5kbGVycy5oYXNPd25Qcm9wZXJ0eSh0b3BpY1N0cikgJiYgbGVnYWN5SGFuZGxlcnNbdG9waWNTdHJdLmRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbGVnYWN5SGFuZGxlcnNbdG9waWNTdHJdLmRhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xuICAgICAgICAgICAgdmFyIG9uQ29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbkluZm8gPSBzdWJzY3JpcHRpb25zW2luZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uSW5mbyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChwb2xsVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlJ3JlIGF0IHRoZSBlbmQgb2YgdGhlIGNoYWluXG4gICAgICAgICAgICAgICAgICAgIHBvbGxUaW1lb3V0ID0gc2V0VGltZW91dChsZWdhY3lQb2xsLCBwb2xsVGltZW91dFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25JbmZvLnN1YnNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SGFuZGxlciA9IGxlZ2FjeUhhbmRsZXJzW3N1YnNjcmlwdGlvbkluZm8udG9waWNdO1xuICAgICAgICAgICAgICAgIGluZGV4Kys7XG4gICAgICAgICAgICAgICAgLy8gUGVyZm9ybSB0aGUgc3Vic2NyaXB0aW9uIHBvbGxcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0SGFuZGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENvbnRpbnVlIHRoZSBleGVjdXRpb24gY2hhaW5cbiAgICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SGFuZGxlci5mbihvbkNvbXBsZXRlLCBzdWJzY3JpcHRpb24sIHN1YnNjcmlwdGlvbkluZm8udG9waWMsIHN1YnNjcmlwdGlvbkluZm8ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbkluZm8uaWRzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBTdGFydCB0aGUgc3Vic2NyaXB0aW9uIGNoYWluXG4gICAgICAgICAgICBvbkNvbXBsZXRlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlIHRoZSB3ZWJzb2NrZXQgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGNhbGwgd2hlbiB0aGUgcmVzcG9uc2UgY29tcGxldGVzLiBUaGUgY2FsbGJhY2sgaXMgcGFzc2VkXG4gICAgICAgICAqIGFuIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCAob24gc3VjY2VzcykgYW4gaW5zdGFuY2Ugb2ZcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5XZWJzb2NrZXRDb25maWd9LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRDb25maWcgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbGxiYWNrIHJlcXVpcmVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgd2Vic29ja2V0ID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uR2V0Q29uZmlnRXJyb3IgPSBmdW5jdGlvbiAoLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsICdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvbkdldENvbmZpZ1N1Y2Nlc3MgPSBmdW5jdGlvbiAoZGF0YSAvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MsIGRhdGEuZXJyb3JUZXh0KTtcblxuICAgICAgICAgICAgICAgIHZhciBob3N0VXJsID0gd2Vic29ja2V0LnNlcnZpY2UuaG9zdFVybDtcbiAgICAgICAgICAgICAgICBpZiAoaG9zdFVybC5zdWJzdHIoaG9zdFVybC5sZW5ndGggLSAxKSAhPT0gXCIvXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaG9zdFVybCA9IGhvc3RVcmwuc2xpY2UoMCwgaG9zdFVybC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHdlYnNvY2tldENvbmZpZyA9IG5ldyBFVldFQjIuV2Vic29ja2V0Q29uZmlnKGhvc3RVcmwsIGRhdGEucG9ydCk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHdlYnNvY2tldENvbmZpZyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25HZXRDb25maWdTdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkdldENvbmZpZ0Vycm9yLFxuICAgICAgICAgICAgICAgIHVybDogd2Vic29ja2V0LnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5icm9rZXJDb25maWcsXG4gICAgICAgICAgICAgICAgZGF0YToge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmICh3ZWJzb2NrZXQuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgd2Vic29ja2V0LnNlcnZpY2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBpbml0aWF0ZXMgYSB3ZWJzb2NrZXQgY29ubmVjdGlvbiB3aXRoIHRoZSBzZXJ2ZXIuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5XZWJzb2NrZXRDb25maWd9IGNvbmZpZyBUaGUgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBmb3IgdGhlIHdlYnNvY2tldCBjb25uZWN0aW9uXG4gICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0IE51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3Igd2Vic29ja2V0IGNvbm5lY3Rpb24gdG8gYmUgb3BlbmVkXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmluaXQgPSBmdW5jdGlvbiAoY2FsbGJhY2svKiwgY29uZmlnLCB0aW1lb3V0Ki8pIHtcbiAgICAgICAgICAgIC8vIERvIG5vdGhpbmdcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZha2VzIHN1YnNjcmliaW5nIHRvIHdlYnNvY2tldCBtZXNzYWdlcyBieSBpbmRpdmlkdWFsbHkgcG9sbGluZyBmb3IgY29udGVudCBhbmQgcm91dGVzIHRoZSBldmVudCBwYXlsb2FkXG4gICAgICAgICAqIHRvIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3MuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLnB1YlN1YlRvcGljfSB0b3BpYyBUaGUgdG9waWMgdG8gc3Vic2NyaWJlIHRvLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IHNlcnZlciBUaGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBjYWxsYmFjayByZXNwb25zaWJsZSBmb3IgaGFuZGxpbmcgZXZlbnRzIHB1Ymxpc2hlZCB0byB0aGUgZ2l2ZW4gdG9waWNcbiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBBZGRpdGlvbmFsIGF2YWlsYWJsZSBvcHRpb25zLlxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBbaWRzPVtdXSBpZHMgaXMgYW4gYXJyYXkgb2YgZWl0aGVyIEVWV0VCMiB0eXBlcyBvciBzdHJpbmdzLiBUaGUgaWRzIHJlcXVpcmVkIGJ5IGEgdG9waWNcbiAgICAgICAgICogYXJlIGRvY3VtZW50ZWQgYXMgcGFydCBvZiBlYWNoIHtAbGluayBFVldFQjIucHViU3ViVG9waWN9IHRvcGljLlxuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxFVldFQjIuU3Vic2NyaXB0aW9uLCBFVldFQjIuUmVzcG9uc2VTdGF0dXM+fSBBIHByb21pc2UgdGhhdCByZXR1cm5zIHRoZSBuZXcgc3Vic2NyaXB0aW9uXG4gICAgICAgICAqIGluc3RhbmNlIHRvIHRoZSBjYWxsZXIgd2hlbiByZXNvbHZlZCwgb3IgYW4ge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2hlbiByZWplY3RlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3Vic2NyaWJlID0gZnVuY3Rpb24gKHRvcGljLCBzZXJ2ZXIsIGhhbmRsZXIsIG9wdGlvbnMsIGlkcykge1xuICAgICAgICAgICAgdmFyIG9uUmVwbHkgPSAkLkRlZmVycmVkKCk7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2U7XG5cbiAgICAgICAgICAgIGlmICh0b3BpYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcIlRyeWluZyB0byBzdWJzY3JpYmUgdG8gdW5rbm93biBFVldFQjIucHViU3ViVG9waWM6IFwiICsgdG9waWMsXG4gICAgICAgICAgICAgICAgICAgIEVWV0VCMi53ZWJzb2NrZXRFcnJvckNvZGVzLnVua25vd25Ub3BpYyk7XG4gICAgICAgICAgICAgICAgb25SZXBseS5yZWplY3QocmVzcG9uc2UsIHRvcGljLCBzZXJ2ZXIsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvblJlcGx5LnByb21pc2UoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbklkID0gZ2VuZXJhdGVJZCgpO1xuICAgICAgICAgICAgdmFyIHRvcGljTmFtZSA9IHRvcGljLnJhd1RvcGljU3RyO1xuICAgICAgICAgICAgdmFyIHNlc3Npb25Ub3BpYyA9IHRvcGljTmFtZSArICcuJyArIHNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICBpZiAoaWRzICE9PSB1bmRlZmluZWQgJiYgaWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uVG9waWMgPSBmb3JtYXRUb3BpYyh0b3BpYywgaWRzKSArICcuJyArIHNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBuZXcgRVZXRUIyLlN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb25JZCwgc2VydmVyLCBzZXNzaW9uVG9waWMsIGhhbmRsZXIpO1xuXG4gICAgICAgICAgICAvLyBOT1RFOiBUaGVyZSBjYW4gYmUgbXVsdGlwbGUgc3Vic2NyaXB0aW9ucyBwZXIgdG9waWMgaW4gdGhlIHBvbGwgY2hhaW4gd2hpY2hcbiAgICAgICAgICAgIC8vIGlzIHdoZXJlIGNhY2hlZCBkYXRhIHZhbHVlcyBjb21lIGludG8gcGxheVxuICAgICAgICAgICAgc3Vic2NyaXB0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAnc3Vic2NyaXB0aW9uJzogc3Vic2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICd0b3BpYyc6IHRvcGljTmFtZSxcbiAgICAgICAgICAgICAgICAnb3B0aW9ucyc6IG9wdGlvbnMsXG4gICAgICAgICAgICAgICAgJ2lkcyc6IGlkc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAocG9sbFRpbWVvdXQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBwb2xsVGltZW91dCA9IHNldFRpbWVvdXQobGVnYWN5UG9sbCwgcG9sbFRpbWVvdXRWYWx1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG9uUmVwbHkucmVzb2x2ZShzdWJzY3JpcHRpb24pO1xuICAgICAgICAgICAgcmV0dXJuIG9uUmVwbHkucHJvbWlzZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHRvIHVuc3Vic2NyaWJlIGZyb20gYW4gZXhpc3Rpbmcgc3Vic2NyaXB0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5TdWJzY3JpcHRpb259IHN1YnNjcmlwdGlvbiBBbiBleGlzdGluZyBzdWJzY3JpcHRpb24gaW5zdGFuY2VcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSBbYWNrbm93bGVkZ2U9dHJ1ZV0gQSBmbGFnIGluZGljYXRpbmcgaWYgYWNrbm93bGVkZ2VtZW50IGlzIHJlcXVlc3RlZCB3aGVuXG4gICAgICAgICAqIHRoZSByZXF1ZXN0IGNvbXBsZXRlc1xuICAgICAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxFVldFQjIuU3Vic2NyaXB0aW9uLCBFVldFQjIuUmVzcG9uc2VTdGF0dXM+fSBBIHByb21pc2UgdGhhdCByZXR1cm5zIHRoZSBzdWJzY3JpcHRpb25cbiAgICAgICAgICogaW5zdGFuY2UgKG5vdyBpbmFjdGl2ZSkgYmFjayB0byB0aGUgY2FsbGVyIHdoZW4gcmVzb2x2ZWQsIG9yIGFuIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlXG4gICAgICAgICAqIGlmIHJlamVjdGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIChzdWJzY3JpcHRpb24vKiwgYWNrbm93bGVkZ2UqLykge1xuICAgICAgICAgICAgdmFyIG9uVW5zdWJzY3JpYmVkID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgICAgICAgICB2YXIgaW50ZXJuYWxTdWJzY3JpcHRpb24gPSAkLmdyZXAoc3Vic2NyaXB0aW9ucywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnN1YnNjcmlwdGlvbiA9PT0gc3Vic2NyaXB0aW9uO1xuICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2U7XG4gICAgICAgICAgICBpZiAoaW50ZXJuYWxTdWJzY3JpcHRpb24gPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBcInVuc3Vic2NyaWJlIGZhaWxlZCwgbm8gYWN0aXZlIHN1YnNjcmlwdGlvbnMgZm91bmQgZm9yIHRvcGljOiBcIiArIHN1YnNjcmlwdGlvbi50b3BpYyxcbiAgICAgICAgICAgICAgICAgICAgRVZXRUIyLndlYnNvY2tldEVycm9yQ29kZXMudW5rbm93blRvcGljKTtcbiAgICAgICAgICAgICAgICBvblVuc3Vic2NyaWJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybiBvblVuc3Vic2NyaWJlZC5wcm9taXNlKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgc3Vic2NyaXB0aW9uXG4gICAgICAgICAgICB2YXIgaW5kZXggPSAkLmluQXJyYXkoaW50ZXJuYWxTdWJzY3JpcHRpb24sIHN1YnNjcmlwdGlvbnMpO1xuICAgICAgICAgICAgaWYoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihzdWJzY3JpcHRpb25zLmxlbmd0aCA9PT0gMCAmJiBwb2xsVGltZW91dCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChwb2xsVGltZW91dCk7XG4gICAgICAgICAgICAgICAgcG9sbFRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBvblVuc3Vic2NyaWJlZC5yZXNvbHZlKHN1YnNjcmlwdGlvbik7XG4gICAgICAgICAgICByZXR1cm4gb25VbnN1YnNjcmliZWQucHJvbWlzZSgpO1xuICAgICAgICB9O1xuICAgIH07XG4gICAgaWYod2luZG93LldlYlNvY2tldCA9PT0gdW5kZWZpbmVkIHx8IHdpbmRvdy5EYXRhVmlldyA9PT0gdW5kZWZpbmVkIHx8IHdpbmRvdy5BcnJheUJ1ZmZlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIC8vIE92ZXJyaWRlIHRoZSBleGlzdGluZyB3ZWIgc29ja2V0IGhhbmRsZXIgd2l0aCB0aGUgbGVnYWN5IHZlcnNpb24uXG4gICAgICAgIEVWV0VCMi5XZWJTb2NrZXRIYW5kbGVyID0gRVZXRUIyLkxlZ2FjeVdlYlNvY2tldEhhbmRsZXI7XG4gICAgfVxufSgpKTtcbiIsIi8qZ2xvYmFscyBFVldFQjI6dHJ1ZSovXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgaXRlbSB0eXBlcyBhdmFpbGFibGUgdG8gYm9va21hcmsgaXRlbXMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQ2FzZSBNYW5hZ2VtZW50XG4gICAgICovXG4gICAgRVZXRUIyLmJvb2ttYXJrSXRlbVR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQ2FtZXJhXG4gICAgICAgICAqL1xuICAgICAgICBjYW1lcmE6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdWRpb1xuICAgICAgICAgKi9cbiAgICAgICAgYXVkaW86IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXJpYWxcbiAgICAgICAgICovXG4gICAgICAgIHNlcmlhbDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEV2ZW50XG4gICAgICAgICAqL1xuICAgICAgICBldmVudDogM1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGJvb2ttYXJrIGl0ZW0gaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIGl0ZW0uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBpdGVtIElEXG4gICAgICogQHBhcmFtIHtFVldFQjIuYm9va21hcmtJdGVtVHlwZXN9IHR5cGUgVGhlIHR5cGUgb2YgdGhlIGl0ZW0uXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IENhc2UgTWFuYWdlbWVudFxuICAgICAqL1xuICAgIEVWV0VCMi5Cb29rbWFya0l0ZW0gPSBmdW5jdGlvbihzZXJ2ZXIsIGlkLCB0eXBlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGUgaXRlbS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGl0ZW0gSURcbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgdGhlIGl0ZW0uXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuYm9va21hcmtJdGVtVHlwZXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgZm9yIGJvb2ttYXJrIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBib29rbWFyayBuYW1lXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGd1aWQgVGhlIHVuaXF1ZSBib29rbWFyayBpZFxuICAgICAqIEBwYXJhbSB7RGF0ZX0gc3RhcnQgVGhlIHN0YXJ0IHRpbWUgb2YgdGhlIGJvb2ttYXJrLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gZW5kIFRoZSBlbmQgdGltZSBvZiB0aGUgYm9va21hcmsuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQm9va21hcmtJdGVtW119IGl0ZW1zIFRoZSBpdGVtcyBhc3NvY2lhdGVkIHdpdGggdGhlIGJvb2ttYXJrLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZGVzY3JpcHRpb249XCJcIl0gVGhlIGNhc2UgZGVzY3JpcHRpb25cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3NpemU9MF0gVGhlIHNpemUgb2YgdGhlIGJvb2ttYXJrLCBpbiBLQi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2Nhc2VJZD1udWxsXSBUaGUgYXNzb2NpYXRlZCBjYXNlIElELCBpZiBhcHBsaWNhYmxlLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBDYXNlIE1hbmFnZW1lbnRcbiAgICAgKi9cbiAgICBFVldFQjIuQm9va21hcmsgPSBmdW5jdGlvbihuYW1lLCBndWlkLCBzdGFydCwgZW5kLCBpdGVtcywgZGVzY3JpcHRpb24sIHNpemUsIGNhc2VJZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGJvb2ttYXJrIG5hbWVcbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1bmlxdWUgYm9va21hcmsgaWRcbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ3VpZCA9IGd1aWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdGFydCB0aW1lIG9mIHRoZSBib29rbWFya1xuICAgICAgICAgKiBAdHlwZSB7RGF0ZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVuZCB0aW1lIG9mIHRoZSBib29rbWFya1xuICAgICAgICAgKiBAdHlwZSB7RGF0ZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5kID0gZW5kO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaXRlbXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBib29rbWFya1xuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkJvb2ttYXJrSXRlbVtdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pdGVtcyA9IGl0ZW1zO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYm9va21hcmsgZGVzY3JpcHRpb25cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNpemUgb2YgdGhlIGJvb2ttYXJrIGluIEtCLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaXplID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFzc29jaWF0ZWQgY2FzZSBJRCwgaWYgYXBwbGljYWJsZS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ3xudWxsfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYXNlSWQgPSBudWxsO1xuXG4gICAgICAgIGlmIChkZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNpemUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zaXplID0gc2l6ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2FzZUlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY2FzZUlkID0gY2FzZUlkO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVwZGF0ZXMgYSBib29rbWFyayBpbnN0YW5jZS4gTk9URTogdGhpcyBmdW5jdGlvbiBvbmx5IHVwZGF0ZXMgYmFzZSBib29rbWFyayBpbmZvcm1hdGlvbiAoZS5nLiBuYW1lLFxuICAgICAgICAgKiBkZXNjcmlwdGlvbikuIFRvIG1vZGlmeSB0aGUgaXRlbXMgYXNzb2NpYXRlZCB3aXRoIGEgYm9va21hcmssIHNlZSB7QGxpbmsgRVZXRUIyLkJvb2ttYXJrLmFkZEl0ZW19IGFuZFxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLkJvb2ttYXJrLmRlbGV0ZUl0ZW19LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2tcbiAgICAgICAgICogaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIHRoZSB1cGRhdGVkIGJvb2ttYXJrLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cGRhdGUgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5uYW1lID0gZGF0YS5ib29rbWFyay5uYW1lO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmRlc2NyaXB0aW9uID0gZGF0YS5ib29rbWFyay5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zdGFydCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShkYXRhLmJvb2ttYXJrLnN0YXJ0KTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5lbmQgPSBFVldFQjIudXRpbC5JRVRGMkRhdGUoZGF0YS5ib29rbWFyay5lbmQpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBpbnN0YW5jZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChpbnN0YW5jZS5pdGVtcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGd1aWQ6IGluc3RhbmNlLmd1aWQsXG4gICAgICAgICAgICAgICAgbmFtZTogaW5zdGFuY2UubmFtZSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogaW5zdGFuY2UuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgc3RhcnQ6IEVWV0VCMi51dGlsLkRhdGUySUVURihpbnN0YW5jZS5zdGFydCksXG4gICAgICAgICAgICAgICAgZW5kOiBFVldFQjIudXRpbC5EYXRlMklFVEYoaW5zdGFuY2UuZW5kKVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoaW5zdGFuY2UuY2FzZUlkICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgZGF0YVsnY2FzZSddID0gaW5zdGFuY2UuY2FzZUlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2UuaXRlbXNbMF0uc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ib29rbWFyayxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihpbnN0YW5jZS5pdGVtc1swXS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgaW5zdGFuY2UuaXRlbXNbMF0uc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVsZXRlIGEgYm9va21hcmsuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFja1xuICAgICAgICAgKiBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGVsZXRlQm9va21hcmsgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChpbnN0YW5jZS5pdGVtcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXJ2ZXIuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGd1aWQ6IGluc3RhbmNlLmd1aWRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGluc3RhbmNlLmNhc2VJZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGRhdGFbJ2Nhc2UnXSA9IGluc3RhbmNlLmNhc2VJZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGluc3RhbmNlLml0ZW1zWzBdLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYm9va21hcmssXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoaW5zdGFuY2UuaXRlbXNbMF0uc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIGluc3RhbmNlLml0ZW1zWzBdLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkZHMgYW4gaXRlbSB0byBhIGJvb2ttYXJrLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2tcbiAgICAgICAgICogaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIHRoZSB1cGRhdGVkIGJvb2ttYXJrLlxuICAgICAgICAgKiBAcGFyYW0ge0VWV0VCMi5Cb29rbWFya0l0ZW19IGJvb2ttYXJrSXRlbSBUaGUgYm9va21hcmsgaXRlbSB0byBhZGQgdG8gdGhlIGJvb2ttYXJrLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hZGRJdGVtID0gZnVuY3Rpb24oY2FsbGJhY2ssIGJvb2ttYXJrSXRlbSkge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGluc3RhbmNlLml0ZW1zLnB1c2goYm9va21hcmtJdGVtKTtcbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGluc3RhbmNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgIHM6ICQubWFwKGluc3RhbmNlLml0ZW1zLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlcnZlci5zZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZ3VpZDogaW5zdGFuY2UuZ3VpZCxcbiAgICAgICAgICAgICAgICBpZDogYm9va21hcmtJdGVtLmlkLFxuICAgICAgICAgICAgICAgIHR5cGU6IGJvb2ttYXJrSXRlbS50eXBlLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZDogYm9va21hcmtJdGVtLnNlcnZlci5zZXNzaW9uSWRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZihpbnN0YW5jZS5jYXNlSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkYXRhWydjYXNlJ10gPSBpbnN0YW5jZS5jYXNlSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBib29rbWFya0l0ZW0uc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ib29rbWFya0l0ZW1zLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihib29rbWFya0l0ZW0uc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIGJvb2ttYXJrSXRlbS5zZXJ2ZXIuc2VydmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWxldGVzIGFuIGl0ZW0gZnJvbSB0aGUgYm9va21hcmsuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFja1xuICAgICAgICAgKiBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgdGhlIHVwZGF0ZWQgYm9va21hcmsuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkJvb2ttYXJrSXRlbX0gYm9va21hcmtJdGVtIFRoZSBib29rbWFyayBpdGVtIHRvIGFkZCB0byB0aGUgYm9va21hcmsuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbihjYWxsYmFjaywgYm9va21hcmtJdGVtKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgaW50ZXJuYWxJdGVtID0gJC5ncmVwKGluc3RhbmNlLml0ZW1zLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuaWQgPT09IGJvb2ttYXJrSXRlbS5pZFxuICAgICAgICAgICAgICAgICAgICAmJiBlbGVtZW50LnR5cGUgPT09IGJvb2ttYXJrSXRlbS50eXBlXG4gICAgICAgICAgICAgICAgICAgICYmIGVsZW1lbnQuc2VydmVyID09PSBib29rbWFya0l0ZW0uc2VydmVyO1xuICAgICAgICAgICAgfSlbMF07XG4gICAgICAgICAgICBpZihpbnRlcm5hbEl0ZW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgXCJJdGVtIG5vdCByZW1vdmVkIGZyb20gYm9va21hcmsuXCIpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbih4aHIvKiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkLmluQXJyYXkoaW50ZXJuYWxJdGVtLCBpbnN0YW5jZS5pdGVtcyk7XG4gICAgICAgICAgICAgICAgaWYoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLml0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBpbnN0YW5jZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBpbnRlcm5hbEl0ZW0uc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBndWlkOiBpbnN0YW5jZS5ndWlkLFxuICAgICAgICAgICAgICAgIGlkOiBpbnRlcm5hbEl0ZW0uaWQsXG4gICAgICAgICAgICAgICAgdHlwZTogaW50ZXJuYWxJdGVtLnR5cGVcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZihpbnN0YW5jZS5jYXNlSWQgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBkYXRhWydjYXNlJ10gPSBpbnN0YW5jZS5jYXNlSWQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBpbnRlcm5hbEl0ZW0uc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5ib29rbWFya0l0ZW1zLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGJvb2ttYXJrSXRlbS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgaW50ZXJuYWxJdGVtLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIGZvciBjYXNlIGluZm9ybWF0aW9uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyW119IHNlcnZlcnMgVGhlIHNlcnZlcihzKSB0aGUgY2FzZSBpcyBzdG9yZWQgb25cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZ3VpZCBUaGUgdW5pcXVlIGNhc2UgaWRcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgY2FzZSBuYW1lXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFtkZXNjcmlwdGlvbj1cIlwiXSBUaGUgY2FzZSBkZXNjcmlwdGlvblxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbY291bnQ9MF0gVGhlIG51bWJlciBvZiBib29rbWFya3MgYXNzb2NpYXRlZCB3aXRoIHRoZSBjYXNlXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IENhc2UgTWFuYWdlbWVudFxuICAgICAqL1xuICAgIEVWV0VCMi5DYXNlID0gZnVuY3Rpb24oc2VydmVycywgZ3VpZCwgbmFtZSwgZGVzY3JpcHRpb24sIGNvdW50KSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyKHMpIHRoZSBjYXNlIGlzIHN0b3JlZCBvblxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcltdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXJzID0gc2VydmVycztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVuaXF1ZSBjYXNlIGlkXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmd1aWQgPSBndWlkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FzZSBuYW1lXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FzZSBkZXNjcmlwdGlvblxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIGJvb2ttYXJrcyBhc3NvY2lhdGVkIHdpdGggdGhlIGNhc2VcbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY291bnQgPSAwO1xuXG4gICAgICAgIGlmKGRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihjb3VudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlIGEgY2FzZSBpbnN0YW5jZS4gTk9URTogdGhpcyBmdW5jdGlvbiBvbmx5IHVwZGF0ZXMgY2FzZSBpbmZvcm1hdGlvbiAoZS5nLiBuYW1lLCBkZXNjcmlwdGlvbikuXG4gICAgICAgICAqIFRvIG1vZGlmeSBib29rbWFya3MgYXNzb2NpYXRlZCB3aXRoIGEgY2FzZSBzZWUge0BsaW5rIEVWV0VCMi5Cb29rbWFyay51cGRhdGV9LlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2tcbiAgICAgICAgICogaXMgcGFzc2VkIGEge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2UgYW5kIHRoZSB1cGRhdGVkIGNhc2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBjYXNlSW5mbyA9IGRhdGFbJ2Nhc2UnXTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5zZXJ2ZXJzID0gJC5ncmVwKGluc3RhbmNlLnNlcnZlcnMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkLmluQXJyYXkoZWwuc2Vzc2lvbklkLnRvU3RyaW5nKCksIGNhc2VJbmZvLnNlcnZlcnMpICE9PSAtMTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5ndWlkID0gY2FzZUluZm8uZ3VpZDtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5uYW1lID0gY2FzZUluZm8ubmFtZTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5kZXNjcmlwdGlvbiA9IGNhc2VJbmZvLmRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmNvdW50ID0gY2FzZUluZm8uYm9va21hcmtzO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBpbnN0YW5jZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiAkLm1hcChpbnN0YW5jZS5zZXJ2ZXJzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnNlc3Npb25JZDtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBndWlkOiBpbnN0YW5jZS5ndWlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGluc3RhbmNlLm5hbWUsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGluc3RhbmNlLmRlc2NyaXB0aW9uXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogaW5zdGFuY2Uuc2VydmVyc1swXS5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuYm9va21hcmtDYXNlcyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFVUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihpbnN0YW5jZS5zZXJ2ZXJzWzBdLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MsIGluc3RhbmNlLnNlcnZlcnNbMF0uc2VydmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWxldGVzIHRoaXMgY2FzZS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgY2FsbCBjb21wbGV0ZXMuIENhbGxiYWNrXG4gICAgICAgICAqIGlzIHBhc3NlZCBhIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZWxldGVDYXNlID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgczogJC5tYXAoaW5zdGFuY2Uuc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZ3VpZDogaW5zdGFuY2UuZ3VpZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGluc3RhbmNlLnNlcnZlcnNbMF0uc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmJvb2ttYXJrQ2FzZXMsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoaW5zdGFuY2Uuc2VydmVyc1swXS5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzLCBpbnN0YW5jZS5zZXJ2ZXJzWzBdLnNlcnZpY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmVpdmUgdGhlIGxpc3Qgb2YgYm9va21hcmtzIGZvciB0aGlzIGNhc2UuICBOb3RlOiBUaGUgYm9va21hcmtzIHJldHJpZXZlZCB0aHJvdWdoIHRoaXMgbWV0aG9kIGFyZSBhbHNvXG4gICAgICAgICAqIHJldHVybmVkIGJ5IHtAbGluayBFVldFQjIuU2VydmljZS5nZXRCb29rbWFya3N9LiAgVGhpcyBtZXRob2QgaXMgcHJvdmlkZWQgb25seSBmb3IgY29udmVuaWVuY2Ugd2hlbiB3b3JraW5nXG4gICAgICAgICAqIHdpdGggc3BlY2lmaWMgY2FzZXMuXG4gICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFja1xuICAgICAgICAgKiBpcyBwYXNzZWQgYSB7QGxpbmsgRVZXRUIyLlJlc3BvbnNlU3RhdHVzfSBpbnN0YW5jZSBhbmQgYW4gYXJyYXkgb2Yge0BsaW5rIEVWV0VCMi5Cb29rbWFya30gaW5zdGFuY2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRCb29rbWFya3MgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIEVWV0VCMi51dGlsLmdldEVycm9yVGV4dCh4aHIpKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc2VydmVyTWFwID0ge307XG4gICAgICAgICAgICAgICAgJC5lYWNoKGluc3RhbmNlLnNlcnZlcnMsIGZ1bmN0aW9uKGluZGV4LCBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHNlcnZlck1hcFtlbGVtZW50LnNlc3Npb25JZF0gPSBlbGVtZW50O1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGJvb2ttYXJrcyA9ICQubWFwKGRhdGEuYm9va21hcmtzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9ICQubWFwKGVsZW1lbnQuaXRlbXMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5Cb29rbWFya0l0ZW0oc2VydmVyTWFwW2VsLnNlcnZlcl0sIGVsLmlkLCBlbC50eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShlbGVtZW50LnN0YXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZCA9IEVWV0VCMi51dGlsLklFVEYyRGF0ZShlbGVtZW50LmVuZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuQm9va21hcmsoZWxlbWVudC5uYW1lLCBlbGVtZW50Lmd1aWQsIHN0YXJ0LCBlbmQsIGl0ZW1zLCBlbGVtZW50LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zaXplLCBlbGVtZW50WydjYXNlJ10pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soc3VjY2Vzc1Jlc3BvbnNlLCBib29rbWFya3MpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgczogJC5tYXAoaW5zdGFuY2Uuc2VydmVycywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zZXNzaW9uSWQ7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZ3VpZDogaW5zdGFuY2UuZ3VpZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGluc3RhbmNlLnNlcnZlcnNbMF0uc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmJvb2ttYXJrLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgdHJhZGl0aW9uYWw6IHRydWVcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGluc3RhbmNlLnNlcnZlcnNbMF0uc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncywgaW5zdGFuY2Uuc2VydmVyc1swXS5zZXJ2aWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHR5cGVzIG9mIHVzZXMgZm9yIHNlcmlhbCBwb3J0cy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsUG9ydFVzZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbnVzZWRcbiAgICAgICAgICovXG4gICAgICAgIFVudXNlZDogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBPU1xuICAgICAgICAgKi9cbiAgICAgICAgUE9TOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogUFRaXG4gICAgICAgICAqL1xuICAgICAgICBQVFo6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBVE1cbiAgICAgICAgICovXG4gICAgICAgIEFUTTogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFjY2VzcyBDb250cm9sXG4gICAgICAgICAqL1xuICAgICAgICBBY2Nlc3NDb250cm9sOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWxcbiAgICAgICAgICovXG4gICAgICAgIEludGVybmFsOiA1XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0eXBlcyBvZiBJUCBzZXJpYWwgcG9ydCBjb25uZWN0aW9ucy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsSXBUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRDUFxuICAgICAgICAgKi9cbiAgICAgICAgVENQOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogSFRUUFxuICAgICAgICAgKi9cbiAgICAgICAgSFRUUDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRDUCBMaXN0ZW5lclxuICAgICAgICAgKi9cbiAgICAgICAgVGNwTGlzdGVuZXI6IDIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVRFBcbiAgICAgICAgICovXG4gICAgICAgIFVEUDogM1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgdHlwZXMgb2YgcGFyaXR5IGZvciBVYXJ0IHNlcmlhbCBwb3J0cy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsUG9ydFBhcml0eSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIE5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPZGRcbiAgICAgICAgICovXG4gICAgICAgIE9kZDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEV2ZW5cbiAgICAgICAgICovXG4gICAgICAgIEV2ZW46IDJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHR5cGVzIG9mIGZsb3cgY29udHJvbCBmb3IgVWFydCBzZXJpYWwgcG9ydHMuXG4gICAgICogQGVudW0ge251bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlNlcmlhbFBvcnRGbG93Q29udHJvbCA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIE5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTb2Z0d2FyZVxuICAgICAgICAgKi9cbiAgICAgICAgU29mdHdhcmU6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYXJkd2FyZVxuICAgICAgICAgKi9cbiAgICAgICAgSGFyZHdhcmU6IDJcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHR5cGVzIG9mIHNlcmlhbCBkZXZpY2VzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxEZXZpY2VUeXBlcyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIFVua25vd246IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVQVJUXG4gICAgICAgICAqL1xuICAgICAgICBVYXJ0OiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogSVBcbiAgICAgICAgICovXG4gICAgICAgIElwOiAyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluaXRpb25zIGZvciB0eXBlcyBvZiBzZXJpYWwgcHJvZmlsZSB0cmFuc21pc3Npb24gbWFya2Vycy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsUHJvZmlsZU1hcmtlclR5cGVzID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogU3RhbmRhcmRcbiAgICAgICAgICovXG4gICAgICAgIFN0YW5kYXJkOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogWE1MXG4gICAgICAgICAqL1xuICAgICAgICBYTUw6IDFcbiAgICB9O1xuXG5cbiAgICAvKipcbiAgICAgKiBEZWZpbml0aW9ucyBmb3IgZmllbGQgcG9zaXRpb25zIGluIHNlcmlhbCBwcm9maWxlIHJ1bGVzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZUZpZWxkUG9zaXRpb25zID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQmVmb3JlXG4gICAgICAgICAqL1xuICAgICAgICBCZWZvcmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBZnRlclxuICAgICAgICAgKi9cbiAgICAgICAgQWZ0ZXI6IDFcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5pdGlvbnMgZm9yIHRoZSB0eXBlcyBvZiBvcGVyYXRvcnMgZm9yIHNlcmlhbCBwcm9maWxlIHJ1bGVzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZU9wZXJhdG9yVHlwZXMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICBVbmtub3duOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogRXF1YWxcbiAgICAgICAgICovXG4gICAgICAgIEVxdWFsOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogTm90IGVxdWFsXG4gICAgICAgICAqL1xuICAgICAgICBOb3RFcXVhbDogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdyZWF0ZXIgdGhhbiBvciBlcXVhbFxuICAgICAgICAgKi9cbiAgICAgICAgR3JlYXRlck9yRXF1YWw6IDMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBMZXNzIHRoYW4gb3IgZXF1YWxcbiAgICAgICAgICovXG4gICAgICAgIExlc3NPckVxdWFsOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogR3JlYXRlciB0aGFuXG4gICAgICAgICAqL1xuICAgICAgICBHcmVhdGVyVGhhbjogNSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIExlc3MgdGhhblxuICAgICAgICAgKi9cbiAgICAgICAgTGVzc1RoYW46IDYsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb250YWluc1xuICAgICAgICAgKi9cbiAgICAgICAgQ29udGFpbnM6IDcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEb2VzIG5vdCBjb250YWluXG4gICAgICAgICAqL1xuICAgICAgICBOb3RDb250YWluczogOFxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTZXJ2ZXIgc2VyaWFsIHN1cHBvcnRzIGluZm9ybWF0aW9uLCBkZXRhaWxpbmcgdGhlIHN1cHBvcnRlZCBmdW5jdGlvbmFsaXR5IHJlbGF0ZWQgdG8gc2VyaWFsIGRldmljZXMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbYWR2YW5jZWRMaW5lRW5kaW5nPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgYWR2YW5jZWQgbGluZSBlbmRpbmdzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NvdE1hcmtlcnM9ZmFsc2VdIFdoZXRoZXIgdGhlIHNlcnZlciBzdXBwb3J0cyBTT1QgbWFya2Vycy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt4bWxGb3JtYXR0aW5nPWZhbHNlXSBXaGV0aGVyIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgWE1MIGZvcm1hdHRpbmcgaW4gdHJhbnNtaXNzaW9uIG1hcmtlcnMuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcmVwbGFjZT1mYWxzZV0gV2hldGhlciB0aGUgc2VydmVyIHN1cHBvcnRzIHJlcGxhY2VtZW50cy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtydWxlcz1mYWxzZV0gV2hldGhlciB0aGUgc2VydmVyIHN1cHBvcnRzIHJ1bGVzLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VydmVyU2VyaWFsRnVuY3Rpb25hbGl0eSA9IGZ1bmN0aW9uKGFkdmFuY2VkTGluZUVuZGluZywgc290TWFya2VycywgeG1sRm9ybWF0dGluZywgcmVwbGFjZSwgcnVsZXMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIHN1cHBvcnRzIGFkdmFuY2VkIGxpbmUgZW5kaW5ncy5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkdmFuY2VkTGluZUVuZGluZyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgU09UIG1hcmtlcnMuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zb3RNYXJrZXJzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHNlcnZlciBzdXBwb3J0cyBYTUwgZm9ybWF0dGluZyBpbiB0cmFuc21pc3Npb24gbWFya2Vycy5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnhtbEZvcm1hdHRpbmcgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIHN1cHBvcnRzIHJlcGxhY2VtZW50cy5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlcGxhY2UgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgc2VydmVyIHN1cHBvcnRzIHJ1bGVzLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucnVsZXMgPSBmYWxzZTtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGFkdmFuY2VkTGluZUVuZGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmFkdmFuY2VkTGluZUVuZGluZyA9IGFkdmFuY2VkTGluZUVuZGluZztcbiAgICAgICAgfVxuICAgICAgICBpZihzb3RNYXJrZXJzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc290TWFya2VycyA9IHNvdE1hcmtlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYoeG1sRm9ybWF0dGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnhtbEZvcm1hdHRpbmcgPSB4bWxGb3JtYXR0aW5nO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJlcGxhY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZXBsYWNlID0gcmVwbGFjZTtcbiAgICAgICAgfVxuICAgICAgICBpZihydWxlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnJ1bGVzID0gcnVsZXM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2VydmVyIHNlcmlhbCBzdXBwb3J0IGluZm9ybWF0aW9uLCBkZXRhaWxpbmcgdGhlIGF2YWlsYWJsZSB0eXBlcywgdXNlcywgYW5kIHN1cHBvcnRlZCBmdW5jdGlvbmFsaXR5XG4gICAgICogb2Ygc2VyaWFsIHBvcnRzIG9uIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJTZXJpYWxGdW5jdGlvbmFsaXR5fSBzdXBwb3J0cyBUaGUgc3VwcG9ydGVkIGZ1bmN0aW9uYWxpdHkgb2Ygc2VyaWFsIGRldmljZXMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtudW1VYXJ0PTBdIFRoZSBudW1iZXIgb2Ygc3VwcG9ydGVkIFVhcnQgc2VyaWFsIGRldmljZXMuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtudW1JcD0wXSBUaGUgbnVtYmVyIG9mIHN1cHBvcnRlZCBJUCBzZXJpYWwgZGV2aWNlcy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQb3J0VXNlc1tdfSBbdXNlcz1bXV0gVGhlIHN1cHBvcnRlZCB1c2VzIG9mIHNlcmlhbCBkZXZpY2VzLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbElwVHlwZXNbXX0gW2lwVHlwZXM9W11dIFRoZSBzdXBwb3J0ZWQgdHlwZXMgb2YgSVAgc2VyaWFsIGRldmljZXMuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJ2ZXJTZXJpYWxTdXBwb3J0ID0gZnVuY3Rpb24oc2VydmVyLCBzdXBwb3J0cywgbnVtVWFydCwgbnVtSXAsIHVzZXMsIGlwVHlwZXMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbmZvcm1hdGlvbi5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHN1cHBvcnRlZCBmdW5jdGlvbmFsaXR5IG9mIHNlcmlhbCBkZXZpY2VzLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlclNlcmlhbEZ1bmN0aW9uYWxpdHl9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN1cHBvcnRzID0gc3VwcG9ydHM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2Ygc3VwcG9ydGVkIFVhcnQgc2VyaWFsIGRldmljZXMuXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm51bVVhcnQgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIHN1cHBvcnRlZCBJUCBzZXJpYWwgZGV2aWNlcy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubnVtSXAgPSAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3VwcG9ydGVkIHVzZXMgb2Ygc2VyaWFsIGRldmljZXMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsUG9ydFVzZXNbXX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlcyA9IFtdO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc3VwcG9ydGVkIHVzZXMgb2Ygc2VyaWFsIGRldmljZXMuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsSXBUeXBlc1tdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pcFR5cGVzID0gW107XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihudW1VYXJ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubnVtVWFydCA9IG51bVVhcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYobnVtSXAgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5udW1JcCA9IG51bUlwO1xuICAgICAgICB9XG4gICAgICAgIGlmKHVzZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51c2VzID0gdXNlcztcbiAgICAgICAgfVxuICAgICAgICBpZihpcFR5cGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuaXBUeXBlcyA9IGlwVHlwZXM7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgVWFydCBzZXJpYWwgZGV2aWNlIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwb3J0IFRoZSBuYW1lIG9mIHRoZSBzZXJ2ZXIgcG9ydCBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtiYXVkUmF0ZT00ODAwXSBUaGUgYmF1ZCByYXRlIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbZGF0YUJpdHM9OF0gVGhlIG51bWJlciBvZiBjb25maWd1cmVkIGRhdGEgYml0cyBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtzdG9wQml0cz0xXSBUaGUgbnVtYmVyIG9mIGNvbmZpZ3VyZWQgc3RvcCBiaXRzIGZvciB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQb3J0UGFyaXR5fSBbcGFyaXR5PUVWV0VCMi5TZXJpYWxQb3J0UGFyaXR5Lk5vbmVdIFRoZSBwYXJpdHkgb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VyaWFsUG9ydEZsb3dDb250cm9sfSBbZmxvd0NvbnRyb2w9RVZXRUIyLlNlcmlhbFBvcnRGbG93Q29udHJvbC5Ob25lXSBUaGUgZmxvdyBjb250cm9sIG9mIHRoZVxuICAgICAqICAgc2VyaWFsIGRldmljZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlVhcnRTZXJpYWxEZXZpY2VDb25uZWN0aW9uSW5mbyA9IGZ1bmN0aW9uKHBvcnQsIGJhdWRSYXRlLCBkYXRhQml0cywgc3RvcEJpdHMsIHBhcml0eSwgZmxvd0NvbnRyb2wpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoZSBzZXJ2ZXIgcG9ydCBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBvcnQgPSBwb3J0O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYmF1ZCByYXRlIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5iYXVkUmF0ZSA9IDQ4MDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgY29uZmlndXJlZCBkYXRhIGJpdHMgZm9yIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYXRhQml0cyA9IDg7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgY29uZmlndXJlZCBzdG9wIGJpdHMgZm9yIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdG9wQml0cyA9IDE7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBwYXJpdHkgb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsUG9ydFBhcml0eX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGFyaXR5ID0gRVZXRUIyLlNlcmlhbFBvcnRQYXJpdHkuTm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZsb3cgY29udHJvbCBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQb3J0Rmxvd0NvbnRyb2x9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZsb3dDb250cm9sID0gRVZXRUIyLlNlcmlhbFBvcnRGbG93Q29udHJvbC5Ob25lO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYoYmF1ZFJhdGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5iYXVkUmF0ZSA9IGJhdWRSYXRlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGRhdGFCaXRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZGF0YUJpdHMgPSBkYXRhQml0cztcbiAgICAgICAgfVxuICAgICAgICBpZihzdG9wQml0cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3BCaXRzID0gc3RvcEJpdHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYocGFyaXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFyaXR5ID0gcGFyaXR5O1xuICAgICAgICB9XG4gICAgICAgIGlmKGZsb3dDb250cm9sICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZmxvd0NvbnRyb2wgPSBmbG93Q29udHJvbDtcbiAgICAgICAgfVxuICAgIH07XG5cblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3QgZm9yIFVhcnQgc2VyaWFsIGRldmljZSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYWRkcmVzcyBUaGUgSVAgYWRkcmVzcyBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxJcFR5cGVzfSBbdHlwZT1FVldFQjIuU2VyaWFsSXBUeXBlcy5UQ1BdIFRoZSB0eXBlIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaXBQb3J0PTBdIFRoZSBJUCBwb3J0IG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbcmVtb3RlUG9ydD1dIFRoZSByZW1vdGUgcG9ydCB0byB1c2UgZm9yIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuSXBTZXJpYWxEZXZpY2VDb25uZWN0aW9uSW5mbyA9IGZ1bmN0aW9uKGFkZHJlc3MsIHR5cGUsIGlwUG9ydCwgcmVtb3RlUG9ydCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElQIGFkZHJlc3Mgb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxJcFR5cGVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLlNlcmlhbElwVHlwZXMuVENQO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSVAgcG9ydCBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaXBQb3J0ID0gMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHJlbW90ZSBwb3J0IHRvIHVzZSBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlbW90ZVBvcnQgPSAwO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKGlwUG9ydCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmlwUG9ydCA9IGlwUG9ydDtcbiAgICAgICAgfVxuICAgICAgICBpZihyZW1vdGVQb3J0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3RlUG9ydCA9IHJlbW90ZVBvcnQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgVWFydCBzZXJpYWwgZGV2aWNlIGluZm9ybWF0aW9uLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbbWF4TGluZUxlbmd0aD04MF0gVGhlIGNvbmZpZ3VyZWQgbWF4IGxpbmUgbGVuZ3RoIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbbGluZUVuZGluZz0nJ10gVGhlIHRva2VuIGluZGljYXRpbmcgYSBsaW5lIGVuZCBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFt0aW1lb3V0PTBdIFRoZSB0aW1lb3V0IGZvciB0aGUgbGluZSBlbmRpbmcsIGluIHNlY29uZHMuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxEZXZpY2VMaW5lSW5mbyA9IGZ1bmN0aW9uKG1heExpbmVMZW5ndGgsIGxpbmVFbmRpbmcsIHRpbWVvdXQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb25maWd1cmVkIG1heCBsaW5lIGxlbmd0aCBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWF4TGluZUxlbmd0aCA9IDgwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdG9rZW4gaW5kaWNhdGluZyBhIGxpbmUgZW5kIGZvciB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGluZUVuZGluZyA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdGltZW91dCBmb3IgdGhlIGxpbmUgZW5kaW5nLCBpbiBzZWNvbmRzLlxuICAgICAgICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aW1lb3V0ID0gMDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKG1heExpbmVMZW5ndGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tYXhMaW5lTGVuZ3RoID0gbWF4TGluZUxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZihsaW5lRW5kaW5nICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGluZUVuZGluZyA9IGxpbmVFbmRpbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0O1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3QgZm9yIHN0b3JlZCBzZXJpYWwgZGF0YSBpdGVtcy5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2RhdGE9JyddIFRoZSBzdG9yZWQgc2VyaWFsIGRhdGEuXG4gICAgICogQHBhcmFtIHtEYXRlfSBbc3RhcnQ9bnVsbF0gVGhlIHN0YXJ0IHRpbWUgb2YgdGhlIHNlcmlhbCBkYXRhLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gW2VuZD1udWxsXSBUaGUgZW5kIHRpbWUgb2YgdGhlIHNlcmlhbCBkYXRhLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsU3RvcmVkRGF0YSA9IGZ1bmN0aW9uKGRhdGEsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdG9yZWQgc2VyaWFsIGRhdGEuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRhdGEgPSAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHN0YXJ0IHRpbWUgb2YgdGhlIHNlcmlhbCBkYXRhLlxuICAgICAgICAgKiBAdHlwZSB7RGF0ZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhcnQgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZW5kIHRpbWUgb2YgdGhlIHNlcmlhbCBkYXRhLlxuICAgICAgICAgKiBAdHlwZSB7RGF0ZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5kID0gbnVsbDtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKGRhdGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgfVxuICAgICAgICBpZihzdGFydCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZW5kID0gZW5kO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3QgZm9yIHNlcmlhbCBkZXZpY2UgaW5mb3JtYXRpb24uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBzZXJ2ZXIgVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhpcyBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBUaGUgSUQgb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuVWFydFNlcmlhbERldmljZUNvbm5lY3Rpb25JbmZvfEVWV0VCMi5JcFNlcmlhbERldmljZUNvbm5lY3Rpb25JbmZvfSBjb25uZWN0aW9uSW5mbyBUaGUgY29ubmVjdGlvblxuICAgICAqICBpbmZvIGZvciB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxEZXZpY2VMaW5lSW5mb30gbGluZUluZm8gVGhlIGxpbmUgcHJvY2Vzc2luZyBpbmZvcm1hdGlvbiBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VyaWFsUG9ydFVzZXN9IFt1c2U9RVZXRUIyLlNlcmlhbFBvcnRVc2VzLlVudXNlZF0gVGhlIHVzZSBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxEZXZpY2VUeXBlc30gW3R5cGU9RVZXRUIyLlNlcmlhbERldmljZVR5cGVzLlVua25vd25dIFRoZSB0eXBlIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfG51bGx9IFtwcm9maWxlPW51bGxdIFRoZSBJRCBvZiB0aGUgc2VyaWFsIHByb2ZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsRGV2aWNlID0gZnVuY3Rpb24oc2VydmVyLCBpZCwgbmFtZSwgY29ubmVjdGlvbkluZm8sIGxpbmVJbmZvLCB1c2UsIHR5cGUsIHByb2ZpbGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoaXMgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmFtZSBvZiB0aGUgc2VyaWFsIGRldmljZS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBjb25uZWN0aW9uIGluZm8gZm9yIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlVhcnRTZXJpYWxEZXZpY2VDb25uZWN0aW9uSW5mb3xFVldFQjIuSXBTZXJpYWxEZXZpY2VDb25uZWN0aW9uSW5mb31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29ubmVjdGlvbkluZm8gPSBjb25uZWN0aW9uSW5mbztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGxpbmUgcHJvY2Vzc2luZyBpbmZvcm1hdGlvbiBmb3IgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsRGV2aWNlTGluZUluZm99XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmxpbmVJbmZvID0gbGluZUluZm87XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1c2Ugb2YgdGhlIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsUG9ydFVzZXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVzZSA9IEVWV0VCMi5TZXJpYWxQb3J0VXNlcy5VbnVzZWQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcmlhbERldmljZVR5cGVzfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gRVZXRUIyLlNlcmlhbERldmljZVR5cGVzLlVua25vd247XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgc2VyaWFsIHByb2ZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoZSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnByb2ZpbGUgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYXBwbGllZCBzdHJlYW0gSUQgZm9yIHRoaXMgc2VyaWFsIGRldmljZS4gIFRoaXMgdmFsdWUgaXMgc2V0IGJ5IHtAbGluayBFVldFQjIuU2VyaWFsRGV2aWNlLmdldERhdGF9LFxuICAgICAgICAgKiBlaXRoZXIgdXNpbmcgdGhlIHByb3ZpZGVkIHN0cmVhbSBJRCBvciBhIHNlcnZlci1nZW5lcmF0ZWQgdmFsdWUgcmVjZWl2ZWQgaW4gdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfG51bGx9XG4gICAgICAgICAqIEBpbnRlcm5hbFxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdmFyIGFwcGxpZWRTdHJlYW1JZCA9IG51bGw7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZih1c2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy51c2UgPSB1c2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHByb2ZpbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXRyaWV2ZXMgc3RyZWFtIGRhdGEgZnJvbSBhIHNlcmlhbCBkZXZpY2UuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGEgYXJyYXkgb2Ygc3RyaW5ncyBvZiBhbnlcbiAgICAgICAgICogIHNlcmlhbCBkYXRhLlxuICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW3N0cmVhbUlkXSBUaGUgdW5pcXVlIHN0cmVhbSBJRCBmb3IgdGhlIGZlZWQuICBJZiB0aGlzIGlzIG5vdCBwcm92aWRlZCwgb25lIHdpbGwgYmVcbiAgICAgICAgICogYXV0b21hdGljYWxseSBnZW5lcmF0ZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldERhdGEgPSBmdW5jdGlvbihjYWxsYmFjaywgc3RyZWFtSWQpIHtcbiAgICAgICAgICAgIHZhciBkZXZpY2UgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgaWYoYXBwbGllZFN0cmVhbUlkID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcGxpZWRTdHJlYW1JZCA9IGRhdGEuc3RyZWFtO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgZGF0YS5kYXRhKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHN0cmVhbUlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBhcHBsaWVkU3RyZWFtSWQgPSBzdHJlYW1JZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgczogZGV2aWNlLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgc2VyaWFsOiBkZXZpY2UuaWRcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKGFwcGxpZWRTdHJlYW1JZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGRhdGEuc3RyZWFtID0gYXBwbGllZFN0cmVhbUlkO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogZGV2aWNlLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VyaWFsRGF0YSxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihkZXZpY2Uuc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIHN0b3JlZCBkYXRhIGZyb20gYSBzZXJpYWwgZGV2aWNlLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlLCBhbiBhcnJheVxuICAgICAgICAgKiAgb2Yge0BsaW5rIEVWV0VCMi5TZXJpYWxTdG9yZWREYXRhfSBpbnN0YW5jZXMsIGFuZCBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBzZWFyY2ggaGFzXG4gICAgICAgICAqICBmaW5pc2hlZCByZXRyaWV2aW5nIGFsbCBvZiB0aGUgZGF0YS4gIElmIHRoaXMgdmFsdWUgaXMgZmFsc2UsIHRoZW4gcmUtY2FsbGluZyB0aGlzIG1ldGhvZCBpc1xuICAgICAgICAgKiAgcmVjb21tZW5kZWQgdG8gZW5zdXJlIHRoYXQgYWxsIHN0b3JlZCBkYXRhIGlzIHJldHJpZXZlZC5cbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHNlYXJjaElkIFRoZSBJRCBvZiB0aGUgc2VhcmNoIGFzc29jaWF0ZWQgd2l0aCB0aGUgc3RvcmVkIHNlcmlhbCBkYXRhLlxuICAgICAgICAgKiBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0U3RvcmVkRGF0YSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBzZWFyY2hJZCkge1xuICAgICAgICAgICAgdmFyIGRldmljZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2VuZCB0aGUgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgc3RvcmVkRGF0YSA9ICQubWFwKGRhdGEuc3RvcmVkLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRVZXRUIyLlNlcmlhbFN0b3JlZERhdGEoZWxlbWVudC5kYXRhLCBFVldFQjIudXRpbC5JRVRGMkRhdGUoZWxlbWVudC5zdGFydCksXG4gICAgICAgICAgICAgICAgICAgICAgICBFVldFQjIudXRpbC5JRVRGMkRhdGUoZWxlbWVudC5lbmQpKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwgc3RvcmVkRGF0YSwgZGF0YS5jb21wbGV0ZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBzOiBzZWFyY2hJZCxcbiAgICAgICAgICAgICAgICBzZXJpYWw6IGRldmljZS5pZFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IGRldmljZS5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcmlhbFN0b3JlZERhdGEsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYoZGV2aWNlLnNlcnZlci5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3Igc2VyaWFsIHByb2ZpbGUgY2FzZSBzZW5zaXRpdml0eSBzZXR0aW5ncy5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFt0cmFuc21pc3Npb25NYXJrZXJzPWZhbHNlXSBXaGV0aGVyIHRyYW5zbWlzc2lvbiBtYXJrZXJzIGFyZSBjYXNlIHNlbnNpdGl2ZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtrZXl3b3Jkcz1mYWxzZV0gV2hldGhlciBrZXl3b3JkcyBhcmUgY2FzZSBzZW5zaXRpdmUuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbWFza3M9ZmFsc2VdIFdoZXRoZXIgbWFza3MgYXJlIGNhc2Ugc2Vuc2l0aXZlLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3JlcGxhY2VtZW50cz1mYWxzZV0gV2hldGhlciByZXBsYWNlbWVudHMgYXJlIGNhc2Ugc2Vuc2l0aXZlLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW3J1bGVzPWZhbHNlXSBXaGV0aGVyIHJ1bGVzIGFyZSBjYXNlIHNlbnNpdGl2ZS5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlNlcmlhbENhc2VTZW5zaXRpdml0eSA9IGZ1bmN0aW9uKHRyYW5zbWlzc2lvbk1hcmtlcnMsIGtleXdvcmRzLCBtYXNrcywgcmVwbGFjZW1lbnRzLCBydWxlcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0cmFuc21pc3Npb24gbWFya2VycyBhcmUgY2FzZSBzZW5zaXRpdmUuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFuc21pc3Npb25NYXJrZXJzID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIga2V5d29yZHMgYXJlIGNhc2Ugc2Vuc2l0aXZlLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMua2V5d29yZHMgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBtYXNrcyBhcmUgY2FzZSBzZW5zaXRpdmUuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tYXNrcyA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHJlcGxhY2VtZW50cyBhcmUgY2FzZSBzZW5zaXRpdmUuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZXBsYWNlbWVudHMgPSBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBydWxlcyBhcmUgY2FzZSBzZW5zaXRpdmUuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ydWxlcyA9IGZhbHNlO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHJhbnNtaXNzaW9uTWFya2VycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zbWlzc2lvbk1hcmtlcnMgPSB0cmFuc21pc3Npb25NYXJrZXJzO1xuICAgICAgICB9XG4gICAgICAgIGlmKGtleXdvcmRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMua2V5d29yZHMgPSBrZXl3b3JkcztcbiAgICAgICAgfVxuICAgICAgICBpZihtYXNrcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hc2tzID0gbWFza3M7XG4gICAgICAgIH1cbiAgICAgICAgaWYocmVwbGFjZW1lbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucmVwbGFjZW1lbnRzID0gcmVwbGFjZW1lbnRzO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJ1bGVzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucnVsZXMgPSBydWxlcztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgb2JqZWN0IGZvciBzZXJpYWwgcHJvZmlsZSB0cmFuc21pc3Npb24gbWFya2VycyBzZXR0aW5ncy5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQcm9maWxlTWFya2VyVHlwZXN9IFt0eXBlPUVWV0VCMi5TZXJpYWxQcm9maWxlTWFya2VyVHlwZXMuU3RhbmRhcmRdIFRoZSB0eXBlIG9mIHRoZSBwcm9maWxlXG4gICAgICogIG1hcmtlci5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0YXJ0PVwiXCJdIFRoZSBzdGFydCBvZiB0cmFuc21pc3Npb24gbWFya2VyLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZW5kPVwiXCJdIFRoZSBlbmQgb2YgdHJhbnNtaXNzaW9uIG1hcmtlci5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlNlcmlhbFByb2ZpbGVNYXJrZXJzID0gZnVuY3Rpb24odHlwZSwgc3RhcnQsIGVuZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgdGhlIHByb2ZpbGUgbWFya2VyLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcmlhbFByb2ZpbGVNYXJrZXJUeXBlc31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IEVWV0VCMi5TZXJpYWxQcm9maWxlTWFya2VyVHlwZXMuU3RhbmRhcmQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzdGFydCBvZiB0cmFuc21pc3Npb24gbWFya2VyLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zdGFydCA9ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZW5kIG9mIHRyYW5zbWlzc2lvbiBtYXJrZXIuXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmVuZCA9ICcnO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYodHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHN0YXJ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcbiAgICAgICAgfVxuICAgICAgICBpZihlbmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5lbmQgPSBlbmQ7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgYSBzZXJpYWwgcHJvZmlsZSBrZXl3b3JkLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbFByb2ZpbGV9IHByb2ZpbGUgVGhlIHNlcmlhbCBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGtleXdvcmQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBJRCBvZiB0aGUgc2VyaWFsIHByb2ZpbGUga2V5d29yZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21hdGNoPVwiXCJdIFRoZSBtYXRjaCB0ZXh0IG9mIHRoZSBrZXl3b3JkLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2VuYWJsZWQ9ZmFsc2VdIFdoZXRoZXIgdGhlIGtleXdvcmQgaXMgZW5hYmxlZC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlNlcmlhbFByb2ZpbGVLZXl3b3JkID0gZnVuY3Rpb24ocHJvZmlsZSwgaWQsIG1hdGNoLCBlbmFibGVkKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VyaWFsIHByb2ZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMga2V5d29yZC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQcm9maWxlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIElEIG9mIHRoZSBzZXJpYWwgcHJvZmlsZSBrZXl3b3JkLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWF0Y2ggdGV4dCBvZiB0aGUga2V5d29yZC5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubWF0Y2ggPSBcIlwiO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBrZXl3b3JkIGlzIGVuYWJsZWQuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihtYXRjaCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLm1hdGNoID0gbWF0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmVuYWJsZWQgPSBlbmFibGVkO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3QgZm9yIGEgc2VyaWFsIHByb2ZpbGUgbGluZSBtYXNrLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbFByb2ZpbGV9IHByb2ZpbGUgVGhlIHNlcmlhbCBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGxpbmUgbWFzay5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21hdGNoPVwiXCJdIFRoZSBtYXRjaCB0ZXh0IG9mIHRoZSBtYXNrLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2xpdmU9ZmFsc2VdIFdoZXRoZXIgdGhlIG1hc2sgaXMgZW5hYmxlZCBmb3IgbGl2ZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzZWFyY2g9ZmFsc2VdIFdoZXRoZXIgdGhlIG1hc2sgaXMgZW5hYmxlZCBmb3Igc2VhcmNoLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsUHJvZmlsZUxpbmVNYXNrID0gZnVuY3Rpb24ocHJvZmlsZSwgbWF0Y2gsIGxpdmUsIHNlYXJjaCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcmlhbCBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGxpbmUgbWFzay5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQcm9maWxlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1hdGNoIHRleHQgb2YgdGhlIG1hc2suXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hdGNoID0gXCJcIjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgbWFzayBpcyBlbmFibGVkIGZvciBsaXZlLlxuICAgICAgICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGl2ZSA9IGZhbHNlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoZSBtYXNrIGlzIGVuYWJsZWQgZm9yIHNlYXJjaC5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlYXJjaCA9IGZhbHNlO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobWF0Y2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tYXRjaCA9IG1hdGNoO1xuICAgICAgICB9XG4gICAgICAgIGlmKGxpdmUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5saXZlID0gbGl2ZTtcbiAgICAgICAgfVxuICAgICAgICBpZihzZWFyY2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZWFyY2ggPSBzZWFyY2g7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgYSBzZXJpYWwgcHJvZmlsZSByZXBsYWNlbWVudC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQcm9maWxlfSBwcm9maWxlIFRoZSBzZXJpYWwgcHJvZmlsZSBhc3NvY2lhdGVkIHdpdGggdGhpcyByZXBsYWNlbWVudC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21hdGNoPVwiXCJdIFRoZSBtYXRjaCB0ZXh0IG9mIHRoZSByZXBsYWNlbWVudC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3JlcGxhY2U9XCJcIl0gVGhlIHJlcGxhY2UgdGV4dCBvZiB0aGUgcmVwbGFjZW1lbnQuXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbGl2ZT1mYWxzZV0gV2hldGhlciB0aGUgcmVwbGFjZW1lbnQgaXMgZW5hYmxlZCBmb3IgbGl2ZS5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtzZWFyY2g9ZmFsc2VdIFdoZXRoZXIgdGhlIHJlcGxhY2VtZW50IGlzIGVuYWJsZWQgZm9yIHNlYXJjaC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY29uc3RydWN0b3JcbiAgICAgKiBAY2F0ZWdvcnkgU2VyaWFsXG4gICAgICovXG4gICAgRVZXRUIyLlNlcmlhbFByb2ZpbGVSZXBsYWNlbWVudCA9IGZ1bmN0aW9uKHByb2ZpbGUsIG1hdGNoLCByZXBsYWNlLCBsaXZlLCBzZWFyY2gpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJpYWwgcHJvZmlsZSBhc3NvY2lhdGVkIHdpdGggdGhpcyByZXBsYWNlbWVudC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQcm9maWxlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1hdGNoIHRleHQgb2YgdGhlIHJlcGxhY2VtZW50LlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tYXRjaCA9IFwiXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtYXRjaCB0ZXh0IG9mIHRoZSByZXBsYWNlbWVudC5cbiAgICAgICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVwbGFjZSA9IFwiXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHJlcGxhY2VtZW50IGlzIGVuYWJsZWQgZm9yIGxpdmUuXG4gICAgICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5saXZlID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgdGhlIHJlcGxhY2VtZW50IGlzIGVuYWJsZWQgZm9yIHNlYXJjaC5cbiAgICAgICAgICogQHR5cGUge2Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlYXJjaCA9IGZhbHNlO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYobWF0Y2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5tYXRjaCA9IG1hdGNoO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJlcGxhY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZXBsYWNlID0gcmVwbGFjZTtcbiAgICAgICAgfVxuICAgICAgICBpZihsaXZlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMubGl2ZSA9IGxpdmU7XG4gICAgICAgIH1cbiAgICAgICAgaWYoc2VhcmNoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoID0gc2VhcmNoO1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQ29udGFpbmVyIG9iamVjdCBmb3IgYSBzZXJpYWwgcHJvZmlsZSBydWxlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbFByb2ZpbGV9IHByb2ZpbGUgVGhlIHNlcmlhbCBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJ1bGUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGlkIFRoZSBJRCBvZiB0aGUgc2VyaWFsIHByb2ZpbGUgcnVsZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcnVsZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQcm9maWxlUnVsZVBhdHRlcm5bXX0gW3BhdHRlcm5zPVtdXSBUaGUgcGF0dGVybnMgZGVmaW5pbmcgdGhlIHJ1bGUuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZSA9IGZ1bmN0aW9uKHByb2ZpbGUsIGlkLCBuYW1lLCBwYXR0ZXJucykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcmlhbCBwcm9maWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJ1bGUuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsUHJvZmlsZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJvZmlsZSA9IHByb2ZpbGU7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBJRCBvZiB0aGUgc2VyaWFsIHByb2ZpbGUgcnVsZS5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVFRoZSBuYW1lIG9mIHRoZSBydWxlLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBhdHRlcm5zIGRlZmluaW5nIHRoZSBydWxlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcmlhbFByb2ZpbGVSdWxlUGF0dGVybltdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXR0ZXJucyA9IFtdO1xuXG4gICAgICAgIC8vQXNzaWduIHRoZSBjb25zdHJ1Y3RvciB2YWx1ZXNcbiAgICAgICAgaWYocGF0dGVybnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5wYXR0ZXJucyA9IHBhdHRlcm5zO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIENvbnRhaW5lciBvYmplY3QgZm9yIGEgc2VyaWFsIHByb2ZpbGUgcnVsZSBwYXR0ZXJuLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBUaGUgSUQgb2YgdGhlIHJ1bGUgcGF0dGVybi5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxQcm9maWxlUnVsZUZpZWxkUG9zaXRpb25zfSBbcG9zaXRpb249RVZXRUIyLlNlcmlhbFByb2ZpbGVSdWxlRmllbGRQb3NpdGlvbnMuQmVmb3JlXSBUaGVcbiAgICAgKiAgcG9zaXRpb24gb2YgdGhlIGZpZWxkLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbZmllbGQ9XCJcIl0gVGhlIGZpZWxkIG9mIHRoZSBydWxlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbFByb2ZpbGVSdWxlT3BlcmF0b3JUeXBlc30gW29wPUVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZU9wZXJhdG9yVHlwZXMuRXF1YWxdIFRoZSBvcGVyYXRvciBvZlxuICAgICAqICB0aGUgcnVsZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3ZhbHVlPVwiXCJdIFRoZSB2YWx1ZSBvZiB0aGUgcnVsZVxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBTZXJpYWxcbiAgICAgKi9cbiAgICBFVldFQjIuU2VyaWFsUHJvZmlsZVJ1bGVQYXR0ZXJuID0gZnVuY3Rpb24oaWQsIHBvc2l0aW9uLCBmaWVsZCwgb3AsIHZhbHVlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIHJ1bGUgcGF0dGVybi5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBvc2l0aW9uIG9mIHRoZSBmaWVsZC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQcm9maWxlUnVsZUZpZWxkUG9zaXRpb25zfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZUZpZWxkUG9zaXRpb25zLkJlZm9yZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZpZWxkIG9mIHRoZSBydWxlLlxuICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5maWVsZCA9IFwiXCI7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBvcGVyYXRvciBvZiB0aGUgcnVsZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJpYWxQcm9maWxlUnVsZU9wZXJhdG9yVHlwZXN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9wID0gRVZXRUIyLlNlcmlhbFByb2ZpbGVSdWxlT3BlcmF0b3JUeXBlcy5FcXVhbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHZhbHVlIG9mIHRoZSBydWxlXG4gICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZhbHVlID0gXCJcIjtcblxuICAgICAgICAvL0Fzc2lnbiB0aGUgY29uc3RydWN0b3IgdmFsdWVzXG4gICAgICAgIGlmKHBvc2l0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgfVxuICAgICAgICBpZihmaWVsZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYob3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5vcCA9IG9wO1xuICAgICAgICB9XG4gICAgICAgIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDb250YWluZXIgb2JqZWN0IGZvciBzZXJpYWwgcHJvZmlsZSBpbmZvcm1hdGlvbi5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJ2ZXJ9IHNlcnZlciBUaGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHNlcmlhbCBwcm9maWxlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpZCBUaGUgSUQgb2YgdGhlIHNlcmlhbCBwcm9maWxlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBzZXJpYWwgcHJvZmlsZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Gb250SW5mb30gZm9udEluZm8gVGhlIGZvbnQgc2V0dGluZ3MgZm9yIHRoZSBzZXJpYWwgcHJvZmlsZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5TZXJpYWxDYXNlU2Vuc2l0aXZpdHl9IGNhc2VTZW5zaXRpdml0eSBUaGUgY2FzZSBzZW5zaXRpdml0eSBzZXR0aW5ncyBmb3IgdGhlIHNlcmlhbCBwcm9maWxlLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcmlhbFByb2ZpbGVNYXJrZXJzfSBtYXJrZXJzIFRoZSBtYXJrZXJzIGNvbmZpZ3VyYXRpb24gZm9yIHRoZSBzZXJpYWwgcHJvZmlsZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3JldGVudGlvbj04Nzg0MF0gVGhlIHJldGVudGlvbiBwZXJpb2Qgb2YgdGhlIHByb2ZpbGUsIGluIHNlY29uZHMuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNvbnN0cnVjdG9yXG4gICAgICogQGNhdGVnb3J5IFNlcmlhbFxuICAgICAqL1xuICAgIEVWV0VCMi5TZXJpYWxQcm9maWxlID0gZnVuY3Rpb24oc2VydmVyLCBpZCwgbmFtZSwgZm9udEluZm8sIGNhc2VTZW5zaXRpdml0eSwgbWFya2VycywgcmV0ZW50aW9uKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgc2VydmVyIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHNlcmlhbCBwcm9maWxlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIHNlcmlhbCBwcm9maWxlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbmFtZSBvZiB0aGUgc2VyaWFsIHByb2ZpbGUuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZm9udCBzZXR0aW5ncyBmb3IgdGhlIHNlcmlhbCBwcm9maWxlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkZvbnRJbmZvfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb250SW5mbyA9IGZvbnRJbmZvO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgY2FzZSBzZW5zaXRpdml0eSBzZXR0aW5ncyBmb3IgdGhlIHNlcmlhbCBwcm9maWxlLlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcmlhbENhc2VTZW5zaXRpdml0eX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2FzZVNlbnNpdGl2aXR5ID0gY2FzZVNlbnNpdGl2aXR5O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbWFya2VycyBjb25maWd1cmF0aW9uIGZvciB0aGUgc2VyaWFsIHByb2ZpbGUuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VyaWFsUHJvZmlsZU1hcmtlcnN9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm1hcmtlcnMgPSBtYXJrZXJzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcmV0ZW50aW9uIHBlcmlvZCBvZiB0aGUgcHJvZmlsZSwgaW4gc2Vjb25kcy5cbiAgICAgICAgICogQHR5cGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmV0ZW50aW9uID0gODc4NDA7XG5cbiAgICAgICAgLy9Bc3NpZ24gdGhlIGNvbnN0cnVjdG9yIHZhbHVlc1xuICAgICAgICBpZihyZXRlbnRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5yZXRlbnRpb24gPSByZXRlbnRpb247XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIGluZm9ybWF0aW9uIG9uIHRoZSBrZXl3b3JkcyBjb25maWd1cmVkIGZvciBhIHByb2ZpbGUuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlcmlhbFByb2ZpbGVLZXl3b3JkfSBpbnN0YW5jZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmdldEtleXdvcmRzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBwcm9maWxlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZW5kIHRoZSBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcblxuICAgICAgICAgICAgICAgIHZhciBrZXl3b3JkcyA9ICQubWFwKGRhdGEua2V5d29yZHMsIGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VyaWFsUHJvZmlsZUtleXdvcmQocHJvZmlsZSwgZWxlbWVudC5pZCwgZWxlbWVudC5tYXRjaCwgZWxlbWVudC5lbmFibGVkKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN1Y2Nlc3NSZXNwb25zZSwga2V5d29yZHMpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IG9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogb25FcnJvcixcbiAgICAgICAgICAgICAgICB1cmw6IHByb2ZpbGUuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5zZXJpYWxQcm9maWxlS2V5d29yZHMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBwcm9maWxlLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHByb2ZpbGU6IHByb2ZpbGUuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihwcm9maWxlLnNlcnZlci5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyBpbmZvcm1hdGlvbiBvbiB0aGUgbGluZSBtYXNrcyBjb25maWd1cmVkIGZvciBhIHByb2ZpbGUuXG4gICAgICAgICAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGNhbGwgY29tcGxldGVzLiBDYWxsYmFjayBpcyBwYXNzZWQgYVxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5SZXNwb25zZVN0YXR1c30gaW5zdGFuY2Ugd2l0aCB0aGUgZGV0YWlscyBvZiB0aGUgcmVzcG9uc2UgYW5kIGFuIGFycmF5IG9mXG4gICAgICAgICAqICB7QGxpbmsgRVZXRUIyLlNlcmlhbFByb2ZpbGVMaW5lTWFza30gaW5zdGFuY2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRMaW5lTWFza3MgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIHByb2ZpbGUgPSB0aGlzO1xuXG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKC8qeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCdBbiBlcnJvciBvY2N1cnJlZC4nKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgaWYoIWRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvL1NlbmQgdGhlIGVycm9yIHJlc3BvbnNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgZGF0YS5lcnJvclRleHQpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvclJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBzdWNjZXNzUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGtleXdvcmRzID0gJC5tYXAoZGF0YS5tYXNrcywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJpYWxQcm9maWxlTGluZU1hc2socHJvZmlsZSwgZWxlbWVudC5tYXRjaCwgZWxlbWVudC5saXZlLCBlbGVtZW50LnNlYXJjaCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIGtleXdvcmRzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBwcm9maWxlLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VyaWFsUHJvZmlsZUxpbmVNYXNrcyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHByb2ZpbGUuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgcHJvZmlsZTogcHJvZmlsZS5pZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmKHByb2ZpbGUuc2VydmVyLnNlcnZpY2UuaXNYc3MoKSkge1xuICAgICAgICAgICAgICAgIEVWV0VCMi51dGlsLnVwZGF0ZVJlcXVlc3RGb3JYc3Moc2V0dGluZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hamF4KHNldHRpbmdzKTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0cmlldmVzIGluZm9ybWF0aW9uIG9uIHRoZSByZXBsYWNlbWVudHMgY29uZmlndXJlZCBmb3IgYSBwcm9maWxlLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5TZXJpYWxQcm9maWxlUmVwbGFjZW1lbnR9IGluc3RhbmNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZ2V0UmVwbGFjZW1lbnRzID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhciBwcm9maWxlID0gdGhpcztcblxuICAgICAgICAgICAgdmFyIG9uRXJyb3IgPSBmdW5jdGlvbigvKnhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24qLykge1xuICAgICAgICAgICAgICAgIHZhciBlcnJvclJlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwnQW4gZXJyb3Igb2NjdXJyZWQuJyk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgb25TdWNjZXNzID0gZnVuY3Rpb24oZGF0YS8qLCB0ZXh0U3RhdHVzLCB4aHIqLykge1xuICAgICAgICAgICAgICAgIGlmKCFkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9TZW5kIHRoZSBlcnJvciByZXNwb25zZVxuICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsIGRhdGEuZXJyb3JUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3JSZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgc3VjY2Vzc1Jlc3BvbnNlID0gbmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyh0cnVlKTtcblxuICAgICAgICAgICAgICAgIHZhciByZXBsYWNlbWVudHMgPSAkLm1hcChkYXRhLnJlcGxhY2VtZW50cywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJpYWxQcm9maWxlUmVwbGFjZW1lbnQocHJvZmlsZSwgZWxlbWVudC5tYXRjaCwgZWxlbWVudC5yZXBsYWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5saXZlLCBlbGVtZW50LnNlYXJjaCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHJlcGxhY2VtZW50cyk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yLFxuICAgICAgICAgICAgICAgIHVybDogcHJvZmlsZS5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLnNlcmlhbFByb2ZpbGVSZXBsYWNlbWVudHMsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiBwcm9maWxlLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIHByb2ZpbGU6IHByb2ZpbGUuaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBpZihwcm9maWxlLnNlcnZlci5zZXJ2aWNlLmlzWHNzKCkpIHtcbiAgICAgICAgICAgICAgICBFVldFQjIudXRpbC51cGRhdGVSZXF1ZXN0Rm9yWHNzKHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQuYWpheChzZXR0aW5ncyk7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHJpZXZlcyBpbmZvcm1hdGlvbiBvbiB0aGUgcnVsZXMgY29uZmlndXJlZCBmb3IgYSBwcm9maWxlLlxuICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjayBGdW5jdGlvbiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBjYWxsIGNvbXBsZXRlcy4gQ2FsbGJhY2sgaXMgcGFzc2VkIGFcbiAgICAgICAgICogIHtAbGluayBFVldFQjIuUmVzcG9uc2VTdGF0dXN9IGluc3RhbmNlIHdpdGggdGhlIGRldGFpbHMgb2YgdGhlIHJlc3BvbnNlIGFuZCBhbiBhcnJheSBvZlxuICAgICAgICAgKiAge0BsaW5rIEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZX0gaW5zdGFuY2VzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5nZXRSdWxlcyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXIgcHJvZmlsZSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oLyp4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICB2YXIgZXJyb3JSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXMoZmFsc2UsJ0FuIGVycm9yIG9jY3VycmVkLicpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBpZighZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vU2VuZCB0aGUgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVzcG9uc2UgPSBuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBkYXRhLmVycm9yVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHN1Y2Nlc3NSZXNwb25zZSA9IG5ldyBFVldFQjIuUmVzcG9uc2VTdGF0dXModHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcnVsZXMgPSAkLm1hcChkYXRhLnJ1bGVzLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXR0ZXJucyA9ICQubWFwKGVsZW1lbnQucGF0dGVybnMsIGZ1bmN0aW9uKGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEVWV0VCMi5TZXJpYWxQcm9maWxlUnVsZVBhdHRlcm4oZWwuaWQsIGVsLmZpZWxkUG9zaXRpb24sIGVsLmZpZWxkLCBlbC5vcCwgZWwudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFVldFQjIuU2VyaWFsUHJvZmlsZVJ1bGUocHJvZmlsZSwgZWxlbWVudC5pZCwgZWxlbWVudC5uYW1lLCBwYXR0ZXJucyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhzdWNjZXNzUmVzcG9uc2UsIHJ1bGVzKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3IsXG4gICAgICAgICAgICAgICAgdXJsOiBwcm9maWxlLnNlcnZlci5zZXJ2aWNlLnVybCgpICsgRVZXRUIyLnVybHMuc2VyaWFsUHJvZmlsZVJ1bGVzLFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgczogcHJvZmlsZS5zZXJ2ZXIuc2Vzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgICBwcm9maWxlOiBwcm9maWxlLmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYocHJvZmlsZS5zZXJ2ZXIuc2VydmljZS5pc1hzcygpKSB7XG4gICAgICAgICAgICAgICAgRVZXRUIyLnV0aWwudXBkYXRlUmVxdWVzdEZvclhzcyhzZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmFqYXgoc2V0dGluZ3MpO1xuICAgICAgICB9O1xuXG4gICAgfTtcblxufSgpKTsiLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2YgZXZlbnRzLlxuICAgICAqIEBlbnVtIHtudW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IEV2ZW50c1xuICAgICAqL1xuICAgIEVWV0VCMi5FdmVudFR5cGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogVmlkZW8gTW90aW9uXG4gICAgICAgICAqL1xuICAgICAgICB2aWRlb01vdGlvbjogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFZpZGVvIExvc3NcbiAgICAgICAgICovXG4gICAgICAgIHZpZGVvTG9zczogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElucHV0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0VHJpZ2dlcjogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbCBQb3J0XG4gICAgICAgICAqL1xuICAgICAgICBzZXJpYWxQb3J0OiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VyaWFsIFByb2ZpbGVcbiAgICAgICAgICovXG4gICAgICAgIHNlcmlhbFByb2ZpbGU6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBCdXR0b24gSW5wdXRcbiAgICAgICAgICovXG4gICAgICAgIGJ1dHRvbklucHV0OiA2LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGV2aWNlIEZhaWx1cmVcbiAgICAgICAgICovXG4gICAgICAgIGRldmljZUZhaWx1cmU6IDcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXZpY2UgVGVtcGVyYXR1cmVcbiAgICAgICAgICovXG4gICAgICAgIGRldmljZVRlbXBlcmF0dXJlOiA4LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGV2aWNlIEZhblxuICAgICAgICAgKi9cbiAgICAgICAgZGV2aWNlRmFuOiA5LFxuICAgICAgICAvKipcbiAgICAgICAgICogRGV2aWNlIFBvd2VyIFN1cHBseVxuICAgICAgICAgKi9cbiAgICAgICAgZGV2aWNlUG93ZXJTdXBwbHk6IDEwLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3RvcmFnZVxuICAgICAgICAgKi9cbiAgICAgICAgc3RvcmFnZTogMTEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdWJzY3JpcHRpb24gRXhwaXJhdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc3Vic2NyaXB0aW9uRXhwaXJhdGlvbjogMTIsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBWaWRlbyBUaHJvdHRsaW5nXG4gICAgICAgICAqL1xuICAgICAgICB2aWRlb1Rocm90dGxpbmc6IDEzLFxuICAgICAgICAvKipcbiAgICAgICAgICogU3lzdGVtIFZvbHRhZ2VcbiAgICAgICAgICovXG4gICAgICAgIHN5c3RlbVZvbHRhZ2U6IDE0LFxuICAgICAgICAvKipcbiAgICAgICAgICogU3lzdGVtIFRlbXBlcmF0dXJlXG4gICAgICAgICAqL1xuICAgICAgICBzeXN0ZW1UZW1wZXJhdHVyZTogMTUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTeXN0ZW0gRmFuXG4gICAgICAgICAqL1xuICAgICAgICBzeXN0ZW1GYW46IDE2LFxuICAgICAgICAvKipcbiAgICAgICAgICogQXJjaGl2ZSBDb25uZWN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBhcmNoaXZlQ29ubmVjdGlvbjogMTcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcmNoaXZlIFRhc2tcbiAgICAgICAgICovXG4gICAgICAgIGFyY2hpdmVUYXNrOiAxOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlY29yZCBDb250ZW50IEFnZVxuICAgICAgICAgKi9cbiAgICAgICAgcmVjb3JkQ29udGVudEFnZTogMTksXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBcmNoaXZlIENvbnRlbnQgQWdlXG4gICAgICAgICAqL1xuICAgICAgICBhcmNoaXZlQ29udGVudEFnZTogMjAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJUCBDYW1lcmEgQ29ubmVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgaXBDYW1lcmFDb25uZWN0aW9uOiAyMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvZnQgVHJpZ2dlclxuICAgICAgICAgKi9cbiAgICAgICAgc29mdFRyaWdnZXI6IDIyLFxuICAgICAgICAvKipcbiAgICAgICAgICogVGltZSBUcmlnZ2VyXG4gICAgICAgICAqL1xuICAgICAgICB0aW1lVHJpZ2dlcjogMjMsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmFseXRpY3NcbiAgICAgICAgICovXG4gICAgICAgIGFuYWx5dGljczogMjQsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPdXRib3VuZCBDb25uZWN0aW9uXG4gICAgICAgICAqL1xuICAgICAgICBvdXRib3VuZENvbm5lY3Rpb246IDI1LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VjdXJpdHkgSW50ZWdyYXRpb24gQ29ubmVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgc2VjdXJpdHlJbnRlZ3JhdGlvbkNvbm5lY3Rpb246IDI2LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VjdXJpdHkgSW50ZWdyYXRpb24gQWxlcnRcbiAgICAgICAgICovXG4gICAgICAgIHNlY3VyaXR5SW50ZWdyYXRpb25BbGVydDogMjcsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZWN1cml0eSBJbnRlZ3JhdGlvbiBBbGFybVxuICAgICAgICAgKi9cbiAgICAgICAgc2VjdXJpdHlJbnRlZ3JhdGlvbkFsYXJtOiAyOCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbCBQb3J0IENvbm5lY3Rpb25cbiAgICAgICAgICovXG4gICAgICAgIHNlcmlhbFBvcnRDb25uZWN0aW9uOiAyOVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgdHlwZXMgb2YgaXRlbXMgYXNzb2NpYXRlZCB3aXRoIGV2ZW50cy5cbiAgICAgKiBAZW51bSB7bnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBFdmVudHNcbiAgICAgKi9cbiAgICBFVldFQjIuRXZlbnRJdGVtVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd25cbiAgICAgICAgICovXG4gICAgICAgIHVua25vd246IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYW1lcmFcbiAgICAgICAgICovXG4gICAgICAgIGNhbWVyYTogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF1ZGlvXG4gICAgICAgICAqL1xuICAgICAgICBhdWRpbzogMixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIElucHV0IFRyaWdnZXJcbiAgICAgICAgICovXG4gICAgICAgIGlucHV0VHJpZ2dlcjogMyxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlcmlhbCBLZXl3b3JkXG4gICAgICAgICAqL1xuICAgICAgICBzZXJpYWxLZXl3b3JkOiA0LFxuICAgICAgICAvKipcbiAgICAgICAgICogU2VyaWFsIFByb2ZpbGVcbiAgICAgICAgICovXG4gICAgICAgIHNlcmlhbFByb2ZpbGU6IDUsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbmFseXRpY3MgUnVsZVxuICAgICAgICAgKi9cbiAgICAgICAgYW5hbHl0aWNzUnVsZTogNixcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNlY3VyaXR5IEludGVncmF0aW9uIFNlbnNvclxuICAgICAgICAgKi9cbiAgICAgICAgc2VjdXJpdHlJbnRlZ3JhdGlvblNlbnNvcjogN1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgRXZlbnRFeHRyYUluZm8gb2JqZWN0IHJlcHJlc2VudHMgYW4gYWRkaXRpb25hbCBkZXZpY2UgaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIGFuIGV2ZW50LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaWQgVGhlIElEIG9mIHRoZSBhZGRpdGlvbmFsIGl0ZW0gYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudEl0ZW1UeXBlfSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBhZGRpdGlvbmFsIGl0ZW0gYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgRXZlbnRzXG4gICAgICovXG4gICAgRVZXRUIyLkV2ZW50RXh0cmFJbmZvID0gZnVuY3Rpb24oc2VydmVyLCBpZCwgdHlwZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLlNlcnZlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VydmVyID0gc2VydmVyO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIGFkZGl0aW9uYWwgaXRlbSBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50LlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiB0aGUgYWRkaXRpb25hbCBpdGVtIGFzc29jaWF0ZWQgd2l0aCB0aGUgZXZlbnQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuRXZlbnRJdGVtVHlwZX1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG5cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogVGhlIEV2ZW50IG9iamVjdCByZXByZXNlbnRzIGFuIGFjdGl2ZSBldmVudCBvbiB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gc2VydmVyIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5FdmVudFR5cGV9IHR5cGUgVGhlIHR5cGUgb2YgZXZlbnQuXG4gICAgICogQHBhcmFtIHtEYXRlfSB0aW1lIFRoZSB0aW1lIHRoYXQgdGhlIGV2ZW50IHdhcyB0cmlnZ2VyZWQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtkZXZpY2VJZF0gRGV2aWNlIElEIG9mIGRldmljZSBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50RXh0cmFJbmZvfSBbZXh0cmFJbmZvXSBFeHRyYSBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50LlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBFdmVudHNcbiAgICAgKi9cbiAgICBFVldFQjIuRXZlbnQgPSBmdW5jdGlvbihzZXJ2ZXIsIHR5cGUsIHRpbWUsIGRldmljZUlkLCBleHRyYUluZm8pIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXJ2ZXIgYXNzb2NpYXRlZCB3aXRoIHRoZSBldmVudC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlcjtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHR5cGUgb2YgZXZlbnQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuRXZlbnRUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHRpbWUgdGhhdCB0aGUgZXZlbnQgd2FzIHRyaWdnZXJlZC5cbiAgICAgICAgICogQHR5cGUge0RhdGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRpbWUgPSB0aW1lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZXZpY2UgSUQgb2YgZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgZXZlbnQuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ8bnVsbH1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGV2aWNlSWQgPSBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFeHRyYSBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggdGhlIGV2ZW50LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkV2ZW50RXh0cmFJbmZvfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4dHJhSW5mbyA9IG51bGw7XG5cbiAgICAgICAgaWYoZGV2aWNlSWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5kZXZpY2VJZCA9IGRldmljZUlkO1xuICAgICAgICB9XG4gICAgICAgIGlmKGV4dHJhSW5mbyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmV4dHJhSW5mbyA9IGV4dHJhSW5mbztcbiAgICAgICAgfVxuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8qKlxuICAgICAqIFRoZSBhdmFpbGFibGUgdHlwZXMgb2YgYXJjaGl2ZSB0YXJnZXRzLlxuICAgICAqIEBlbnVtIHtOdW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IEFyY2hpdmluZ1xuICAgICAqL1xuICAgIEVWV0VCMi5hcmNoaXZlVGFyZ2V0VHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vbmVcbiAgICAgICAgICovXG4gICAgICAgIG5vbmU6IDAsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTTUJcbiAgICAgICAgICovXG4gICAgICAgIHNtYjogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5GU1xuICAgICAgICAgKi9cbiAgICAgICAgbmZzOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogaVNDU0lcbiAgICAgICAgICovXG4gICAgICAgIGlzY3NpOiAzLFxuICAgICAgICAvKipcbiAgICAgICAgICogQ2xvdWRcbiAgICAgICAgICovXG4gICAgICAgIGNsb3VkOiA0XG4gICAgfTtcblxuICAgIC8qKiBcbiAgICAgKiBUaGUgYXZhaWxhYmxlIG1ldGhvZHMgZm9yIGFyY2hpdmUgY29udGVudCBleHBpcmF0aW9uLlxuICAgICAqIEBlbnVtIHtOdW1iZXJ9XG4gICAgICogQHJlYWRvbmx5XG4gICAgICogQGNhdGVnb3J5IEFyY2hpdmluZ1xuICAgICAqL1xuICAgIEVWV0VCMi5hcmNoaXZlRXhwaXJhdGlvblR5cGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb25lXG4gICAgICAgICAqL1xuICAgICAgICBub25lOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogQXQgbGVhc3QuICBOb3RlOiBUaGlzIHNob3VsZCBuZXZlciBvY2N1ciB3aXRoIGFuIGFyY2hpdmUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgYXRMZWFzdDogMSxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEF0IG1vc3RcbiAgICAgICAgICovXG4gICAgICAgIGF0TW9zdDogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBUaGUgQXJjaGl2ZVRhcmdldCBpcyBhIGNvbnRhaW5lciBmb3IgYW4gbnZyIGFyY2hpdmUgdGFyZ2V0LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLlNlcnZlcn0gW3NlcnZlcj1udWxsXSBUaGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgYXJjaGl2ZSB0YXJnZXQuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpZD0wXSBUaGUgc2VydmVyLWFzc2lnbmVkIGlkZW50aWZpZXIgZm9yIHRoZSBhcmNoaXZlIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtlbmFibGVkPWZhbHNlXSBXaGV0aGVyIHRoZSB0YXJnZXQgaXMgY3VycmVudGx5IGVuYWJsZWQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuYXJjaGl2ZVRhcmdldFR5cGV9IFt0eXBlPUVWV0VCMi5hcmNoaXZlVGFyZ2V0VHlwZS5ub25lXSBUaGUgdHlwZSBvZiB0aGlzIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5BcmNoaXZlVXBsb2FkQ29uZmlnfSBbdXBsb2FkPW51bGxdIFRoZSB1cGxvYWRpbmcgY29uZmlndXJhdGlvbiBmb3IgdGhpcyB0YXJnZXQuXG4gICAgICogQHBhcmFtIHtFVldFQjIuQXJjaGl2ZVNlYXJjaENvbmZpZ30gW3NlYXJjaD1udWxsXSBUaGUgZGlyZWN0IHNlYXJjaCBjb25maWd1cmF0aW9uIGZvciB0aGlzIHRhcmdldC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgQXJjaGl2aW5nXG4gICAgICovXG4gICAgRVZXRUIyLkFyY2hpdmVUYXJnZXQgPSBmdW5jdGlvbihzZXJ2ZXIsIGlkLCBlbmFibGVkLCB0eXBlLCB1cGxvYWQsIHNlYXJjaCkge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUge0BsaW5rIEVWV0VCMi5TZXJ2ZXJ9IGluc3RhbmNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgYXJjaGl2ZSB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuU2VydmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXIgfHwgbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlci1hc3NpZ25lZCBpZGVudGlmaWVyIGZvciB0aGUgYXJjaGl2ZSB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlkID0gaWQgfHwgMDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgdGFyZ2V0IGlzIGN1cnJlbnRseSBlbmFibGVkLlxuICAgICAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZW5hYmxlZCA9IGVuYWJsZWQgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB0eXBlIG9mIHRoaXMgdGFyZ2V0LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLmFyY2hpdmVUYXJnZXRUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gdHlwZSB8fCBFVldFQjIuYXJjaGl2ZVRhcmdldFR5cGUubm9uZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHVwbG9hZGluZyBjb25maWd1cmF0aW9uIGZvciB0aGlzIHRhcmdldC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5BcmNoaXZlVXBsb2FkQ29uZmlnfG51bGx9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnVwbG9hZCA9IHVwbG9hZCB8fCBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGlyZWN0IHNlYXJjaCBjb25maWd1cmF0aW9uIGZvciB0aGlzIHRhcmdldC5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5BcmNoaXZlU2VhcmNoQ29uZmlnfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZWFyY2ggPSBzZWFyY2ggfHwgbnVsbDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQXJjaGl2ZVVwbG9hZENvbmZpZyByZXByZXNlbnRzIHRoZSB1cGxvYWQgY29uZmlndXJhdGlvbiBmb3IgYW4ge0BsaW5rIEVWV0VCMi5BcmNoaXZlVGFyZ2V0fS4gTm90ZSB0aGF0IHRhcmdldHNcbiAgICAgKiBvZiB0aGUge0BsaW5rIEVWV0VCMi5hcmNoaXZlVGFyZ2V0VHlwZS5jbG91ZH0gZG8gbm90IHVzZSBtb3N0IG9mIHRoZXNlIHNldHRpbmdzLCBhcyB1cGxvYWRpbmcgZm9yIHRoYXQga2luZCBvZlxuICAgICAqIGFyY2hpdmUgaXMgbWFuYWdlZCBkaWZmZXJlbnRseS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW2FkZHJlc3NdIFRoZSBhZGRyZXNzIHVzZWQgdG8gdXBsb2FkIHRvIHRoZSBhcmNoaXZlLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2hhc0Jvb2ttYXJrcz1mYWxzZV0gV2hldGhlciB0aGUgYXJjaGl2ZSBzdXBwb3J0cyBib29rbWFya2luZy5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BlcmNlbnRUb1VzZT0wXSBUaGUgcGVyY2VudCBvZiBhcmNoaXZlIGRpc2sgc3BhY2UgdG8gdXNlIGZvciBzdG9yYWdlLiBDbG91ZCBhcmNoaXZlcyB3aWxsIGFsd2F5c1xuICAgICAqIHVzZSAxMDAlIG9mIGF2YWlsYWJsZSBkaXNrIHNwYWNlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFt1c2VybmFtZV0gVGhlIHVzZXJuYW1lIHVzZWQgdG8gdXBsb2FkIHRvIHRoZSBhcmNoaXZlLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBbcGFzc3dvcmRdIFRoZSBwYXNzd29yZCB1c2VkIHRvIHVwbG9hZCB0byB0aGUgYXJjaGl2ZS5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW21vdW50UG9pbnRdIFRoZSBtb3VudCBwb2ludCBvZiB0aGUgYXJjaGl2ZSBvbiB0aGUgbnZyIGZpbGUgc3lzdGVtLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbZGVzaXJlZENvbnRlbnRBZ2VdIFRoZSBtaW5pbXVtIGRlc2lyZWQgYW1vdW50IG9mIGZvb3RhZ2UsIGluIHNlY29uZHMsIHRoYXQgdGhlIGFyY2hpdmUgc2hvdWxkXG4gICAgICogc3RvcmUuIFN0b3JpbmcgbGVzcyB0aGFuIHRoaXMgd2lsbCBjYXVzZSB0aGUgc2VydmVyIHRvIGVtaXQgYW4gYWxhcm0gc3RhdGUuXG4gICAgICogQHBhcmFtIHtFVldFQjIuYXJjaGl2ZUV4cGlyYXRpb25UeXBlfSBbZXhwaXJhdGlvblR5cGU9RVZXRUIyLmFyY2hpdmVFeHBpcmF0aW9uVHlwZS5ub25lXSBUaGUgdHlwZSBvZiBjb250ZW50IGV4cGlyYXRpb25cbiAgICAgKiB1c2VkIHRvIGRldGVybWluZSB0aGUgbGlmZXRpbWUgb2YgdXBsb2FkZWQgZm9vdGFnZS4gQ29udGVudCBvbiBhbiBhcmNoaXZlIGlzIGFsd2F5cyBzdG9yZWQgdXAgdG8gYW4gZWZmZWN0aXZlIFwibWF4aW11bVwiXG4gICAgICogYWdlLCBtZWFuaW5nIHRoYXQgdGhpcyB2YWx1ZSBzaG91bGQgYWx3YXlzIGJlIHtAbGluayBFVldFQjIuYXJjaGl2ZUV4cGlyYXRpb25UeXBlLmF0TW9zdH0uXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtleHBpcmF0aW9uRHVyYXRpb25dIFRoZSBhbW91bnQgb2YgdGltZSwgaW4gc2Vjb25kcywgdGhhdCBkZXRlcm1pbmVzIGhvdyBjb250ZW50IGV4cGlyZXMgb24gdGhlIHNlcnZlcixcbiAgICAgKiB1c2VkIGluIHRhbmRlbSB3aXRoIHRoZSAnZXhwaXJhdGlvblR5cGUnIHByb3BlcnR5LlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBBcmNoaXZpbmdcbiAgICAgKi9cbiAgICBFVldFQjIuQXJjaGl2ZVVwbG9hZENvbmZpZyA9IGZ1bmN0aW9uKGFkZHJlc3MsIGhhc0Jvb2ttYXJrcywgcGVyY2VudFRvVXNlLCB1c2VybmFtZSwgcGFzc3dvcmQsIG1vdW50UG9pbnQsXG4gICAgICAgIGRlc2lyZWRDb250ZW50QWdlLCBleHBpcmF0aW9uVHlwZSwgZXhwaXJhdGlvbkR1cmF0aW9uKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBhZGRyZXNzIHVzZWQgdG8gdXBsb2FkIHRvIHRoZSBhcmNoaXZlLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5hZGRyZXNzID0gYWRkcmVzcyB8fCAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgYXJjaGl2ZSBzdXBwb3J0cyBib29rbWFya2luZy5cbiAgICAgICAgICogQHR5cGUge0Jvb2xlYW59XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmhhc0Jvb2ttYXJrcyA9IGhhc0Jvb2ttYXJrcyB8fCBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBlcmNlbnQgb2YgYXJjaGl2ZSBkaXNrIHNwYWNlIHRvIHVzZSBmb3Igc3RvcmFnZS4gQ2xvdWQgYXJjaGl2ZXMgd2lsbCBhbHdheXMgdXNlIDEwMCVcbiAgICAgICAgICogb2YgYXZhaWxhYmxlIGRpc2sgc3BhY2VcbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucGVyY2VudFRvVXNlID0gcGVyY2VudFRvVXNlIHx8IDA7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1c2VybmFtZSB1c2VkIHRvIHVwbG9hZCB0byB0aGUgYXJjaGl2ZS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBhc3N3b3JkIHVzZWQgdG8gdXBsb2FkIHRvIHRoZSBhcmNoaXZlLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbW91bnQgcG9pbnQgb2YgdGhlIGFyY2hpdmUgb24gdGhlIG52ciBmaWxlIHN5c3RlbS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubW91bnRQb2ludCA9IG1vdW50UG9pbnQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBtaW5pbXVtIGRlc2lyZWQgYW1vdW50IG9mIGZvb3RhZ2UsIGluIHNlY29uZHMsIHRoYXQgdGhlIGFyY2hpdmUgc2hvdWxkXG4gICAgICAgICAqIHN0b3JlLiBTdG9yaW5nIGxlc3MgdGhhbiB0aGlzIHdpbGwgY2F1c2UgdGhlIHNlcnZlciB0byBlbWl0IGFuIGFsYXJtIHN0YXRlLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kZXNpcmVkQ29udGVudEFnZSA9IGRlc2lyZWRDb250ZW50QWdlO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiBjb250ZW50IGV4cGlyYXRpb24gdXNlZCB0byBkZXRlcm1pbmUgdGhlIGxpZmV0aW1lIG9mIHVwbG9hZGVkIGZvb3RhZ2UuIENvbnRlbnQgb25cbiAgICAgICAgICogYW4gYXJjaGl2ZSBpcyBhbHdheXMgc3RvcmVkIHVwIHRvIGFuIGVmZmVjdGl2ZSBcIm1heGltdW1cIiBhZ2UsIG1lYW5pbmcgdGhhdCB0aGlzIHZhbHVlIHNob3VsZFxuICAgICAgICAgKiBhbHdheXMgYmUge0BsaW5rIEVWV0VCMi5hcmNoaXZlRXhwaXJhdGlvblR5cGUuYXRNb3N0fS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5hcmNoaXZlRXhwaXJhdGlvblR5cGV9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4cGlyYXRpb25UeXBlID0gZXhwaXJhdGlvblR5cGUgfHwgRVZXRUIyLmFyY2hpdmVFeHBpcmF0aW9uVHlwZS5ub25lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgYW1vdW50IG9mIHRpbWUsIGluIHNlY29uZHMsIHRoYXQgZGV0ZXJtaW5lcyBob3cgY29udGVudCBleHBpcmVzIG9uIHRoZSBzZXJ2ZXIsXG4gICAgICAgICAqIHVzZWQgaW4gdGFuZGVtIHdpdGggdGhlICdleHBpcmF0aW9uVHlwZScgcHJvcGVydHkuXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4cGlyYXRpb25EdXJhdGlvbiA9IGV4cGlyYXRpb25EdXJhdGlvbjtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQW4gQXJjaGl2ZVNlYXJjaENvbmZpZyByZXByZXNlbnRzIHRoZSBjb25maWd1cmF0aW9uIGZvciBkaXJlY3Qgc2VhcmNoIG9uIGFuIHtAbGluayBFVldFQjIuQXJjaGl2ZVRhcmdldH0uXG4gICAgICogQGNsYXNzXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbZW5hYmxlZD1mYWxzZV0gV2hldGhlciBkaXJlY3QgYXJjaGl2ZSBzZWFyY2ggaXMgZW5hYmxlZCBmb3IgdGhpcyB0YXJnZXQuXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IFthZGRyZXNzPScnXSBUaGUgYWRkcmVzcyB1c2VkIHRvIGNvbmR1Y3QgZGlyZWN0IHNlYXJjaCBvbiB0aGlzIHRhcmdldC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3VzZXJuYW1lPScnXSBUaGUgdXNlcm5hbWUgdXNlZCBmb3IgZGlyZWN0IHNlYXJjaC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3Bhc3N3b3JkPScnXSBUaGUgcGFzc3dvcmQgdXNlZCBmb3IgZGlyZWN0IHNlYXJjaC5cbiAgICAgKiBAY2F0ZWdvcnkgQXJjaGl2aW5nXG4gICAgICovXG4gICAgRVZXRUIyLkFyY2hpdmVTZWFyY2hDb25maWcgPSBmdW5jdGlvbihlbmFibGVkLCBhZGRyZXNzLCB1c2VybmFtZSwgcGFzc3dvcmQpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBkaXJlY3QgYXJjaGl2ZSBzZWFyY2ggaXMgZW5hYmxlZCBmb3IgdGhpcyB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lbmFibGVkID0gZW5hYmxlZCB8fCBmYWxzZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGFkZHJlc3MgdXNlZCB0byBjb25kdWN0IGRpcmVjdCBzZWFyY2ggb24gdGhpcyB0YXJnZXQuXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzIHx8ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdXNlcm5hbWUgdXNlZCBmb3IgZGlyZWN0IHNlYXJjaC5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZSB8fCAnJztcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHBhc3N3b3JkIHVzZWQgZm9yIGRpcmVjdCBzZWFyY2guXG4gICAgICAgICAqIEB0eXBlIHtTdHJpbmd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhc3N3b3JkID0gcGFzc3dvcmQgfHwgJyc7XG4gICAgfTtcbn0oKSk7XG4iLCIvKmdsb2JhbHMgRVZXRUIyOnRydWUqL1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIC8qKlxuICAgICAqIFRoZSBieXRlIGxlbmd0aCBvZiBvdXIgaW5qZWN0ZWQgZnJhbWUgaGVhZGVyLlxuICAgICAqIEB0eXBlIHtOdW1iZXJ9XG4gICAgICogQGNvbnN0YW50XG4gICAgICovXG4gICAgdmFyIEZSQU1FX0hFQURfTEVOR1RIID0gMjk7XG5cbiAgICAvKipcbiAgICAgKiBUaGUgYnl0ZSBsZW5ndGggb2YgdGhlIGg2MjQgc2VpIHJic3AsIGNvbnRhaW5pbmcgdGhlIHBheWxvYWQgb2YgdHlwZSBzZWlfdXNlcmRhdGFfdW5yZWdpc3RlcmVkLFxuICAgICAqIHRoYXQgd2UgaW5jbHVkZSB3aXRoIGZyYW1lcyB0byBwcm92aWRlIG1ldGFkYXRhLiBUaGlzIGlzIGVmZmVjdGl2ZWx5IHtAbGluayBGUkFNRV9IRUFEX0xFTkdUSH1cbiAgICAgKiBwbHVzIDE2IGJ5dGVzIGZvciB0aGUgZ3VpZCBhbmQgMiBmb3IgdGhlIHNlaV91c2VyZGF0YSB0eXBlL2xlbmd0aC5cbiAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAqIEBjb25zdGFudFxuICAgICAqL1xuICAgIHZhciBTRUlfUkJTUF9MRU5HVEggPSBGUkFNRV9IRUFEX0xFTkdUSCArIDE4O1xuXG4gICAgLyoqXG4gICAgICogRVZXRUIyLlZpZGVvU3RyZWFtIGV4cG9zZXMgYSB2aWRlbyBmcmFtZSBzdHJlYW0uXG4gICAgICogQW4gaW5zdGFuY2UgY2FuIGJlIHVzZWQgZm9yIG11bHRpcGxlIHN0YXJ0L3N0b3AgY2FsbHMgYWNyb3NzIGEgc2luZ2xlIHNlcnZlciBzZXNzaW9uLlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgVGhlIGVuZHBvaW50IGxvY2F0aW9uIHVzZWQgdG8gc3RyZWFtIHZpZGVvLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmNhbWVyYUZvcm1hdHN9IGZvcm1hdCBUaGUgdmlkZW8gZm9ybWF0IGJlaW5nIHVzZWQgZm9yIHRoaXMgc3RyZWFtLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIuVmlkZW9TdHJlYW0gPSBmdW5jdGlvbih1cmwsIGZvcm1hdCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGVuZHBvaW50IGxvY2F0aW9uIHVzZWQgdG8gc3RyZWFtIHZpZGVvLlxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cmwgPSB1cmw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB2aWRlbyBmb3JtYXQgYmVpbmcgdXNlZCBmb3IgdGhpcyBzdHJlYW0uIE9uZSBvZiB7QGxpbmsgRVZXRUIyLmNhbWVyYUZvcm1hdHN9LlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSB1bmRlcmx5aW5nIHdlYnNvY2tldCBjb25uZWN0aW9uIG9uIHdoaWNoIGZyYW1lcyBhcmUgcmVjZWl2ZWQuIFVudXNlZCB3aGVuIHN0cmVhbWluZyB2aWEgbGVnYWN5XG4gICAgICAgICAqIHBvbGxpbmcuXG4gICAgICAgICAqIEB0eXBlIHtXZWJTb2NrZXR9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9jb25uID0gbnVsbDtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQSB0ZXh0IGRlY29kZXIsIHVzZWQgdG8gcmVhZCBSRkMgdGltZXN0YW1wcyBmcm9tIGEgZnJhbWUgcGF5bG9hZC5cbiAgICAgICAgICogQHR5cGUge1RleHREZWNvZGVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBPcGVucyB0aGUgdmlkZW8gc3RyZWFtLCB3aXJpbmcgZnJhbWUvZXJyb3IgY2FsbGJhY2tzIHdpdGggcHJvdmlkZWQgZnVuY3Rpb25zLlxuICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkZyYW1lIENhbGxiYWNrIGludm9rZWQgd2hlbiBhIGZyYW1lIGlzIHJlY2VpdmVkLiBDYWxsYmFjayBpcyBnaXZlbiBhbiBpbnN0YW5jZSBvZlxuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlZpZGVvRnJhbWV9IGZyb20gdGhlIHN0cmVhbS5cbiAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25FcnJvci4gQ2FsbGJhY2sgaW52b2tlZCB3aGVuIGEgc3RyZWFtIGVycm9yIGlzIGVuY291bnRlcmVkLiBDYWxsYmFjayBpcyBwYXNzZWRcbiAgICAgICAgICogbm8gcGFyYW1ldGVycy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbihvbkZyYW1lLCBvbkVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29ubikge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY29ubiA9IG5ldyBXZWJTb2NrZXQodGhpcy51cmwpO1xuICAgICAgICAgICAgdGhpcy5fY29ubi5iaW5hcnlUeXBlID0gJ2FycmF5YnVmZmVyJztcblxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5fY29ubi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBuZXcgVWludDhBcnJheShtZXNzYWdlLmRhdGEpO1xuICAgICAgICAgICAgICAgIHZhciBoZWFkO1xuICAgICAgICAgICAgICAgIGlmIChzZWxmLmZvcm1hdCA9PT0gRVZXRUIyLmNhbWVyYUZvcm1hdHMuaDI2NCkge1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIHNsaWNlIHRoZSBzZWkgb2ZmIG9mIHRoZSBidWZmZXIgYXMgZGVjb2RlcnMgd2lsbCBza2lwIG92ZXIgaXRcbiAgICAgICAgICAgICAgICAgICAgaGVhZCA9IHNlbGYuX3JlYWRTZWlIZWFkKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWQgPSBzZWxmLl9yZWFkQmluYXJ5SGVhZChkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkoRlJBTUVfSEVBRF9MRU5HVEgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9uRnJhbWUobmV3IEVWV0VCMi5WaWRlb0ZyYW1lKGhlYWQudGltZSwgaGVhZC5mbGFncywgaGVhZC5pc0lmcmFtZSwgZGF0YSkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuX2Nvbm4ub25lcnJvciA9IG9uRXJyb3I7XG4gICAgICAgICAgICB0aGlzLl9jb25uLm9uY2xvc2UgPSBvbkVycm9yO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZXMgdGhlIHZpZGVvIHN0cmVhbS4gTm8gZnVydGhlciBmcmFtZXMgd2lsbCBiZSByZWNlaXZlZCBvbmNlIHRoaXMgbWVzc2FnZSBpcyBjYWxsZWQgdW5sZXNzIHN0YXJ0KClcbiAgICAgICAgICogaXMgaW52b2tlZCBhZ2Fpbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3RvcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9jb25uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9jb25uLm9ubWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9jb25uLm9uZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fY29ubi5vbmNsb3NlID0gbnVsbDtcblxuICAgICAgICAgICAgdGhpcy5fY29ubi5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5fY29ubiA9IG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFBhcnNlIGgyNjQgbWV0YWRhdGEsIHdoaWNoIGNvbWVzIGluIGFuIFNFSSB3aXRoIHNlaV91c2VyZGF0YV91bnJlZ2lzdGVyZWQsIG91dCBvZiBhIHdlYnNvY2tldCBtZXNzYWdlLlxuICAgICAgICAgKiBTaW5jZSB0aGlzIGhhcyB0byBiZSBkb25lIG9uIGV2ZXJ5IGZyYW1lLCB3ZSB0YWtlIGFkdmFudGFnZSBvZiB0aGUgZmFjdCB0aGF0IHRoZSB3ZWIgc2VydmljZVxuICAgICAgICAgKiBwcm92aWRlcyB0aGUgdW5yZWdpc3RlcmVkIHVzZXJkYXRhIFNFSSBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSBtZXNzYWdlLlxuICAgICAgICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IGRhdGEgVGhlIHdlYnNvY2tldCBwYXlsb2FkLlxuICAgICAgICAgKiBAcmV0dXJuIHt7dGltZTogRGF0ZSwgZmxhZ3M6IE51bWJlciwgaXNJZnJhbWU6IEJvb2xlYW59fSBUaGUgZnJhbWUgbWV0YWRhdGEuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9yZWFkU2VpSGVhZCA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIC8vIFRoZSByYnNwIHdpbGwgYmUgb2YgZml4ZWQgbGVuZ3RoIG9uY2UgcHJldmVudGlvbiBieXRlcyBhcmUgc3RyaXBwZWQuXG4gICAgICAgICAgICB2YXIgcmJzcCA9IG5ldyBVaW50OEFycmF5KFNFSV9SQlNQX0xFTkdUSCk7XG5cbiAgICAgICAgICAgIC8vIEdyYWIgdGhlIGNvbXBsZXRlIFJCU1AgbWludXMgdGhlIGVtdWxhdGlvbiBwcmV2ZW50aW9uIGJ5dGVzLlxuICAgICAgICAgICAgLy8gU2tpcCB0aGUgZmlyc3Qgc3RhcnRjb2RlIGFuZCB0aGUgZm9yYmlkZGVuX3plcm8vcmVmX2lkYy90eXBlIGJ5dGUuXG4gICAgICAgICAgICAvLyBzZWUgSVRVLVQgSC4yNjQgNy4zLjFcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSA1LCByaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgKytpLCArK3JpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0gPT09IDB4MDAgJiYgZGF0YVtpKzFdID09PSAweDAwICYmIGRhdGFbaSsyXSA9PT0gMHgwMCAmJiBkYXRhW2krM10gPT09IDB4MDEpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldID09PSAweDAwICYmIGRhdGFbaSsxXSA9PT0gMHgwMCAmJiBkYXRhW2krMl0gPT09IDB4MDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmJzcFtyaV0gPSBkYXRhW2ldO1xuICAgICAgICAgICAgICAgICAgICByYnNwW3JpKzFdID0gZGF0YVtpKzFdO1xuICAgICAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICAgICAgICAgICsrcmk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmJzcFtyaV0gPSBkYXRhW2ldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVGhlIHJic3Agbm93IGNvbnRhaW5zIHRoZSBmdWxsIHNlaV9tZXNzYWdlIHdpdGggcGF5bG9hZCB0eXBlIHVzZXJfZGF0YV91bnJlZ2lzdGVyZWQuXG4gICAgICAgICAgICAvLyBUaGUgZnVsbCBsYXlvdXQgaXM6XG4gICAgICAgICAgICAvLyAgMDogWzEgYnl0ZV0gICAgdTg6IHNlaSBwYXlsb2FkIHR5cGVcbiAgICAgICAgICAgIC8vICAxOiBbMSBieXRlXSAgICB1ODogc2VpIHBheWxvYWQgbGVuZ3RoXG4gICAgICAgICAgICAvLyAgMjogWzE2IGJ5dGVdIHV1aWQ6IG91ciBjb25zdGFudCBndWlkIGZvciB0aGVzZSBtZXRhZGF0YSBwYXlsb2Fkc1xuICAgICAgICAgICAgLy8gMTg6IFsyNCBieXRlXSAgc3RyOiBSRkMzMzM5IHRpbWVzdGFtcFxuICAgICAgICAgICAgLy8gNDI6IFs0IGJ5dGVdICAgdTMyOiBmcmFtZSBmbGFnc1xuICAgICAgICAgICAgLy8gMzA6IFsxIGJ5dGVdICBib29sOiBpZHIgZmxhZ1xuICAgICAgICAgICAgdmFyIHRpbWUgPSBuZXcgRGF0ZSh0aGlzLl9kZWNvZGVyLmRlY29kZShyYnNwLnN1YmFycmF5KDE4LCA0MikpKTtcbiAgICAgICAgICAgIHZhciBmbGFncyA9IHJic3BbNDJdPDwyNCB8IHJic3BbNDNdPDwxNiB8IHJic3BbNDRdPDw4IHwgcmJzcFs0NV07XG4gICAgICAgICAgICB2YXIgaXNJZnJhbWUgPSByYnNwWzQ2XSA9PT0gMHgwMTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGltZTogdGltZSxcbiAgICAgICAgICAgICAgICBmbGFnczogZmxhZ3MsXG4gICAgICAgICAgICAgICAgaXNJZnJhbWU6IGlzSWZyYW1lLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUGFyc2Ugbm9uLWgyNjQgbWV0YWRhdGEsIHdoaWNoIGNvbWVzIGluIGFzIGEgYmluYXJ5IHN0cnVjdHVyZSwgb3V0IG9mIGEgd2Vic29ja2V0IG1lc3NhZ2UuXG4gICAgICAgICAqIEBwYXJhbSB7VWludDhBcnJheX0gZGF0YSBUaGUgd2Vic29ja2V0IHBheWxvYWQuXG4gICAgICAgICAqIEByZXR1cm4ge3t0aW1lOiBEYXRlLCBmbGFnczogTnVtYmVyLCBpc0lmcmFtZTogQm9vbGVhbn19IFRoZSBmcmFtZSBtZXRhZGF0YS5cbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX3JlYWRCaW5hcnlIZWFkID0gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBvZmZzZXRzIGhhdmUgd2hhdCB3ZSBuZWVkOlxuICAgICAgICAgICAgLy8gIDA6IFsyNCBieXRlXSBzdHI6IFJGQzMzMzkgdGltZXN0YW1wXG4gICAgICAgICAgICAvLyAyNDogWzQgYnl0ZV0gIHUzMjogZnJhbWUgZmxhZ3NcbiAgICAgICAgICAgIC8vIDI4OiBbMSBieXRlXSBib29sOiBpZHIgZmxhZ1xuICAgICAgICAgICAgdmFyIHRpbWUgPSBuZXcgRGF0ZSh0aGlzLl9kZWNvZGVyLmRlY29kZShkYXRhLnN1YmFycmF5KDAsIDI0KSkpO1xuICAgICAgICAgICAgdmFyIGZsYWdzID0gZGF0YVsyNF08PDI0IHwgZGF0YVsyNV08PDE2IHwgZGF0YVsyNl08PDggfCBkYXRhWzI3XTtcbiAgICAgICAgICAgIHZhciBpc0lmcmFtZSA9IGRhdGFbMjhdID09PSAweDAxO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0aW1lOiB0aW1lLFxuICAgICAgICAgICAgICAgIGZsYWdzOiBmbGFncyxcbiAgICAgICAgICAgICAgICBpc0lmcmFtZTogaXNJZnJhbWUsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBFVldFQjIuVmlkZW9GcmFtZSByZXByZXNlbnRzIGEgc2luZ2xlIHZpZGVvIGZyYW1lIGVtaXR0ZWQgZnJvbSBvdXIgc2VydmVyLlxuICAgICAqIEBwYXJhbSB7RGF0ZX0gdGltZSBUaGUgZnJhbWUgdGltZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gZmxhZ3MgQml0c2V0IG9mIGZyYW1lIGZsYWdzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gaXNJZnJhbWUgV2hldGhlciB0aGlzIGZyYW1lIGlzIGFuIGluZGVwZW5kZW50IChpLWZyYW1lKSBkYXRhIHNsaWNlLiBJcnJlbGV2YW50IGZvciB2aWRlbyBzb3VyY2VzXG4gICAgICogdGhhdCBkbyBub3QgdXNlIGludGVyZnJhbWUgY29tcHJlc3Npb24uXG4gICAgICogQHBhcmFtIHtVaW50OEFycmF5fSBkYXRhIFRoZSBmcmFtZSBwYXlsb2FkLlxuICAgICAqIEBjb25zdHJ1Y3RvclxuICAgICAqIEBjYXRlZ29yeSBDYW1lcmFcbiAgICAgKi9cbiAgICBFVldFQjIuVmlkZW9GcmFtZSA9IGZ1bmN0aW9uKHRpbWUsIGZsYWdzLCBpc0lmcmFtZSwgZGF0YSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGZyYW1lIHRpbWUuXG4gICAgICAgICAqIEB0eXBlIHtEYXRlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50aW1lID0gdGltZTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogQml0c2V0IG9mIGZyYW1lIGZsYWdzLlxuICAgICAgICAgKiBAdHlwZSB7TnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5mbGFncyA9IGZsYWdzO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoaXMgZnJhbWUgaXMgYW4gaW5kZXBlbmRlbnQgKGktZnJhbWUpIGRhdGEgc2xpY2UuIElycmVsZXZhbnQgZm9yIHZpZGVvIHNvdXJjZXNcbiAgICAgICAgICogdGhhdCBkbyBub3QgdXNlIGludGVyZnJhbWUgY29tcHJlc3Npb24uXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pc0lmcmFtZSA9IGlzSWZyYW1lO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZnJhbWUgcGF5bG9hZC5cbiAgICAgICAgICogQHR5cGUge1VpbnQ4QXJyYXl9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBFbnVtZXJhdGlvbiBvZiBhc3NvY2lhdGVkIHNvdXJjZSB0eXBlcyBmb3IgYW5hbHl0aWMgcnVsZXMuXG4gICAgICogQGVudW0ge051bWJlcn1cbiAgICAgKiBAcmVhZG9ubHlcbiAgICAgKiBAY2F0ZWdvcnkgQW5hbHl0aWNzXG4gICAgICovXG4gICAgRVZXRUIyLmFuYWx5dGljUnVsZVNvdXJjZVR5cGUgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmtub3duIChpbnZhbGlkKVxuICAgICAgICAgKi9cbiAgICAgICAgdW5rbm93bjogMCxcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNvdXJjZSBpcyBhbiBhc3NvY2lhdGVkIGNhbWVyYVxuICAgICAgICAgKi9cbiAgICAgICAgY2FtZXJhOiAxLFxuICAgICAgICAvKipcbiAgICAgICAgICogU291cmNlIGlzIGFuIGFzc29jaWF0ZWQgYXVkaW8gZGV2aWNlXG4gICAgICAgICAqL1xuICAgICAgICBhdWRpbzogMlxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQb2ludHMgdG8gYSBjYW1lcmEgc291cmNlIGFzc29jaWF0ZWQgd2l0aCBhbiBhbmFseXRpYyBydWxlLlxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBbaWQ9MF0gVGhlIGNhbWVyYSBJRC5cbiAgICAgKiBAY2xhc3NcbiAgICAgKiBAY2F0ZWdvcnkgQW5hbHl0aWNzXG4gICAgICovXG4gICAgRVZXRUIyLkFzc29jaWF0ZWRDYW1lcmFTb3VyY2UgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGNhbWVyYSBJRC5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogUG9pbnRzIHRvIGFuIGF1ZGlvIHNvdXJjZSBhc3NvY2lhdGVkIHdpdGggYW4gYW5hbHl0aWMgcnVsZS5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2lkPTBdIFRoZSBhdWRpbyBkZXZpY2UgSUQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IEFuYWx5dGljc1xuICAgICAqL1xuICAgIEVWV0VCMi5Bc3NvY2lhdGVkQXVkaW9Tb3VyY2UgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGF1ZGlvIGRldmljZSBJRC5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5lcyBhbiBhbmFseXRpYyBydWxlIGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIHtFVldFQjIuU2VydmVyfSBbc2VydmVyPW51bGxdIFRoZSBzZXJ2ZXIgdGhhdCBob3N0cyB0aGlzIHJ1bGUuXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IFtpZD0wXSBUaGUgcnVsZSBJRC5cbiAgICAgKiBAcGFyYW0ge051bWJlcn0gW2RldmljZUlkPTBdIFRoZSBJRCBvZiB0aGUgZGV2aWNlIHRvIHdoaWNoIHRoaXMgcnVsZSBpcyBhdHRhY2hlZC5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5Bc3NvY2lhdGVkQ2FtZXJhU291cmNlfEVWV0VCMi5Bc3NvY2lhdGVkQXVkaW9Tb3VyY2V9IFtzb3VyY2VJZD1udWxsXSBUaGUgaWRlbnRpZmllciBvZiB0aGUgc291cmNlXG4gICAgICogd2l0aCB3aGljaCB0aGlzIHJ1bGUgaXMgYXNzb2NpYXRlZC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gW25hbWU9JyddIFRoZSBuYW1lIG9mIHRoaXMgcnVsZS5cbiAgICAgKiBAcGFyYW0ge0VWV0VCMi5BbmFseXRpY1J1bGVPU0RDb25maWd9IFtvc2RDb25maWc9bnVsbF0gUnVsZSBPU0QgY29uZmlndXJhdGlvbiwgdXNlZCB3aGVuIHRoZSBydWxlIHByZXNlbnRzXG4gICAgICogbWV0YWRhdGEgZm9yIHByb3ZpZGluZyBhbiBhbmFseXRpYyBvdmVybGF5IG92ZXIgdmlkZW8uXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbbWV0YWRhdGFFbmFibGVkPWZhbHNlXSBXaGV0aGVyIG1ldGFkYXRhIGlzIGVuYWJsZWQgb24gdGhpcyBydWxlLiBJZiB0cnVlLCBwdXNoIG5vdGlmaWNhdGlvbnNcbiAgICAgKiBmb3IgdGhlIHJ1bGUgd2lsbCBiZSBkaXNwYXRjaGVkIHdpdGggdGhlIG1ldGFkYXRhIGZvciB0aGUgdHJpZ2dlcmVkIGV2ZW50IGFzIHBhcnQgb2YgdGhlIG5vdGlmaWNhdGlvbiBwYXlsb2FkLlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLkV2ZW50TWV0YWRhdGFUZW1wbGF0ZVtdfSBbbWV0YWRhdGFUZW1wbGF0ZXM9W11dIFRoZSBzZXQgb2YgbWV0YWRhdGEgZmllbGRzIHRoYXQgc3RhdHVzXG4gICAgICogZXZlbnRzIGZvciB0aGlzIHJ1bGUgbWF5IHByZXNlbnQuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IEFuYWx5dGljc1xuICAgICAqL1xuICAgIEVWV0VCMi5BbmFseXRpY1J1bGUgPSBmdW5jdGlvbihzZXJ2ZXIsIGlkLCBkZXZpY2VJZCwgc291cmNlSWQsIG5hbWUsIG9zZENvbmZpZywgbWV0YWRhdGFFbmFibGVkLFxuICAgICAgICBtZXRhZGF0YVRlbXBsYXRlcykge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNlcnZlciB0aGF0IGhvc3RzIHRoaXMgcnVsZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5TZXJ2ZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNlcnZlciA9IHNlcnZlciB8fCBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcnVsZSBJRC5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaWQgPSBpZCB8fCAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgSUQgb2YgdGhlIElQIGRldmljZSB0byB3aGljaCB0aGlzIHJ1bGUgaXMgYXR0YWNoZWQuIFRoaXMgaXMgbm90IG5lY2Vzc2FyaWx5IHRoZSBzb3VyY2UgdGhhdCBlbWl0cyB0aGVcbiAgICAgICAgICogZGF0YSBiZWluZyB0cmFja2VkIGZvciBhbmFseXRpYyBtYXRjaGVzLCBzZWUge0BsaW5rIEVWV0VCMi5BbmFseXRpY1J1bGUjc291cmNlSWR8dGhpcy5zb3VyY2VJZH0gdG8gZGV0ZXJtaW5lXG4gICAgICAgICAqIHRoZSBuYXR1cmUgb2YgdGhhdCBhc3NvY2lhdGlvbi5cbiAgICAgICAgICogQHR5cGUge051bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGV2aWNlSWQgPSBkZXZpY2VJZCB8fCAwO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaWRlbnRpZmllciBvZiB0aGUgc291cmNlIHdpdGggd2hpY2ggdGhpcyBydWxlIGlzIGFzc29jaWF0ZWQuXG4gICAgICAgICAqIEB0eXBlIHtFVldFQjIuQXNzb2NpYXRlZENhbWVyYVNvdXJjZXxFVldFQjIuQXNzb2NpYXRlZEF1ZGlvU291cmNlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zb3VyY2VJZCA9IHNvdXJjZUlkIHx8IG51bGw7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBuYW1lIG9mIHRoaXMgcnVsZS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWUgfHwgJyc7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJ1bGUgT1NEIGNvbmZpZ3VyYXRpb24sIHVzZWQgd2hlbiB0aGUgcnVsZSBwcmVzZW50cyBtZXRhZGF0YSBmb3IgZHJhd2luZyBzaGFwZXMgb3ZlciB2aWRlby5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5BbmFseXRpY1J1bGVPU0RDb25maWd9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9zZENvbmZpZyA9IG9zZENvbmZpZyB8fCBudWxsO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIG1ldGFkYXRhIGlzIGVuYWJsZWQgb24gdGhpcyBydWxlIChwcmVzZW50ZWQgb24gc3RhdHVzIGV2ZW50cykuXG4gICAgICAgICAqIEB0eXBlIHtCb29sZWFufVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YUVuYWJsZWQgPSBtZXRhZGF0YUVuYWJsZWQgfHwgZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBzZXQgb2YgbWV0YWRhdGEgZmllbGRzIHRoYXQgc3RhdHVzIGV2ZW50cyBmb3IgdGhpcyBydWxlIG1heSBwcmVzZW50LlxuICAgICAgICAgKiBAdHlwZSB7RVZXRUIyLkV2ZW50TWV0YWRhdGFUZW1wbGF0ZVtdfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YVRlbXBsYXRlcyA9IG1ldGFkYXRhVGVtcGxhdGVzIHx8IFtdO1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxiYWNrIGludm9rZWQgYnlcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5BbmFseXRpY1J1bGUjcHVzaE5vdGlmaWNhdGlvblN1YnNjcmliZXxwdXNoTm90aWZpY2F0aW9uU3Vic2NyaWJlKCl9LlxuICAgICAgICAgKiBAY2FsbGJhY2sgRVZXRUIyLkFuYWx5dGljUnVsZX5vblB1c2hOb3RpZmljYXRpb25TdWJzY3JpYmVcbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuUmVzcG9uc2VTdGF0dXN9IHJlc3BvbnNlIFN1Y2Nlc3Mgc3RhdGUgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKi9cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlZ2lzdGVyIGEgY2xpZW50IHRvIHJlY2VpdmUgcHVzaCBub3RpZmljYXRpb25zIGZvciBhbGFybWVkIG1hdGNoZXMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcnVsZS5cbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuQW5hbHl0aWNSdWxlfm9uUHVzaE5vdGlmaWNhdGlvblN1YnNjcmliZX0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCBvbiBjb21wbGV0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2xpZW50SWQgVGhlIGNsaWVudCBJRCwgZ2VuZXJhdGVkIGluIGEgcHJldmlvdXMgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlB1c2hOb3RpZmljYXRpb24jcmVnaXN0ZXJDbGllbnR8RVZXRUIyLlB1c2hOb3RpZmljYXRpb24ucmVnaXN0ZXJDbGllbnQoKX0uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnB1c2hOb3RpZmljYXRpb25TdWJzY3JpYmUgPSBmdW5jdGlvbihjYWxsYmFjaywgY2xpZW50SWQpIHtcbiAgICAgICAgICAgIHZhciBvblN1Y2Nlc3MgPSBmdW5jdGlvbihkYXRhLyosIHRleHRTdGF0dXMsIHhociovKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhkYXRhLnN1Y2Nlc3MpKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgb25FcnJvciA9IGZ1bmN0aW9uKHhoci8qLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biovKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVWV0VCMi5SZXNwb25zZVN0YXR1cyhmYWxzZSwgRVZXRUIyLnV0aWwuZ2V0RXJyb3JUZXh0KHhocikpKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIEVWV0VCMi5hamF4KHtcbiAgICAgICAgICAgICAgICB1cmw6IHRoaXMuc2VydmVyLnNlcnZpY2UudXJsKCkgKyBFVldFQjIudXJscy5hbmFseXRpY1J1bGVQdXNoLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIHM6IHRoaXMuc2VydmVyLnNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50SWQ6IGNsaWVudElkLFxuICAgICAgICAgICAgICAgICAgICBkZXZpY2VJZDogdGhpcy5kZXZpY2VJZCxcbiAgICAgICAgICAgICAgICAgICAgcnVsZUlkOiB0aGlzLmlkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG9uRXJyb3JcbiAgICAgICAgICAgIH0sIHRoaXMuc2VydmVyLnNlcnZpY2UpO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxiYWNrIGludm9rZWQgYnlcbiAgICAgICAgICoge0BsaW5rIEVWV0VCMi5BbmFseXRpY1J1bGUjcHVzaE5vdGlmaWNhdGlvblVuc3Vic2NyaWJlfHB1c2hOb3RpZmljYXRpb25VbnN1YnNjcmliZSgpfS5cbiAgICAgICAgICogQGNhbGxiYWNrIEVWV0VCMi5BbmFseXRpY1J1bGV+b25QdXNoTm90aWZpY2F0aW9uVW5zdWJzY3JpYmVcbiAgICAgICAgICogQHBhcmFtIHtFVldFQjIuUmVzcG9uc2VTdGF0dXN9IHJlc3BvbnNlIFN1Y2Nlc3Mgc3RhdGUgb2YgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgKi9cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJlbW92ZSBhIGNsaWVudCdzIHJlZ2lzdHJhdGlvbiBmb3IgcHVzaCBub3RpZmljYXRpb25zIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJ1bGUuXG4gICAgICAgICAqIEBwYXJhbSB7RVZXRUIyLkFuYWx5dGljUnVsZX5vblB1c2hOb3RpZmljYXRpb25VbnN1YnNjcmliZX0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gYmUgaW52b2tlZCBvbiBjb21wbGV0aW9uLlxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2xpZW50SWQgVGhlIGNsaWVudCBJRCwgZ2VuZXJhdGVkIGluIGEgcHJldmlvdXMgY2FsbCB0b1xuICAgICAgICAgKiB7QGxpbmsgRVZXRUIyLlB1c2hOb3RpZmljYXRpb24jcmVnaXN0ZXJDbGllbnR8RVZXRUIyLlB1c2hOb3RpZmljYXRpb24ucmVnaXN0ZXJDbGllbnQoKX0uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnB1c2hOb3RpZmljYXRpb25VbnN1YnNjcmliZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjbGllbnRJZCkge1xuICAgICAgICAgICAgdmFyIG9uU3VjY2VzcyA9IGZ1bmN0aW9uKGRhdGEvKiwgdGV4dFN0YXR1cywgeGhyKi8pIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGRhdGEuc3VjY2VzcykpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZhciBvbkVycm9yID0gZnVuY3Rpb24oeGhyLyosIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKi8pIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhuZXcgRVZXRUIyLlJlc3BvbnNlU3RhdHVzKGZhbHNlLCBFVldFQjIudXRpbC5nZXRFcnJvclRleHQoeGhyKSkpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgRVZXRUIyLmFqYXgoe1xuICAgICAgICAgICAgICAgIHVybDogdGhpcy5zZXJ2ZXIuc2VydmljZS51cmwoKSArIEVWV0VCMi51cmxzLmFuYWx5dGljUnVsZVB1c2gsXG4gICAgICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBzOiB0aGlzLnNlcnZlci5zZXNzaW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIGNsaWVudElkOiBjbGllbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlSWQ6IHRoaXMuZGV2aWNlSWQsXG4gICAgICAgICAgICAgICAgICAgIHJ1bGVJZDogdGhpcy5pZFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3VjY2Vzczogb25TdWNjZXNzLFxuICAgICAgICAgICAgICAgIGVycm9yOiBvbkVycm9yXG4gICAgICAgICAgICB9LCB0aGlzLnNlcnZlci5zZXJ2aWNlKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogT1NEIGNvbmZpZ3VyYXRpb24gZm9yIGFuIGFuYWx5dGljIHJ1bGUgdGhhdCBkcmF3cyBzaGFwZXMgb3ZlciB2aWRlby5cbiAgICAgKiBAcGFyYW0ge1JHQkF9IFtiYWNrZ3JvdW5kQ29sb3I9WzAsMCwwLDBdXSBUaGUgb3ZlcmxheSBiYWNrZ3JvdW5kIGNvbG9yLlxuICAgICAqIEBwYXJhbSB7UkdCQX0gW2JvcmRlckNvbG9yPVswLDAsMCwwXV0gVGhlIG92ZXJsYXkgYm9yZGVyIGNvbG9yLlxuICAgICAqIEBjbGFzc1xuICAgICAqIEBjYXRlZ29yeSBBbmFseXRpY3NcbiAgICAgKi9cbiAgICBFVldFQjIuQW5hbHl0aWNSdWxlT1NEQ29uZmlnID0gZnVuY3Rpb24oYmFja2dyb3VuZENvbG9yLCBib3JkZXJDb2xvcikge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG92ZXJsYXkgYmFja2dyb3VuZCBjb2xvci5cbiAgICAgICAgICogQHR5cGUge1JHQkF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IGJhY2tncm91bmRDb2xvciB8fCBbMCwwLDAsMF07XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBvdmVybGF5IGJvcmRlciBjb2xvci5cbiAgICAgICAgICogQHR5cGUge1JHQkF9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJvcmRlckNvbG9yID0gYm9yZGVyQ29sb3IgfHwgWzAsMCwwLDBdO1xuICAgIH07XG59KCkpO1xuIiwiLypnbG9iYWxzIEVWV0VCMjp0cnVlKi9cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBFbnVtZXJhdGlvbiBvZiBldmVudCBtZXRhZGF0YSB0eXBlcy5cbiAgICAgKiBAZW51bSB7TnVtYmVyfVxuICAgICAqIEByZWFkb25seVxuICAgICAqIEBjYXRlZ29yeSBFdmVudHNcbiAgICAgKi9cbiAgICBFVldFQjIuZXZlbnRNZXRhZGF0YVZhbHVlVHlwZSA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFVua25vd24gKGludmFsaWQpXG4gICAgICAgICAqL1xuICAgICAgICB1bmtub3duOiAwLFxuICAgICAgICAvKipcbiAgICAgICAgICogTnVtZXJpYyBmb3JtXG4gICAgICAgICAqL1xuICAgICAgICBudW1iZXI6IDEsXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdHJpbmcgZm9ybVxuICAgICAgICAgKi9cbiAgICAgICAgc3RyaW5nOiAyLFxuICAgICAgICAvKipcbiAgICAgICAgICogV2VsbC1rbm93biB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIGdlb21ldHJ5IChXS1QpIGZvcm0sXG4gICAgICAgICAqIGFzIHNwZWNpZmllZCBpbiBJU08vSUVDIDEzMjQ5LTM6MjAxNlxuICAgICAgICAgKi9cbiAgICAgICAgd2t0OiAzXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIERlZmluZXMgYSBtZXRhZGF0YSB0ZW1wbGF0ZSAoYSBrZXktdmFsdWUgc2V0IHRoYXQgZGlmZmVyZW50IHN0YXR1cyBldmVudHMgbWF5IHByZXNlbnQpLlxuICAgICAqIE1ldGFkYXRhIHRoYXQgbWF5IGJlIHByb3ZpZGVkIGFsb25nc2lkZSBhbmFseXRpYyBzdGF0dXMgZXZlbnRzIGFyZSBhcyBmb2xsb3dzOlxuICAgICAqIDxwcmU+XG4gICAgICogKiBcIk9iamVjdElkXCI6IHtAbGluayBFVldFQjIuZXZlbnRNZXRhZGF0YVZhbHVlVHlwZS5zdHJpbmd9XG4gICAgICogKiBcIkJvdW5kaW5nQm94XCI6IHtAbGluayBFVldFQjIuZXZlbnRNZXRhZGF0YVZhbHVlVHlwZS53a3R9XG4gICAgICogKiBcIlBlcnNvbktleVwiOiB7QGxpbmsgRVZXRUIyLmV2ZW50TWV0YWRhdGFWYWx1ZVR5cGUuc3RyaW5nfVxuICAgICAqIDwvcHJlPlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBba2V5PScnXSBUaGUga2V5LlxuICAgICAqIEBwYXJhbSB7RVZXRUIyLmV2ZW50TWV0YWRhdGFWYWx1ZVR5cGV9IFt2YWx1ZVR5cGU9RVZXRUIyLmV2ZW50TWV0YWRhdGFWYWx1ZVR5cGUudW5rbm93bl0gVGhlIHR5cGUgb2YgdmFsdWUuXG4gICAgICogQGNsYXNzXG4gICAgICogQGNhdGVnb3J5IEV2ZW50c1xuICAgICAqL1xuICAgIEVWV0VCMi5FdmVudE1ldGFkYXRhVGVtcGxhdGUgPSBmdW5jdGlvbihrZXksIHZhbHVlVHlwZSkge1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGtleS5cbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMua2V5ID0ga2V5IHx8ICcnO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgdHlwZSBvZiB2YWx1ZS5cbiAgICAgICAgICogQHR5cGUge0VWV0VCMi5ldmVudE1ldGFkYXRhVmFsdWVUeXBlfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52YWx1ZVR5cGUgPSB2YWx1ZVR5cGUgfHwgRVZXRUIyLmV2ZW50TWV0YWRhdGFWYWx1ZVR5cGUudW5rbm93bjtcbiAgICB9O1xufSgpKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
